/* Generated by Cython 0.29.5 */

/* BEGIN: Cython Metadata
{
    "distutils": {
        "name": "chess.__init__cp",
        "sources": [
            "chess/__init__cp.pyx"
        ]
    },
    "module_name": "chess.__init__cp"
}
END: Cython Metadata */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
    #error Cython requires Python 2.6+ or Python 3.3+.
#else
#define CYTHON_ABI "0_29_5"
#define CYTHON_HEX_VERSION 0x001D05F0
#define CYTHON_FUTURE_DIVISION 1
#include <stddef.h>
#ifndef offsetof
  #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#define __PYX_COMMA ,
#ifndef HAVE_LONG_LONG
  #if PY_VERSION_HEX >= 0x02070000
    #define HAVE_LONG_LONG
  #endif
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#ifdef PYPY_VERSION
  #define CYTHON_COMPILING_IN_PYPY 1
  #define CYTHON_COMPILING_IN_PYSTON 0
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #undef CYTHON_USE_TYPE_SLOTS
  #define CYTHON_USE_TYPE_SLOTS 0
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #if PY_VERSION_HEX < 0x03050000
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #undef CYTHON_USE_UNICODE_INTERNALS
  #define CYTHON_USE_UNICODE_INTERNALS 0
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #undef CYTHON_AVOID_BORROWED_REFS
  #define CYTHON_AVOID_BORROWED_REFS 1
  #undef CYTHON_ASSUME_SAFE_MACROS
  #define CYTHON_ASSUME_SAFE_MACROS 0
  #undef CYTHON_UNPACK_METHODS
  #define CYTHON_UNPACK_METHODS 0
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #undef CYTHON_PEP489_MULTI_PHASE_INIT
  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #undef CYTHON_USE_TP_FINALIZE
  #define CYTHON_USE_TP_FINALIZE 0
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
#elif defined(PYSTON_VERSION)
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_PYSTON 1
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #undef CYTHON_USE_ASYNC_SLOTS
  #define CYTHON_USE_ASYNC_SLOTS 0
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #undef CYTHON_PEP489_MULTI_PHASE_INIT
  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #undef CYTHON_USE_TP_FINALIZE
  #define CYTHON_USE_TP_FINALIZE 0
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
#else
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_PYSTON 0
  #define CYTHON_COMPILING_IN_CPYTHON 1
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #if PY_VERSION_HEX < 0x02070000
    #undef CYTHON_USE_PYTYPE_LOOKUP
    #define CYTHON_USE_PYTYPE_LOOKUP 0
  #elif !defined(CYTHON_USE_PYTYPE_LOOKUP)
    #define CYTHON_USE_PYTYPE_LOOKUP 1
  #endif
  #if PY_MAJOR_VERSION < 3
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #if PY_VERSION_HEX < 0x02070000
    #undef CYTHON_USE_PYLONG_INTERNALS
    #define CYTHON_USE_PYLONG_INTERNALS 0
  #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
    #define CYTHON_USE_PYLONG_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_PYLIST_INTERNALS
    #define CYTHON_USE_PYLIST_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #if PY_VERSION_HEX < 0x030300F0
    #undef CYTHON_USE_UNICODE_WRITER
    #define CYTHON_USE_UNICODE_WRITER 0
  #elif !defined(CYTHON_USE_UNICODE_WRITER)
    #define CYTHON_USE_UNICODE_WRITER 1
  #endif
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #ifndef CYTHON_FAST_THREAD_STATE
    #define CYTHON_FAST_THREAD_STATE 1
  #endif
  #ifndef CYTHON_FAST_PYCALL
    #define CYTHON_FAST_PYCALL 1
  #endif
  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
    #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
  #endif
  #ifndef CYTHON_USE_TP_FINALIZE
    #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
  #endif
  #ifndef CYTHON_USE_DICT_VERSIONS
    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
  #endif
  #ifndef CYTHON_USE_EXC_INFO_STACK
    #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
  #endif
#endif
#if !defined(CYTHON_FAST_PYCCALL)
#define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
#endif
#if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
  #undef SHIFT
  #undef BASE
  #undef MASK
  #ifdef SIZEOF_VOID_P
    enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
  #endif
#endif
#ifndef __has_attribute
  #define __has_attribute(x) 0
#endif
#ifndef __has_cpp_attribute
  #define __has_cpp_attribute(x) 0
#endif
#ifndef CYTHON_RESTRICT
  #if defined(__GNUC__)
    #define CYTHON_RESTRICT __restrict__
  #elif defined(_MSC_VER) && _MSC_VER >= 1400
    #define CYTHON_RESTRICT __restrict
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_RESTRICT restrict
  #else
    #define CYTHON_RESTRICT
  #endif
#endif
#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
#ifndef CYTHON_MAYBE_UNUSED_VAR
#  if defined(__cplusplus)
     template<class T> void CYTHON_MAYBE_UNUSED_VAR( const T& ) { }
#  else
#    define CYTHON_MAYBE_UNUSED_VAR(x) (void)(x)
#  endif
#endif
#ifndef CYTHON_NCP_UNUSED
# if CYTHON_COMPILING_IN_CPYTHON
#  define CYTHON_NCP_UNUSED
# else
#  define CYTHON_NCP_UNUSED CYTHON_UNUSED
# endif
#endif
#define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)
#ifdef _MSC_VER
    #ifndef _MSC_STDINT_H_
        #if _MSC_VER < 1300
           typedef unsigned char     uint8_t;
           typedef unsigned int      uint32_t;
        #else
           typedef unsigned __int8   uint8_t;
           typedef unsigned __int32  uint32_t;
        #endif
    #endif
#else
   #include <stdint.h>
#endif
#ifndef CYTHON_FALLTHROUGH
  #if defined(__cplusplus) && __cplusplus >= 201103L
    #if __has_cpp_attribute(fallthrough)
      #define CYTHON_FALLTHROUGH [[fallthrough]]
    #elif __has_cpp_attribute(clang::fallthrough)
      #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
    #elif __has_cpp_attribute(gnu::fallthrough)
      #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
    #endif
  #endif
  #ifndef CYTHON_FALLTHROUGH
    #if __has_attribute(fallthrough)
      #define CYTHON_FALLTHROUGH __attribute__((fallthrough))
    #else
      #define CYTHON_FALLTHROUGH
    #endif
  #endif
  #if defined(__clang__ ) && defined(__apple_build_version__)
    #if __apple_build_version__ < 7000000
      #undef  CYTHON_FALLTHROUGH
      #define CYTHON_FALLTHROUGH
    #endif
  #endif
#endif

#ifndef CYTHON_INLINE
  #if defined(__clang__)
    #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
  #elif defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif

#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
  #define Py_OptimizeFlag 0
#endif
#define __PYX_BUILD_PY_SSIZE_T "n"
#define CYTHON_FORMAT_SSIZE_T "z"
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyClass_Type
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyType_Type
#endif
#ifndef Py_TPFLAGS_CHECKTYPES
  #define Py_TPFLAGS_CHECKTYPES 0
#endif
#ifndef Py_TPFLAGS_HAVE_INDEX
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#ifndef Py_TPFLAGS_HAVE_NEWBUFFER
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#ifndef Py_TPFLAGS_HAVE_FINALIZE
  #define Py_TPFLAGS_HAVE_FINALIZE 0
#endif
#ifndef METH_STACKLESS
  #define METH_STACKLESS 0
#endif
#if PY_VERSION_HEX <= 0x030700A3 || !defined(METH_FASTCALL)
  #ifndef METH_FASTCALL
     #define METH_FASTCALL 0x80
  #endif
  typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
  typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                          Py_ssize_t nargs, PyObject *kwnames);
#else
  #define __Pyx_PyCFunctionFast _PyCFunctionFast
  #define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
#endif
#if CYTHON_FAST_PYCCALL
#define __Pyx_PyFastCFunction_Check(func)\
    ((PyCFunction_Check(func) && (METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)))))
#else
#define __Pyx_PyFastCFunction_Check(func) 0
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
  #define PyObject_Malloc(s)   PyMem_Malloc(s)
  #define PyObject_Free(p)     PyMem_Free(p)
  #define PyObject_Realloc(p)  PyMem_Realloc(p)
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030400A1
  #define PyMem_RawMalloc(n)           PyMem_Malloc(n)
  #define PyMem_RawRealloc(p, n)       PyMem_Realloc(p, n)
  #define PyMem_RawFree(p)             PyMem_Free(p)
#endif
#if CYTHON_COMPILING_IN_PYSTON
  #define __Pyx_PyCode_HasFreeVars(co)  PyCode_HasFreeVars(co)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno) PyFrame_SetLineNumber(frame, lineno)
#else
  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
#endif
#if !CYTHON_FAST_THREAD_STATE || PY_VERSION_HEX < 0x02070000
  #define __Pyx_PyThreadState_Current PyThreadState_GET()
#elif PY_VERSION_HEX >= 0x03060000
  #define __Pyx_PyThreadState_Current _PyThreadState_UncheckedGet()
#elif PY_VERSION_HEX >= 0x03000000
  #define __Pyx_PyThreadState_Current PyThreadState_GET()
#else
  #define __Pyx_PyThreadState_Current _PyThreadState_Current
#endif
#if PY_VERSION_HEX < 0x030700A2 && !defined(PyThread_tss_create) && !defined(Py_tss_NEEDS_INIT)
#include "pythread.h"
#define Py_tss_NEEDS_INIT 0
typedef int Py_tss_t;
static CYTHON_INLINE int PyThread_tss_create(Py_tss_t *key) {
  *key = PyThread_create_key();
  return 0;
}
static CYTHON_INLINE Py_tss_t * PyThread_tss_alloc(void) {
  Py_tss_t *key = (Py_tss_t *)PyObject_Malloc(sizeof(Py_tss_t));
  *key = Py_tss_NEEDS_INIT;
  return key;
}
static CYTHON_INLINE void PyThread_tss_free(Py_tss_t *key) {
  PyObject_Free(key);
}
static CYTHON_INLINE int PyThread_tss_is_created(Py_tss_t *key) {
  return *key != Py_tss_NEEDS_INIT;
}
static CYTHON_INLINE void PyThread_tss_delete(Py_tss_t *key) {
  PyThread_delete_key(*key);
  *key = Py_tss_NEEDS_INIT;
}
static CYTHON_INLINE int PyThread_tss_set(Py_tss_t *key, void *value) {
  return PyThread_set_key_value(*key, value);
}
static CYTHON_INLINE void * PyThread_tss_get(Py_tss_t *key) {
  return PyThread_get_key_value(*key);
}
#endif
#if CYTHON_COMPILING_IN_CPYTHON || defined(_PyDict_NewPresized)
#define __Pyx_PyDict_NewPresized(n)  ((n <= 8) ? PyDict_New() : _PyDict_NewPresized(n))
#else
#define __Pyx_PyDict_NewPresized(n)  PyDict_New()
#endif
#if PY_MAJOR_VERSION >= 3 || CYTHON_FUTURE_DIVISION
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
#define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
#else
#define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
#endif
#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
                                              0 : _PyUnicode_Ready((PyObject *)(op)))
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
  #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
#else
  #define CYTHON_PEP393_ENABLED 0
  #define PyUnicode_1BYTE_KIND  1
  #define PyUnicode_2BYTE_KIND  2
  #define PyUnicode_4BYTE_KIND  4
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535 : 1114111)
  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = ch)
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
#endif
#if CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
#else
  #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
      PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyUnicode_Contains)
  #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyByteArray_Check)
  #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Format)
  #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
#endif
#define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None || (PyString_Check(b) && !PyString_CheckExact(b)))) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
#define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None || (PyUnicode_Check(b) && !PyUnicode_CheckExact(b)))) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
#else
  #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
#endif
#if PY_MAJOR_VERSION < 3 && !defined(PyObject_ASCII)
  #define PyObject_ASCII(o)            PyObject_Repr(o)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
  #define PyObject_Unicode             PyObject_Str
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
#endif
#if CYTHON_ASSUME_SAFE_MACROS
  #define __Pyx_PySequence_SIZE(seq)  Py_SIZE(seq)
#else
  #define __Pyx_PySequence_SIZE(seq)  PySequence_Size(seq)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define PyNumber_Int                 PyNumber_Long
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
  #ifndef PyUnicode_InternFromString
    #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
  #endif
#endif
#if PY_VERSION_HEX < 0x030200A4
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? PyMethod_New(func, self) : (Py_INCREF(func), func))
#else
  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
#endif
#if CYTHON_USE_ASYNC_SLOTS
  #if PY_VERSION_HEX >= 0x030500B1
    #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
    #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
  #else
    #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
  #endif
#else
  #define __Pyx_PyType_AsAsync(obj) NULL
#endif
#ifndef __Pyx_PyAsyncMethodsStruct
    typedef struct {
        unaryfunc am_await;
        unaryfunc am_aiter;
        unaryfunc am_anext;
    } __Pyx_PyAsyncMethodsStruct;
#endif

#if defined(WIN32) || defined(MS_WINDOWS)
  #define _USE_MATH_DEFINES
#endif
#include <math.h>
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif
#if defined(__CYGWIN__) && defined(_LDBL_EQ_DBL)
#define __Pyx_truncl trunc
#else
#define __Pyx_truncl truncl
#endif


#define __PYX_ERR(f_index, lineno, Ln_error) \
{ \
  __pyx_filename = __pyx_f[f_index]; __pyx_lineno = lineno; __pyx_clineno = __LINE__; goto Ln_error; \
}

#ifndef __PYX_EXTERN_C
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#define __PYX_HAVE__chess____init__cp
#define __PYX_HAVE_API__chess____init__cp
/* Early includes */
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
#define CYTHON_WITHOUT_ASSERTIONS
#endif

typedef struct {PyObject **p; const char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry;

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT 0
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#define __Pyx_uchar_cast(c) ((unsigned char)c)
#define __Pyx_long_cast(x) ((long)x)
#define __Pyx_fits_Py_ssize_t(v, type, is_signed)  (\
    (sizeof(type) < sizeof(Py_ssize_t))  ||\
    (sizeof(type) > sizeof(Py_ssize_t) &&\
          likely(v < (type)PY_SSIZE_T_MAX ||\
                 v == (type)PY_SSIZE_T_MAX)  &&\
          (!is_signed || likely(v > (type)PY_SSIZE_T_MIN ||\
                                v == (type)PY_SSIZE_T_MIN)))  ||\
    (sizeof(type) == sizeof(Py_ssize_t) &&\
          (is_signed || likely(v < (type)PY_SSIZE_T_MAX ||\
                               v == (type)PY_SSIZE_T_MAX)))  )
static CYTHON_INLINE int __Pyx_is_valid_index(Py_ssize_t i, Py_ssize_t limit) {
    return (size_t) i < (size_t) limit;
}
#if defined (__cplusplus) && __cplusplus >= 201103L
    #include <cstdlib>
    #define __Pyx_sst_abs(value) std::abs(value)
#elif SIZEOF_INT >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) abs(value)
#elif SIZEOF_LONG >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) labs(value)
#elif defined (_MSC_VER)
    #define __Pyx_sst_abs(value) ((Py_ssize_t)_abs64(value))
#elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define __Pyx_sst_abs(value) llabs(value)
#elif defined (__GNUC__)
    #define __Pyx_sst_abs(value) __builtin_llabs(value)
#else
    #define __Pyx_sst_abs(value) ((value<0) ? -value : value)
#endif
static CYTHON_INLINE const char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE const char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
#define __Pyx_PyByteArray_FromString(s) PyByteArray_FromStringAndSize((const char*)s, strlen((const char*)s))
#define __Pyx_PyByteArray_FromStringAndSize(s, l) PyByteArray_FromStringAndSize((const char*)s, l)
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyBytes_AsWritableString(s)     ((char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsWritableSString(s)    ((signed char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsWritableUString(s)    ((unsigned char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsString(s)     ((const char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsSString(s)    ((const signed char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsUString(s)    ((const unsigned char*) PyBytes_AS_STRING(s))
#define __Pyx_PyObject_AsWritableString(s)    ((char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
#define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
#define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
#define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
#define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u) {
    const Py_UNICODE *u_end = u;
    while (*u_end++) ;
    return (size_t)(u_end - u - 1);
}
#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
#define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
#define __Pyx_PySequence_Tuple(obj)\
    (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
#if CYTHON_ASSUME_SAFE_MACROS
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION >= 3
#define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
#else
#define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
#endif
#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Float(x))
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    const char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    if (strcmp(default_encoding_c, "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (!ascii_chars_u) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%.200s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
        Py_DECREF(ascii_chars_u);
        Py_DECREF(ascii_chars_b);
    }
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c) + 1);
    if (!__PYX_DEFAULT_STRING_ENCODING) goto bad;
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


/* Test for GCC > 2.95 */
#if defined(__GNUC__)     && (__GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)))
  #define likely(x)   __builtin_expect(!!(x), 1)
  #define unlikely(x) __builtin_expect(!!(x), 0)
#else /* !__GNUC__ or GCC < 2.95 */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */
static CYTHON_INLINE void __Pyx_pretend_to_initialize(void* ptr) { (void)ptr; }

static PyObject *__pyx_m = NULL;
static PyObject *__pyx_d;
static PyObject *__pyx_b;
static PyObject *__pyx_cython_runtime = NULL;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static PyObject *__pyx_empty_unicode;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;


static const char *__pyx_f[] = {
  "chess/__init__cp.pyx",
  "stringsource",
};

/*--- Type declarations ---*/
struct __pyx_obj_5chess_10__init__cp_Move;
struct __pyx_obj_5chess_10__init__cp_BaseBoard;
struct __pyx_obj_5chess_10__init__cp_Board;
struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator;
struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__;
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr;
struct __pyx_defaults;
typedef struct __pyx_defaults __pyx_defaults;
struct __pyx_defaults {
  PyObject *__pyx_arg_squares;
};

/* "chess/__init__cp.pyx":450
 * 
 * 
 * cdef class Move:             # <<<<<<<<<<<<<<
 *     """
 *     Represents a move from a square to a square and possibly the promotion
 */
struct __pyx_obj_5chess_10__init__cp_Move {
  PyObject_HEAD
  int from_square;
  int to_square;
  PyObject *promotion;
  PyObject *drop;
};


/* "chess/__init__cp.pyx":565
 * 
 * 
 * cdef class BaseBoard:             # <<<<<<<<<<<<<<
 *     """
 *     A board representing the position of chess pieces. See
 */
struct __pyx_obj_5chess_10__init__cp_BaseBoard {
  PyObject_HEAD
  unsigned PY_LONG_LONG occupied_co[2];
  unsigned PY_LONG_LONG pawns;
  unsigned PY_LONG_LONG knights;
  unsigned PY_LONG_LONG bishops;
  unsigned PY_LONG_LONG rooks;
  unsigned PY_LONG_LONG queens;
  unsigned PY_LONG_LONG kings;
  unsigned PY_LONG_LONG castling_rights;
  int promoted;
  int occupied;
  int chess960;
  int turn;
  struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *pseudo_legal_moves;
  struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *legal_moves;
  PyObject *move_stack;
  PyObject *stack;
  PyObject *ep_square;
  int halfmove_clock;
  int fullmove_number;
};


/* "chess/__init__cp.pyx":1402
 * 
 * 
 * cdef class Board(BaseBoard):             # <<<<<<<<<<<<<<
 *     """
 *     A :class:`~chess.BaseBoard` and additional information representing
 */
struct __pyx_obj_5chess_10__init__cp_Board {
  struct __pyx_obj_5chess_10__init__cp_BaseBoard __pyx_base;
};


/* "chess/__init__cp.pyx":3363
 * 
 * 
 * cdef class PseudoLegalMoveGenerator:             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self, board):
 */
struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator {
  PyObject_HEAD
};


/* "chess/__init__cp.pyx":3395
 * 
 * 
 * cdef class LegalMoveGenerator:             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self, board):
 */
struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator {
  PyObject_HEAD
};


/* "chess/__init__cp.pyx":202
 *     return (bb & -bb).bit_length() - 1
 * 
 * def scan_forward(bb):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb & -bb
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward {
  PyObject_HEAD
  PyObject *__pyx_v_bb;
  PyObject *__pyx_v_r;
};


/* "chess/__init__cp.pyx":211
 *     return bb.bit_length() - 1
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb.bit_length() - 1
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed {
  PyObject_HEAD
  PyObject *__pyx_v__BB_SQUARES;
  PyObject *__pyx_v_bb;
  PyObject *__pyx_v_r;
};


/* "chess/__init__cp.pyx":322
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 * def _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler {
  PyObject_HEAD
  PyObject *__pyx_v_mask;
  PyObject *__pyx_v_subset;
};


/* "chess/__init__cp.pyx":1517
 *         self.clear_stack()
 * 
 *     def generate_pseudo_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         our_pieces = self.occupied_co[self.turn]
 * 
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves {
  PyObject_HEAD
  PyObject *__pyx_v_capturers;
  PyObject *__pyx_v_double_moves;
  PyObject *__pyx_v_from_mask;
  PyObject *__pyx_v_from_square;
  PyObject *__pyx_v_moves;
  PyObject *__pyx_v_non_pawns;
  unsigned PY_LONG_LONG __pyx_v_our_pieces;
  PyObject *__pyx_v_pawns;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
  PyObject *__pyx_v_single_moves;
  PyObject *__pyx_v_targets;
  PyObject *__pyx_v_to_mask;
  PyObject *__pyx_v_to_square;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
  PyObject *__pyx_t_3;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
};


/* "chess/__init__cp.pyx":1584
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:
 *             return
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep {
  PyObject_HEAD
  PyObject *__pyx_v_capturer;
  PyObject *__pyx_v_capturers;
  PyObject *__pyx_v_from_mask;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
  PyObject *__pyx_v_to_mask;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":2077
 *         return "".join(builder)
 * 
 *     def castling_xfen(self):             # <<<<<<<<<<<<<<
 *         builder = []
 * 
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen {
  PyObject_HEAD
  PyObject *__pyx_v_a_side;
  PyObject *__pyx_v_other_rooks;
  PyObject *__pyx_v_rook_file;
};


/* "chess/__init__cp.pyx":2094
 *                 other_rooks = self.occupied_co[color] & self.rooks & backrank & ~BB_SQUARES[rook_square]
 * 
 *                 if any((square_file(other) < rook_file) == a_side for other in scan_reversed(other_rooks)):             # <<<<<<<<<<<<<<
 *                     ch = FILE_NAMES[rook_file]
 *                 else:
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *__pyx_outer_scope;
  PyObject *__pyx_v_other;
};


/* "chess/__init__cp.pyx":2493
 *         return operations
 * 
 *     def set_epd(self, epd):             # <<<<<<<<<<<<<<
 *         """
 *         Parses the given EPD string and uses it to set the position.
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd {
  PyObject_HEAD
  PyObject *__pyx_v_parts;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
};


/* "chess/__init__cp.pyx":2659
 *         return " ".join(san)
 * 
 *     def parse_san(self, san):             # <<<<<<<<<<<<<<
 *         """
 *         Uses the current position as the context to parse a move in standard
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
};


/* "chess/__init__cp.pyx":2671
 *         try:
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))             # <<<<<<<<<<<<<<
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *__pyx_outer_scope;
  PyObject *__pyx_v_move;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":2673
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))             # <<<<<<<<<<<<<<
 *         except StopIteration:
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *__pyx_outer_scope;
  PyObject *__pyx_v_move;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":3133
 *                     BB_RAYS[move.from_square][move.to_square] & BB_SQUARES[king])
 * 
 *     def _generate_evasions(self, king, checkers, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         sliders = checkers & (self.bishops | self.rooks | self.queens)
 * 
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions {
  PyObject_HEAD
  PyObject *__pyx_v_attacked;
  PyObject *__pyx_v_checker;
  PyObject *__pyx_v_checkers;
  PyObject *__pyx_v_from_mask;
  PyObject *__pyx_v_king;
  PyObject *__pyx_v_last_double;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
  PyObject *__pyx_v_sliders;
  PyObject *__pyx_v_target;
  PyObject *__pyx_v_to_mask;
  PyObject *__pyx_v_to_square;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":3158
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves {
  PyObject_HEAD
  PyObject *__pyx_v_blockers;
  PyObject *__pyx_v_checkers;
  PyObject *__pyx_v_from_mask;
  PyObject *__pyx_v_king;
  unsigned PY_LONG_LONG __pyx_v_king_mask;
  PyObject *__pyx_v_move;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
  PyObject *__pyx_v_to_mask;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":3178
 *             yield from self.generate_pseudo_legal_moves(from_mask, to_mask)
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep {
  PyObject_HEAD
  PyObject *__pyx_v_from_mask;
  PyObject *__pyx_v_move;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
  PyObject *__pyx_v_to_mask;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":3191
 *             self.generate_legal_ep(from_mask, to_mask))
 * 
 *     def _attacked_for_king(self, path, occupied):             # <<<<<<<<<<<<<<
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))
 * 
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king {
  PyObject_HEAD
  PyObject *__pyx_v_occupied;
  PyObject *__pyx_v_path;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
};


/* "chess/__init__cp.pyx":3192
 * 
 *     def _attacked_for_king(self, path, occupied):
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))             # <<<<<<<<<<<<<<
 * 
 *     def _castling_uncovers_rank_attack(self, rook_bb, king_to):
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *__pyx_outer_scope;
  PyObject *__pyx_v_sq;
};


/* "chess/__init__cp.pyx":3201
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves {
  PyObject_HEAD
  PyObject *__pyx_v_a_side;
  PyObject *__pyx_v_backrank;
  PyObject *__pyx_v_bb_c;
  PyObject *__pyx_v_bb_d;
  PyObject *__pyx_v_bb_f;
  PyObject *__pyx_v_bb_g;
  PyObject *__pyx_v_candidate;
  PyObject *__pyx_v_empty_for_king;
  PyObject *__pyx_v_empty_for_rook;
  PyObject *__pyx_v_from_mask;
  PyObject *__pyx_v_king;
  PyObject *__pyx_v_king_to;
  PyObject *__pyx_v_rook;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self;
  PyObject *__pyx_v_to_mask;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "chess/__init__cp.pyx":3413
 *         return self.board.is_legal(move)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         sans = ", ".join(self.board.san(move) for move in self)
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self;
};


/* "chess/__init__cp.pyx":3414
 * 
 *     def __repr__(self):
 *         sans = ", ".join(self.board.san(move) for move in self)             # <<<<<<<<<<<<<<
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 * 
 */
struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr {
  PyObject_HEAD
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *__pyx_outer_scope;
  PyObject *__pyx_v_move;
};


/* --- Runtime support code (head) --- */
/* Refnanny.proto */
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          if (acquire_gil) {\
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
              PyGILState_Release(__pyx_gilstate_save);\
          } else {\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
#endif
  #define __Pyx_RefNannyFinishContext()\
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif
#define __Pyx_XDECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_XDECREF(tmp);\
    } while (0)
#define __Pyx_DECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_DECREF(tmp);\
    } while (0)
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

/* PyObjectGetAttrStr.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

/* GetBuiltinName.proto */
static PyObject *__Pyx_GetBuiltinName(PyObject *name);

/* RaiseArgTupleInvalid.proto */
static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);

/* RaiseDoubleKeywords.proto */
static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);

/* ParseKeywords.proto */
static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
    const char* function_name);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AndObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_AndObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceAnd(op1, op2) : PyNumber_And(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_RshiftObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_RshiftObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceRshift(op1, op2) : PyNumber_Rshift(op1, op2))
#endif

/* PyDictVersioning.proto */
#if CYTHON_USE_DICT_VERSIONS
#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
    (version_var) = __PYX_GET_DICT_VERSION(dict);\
    (cache_var) = (value);
#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
    static PY_UINT64_T __pyx_dict_version = 0;\
    static PyObject *__pyx_dict_cached_value = NULL;\
    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
        (VAR) = __pyx_dict_cached_value;\
    } else {\
        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
    }\
}
static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
#else
#define __PYX_GET_DICT_VERSION(dict)  (0)
#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
#endif

/* GetModuleGlobalName.proto */
#if CYTHON_USE_DICT_VERSIONS
#define __Pyx_GetModuleGlobalName(var, name)  {\
    static PY_UINT64_T __pyx_dict_version = 0;\
    static PyObject *__pyx_dict_cached_value = NULL;\
    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
}
#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
    PY_UINT64_T __pyx_dict_version;\
    PyObject *__pyx_dict_cached_value;\
    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
}
static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
#else
#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
#endif

/* GetItemInt.proto */
#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck);

/* ObjectGetItem.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key);
#else
#define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
#endif

/* py_abs.proto */
#if CYTHON_USE_PYLONG_INTERNALS
static PyObject *__Pyx_PyLong_AbsNeg(PyObject *num);
#define __Pyx_PyNumber_Absolute(x)\
    ((likely(PyLong_CheckExact(x))) ?\
         (likely(Py_SIZE(x) >= 0) ? (Py_INCREF(x), (x)) : __Pyx_PyLong_AbsNeg(x)) :\
         PyNumber_Absolute(x))
#else
#define __Pyx_PyNumber_Absolute(x)  PyNumber_Absolute(x)
#endif

/* PyCFunctionFastCall.proto */
#if CYTHON_FAST_PYCCALL
static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
#else
#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
#endif

/* PyFunctionFastCall.proto */
#if CYTHON_FAST_PYCALL
#define __Pyx_PyFunction_FastCall(func, args, nargs)\
    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
#if 1 || PY_VERSION_HEX < 0x030600B1
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, int nargs, PyObject *kwargs);
#else
#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
#endif
#define __Pyx_BUILD_ASSERT_EXPR(cond)\
    (sizeof(char [1 - 2*!(cond)]) - 1)
#ifndef Py_MEMBER_SIZE
#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
#endif
  static size_t __pyx_pyframe_localsplus_offset = 0;
  #include "frameobject.h"
  #define __Pxy_PyFrame_Initialize_Offsets()\
    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
  #define __Pyx_PyFrame_GetLocalsplus(frame)\
    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
#endif

/* PyObjectCall.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
#else
#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
#endif

/* PyObjectCall2Args.proto */
static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);

/* PyObjectCallMethO.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
#endif

/* PyObjectCallOneArg.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_XorObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_XorObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceXor(op1, op2) : PyNumber_Xor(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_SubtractObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceSubtract(op1, op2) : PyNumber_Subtract(op1, op2))
#endif

/* PyObjectCallNoArg.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
#else
#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_LshiftObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_LshiftObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceLshift(op1, op2) : PyNumber_Lshift(op1, op2))
#endif

/* ListAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_AddObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceAdd(op1, op2) : PyNumber_Add(op1, op2))
#endif

/* PyObjectSetAttrStr.proto */
#if CYTHON_USE_TYPE_SLOTS
#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o, n, NULL)
static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value);
#else
#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
#endif

/* Import.proto */
static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);

/* GetTopmostException.proto */
#if CYTHON_USE_EXC_INFO_STACK
static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
#endif

/* PyThreadStateGet.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
#else
#define __Pyx_PyThreadState_declare
#define __Pyx_PyThreadState_assign
#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
#endif

/* SaveResetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
#else
#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
#endif

/* PyErrExceptionMatches.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
#else
#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
#endif

/* GetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
#endif

/* IncludeStringH.proto */
#include <string.h>

/* BytesEquals.proto */
static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);

/* UnicodeEquals.proto */
static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);

/* SliceObject.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
        int has_cstart, int has_cstop, int wraparound);

/* PyErrFetchRestore.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
#else
#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
#endif
#else
#define __Pyx_PyErr_Clear() PyErr_Clear()
#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
#endif

/* RaiseException.proto */
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);

/* GetAttr.proto */
static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *, PyObject *);

/* GetAttr3.proto */
static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);

/* ArgTypeTest.proto */
#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
        __Pyx__ArgTypeTest(obj, type, name, exact))
static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);

/* RaiseTooManyValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);

/* RaiseNeedMoreValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

/* RaiseNoneIterError.proto */
static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);

/* PySequenceContains.proto */
static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* PyIntCompare.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_NeObjC(PyObject *op1, PyObject *op2, long intval, long inplace);

/* IterFinish.proto */
static CYTHON_INLINE int __Pyx_IterFinish(void);

/* PyObjectGetMethod.proto */
static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);

/* PyObjectCallMethod0.proto */
static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);

/* UnpackItemEndCheck.proto */
static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);

/* UnpackTupleError.proto */
static void __Pyx_UnpackTupleError(PyObject *, Py_ssize_t index);

/* UnpackTuple2.proto */
#define __Pyx_unpack_tuple2(tuple, value1, value2, is_tuple, has_known_size, decref_tuple)\
    (likely(is_tuple || PyTuple_Check(tuple)) ?\
        (likely(has_known_size || PyTuple_GET_SIZE(tuple) == 2) ?\
            __Pyx_unpack_tuple2_exact(tuple, value1, value2, decref_tuple) :\
            (__Pyx_UnpackTupleError(tuple, 2), -1)) :\
        __Pyx_unpack_tuple2_generic(tuple, value1, value2, has_known_size, decref_tuple))
static CYTHON_INLINE int __Pyx_unpack_tuple2_exact(
    PyObject* tuple, PyObject** value1, PyObject** value2, int decref_tuple);
static int __Pyx_unpack_tuple2_generic(
    PyObject* tuple, PyObject** value1, PyObject** value2, int has_known_size, int decref_tuple);

/* dict_iter.proto */
static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* dict, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_is_dict);
static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* dict_or_iter, Py_ssize_t orig_length, Py_ssize_t* ppos,
                                              PyObject** pkey, PyObject** pvalue, PyObject** pitem, int is_dict);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_FloorDivideObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_FloorDivideObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceFloorDivide(op1, op2) : PyNumber_FloorDivide(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_SubtractCObj(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceSubtract(op1, op2) : PyNumber_Subtract(op1, op2))
#endif

/* PyIntCompare.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);

/* None.proto */
static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname);

/* SetItemInt.proto */
#define __Pyx_SetItemInt(o, i, v, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_SetItemInt_Fast(o, (Py_ssize_t)i, v, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list assignment index out of range"), -1) :\
               __Pyx_SetItemInt_Generic(o, to_py_func(i), v)))
static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v);
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
                                               int is_list, int wraparound, int boundscheck);

/* SliceObject.proto */
#define __Pyx_PyObject_DelSlice(obj, cstart, cstop, py_start, py_stop, py_slice, has_cstart, has_cstop, wraparound)\
    __Pyx_PyObject_SetSlice(obj, (PyObject*)NULL, cstart, cstop, py_start, py_stop, py_slice, has_cstart, has_cstop, wraparound)
static CYTHON_INLINE int __Pyx_PyObject_SetSlice(
        PyObject* obj, PyObject* value, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
        int has_cstart, int has_cstop, int wraparound);

/* FetchCommonType.proto */
static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);

/* SwapException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
#endif

/* PyObjectCallMethod1.proto */
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);

/* CoroutineBase.proto */
typedef PyObject *(*__pyx_coroutine_body_t)(PyObject *, PyThreadState *, PyObject *);
#if CYTHON_USE_EXC_INFO_STACK
#define __Pyx_ExcInfoStruct  _PyErr_StackItem
#else
typedef struct {
    PyObject *exc_type;
    PyObject *exc_value;
    PyObject *exc_traceback;
} __Pyx_ExcInfoStruct;
#endif
typedef struct {
    PyObject_HEAD
    __pyx_coroutine_body_t body;
    PyObject *closure;
    __Pyx_ExcInfoStruct gi_exc_state;
    PyObject *gi_weakreflist;
    PyObject *classobj;
    PyObject *yieldfrom;
    PyObject *gi_name;
    PyObject *gi_qualname;
    PyObject *gi_modulename;
    PyObject *gi_code;
    int resume_label;
    char is_running;
} __pyx_CoroutineObject;
static __pyx_CoroutineObject *__Pyx__Coroutine_New(
    PyTypeObject *type, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
    PyObject *name, PyObject *qualname, PyObject *module_name);
static __pyx_CoroutineObject *__Pyx__Coroutine_NewInit(
            __pyx_CoroutineObject *gen, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
            PyObject *name, PyObject *qualname, PyObject *module_name);
static CYTHON_INLINE void __Pyx_Coroutine_ExceptionClear(__Pyx_ExcInfoStruct *self);
static int __Pyx_Coroutine_clear(PyObject *self);
static PyObject *__Pyx_Coroutine_Send(PyObject *self, PyObject *value);
static PyObject *__Pyx_Coroutine_Close(PyObject *self);
static PyObject *__Pyx_Coroutine_Throw(PyObject *gen, PyObject *args);
#if CYTHON_USE_EXC_INFO_STACK
#define __Pyx_Coroutine_SwapException(self)
#define __Pyx_Coroutine_ResetAndClearException(self)  __Pyx_Coroutine_ExceptionClear(&(self)->gi_exc_state)
#else
#define __Pyx_Coroutine_SwapException(self) {\
    __Pyx_ExceptionSwap(&(self)->gi_exc_state.exc_type, &(self)->gi_exc_state.exc_value, &(self)->gi_exc_state.exc_traceback);\
    __Pyx_Coroutine_ResetFrameBackpointer(&(self)->gi_exc_state);\
    }
#define __Pyx_Coroutine_ResetAndClearException(self) {\
    __Pyx_ExceptionReset((self)->gi_exc_state.exc_type, (self)->gi_exc_state.exc_value, (self)->gi_exc_state.exc_traceback);\
    (self)->gi_exc_state.exc_type = (self)->gi_exc_state.exc_value = (self)->gi_exc_state.exc_traceback = NULL;\
    }
#endif
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyGen_FetchStopIterationValue(pvalue)\
    __Pyx_PyGen__FetchStopIterationValue(__pyx_tstate, pvalue)
#else
#define __Pyx_PyGen_FetchStopIterationValue(pvalue)\
    __Pyx_PyGen__FetchStopIterationValue(__Pyx_PyThreadState_Current, pvalue)
#endif
static int __Pyx_PyGen__FetchStopIterationValue(PyThreadState *tstate, PyObject **pvalue);
static CYTHON_INLINE void __Pyx_Coroutine_ResetFrameBackpointer(__Pyx_ExcInfoStruct *exc_state);

/* PyObject_GenericGetAttrNoDict.proto */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GenericGetAttrNoDict PyObject_GenericGetAttr
#endif

/* PatchModuleWithCoroutine.proto */
static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code);

/* PatchGeneratorABC.proto */
static int __Pyx_patch_abc(void);

/* Generator.proto */
#define __Pyx_Generator_USED
static PyTypeObject *__pyx_GeneratorType = 0;
#define __Pyx_Generator_CheckExact(obj) (Py_TYPE(obj) == __pyx_GeneratorType)
#define __Pyx_Generator_New(body, code, closure, name, qualname, module_name)\
    __Pyx__Coroutine_New(__pyx_GeneratorType, body, code, closure, name, qualname, module_name)
static PyObject *__Pyx_Generator_Next(PyObject *self);
static int __pyx_Generator_init(void);

/* GeneratorYieldFrom.proto */
static CYTHON_INLINE PyObject* __Pyx_Generator_Yield_From(__pyx_CoroutineObject *gen, PyObject *source);

/* pop.proto */
static CYTHON_INLINE PyObject* __Pyx__PyObject_Pop(PyObject* L);
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE PyObject* __Pyx_PyList_Pop(PyObject* L);
#define __Pyx_PyObject_Pop(L) (likely(PyList_CheckExact(L)) ?\
    __Pyx_PyList_Pop(L) : __Pyx__PyObject_Pop(L))
#else
#define __Pyx_PyList_Pop(L)  __Pyx__PyObject_Pop(L)
#define __Pyx_PyObject_Pop(L)  __Pyx__PyObject_Pop(L)
#endif

/* UnpackUnboundCMethod.proto */
typedef struct {
    PyObject *type;
    PyObject **method_name;
    PyCFunction func;
    PyObject *method;
    int flag;
} __Pyx_CachedCFunction;

/* CallUnboundCMethod0.proto */
static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self);
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_CallUnboundCMethod0(cfunc, self)\
    (likely((cfunc)->func) ?\
        (likely((cfunc)->flag == METH_NOARGS) ?  (*((cfunc)->func))(self, NULL) :\
         (PY_VERSION_HEX >= 0x030600B1 && likely((cfunc)->flag == METH_FASTCALL) ?\
            (PY_VERSION_HEX >= 0x030700A0 ?\
                (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0) :\
                (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0, NULL)) :\
          (PY_VERSION_HEX >= 0x030700A0 && (cfunc)->flag == (METH_FASTCALL | METH_KEYWORDS) ?\
            (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0, NULL) :\
            (likely((cfunc)->flag == (METH_VARARGS | METH_KEYWORDS)) ?  ((*(PyCFunctionWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, __pyx_empty_tuple, NULL)) :\
               ((cfunc)->flag == METH_VARARGS ?  (*((cfunc)->func))(self, __pyx_empty_tuple) :\
               __Pyx__CallUnboundCMethod0(cfunc, self)))))) :\
        __Pyx__CallUnboundCMethod0(cfunc, self))
#else
#define __Pyx_CallUnboundCMethod0(cfunc, self)  __Pyx__CallUnboundCMethod0(cfunc, self)
#endif

/* append.proto */
static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x);

/* None.proto */
static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);

/* HasAttr.proto */
static CYTHON_INLINE int __Pyx_HasAttr(PyObject *, PyObject *);

/* IterNext.proto */
#define __Pyx_PyIter_Next(obj) __Pyx_PyIter_Next2(obj, NULL)
static CYTHON_INLINE PyObject *__Pyx_PyIter_Next2(PyObject *, PyObject *);

/* PyUnicodeContains.proto */
static CYTHON_INLINE int __Pyx_PyUnicode_ContainsTF(PyObject* substring, PyObject* text, int eq) {
    int result = PyUnicode_Contains(text, substring);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* DictGetItem.proto */
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key);
#define __Pyx_PyObject_Dict_GetItem(obj, name)\
    (likely(PyDict_CheckExact(obj)) ?\
     __Pyx_PyDict_GetItem(obj, name) : PyObject_GetItem(obj, name))
#else
#define __Pyx_PyDict_GetItem(d, key) PyObject_GetItem(d, key)
#define __Pyx_PyObject_Dict_GetItem(obj, name)  PyObject_GetItem(obj, name)
#endif

/* ListCompAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_ListComp_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len)) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_ListComp_Append(L,x) PyList_Append(L,x)
#endif

/* CythonFunction.proto */
#define __Pyx_CyFunction_USED 1
#define __Pyx_CYFUNCTION_STATICMETHOD  0x01
#define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
#define __Pyx_CYFUNCTION_CCLASS        0x04
#define __Pyx_CyFunction_GetClosure(f)\
    (((__pyx_CyFunctionObject *) (f))->func_closure)
#define __Pyx_CyFunction_GetClassObj(f)\
    (((__pyx_CyFunctionObject *) (f))->func_classobj)
#define __Pyx_CyFunction_Defaults(type, f)\
    ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
#define __Pyx_CyFunction_SetDefaultsGetter(f, g)\
    ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
typedef struct {
    PyCFunctionObject func;
#if PY_VERSION_HEX < 0x030500A0
    PyObject *func_weakreflist;
#endif
    PyObject *func_dict;
    PyObject *func_name;
    PyObject *func_qualname;
    PyObject *func_doc;
    PyObject *func_globals;
    PyObject *func_code;
    PyObject *func_closure;
    PyObject *func_classobj;
    void *defaults;
    int defaults_pyobjects;
    int flags;
    PyObject *defaults_tuple;
    PyObject *defaults_kwdict;
    PyObject *(*defaults_getter)(PyObject *);
    PyObject *func_annotations;
} __pyx_CyFunctionObject;
static PyTypeObject *__pyx_CyFunctionType = 0;
#define __Pyx_CyFunction_Check(obj)  (__Pyx_TypeCheck(obj, __pyx_CyFunctionType))
#define __Pyx_CyFunction_NewEx(ml, flags, qualname, self, module, globals, code)\
    __Pyx_CyFunction_New(__pyx_CyFunctionType, ml, flags, qualname, self, module, globals, code)
static PyObject *__Pyx_CyFunction_New(PyTypeObject *, PyMethodDef *ml,
                                      int flags, PyObject* qualname,
                                      PyObject *self,
                                      PyObject *module, PyObject *globals,
                                      PyObject* code);
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
                                                         size_t size,
                                                         int pyobjects);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
                                                            PyObject *tuple);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
                                                             PyObject *dict);
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
                                                              PyObject *dict);
static int __pyx_CyFunction_init(void);

/* ImportFrom.proto */
static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);

/* ExtTypeTest.proto */
static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);

/* PyObject_GenericGetAttr.proto */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GenericGetAttr PyObject_GenericGetAttr
#endif

/* SetupReduce.proto */
static int __Pyx_setup_reduce(PyObject* type_obj);

/* CalculateMetaclass.proto */
static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases);

/* SetNameInClass.proto */
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
#define __Pyx_SetNameInClass(ns, name, value)\
    (likely(PyDict_CheckExact(ns)) ? _PyDict_SetItem_KnownHash(ns, name, value, ((PyASCIIObject *) name)->hash) : PyObject_SetItem(ns, name, value))
#elif CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_SetNameInClass(ns, name, value)\
    (likely(PyDict_CheckExact(ns)) ? PyDict_SetItem(ns, name, value) : PyObject_SetItem(ns, name, value))
#else
#define __Pyx_SetNameInClass(ns, name, value)  PyObject_SetItem(ns, name, value)
#endif

/* Py3ClassCreate.proto */
static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name, PyObject *qualname,
                                           PyObject *mkw, PyObject *modname, PyObject *doc);
static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases, PyObject *dict,
                                      PyObject *mkw, int calculate_metaclass, int allow_py2_metaclass);

/* ClassMethod.proto */
#include "descrobject.h"
static PyObject* __Pyx_Method_ClassMethod(PyObject *method);

/* GetNameInClass.proto */
#define __Pyx_GetNameInClass(var, nmspace, name)  (var) = __Pyx__GetNameInClass(nmspace, name)
static PyObject *__Pyx__GetNameInClass(PyObject *nmspace, PyObject *name);

/* CLineInTraceback.proto */
#ifdef CYTHON_CLINE_IN_TRACEBACK
#define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
#else
static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
#endif

/* CodeObjectCache.proto */
typedef struct {
    PyCodeObject* code_object;
    int code_line;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);

/* AddTraceback.proto */
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_PY_LONG_LONG(unsigned PY_LONG_LONG value);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);

/* CIntFromPy.proto */
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);

/* CIntFromPy.proto */
static CYTHON_INLINE unsigned PY_LONG_LONG __Pyx_PyInt_As_unsigned_PY_LONG_LONG(PyObject *);

/* CIntFromPy.proto */
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);

/* CIntFromPy.proto */
static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);

/* FastTypeChecks.proto */
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
#else
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
#define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
#endif
#define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)

/* CheckBinaryVersion.proto */
static int __Pyx_check_binary_version(void);

/* InitStrings.proto */
static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);


/* Module declarations from 'chess.__init__cp' */
static PyTypeObject *__pyx_ptype_5chess_10__init__cp_Move = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp_BaseBoard = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp_Board = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp_PseudoLegalMoveGenerator = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp_LegalMoveGenerator = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct__scan_forward = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_6_genexpr = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_7_set_epd = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_8_parse_san = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_9_genexpr = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_10_genexpr = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_15_genexpr = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_17___repr__ = 0;
static PyTypeObject *__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_18_genexpr = 0;
static int __pyx_v_5chess_10__init__cp_COLORS[2];
static char **__pyx_v_5chess_10__init__cp_COLOR_NAMES;
static int __pyx_v_5chess_10__init__cp_Color;
static unsigned PY_LONG_LONG __pyx_v_5chess_10__init__cp_BB_EMPTY;
static unsigned PY_LONG_LONG __pyx_v_5chess_10__init__cp_BB_ALL;
static PyObject *__pyx_7genexpr__pyx_v_5chess_10__init__cp_r;
static PyObject *__pyx_7genexpr__pyx_v_5chess_10__init__cp_f;
static PyObject *__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq;
static PyObject *__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq;
static PyObject *__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i;
static PyObject *__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i;
static PyObject *__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq;
static PyObject *__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq;
static PyObject *__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas;
static PyObject *__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq;
static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_Move__set_state(struct __pyx_obj_5chess_10__init__cp_Move *, PyObject *); /*proto*/
static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_BaseBoard__set_state(struct __pyx_obj_5chess_10__init__cp_BaseBoard *, PyObject *); /*proto*/
static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_Board__set_state(struct __pyx_obj_5chess_10__init__cp_Board *, PyObject *); /*proto*/
static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_PseudoLegalMoveGenerator__set_state(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *, PyObject *); /*proto*/
static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_LegalMoveGenerator__set_state(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *, PyObject *); /*proto*/
static CYTHON_INLINE PyObject *__Pyx_carray_to_py_unsigned_PY_LONG_LONG(unsigned PY_LONG_LONG *, Py_ssize_t); /*proto*/
static CYTHON_INLINE PyObject *__Pyx_carray_to_tuple_unsigned_PY_LONG_LONG(unsigned PY_LONG_LONG *, Py_ssize_t); /*proto*/
static int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(PyObject *, unsigned PY_LONG_LONG *, Py_ssize_t); /*proto*/
#define __Pyx_MODULE_NAME "chess.__init__cp"
extern int __pyx_module_is_main_chess____init__cp;
int __pyx_module_is_main_chess____init__cp = 0;

/* Implementation of 'chess.__init__cp' */
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_AttributeError;
static PyObject *__pyx_builtin_bin;
static PyObject *__pyx_builtin_enumerate;
static PyObject *__pyx_builtin_NotImplemented;
static PyObject *__pyx_builtin_id;
static PyObject *__pyx_builtin_ValueError;
static PyObject *__pyx_builtin_print;
static PyObject *__pyx_builtin_super;
static PyObject *__pyx_builtin_any;
static PyObject *__pyx_builtin_StopIteration;
static PyObject *__pyx_builtin_hex;
static PyObject *__pyx_builtin_KeyError;
static PyObject *__pyx_builtin_TypeError;
static PyObject *__pyx_builtin_OverflowError;
static PyObject *__pyx_builtin_IndexError;
static const char __pyx_k_0[] = "0";
static const char __pyx_k_1[] = "1";
static const char __pyx_k_2[] = "2";
static const char __pyx_k_3[] = "3";
static const char __pyx_k_4[] = "4";
static const char __pyx_k_5[] = "5";
static const char __pyx_k_6[] = "6";
static const char __pyx_k_7[] = "7";
static const char __pyx_k_8[] = "8";
static const char __pyx_k_B[] = "B";
static const char __pyx_k_K[] = "K";
static const char __pyx_k_N[] = "N";
static const char __pyx_k_P[] = "P";
static const char __pyx_k_Q[] = "Q";
static const char __pyx_k_R[] = "R";
static const char __pyx_k_a[] = "a";
static const char __pyx_k_b[] = "b";
static const char __pyx_k_c[] = "c";
static const char __pyx_k_d[] = "d";
static const char __pyx_k_e[] = "e";
static const char __pyx_k_f[] = "f";
static const char __pyx_k_g[] = "g";
static const char __pyx_k_h[] = "h";
static const char __pyx_k_k[] = "k";
static const char __pyx_k_l[] = "l";
static const char __pyx_k_n[] = "n";
static const char __pyx_k_p[] = "p";
static const char __pyx_k_q[] = "q";
static const char __pyx_k_r[] = "r";
static const char __pyx_k_t[] = "t";
static const char __pyx_k_w[] = "w";
static const char __pyx_k_x[] = "x";
static const char __pyx_k_A1[] = "A1";
static const char __pyx_k_A2[] = "A2";
static const char __pyx_k_A3[] = "A3";
static const char __pyx_k_A4[] = "A4";
static const char __pyx_k_A5[] = "A5";
static const char __pyx_k_A6[] = "A6";
static const char __pyx_k_A7[] = "A7";
static const char __pyx_k_A8[] = "A8";
static const char __pyx_k_B1[] = "B1";
static const char __pyx_k_B2[] = "B2";
static const char __pyx_k_B3[] = "B3";
static const char __pyx_k_B4[] = "B4";
static const char __pyx_k_B5[] = "B5";
static const char __pyx_k_B6[] = "B6";
static const char __pyx_k_B7[] = "B7";
static const char __pyx_k_B8[] = "B8";
static const char __pyx_k_C1[] = "C1";
static const char __pyx_k_C2[] = "C2";
static const char __pyx_k_C3[] = "C3";
static const char __pyx_k_C4[] = "C4";
static const char __pyx_k_C5[] = "C5";
static const char __pyx_k_C6[] = "C6";
static const char __pyx_k_C7[] = "C7";
static const char __pyx_k_C8[] = "C8";
static const char __pyx_k_D1[] = "D1";
static const char __pyx_k_D2[] = "D2";
static const char __pyx_k_D3[] = "D3";
static const char __pyx_k_D4[] = "D4";
static const char __pyx_k_D5[] = "D5";
static const char __pyx_k_D6[] = "D6";
static const char __pyx_k_D7[] = "D7";
static const char __pyx_k_D8[] = "D8";
static const char __pyx_k_E1[] = "E1";
static const char __pyx_k_E2[] = "E2";
static const char __pyx_k_E3[] = "E3";
static const char __pyx_k_E4[] = "E4";
static const char __pyx_k_E5[] = "E5";
static const char __pyx_k_E6[] = "E6";
static const char __pyx_k_E7[] = "E7";
static const char __pyx_k_E8[] = "E8";
static const char __pyx_k_F1[] = "F1";
static const char __pyx_k_F2[] = "F2";
static const char __pyx_k_F3[] = "F3";
static const char __pyx_k_F4[] = "F4";
static const char __pyx_k_F5[] = "F5";
static const char __pyx_k_F6[] = "F6";
static const char __pyx_k_F7[] = "F7";
static const char __pyx_k_F8[] = "F8";
static const char __pyx_k_G1[] = "G1";
static const char __pyx_k_G2[] = "G2";
static const char __pyx_k_G3[] = "G3";
static const char __pyx_k_G4[] = "G4";
static const char __pyx_k_G5[] = "G5";
static const char __pyx_k_G6[] = "G6";
static const char __pyx_k_G7[] = "G7";
static const char __pyx_k_G8[] = "G8";
static const char __pyx_k_H1[] = "H1";
static const char __pyx_k_H2[] = "H2";
static const char __pyx_k_H3[] = "H3";
static const char __pyx_k_H4[] = "H4";
static const char __pyx_k_H5[] = "H5";
static const char __pyx_k_H6[] = "H6";
static const char __pyx_k_H7[] = "H7";
static const char __pyx_k_H8[] = "H8";
static const char __pyx_k_Z0[] = "Z0";
static const char __pyx_k__5[] = "@";
static const char __pyx_k_am[] = "am";
static const char __pyx_k_bb[] = "bb";
static const char __pyx_k_bm[] = "bm";
static const char __pyx_k_eq[] = "__eq__";
static const char __pyx_k_id[] = "id";
static const char __pyx_k_ne[] = "__ne__";
static const char __pyx_k_or[] = "__or__";
static const char __pyx_k_pv[] = "pv";
static const char __pyx_k_re[] = "re";
static const char __pyx_k_sq[] = "sq";
static const char __pyx_k_0_1[] = "0-1";
static const char __pyx_k_1_0[] = "1-0";
static const char __pyx_k_O_O[] = "O-O";
static const char __pyx_k__11[] = "~";
static const char __pyx_k__12[] = "/";
static const char __pyx_k__13[] = "";
static const char __pyx_k__14[] = " ";
static const char __pyx_k__15[] = "{}('{}')";
static const char __pyx_k__16[] = "_+_+_+_+_+_+_+_+_+_+_";
static const char __pyx_k__18[] = ".";
static const char __pyx_k__19[] = "\n";
static const char __pyx_k__20[] = "  ";
static const char __pyx_k__21[] = "-----------------";
static const char __pyx_k__22[] = "|";
static const char __pyx_k__23[] = "\302\267";
static const char __pyx_k__33[] = "*";
static const char __pyx_k__34[] = "-";
static const char __pyx_k__35[] = ";";
static const char __pyx_k__36[] = " \"";
static const char __pyx_k__37[] = "\r";
static const char __pyx_k__38[] = "\\";
static const char __pyx_k__39[] = "\\\\";
static const char __pyx_k__40[] = "\"";
static const char __pyx_k__41[] = "\\\"";
static const char __pyx_k__42[] = "\";";
static const char __pyx_k__44[] = "--";
static const char __pyx_k__45[] = "#";
static const char __pyx_k__46[] = "+";
static const char __pyx_k__47[] = "=";
static const char __pyx_k__48[] = "{}. {}";
static const char __pyx_k__49[] = "{}...{}";
static const char __pyx_k__60[] = ", ";
static const char __pyx_k__62[] = "+_+_+_+_+_+_+_+_+_+_+_+";
static const char __pyx_k__65[] = "\342\231\226";
static const char __pyx_k__66[] = "\342\231\234";
static const char __pyx_k__67[] = "\342\231\230";
static const char __pyx_k__68[] = "\342\231\236";
static const char __pyx_k__69[] = "\342\231\227";
static const char __pyx_k__70[] = "\342\231\235";
static const char __pyx_k__71[] = "\342\231\225";
static const char __pyx_k__72[] = "\342\231\233";
static const char __pyx_k__73[] = "\342\231\224";
static const char __pyx_k__74[] = "\342\231\232";
static const char __pyx_k__75[] = "\342\231\231";
static const char __pyx_k__76[] = "\342\231\237";
static const char __pyx_k_abc[] = "abc";
static const char __pyx_k_add[] = "add";
static const char __pyx_k_and[] = "__and__";
static const char __pyx_k_any[] = "any";
static const char __pyx_k_bin[] = "bin";
static const char __pyx_k_cls[] = "cls";
static const char __pyx_k_doc[] = "__doc__";
static const char __pyx_k_epd[] = "epd";
static const char __pyx_k_f_2[] = "\327f\014\245";
static const char __pyx_k_fen[] = "fen";
static const char __pyx_k_hex[] = "hex";
static const char __pyx_k_int[] = "__int__";
static const char __pyx_k_ior[] = "__ior__";
static const char __pyx_k_len[] = "__len__";
static const char __pyx_k_lsb[] = "lsb";
static const char __pyx_k_msb[] = "msb";
static const char __pyx_k_new[] = "__new__";
static const char __pyx_k_pop[] = "pop";
static const char __pyx_k_q_2[] = "q\350#]";
static const char __pyx_k_san[] = "san";
static const char __pyx_k_str[] = "__str__";
static const char __pyx_k_sub[] = "__sub__";
static const char __pyx_k_svg[] = "svg";
static const char __pyx_k_uci[] = "uci";
static const char __pyx_k_xor[] = "__xor__";
static const char __pyx_k_0000[] = "0000";
static const char __pyx_k_KING[] = "KING";
static const char __pyx_k_Move[] = "Move";
static const char __pyx_k_PAWN[] = "PAWN";
static const char __pyx_k_ROOK[] = "ROOK";
static const char __pyx_k_args[] = "args";
static const char __pyx_k_bb_a[] = "bb_a";
static const char __pyx_k_bb_b[] = "bb_b";
static const char __pyx_k_bool[] = "__bool__";
static const char __pyx_k_copy[] = "__copy__";
static const char __pyx_k_dict[] = "__dict__";
static const char __pyx_k_drop[] = "drop";
static const char __pyx_k_enum[] = "enum";
static const char __pyx_k_fmvn[] = "fmvn";
static const char __pyx_k_hash[] = "__hash__";
static const char __pyx_k_hmvc[] = "hmvc";
static const char __pyx_k_iand[] = "__iand__";
static const char __pyx_k_init[] = "__init__";
static const char __pyx_k_isub[] = "__isub__";
static const char __pyx_k_iter[] = "__iter__";
static const char __pyx_k_ixor[] = "__ixor__";
static const char __pyx_k_king[] = "king";
static const char __pyx_k_main[] = "__main__";
static const char __pyx_k_mask[] = "mask";
static const char __pyx_k_move[] = "move";
static const char __pyx_k_name[] = "__name__";
static const char __pyx_k_ne_2[] = "ne";
static const char __pyx_k_null[] = "null";
static const char __pyx_k_path[] = "path";
static const char __pyx_k_pawn[] = "pawn";
static const char __pyx_k_peek[] = "peek";
static const char __pyx_k_push[] = "push";
static const char __pyx_k_rays[] = "rays";
static const char __pyx_k_repr[] = "__repr__";
static const char __pyx_k_rook[] = "rook";
static const char __pyx_k_rtbw[] = ".rtbw";
static const char __pyx_k_rtbz[] = ".rtbz";
static const char __pyx_k_self[] = "self";
static const char __pyx_k_send[] = "send";
static const char __pyx_k_size[] = "size";
static const char __pyx_k_test[] = "__test__";
static const char __pyx_k_turn[] = "turn";
static const char __pyx_k_xfen[] = "xfen";
static const char __pyx_k_0_1_2[] = " 0 1";
static const char __pyx_k_BB_A1[] = "BB_A1";
static const char __pyx_k_BB_A2[] = "BB_A2";
static const char __pyx_k_BB_A3[] = "BB_A3";
static const char __pyx_k_BB_A4[] = "BB_A4";
static const char __pyx_k_BB_A5[] = "BB_A5";
static const char __pyx_k_BB_A6[] = "BB_A6";
static const char __pyx_k_BB_A7[] = "BB_A7";
static const char __pyx_k_BB_A8[] = "BB_A8";
static const char __pyx_k_BB_B1[] = "BB_B1";
static const char __pyx_k_BB_B2[] = "BB_B2";
static const char __pyx_k_BB_B3[] = "BB_B3";
static const char __pyx_k_BB_B4[] = "BB_B4";
static const char __pyx_k_BB_B5[] = "BB_B5";
static const char __pyx_k_BB_B6[] = "BB_B6";
static const char __pyx_k_BB_B7[] = "BB_B7";
static const char __pyx_k_BB_B8[] = "BB_B8";
static const char __pyx_k_BB_C1[] = "BB_C1";
static const char __pyx_k_BB_C2[] = "BB_C2";
static const char __pyx_k_BB_C3[] = "BB_C3";
static const char __pyx_k_BB_C4[] = "BB_C4";
static const char __pyx_k_BB_C5[] = "BB_C5";
static const char __pyx_k_BB_C6[] = "BB_C6";
static const char __pyx_k_BB_C7[] = "BB_C7";
static const char __pyx_k_BB_C8[] = "BB_C8";
static const char __pyx_k_BB_D1[] = "BB_D1";
static const char __pyx_k_BB_D2[] = "BB_D2";
static const char __pyx_k_BB_D3[] = "BB_D3";
static const char __pyx_k_BB_D4[] = "BB_D4";
static const char __pyx_k_BB_D5[] = "BB_D5";
static const char __pyx_k_BB_D6[] = "BB_D6";
static const char __pyx_k_BB_D7[] = "BB_D7";
static const char __pyx_k_BB_D8[] = "BB_D8";
static const char __pyx_k_BB_E1[] = "BB_E1";
static const char __pyx_k_BB_E2[] = "BB_E2";
static const char __pyx_k_BB_E3[] = "BB_E3";
static const char __pyx_k_BB_E4[] = "BB_E4";
static const char __pyx_k_BB_E5[] = "BB_E5";
static const char __pyx_k_BB_E6[] = "BB_E6";
static const char __pyx_k_BB_E7[] = "BB_E7";
static const char __pyx_k_BB_E8[] = "BB_E8";
static const char __pyx_k_BB_F1[] = "BB_F1";
static const char __pyx_k_BB_F2[] = "BB_F2";
static const char __pyx_k_BB_F3[] = "BB_F3";
static const char __pyx_k_BB_F4[] = "BB_F4";
static const char __pyx_k_BB_F5[] = "BB_F5";
static const char __pyx_k_BB_F6[] = "BB_F6";
static const char __pyx_k_BB_F7[] = "BB_F7";
static const char __pyx_k_BB_F8[] = "BB_F8";
static const char __pyx_k_BB_G1[] = "BB_G1";
static const char __pyx_k_BB_G2[] = "BB_G2";
static const char __pyx_k_BB_G3[] = "BB_G3";
static const char __pyx_k_BB_G4[] = "BB_G4";
static const char __pyx_k_BB_G5[] = "BB_G5";
static const char __pyx_k_BB_G6[] = "BB_G6";
static const char __pyx_k_BB_G7[] = "BB_G7";
static const char __pyx_k_BB_G8[] = "BB_G8";
static const char __pyx_k_BB_H1[] = "BB_H1";
static const char __pyx_k_BB_H2[] = "BB_H2";
static const char __pyx_k_BB_H3[] = "BB_H3";
static const char __pyx_k_BB_H4[] = "BB_H4";
static const char __pyx_k_BB_H5[] = "BB_H5";
static const char __pyx_k_BB_H6[] = "BB_H6";
static const char __pyx_k_BB_H7[] = "BB_H7";
static const char __pyx_k_BB_H8[] = "BB_H8";
static const char __pyx_k_Board[] = "Board";
static const char __pyx_k_Chess[] = "Chess";
static const char __pyx_k_EMPTY[] = "EMPTY";
static const char __pyx_k_O_O_2[] = "O-O+";
static const char __pyx_k_O_O_3[] = "O-O#";
static const char __pyx_k_O_O_O[] = "O-O-O";
static const char __pyx_k_Piece[] = "Piece";
static const char __pyx_k_QUEEN[] = "QUEEN";
static const char __pyx_k_VALID[] = "VALID";
static const char __pyx_k_bin_2[] = "_bin";
static const char __pyx_k_board[] = "board";
static const char __pyx_k_bswap[] = "bswap";
static const char __pyx_k_chain[] = "chain";
static const char __pyx_k_check[] = "check";
static const char __pyx_k_chess[] = "chess";
static const char __pyx_k_clear[] = "clear";
static const char __pyx_k_close[] = "close";
static const char __pyx_k_color[] = "color";
static const char __pyx_k_count[] = "count";
static const char __pyx_k_delta[] = "delta";
static const char __pyx_k_edges[] = "_edges";
static const char __pyx_k_empty[] = "empty";
static const char __pyx_k_group[] = "group";
static const char __pyx_k_index[] = "index";
static const char __pyx_k_items[] = "items";
static const char __pyx_k_kings[] = "kings";
static const char __pyx_k_legal[] = "legal";
static const char __pyx_k_lower[] = "lower";
static const char __pyx_k_match[] = "match";
static const char __pyx_k_other[] = "other";
static const char __pyx_k_pawns[] = "pawns";
static const char __pyx_k_piece[] = "piece";
static const char __pyx_k_print[] = "print";
static const char __pyx_k_queen[] = "queen";
static const char __pyx_k_range[] = "range";
static const char __pyx_k_reset[] = "reset";
static const char __pyx_k_rooks[] = "rooks";
static const char __pyx_k_shift[] = "shift";
static const char __pyx_k_split[] = "split";
static const char __pyx_k_stack[] = "stack";
static const char __pyx_k_strip[] = "strip";
static const char __pyx_k_super[] = "super";
static const char __pyx_k_throw[] = "throw";
static const char __pyx_k_union[] = "union";
static const char __pyx_k_upper[] = "upper";
static const char __pyx_k_0_24_1[] = "0.24.1";
static const char __pyx_k_BISHOP[] = "BISHOP";
static const char __pyx_k_KNIGHT[] = "KNIGHT";
static const char __pyx_k_Normal[] = "Normal";
static const char __pyx_k_Square[] = "Square";
static const char __pyx_k_Status[] = "Status";
static const char __pyx_k_append[] = "append";
static const char __pyx_k_bishop[] = "bishop";
static const char __pyx_k_copy_2[] = "copy";
static const char __pyx_k_deltas[] = "deltas";
static const char __pyx_k_format[] = "format";
static const char __pyx_k_import[] = "__import__";
static const char __pyx_k_invert[] = "__invert__";
static const char __pyx_k_knight[] = "knight";
static const char __pyx_k_lshift[] = "__lshift__";
static const char __pyx_k_mirror[] = "mirror";
static const char __pyx_k_module[] = "__module__";
static const char __pyx_k_opcode[] = "opcode";
static const char __pyx_k_others[] = "others";
static const char __pyx_k_pickle[] = "pickle";
static const char __pyx_k_queens[] = "queens";
static const char __pyx_k_rays_2[] = "_rays";
static const char __pyx_k_reduce[] = "__reduce__";
static const char __pyx_k_remove[] = "remove";
static const char __pyx_k_rshift[] = "__rshift__";
static const char __pyx_k_rstrip[] = "rstrip";
static const char __pyx_k_square[] = "square";
static const char __pyx_k_status[] = "status";
static const char __pyx_k_string[] = "string";
static const char __pyx_k_subset[] = "subset";
static const char __pyx_k_symbol[] = "symbol";
static const char __pyx_k_tolist[] = "tolist";
static const char __pyx_k_update[] = "update";
static const char __pyx_k_1_2_1_2[] = "1/2-1/2";
static const char __pyx_k_BB_RAYS[] = "BB_RAYS";
static const char __pyx_k_BB_VOID[] = "BB_VOID";
static const char __pyx_k_Counter[] = "Counter";
static const char __pyx_k_IntEnum[] = "IntEnum";
static const char __pyx_k_IntFlag[] = "IntFlag";
static const char __pyx_k_O_O_O_2[] = "O-O-O+";
static const char __pyx_k_O_O_O_3[] = "O-O-O#";
static const char __pyx_k_SQUARES[] = "SQUARES";
static const char __pyx_k_aliases[] = "aliases";
static const char __pyx_k_attacks[] = "attacks";
static const char __pyx_k_between[] = "between";
static const char __pyx_k_bishops[] = "bishops";
static const char __pyx_k_borders[] = "borders";
static const char __pyx_k_builder[] = "builder";
static const char __pyx_k_compile[] = "compile";
static const char __pyx_k_discard[] = "discard";
static const char __pyx_k_genexpr[] = "genexpr";
static const char __pyx_k_ilshift[] = "__ilshift__";
static const char __pyx_k_index_2[] = "__index__";
static const char __pyx_k_irshift[] = "__irshift__";
static const char __pyx_k_is_safe[] = "_is_safe";
static const char __pyx_k_islower[] = "islower";
static const char __pyx_k_isupper[] = "isupper";
static const char __pyx_k_king_to[] = "king_to";
static const char __pyx_k_knights[] = "knights";
static const char __pyx_k_numeric[] = "numeric";
static const char __pyx_k_prepare[] = "__prepare__";
static const char __pyx_k_restore[] = "restore";
static const char __pyx_k_rook_bb[] = "rook_bb";
static const char __pyx_k_set_epd[] = "set_epd";
static const char __pyx_k_set_fen[] = "set_fen";
static const char __pyx_k_squares[] = "squares";
static const char __pyx_k_to_mask[] = "to_mask";
static const char __pyx_k_version[] = "__version__";
static const char __pyx_k_BB_FILES[] = "BB_FILES";
static const char __pyx_k_BB_RANKS[] = "BB_RANKS";
static const char __pyx_k_KeyError[] = "KeyError";
static const char __pyx_k_Standard[] = "Standard";
static const char __pyx_k_blockers[] = "blockers";
static const char __pyx_k_capturer[] = "capturer";
static const char __pyx_k_checkers[] = "checkers";
static const char __pyx_k_chess960[] = "chess960";
static const char __pyx_k_contains[] = "__contains__";
static const char __pyx_k_deepcopy[] = "deepcopy";
static const char __pyx_k_from_epd[] = "from_epd";
static const char __pyx_k_from_uci[] = "from_uci";
static const char __pyx_k_getstate[] = "__getstate__";
static const char __pyx_k_is_check[] = "is_check";
static const char __pyx_k_is_legal[] = "is_legal";
static const char __pyx_k_issubset[] = "issubset";
static const char __pyx_k_lastmove[] = "lastmove";
static const char __pyx_k_occupied[] = "occupied";
static const char __pyx_k_one_king[] = "one_king";
static const char __pyx_k_piece_at[] = "piece_at";
static const char __pyx_k_pin_mask[] = "pin_mask";
static const char __pyx_k_popcount[] = "popcount";
static const char __pyx_k_promoted[] = "promoted";
static const char __pyx_k_pyx_type[] = "__pyx_type";
static const char __pyx_k_qualname[] = "__qualname__";
static const char __pyx_k_rays_row[] = "rays_row";
static const char __pyx_k_repr_svg[] = "_repr_svg_";
static const char __pyx_k_reversed[] = "__reversed__";
static const char __pyx_k_setstate[] = "__setstate__";
static const char __pyx_k_shift_up[] = "shift_up";
static const char __pyx_k_shredder[] = "shredder";
static const char __pyx_k_swapcase[] = "swapcase";
static const char __pyx_k_BB_CENTER[] = "BB_CENTER";
static const char __pyx_k_BB_FILE_A[] = "BB_FILE_A";
static const char __pyx_k_BB_FILE_B[] = "BB_FILE_B";
static const char __pyx_k_BB_FILE_C[] = "BB_FILE_C";
static const char __pyx_k_BB_FILE_D[] = "BB_FILE_D";
static const char __pyx_k_BB_FILE_E[] = "BB_FILE_E";
static const char __pyx_k_BB_FILE_F[] = "BB_FILE_F";
static const char __pyx_k_BB_FILE_G[] = "BB_FILE_G";
static const char __pyx_k_BB_FILE_H[] = "BB_FILE_H";
static const char __pyx_k_BB_RANK_1[] = "BB_RANK_1";
static const char __pyx_k_BB_RANK_2[] = "BB_RANK_2";
static const char __pyx_k_BB_RANK_3[] = "BB_RANK_3";
static const char __pyx_k_BB_RANK_4[] = "BB_RANK_4";
static const char __pyx_k_BB_RANK_5[] = "BB_RANK_5";
static const char __pyx_k_BB_RANK_6[] = "BB_RANK_6";
static const char __pyx_k_BB_RANK_7[] = "BB_RANK_7";
static const char __pyx_k_BB_RANK_8[] = "BB_RANK_8";
static const char __pyx_k_BaseBoard[] = "BaseBoard";
static const char __pyx_k_Classical[] = "Classical";
static const char __pyx_k_IntFlag_2[] = "_IntFlag";
static const char __pyx_k_PieceType[] = "PieceType";
static const char __pyx_k_RACE_OVER[] = "RACE_OVER";
static const char __pyx_k_SAN_REGEX[] = "SAN_REGEX";
static const char __pyx_k_SquareSet[] = "SquareSet";
static const char __pyx_k_TypeError[] = "TypeError";
static const char __pyx_k_algebraic[] = "_algebraic";
static const char __pyx_k_board_fen[] = "board_fen";
static const char __pyx_k_chess_svg[] = "chess.svg";
static const char __pyx_k_enumerate[] = "enumerate";
static const char __pyx_k_ep_square[] = "ep_square";
static const char __pyx_k_from_mask[] = "from_mask";
static const char __pyx_k_itertools[] = "itertools";
static const char __pyx_k_metaclass[] = "__metaclass__";
static const char __pyx_k_parse_san[] = "parse_san";
static const char __pyx_k_parse_uci[] = "parse_uci";
static const char __pyx_k_promotion[] = "promotion";
static const char __pyx_k_pyx_state[] = "__pyx_state";
static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
static const char __pyx_k_tbw_magic[] = "tbw_magic";
static const char __pyx_k_tbz_magic[] = "tbz_magic";
static const char __pyx_k_to_square[] = "to_square";
static const char __pyx_k_transform[] = "transform";
static const char __pyx_k_0123456789[] = "+-.0123456789";
static const char __pyx_k_BB_BETWEEN[] = "BB_BETWEEN";
static const char __pyx_k_BB_CORNERS[] = "BB_CORNERS";
static const char __pyx_k_BB_SQUARES[] = "_BB_SQUARES";
static const char __pyx_k_BoardState[] = "_BoardState";
static const char __pyx_k_FILE_NAMES[] = "FILE_NAMES";
static const char __pyx_k_IndexError[] = "IndexError";
static const char __pyx_k_MutableSet[] = "MutableSet";
static const char __pyx_k_Piece___eq[] = "Piece.__eq__";
static const char __pyx_k_Piece___ne[] = "Piece.__ne__";
static const char __pyx_k_RACE_CHECK[] = "RACE_CHECK";
static const char __pyx_k_RANK_NAMES[] = "RANK_NAMES";
static const char __pyx_k_ValueError[] = "ValueError";
static const char __pyx_k_bit_length[] = "bit_length";
static const char __pyx_k_claim_draw[] = "claim_draw";
static const char __pyx_k_difference[] = "difference";
static const char __pyx_k_en_passant[] = "en_passant";
static const char __pyx_k_file_index[] = "file_index";
static const char __pyx_k_is_capture[] = "is_capture";
static const char __pyx_k_is_zeroing[] = "is_zeroing";
static const char __pyx_k_isdisjoint[] = "isdisjoint";
static const char __pyx_k_issuperset[] = "issuperset";
static const char __pyx_k_make_board[] = "make_board";
static const char __pyx_k_mask_table[] = "mask_table";
static const char __pyx_k_move_stack[] = "move_stack";
static const char __pyx_k_occupied_b[] = "occupied_b";
static const char __pyx_k_occupied_w[] = "occupied_w";
static const char __pyx_k_piece_type[] = "piece_type";
static const char __pyx_k_pyx_result[] = "__pyx_result";
static const char __pyx_k_rank_index[] = "rank_index";
static const char __pyx_k_shift_2_up[] = "shift_2_up";
static const char __pyx_k_shift_down[] = "shift_down";
static const char __pyx_k_shift_left[] = "shift_left";
static const char __pyx_k_tbw_suffix[] = "tbw_suffix";
static const char __pyx_k_tbz_suffix[] = "tbz_suffix";
static const char __pyx_k_PIECE_NAMES[] = "PIECE_NAMES";
static const char __pyx_k_PIECE_TYPES[] = "PIECE_TYPES";
static const char __pyx_k_PickleError[] = "PickleError";
static const char __pyx_k_Piece___str[] = "Piece.__str__";
static const char __pyx_k_SQUARES_180[] = "SQUARES_180";
static const char __pyx_k_between_row[] = "between_row";
static const char __pyx_k_clear_board[] = "_clear_board";
static const char __pyx_k_clear_stack[] = "clear_stack";
static const char __pyx_k_collections[] = "collections";
static const char __pyx_k_ep_skewered[] = "_ep_skewered";
static const char __pyx_k_from_square[] = "from_square";
static const char __pyx_k_from_symbol[] = "from_symbol";
static const char __pyx_k_ignore_turn[] = "ignore_turn";
static const char __pyx_k_invalid_san[] = "invalid san: {}";
static const char __pyx_k_is_castling[] = "is_castling";
static const char __pyx_k_occupied_co[] = "occupied_co";
static const char __pyx_k_pieces_mask[] = "pieces_mask";
static const char __pyx_k_reset_board[] = "_reset_board";
static const char __pyx_k_shift_right[] = "shift_right";
static const char __pyx_k_square_file[] = "square_file";
static const char __pyx_k_square_name[] = "square_name";
static const char __pyx_k_square_rank[] = "square_rank";
static const char __pyx_k_to_chess960[] = "_to_chess960";
static const char __pyx_k_uci_variant[] = "uci_variant";
static const char __pyx_k_BB_BACKRANKS[] = "BB_BACKRANKS";
static const char __pyx_k_BB_SQUARES_2[] = "BB_SQUARES";
static const char __pyx_k_Piece___hash[] = "Piece.__hash__";
static const char __pyx_k_Piece___init[] = "Piece.__init__";
static const char __pyx_k_Piece___repr[] = "Piece.__repr__";
static const char __pyx_k_Piece_symbol[] = "Piece.symbol";
static const char __pyx_k_SQUARE_NAMES[] = "SQUARE_NAMES";
static const char __pyx_k_STARTING_FEN[] = "STARTING_FEN";
static const char __pyx_k_STATUS_EMPTY[] = "STATUS_EMPTY";
static const char __pyx_k_STATUS_VALID[] = "STATUS_VALID";
static const char __pyx_k_after_opcode[] = "after_opcode";
static const char __pyx_k_attack_table[] = "attack_table";
static const char __pyx_k_attacks_mask[] = "attacks_mask";
static const char __pyx_k_chess960_pos[] = "chess960_pos";
static const char __pyx_k_intersection[] = "intersection";
static const char __pyx_k_invert_color[] = "invert_color";
static const char __pyx_k_is_checkmate[] = "is_checkmate";
static const char __pyx_k_push_capture[] = "_push_capture";
static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
static const char __pyx_k_scan_forward[] = "scan_forward";
static const char __pyx_k_set_piece_at[] = "_set_piece_at";
static const char __pyx_k_shift_2_down[] = "shift_2_down";
static const char __pyx_k_shift_2_left[] = "shift_2_left";
static const char __pyx_k_shredder_fen[] = "shredder_fen";
static const char __pyx_k_starting_fen[] = "starting_fen";
static const char __pyx_k_step_attacks[] = "_step_attacks";
static const char __pyx_k_stringsource[] = "stringsource";
static const char __pyx_k_was_promoted[] = "was_promoted";
static const char __pyx_k_BB_DIAG_MASKS[] = "BB_DIAG_MASKS";
static const char __pyx_k_BB_FILE_MASKS[] = "BB_FILE_MASKS";
static const char __pyx_k_BB_RANK_MASKS[] = "BB_RANK_MASKS";
static const char __pyx_k_Move_from_uci[] = "Move.from_uci('{}')";
static const char __pyx_k_NO_BLACK_KING[] = "NO_BLACK_KING";
static const char __pyx_k_NO_WHITE_KING[] = "NO_WHITE_KING";
static const char __pyx_k_OverflowError[] = "OverflowError";
static const char __pyx_k_PIECE_SYMBOLS[] = "PIECE_SYMBOLS";
static const char __pyx_k_RACE_MATERIAL[] = "RACE_MATERIAL";
static const char __pyx_k_SquareSet_add[] = "SquareSet.add";
static const char __pyx_k_SquareSet_pop[] = "SquareSet.pop";
static const char __pyx_k_StopIteration[] = "StopIteration";
static const char __pyx_k_carry_rippler[] = "_carry_rippler";
static const char __pyx_k_castling_xfen[] = "castling_xfen";
static const char __pyx_k_chess960_True[] = "{}('{}', chess960=True)";
static const char __pyx_k_clear_board_2[] = "clear_board";
static const char __pyx_k_flip_diagonal[] = "flip_diagonal";
static const char __pyx_k_flip_vertical[] = "flip_vertical";
static const char __pyx_k_from_chess960[] = "_from_chess960";
static const char __pyx_k_is_en_passant[] = "is_en_passant";
static const char __pyx_k_is_into_check[] = "is_into_check";
static const char __pyx_k_long_notation[] = "long_notation";
static const char __pyx_k_parse_epd_ops[] = "_parse_epd_ops";
static const char __pyx_k_piece_type_at[] = "piece_type_at";
static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
static const char __pyx_k_reset_board_2[] = "reset_board";
static const char __pyx_k_scan_reversed[] = "scan_reversed";
static const char __pyx_k_set_board_fen[] = "_set_board_fen";
static const char __pyx_k_set_piece_map[] = "_set_piece_map";
static const char __pyx_k_shift_2_right[] = "shift_2_right";
static const char __pyx_k_shift_up_left[] = "shift_up_left";
static const char __pyx_k_square_mirror[] = "square_mirror";
static const char __pyx_k_string_escape[] = "string_escape";
static const char __pyx_k_AttributeError[] = "AttributeError";
static const char __pyx_k_NotImplemented[] = "NotImplemented";
static const char __pyx_k_OPPOSITE_CHECK[] = "OPPOSITE_CHECK";
static const char __pyx_k_SquareSet___eq[] = "SquareSet.__eq__";
static const char __pyx_k_SquareSet___ne[] = "SquareSet.__ne__";
static const char __pyx_k_SquareSet___or[] = "SquareSet.__or__";
static const char __pyx_k_SquareSet_copy[] = "SquareSet.copy";
static const char __pyx_k_TOO_MANY_KINGS[] = "TOO_MANY_KINGS";
static const char __pyx_k_attack_table_2[] = "_attack_table";
static const char __pyx_k_attackers_mask[] = "_attackers_mask";
static const char __pyx_k_can_claim_draw[] = "can_claim_draw";
static const char __pyx_k_capture_square[] = "capture_square";
static const char __pyx_k_epd_operations[] = "_epd_operations";
static const char __pyx_k_halfmove_clock[] = "halfmove_clock";
static const char __pyx_k_illegal_san_in[] = "illegal san: {} in {}";
static const char __pyx_k_illegal_uci_in[] = "illegal uci: {} in {}";
static const char __pyx_k_is_attacked_by[] = "is_attacked_by";
static const char __pyx_k_is_variant_end[] = "is_variant_end";
static const char __pyx_k_is_variant_win[] = "is_variant_win";
static const char __pyx_k_operation_part[] = "operation_part";
static const char __pyx_k_set_piece_at_2[] = "set_piece_at";
static const char __pyx_k_shift_up_right[] = "shift_up_right";
static const char __pyx_k_unicode_symbol[] = "unicode_symbol";
static const char __pyx_k_was_into_check[] = "was_into_check";
static const char __pyx_k_BB_DARK_SQUARES[] = "BB_DARK_SQUARES";
static const char __pyx_k_BB_DIAG_ATTACKS[] = "BB_DIAG_ATTACKS";
static const char __pyx_k_BB_FILE_ATTACKS[] = "BB_FILE_ATTACKS";
static const char __pyx_k_BB_KING_ATTACKS[] = "BB_KING_ATTACKS";
static const char __pyx_k_BB_PAWN_ATTACKS[] = "BB_PAWN_ATTACKS";
static const char __pyx_k_BB_RANK_ATTACKS[] = "BB_RANK_ATTACKS";
static const char __pyx_k_Piece__repr_svg[] = "Piece._repr_svg_";
static const char __pyx_k_SquareSet___and[] = "SquareSet.__and__";
static const char __pyx_k_SquareSet___int[] = "SquareSet.__int__";
static const char __pyx_k_SquareSet___ior[] = "SquareSet.__ior__";
static const char __pyx_k_SquareSet___len[] = "SquareSet.__len__";
static const char __pyx_k_SquareSet___str[] = "SquareSet.__str__";
static const char __pyx_k_SquareSet___sub[] = "SquareSet.__sub__";
static const char __pyx_k_SquareSet___xor[] = "SquareSet.__xor__";
static const char __pyx_k_SquareSet_clear[] = "SquareSet.clear";
static const char __pyx_k_SquareSet_union[] = "SquareSet.union";
static const char __pyx_k_a_b_c_d_e_f_g_h[] = "   a b c d e f g h";
static const char __pyx_k_apply_transform[] = "apply_transform";
static const char __pyx_k_carry_rippler_2[] = "carry_rippler";
static const char __pyx_k_castling_rights[] = "castling_rights";
static const char __pyx_k_collections_abc[] = "collections.abc";
static const char __pyx_k_connected_kings[] = "connected_kings";
static const char __pyx_k_flip_horizontal[] = "flip_horizontal";
static const char __pyx_k_fullmove_number[] = "fullmove_number";
static const char __pyx_k_ignore_castling[] = "ignore_castling";
static const char __pyx_k_ignore_counters[] = "ignore_counters";
static const char __pyx_k_is_irreversible[] = "is_irreversible";
static const char __pyx_k_is_pseudo_legal[] = "is_pseudo_legal";
static const char __pyx_k_is_variant_draw[] = "is_variant_draw";
static const char __pyx_k_is_variant_loss[] = "is_variant_loss";
static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
static const char __pyx_k_remove_piece_at[] = "_remove_piece_at";
static const char __pyx_k_set_board_fen_2[] = "set_board_fen";
static const char __pyx_k_set_piece_map_2[] = "set_piece_map";
static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
static const char __pyx_k_shift_down_left[] = "shift_down_left";
static const char __pyx_k_slider_blockers[] = "_slider_blockers";
static const char __pyx_k_sliding_attacks[] = "_sliding_attacks";
static const char __pyx_k_square_distance[] = "square_distance";
static const char __pyx_k_valid_ep_square[] = "_valid_ep_square";
static const char __pyx_k_BB_LIGHT_SQUARES[] = "BB_LIGHT_SQUARES";
static const char __pyx_k_STATUS_RACE_OVER[] = "STATUS_RACE_OVER";
static const char __pyx_k_SquareSet_0_018x[] = "SquareSet({0:#018x})";
static const char __pyx_k_SquareSet___bool[] = "SquareSet.__bool__";
static const char __pyx_k_SquareSet___iand[] = "SquareSet.__iand__";
static const char __pyx_k_SquareSet___init[] = "SquareSet.__init__";
static const char __pyx_k_SquareSet___isub[] = "SquareSet.__isub__";
static const char __pyx_k_SquareSet___iter[] = "SquareSet.__iter__";
static const char __pyx_k_SquareSet___ixor[] = "SquareSet.__ixor__";
static const char __pyx_k_SquareSet___repr[] = "SquareSet.__repr__";
static const char __pyx_k_SquareSet_mirror[] = "SquareSet.mirror";
static const char __pyx_k_SquareSet_remove[] = "SquareSet.remove";
static const char __pyx_k_SquareSet_tolist[] = "SquareSet.tolist";
static const char __pyx_k_SquareSet_update[] = "SquareSet.update";
static const char __pyx_k_ambiguous_san_in[] = "ambiguous san: {} in {}";
static const char __pyx_k_attackers_mask_2[] = "attackers_mask";
static const char __pyx_k_chess___init__cp[] = "chess.__init__cp";
static const char __pyx_k_set_castling_fen[] = "_set_castling_fen";
static const char __pyx_k_set_chess960_pos[] = "_set_chess960_pos";
static const char __pyx_k_shift_down_right[] = "shift_down_right";
static const char __pyx_k_BB_KNIGHT_ATTACKS[] = "BB_KNIGHT_ATTACKS";
static const char __pyx_k_BoardState___init[] = "_BoardState.__init__";
static const char __pyx_k_INVALID_EP_SQUARE[] = "INVALID_EP_SQUARE";
static const char __pyx_k_PAWNS_ON_BACKRANK[] = "PAWNS_ON_BACKRANK";
static const char __pyx_k_Piece_from_symbol[] = "Piece.from_symbol('{}')";
static const char __pyx_k_STATUS_RACE_CHECK[] = "STATUS_RACE_CHECK";
static const char __pyx_k_SquareSet___index[] = "SquareSet.__index__";
static const char __pyx_k_SquareSet_discard[] = "SquareSet.discard";
static const char __pyx_k_attacked_for_king[] = "_attacked_for_king";
static const char __pyx_k_difference_update[] = "difference_update";
static const char __pyx_k_from_chess960_pos[] = "from_chess960_pos";
static const char __pyx_k_generate_evasions[] = "_generate_evasions";
static const char __pyx_k_generate_legal_ep[] = "generate_legal_ep";
static const char __pyx_k_pyx_unpickle_Move[] = "__pyx_unpickle_Move";
static const char __pyx_k_remove_piece_at_2[] = "remove_piece_at";
static const char __pyx_k_transposition_key[] = "_transposition_key";
static const char __pyx_k_BoardState_restore[] = "_BoardState.restore";
static const char __pyx_k_FEN_CASTLING_REGEX[] = "FEN_CASTLING_REGEX";
static const char __pyx_k_LegalMoveGenerator[] = "LegalMoveGenerator";
static const char __pyx_k_Move_null_line_549[] = "Move.null (line 549)";
static const char __pyx_k_STARTING_BOARD_FEN[] = "STARTING_BOARD_FEN";
static const char __pyx_k_SquareSet___invert[] = "SquareSet.__invert__";
static const char __pyx_k_SquareSet___lshift[] = "SquareSet.__lshift__";
static const char __pyx_k_SquareSet___rshift[] = "SquareSet.__rshift__";
static const char __pyx_k_SquareSet_issubset[] = "SquareSet.issubset";
static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
static const char __pyx_k_flip_anti_diagonal[] = "flip_anti_diagonal";
static const char __pyx_k_pawnless_tbw_magic[] = "pawnless_tbw_magic";
static const char __pyx_k_pawnless_tbz_magic[] = "pawnless_tbz_magic";
static const char __pyx_k_pyx_unpickle_Board[] = "__pyx_unpickle_Board";
static const char __pyx_k_set_chess960_pos_2[] = "set_chess960_pos";
static const char __pyx_k_BAD_CASTLING_RIGHTS[] = "BAD_CASTLING_RIGHTS";
static const char __pyx_k_Board_epd_line_2358[] = "Board.epd (line 2358)";
static const char __pyx_k_Piece_from_symbol_2[] = "Piece.from_symbol";
static const char __pyx_k_SquareSet___ilshift[] = "SquareSet.__ilshift__";
static const char __pyx_k_SquareSet___irshift[] = "SquareSet.__irshift__";
static const char __pyx_k_SquareSet__repr_svg[] = "SquareSet._repr_svg_";
static const char __pyx_k_captures_compulsory[] = "captures_compulsory";
static const char __pyx_k_intersection_update[] = "intersection_update";
static const char __pyx_k_pawnless_tbw_suffix[] = "pawnless_tbw_suffix";
static const char __pyx_k_pawnless_tbz_suffix[] = "pawnless_tbz_suffix";
static const char __pyx_k_Board_push_line_1929[] = "Board.push (line 1929)";
static const char __pyx_k_Piece_unicode_symbol[] = "Piece.unicode_symbol";
static const char __pyx_k_STATUS_NO_BLACK_KING[] = "STATUS_NO_BLACK_KING";
static const char __pyx_k_STATUS_NO_WHITE_KING[] = "STATUS_NO_WHITE_KING";
static const char __pyx_k_STATUS_RACE_MATERIAL[] = "STATUS_RACE_MATERIAL";
static const char __pyx_k_SquareSet___contains[] = "SquareSet.__contains__";
static const char __pyx_k_SquareSet___reversed[] = "SquareSet.__reversed__";
static const char __pyx_k_SquareSet_difference[] = "SquareSet.difference";
static const char __pyx_k_SquareSet_isdisjoint[] = "SquareSet.isdisjoint";
static const char __pyx_k_SquareSet_issuperset[] = "SquareSet.issuperset";
static const char __pyx_k_TOO_MANY_BLACK_PAWNS[] = "TOO_MANY_BLACK_PAWNS";
static const char __pyx_k_TOO_MANY_WHITE_PAWNS[] = "TOO_MANY_WHITE_PAWNS";
static const char __pyx_k_chess___init__cp_pyx[] = "chess/__init__cp.pyx";
static const char __pyx_k_generate_legal_moves[] = "generate_legal_moves";
static const char __pyx_k_has_legal_en_passant[] = "has_legal_en_passant";
static const char __pyx_k_invalid_castling_fen[] = "invalid castling fen: {}";
static const char __pyx_k_is_kingside_castling[] = "is_kingside_castling";
static const char __pyx_k_is_seventyfive_moves[] = "is_seventyfive_moves";
static const char __pyx_k_symmetric_difference[] = "symmetric_difference";
static const char __pyx_k_LegalMoveGenerator_at[] = "<LegalMoveGenerator at {} ({})>";
static const char __pyx_k_STATUS_OPPOSITE_CHECK[] = "STATUS_OPPOSITE_CHECK";
static const char __pyx_k_STATUS_TOO_MANY_KINGS[] = "STATUS_TOO_MANY_KINGS";
static const char __pyx_k_SquareSet_from_square[] = "SquareSet.from_square";
static const char __pyx_k_TOO_MANY_BLACK_PIECES[] = "TOO_MANY_BLACK_PIECES";
static const char __pyx_k_TOO_MANY_WHITE_PIECES[] = "TOO_MANY_WHITE_PIECES";
static const char __pyx_k_UNICODE_PIECE_SYMBOLS[] = "UNICODE_PIECE_SYMBOLS";
static const char __pyx_k_can_claim_fifty_moves[] = "can_claim_fifty_moves";
static const char __pyx_k_castling_shredder_fen[] = "castling_shredder_fen";
static const char __pyx_k_clean_castling_rights[] = "clean_castling_rights";
static const char __pyx_k_is_queenside_castling[] = "is_queenside_castling";
static const char __pyx_k_repr___locals_genexpr[] = "__repr__.<locals>.genexpr";
static const char __pyx_k_set_epd_locals_lambda[] = "set_epd.<locals>.<lambda>";
static const char __pyx_k_BaseBoard_pin_line_799[] = "BaseBoard.pin (line 799)";
static const char __pyx_k_SquareSet_intersection[] = "SquareSet.intersection";
static const char __pyx_k_is_fivefold_repetition[] = "is_fivefold_repetition";
static const char __pyx_k_pyx_unpickle_BaseBoard[] = "__pyx_unpickle_BaseBoard";
static const char __pyx_k_Board_generate_legal_ep[] = "Board.generate_legal_ep";
static const char __pyx_k_SquareSet_carry_rippler[] = "SquareSet.carry_rippler";
static const char __pyx_k_generate_castling_moves[] = "generate_castling_moves";
static const char __pyx_k_Board__generate_evasions[] = "Board._generate_evasions";
static const char __pyx_k_PseudoLegalMoveGenerator[] = "PseudoLegalMoveGenerator";
static const char __pyx_k_STATUS_INVALID_EP_SQUARE[] = "STATUS_INVALID_EP_SQUARE";
static const char __pyx_k_STATUS_PAWNS_ON_BACKRANK[] = "STATUS_PAWNS_ON_BACKRANK";
static const char __pyx_k_generate_pseudo_legal_ep[] = "generate_pseudo_legal_ep";
static const char __pyx_k_illegal_move_in_position[] = "illegal move {} in position {}";
static const char __pyx_k_is_insufficient_material[] = "is_insufficient_material";
static const char __pyx_k_parse_san_locals_genexpr[] = "parse_san.<locals>.genexpr";
static const char __pyx_k_pop_from_empty_SquareSet[] = "pop from empty SquareSet";
static const char __pyx_k_Board_generate_legal_moves[] = "Board.generate_legal_moves";
static const char __pyx_k_STATUS_BAD_CASTLING_RIGHTS[] = "STATUS_BAD_CASTLING_RIGHTS";
static const char __pyx_k_A_piece_with_type_and_color[] = "A piece with type and color.";
static const char __pyx_k_PseudoLegalMoveGenerator_at[] = "<PseudoLegalMoveGenerator at {} ({})>";
static const char __pyx_k_STATUS_TOO_MANY_BLACK_PAWNS[] = "STATUS_TOO_MANY_BLACK_PAWNS";
static const char __pyx_k_STATUS_TOO_MANY_WHITE_PAWNS[] = "STATUS_TOO_MANY_WHITE_PAWNS";
static const char __pyx_k_SquareSet_difference_update[] = "SquareSet.difference_update";
static const char __pyx_k_generate_pseudo_legal_moves[] = "generate_pseudo_legal_moves";
static const char __pyx_k_has_pseudo_legal_en_passant[] = "has_pseudo_legal_en_passant";
static const char __pyx_k_symmetric_difference_update[] = "symmetric_difference_update";
static const char __pyx_k_STATUS_TOO_MANY_BLACK_PIECES[] = "STATUS_TOO_MANY_BLACK_PIECES";
static const char __pyx_k_STATUS_TOO_MANY_WHITE_PIECES[] = "STATUS_TOO_MANY_WHITE_PIECES";
static const char __pyx_k_castling_xfen_locals_genexpr[] = "castling_xfen.<locals>.genexpr";
static const char __pyx_k_invalid_castling_part_in_fen[] = "invalid castling part in fen: {}";
static const char __pyx_k_Board_generate_castling_moves[] = "Board.generate_castling_moves";
static const char __pyx_k_SquareSet_intersection_update[] = "SquareSet.intersection_update";
static const char __pyx_k_castling_uncovers_rank_attack[] = "_castling_uncovers_rank_attack";
static const char __pyx_k_Board_generate_pseudo_legal_ep[] = "Board.generate_pseudo_legal_ep";
static const char __pyx_k_SquareSet_symmetric_difference[] = "SquareSet.symmetric_difference";
static const char __pyx_k_can_claim_threefold_repetition[] = "can_claim_threefold_repetition";
static const char __pyx_k_invalid_en_passant_part_in_fen[] = "invalid en passant part in fen: {}";
static const char __pyx_k_pyx_unpickle_LegalMoveGenerato[] = "__pyx_unpickle_LegalMoveGenerator";
static const char __pyx_k_pyx_unpickle_PseudoLegalMoveGe[] = "__pyx_unpickle_PseudoLegalMoveGenerator";
static const char __pyx_k_A_pure_Python_chess_library_wit[] = "\nA pure Python chess library with move generation and validation, Polyglot\nopening book probing, PGN reading and writing, Gaviota tablebase probing,\nSyzygy tablebase probing and XBoard/UCI engine communication.\n";
static const char __pyx_k_A_set_of_squares_import_chess_s[] = "\n    A set of squares.\n\n    >>> import chess\n    >>>\n    >>> squares = chess.SquareSet(chess.BB_A8 | chess.BB_RANK_1)\n    >>> squares\n    SquareSet(0x01000000000000ff)\n\n    >>> print(squares)\n    1 . . . . . . .\n    . . . . . . . .\n    . . . . . . . .\n    . . . . . . . .\n    . . . . . . . .\n    . . . . . . . .\n    . . . . . . . .\n    1 1 1 1 1 1 1 1\n\n    >>> len(squares)\n    9\n\n    >>> bool(squares)\n    True\n\n    >>> chess.B1 in squares\n    True\n\n    >>> for square in squares:\n    ...     # 0 -- chess.A1\n    ...     # 1 -- chess.B1\n    ...     # 2 -- chess.C1\n    ...     # 3 -- chess.D1\n    ...     # 4 -- chess.E1\n    ...     # 5 -- chess.F1\n    ...     # 6 -- chess.G1\n    ...     # 7 -- chess.H1\n    ...     # 56 -- chess.A8\n    ...     print(square)\n    ...\n    0\n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    56\n\n    >>> list(squares)\n    [0, 1, 2, 3, 4, 5, 6, 7, 56]\n\n    Square sets are internally represented by 64-bit integer masks of the\n    included squares. Bitwise operations can be used to compute unions,\n    intersections and shifts.\n\n    >>> int(squares)\n    72057594037928191\n\n    Also supports common set operations like\n    :func:`~chess.SquareSet.issubset()`, :func:`~chess.SquareSet.issuperset()`,\n    :func:`~chess.SquareSet.union()`, :func:`~chess.SquareSet.intersection()`,\n    :func:`~chess.SquareSet.difference()`,\n    :func:`~chess.SquareSet.symmetric_difference()` and\n    :func:`~chess.SquareSet.copy()` as well as\n    :func:`~chess.SquareSet.update()`,\n    :func:`~chess.SquareSet.intersection_update()`,\n    :func:`~chess.SquareSet.difference_update()`,\n    :func:`~chess.SquareSet.symmetric_difference_update()` and\n    :func:`~chess.SquareSet.clear()`.\n    ";
static const char __pyx_k_Creates_a_class_chess_SquareSet[] = "\n        Creates a :class:`~chess.SquareSet` from a single square.\n\n        >>> import chess\n        >>>\n        >>> chess.SquareSet.from_square(chess.A1) == chess.BB_A1\n        True\n        ";
static const char __pyx_k_Creates_a_new_board_initialized[] = "\n        Creates a new board, initialized with a Chess960 starting position.\n\n        >>> import chess\n        >>> import random\n        >>>\n        >>> board = chess.Board.from_chess960_pos(random.randint(0, 959))\n        ";
static const char __pyx_k_Detects_an_absolute_pin_and_its[] = "\n        Detects an absolute pin (and its direction) of the given square to\n        the king of the given color.\n\n        >>> import chess\n        >>>\n        >>> board = chess.Board(\"rnb1k2r/ppp2ppp/5n2/3q4/1b1P4/2N5/PP3PPP/R1BQKBNR w KQkq - 3 7\")\n        >>> board.is_pinned(chess.WHITE, chess.C3)\n        True\n        >>> direction = board.pin(chess.WHITE, chess.C3)\n        >>> direction\n        SquareSet(0x0000000102040810)\n        >>> print(direction)\n        . . . . . . . .\n        . . . . . . . .\n        . . . . . . . .\n        1 . . . . . . .\n        . 1 . . . . . .\n        . . 1 . . . . .\n        . . . 1 . . . .\n        . . . . 1 . . .\n\n        Returns a :class:`set of squares <chess.SquareSet>` that mask the rank,\n        file or diagonal of the pin. If there is no pin, then a mask of the\n        entire board is returned.\n        ";
static const char __pyx_k_Gets_a_null_move_A_null_move_ju[] = "\n        Gets a null move.\n\n        A null move just passes the turn to the other side (and possibly\n        forfeits en passant capturing). Null moves evaluate to ``False`` in\n        boolean contexts.\n\n        >>> import chess\n        >>>\n        >>> bool(chess.Move.null())\n        False\n        ";
static const char __pyx_k_Gets_an_EPD_representation_of_t[] = "\n        Gets an EPD representation of the current position.\n\n        See :func:`~chess.Board.fen()` for FEN formatting options (*shredder*,\n        *ep_square* and *promoted*).\n\n        EPD operations can be given as keyword arguments. Supported operands\n        are strings, integers, floats, moves, lists of moves and ``None``.\n        All other operands are converted to strings.\n\n        A list of moves for *pv* will be interpreted as a variation. All other\n        move lists are interpreted as a set of moves in the current position.\n\n        *hmvc* and *fmvc* are not included by default. You can use:\n\n        >>> import chess\n        >>>\n        >>> board = chess.Board()\n        >>> board.epd(hmvc=board.halfmove_clock, fmvc=board.fullmove_number)\n        'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - hmvc 0; fmvc 1;'\n        ";
static const char __pyx_k_KQABCDEFGH_0_2_kqabcdefgh_0_2_Z[] = "^(?:-|[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2})\\Z";
static const char __pyx_k_NBKRQ_a_h_1_8_x_a_h_1_8_nbrqkNB[] = "^([NBKRQ])?([a-h])?([1-8])?[\\-x]?([a-h][1-8])(=?[nbrqkNBRQK])?(\\+|#)?\\Z";
static const char __pyx_k_SquareSet_from_square_line_3718[] = "SquareSet.from_square (line 3718)";
static const char __pyx_k_Updates_the_position_with_the_g[] = "\n        Updates the position with the given move and puts it onto the\n        move stack.\n\n        >>> import chess\n        >>>\n        >>> board = chess.Board()\n        >>>\n        >>> Nf3 = chess.Move.from_uci(\"g1f3\")\n        >>> board.push(Nf3)  # Make the move\n\n        >>> board.pop()  # Unmake the last move\n        Move.from_uci('g1f3')\n\n        Null moves just increment the move counters, switch turns and forfeit\n        en passant capturing.\n\n        :warning: Moves are not checked for legality.\n        ";
static const char __pyx_k_attacked_for_king_locals_genexp[] = "_attacked_for_king.<locals>.genexpr";
static const char __pyx_k_not_after_piece_in_position_par[] = "~ not after piece in position part of fen: {}";
static const char __pyx_k_BaseBoard_from_chess960_pos_line[] = "BaseBoard.from_chess960_pos (line 1345)";
static const char __pyx_k_Board_generate_pseudo_legal_move[] = "Board.generate_pseudo_legal_moves";
static const char __pyx_k_Incompatible_checksums_s_vs_0x36[] = "Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))";
static const char __pyx_k_Incompatible_checksums_s_vs_0x5a[] = "Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))";
static const char __pyx_k_Incompatible_checksums_s_vs_0xd4[] = "Incompatible checksums (%s vs 0xd41d8cd = ())";
static const char __pyx_k_SquareSet_symmetric_difference_u[] = "SquareSet.symmetric_difference_update";
static const char __pyx_k_chess960_position_index_not_0_95[] = "chess960 position index not 0 <= {} <= 959";
static const char __pyx_k_epd_should_consist_of_at_least_4[] = "epd should consist of at least 4 parts: {}";
static const char __pyx_k_expected_8_columns_per_row_in_po[] = "expected 8 columns per row in position part of fen: {}";
static const char __pyx_k_expected_8_rows_in_position_part[] = "expected 8 rows in position part of fen: {}";
static const char __pyx_k_expected_position_part_of_fen_go[] = "expected position part of fen, got multiple parts: {}";
static const char __pyx_k_expected_uci_string_to_be_of_len[] = "expected uci string to be of length 4 or 5: {}";
static const char __pyx_k_expected_w_or_b_for_turn_part_of[] = "expected 'w' or 'b' for turn part of fen: {}";
static const char __pyx_k_fen_string_should_consist_of_6_p[] = "fen string should consist of 6 parts: {}";
static const char __pyx_k_full_move_number_must_be_positiv[] = "full-move number must be positive: {}";
static const char __pyx_k_half_move_clock_can_not_be_negat[] = "half-move clock can not be negative: {}";
static const char __pyx_k_invalid_character_in_position_pa[] = "invalid character in position part of fen: {}";
static const char __pyx_k_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP[] = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
static const char __pyx_k_two_subsequent_digits_in_positio[] = "two subsequent digits in position part of fen: {}";
static const char __pyx_k_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP_2[] = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";
static PyObject *__pyx_kp_u_0;
static PyObject *__pyx_kp_u_0000;
static PyObject *__pyx_kp_u_0123456789;
static PyObject *__pyx_kp_u_0_1;
static PyObject *__pyx_kp_u_0_1_2;
static PyObject *__pyx_kp_u_0_24_1;
static PyObject *__pyx_kp_u_1;
static PyObject *__pyx_kp_u_1_0;
static PyObject *__pyx_kp_u_1_2_1_2;
static PyObject *__pyx_kp_u_2;
static PyObject *__pyx_kp_u_3;
static PyObject *__pyx_kp_u_4;
static PyObject *__pyx_kp_u_5;
static PyObject *__pyx_kp_u_6;
static PyObject *__pyx_kp_u_7;
static PyObject *__pyx_kp_u_8;
static PyObject *__pyx_n_s_A1;
static PyObject *__pyx_n_s_A2;
static PyObject *__pyx_n_s_A3;
static PyObject *__pyx_n_s_A4;
static PyObject *__pyx_n_s_A5;
static PyObject *__pyx_n_s_A6;
static PyObject *__pyx_n_s_A7;
static PyObject *__pyx_n_s_A8;
static PyObject *__pyx_kp_s_A_piece_with_type_and_color;
static PyObject *__pyx_kp_s_A_set_of_squares_import_chess_s;
static PyObject *__pyx_n_s_AttributeError;
static PyObject *__pyx_n_u_B;
static PyObject *__pyx_n_s_B1;
static PyObject *__pyx_n_s_B2;
static PyObject *__pyx_n_s_B3;
static PyObject *__pyx_n_s_B4;
static PyObject *__pyx_n_s_B5;
static PyObject *__pyx_n_s_B6;
static PyObject *__pyx_n_s_B7;
static PyObject *__pyx_n_s_B8;
static PyObject *__pyx_n_s_BAD_CASTLING_RIGHTS;
static PyObject *__pyx_n_s_BB_A1;
static PyObject *__pyx_n_s_BB_A2;
static PyObject *__pyx_n_s_BB_A3;
static PyObject *__pyx_n_s_BB_A4;
static PyObject *__pyx_n_s_BB_A5;
static PyObject *__pyx_n_s_BB_A6;
static PyObject *__pyx_n_s_BB_A7;
static PyObject *__pyx_n_s_BB_A8;
static PyObject *__pyx_n_s_BB_B1;
static PyObject *__pyx_n_s_BB_B2;
static PyObject *__pyx_n_s_BB_B3;
static PyObject *__pyx_n_s_BB_B4;
static PyObject *__pyx_n_s_BB_B5;
static PyObject *__pyx_n_s_BB_B6;
static PyObject *__pyx_n_s_BB_B7;
static PyObject *__pyx_n_s_BB_B8;
static PyObject *__pyx_n_s_BB_BACKRANKS;
static PyObject *__pyx_n_s_BB_BETWEEN;
static PyObject *__pyx_n_s_BB_C1;
static PyObject *__pyx_n_s_BB_C2;
static PyObject *__pyx_n_s_BB_C3;
static PyObject *__pyx_n_s_BB_C4;
static PyObject *__pyx_n_s_BB_C5;
static PyObject *__pyx_n_s_BB_C6;
static PyObject *__pyx_n_s_BB_C7;
static PyObject *__pyx_n_s_BB_C8;
static PyObject *__pyx_n_s_BB_CENTER;
static PyObject *__pyx_n_s_BB_CORNERS;
static PyObject *__pyx_n_s_BB_D1;
static PyObject *__pyx_n_s_BB_D2;
static PyObject *__pyx_n_s_BB_D3;
static PyObject *__pyx_n_s_BB_D4;
static PyObject *__pyx_n_s_BB_D5;
static PyObject *__pyx_n_s_BB_D6;
static PyObject *__pyx_n_s_BB_D7;
static PyObject *__pyx_n_s_BB_D8;
static PyObject *__pyx_n_s_BB_DARK_SQUARES;
static PyObject *__pyx_n_s_BB_DIAG_ATTACKS;
static PyObject *__pyx_n_s_BB_DIAG_MASKS;
static PyObject *__pyx_n_s_BB_E1;
static PyObject *__pyx_n_s_BB_E2;
static PyObject *__pyx_n_s_BB_E3;
static PyObject *__pyx_n_s_BB_E4;
static PyObject *__pyx_n_s_BB_E5;
static PyObject *__pyx_n_s_BB_E6;
static PyObject *__pyx_n_s_BB_E7;
static PyObject *__pyx_n_s_BB_E8;
static PyObject *__pyx_n_s_BB_F1;
static PyObject *__pyx_n_s_BB_F2;
static PyObject *__pyx_n_s_BB_F3;
static PyObject *__pyx_n_s_BB_F4;
static PyObject *__pyx_n_s_BB_F5;
static PyObject *__pyx_n_s_BB_F6;
static PyObject *__pyx_n_s_BB_F7;
static PyObject *__pyx_n_s_BB_F8;
static PyObject *__pyx_n_s_BB_FILES;
static PyObject *__pyx_n_s_BB_FILE_A;
static PyObject *__pyx_n_s_BB_FILE_ATTACKS;
static PyObject *__pyx_n_s_BB_FILE_B;
static PyObject *__pyx_n_s_BB_FILE_C;
static PyObject *__pyx_n_s_BB_FILE_D;
static PyObject *__pyx_n_s_BB_FILE_E;
static PyObject *__pyx_n_s_BB_FILE_F;
static PyObject *__pyx_n_s_BB_FILE_G;
static PyObject *__pyx_n_s_BB_FILE_H;
static PyObject *__pyx_n_s_BB_FILE_MASKS;
static PyObject *__pyx_n_s_BB_G1;
static PyObject *__pyx_n_s_BB_G2;
static PyObject *__pyx_n_s_BB_G3;
static PyObject *__pyx_n_s_BB_G4;
static PyObject *__pyx_n_s_BB_G5;
static PyObject *__pyx_n_s_BB_G6;
static PyObject *__pyx_n_s_BB_G7;
static PyObject *__pyx_n_s_BB_G8;
static PyObject *__pyx_n_s_BB_H1;
static PyObject *__pyx_n_s_BB_H2;
static PyObject *__pyx_n_s_BB_H3;
static PyObject *__pyx_n_s_BB_H4;
static PyObject *__pyx_n_s_BB_H5;
static PyObject *__pyx_n_s_BB_H6;
static PyObject *__pyx_n_s_BB_H7;
static PyObject *__pyx_n_s_BB_H8;
static PyObject *__pyx_n_s_BB_KING_ATTACKS;
static PyObject *__pyx_n_s_BB_KNIGHT_ATTACKS;
static PyObject *__pyx_n_s_BB_LIGHT_SQUARES;
static PyObject *__pyx_n_s_BB_PAWN_ATTACKS;
static PyObject *__pyx_n_s_BB_RANKS;
static PyObject *__pyx_n_s_BB_RANK_1;
static PyObject *__pyx_n_s_BB_RANK_2;
static PyObject *__pyx_n_s_BB_RANK_3;
static PyObject *__pyx_n_s_BB_RANK_4;
static PyObject *__pyx_n_s_BB_RANK_5;
static PyObject *__pyx_n_s_BB_RANK_6;
static PyObject *__pyx_n_s_BB_RANK_7;
static PyObject *__pyx_n_s_BB_RANK_8;
static PyObject *__pyx_n_s_BB_RANK_ATTACKS;
static PyObject *__pyx_n_s_BB_RANK_MASKS;
static PyObject *__pyx_n_s_BB_RAYS;
static PyObject *__pyx_n_s_BB_SQUARES;
static PyObject *__pyx_n_s_BB_SQUARES_2;
static PyObject *__pyx_n_s_BB_VOID;
static PyObject *__pyx_n_s_BISHOP;
static PyObject *__pyx_n_s_BaseBoard;
static PyObject *__pyx_kp_u_BaseBoard_from_chess960_pos_line;
static PyObject *__pyx_kp_u_BaseBoard_pin_line_799;
static PyObject *__pyx_n_s_Board;
static PyObject *__pyx_n_s_BoardState;
static PyObject *__pyx_n_s_BoardState___init;
static PyObject *__pyx_n_s_BoardState_restore;
static PyObject *__pyx_n_s_Board__generate_evasions;
static PyObject *__pyx_kp_u_Board_epd_line_2358;
static PyObject *__pyx_n_s_Board_generate_castling_moves;
static PyObject *__pyx_n_s_Board_generate_legal_ep;
static PyObject *__pyx_n_s_Board_generate_legal_moves;
static PyObject *__pyx_n_s_Board_generate_pseudo_legal_ep;
static PyObject *__pyx_n_s_Board_generate_pseudo_legal_move;
static PyObject *__pyx_kp_u_Board_push_line_1929;
static PyObject *__pyx_n_s_C1;
static PyObject *__pyx_n_s_C2;
static PyObject *__pyx_n_s_C3;
static PyObject *__pyx_n_s_C4;
static PyObject *__pyx_n_s_C5;
static PyObject *__pyx_n_s_C6;
static PyObject *__pyx_n_s_C7;
static PyObject *__pyx_n_s_C8;
static PyObject *__pyx_n_u_Chess;
static PyObject *__pyx_n_u_Classical;
static PyObject *__pyx_n_s_Counter;
static PyObject *__pyx_kp_u_Creates_a_class_chess_SquareSet;
static PyObject *__pyx_kp_u_Creates_a_new_board_initialized;
static PyObject *__pyx_n_s_D1;
static PyObject *__pyx_n_s_D2;
static PyObject *__pyx_n_s_D3;
static PyObject *__pyx_n_s_D4;
static PyObject *__pyx_n_s_D5;
static PyObject *__pyx_n_s_D6;
static PyObject *__pyx_n_s_D7;
static PyObject *__pyx_n_s_D8;
static PyObject *__pyx_kp_u_Detects_an_absolute_pin_and_its;
static PyObject *__pyx_n_s_E1;
static PyObject *__pyx_n_s_E2;
static PyObject *__pyx_n_s_E3;
static PyObject *__pyx_n_s_E4;
static PyObject *__pyx_n_s_E5;
static PyObject *__pyx_n_s_E6;
static PyObject *__pyx_n_s_E7;
static PyObject *__pyx_n_s_E8;
static PyObject *__pyx_n_s_EMPTY;
static PyObject *__pyx_n_s_F1;
static PyObject *__pyx_n_s_F2;
static PyObject *__pyx_n_s_F3;
static PyObject *__pyx_n_s_F4;
static PyObject *__pyx_n_s_F5;
static PyObject *__pyx_n_s_F6;
static PyObject *__pyx_n_s_F7;
static PyObject *__pyx_n_s_F8;
static PyObject *__pyx_n_s_FEN_CASTLING_REGEX;
static PyObject *__pyx_n_s_FILE_NAMES;
static PyObject *__pyx_n_s_G1;
static PyObject *__pyx_n_s_G2;
static PyObject *__pyx_n_s_G3;
static PyObject *__pyx_n_s_G4;
static PyObject *__pyx_n_s_G5;
static PyObject *__pyx_n_s_G6;
static PyObject *__pyx_n_s_G7;
static PyObject *__pyx_n_s_G8;
static PyObject *__pyx_kp_u_Gets_a_null_move_A_null_move_ju;
static PyObject *__pyx_kp_u_Gets_an_EPD_representation_of_t;
static PyObject *__pyx_n_s_H1;
static PyObject *__pyx_n_s_H2;
static PyObject *__pyx_n_s_H3;
static PyObject *__pyx_n_s_H4;
static PyObject *__pyx_n_s_H5;
static PyObject *__pyx_n_s_H6;
static PyObject *__pyx_n_s_H7;
static PyObject *__pyx_n_s_H8;
static PyObject *__pyx_n_s_INVALID_EP_SQUARE;
static PyObject *__pyx_kp_s_Incompatible_checksums_s_vs_0x36;
static PyObject *__pyx_kp_s_Incompatible_checksums_s_vs_0x5a;
static PyObject *__pyx_kp_s_Incompatible_checksums_s_vs_0xd4;
static PyObject *__pyx_n_s_IndexError;
static PyObject *__pyx_n_s_IntEnum;
static PyObject *__pyx_n_s_IntFlag;
static PyObject *__pyx_n_s_IntFlag_2;
static PyObject *__pyx_n_u_K;
static PyObject *__pyx_n_s_KING;
static PyObject *__pyx_n_s_KNIGHT;
static PyObject *__pyx_kp_u_KQABCDEFGH_0_2_kqabcdefgh_0_2_Z;
static PyObject *__pyx_n_s_KeyError;
static PyObject *__pyx_n_s_LegalMoveGenerator;
static PyObject *__pyx_kp_u_LegalMoveGenerator_at;
static PyObject *__pyx_n_s_Move;
static PyObject *__pyx_kp_u_Move_from_uci;
static PyObject *__pyx_kp_u_Move_null_line_549;
static PyObject *__pyx_n_s_MutableSet;
static PyObject *__pyx_n_u_N;
static PyObject *__pyx_kp_u_NBKRQ_a_h_1_8_x_a_h_1_8_nbrqkNB;
static PyObject *__pyx_n_s_NO_BLACK_KING;
static PyObject *__pyx_n_s_NO_WHITE_KING;
static PyObject *__pyx_n_u_Normal;
static PyObject *__pyx_n_s_NotImplemented;
static PyObject *__pyx_n_s_OPPOSITE_CHECK;
static PyObject *__pyx_kp_u_O_O;
static PyObject *__pyx_kp_u_O_O_2;
static PyObject *__pyx_kp_u_O_O_3;
static PyObject *__pyx_kp_u_O_O_O;
static PyObject *__pyx_kp_u_O_O_O_2;
static PyObject *__pyx_kp_u_O_O_O_3;
static PyObject *__pyx_n_s_OverflowError;
static PyObject *__pyx_n_u_P;
static PyObject *__pyx_n_s_PAWN;
static PyObject *__pyx_n_s_PAWNS_ON_BACKRANK;
static PyObject *__pyx_n_s_PIECE_NAMES;
static PyObject *__pyx_n_s_PIECE_SYMBOLS;
static PyObject *__pyx_n_s_PIECE_TYPES;
static PyObject *__pyx_n_s_PickleError;
static PyObject *__pyx_n_s_Piece;
static PyObject *__pyx_n_s_PieceType;
static PyObject *__pyx_n_s_Piece___eq;
static PyObject *__pyx_n_s_Piece___hash;
static PyObject *__pyx_n_s_Piece___init;
static PyObject *__pyx_n_s_Piece___ne;
static PyObject *__pyx_n_s_Piece___repr;
static PyObject *__pyx_n_s_Piece___str;
static PyObject *__pyx_n_s_Piece__repr_svg;
static PyObject *__pyx_kp_u_Piece_from_symbol;
static PyObject *__pyx_n_s_Piece_from_symbol_2;
static PyObject *__pyx_n_s_Piece_symbol;
static PyObject *__pyx_n_s_Piece_unicode_symbol;
static PyObject *__pyx_n_s_PseudoLegalMoveGenerator;
static PyObject *__pyx_kp_u_PseudoLegalMoveGenerator_at;
static PyObject *__pyx_n_u_Q;
static PyObject *__pyx_n_s_QUEEN;
static PyObject *__pyx_n_u_R;
static PyObject *__pyx_n_s_RACE_CHECK;
static PyObject *__pyx_n_s_RACE_MATERIAL;
static PyObject *__pyx_n_s_RACE_OVER;
static PyObject *__pyx_n_s_RANK_NAMES;
static PyObject *__pyx_n_s_ROOK;
static PyObject *__pyx_n_s_SAN_REGEX;
static PyObject *__pyx_n_s_SQUARES;
static PyObject *__pyx_n_s_SQUARES_180;
static PyObject *__pyx_n_s_SQUARE_NAMES;
static PyObject *__pyx_n_s_STARTING_BOARD_FEN;
static PyObject *__pyx_n_s_STARTING_FEN;
static PyObject *__pyx_n_s_STATUS_BAD_CASTLING_RIGHTS;
static PyObject *__pyx_n_s_STATUS_EMPTY;
static PyObject *__pyx_n_s_STATUS_INVALID_EP_SQUARE;
static PyObject *__pyx_n_s_STATUS_NO_BLACK_KING;
static PyObject *__pyx_n_s_STATUS_NO_WHITE_KING;
static PyObject *__pyx_n_s_STATUS_OPPOSITE_CHECK;
static PyObject *__pyx_n_s_STATUS_PAWNS_ON_BACKRANK;
static PyObject *__pyx_n_s_STATUS_RACE_CHECK;
static PyObject *__pyx_n_s_STATUS_RACE_MATERIAL;
static PyObject *__pyx_n_s_STATUS_RACE_OVER;
static PyObject *__pyx_n_s_STATUS_TOO_MANY_BLACK_PAWNS;
static PyObject *__pyx_n_s_STATUS_TOO_MANY_BLACK_PIECES;
static PyObject *__pyx_n_s_STATUS_TOO_MANY_KINGS;
static PyObject *__pyx_n_s_STATUS_TOO_MANY_WHITE_PAWNS;
static PyObject *__pyx_n_s_STATUS_TOO_MANY_WHITE_PIECES;
static PyObject *__pyx_n_s_STATUS_VALID;
static PyObject *__pyx_n_s_Square;
static PyObject *__pyx_n_s_SquareSet;
static PyObject *__pyx_kp_u_SquareSet_0_018x;
static PyObject *__pyx_n_s_SquareSet___and;
static PyObject *__pyx_n_s_SquareSet___bool;
static PyObject *__pyx_n_s_SquareSet___contains;
static PyObject *__pyx_n_s_SquareSet___eq;
static PyObject *__pyx_n_s_SquareSet___iand;
static PyObject *__pyx_n_s_SquareSet___ilshift;
static PyObject *__pyx_n_s_SquareSet___index;
static PyObject *__pyx_n_s_SquareSet___init;
static PyObject *__pyx_n_s_SquareSet___int;
static PyObject *__pyx_n_s_SquareSet___invert;
static PyObject *__pyx_n_s_SquareSet___ior;
static PyObject *__pyx_n_s_SquareSet___irshift;
static PyObject *__pyx_n_s_SquareSet___isub;
static PyObject *__pyx_n_s_SquareSet___iter;
static PyObject *__pyx_n_s_SquareSet___ixor;
static PyObject *__pyx_n_s_SquareSet___len;
static PyObject *__pyx_n_s_SquareSet___lshift;
static PyObject *__pyx_n_s_SquareSet___ne;
static PyObject *__pyx_n_s_SquareSet___or;
static PyObject *__pyx_n_s_SquareSet___repr;
static PyObject *__pyx_n_s_SquareSet___reversed;
static PyObject *__pyx_n_s_SquareSet___rshift;
static PyObject *__pyx_n_s_SquareSet___str;
static PyObject *__pyx_n_s_SquareSet___sub;
static PyObject *__pyx_n_s_SquareSet___xor;
static PyObject *__pyx_n_s_SquareSet__repr_svg;
static PyObject *__pyx_n_s_SquareSet_add;
static PyObject *__pyx_n_s_SquareSet_carry_rippler;
static PyObject *__pyx_n_s_SquareSet_clear;
static PyObject *__pyx_n_s_SquareSet_copy;
static PyObject *__pyx_n_s_SquareSet_difference;
static PyObject *__pyx_n_s_SquareSet_difference_update;
static PyObject *__pyx_n_s_SquareSet_discard;
static PyObject *__pyx_n_s_SquareSet_from_square;
static PyObject *__pyx_kp_u_SquareSet_from_square_line_3718;
static PyObject *__pyx_n_s_SquareSet_intersection;
static PyObject *__pyx_n_s_SquareSet_intersection_update;
static PyObject *__pyx_n_s_SquareSet_isdisjoint;
static PyObject *__pyx_n_s_SquareSet_issubset;
static PyObject *__pyx_n_s_SquareSet_issuperset;
static PyObject *__pyx_n_s_SquareSet_mirror;
static PyObject *__pyx_n_s_SquareSet_pop;
static PyObject *__pyx_n_s_SquareSet_remove;
static PyObject *__pyx_n_s_SquareSet_symmetric_difference;
static PyObject *__pyx_n_s_SquareSet_symmetric_difference_u;
static PyObject *__pyx_n_s_SquareSet_tolist;
static PyObject *__pyx_n_s_SquareSet_union;
static PyObject *__pyx_n_s_SquareSet_update;
static PyObject *__pyx_n_u_Standard;
static PyObject *__pyx_n_s_Status;
static PyObject *__pyx_n_s_StopIteration;
static PyObject *__pyx_n_s_TOO_MANY_BLACK_PAWNS;
static PyObject *__pyx_n_s_TOO_MANY_BLACK_PIECES;
static PyObject *__pyx_n_s_TOO_MANY_KINGS;
static PyObject *__pyx_n_s_TOO_MANY_WHITE_PAWNS;
static PyObject *__pyx_n_s_TOO_MANY_WHITE_PIECES;
static PyObject *__pyx_n_s_TypeError;
static PyObject *__pyx_n_s_UNICODE_PIECE_SYMBOLS;
static PyObject *__pyx_kp_u_Updates_the_position_with_the_g;
static PyObject *__pyx_n_s_VALID;
static PyObject *__pyx_n_s_ValueError;
static PyObject *__pyx_n_u_Z0;
static PyObject *__pyx_kp_u__11;
static PyObject *__pyx_kp_u__12;
static PyObject *__pyx_kp_u__13;
static PyObject *__pyx_kp_u__14;
static PyObject *__pyx_kp_u__15;
static PyObject *__pyx_kp_u__16;
static PyObject *__pyx_kp_u__18;
static PyObject *__pyx_kp_u__19;
static PyObject *__pyx_kp_u__20;
static PyObject *__pyx_kp_u__21;
static PyObject *__pyx_kp_u__22;
static PyObject *__pyx_kp_u__23;
static PyObject *__pyx_kp_u__33;
static PyObject *__pyx_kp_u__34;
static PyObject *__pyx_kp_u__35;
static PyObject *__pyx_kp_u__36;
static PyObject *__pyx_kp_u__37;
static PyObject *__pyx_kp_u__38;
static PyObject *__pyx_kp_u__39;
static PyObject *__pyx_kp_u__40;
static PyObject *__pyx_kp_u__41;
static PyObject *__pyx_kp_u__42;
static PyObject *__pyx_kp_u__44;
static PyObject *__pyx_kp_u__45;
static PyObject *__pyx_kp_u__46;
static PyObject *__pyx_kp_u__47;
static PyObject *__pyx_kp_u__48;
static PyObject *__pyx_kp_u__49;
static PyObject *__pyx_kp_u__5;
static PyObject *__pyx_kp_u__60;
static PyObject *__pyx_kp_u__62;
static PyObject *__pyx_kp_u__65;
static PyObject *__pyx_kp_u__66;
static PyObject *__pyx_kp_u__67;
static PyObject *__pyx_kp_u__68;
static PyObject *__pyx_kp_u__69;
static PyObject *__pyx_kp_u__70;
static PyObject *__pyx_kp_u__71;
static PyObject *__pyx_kp_u__72;
static PyObject *__pyx_kp_u__73;
static PyObject *__pyx_kp_u__74;
static PyObject *__pyx_kp_u__75;
static PyObject *__pyx_kp_u__76;
static PyObject *__pyx_n_s_a;
static PyObject *__pyx_n_u_a;
static PyObject *__pyx_kp_u_a_b_c_d_e_f_g_h;
static PyObject *__pyx_n_s_abc;
static PyObject *__pyx_n_s_add;
static PyObject *__pyx_n_u_after_opcode;
static PyObject *__pyx_n_s_algebraic;
static PyObject *__pyx_n_s_aliases;
static PyObject *__pyx_n_u_am;
static PyObject *__pyx_kp_u_ambiguous_san_in;
static PyObject *__pyx_n_s_and;
static PyObject *__pyx_n_s_any;
static PyObject *__pyx_n_s_append;
static PyObject *__pyx_n_s_apply_transform;
static PyObject *__pyx_n_s_args;
static PyObject *__pyx_n_s_attack_table;
static PyObject *__pyx_n_s_attack_table_2;
static PyObject *__pyx_n_s_attacked_for_king;
static PyObject *__pyx_n_s_attacked_for_king_locals_genexp;
static PyObject *__pyx_n_s_attackers_mask;
static PyObject *__pyx_n_s_attackers_mask_2;
static PyObject *__pyx_n_s_attacks;
static PyObject *__pyx_n_s_attacks_mask;
static PyObject *__pyx_n_s_b;
static PyObject *__pyx_n_u_b;
static PyObject *__pyx_n_s_bb;
static PyObject *__pyx_n_s_bb_a;
static PyObject *__pyx_n_s_bb_b;
static PyObject *__pyx_n_s_between;
static PyObject *__pyx_n_s_between_row;
static PyObject *__pyx_n_s_bin;
static PyObject *__pyx_n_s_bin_2;
static PyObject *__pyx_n_u_bishop;
static PyObject *__pyx_n_s_bishops;
static PyObject *__pyx_n_s_bit_length;
static PyObject *__pyx_n_s_blockers;
static PyObject *__pyx_n_u_bm;
static PyObject *__pyx_n_s_board;
static PyObject *__pyx_n_s_board_fen;
static PyObject *__pyx_n_s_bool;
static PyObject *__pyx_n_s_borders;
static PyObject *__pyx_n_s_bswap;
static PyObject *__pyx_n_s_builder;
static PyObject *__pyx_n_u_c;
static PyObject *__pyx_n_s_can_claim_draw;
static PyObject *__pyx_n_s_can_claim_fifty_moves;
static PyObject *__pyx_n_s_can_claim_threefold_repetition;
static PyObject *__pyx_n_s_capture_square;
static PyObject *__pyx_n_s_capturer;
static PyObject *__pyx_n_s_captures_compulsory;
static PyObject *__pyx_n_s_carry_rippler;
static PyObject *__pyx_n_s_carry_rippler_2;
static PyObject *__pyx_n_s_castling_rights;
static PyObject *__pyx_n_s_castling_shredder_fen;
static PyObject *__pyx_n_s_castling_uncovers_rank_attack;
static PyObject *__pyx_n_s_castling_xfen;
static PyObject *__pyx_n_s_castling_xfen_locals_genexpr;
static PyObject *__pyx_n_s_chain;
static PyObject *__pyx_n_s_check;
static PyObject *__pyx_n_s_checkers;
static PyObject *__pyx_n_s_chess;
static PyObject *__pyx_n_u_chess;
static PyObject *__pyx_n_s_chess960;
static PyObject *__pyx_kp_u_chess960_True;
static PyObject *__pyx_n_s_chess960_pos;
static PyObject *__pyx_kp_u_chess960_position_index_not_0_95;
static PyObject *__pyx_n_s_chess___init__cp;
static PyObject *__pyx_kp_s_chess___init__cp_pyx;
static PyObject *__pyx_n_s_chess_svg;
static PyObject *__pyx_n_s_claim_draw;
static PyObject *__pyx_n_s_clean_castling_rights;
static PyObject *__pyx_n_s_clear;
static PyObject *__pyx_n_s_clear_board;
static PyObject *__pyx_n_s_clear_board_2;
static PyObject *__pyx_n_s_clear_stack;
static PyObject *__pyx_n_s_cline_in_traceback;
static PyObject *__pyx_n_s_close;
static PyObject *__pyx_n_s_cls;
static PyObject *__pyx_n_s_collections;
static PyObject *__pyx_n_s_collections_abc;
static PyObject *__pyx_n_s_color;
static PyObject *__pyx_n_s_compile;
static PyObject *__pyx_n_s_connected_kings;
static PyObject *__pyx_n_s_contains;
static PyObject *__pyx_n_s_copy;
static PyObject *__pyx_n_s_copy_2;
static PyObject *__pyx_n_s_count;
static PyObject *__pyx_n_u_d;
static PyObject *__pyx_n_s_deepcopy;
static PyObject *__pyx_n_s_delta;
static PyObject *__pyx_n_s_deltas;
static PyObject *__pyx_n_s_dict;
static PyObject *__pyx_n_s_difference;
static PyObject *__pyx_n_s_difference_update;
static PyObject *__pyx_n_s_discard;
static PyObject *__pyx_n_s_doc;
static PyObject *__pyx_n_s_drop;
static PyObject *__pyx_n_u_e;
static PyObject *__pyx_n_s_edges;
static PyObject *__pyx_n_s_empty;
static PyObject *__pyx_n_s_en_passant;
static PyObject *__pyx_n_s_enum;
static PyObject *__pyx_n_s_enumerate;
static PyObject *__pyx_n_s_ep_skewered;
static PyObject *__pyx_n_s_ep_square;
static PyObject *__pyx_n_s_epd;
static PyObject *__pyx_n_s_epd_operations;
static PyObject *__pyx_kp_u_epd_should_consist_of_at_least_4;
static PyObject *__pyx_n_s_eq;
static PyObject *__pyx_kp_u_expected_8_columns_per_row_in_po;
static PyObject *__pyx_kp_u_expected_8_rows_in_position_part;
static PyObject *__pyx_kp_u_expected_position_part_of_fen_go;
static PyObject *__pyx_kp_u_expected_uci_string_to_be_of_len;
static PyObject *__pyx_kp_u_expected_w_or_b_for_turn_part_of;
static PyObject *__pyx_n_u_f;
static PyObject *__pyx_kp_b_f_2;
static PyObject *__pyx_n_s_fen;
static PyObject *__pyx_n_u_fen;
static PyObject *__pyx_kp_u_fen_string_should_consist_of_6_p;
static PyObject *__pyx_n_s_file_index;
static PyObject *__pyx_n_s_flip_anti_diagonal;
static PyObject *__pyx_n_s_flip_diagonal;
static PyObject *__pyx_n_s_flip_horizontal;
static PyObject *__pyx_n_s_flip_vertical;
static PyObject *__pyx_n_u_fmvn;
static PyObject *__pyx_n_s_format;
static PyObject *__pyx_n_s_from_chess960;
static PyObject *__pyx_n_s_from_chess960_pos;
static PyObject *__pyx_n_s_from_epd;
static PyObject *__pyx_n_s_from_mask;
static PyObject *__pyx_n_s_from_square;
static PyObject *__pyx_n_u_from_square;
static PyObject *__pyx_n_s_from_symbol;
static PyObject *__pyx_n_s_from_uci;
static PyObject *__pyx_kp_u_full_move_number_must_be_positiv;
static PyObject *__pyx_n_s_fullmove_number;
static PyObject *__pyx_n_u_g;
static PyObject *__pyx_n_s_generate_castling_moves;
static PyObject *__pyx_n_s_generate_evasions;
static PyObject *__pyx_n_s_generate_legal_ep;
static PyObject *__pyx_n_s_generate_legal_moves;
static PyObject *__pyx_n_s_generate_pseudo_legal_ep;
static PyObject *__pyx_n_s_generate_pseudo_legal_moves;
static PyObject *__pyx_n_s_genexpr;
static PyObject *__pyx_n_s_getstate;
static PyObject *__pyx_n_s_group;
static PyObject *__pyx_n_u_h;
static PyObject *__pyx_kp_u_half_move_clock_can_not_be_negat;
static PyObject *__pyx_n_s_halfmove_clock;
static PyObject *__pyx_n_s_has_legal_en_passant;
static PyObject *__pyx_n_s_has_pseudo_legal_en_passant;
static PyObject *__pyx_n_s_hash;
static PyObject *__pyx_n_s_hex;
static PyObject *__pyx_n_u_hmvc;
static PyObject *__pyx_n_s_iand;
static PyObject *__pyx_n_s_id;
static PyObject *__pyx_n_s_ignore_castling;
static PyObject *__pyx_n_s_ignore_counters;
static PyObject *__pyx_n_s_ignore_turn;
static PyObject *__pyx_kp_u_illegal_move_in_position;
static PyObject *__pyx_kp_u_illegal_san_in;
static PyObject *__pyx_kp_u_illegal_uci_in;
static PyObject *__pyx_n_s_ilshift;
static PyObject *__pyx_n_s_import;
static PyObject *__pyx_n_s_index;
static PyObject *__pyx_n_s_index_2;
static PyObject *__pyx_n_s_init;
static PyObject *__pyx_n_s_int;
static PyObject *__pyx_n_s_intersection;
static PyObject *__pyx_n_s_intersection_update;
static PyObject *__pyx_kp_u_invalid_castling_fen;
static PyObject *__pyx_kp_u_invalid_castling_part_in_fen;
static PyObject *__pyx_kp_u_invalid_character_in_position_pa;
static PyObject *__pyx_kp_u_invalid_en_passant_part_in_fen;
static PyObject *__pyx_kp_u_invalid_san;
static PyObject *__pyx_n_s_invert;
static PyObject *__pyx_n_s_invert_color;
static PyObject *__pyx_n_s_ior;
static PyObject *__pyx_n_s_irshift;
static PyObject *__pyx_n_s_is_attacked_by;
static PyObject *__pyx_n_s_is_capture;
static PyObject *__pyx_n_s_is_castling;
static PyObject *__pyx_n_s_is_check;
static PyObject *__pyx_n_s_is_checkmate;
static PyObject *__pyx_n_s_is_en_passant;
static PyObject *__pyx_n_s_is_fivefold_repetition;
static PyObject *__pyx_n_s_is_insufficient_material;
static PyObject *__pyx_n_s_is_into_check;
static PyObject *__pyx_n_s_is_irreversible;
static PyObject *__pyx_n_s_is_kingside_castling;
static PyObject *__pyx_n_s_is_legal;
static PyObject *__pyx_n_s_is_pseudo_legal;
static PyObject *__pyx_n_s_is_queenside_castling;
static PyObject *__pyx_n_s_is_safe;
static PyObject *__pyx_n_s_is_seventyfive_moves;
static PyObject *__pyx_n_s_is_variant_draw;
static PyObject *__pyx_n_s_is_variant_end;
static PyObject *__pyx_n_s_is_variant_loss;
static PyObject *__pyx_n_s_is_variant_win;
static PyObject *__pyx_n_s_is_zeroing;
static PyObject *__pyx_n_s_isdisjoint;
static PyObject *__pyx_n_s_islower;
static PyObject *__pyx_n_s_issubset;
static PyObject *__pyx_n_s_issuperset;
static PyObject *__pyx_n_s_isub;
static PyObject *__pyx_n_s_isupper;
static PyObject *__pyx_n_s_items;
static PyObject *__pyx_n_s_iter;
static PyObject *__pyx_n_u_iter;
static PyObject *__pyx_n_s_itertools;
static PyObject *__pyx_n_s_ixor;
static PyObject *__pyx_n_u_k;
static PyObject *__pyx_n_s_king;
static PyObject *__pyx_n_u_king;
static PyObject *__pyx_n_s_king_to;
static PyObject *__pyx_n_s_kings;
static PyObject *__pyx_n_u_knight;
static PyObject *__pyx_n_s_knights;
static PyObject *__pyx_n_s_l;
static PyObject *__pyx_n_s_lastmove;
static PyObject *__pyx_n_u_legal;
static PyObject *__pyx_n_s_len;
static PyObject *__pyx_n_s_long_notation;
static PyObject *__pyx_n_s_lower;
static PyObject *__pyx_n_s_lsb;
static PyObject *__pyx_n_s_lshift;
static PyObject *__pyx_n_s_main;
static PyObject *__pyx_n_s_make_board;
static PyObject *__pyx_n_s_mask;
static PyObject *__pyx_n_s_mask_table;
static PyObject *__pyx_n_s_match;
static PyObject *__pyx_n_s_metaclass;
static PyObject *__pyx_n_s_mirror;
static PyObject *__pyx_n_s_module;
static PyObject *__pyx_n_s_move;
static PyObject *__pyx_n_s_move_stack;
static PyObject *__pyx_n_s_msb;
static PyObject *__pyx_n_u_n;
static PyObject *__pyx_n_s_name;
static PyObject *__pyx_n_s_ne;
static PyObject *__pyx_n_s_ne_2;
static PyObject *__pyx_n_s_new;
static PyObject *__pyx_kp_u_not_after_piece_in_position_par;
static PyObject *__pyx_n_s_null;
static PyObject *__pyx_n_u_numeric;
static PyObject *__pyx_n_s_occupied;
static PyObject *__pyx_n_s_occupied_b;
static PyObject *__pyx_n_s_occupied_co;
static PyObject *__pyx_n_s_occupied_w;
static PyObject *__pyx_n_s_one_king;
static PyObject *__pyx_n_u_opcode;
static PyObject *__pyx_n_s_operation_part;
static PyObject *__pyx_n_s_or;
static PyObject *__pyx_n_s_other;
static PyObject *__pyx_n_s_others;
static PyObject *__pyx_n_u_p;
static PyObject *__pyx_n_s_parse_epd_ops;
static PyObject *__pyx_n_s_parse_san;
static PyObject *__pyx_n_s_parse_san_locals_genexpr;
static PyObject *__pyx_n_s_parse_uci;
static PyObject *__pyx_n_s_path;
static PyObject *__pyx_n_u_pawn;
static PyObject *__pyx_n_s_pawnless_tbw_magic;
static PyObject *__pyx_n_s_pawnless_tbw_suffix;
static PyObject *__pyx_n_s_pawnless_tbz_magic;
static PyObject *__pyx_n_s_pawnless_tbz_suffix;
static PyObject *__pyx_n_s_pawns;
static PyObject *__pyx_n_s_peek;
static PyObject *__pyx_n_s_pickle;
static PyObject *__pyx_n_s_piece;
static PyObject *__pyx_n_s_piece_at;
static PyObject *__pyx_n_s_piece_type;
static PyObject *__pyx_n_s_piece_type_at;
static PyObject *__pyx_n_s_pieces_mask;
static PyObject *__pyx_n_s_pin_mask;
static PyObject *__pyx_n_s_pop;
static PyObject *__pyx_kp_u_pop_from_empty_SquareSet;
static PyObject *__pyx_n_s_popcount;
static PyObject *__pyx_n_s_prepare;
static PyObject *__pyx_n_s_print;
static PyObject *__pyx_n_s_promoted;
static PyObject *__pyx_n_s_promotion;
static PyObject *__pyx_n_u_promotion;
static PyObject *__pyx_n_s_push;
static PyObject *__pyx_n_s_push_capture;
static PyObject *__pyx_n_u_pv;
static PyObject *__pyx_n_s_pyx_PickleError;
static PyObject *__pyx_n_s_pyx_checksum;
static PyObject *__pyx_n_s_pyx_result;
static PyObject *__pyx_n_s_pyx_state;
static PyObject *__pyx_n_s_pyx_type;
static PyObject *__pyx_n_s_pyx_unpickle_BaseBoard;
static PyObject *__pyx_n_s_pyx_unpickle_Board;
static PyObject *__pyx_n_s_pyx_unpickle_LegalMoveGenerato;
static PyObject *__pyx_n_s_pyx_unpickle_Move;
static PyObject *__pyx_n_s_pyx_unpickle_PseudoLegalMoveGe;
static PyObject *__pyx_n_u_q;
static PyObject *__pyx_kp_b_q_2;
static PyObject *__pyx_n_s_qualname;
static PyObject *__pyx_n_u_queen;
static PyObject *__pyx_n_s_queens;
static PyObject *__pyx_n_s_r;
static PyObject *__pyx_n_u_r;
static PyObject *__pyx_n_s_range;
static PyObject *__pyx_n_s_rank_index;
static PyObject *__pyx_n_s_rays;
static PyObject *__pyx_n_s_rays_2;
static PyObject *__pyx_n_s_rays_row;
static PyObject *__pyx_n_s_re;
static PyObject *__pyx_n_s_reduce;
static PyObject *__pyx_n_s_reduce_cython;
static PyObject *__pyx_n_s_reduce_ex;
static PyObject *__pyx_n_s_remove;
static PyObject *__pyx_n_s_remove_piece_at;
static PyObject *__pyx_n_s_remove_piece_at_2;
static PyObject *__pyx_n_s_repr;
static PyObject *__pyx_n_s_repr___locals_genexpr;
static PyObject *__pyx_n_s_repr_svg;
static PyObject *__pyx_n_s_reset;
static PyObject *__pyx_n_s_reset_board;
static PyObject *__pyx_n_s_reset_board_2;
static PyObject *__pyx_n_s_restore;
static PyObject *__pyx_n_s_reversed;
static PyObject *__pyx_kp_u_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP;
static PyObject *__pyx_kp_u_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP_2;
static PyObject *__pyx_n_u_rook;
static PyObject *__pyx_n_s_rook_bb;
static PyObject *__pyx_n_s_rooks;
static PyObject *__pyx_n_s_rshift;
static PyObject *__pyx_n_s_rstrip;
static PyObject *__pyx_kp_u_rtbw;
static PyObject *__pyx_kp_u_rtbz;
static PyObject *__pyx_n_s_san;
static PyObject *__pyx_n_u_san;
static PyObject *__pyx_n_s_scan_forward;
static PyObject *__pyx_n_s_scan_reversed;
static PyObject *__pyx_n_s_self;
static PyObject *__pyx_n_s_send;
static PyObject *__pyx_n_s_set_board_fen;
static PyObject *__pyx_n_s_set_board_fen_2;
static PyObject *__pyx_n_s_set_castling_fen;
static PyObject *__pyx_n_s_set_chess960_pos;
static PyObject *__pyx_n_s_set_chess960_pos_2;
static PyObject *__pyx_n_s_set_epd;
static PyObject *__pyx_n_s_set_epd_locals_lambda;
static PyObject *__pyx_n_s_set_fen;
static PyObject *__pyx_n_s_set_piece_at;
static PyObject *__pyx_n_s_set_piece_at_2;
static PyObject *__pyx_n_s_set_piece_map;
static PyObject *__pyx_n_s_set_piece_map_2;
static PyObject *__pyx_n_s_setstate;
static PyObject *__pyx_n_s_setstate_cython;
static PyObject *__pyx_n_s_shift;
static PyObject *__pyx_n_s_shift_2_down;
static PyObject *__pyx_n_s_shift_2_left;
static PyObject *__pyx_n_s_shift_2_right;
static PyObject *__pyx_n_s_shift_2_up;
static PyObject *__pyx_n_s_shift_down;
static PyObject *__pyx_n_s_shift_down_left;
static PyObject *__pyx_n_s_shift_down_right;
static PyObject *__pyx_n_s_shift_left;
static PyObject *__pyx_n_s_shift_right;
static PyObject *__pyx_n_s_shift_up;
static PyObject *__pyx_n_s_shift_up_left;
static PyObject *__pyx_n_s_shift_up_right;
static PyObject *__pyx_n_s_shredder;
static PyObject *__pyx_n_s_shredder_fen;
static PyObject *__pyx_n_s_size;
static PyObject *__pyx_n_s_slider_blockers;
static PyObject *__pyx_n_s_sliding_attacks;
static PyObject *__pyx_n_s_split;
static PyObject *__pyx_n_s_sq;
static PyObject *__pyx_n_s_square;
static PyObject *__pyx_n_s_square_distance;
static PyObject *__pyx_n_s_square_file;
static PyObject *__pyx_n_s_square_mirror;
static PyObject *__pyx_n_s_square_name;
static PyObject *__pyx_n_s_square_rank;
static PyObject *__pyx_n_s_squares;
static PyObject *__pyx_n_s_stack;
static PyObject *__pyx_n_s_starting_fen;
static PyObject *__pyx_n_s_status;
static PyObject *__pyx_n_s_step_attacks;
static PyObject *__pyx_n_s_str;
static PyObject *__pyx_n_u_string;
static PyObject *__pyx_n_u_string_escape;
static PyObject *__pyx_kp_s_stringsource;
static PyObject *__pyx_n_s_strip;
static PyObject *__pyx_n_s_sub;
static PyObject *__pyx_n_s_subset;
static PyObject *__pyx_n_s_super;
static PyObject *__pyx_n_s_svg;
static PyObject *__pyx_n_s_swapcase;
static PyObject *__pyx_n_s_symbol;
static PyObject *__pyx_n_s_symmetric_difference;
static PyObject *__pyx_n_s_symmetric_difference_update;
static PyObject *__pyx_n_s_t;
static PyObject *__pyx_n_s_tbw_magic;
static PyObject *__pyx_n_s_tbw_suffix;
static PyObject *__pyx_n_s_tbz_magic;
static PyObject *__pyx_n_s_tbz_suffix;
static PyObject *__pyx_n_s_test;
static PyObject *__pyx_n_s_throw;
static PyObject *__pyx_n_s_to_chess960;
static PyObject *__pyx_n_s_to_mask;
static PyObject *__pyx_n_s_to_square;
static PyObject *__pyx_n_u_to_square;
static PyObject *__pyx_n_s_tolist;
static PyObject *__pyx_n_s_transform;
static PyObject *__pyx_n_s_transposition_key;
static PyObject *__pyx_n_s_turn;
static PyObject *__pyx_kp_u_two_subsequent_digits_in_positio;
static PyObject *__pyx_n_s_uci;
static PyObject *__pyx_n_s_uci_variant;
static PyObject *__pyx_n_s_unicode_symbol;
static PyObject *__pyx_n_s_union;
static PyObject *__pyx_n_s_update;
static PyObject *__pyx_n_s_upper;
static PyObject *__pyx_n_s_valid_ep_square;
static PyObject *__pyx_n_s_version;
static PyObject *__pyx_n_u_w;
static PyObject *__pyx_n_s_was_into_check;
static PyObject *__pyx_n_s_was_promoted;
static PyObject *__pyx_n_u_x;
static PyObject *__pyx_n_u_xfen;
static PyObject *__pyx_n_s_xor;
static PyObject *__pyx_pf_5chess_10__init__cp_square(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_file_index, PyObject *__pyx_v_rank_index); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_2square_file(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4square_rank(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_6square_name(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_8square_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_10square_mirror(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_12lsb(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_14scan_forward(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_17msb(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_19scan_reversed(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb, PyObject *__pyx_v__BB_SQUARES); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_22popcount(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb, PyObject *__pyx_v__bin); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_24flip_vertical(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_26flip_horizontal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_28flip_diagonal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_30flip_anti_diagonal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_32shift_down(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_34shift_2_down(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_36shift_up(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_38shift_2_up(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_40shift_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_42shift_2_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_44shift_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_46shift_2_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_48shift_up_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_50shift_up_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_52shift_down_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_54shift_down_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_56_sliding_attacks(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square, PyObject *__pyx_v_occupied, PyObject *__pyx_v_deltas); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_58_step_attacks(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square, PyObject *__pyx_v_deltas); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_60_edges(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_62_carry_rippler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_65_attack_table(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_deltas); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_67_rays(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_2symbol(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_4unicode_symbol(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_invert_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_6__hash__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_8__repr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_10__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_12_repr_svg_(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_14__eq__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_16__ne__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_18from_symbol(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_symbol); /* proto */
static int __pyx_pf_5chess_10__init__cp_4Move___init__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, int __pyx_v_from_square, int __pyx_v_to_square, PyObject *__pyx_v_promotion, PyObject *__pyx_v_drop); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_2uci(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static int __pyx_pf_5chess_10__init__cp_4Move_4__bool__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_6__eq__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_8__ne__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_10__repr__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_12__str__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static Py_hash_t __pyx_pf_5chess_10__init__cp_4Move_14__hash__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_16__copy__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_18__deepcopy__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v_memo); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_20from_uci(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_uci); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_22null(PyTypeObject *__pyx_v_cls); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_24__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_4Move_26__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
static int __pyx_pf_5chess_10__init__cp_9BaseBoard___init__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_board_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_2_reset_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_4reset_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_6_clear_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_8clear_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_10pieces_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_12pieces(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_14piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_16piece_type_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_18king(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_20attacks_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_22attacks(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_24_attackers_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square, PyObject *__pyx_v_occupied); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_26attackers_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_28is_attacked_by(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_30attackers(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_32pin_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_34pin(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_36is_pinned(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_38_remove_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_40remove_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_42_set_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color, PyObject *__pyx_v_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_44set_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square, PyObject *__pyx_v_piece, PyObject *__pyx_v_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_46board_fen(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_48_set_board_fen(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_50set_board_fen(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_52piece_map(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_54_set_piece_map(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_pieces); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_56set_piece_map(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_pieces); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_58_set_chess960_pos(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_sharnagl); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_60set_chess960_pos(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_sharnagl); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_62chess960_pos(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_64__repr__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_66__str__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_68unicode(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_invert_color, PyObject *__pyx_v_borders); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_70_repr_svg_(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_72__eq__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_74__ne__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_76apply_transform(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_f); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_78transform(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_f); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_80mirror(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_82copy(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_84__copy__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_86__deepcopy__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_memo); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_88empty(PyTypeObject *__pyx_v_cls); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_90from_chess960_pos(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_92__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_94__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_11_BoardState___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_11_BoardState_2restore(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static int __pyx_pf_5chess_10__init__cp_5Board___init__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_fen, PyObject *__pyx_v_chess960); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_2reset(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_4reset_board(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_6clear(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_8clear_board(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_10clear_stack(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_12root(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_14remove_piece_at(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_16set_piece_at(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_square, PyObject *__pyx_v_piece, PyObject *__pyx_v_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_18generate_pseudo_legal_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_21generate_pseudo_legal_ep(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_24generate_pseudo_legal_captures(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_26is_check(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_28is_into_check(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_30was_into_check(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_32is_pseudo_legal(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_34is_legal(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_36is_variant_end(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_38is_variant_loss(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_40is_variant_win(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_42is_variant_draw(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_44is_game_over(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_claim_draw); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_46result(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_claim_draw); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_48is_checkmate(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_50is_stalemate(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_52is_insufficient_material(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_54is_seventyfive_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_56is_fivefold_repetition(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_58can_claim_draw(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_60can_claim_fifty_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_62can_claim_threefold_repetition(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_64_push_capture(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_move, CYTHON_UNUSED PyObject *__pyx_v_capture_square, CYTHON_UNUSED PyObject *__pyx_v_piece_type, CYTHON_UNUSED PyObject *__pyx_v_was_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_66push(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_68pop(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_70peek(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_72castling_shredder_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_13castling_xfen_genexpr(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_74castling_xfen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_76has_pseudo_legal_en_passant(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_78has_legal_en_passant(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_80fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_shredder, PyObject *__pyx_v_en_passant, PyObject *__pyx_v_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_82shredder_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_en_passant, PyObject *__pyx_v_promoted); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_84set_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_86_set_castling_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_castling_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_88set_castling_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_castling_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_90set_board_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_fen); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_92set_piece_map(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_pieces); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_94set_chess960_pos(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_sharnagl); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_96chess960_pos(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_ignore_turn, PyObject *__pyx_v_ignore_castling, PyObject *__pyx_v_ignore_counters); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_98_epd_operations(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_operations); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_100epd(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_shredder, PyObject *__pyx_v_en_passant, PyObject *__pyx_v_promoted, PyObject *__pyx_v_operations); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_102_parse_epd_ops(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_operation_part, PyObject *__pyx_v_make_board); /* proto */
static PyObject *__pyx_lambda_funcdef_lambda1(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_104set_epd(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_epd); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_106san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_108lan(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_110_algebraic(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move, PyObject *__pyx_v_long_notation); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_112variation_san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_variation); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_9parse_san_genexpr(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_9parse_san_3genexpr(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_114parse_san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_san); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_116push_san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_san); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_118uci(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move, PyObject *__pyx_v_chess960); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_120parse_uci(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_uci); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_122push_uci(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_uci); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_124is_en_passant(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_126is_capture(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_128is_zeroing(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_130is_irreversible(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_132is_castling(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_134is_kingside_castling(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_136is_queenside_castling(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_138clean_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_140has_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_142has_kingside_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, int __pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_144has_queenside_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_color); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_146has_chess960_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_148status(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_150_valid_ep_square(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_152is_valid(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_154_ep_skewered(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king, PyObject *__pyx_v_capturer); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_156_slider_blockers(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_158_is_safe(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king, PyObject *__pyx_v_blockers, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_160_generate_evasions(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king, PyObject *__pyx_v_checkers, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_163generate_legal_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_166generate_legal_ep(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_169generate_legal_captures(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_18_attacked_for_king_genexpr(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_171_attacked_for_king(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_path, PyObject *__pyx_v_occupied); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_173_castling_uncovers_rank_attack(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_rook_bb, PyObject *__pyx_v_king_to); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_175generate_castling_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_178_from_chess960(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_chess960, PyObject *__pyx_v_from_square, PyObject *__pyx_v_to_square, PyObject *__pyx_v_promotion, PyObject *__pyx_v_drop); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_180_to_chess960(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_182_transposition_key(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_184__repr__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_186_repr_svg_(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_188__ne__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_190apply_transform(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_f); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_192transform(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_f); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_194mirror(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_196copy(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_stack); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_198empty(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_chess960); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_200from_epd(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_epd, PyObject *__pyx_v_chess960); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_202from_chess960_pos(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_204__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_5Board_206__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
static int __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator___init__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static int __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_2__bool__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_4count(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_6__iter__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self); /* proto */
static int __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_8__contains__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_10__repr__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_12__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_14__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
static int __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator___init__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_board); /* proto */
static int __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_2__bool__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_4count(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_6__iter__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self); /* proto */
static int __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_8__contains__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_move); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_8__repr___genexpr(PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_10__repr__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_12__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_14__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_79__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_squares); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_2__contains__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_4__iter__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_6__reversed__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_8__len__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_10add(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_12discard(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_14isdisjoint(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_16issubset(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_18issuperset(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_20union(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_22__or__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_24intersection(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_26__and__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_28difference(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_30__sub__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_32symmetric_difference(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_34__xor__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_36copy(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_38update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_others); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_40__ior__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_42intersection_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_others); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_44__iand__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_46difference_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_48__isub__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_50symmetric_difference_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_52__ixor__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_54remove(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_56pop(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_58clear(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_60carry_rippler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_62mirror(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_64tolist(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_66__bool__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_68__eq__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_70__ne__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_72__lshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_74__rshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_76__ilshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_78__irshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_80__invert__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_82__int__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_84__index__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_86__repr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_88__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_90_repr_svg_(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_92from_square(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_square); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_69__pyx_unpickle_Move(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_71__pyx_unpickle_BaseBoard(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_73__pyx_unpickle_Board(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_75__pyx_unpickle_PseudoLegalMoveGenerator(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_5chess_10__init__cp_77__pyx_unpickle_LegalMoveGenerator(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_tp_new_5chess_10__init__cp_Move(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp_BaseBoard(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp_Board(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp_PseudoLegalMoveGenerator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp_LegalMoveGenerator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct__scan_forward(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_6_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_7_set_epd(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_8_parse_san(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_9_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_10_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_15_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_17___repr__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_18_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static __Pyx_CachedCFunction __pyx_umethod_PyList_Type_pop = {0, &__pyx_n_s_pop, 0, 0, 0};
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_2;
static PyObject *__pyx_int_3;
static PyObject *__pyx_int_4;
static PyObject *__pyx_int_5;
static PyObject *__pyx_int_6;
static PyObject *__pyx_int_7;
static PyObject *__pyx_int_8;
static PyObject *__pyx_int_9;
static PyObject *__pyx_int_10;
static PyObject *__pyx_int_14;
static PyObject *__pyx_int_15;
static PyObject *__pyx_int_16;
static PyObject *__pyx_int_17;
static PyObject *__pyx_int_18;
static PyObject *__pyx_int_28;
static PyObject *__pyx_int_32;
static PyObject *__pyx_int_36;
static PyObject *__pyx_int_45;
static PyObject *__pyx_int_56;
static PyObject *__pyx_int_64;
static PyObject *__pyx_int_96;
static PyObject *__pyx_int_128;
static PyObject *__pyx_int_255;
static PyObject *__pyx_int_256;
static PyObject *__pyx_int_400;
static PyObject *__pyx_int_512;
static PyObject *__pyx_int_959;
static PyObject *__pyx_int_1024;
static PyObject *__pyx_int_2048;
static PyObject *__pyx_int_4096;
static PyObject *__pyx_int_8192;
static PyObject *__pyx_int_16384;
static PyObject *__pyx_int_56827727;
static PyObject *__pyx_int_95108563;
static PyObject *__pyx_int_222419149;
static PyObject *__pyx_int_4294967295;
static PyObject *__pyx_int_281470681808895;
static PyObject *__pyx_int_71777214294589695;
static PyObject *__pyx_int_72340172838076673;
static PyObject *__pyx_int_1085102592318504960;
static PyObject *__pyx_int_1085102592571150095;
static PyObject *__pyx_int_3689292520605548544;
static PyObject *__pyx_int_3689348814741910323;
static PyObject *__pyx_int_6124988953138320640;
static PyObject *__pyx_int_6148914691236517205;
static PyObject *__pyx_int_6172840429334713770;
static PyObject *__pyx_int_12249977906276641280;
static PyObject *__pyx_int_12273903644374837845;
static PyObject *__pyx_int_14757170082422194176;
static PyObject *__pyx_int_17361641477348724495;
static PyObject *__pyx_int_neg_1;
static PyObject *__pyx_int_neg_6;
static PyObject *__pyx_int_neg_7;
static PyObject *__pyx_int_neg_8;
static PyObject *__pyx_int_neg_9;
static PyObject *__pyx_int_neg_10;
static PyObject *__pyx_int_neg_15;
static PyObject *__pyx_int_neg_16;
static PyObject *__pyx_int_neg_17;
static PyObject *__pyx_k__2;
static PyObject *__pyx_k__10;
static PyObject *__pyx_k__25;
static PyObject *__pyx_k__27;
static PyObject *__pyx_k__28;
static PyObject *__pyx_k__29;
static PyObject *__pyx_k__30;
static PyObject *__pyx_k__31;
static PyObject *__pyx_k__32;
static PyObject *__pyx_k__50;
static PyObject *__pyx_k__51;
static PyObject *__pyx_k__52;
static PyObject *__pyx_k__53;
static PyObject *__pyx_k__54;
static PyObject *__pyx_k__55;
static PyObject *__pyx_k__56;
static PyObject *__pyx_k__57;
static PyObject *__pyx_k__58;
static PyObject *__pyx_k__59;
static PyObject *__pyx_codeobj_;
static PyObject *__pyx_slice__6;
static PyObject *__pyx_slice__7;
static PyObject *__pyx_slice__8;
static PyObject *__pyx_tuple__9;
static PyObject *__pyx_slice__26;
static PyObject *__pyx_tuple__17;
static PyObject *__pyx_tuple__24;
static PyObject *__pyx_tuple__43;
static PyObject *__pyx_tuple__61;
static PyObject *__pyx_tuple__63;
static PyObject *__pyx_tuple__64;
static PyObject *__pyx_tuple__77;
static PyObject *__pyx_tuple__78;
static PyObject *__pyx_tuple__80;
static PyObject *__pyx_tuple__82;
static PyObject *__pyx_tuple__84;
static PyObject *__pyx_tuple__86;
static PyObject *__pyx_tuple__88;
static PyObject *__pyx_tuple__90;
static PyObject *__pyx_tuple__92;
static PyObject *__pyx_tuple__93;
static PyObject *__pyx_tuple__95;
static PyObject *__pyx_tuple__96;
static PyObject *__pyx_tuple__98;
static PyObject *__pyx_codeobj__3;
static PyObject *__pyx_codeobj__4;
static PyObject *__pyx_tuple__100;
static PyObject *__pyx_tuple__102;
static PyObject *__pyx_tuple__104;
static PyObject *__pyx_tuple__106;
static PyObject *__pyx_tuple__108;
static PyObject *__pyx_tuple__110;
static PyObject *__pyx_tuple__112;
static PyObject *__pyx_tuple__114;
static PyObject *__pyx_tuple__116;
static PyObject *__pyx_tuple__118;
static PyObject *__pyx_tuple__120;
static PyObject *__pyx_tuple__122;
static PyObject *__pyx_tuple__124;
static PyObject *__pyx_tuple__126;
static PyObject *__pyx_tuple__128;
static PyObject *__pyx_tuple__130;
static PyObject *__pyx_tuple__132;
static PyObject *__pyx_tuple__134;
static PyObject *__pyx_tuple__136;
static PyObject *__pyx_tuple__137;
static PyObject *__pyx_tuple__139;
static PyObject *__pyx_tuple__141;
static PyObject *__pyx_tuple__142;
static PyObject *__pyx_tuple__143;
static PyObject *__pyx_tuple__145;
static PyObject *__pyx_tuple__147;
static PyObject *__pyx_tuple__149;
static PyObject *__pyx_tuple__151;
static PyObject *__pyx_tuple__153;
static PyObject *__pyx_tuple__155;
static PyObject *__pyx_tuple__157;
static PyObject *__pyx_tuple__159;
static PyObject *__pyx_tuple__161;
static PyObject *__pyx_tuple__163;
static PyObject *__pyx_tuple__165;
static PyObject *__pyx_tuple__167;
static PyObject *__pyx_tuple__169;
static PyObject *__pyx_tuple__171;
static PyObject *__pyx_tuple__173;
static PyObject *__pyx_tuple__175;
static PyObject *__pyx_tuple__177;
static PyObject *__pyx_tuple__179;
static PyObject *__pyx_tuple__181;
static PyObject *__pyx_tuple__183;
static PyObject *__pyx_tuple__185;
static PyObject *__pyx_tuple__187;
static PyObject *__pyx_tuple__189;
static PyObject *__pyx_tuple__191;
static PyObject *__pyx_tuple__193;
static PyObject *__pyx_tuple__195;
static PyObject *__pyx_tuple__197;
static PyObject *__pyx_tuple__199;
static PyObject *__pyx_tuple__201;
static PyObject *__pyx_tuple__203;
static PyObject *__pyx_tuple__205;
static PyObject *__pyx_tuple__207;
static PyObject *__pyx_tuple__209;
static PyObject *__pyx_tuple__211;
static PyObject *__pyx_tuple__213;
static PyObject *__pyx_tuple__215;
static PyObject *__pyx_tuple__217;
static PyObject *__pyx_tuple__219;
static PyObject *__pyx_tuple__221;
static PyObject *__pyx_tuple__223;
static PyObject *__pyx_tuple__225;
static PyObject *__pyx_tuple__227;
static PyObject *__pyx_tuple__229;
static PyObject *__pyx_tuple__231;
static PyObject *__pyx_tuple__233;
static PyObject *__pyx_tuple__235;
static PyObject *__pyx_tuple__237;
static PyObject *__pyx_tuple__239;
static PyObject *__pyx_tuple__241;
static PyObject *__pyx_tuple__243;
static PyObject *__pyx_tuple__245;
static PyObject *__pyx_tuple__247;
static PyObject *__pyx_tuple__249;
static PyObject *__pyx_tuple__251;
static PyObject *__pyx_tuple__253;
static PyObject *__pyx_tuple__255;
static PyObject *__pyx_tuple__257;
static PyObject *__pyx_tuple__259;
static PyObject *__pyx_tuple__261;
static PyObject *__pyx_tuple__263;
static PyObject *__pyx_tuple__265;
static PyObject *__pyx_tuple__267;
static PyObject *__pyx_tuple__269;
static PyObject *__pyx_codeobj__79;
static PyObject *__pyx_codeobj__81;
static PyObject *__pyx_codeobj__83;
static PyObject *__pyx_codeobj__85;
static PyObject *__pyx_codeobj__87;
static PyObject *__pyx_codeobj__89;
static PyObject *__pyx_codeobj__91;
static PyObject *__pyx_codeobj__94;
static PyObject *__pyx_codeobj__97;
static PyObject *__pyx_codeobj__99;
static PyObject *__pyx_codeobj__101;
static PyObject *__pyx_codeobj__103;
static PyObject *__pyx_codeobj__105;
static PyObject *__pyx_codeobj__107;
static PyObject *__pyx_codeobj__109;
static PyObject *__pyx_codeobj__111;
static PyObject *__pyx_codeobj__113;
static PyObject *__pyx_codeobj__115;
static PyObject *__pyx_codeobj__117;
static PyObject *__pyx_codeobj__119;
static PyObject *__pyx_codeobj__121;
static PyObject *__pyx_codeobj__123;
static PyObject *__pyx_codeobj__125;
static PyObject *__pyx_codeobj__127;
static PyObject *__pyx_codeobj__129;
static PyObject *__pyx_codeobj__131;
static PyObject *__pyx_codeobj__133;
static PyObject *__pyx_codeobj__135;
static PyObject *__pyx_codeobj__138;
static PyObject *__pyx_codeobj__140;
static PyObject *__pyx_codeobj__144;
static PyObject *__pyx_codeobj__146;
static PyObject *__pyx_codeobj__148;
static PyObject *__pyx_codeobj__150;
static PyObject *__pyx_codeobj__152;
static PyObject *__pyx_codeobj__154;
static PyObject *__pyx_codeobj__156;
static PyObject *__pyx_codeobj__158;
static PyObject *__pyx_codeobj__160;
static PyObject *__pyx_codeobj__162;
static PyObject *__pyx_codeobj__164;
static PyObject *__pyx_codeobj__166;
static PyObject *__pyx_codeobj__168;
static PyObject *__pyx_codeobj__170;
static PyObject *__pyx_codeobj__172;
static PyObject *__pyx_codeobj__174;
static PyObject *__pyx_codeobj__176;
static PyObject *__pyx_codeobj__178;
static PyObject *__pyx_codeobj__180;
static PyObject *__pyx_codeobj__182;
static PyObject *__pyx_codeobj__184;
static PyObject *__pyx_codeobj__186;
static PyObject *__pyx_codeobj__188;
static PyObject *__pyx_codeobj__190;
static PyObject *__pyx_codeobj__192;
static PyObject *__pyx_codeobj__194;
static PyObject *__pyx_codeobj__196;
static PyObject *__pyx_codeobj__198;
static PyObject *__pyx_codeobj__200;
static PyObject *__pyx_codeobj__202;
static PyObject *__pyx_codeobj__204;
static PyObject *__pyx_codeobj__206;
static PyObject *__pyx_codeobj__208;
static PyObject *__pyx_codeobj__210;
static PyObject *__pyx_codeobj__212;
static PyObject *__pyx_codeobj__214;
static PyObject *__pyx_codeobj__216;
static PyObject *__pyx_codeobj__218;
static PyObject *__pyx_codeobj__220;
static PyObject *__pyx_codeobj__222;
static PyObject *__pyx_codeobj__224;
static PyObject *__pyx_codeobj__226;
static PyObject *__pyx_codeobj__228;
static PyObject *__pyx_codeobj__230;
static PyObject *__pyx_codeobj__232;
static PyObject *__pyx_codeobj__234;
static PyObject *__pyx_codeobj__236;
static PyObject *__pyx_codeobj__238;
static PyObject *__pyx_codeobj__240;
static PyObject *__pyx_codeobj__242;
static PyObject *__pyx_codeobj__244;
static PyObject *__pyx_codeobj__246;
static PyObject *__pyx_codeobj__248;
static PyObject *__pyx_codeobj__250;
static PyObject *__pyx_codeobj__252;
static PyObject *__pyx_codeobj__254;
static PyObject *__pyx_codeobj__256;
static PyObject *__pyx_codeobj__258;
static PyObject *__pyx_codeobj__260;
static PyObject *__pyx_codeobj__262;
static PyObject *__pyx_codeobj__264;
static PyObject *__pyx_codeobj__266;
static PyObject *__pyx_codeobj__268;
static PyObject *__pyx_codeobj__270;
/* Late includes */

/* "chess/__init__cp.pyx":126
 * SQUARE_NAMES = [f + r for r in RANK_NAMES for f in FILE_NAMES]
 * 
 * def square(file_index, rank_index):             # <<<<<<<<<<<<<<
 *     """Gets a square number by file and rank index."""
 *     return rank_index * 8 + file_index
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_1square(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_square[] = "Gets a square number by file and rank index.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_1square = {"square", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_1square, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_square};
static PyObject *__pyx_pw_5chess_10__init__cp_1square(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_file_index = 0;
  PyObject *__pyx_v_rank_index = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("square (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_file_index,&__pyx_n_s_rank_index,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_file_index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rank_index)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("square", 1, 2, 2, 1); __PYX_ERR(0, 126, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "square") < 0)) __PYX_ERR(0, 126, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_file_index = values[0];
    __pyx_v_rank_index = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("square", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 126, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.square", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_square(__pyx_self, __pyx_v_file_index, __pyx_v_rank_index);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_square(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_file_index, PyObject *__pyx_v_rank_index) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("square", 0);

  /* "chess/__init__cp.pyx":128
 * def square(file_index, rank_index):
 *     """Gets a square number by file and rank index."""
 *     return rank_index * 8 + file_index             # <<<<<<<<<<<<<<
 * 
 * def square_file(square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Multiply(__pyx_v_rank_index, __pyx_int_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 128, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_v_file_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":126
 * SQUARE_NAMES = [f + r for r in RANK_NAMES for f in FILE_NAMES]
 * 
 * def square(file_index, rank_index):             # <<<<<<<<<<<<<<
 *     """Gets a square number by file and rank index."""
 *     return rank_index * 8 + file_index
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.square", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":130
 *     return rank_index * 8 + file_index
 * 
 * def square_file(square):             # <<<<<<<<<<<<<<
 *     """Gets the file index of the square where ``0`` is the a-file."""
 *     return square & 7
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_3square_file(PyObject *__pyx_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_2square_file[] = "Gets the file index of the square where ``0`` is the a-file.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_3square_file = {"square_file", (PyCFunction)__pyx_pw_5chess_10__init__cp_3square_file, METH_O, __pyx_doc_5chess_10__init__cp_2square_file};
static PyObject *__pyx_pw_5chess_10__init__cp_3square_file(PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("square_file (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_2square_file(__pyx_self, ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_2square_file(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("square_file", 0);

  /* "chess/__init__cp.pyx":132
 * def square_file(square):
 *     """Gets the file index of the square where ``0`` is the a-file."""
 *     return square & 7             # <<<<<<<<<<<<<<
 * 
 * def square_rank(square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_AndObjC(__pyx_v_square, __pyx_int_7, 7, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":130
 *     return rank_index * 8 + file_index
 * 
 * def square_file(square):             # <<<<<<<<<<<<<<
 *     """Gets the file index of the square where ``0`` is the a-file."""
 *     return square & 7
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.square_file", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":134
 *     return square & 7
 * 
 * def square_rank(square):             # <<<<<<<<<<<<<<
 *     """Gets the rank index of the square where ``0`` is the first rank."""
 *     return square >> 3
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5square_rank(PyObject *__pyx_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_4square_rank[] = "Gets the rank index of the square where ``0`` is the first rank.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5square_rank = {"square_rank", (PyCFunction)__pyx_pw_5chess_10__init__cp_5square_rank, METH_O, __pyx_doc_5chess_10__init__cp_4square_rank};
static PyObject *__pyx_pw_5chess_10__init__cp_5square_rank(PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("square_rank (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4square_rank(__pyx_self, ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4square_rank(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("square_rank", 0);

  /* "chess/__init__cp.pyx":136
 * def square_rank(square):
 *     """Gets the rank index of the square where ``0`` is the first rank."""
 *     return square >> 3             # <<<<<<<<<<<<<<
 * 
 * def square_name(square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_square, __pyx_int_3, 3, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":134
 *     return square & 7
 * 
 * def square_rank(square):             # <<<<<<<<<<<<<<
 *     """Gets the rank index of the square where ``0`` is the first rank."""
 *     return square >> 3
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.square_rank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":138
 *     return square >> 3
 * 
 * def square_name(square):             # <<<<<<<<<<<<<<
 *     """Gets the name of the square, like ``a3``."""
 *     return SQUARE_NAMES[square]
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_7square_name(PyObject *__pyx_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_6square_name[] = "Gets the name of the square, like ``a3``.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_7square_name = {"square_name", (PyCFunction)__pyx_pw_5chess_10__init__cp_7square_name, METH_O, __pyx_doc_5chess_10__init__cp_6square_name};
static PyObject *__pyx_pw_5chess_10__init__cp_7square_name(PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("square_name (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_6square_name(__pyx_self, ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_6square_name(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("square_name", 0);

  /* "chess/__init__cp.pyx":140
 * def square_name(square):
 *     """Gets the name of the square, like ``a3``."""
 *     return SQUARE_NAMES[square]             # <<<<<<<<<<<<<<
 * 
 * def square_distance(a, b):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":138
 *     return square >> 3
 * 
 * def square_name(square):             # <<<<<<<<<<<<<<
 *     """Gets the name of the square, like ``a3``."""
 *     return SQUARE_NAMES[square]
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.square_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":142
 *     return SQUARE_NAMES[square]
 * 
 * def square_distance(a, b):             # <<<<<<<<<<<<<<
 *     """
 *     Gets the distance (i.e., the number of king steps) from square *a* to *b*.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9square_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_8square_distance[] = "\n    Gets the distance (i.e., the number of king steps) from square *a* to *b*.\n    ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9square_distance = {"square_distance", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9square_distance, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_8square_distance};
static PyObject *__pyx_pw_5chess_10__init__cp_9square_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_a = 0;
  PyObject *__pyx_v_b = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("square_distance (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_a,&__pyx_n_s_b,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("square_distance", 1, 2, 2, 1); __PYX_ERR(0, 142, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "square_distance") < 0)) __PYX_ERR(0, 142, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_a = values[0];
    __pyx_v_b = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("square_distance", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 142, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.square_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_8square_distance(__pyx_self, __pyx_v_a, __pyx_v_b);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_8square_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("square_distance", 0);

  /* "chess/__init__cp.pyx":146
 *     Gets the distance (i.e., the number of king steps) from square *a* to *b*.
 *     """
 *     return max(abs(square_file(a) - square_file(b)), abs(square_rank(a) - square_rank(b)))             # <<<<<<<<<<<<<<
 * 
 * def square_mirror(square):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_a) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_a);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_b) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_b);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyNumber_Absolute(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_square_file); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_v_a) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_a);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_file); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_b) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_b);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyNumber_Absolute(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L1_error)
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 146, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_6) {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_4 = __pyx_t_2;
  } else {
    __Pyx_INCREF(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":142
 *     return SQUARE_NAMES[square]
 * 
 * def square_distance(a, b):             # <<<<<<<<<<<<<<
 *     """
 *     Gets the distance (i.e., the number of king steps) from square *a* to *b*.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.square_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":148
 *     return max(abs(square_file(a) - square_file(b)), abs(square_rank(a) - square_rank(b)))
 * 
 * def square_mirror(square):             # <<<<<<<<<<<<<<
 *     """Mirrors the square vertically."""
 *     return square ^ 0x38
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_11square_mirror(PyObject *__pyx_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_10square_mirror[] = "Mirrors the square vertically.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_11square_mirror = {"square_mirror", (PyCFunction)__pyx_pw_5chess_10__init__cp_11square_mirror, METH_O, __pyx_doc_5chess_10__init__cp_10square_mirror};
static PyObject *__pyx_pw_5chess_10__init__cp_11square_mirror(PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("square_mirror (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_10square_mirror(__pyx_self, ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_10square_mirror(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("square_mirror", 0);

  /* "chess/__init__cp.pyx":150
 * def square_mirror(square):
 *     """Mirrors the square vertically."""
 *     return square ^ 0x38             # <<<<<<<<<<<<<<
 * 
 * SQUARES_180 = [square_mirror(sq) for sq in SQUARES]
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_XorObjC(__pyx_v_square, __pyx_int_56, 0x38, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":148
 *     return max(abs(square_file(a) - square_file(b)), abs(square_rank(a) - square_rank(b)))
 * 
 * def square_mirror(square):             # <<<<<<<<<<<<<<
 *     """Mirrors the square vertically."""
 *     return square ^ 0x38
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.square_mirror", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":199
 * 
 * 
 * def lsb(bb):             # <<<<<<<<<<<<<<
 *     return (bb & -bb).bit_length() - 1
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_13lsb(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_13lsb = {"lsb", (PyCFunction)__pyx_pw_5chess_10__init__cp_13lsb, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_13lsb(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lsb (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_12lsb(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_12lsb(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("lsb", 0);

  /* "chess/__init__cp.pyx":200
 * 
 * def lsb(bb):
 *     return (bb & -bb).bit_length() - 1             # <<<<<<<<<<<<<<
 * 
 * def scan_forward(bb):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyNumber_Negative(__pyx_v_bb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 200, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_bit_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":199
 * 
 * 
 * def lsb(bb):             # <<<<<<<<<<<<<<
 *     return (bb & -bb).bit_length() - 1
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.lsb", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_16generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":202
 *     return (bb & -bb).bit_length() - 1
 * 
 * def scan_forward(bb):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb & -bb
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_15scan_forward(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_15scan_forward = {"scan_forward", (PyCFunction)__pyx_pw_5chess_10__init__cp_15scan_forward, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_15scan_forward(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scan_forward (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_14scan_forward(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_14scan_forward(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scan_forward", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct__scan_forward(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct__scan_forward, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 202, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_bb = __pyx_v_bb;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_bb);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_bb);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_16generator, __pyx_codeobj_, (PyObject *) __pyx_cur_scope, __pyx_n_s_scan_forward, __pyx_n_s_scan_forward, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 202, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.scan_forward", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_16generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scan_forward", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 202, __pyx_L1_error)

  /* "chess/__init__cp.pyx":203
 * 
 * def scan_forward(bb):
 *     while bb:             # <<<<<<<<<<<<<<
 *         r = bb & -bb
 *         yield r.bit_length() - 1
 */
  while (1) {
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_bb); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 203, __pyx_L1_error)
    if (!__pyx_t_1) break;

    /* "chess/__init__cp.pyx":204
 * def scan_forward(bb):
 *     while bb:
 *         r = bb & -bb             # <<<<<<<<<<<<<<
 *         yield r.bit_length() - 1
 *         bb ^= r
 */
    __pyx_t_2 = PyNumber_Negative(__pyx_cur_scope->__pyx_v_bb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 204, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_And(__pyx_cur_scope->__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 204, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_r);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_r, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":205
 *     while bb:
 *         r = bb & -bb
 *         yield r.bit_length() - 1             # <<<<<<<<<<<<<<
 *         bb ^= r
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_r, __pyx_n_s_bit_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 205, __pyx_L1_error)

    /* "chess/__init__cp.pyx":206
 *         r = bb & -bb
 *         yield r.bit_length() - 1
 *         bb ^= r             # <<<<<<<<<<<<<<
 * 
 * def msb(bb):
 */
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_cur_scope->__pyx_v_bb, __pyx_cur_scope->__pyx_v_r); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 206, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_bb);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_bb, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":202
 *     return (bb & -bb).bit_length() - 1
 * 
 * def scan_forward(bb):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb & -bb
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("scan_forward", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":208
 *         bb ^= r
 * 
 * def msb(bb):             # <<<<<<<<<<<<<<
 *     return bb.bit_length() - 1
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_18msb(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_18msb = {"msb", (PyCFunction)__pyx_pw_5chess_10__init__cp_18msb, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_18msb(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("msb (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_17msb(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_17msb(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("msb", 0);

  /* "chess/__init__cp.pyx":209
 * 
 * def msb(bb):
 *     return bb.bit_length() - 1             # <<<<<<<<<<<<<<
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_bb, __pyx_n_s_bit_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 209, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 209, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 209, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":208
 *         bb ^= r
 * 
 * def msb(bb):             # <<<<<<<<<<<<<<
 *     return bb.bit_length() - 1
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.msb", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_21generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":211
 *     return bb.bit_length() - 1
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb.bit_length() - 1
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_20scan_reversed(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_20scan_reversed = {"scan_reversed", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_20scan_reversed, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_20scan_reversed(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_bb = 0;
  PyObject *__pyx_v__BB_SQUARES = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scan_reversed (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_bb,&__pyx_n_s_BB_SQUARES,0};
    PyObject* values[2] = {0,0};
    values[1] = __pyx_k__2;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_bb)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "scan_reversed") < 0)) __PYX_ERR(0, 211, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_bb = values[0];
    __pyx_v__BB_SQUARES = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("scan_reversed", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 211, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.scan_reversed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_19scan_reversed(__pyx_self, __pyx_v_bb, __pyx_v__BB_SQUARES);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_19scan_reversed(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb, PyObject *__pyx_v__BB_SQUARES) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scan_reversed", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 211, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_bb = __pyx_v_bb;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_bb);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_bb);
  __pyx_cur_scope->__pyx_v__BB_SQUARES = __pyx_v__BB_SQUARES;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v__BB_SQUARES);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v__BB_SQUARES);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_21generator1, __pyx_codeobj__3, (PyObject *) __pyx_cur_scope, __pyx_n_s_scan_reversed, __pyx_n_s_scan_reversed, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 211, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.scan_reversed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_21generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scan_reversed", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 211, __pyx_L1_error)

  /* "chess/__init__cp.pyx":212
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):
 *     while bb:             # <<<<<<<<<<<<<<
 *         r = bb.bit_length() - 1
 *         yield r
 */
  while (1) {
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_bb); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 212, __pyx_L1_error)
    if (!__pyx_t_1) break;

    /* "chess/__init__cp.pyx":213
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):
 *     while bb:
 *         r = bb.bit_length() - 1             # <<<<<<<<<<<<<<
 *         yield r
 *         bb ^= _BB_SQUARES[r]
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_bb, __pyx_n_s_bit_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_r);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_r, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":214
 *     while bb:
 *         r = bb.bit_length() - 1
 *         yield r             # <<<<<<<<<<<<<<
 *         bb ^= _BB_SQUARES[r]
 * 
 */
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_r);
    __pyx_r = __pyx_cur_scope->__pyx_v_r;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 214, __pyx_L1_error)

    /* "chess/__init__cp.pyx":215
 *         r = bb.bit_length() - 1
 *         yield r
 *         bb ^= _BB_SQUARES[r]             # <<<<<<<<<<<<<<
 * 
 * def popcount(bb, *, _bin=bin):
 */
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v__BB_SQUARES, __pyx_cur_scope->__pyx_v_r); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 215, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_cur_scope->__pyx_v_bb, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 215, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_bb);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_bb, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":211
 *     return bb.bit_length() - 1
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb.bit_length() - 1
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("scan_reversed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":217
 *         bb ^= _BB_SQUARES[r]
 * 
 * def popcount(bb, *, _bin=bin):             # <<<<<<<<<<<<<<
 *     return _bin(bb).count("1")
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_23popcount(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_23popcount = {"popcount", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_23popcount, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_23popcount(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_bb = 0;
  PyObject *__pyx_v__bin = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("popcount (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_bb,&__pyx_n_s_bin_2,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)__pyx_builtin_bin);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_bb)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "popcount") < 0)) __PYX_ERR(0, 217, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_bb = values[0];
    __pyx_v__bin = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("popcount", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 217, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.popcount", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_22popcount(__pyx_self, __pyx_v_bb, __pyx_v__bin);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_22popcount(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb, PyObject *__pyx_v__bin) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("popcount", 0);

  /* "chess/__init__cp.pyx":218
 * 
 * def popcount(bb, *, _bin=bin):
 *     return _bin(bb).count("1")             # <<<<<<<<<<<<<<
 * 
 * def flip_vertical(bb):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v__bin);
  __pyx_t_3 = __pyx_v__bin; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_bb) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_bb);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_count); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_kp_u_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":217
 *         bb ^= _BB_SQUARES[r]
 * 
 * def popcount(bb, *, _bin=bin):             # <<<<<<<<<<<<<<
 *     return _bin(bb).count("1")
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.popcount", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":220
 *     return _bin(bb).count("1")
 * 
 * def flip_vertical(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipVertically
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_25flip_vertical(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_25flip_vertical = {"flip_vertical", (PyCFunction)__pyx_pw_5chess_10__init__cp_25flip_vertical, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_25flip_vertical(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flip_vertical (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24flip_vertical(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_24flip_vertical(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("flip_vertical", 0);
  __Pyx_INCREF(__pyx_v_bb);

  /* "chess/__init__cp.pyx":222
 * def flip_vertical(bb):
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipVertically
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)             # <<<<<<<<<<<<<<
 *     bb = ((bb >> 16) & 0x0000ffff0000ffff) | ((bb & 0x0000ffff0000ffff) << 16)
 *     bb = (bb >> 32) | ((bb & 0x00000000ffffffff) << 32)
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_int_71777214294589695); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_int_71777214294589695); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":223
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipVertically
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)
 *     bb = ((bb >> 16) & 0x0000ffff0000ffff) | ((bb & 0x0000ffff0000ffff) << 16)             # <<<<<<<<<<<<<<
 *     bb = (bb >> 32) | ((bb & 0x00000000ffffffff) << 32)
 *     return bb
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_16, 16, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_1, __pyx_int_281470681808895); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 223, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_int_281470681808895); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_16, 16, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 223, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":224
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)
 *     bb = ((bb >> 16) & 0x0000ffff0000ffff) | ((bb & 0x0000ffff0000ffff) << 16)
 *     bb = (bb >> 32) | ((bb & 0x00000000ffffffff) << 32)             # <<<<<<<<<<<<<<
 *     return bb
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_32, 32, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_v_bb, __pyx_int_4294967295); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_LshiftObjC(__pyx_t_2, __pyx_int_32, 32, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 224, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Or(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":225
 *     bb = ((bb >> 16) & 0x0000ffff0000ffff) | ((bb & 0x0000ffff0000ffff) << 16)
 *     bb = (bb >> 32) | ((bb & 0x00000000ffffffff) << 32)
 *     return bb             # <<<<<<<<<<<<<<
 * 
 * def flip_horizontal(bb):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_bb);
  __pyx_r = __pyx_v_bb;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":220
 *     return _bin(bb).count("1")
 * 
 * def flip_vertical(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipVertically
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.flip_vertical", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_bb);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":227
 *     return bb
 * 
 * def flip_horizontal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#MirrorHorizontally
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_27flip_horizontal(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_27flip_horizontal = {"flip_horizontal", (PyCFunction)__pyx_pw_5chess_10__init__cp_27flip_horizontal, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_27flip_horizontal(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flip_horizontal (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_26flip_horizontal(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_26flip_horizontal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("flip_horizontal", 0);
  __Pyx_INCREF(__pyx_v_bb);

  /* "chess/__init__cp.pyx":229
 * def flip_horizontal(bb):
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#MirrorHorizontally
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)             # <<<<<<<<<<<<<<
 *     bb = ((bb >> 2) & 0x3333333333333333) | ((bb & 0x3333333333333333) << 2)
 *     bb = ((bb >> 4) & 0x0f0f0f0f0f0f0f0f) | ((bb & 0x0f0f0f0f0f0f0f0f) << 4)
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_int_6148914691236517205); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_int_6148914691236517205); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":230
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#MirrorHorizontally
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)
 *     bb = ((bb >> 2) & 0x3333333333333333) | ((bb & 0x3333333333333333) << 2)             # <<<<<<<<<<<<<<
 *     bb = ((bb >> 4) & 0x0f0f0f0f0f0f0f0f) | ((bb & 0x0f0f0f0f0f0f0f0f) << 4)
 *     return bb
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_1, __pyx_int_3689348814741910323); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_int_3689348814741910323); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":231
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)
 *     bb = ((bb >> 2) & 0x3333333333333333) | ((bb & 0x3333333333333333) << 2)
 *     bb = ((bb >> 4) & 0x0f0f0f0f0f0f0f0f) | ((bb & 0x0f0f0f0f0f0f0f0f) << 4)             # <<<<<<<<<<<<<<
 *     return bb
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_4, 4, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_int_1085102592571150095); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_int_1085102592571150095); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_4, 4, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":232
 *     bb = ((bb >> 2) & 0x3333333333333333) | ((bb & 0x3333333333333333) << 2)
 *     bb = ((bb >> 4) & 0x0f0f0f0f0f0f0f0f) | ((bb & 0x0f0f0f0f0f0f0f0f) << 4)
 *     return bb             # <<<<<<<<<<<<<<
 * 
 * def flip_diagonal(bb):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_bb);
  __pyx_r = __pyx_v_bb;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":227
 *     return bb
 * 
 * def flip_horizontal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#MirrorHorizontally
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.flip_horizontal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_bb);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":234
 *     return bb
 * 
 * def flip_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheDiagonal
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_29flip_diagonal(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_29flip_diagonal = {"flip_diagonal", (PyCFunction)__pyx_pw_5chess_10__init__cp_29flip_diagonal, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_29flip_diagonal(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flip_diagonal (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_28flip_diagonal(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_28flip_diagonal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_v_t = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("flip_diagonal", 0);
  __Pyx_INCREF(__pyx_v_bb);

  /* "chess/__init__cp.pyx":236
 * def flip_diagonal(bb):
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheDiagonal
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000             # <<<<<<<<<<<<<<
 *     bb = bb ^ (t ^ (t >> 28))
 *     t = (bb ^ (bb << 14)) & 0x3333000033330000
 */
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_bb, __pyx_int_28, 28, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 236, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_int_1085102592318504960); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_t = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":237
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheDiagonal
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000
 *     bb = bb ^ (t ^ (t >> 28))             # <<<<<<<<<<<<<<
 *     t = (bb ^ (bb << 14)) & 0x3333000033330000
 *     bb = bb ^ (t ^ (t >> 14))
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_t, __pyx_int_28, 28, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 237, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_t, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 237, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Xor(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 237, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":238
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000
 *     bb = bb ^ (t ^ (t >> 28))
 *     t = (bb ^ (bb << 14)) & 0x3333000033330000             # <<<<<<<<<<<<<<
 *     bb = bb ^ (t ^ (t >> 14))
 *     t = (bb ^ (bb << 7)) & 0x5500550055005500
 */
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_bb, __pyx_int_14, 14, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 238, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_int_3689292520605548544); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 238, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_t, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":239
 *     bb = bb ^ (t ^ (t >> 28))
 *     t = (bb ^ (bb << 14)) & 0x3333000033330000
 *     bb = bb ^ (t ^ (t >> 14))             # <<<<<<<<<<<<<<
 *     t = (bb ^ (bb << 7)) & 0x5500550055005500
 *     bb = bb ^ (t ^ (t >> 7))
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_t, __pyx_int_14, 14, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 239, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_t, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Xor(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 239, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":240
 *     t = (bb ^ (bb << 14)) & 0x3333000033330000
 *     bb = bb ^ (t ^ (t >> 14))
 *     t = (bb ^ (bb << 7)) & 0x5500550055005500             # <<<<<<<<<<<<<<
 *     bb = bb ^ (t ^ (t >> 7))
 *     return bb
 */
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_bb, __pyx_int_7, 7, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 240, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_int_6124988953138320640); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_t, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":241
 *     bb = bb ^ (t ^ (t >> 14))
 *     t = (bb ^ (bb << 7)) & 0x5500550055005500
 *     bb = bb ^ (t ^ (t >> 7))             # <<<<<<<<<<<<<<
 *     return bb
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_t, __pyx_int_7, 7, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 241, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_t, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Xor(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 241, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":242
 *     t = (bb ^ (bb << 7)) & 0x5500550055005500
 *     bb = bb ^ (t ^ (t >> 7))
 *     return bb             # <<<<<<<<<<<<<<
 * 
 * def flip_anti_diagonal(bb):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_bb);
  __pyx_r = __pyx_v_bb;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":234
 *     return bb
 * 
 * def flip_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheDiagonal
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.flip_diagonal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_t);
  __Pyx_XDECREF(__pyx_v_bb);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":244
 *     return bb
 * 
 * def flip_anti_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheAntidiagonal
 *     t = bb ^ (bb << 36)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_31flip_anti_diagonal(PyObject *__pyx_self, PyObject *__pyx_v_bb); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_31flip_anti_diagonal = {"flip_anti_diagonal", (PyCFunction)__pyx_pw_5chess_10__init__cp_31flip_anti_diagonal, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_31flip_anti_diagonal(PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flip_anti_diagonal (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_30flip_anti_diagonal(__pyx_self, ((PyObject *)__pyx_v_bb));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_30flip_anti_diagonal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bb) {
  PyObject *__pyx_v_t = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("flip_anti_diagonal", 0);
  __Pyx_INCREF(__pyx_v_bb);

  /* "chess/__init__cp.pyx":246
 * def flip_anti_diagonal(bb):
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheAntidiagonal
 *     t = bb ^ (bb << 36)             # <<<<<<<<<<<<<<
 *     bb = bb ^ ((t ^ (bb >> 36)) & 0xf0f0f0f00f0f0f0f)
 *     t = (bb ^ (bb << 18)) & 0xcccc0000cccc0000
 */
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_bb, __pyx_int_36, 36, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 246, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 246, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_t = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":247
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheAntidiagonal
 *     t = bb ^ (bb << 36)
 *     bb = bb ^ ((t ^ (bb >> 36)) & 0xf0f0f0f00f0f0f0f)             # <<<<<<<<<<<<<<
 *     t = (bb ^ (bb << 18)) & 0xcccc0000cccc0000
 *     bb = bb ^ (t ^ (t >> 18))
 */
  __pyx_t_2 = __Pyx_PyInt_RshiftObjC(__pyx_v_bb, __pyx_int_36, 36, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Xor(__pyx_v_t, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 247, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_int_17361641477348724495); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Xor(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 247, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":248
 *     t = bb ^ (bb << 36)
 *     bb = bb ^ ((t ^ (bb >> 36)) & 0xf0f0f0f00f0f0f0f)
 *     t = (bb ^ (bb << 18)) & 0xcccc0000cccc0000             # <<<<<<<<<<<<<<
 *     bb = bb ^ (t ^ (t >> 18))
 *     t = (bb ^ (bb << 9)) & 0xaa00aa00aa00aa00
 */
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_bb, __pyx_int_18, 18, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 248, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 248, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_int_14757170082422194176); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 248, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_t, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":249
 *     bb = bb ^ ((t ^ (bb >> 36)) & 0xf0f0f0f00f0f0f0f)
 *     t = (bb ^ (bb << 18)) & 0xcccc0000cccc0000
 *     bb = bb ^ (t ^ (t >> 18))             # <<<<<<<<<<<<<<
 *     t = (bb ^ (bb << 9)) & 0xaa00aa00aa00aa00
 *     bb = bb ^ (t ^ (t >> 9))
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_t, __pyx_int_18, 18, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 249, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_t, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 249, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Xor(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 249, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":250
 *     t = (bb ^ (bb << 18)) & 0xcccc0000cccc0000
 *     bb = bb ^ (t ^ (t >> 18))
 *     t = (bb ^ (bb << 9)) & 0xaa00aa00aa00aa00             # <<<<<<<<<<<<<<
 *     bb = bb ^ (t ^ (t >> 9))
 *     return bb
 */
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_bb, __pyx_int_9, 9, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 250, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 250, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_int_12249977906276641280); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 250, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_t, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":251
 *     bb = bb ^ (t ^ (t >> 18))
 *     t = (bb ^ (bb << 9)) & 0xaa00aa00aa00aa00
 *     bb = bb ^ (t ^ (t >> 9))             # <<<<<<<<<<<<<<
 *     return bb
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_t, __pyx_int_9, 9, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Xor(__pyx_v_t, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 251, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Xor(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_bb, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":252
 *     t = (bb ^ (bb << 9)) & 0xaa00aa00aa00aa00
 *     bb = bb ^ (t ^ (t >> 9))
 *     return bb             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_bb);
  __pyx_r = __pyx_v_bb;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":244
 *     return bb
 * 
 * def flip_anti_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheAntidiagonal
 *     t = bb ^ (bb << 36)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.flip_anti_diagonal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_t);
  __Pyx_XDECREF(__pyx_v_bb);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":255
 * 
 * 
 * def shift_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 8
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_33shift_down(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_33shift_down = {"shift_down", (PyCFunction)__pyx_pw_5chess_10__init__cp_33shift_down, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_33shift_down(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_down (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_32shift_down(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_32shift_down(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("shift_down", 0);

  /* "chess/__init__cp.pyx":256
 * 
 * def shift_down(b):
 *     return b >> 8             # <<<<<<<<<<<<<<
 * 
 * def shift_2_down(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_b, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 256, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":255
 * 
 * 
 * def shift_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 8
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.shift_down", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":258
 *     return b >> 8
 * 
 * def shift_2_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 16
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_35shift_2_down(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_35shift_2_down = {"shift_2_down", (PyCFunction)__pyx_pw_5chess_10__init__cp_35shift_2_down, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_35shift_2_down(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_2_down (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_34shift_2_down(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_34shift_2_down(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("shift_2_down", 0);

  /* "chess/__init__cp.pyx":259
 * 
 * def shift_2_down(b):
 *     return b >> 16             # <<<<<<<<<<<<<<
 * 
 * def shift_up(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_b, __pyx_int_16, 16, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":258
 *     return b >> 8
 * 
 * def shift_2_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 16
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.shift_2_down", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":261
 *     return b >> 16
 * 
 * def shift_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 8) & BB_ALL
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_37shift_up(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_37shift_up = {"shift_up", (PyCFunction)__pyx_pw_5chess_10__init__cp_37shift_up, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_37shift_up(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_up (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_36shift_up(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_36shift_up(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_up", 0);

  /* "chess/__init__cp.pyx":262
 * 
 * def shift_up(b):
 *     return (b << 8) & BB_ALL             # <<<<<<<<<<<<<<
 * 
 * def shift_2_up(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_b, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 262, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 262, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 262, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":261
 *     return b >> 16
 * 
 * def shift_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 8) & BB_ALL
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_up", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":264
 *     return (b << 8) & BB_ALL
 * 
 * def shift_2_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 16) & BB_ALL
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_39shift_2_up(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_39shift_2_up = {"shift_2_up", (PyCFunction)__pyx_pw_5chess_10__init__cp_39shift_2_up, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_39shift_2_up(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_2_up (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_38shift_2_up(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_38shift_2_up(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_2_up", 0);

  /* "chess/__init__cp.pyx":265
 * 
 * def shift_2_up(b):
 *     return (b << 16) & BB_ALL             # <<<<<<<<<<<<<<
 * 
 * def shift_right(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_b, __pyx_int_16, 16, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 265, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 265, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 265, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":264
 *     return (b << 8) & BB_ALL
 * 
 * def shift_2_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 16) & BB_ALL
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_2_up", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":267
 *     return (b << 16) & BB_ALL
 * 
 * def shift_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_41shift_right(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_41shift_right = {"shift_right", (PyCFunction)__pyx_pw_5chess_10__init__cp_41shift_right, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_41shift_right(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_right (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_40shift_right(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_40shift_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_right", 0);

  /* "chess/__init__cp.pyx":268
 * 
 * def shift_right(b):
 *     return (b << 1) & ~BB_FILE_A & BB_ALL             # <<<<<<<<<<<<<<
 * 
 * def shift_2_right(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_b, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 268, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_A); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 268, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 268, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 268, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 268, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 268, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":267
 *     return (b << 16) & BB_ALL
 * 
 * def shift_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_right", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":270
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_2_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_43shift_2_right(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_43shift_2_right = {"shift_2_right", (PyCFunction)__pyx_pw_5chess_10__init__cp_43shift_2_right, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_43shift_2_right(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_2_right (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_42shift_2_right(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_42shift_2_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_2_right", 0);

  /* "chess/__init__cp.pyx":271
 * 
 * def shift_2_right(b):
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL             # <<<<<<<<<<<<<<
 * 
 * def shift_left(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_b, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_A); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_FILE_B); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_Invert(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":270
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_2_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_2_right", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":273
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 * def shift_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 1) & ~BB_FILE_H
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_45shift_left(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_45shift_left = {"shift_left", (PyCFunction)__pyx_pw_5chess_10__init__cp_45shift_left, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_45shift_left(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_left (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_44shift_left(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_44shift_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_left", 0);

  /* "chess/__init__cp.pyx":274
 * 
 * def shift_left(b):
 *     return (b >> 1) & ~BB_FILE_H             # <<<<<<<<<<<<<<
 * 
 * def shift_2_left(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_b, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 274, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 274, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 274, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 274, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":273
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 * def shift_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 1) & ~BB_FILE_H
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_left", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":276
 *     return (b >> 1) & ~BB_FILE_H
 * 
 * def shift_2_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_47shift_2_left(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_47shift_2_left = {"shift_2_left", (PyCFunction)__pyx_pw_5chess_10__init__cp_47shift_2_left, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_47shift_2_left(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_2_left (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_46shift_2_left(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_46shift_2_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_2_left", 0);

  /* "chess/__init__cp.pyx":277
 * 
 * def shift_2_left(b):
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H             # <<<<<<<<<<<<<<
 * 
 * def shift_up_left(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_b, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_G); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_Invert(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":276
 *     return (b >> 1) & ~BB_FILE_H
 * 
 * def shift_2_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_2_left", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":279
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 * def shift_up_left(b):             # <<<<<<<<<<<<<<
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_49shift_up_left(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_49shift_up_left = {"shift_up_left", (PyCFunction)__pyx_pw_5chess_10__init__cp_49shift_up_left, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_49shift_up_left(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_up_left (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_48shift_up_left(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_48shift_up_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_up_left", 0);

  /* "chess/__init__cp.pyx":280
 * 
 * def shift_up_left(b):
 *     return (b << 7) & ~BB_FILE_H & BB_ALL             # <<<<<<<<<<<<<<
 * 
 * def shift_up_right(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_b, __pyx_int_7, 7, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":279
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 * def shift_up_left(b):             # <<<<<<<<<<<<<<
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_up_left", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":282
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 * def shift_up_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_51shift_up_right(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_51shift_up_right = {"shift_up_right", (PyCFunction)__pyx_pw_5chess_10__init__cp_51shift_up_right, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_51shift_up_right(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_up_right (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_50shift_up_right(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_50shift_up_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_up_right", 0);

  /* "chess/__init__cp.pyx":283
 * 
 * def shift_up_right(b):
 *     return (b << 9) & ~BB_FILE_A & BB_ALL             # <<<<<<<<<<<<<<
 * 
 * def shift_down_left(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_v_b, __pyx_int_9, 9, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_A); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":282
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 * def shift_up_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_up_right", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":285
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_down_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 9) & ~BB_FILE_H
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_53shift_down_left(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_53shift_down_left = {"shift_down_left", (PyCFunction)__pyx_pw_5chess_10__init__cp_53shift_down_left, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_53shift_down_left(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_down_left (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_52shift_down_left(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_52shift_down_left(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_down_left", 0);

  /* "chess/__init__cp.pyx":286
 * 
 * def shift_down_left(b):
 *     return (b >> 9) & ~BB_FILE_H             # <<<<<<<<<<<<<<
 * 
 * def shift_down_right(b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_b, __pyx_int_9, 9, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":285
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_down_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 9) & ~BB_FILE_H
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_down_left", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":288
 *     return (b >> 9) & ~BB_FILE_H
 * 
 * def shift_down_right(b):             # <<<<<<<<<<<<<<
 *     return (b >> 7) & ~BB_FILE_A
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_55shift_down_right(PyObject *__pyx_self, PyObject *__pyx_v_b); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_55shift_down_right = {"shift_down_right", (PyCFunction)__pyx_pw_5chess_10__init__cp_55shift_down_right, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_55shift_down_right(PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shift_down_right (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_54shift_down_right(__pyx_self, ((PyObject *)__pyx_v_b));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_54shift_down_right(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("shift_down_right", 0);

  /* "chess/__init__cp.pyx":289
 * 
 * def shift_down_right(b):
 *     return (b >> 7) & ~BB_FILE_A             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_v_b, __pyx_int_7, 7, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 289, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_A); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 289, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 289, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 289, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":288
 *     return (b >> 9) & ~BB_FILE_H
 * 
 * def shift_down_right(b):             # <<<<<<<<<<<<<<
 *     return (b >> 7) & ~BB_FILE_A
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.shift_down_right", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":292
 * 
 * 
 * def _sliding_attacks(square, occupied, deltas):             # <<<<<<<<<<<<<<
 *     attacks = 0
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_57_sliding_attacks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_57_sliding_attacks = {"_sliding_attacks", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_57_sliding_attacks, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_57_sliding_attacks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_v_occupied = 0;
  PyObject *__pyx_v_deltas = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_sliding_attacks (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_square,&__pyx_n_s_occupied,&__pyx_n_s_deltas,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_occupied)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_sliding_attacks", 1, 3, 3, 1); __PYX_ERR(0, 292, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_deltas)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_sliding_attacks", 1, 3, 3, 2); __PYX_ERR(0, 292, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_sliding_attacks") < 0)) __PYX_ERR(0, 292, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_square = values[0];
    __pyx_v_occupied = values[1];
    __pyx_v_deltas = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_sliding_attacks", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 292, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp._sliding_attacks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_56_sliding_attacks(__pyx_self, __pyx_v_square, __pyx_v_occupied, __pyx_v_deltas);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_56_sliding_attacks(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square, PyObject *__pyx_v_occupied, PyObject *__pyx_v_deltas) {
  PyObject *__pyx_v_attacks = NULL;
  PyObject *__pyx_v_delta = NULL;
  PyObject *__pyx_v_sq = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  __Pyx_RefNannySetupContext("_sliding_attacks", 0);

  /* "chess/__init__cp.pyx":293
 * 
 * def _sliding_attacks(square, occupied, deltas):
 *     attacks = 0             # <<<<<<<<<<<<<<
 * 
 *     for delta in deltas:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_attacks = __pyx_int_0;

  /* "chess/__init__cp.pyx":295
 *     attacks = 0
 * 
 *     for delta in deltas:             # <<<<<<<<<<<<<<
 *         sq = square
 * 
 */
  if (likely(PyList_CheckExact(__pyx_v_deltas)) || PyTuple_CheckExact(__pyx_v_deltas)) {
    __pyx_t_1 = __pyx_v_deltas; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_deltas); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 295, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 295, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 295, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 295, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 295, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 295, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 295, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_delta, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":296
 * 
 *     for delta in deltas:
 *         sq = square             # <<<<<<<<<<<<<<
 * 
 *         while True:
 */
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_XDECREF_SET(__pyx_v_sq, __pyx_v_square);

    /* "chess/__init__cp.pyx":298
 *         sq = square
 * 
 *         while True:             # <<<<<<<<<<<<<<
 *             sq += delta
 *             if not (0 <= sq < 64) or square_distance(sq, sq - delta) > 2:
 */
    while (1) {

      /* "chess/__init__cp.pyx":299
 * 
 *         while True:
 *             sq += delta             # <<<<<<<<<<<<<<
 *             if not (0 <= sq < 64) or square_distance(sq, sq - delta) > 2:
 *                 break
 */
      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_sq, __pyx_v_delta); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 299, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF_SET(__pyx_v_sq, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "chess/__init__cp.pyx":300
 *         while True:
 *             sq += delta
 *             if not (0 <= sq < 64) or square_distance(sq, sq - delta) > 2:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
      __pyx_t_4 = PyObject_RichCompare(__pyx_int_0, __pyx_v_sq, Py_LE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
      if (__Pyx_PyObject_IsTrue(__pyx_t_4)) {
        __Pyx_DECREF(__pyx_t_4);
        __pyx_t_4 = PyObject_RichCompare(__pyx_v_sq, __pyx_int_64, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
      }
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 300, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = ((!__pyx_t_6) != 0);
      if (!__pyx_t_7) {
      } else {
        __pyx_t_5 = __pyx_t_7;
        goto __pyx_L8_bool_binop_done;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_square_distance); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = PyNumber_Subtract(__pyx_v_sq, __pyx_v_delta); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
          __pyx_t_11 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_8)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_v_sq, __pyx_t_9};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_v_sq, __pyx_t_9};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      } else
      #endif
      {
        __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 300, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        if (__pyx_t_10) {
          __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
        }
        __Pyx_INCREF(__pyx_v_sq);
        __Pyx_GIVEREF(__pyx_v_sq);
        PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_v_sq);
        __Pyx_GIVEREF(__pyx_t_9);
        PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_t_9);
        __pyx_t_9 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_12, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyObject_RichCompare(__pyx_t_4, __pyx_int_2, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 300, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 300, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_5 = __pyx_t_7;
      __pyx_L8_bool_binop_done:;
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":301
 *             sq += delta
 *             if not (0 <= sq < 64) or square_distance(sq, sq - delta) > 2:
 *                 break             # <<<<<<<<<<<<<<
 * 
 *             attacks |= BB_SQUARES[sq]
 */
        goto __pyx_L6_break;

        /* "chess/__init__cp.pyx":300
 *         while True:
 *             sq += delta
 *             if not (0 <= sq < 64) or square_distance(sq, sq - delta) > 2:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
      }

      /* "chess/__init__cp.pyx":303
 *                 break
 * 
 *             attacks |= BB_SQUARES[sq]             # <<<<<<<<<<<<<<
 * 
 *             if occupied & BB_SQUARES[sq]:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 303, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_8, __pyx_v_sq); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 303, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyNumber_InPlaceOr(__pyx_v_attacks, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 303, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF_SET(__pyx_v_attacks, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "chess/__init__cp.pyx":305
 *             attacks |= BB_SQUARES[sq]
 * 
 *             if occupied & BB_SQUARES[sq]:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 305, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_8, __pyx_v_sq); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 305, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyNumber_And(__pyx_v_occupied, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 305, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 305, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":306
 * 
 *             if occupied & BB_SQUARES[sq]:
 *                 break             # <<<<<<<<<<<<<<
 * 
 *     return attacks
 */
        goto __pyx_L6_break;

        /* "chess/__init__cp.pyx":305
 *             attacks |= BB_SQUARES[sq]
 * 
 *             if occupied & BB_SQUARES[sq]:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
      }
    }
    __pyx_L6_break:;

    /* "chess/__init__cp.pyx":295
 *     attacks = 0
 * 
 *     for delta in deltas:             # <<<<<<<<<<<<<<
 *         sq = square
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":308
 *                 break
 * 
 *     return attacks             # <<<<<<<<<<<<<<
 * 
 * def _step_attacks(square, deltas):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_attacks);
  __pyx_r = __pyx_v_attacks;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":292
 * 
 * 
 * def _sliding_attacks(square, occupied, deltas):             # <<<<<<<<<<<<<<
 *     attacks = 0
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("chess.__init__cp._sliding_attacks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_attacks);
  __Pyx_XDECREF(__pyx_v_delta);
  __Pyx_XDECREF(__pyx_v_sq);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":310
 *     return attacks
 * 
 * def _step_attacks(square, deltas):             # <<<<<<<<<<<<<<
 *     return _sliding_attacks(square, BB_ALL, deltas)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_59_step_attacks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_59_step_attacks = {"_step_attacks", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_59_step_attacks, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_59_step_attacks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_v_deltas = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_step_attacks (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_square,&__pyx_n_s_deltas,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_deltas)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_step_attacks", 1, 2, 2, 1); __PYX_ERR(0, 310, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_step_attacks") < 0)) __PYX_ERR(0, 310, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_square = values[0];
    __pyx_v_deltas = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_step_attacks", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 310, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp._step_attacks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_58_step_attacks(__pyx_self, __pyx_v_square, __pyx_v_deltas);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_58_step_attacks(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square, PyObject *__pyx_v_deltas) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("_step_attacks", 0);

  /* "chess/__init__cp.pyx":311
 * 
 * def _step_attacks(square, deltas):
 *     return _sliding_attacks(square, BB_ALL, deltas)             # <<<<<<<<<<<<<<
 * 
 * BB_KNIGHT_ATTACKS = [_step_attacks(sq, [17, 15, 10, 6, -17, -15, -10, -6]) for sq in SQUARES]
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sliding_attacks); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 311, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 311, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_square, __pyx_t_3, __pyx_v_deltas};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_square, __pyx_t_3, __pyx_v_deltas};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 311, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_square);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_t_3);
    __Pyx_INCREF(__pyx_v_deltas);
    __Pyx_GIVEREF(__pyx_v_deltas);
    PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_5, __pyx_v_deltas);
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":310
 *     return attacks
 * 
 * def _step_attacks(square, deltas):             # <<<<<<<<<<<<<<
 *     return _sliding_attacks(square, BB_ALL, deltas)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp._step_attacks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":318
 * 
 * 
 * def _edges(square):             # <<<<<<<<<<<<<<
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_61_edges(PyObject *__pyx_self, PyObject *__pyx_v_square); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_61_edges = {"_edges", (PyCFunction)__pyx_pw_5chess_10__init__cp_61_edges, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_61_edges(PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_edges (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_60_edges(__pyx_self, ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_60_edges(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("_edges", 0);

  /* "chess/__init__cp.pyx":319
 * 
 * def _edges(square):
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |             # <<<<<<<<<<<<<<
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Invert(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":320
 * def _edges(square):
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))             # <<<<<<<<<<<<<<
 * 
 * def _carry_rippler(mask):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILE_A); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_Or(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_square_file); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Invert(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":319
 * 
 * def _edges(square):
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |             # <<<<<<<<<<<<<<
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 */
  __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":318
 * 
 * 
 * def _edges(square):             # <<<<<<<<<<<<<<
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp._edges", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_64generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":322
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 * def _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_63_carry_rippler(PyObject *__pyx_self, PyObject *__pyx_v_mask); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_63_carry_rippler = {"_carry_rippler", (PyCFunction)__pyx_pw_5chess_10__init__cp_63_carry_rippler, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_63_carry_rippler(PyObject *__pyx_self, PyObject *__pyx_v_mask) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_carry_rippler (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_62_carry_rippler(__pyx_self, ((PyObject *)__pyx_v_mask));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_62_carry_rippler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_carry_rippler", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 322, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_mask = __pyx_v_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_64generator2, __pyx_codeobj__4, (PyObject *) __pyx_cur_scope, __pyx_n_s_carry_rippler, __pyx_n_s_carry_rippler, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 322, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp._carry_rippler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_64generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_carry_rippler", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 322, __pyx_L1_error)

  /* "chess/__init__cp.pyx":324
 * def _carry_rippler(mask):
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0             # <<<<<<<<<<<<<<
 *     while True:
 *         yield subset
 */
  __Pyx_INCREF(__pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __pyx_cur_scope->__pyx_v_subset = __pyx_int_0;

  /* "chess/__init__cp.pyx":325
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0
 *     while True:             # <<<<<<<<<<<<<<
 *         yield subset
 *         subset = (subset - mask) & mask
 */
  while (1) {

    /* "chess/__init__cp.pyx":326
 *     subset = 0
 *     while True:
 *         yield subset             # <<<<<<<<<<<<<<
 *         subset = (subset - mask) & mask
 *         if not subset:
 */
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_subset);
    __pyx_r = __pyx_cur_scope->__pyx_v_subset;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 326, __pyx_L1_error)

    /* "chess/__init__cp.pyx":327
 *     while True:
 *         yield subset
 *         subset = (subset - mask) & mask             # <<<<<<<<<<<<<<
 *         if not subset:
 *             break
 */
    __pyx_t_1 = PyNumber_Subtract(__pyx_cur_scope->__pyx_v_subset, __pyx_cur_scope->__pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 327, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_cur_scope->__pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 327, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_subset);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_subset, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":328
 *         yield subset
 *         subset = (subset - mask) & mask
 *         if not subset:             # <<<<<<<<<<<<<<
 *             break
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_subset); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 328, __pyx_L1_error)
    __pyx_t_4 = ((!__pyx_t_3) != 0);
    if (__pyx_t_4) {

      /* "chess/__init__cp.pyx":329
 *         subset = (subset - mask) & mask
 *         if not subset:
 *             break             # <<<<<<<<<<<<<<
 * 
 * def _attack_table(deltas):
 */
      goto __pyx_L5_break;

      /* "chess/__init__cp.pyx":328
 *         yield subset
 *         subset = (subset - mask) & mask
 *         if not subset:             # <<<<<<<<<<<<<<
 *             break
 * 
 */
    }
  }
  __pyx_L5_break:;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":322
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 * def _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("_carry_rippler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":331
 *             break
 * 
 * def _attack_table(deltas):             # <<<<<<<<<<<<<<
 *     mask_table = []
 *     attack_table = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_66_attack_table(PyObject *__pyx_self, PyObject *__pyx_v_deltas); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_66_attack_table = {"_attack_table", (PyCFunction)__pyx_pw_5chess_10__init__cp_66_attack_table, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_66_attack_table(PyObject *__pyx_self, PyObject *__pyx_v_deltas) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_attack_table (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_65_attack_table(__pyx_self, ((PyObject *)__pyx_v_deltas));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_65_attack_table(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_deltas) {
  PyObject *__pyx_v_mask_table = NULL;
  PyObject *__pyx_v_attack_table = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_attacks = NULL;
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_v_subset = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  int __pyx_t_12;
  __Pyx_RefNannySetupContext("_attack_table", 0);

  /* "chess/__init__cp.pyx":332
 * 
 * def _attack_table(deltas):
 *     mask_table = []             # <<<<<<<<<<<<<<
 *     attack_table = []
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 332, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_mask_table = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":333
 * def _attack_table(deltas):
 *     mask_table = []
 *     attack_table = []             # <<<<<<<<<<<<<<
 * 
 *     for square in SQUARES:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 333, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_attack_table = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":335
 *     attack_table = []
 * 
 *     for square in SQUARES:             # <<<<<<<<<<<<<<
 *         attacks = {}
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 335, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 335, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 335, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 335, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":336
 * 
 *     for square in SQUARES:
 *         attacks = {}             # <<<<<<<<<<<<<<
 * 
 *         mask = _sliding_attacks(square, 0, deltas) & ~_edges(square)
 */
    __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 336, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_attacks, ((PyObject*)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":338
 *         attacks = {}
 * 
 *         mask = _sliding_attacks(square, 0, deltas) & ~_edges(square)             # <<<<<<<<<<<<<<
 *         for subset in _carry_rippler(mask):
 *             attacks[subset] = _sliding_attacks(square, subset, deltas)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sliding_attacks); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_square, __pyx_int_0, __pyx_v_deltas};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 338, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_square, __pyx_int_0, __pyx_v_deltas};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 338, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 338, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (__pyx_t_6) {
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_INCREF(__pyx_v_square);
      __Pyx_GIVEREF(__pyx_v_square);
      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_v_square);
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_int_0);
      __Pyx_INCREF(__pyx_v_deltas);
      __Pyx_GIVEREF(__pyx_v_deltas);
      PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_v_deltas);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 338, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_edges); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_6, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyNumber_Invert(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_And(__pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF_SET(__pyx_v_mask, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":339
 * 
 *         mask = _sliding_attacks(square, 0, deltas) & ~_edges(square)
 *         for subset in _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *             attacks[subset] = _sliding_attacks(square, subset, deltas)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_carry_rippler); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 339, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_5 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_1, __pyx_v_mask) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_mask);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 339, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_8 = __pyx_t_5; __Pyx_INCREF(__pyx_t_8); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 339, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_10 = Py_TYPE(__pyx_t_8)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 339, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_8))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_8)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_9); __Pyx_INCREF(__pyx_t_5); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 339, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_8, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 339, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_8)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_9); __Pyx_INCREF(__pyx_t_5); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 339, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_8, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 339, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        }
      } else {
        __pyx_t_5 = __pyx_t_10(__pyx_t_8);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 339, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XDECREF_SET(__pyx_v_subset, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":340
 *         mask = _sliding_attacks(square, 0, deltas) & ~_edges(square)
 *         for subset in _carry_rippler(mask):
 *             attacks[subset] = _sliding_attacks(square, subset, deltas)             # <<<<<<<<<<<<<<
 * 
 *         attack_table.append(attacks)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sliding_attacks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 340, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = NULL;
      __pyx_t_7 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_7 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_square, __pyx_v_subset, __pyx_v_deltas};
        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 340, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_square, __pyx_v_subset, __pyx_v_deltas};
        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 340, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
      } else
      #endif
      {
        __pyx_t_11 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 340, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_INCREF(__pyx_v_square);
        __Pyx_GIVEREF(__pyx_v_square);
        PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_7, __pyx_v_square);
        __Pyx_INCREF(__pyx_v_subset);
        __Pyx_GIVEREF(__pyx_v_subset);
        PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_7, __pyx_v_subset);
        __Pyx_INCREF(__pyx_v_deltas);
        __Pyx_GIVEREF(__pyx_v_deltas);
        PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_7, __pyx_v_deltas);
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 340, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(PyDict_SetItem(__pyx_v_attacks, __pyx_v_subset, __pyx_t_5) < 0)) __PYX_ERR(0, 340, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":339
 * 
 *         mask = _sliding_attacks(square, 0, deltas) & ~_edges(square)
 *         for subset in _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *             attacks[subset] = _sliding_attacks(square, subset, deltas)
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "chess/__init__cp.pyx":342
 *             attacks[subset] = _sliding_attacks(square, subset, deltas)
 * 
 *         attack_table.append(attacks)             # <<<<<<<<<<<<<<
 *         mask_table.append(mask)
 * 
 */
    __pyx_t_12 = __Pyx_PyList_Append(__pyx_v_attack_table, __pyx_v_attacks); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 342, __pyx_L1_error)

    /* "chess/__init__cp.pyx":343
 * 
 *         attack_table.append(attacks)
 *         mask_table.append(mask)             # <<<<<<<<<<<<<<
 * 
 *     return mask_table, attack_table
 */
    __pyx_t_12 = __Pyx_PyList_Append(__pyx_v_mask_table, __pyx_v_mask); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 343, __pyx_L1_error)

    /* "chess/__init__cp.pyx":335
 *     attack_table = []
 * 
 *     for square in SQUARES:             # <<<<<<<<<<<<<<
 *         attacks = {}
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":345
 *         mask_table.append(mask)
 * 
 *     return mask_table, attack_table             # <<<<<<<<<<<<<<
 * 
 * BB_DIAG_MASKS, BB_DIAG_ATTACKS = _attack_table([-9, -7, 7, 9])
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 345, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_mask_table);
  __Pyx_GIVEREF(__pyx_v_mask_table);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_mask_table);
  __Pyx_INCREF(__pyx_v_attack_table);
  __Pyx_GIVEREF(__pyx_v_attack_table);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_attack_table);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":331
 *             break
 * 
 * def _attack_table(deltas):             # <<<<<<<<<<<<<<
 *     mask_table = []
 *     attack_table = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("chess.__init__cp._attack_table", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_mask_table);
  __Pyx_XDECREF(__pyx_v_attack_table);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_attacks);
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XDECREF(__pyx_v_subset);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":352
 * 
 * 
 * def _rays():             # <<<<<<<<<<<<<<
 *     rays = []
 *     between = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_68_rays(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_68_rays = {"_rays", (PyCFunction)__pyx_pw_5chess_10__init__cp_68_rays, METH_NOARGS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_68_rays(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_rays (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_67_rays(__pyx_self);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_67_rays(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_v_rays = NULL;
  PyObject *__pyx_v_between = NULL;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_bb_a = NULL;
  PyObject *__pyx_v_rays_row = NULL;
  PyObject *__pyx_v_between_row = NULL;
  PyObject *__pyx_v_b = NULL;
  PyObject *__pyx_v_bb_b = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  __Pyx_RefNannySetupContext("_rays", 0);

  /* "chess/__init__cp.pyx":353
 * 
 * def _rays():
 *     rays = []             # <<<<<<<<<<<<<<
 *     between = []
 *     for a, bb_a in enumerate(BB_SQUARES):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_rays = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":354
 * def _rays():
 *     rays = []
 *     between = []             # <<<<<<<<<<<<<<
 *     for a, bb_a in enumerate(BB_SQUARES):
 *         rays_row = []
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_between = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":355
 *     rays = []
 *     between = []
 *     for a, bb_a in enumerate(BB_SQUARES):             # <<<<<<<<<<<<<<
 *         rays_row = []
 *         between_row = []
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_t_1 = __pyx_int_0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 355, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 355, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 355, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 355, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 355, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 355, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 355, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_bb_a, __pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_a, __pyx_t_1);
    __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 355, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":356
 *     between = []
 *     for a, bb_a in enumerate(BB_SQUARES):
 *         rays_row = []             # <<<<<<<<<<<<<<
 *         between_row = []
 *         for b, bb_b in enumerate(BB_SQUARES):
 */
    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 356, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_rays_row, ((PyObject*)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":357
 *     for a, bb_a in enumerate(BB_SQUARES):
 *         rays_row = []
 *         between_row = []             # <<<<<<<<<<<<<<
 *         for b, bb_b in enumerate(BB_SQUARES):
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:
 */
    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 357, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_between_row, ((PyObject*)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":358
 *         rays_row = []
 *         between_row = []
 *         for b, bb_b in enumerate(BB_SQUARES):             # <<<<<<<<<<<<<<
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 */
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_2 = __pyx_int_0;
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 358, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
      __pyx_t_7 = __pyx_t_6; __Pyx_INCREF(__pyx_t_7); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 358, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_9 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 358, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_7))) {
          if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_7)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_6); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 358, __pyx_L1_error)
          #else
          __pyx_t_6 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 358, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        } else {
          if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_6); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 358, __pyx_L1_error)
          #else
          __pyx_t_6 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 358, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        }
      } else {
        __pyx_t_6 = __pyx_t_9(__pyx_t_7);
        if (unlikely(!__pyx_t_6)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 358, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_6);
      }
      __Pyx_XDECREF_SET(__pyx_v_bb_b, __pyx_t_6);
      __pyx_t_6 = 0;
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_XDECREF_SET(__pyx_v_b, __pyx_t_2);
      __pyx_t_6 = __Pyx_PyInt_AddObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 358, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2);
      __pyx_t_2 = __pyx_t_6;
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":359
 *         between_row = []
 *         for b, bb_b in enumerate(BB_SQUARES):
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:             # <<<<<<<<<<<<<<
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])
 */
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 359, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_a); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 359, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 359, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyNumber_And(__pyx_t_6, __pyx_v_bb_b); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 359, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 359, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (__pyx_t_11) {

        /* "chess/__init__cp.pyx":360
 *         for b, bb_b in enumerate(BB_SQUARES):
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)             # <<<<<<<<<<<<<<
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])
 *             elif BB_RANK_ATTACKS[a][0] & bb_b:
 */
        __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_v_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_b); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_12, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = PyNumber_Or(__pyx_t_12, __pyx_v_bb_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_Or(__pyx_t_6, __pyx_v_bb_b); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_rays_row, __pyx_t_12); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 360, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

        /* "chess/__init__cp.pyx":361
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])             # <<<<<<<<<<<<<<
 *             elif BB_RANK_ATTACKS[a][0] & bb_b:
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_DIAG_MASKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_v_bb_b); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_b); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_DIAG_MASKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_b); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_14, __pyx_v_bb_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_t_14); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_between_row, __pyx_t_12); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 361, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

        /* "chess/__init__cp.pyx":359
 *         between_row = []
 *         for b, bb_b in enumerate(BB_SQUARES):
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:             # <<<<<<<<<<<<<<
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])
 */
        goto __pyx_L7;
      }

      /* "chess/__init__cp.pyx":362
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])
 *             elif BB_RANK_ATTACKS[a][0] & bb_b:             # <<<<<<<<<<<<<<
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])
 */
      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 362, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 362, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_14, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 362, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      __pyx_t_14 = PyNumber_And(__pyx_t_12, __pyx_v_bb_b); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 362, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_14); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 362, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      if (__pyx_t_11) {

        /* "chess/__init__cp.pyx":363
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])
 *             elif BB_RANK_ATTACKS[a][0] & bb_b:
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)             # <<<<<<<<<<<<<<
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])
 *             elif BB_FILE_ATTACKS[a][0] & bb_b:
 */
        __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_14, __pyx_v_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_12, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_Or(__pyx_t_14, __pyx_v_bb_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_rays_row, __pyx_t_12); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

        /* "chess/__init__cp.pyx":364
 *             elif BB_RANK_ATTACKS[a][0] & bb_b:
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])             # <<<<<<<<<<<<<<
 *             elif BB_FILE_ATTACKS[a][0] & bb_b:
 *                 rays_row.append(BB_FILE_ATTACKS[a][0] | bb_a)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_RANK_MASKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_v_bb_b); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_14, __pyx_t_12); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_b); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_RANK_MASKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_b); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_6, __pyx_v_bb_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_14, __pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_between_row, __pyx_t_12); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 364, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

        /* "chess/__init__cp.pyx":362
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 *                 between_row.append(BB_DIAG_ATTACKS[a][BB_DIAG_MASKS[a] & bb_b] & BB_DIAG_ATTACKS[b][BB_DIAG_MASKS[b] & bb_a])
 *             elif BB_RANK_ATTACKS[a][0] & bb_b:             # <<<<<<<<<<<<<<
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])
 */
        goto __pyx_L7;
      }

      /* "chess/__init__cp.pyx":365
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])
 *             elif BB_FILE_ATTACKS[a][0] & bb_b:             # <<<<<<<<<<<<<<
 *                 rays_row.append(BB_FILE_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_FILE_ATTACKS[a][BB_FILE_MASKS[a] & bb_b] & BB_FILE_ATTACKS[b][BB_FILE_MASKS[b] & bb_a])
 */
      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyNumber_And(__pyx_t_12, __pyx_v_bb_b); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_11) {

        /* "chess/__init__cp.pyx":366
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])
 *             elif BB_FILE_ATTACKS[a][0] & bb_b:
 *                 rays_row.append(BB_FILE_ATTACKS[a][0] | bb_a)             # <<<<<<<<<<<<<<
 *                 between_row.append(BB_FILE_ATTACKS[a][BB_FILE_MASKS[a] & bb_b] & BB_FILE_ATTACKS[b][BB_FILE_MASKS[b] & bb_a])
 *             else:
 */
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_12, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_Or(__pyx_t_6, __pyx_v_bb_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_rays_row, __pyx_t_12); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 366, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

        /* "chess/__init__cp.pyx":367
 *             elif BB_FILE_ATTACKS[a][0] & bb_b:
 *                 rays_row.append(BB_FILE_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_FILE_ATTACKS[a][BB_FILE_MASKS[a] & bb_b] & BB_FILE_ATTACKS[b][BB_FILE_MASKS[b] & bb_a])             # <<<<<<<<<<<<<<
 *             else:
 *                 rays_row.append(0)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_FILE_MASKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_a); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_v_bb_b); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_b); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_BB_FILE_MASKS); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_12, __pyx_v_b); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_14, __pyx_v_bb_a); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_And(__pyx_t_10, __pyx_t_14); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_between_row, __pyx_t_12); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 367, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

        /* "chess/__init__cp.pyx":365
 *                 rays_row.append(BB_RANK_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_RANK_ATTACKS[a][BB_RANK_MASKS[a] & bb_b] & BB_RANK_ATTACKS[b][BB_RANK_MASKS[b] & bb_a])
 *             elif BB_FILE_ATTACKS[a][0] & bb_b:             # <<<<<<<<<<<<<<
 *                 rays_row.append(BB_FILE_ATTACKS[a][0] | bb_a)
 *                 between_row.append(BB_FILE_ATTACKS[a][BB_FILE_MASKS[a] & bb_b] & BB_FILE_ATTACKS[b][BB_FILE_MASKS[b] & bb_a])
 */
        goto __pyx_L7;
      }

      /* "chess/__init__cp.pyx":369
 *                 between_row.append(BB_FILE_ATTACKS[a][BB_FILE_MASKS[a] & bb_b] & BB_FILE_ATTACKS[b][BB_FILE_MASKS[b] & bb_a])
 *             else:
 *                 rays_row.append(0)             # <<<<<<<<<<<<<<
 *                 between_row.append(0)
 *         rays.append(rays_row)
 */
      /*else*/ {
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_rays_row, __pyx_int_0); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 369, __pyx_L1_error)

        /* "chess/__init__cp.pyx":370
 *             else:
 *                 rays_row.append(0)
 *                 between_row.append(0)             # <<<<<<<<<<<<<<
 *         rays.append(rays_row)
 *         between.append(between_row)
 */
        __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_between_row, __pyx_int_0); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 370, __pyx_L1_error)
      }
      __pyx_L7:;

      /* "chess/__init__cp.pyx":358
 *         rays_row = []
 *         between_row = []
 *         for b, bb_b in enumerate(BB_SQUARES):             # <<<<<<<<<<<<<<
 *             if BB_DIAG_ATTACKS[a][0] & bb_b:
 *                 rays_row.append((BB_DIAG_ATTACKS[a][0] & BB_DIAG_ATTACKS[b][0]) | bb_a | bb_b)
 */
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":371
 *                 rays_row.append(0)
 *                 between_row.append(0)
 *         rays.append(rays_row)             # <<<<<<<<<<<<<<
 *         between.append(between_row)
 *     return rays, between
 */
    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_rays, __pyx_v_rays_row); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 371, __pyx_L1_error)

    /* "chess/__init__cp.pyx":372
 *                 between_row.append(0)
 *         rays.append(rays_row)
 *         between.append(between_row)             # <<<<<<<<<<<<<<
 *     return rays, between
 * 
 */
    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_between, __pyx_v_between_row); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 372, __pyx_L1_error)

    /* "chess/__init__cp.pyx":355
 *     rays = []
 *     between = []
 *     for a, bb_a in enumerate(BB_SQUARES):             # <<<<<<<<<<<<<<
 *         rays_row = []
 *         between_row = []
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":373
 *         rays.append(rays_row)
 *         between.append(between_row)
 *     return rays, between             # <<<<<<<<<<<<<<
 * 
 * BB_RAYS, BB_BETWEEN = _rays()
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 373, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_rays);
  __Pyx_GIVEREF(__pyx_v_rays);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_rays);
  __Pyx_INCREF(__pyx_v_between);
  __Pyx_GIVEREF(__pyx_v_between);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_between);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":352
 * 
 * 
 * def _rays():             # <<<<<<<<<<<<<<
 *     rays = []
 *     between = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("chess.__init__cp._rays", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_rays);
  __Pyx_XDECREF(__pyx_v_between);
  __Pyx_XDECREF(__pyx_v_a);
  __Pyx_XDECREF(__pyx_v_bb_a);
  __Pyx_XDECREF(__pyx_v_rays_row);
  __Pyx_XDECREF(__pyx_v_between_row);
  __Pyx_XDECREF(__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_bb_b);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":386
 *     """A piece with type and color."""
 * 
 *     def __init__(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         self.piece_type = piece_type
 *         self.color = color
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_1__init__ = {"__init__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Piece_1__init__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_piece_type = 0;
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_piece_type,&__pyx_n_s_color,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece_type)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 386, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 386, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 386, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_self = values[0];
    __pyx_v_piece_type = values[1];
    __pyx_v_color = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 386, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Piece.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece___init__(__pyx_self, __pyx_v_self, __pyx_v_piece_type, __pyx_v_color);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":387
 * 
 *     def __init__(self, piece_type, color):
 *         self.piece_type = piece_type             # <<<<<<<<<<<<<<
 *         self.color = color
 * 
 */
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_piece_type, __pyx_v_piece_type) < 0) __PYX_ERR(0, 387, __pyx_L1_error)

  /* "chess/__init__cp.pyx":388
 *     def __init__(self, piece_type, color):
 *         self.piece_type = piece_type
 *         self.color = color             # <<<<<<<<<<<<<<
 * 
 *     def symbol(self):
 */
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_color, __pyx_v_color) < 0) __PYX_ERR(0, 388, __pyx_L1_error)

  /* "chess/__init__cp.pyx":386
 *     """A piece with type and color."""
 * 
 *     def __init__(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         self.piece_type = piece_type
 *         self.color = color
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Piece.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":390
 *         self.color = color
 * 
 *     def symbol(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the symbol ``P``, ``N``, ``B``, ``R``, ``Q`` or ``K`` for white
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_3symbol(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Piece_2symbol[] = "\n        Gets the symbol ``P``, ``N``, ``B``, ``R``, ``Q`` or ``K`` for white\n        pieces or the lower-case variants for the black pieces.\n        ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_3symbol = {"symbol", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Piece_3symbol, METH_O, __pyx_doc_5chess_10__init__cp_5Piece_2symbol};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_3symbol(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("symbol (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_2symbol(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_2symbol(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("symbol", 0);

  /* "chess/__init__cp.pyx":395
 *         pieces or the lower-case variants for the black pieces.
 *         """
 *         if self.color == WHITE:             # <<<<<<<<<<<<<<
 *             return PIECE_SYMBOLS[self.piece_type].upper()
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_color); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 395, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 395, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":396
 *         """
 *         if self.color == WHITE:
 *             return PIECE_SYMBOLS[self.piece_type].upper()             # <<<<<<<<<<<<<<
 *         else:
 *             return PIECE_SYMBOLS[self.piece_type]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_upper); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":395
 *         pieces or the lower-case variants for the black pieces.
 *         """
 *         if self.color == WHITE:             # <<<<<<<<<<<<<<
 *             return PIECE_SYMBOLS[self.piece_type].upper()
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":398
 *             return PIECE_SYMBOLS[self.piece_type].upper()
 *         else:
 *             return PIECE_SYMBOLS[self.piece_type]             # <<<<<<<<<<<<<<
 * 
 *     def unicode_symbol(self, *, invert_color=False):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 398, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":390
 *         self.color = color
 * 
 *     def symbol(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the symbol ``P``, ``N``, ``B``, ``R``, ``Q`` or ``K`` for white
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Piece.symbol", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":400
 *             return PIECE_SYMBOLS[self.piece_type]
 * 
 *     def unicode_symbol(self, *, invert_color=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Unicode character for the piece.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_5unicode_symbol(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Piece_4unicode_symbol[] = "\n        Gets the Unicode character for the piece.\n        ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_5unicode_symbol = {"unicode_symbol", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Piece_5unicode_symbol, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Piece_4unicode_symbol};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_5unicode_symbol(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_invert_color = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("unicode_symbol (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_invert_color,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)((PyObject *)Py_False));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "unicode_symbol") < 0)) __PYX_ERR(0, 400, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_self = values[0];
    __pyx_v_invert_color = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("unicode_symbol", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 400, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Piece.unicode_symbol", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_4unicode_symbol(__pyx_self, __pyx_v_self, __pyx_v_invert_color);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_4unicode_symbol(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_invert_color) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("unicode_symbol", 0);

  /* "chess/__init__cp.pyx":404
 *         Gets the Unicode character for the piece.
 *         """
 *         if not invert_color:             # <<<<<<<<<<<<<<
 *             return UNICODE_PIECE_SYMBOLS[self.symbol()]
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_invert_color); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 404, __pyx_L1_error)
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":405
 *         """
 *         if not invert_color:
 *             return UNICODE_PIECE_SYMBOLS[self.symbol()]             # <<<<<<<<<<<<<<
 *         else:
 *             return UNICODE_PIECE_SYMBOLS[self.symbol().swapcase()]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_UNICODE_PIECE_SYMBOLS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_symbol); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":404
 *         Gets the Unicode character for the piece.
 *         """
 *         if not invert_color:             # <<<<<<<<<<<<<<
 *             return UNICODE_PIECE_SYMBOLS[self.symbol()]
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":407
 *             return UNICODE_PIECE_SYMBOLS[self.symbol()]
 *         else:
 *             return UNICODE_PIECE_SYMBOLS[self.symbol().swapcase()]             # <<<<<<<<<<<<<<
 * 
 *     def __hash__(self):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_UNICODE_PIECE_SYMBOLS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 407, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_symbol); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 407, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 407, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_swapcase); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 407, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 407, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 407, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":400
 *             return PIECE_SYMBOLS[self.piece_type]
 * 
 *     def unicode_symbol(self, *, invert_color=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Unicode character for the piece.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Piece.unicode_symbol", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":409
 *             return UNICODE_PIECE_SYMBOLS[self.symbol().swapcase()]
 * 
 *     def __hash__(self):             # <<<<<<<<<<<<<<
 *         return hash(self.piece_type * (self.color + 1))
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_7__hash__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_7__hash__ = {"__hash__", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Piece_7__hash__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_7__hash__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__hash__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_6__hash__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_6__hash__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_hash_t __pyx_t_4;
  __Pyx_RefNannySetupContext("__hash__", 0);

  /* "chess/__init__cp.pyx":410
 * 
 *     def __hash__(self):
 *         return hash(self.piece_type * (self.color + 1))             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 410, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_color); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 410, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 410, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 410, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = PyObject_Hash(__pyx_t_2); if (unlikely(__pyx_t_4 == ((Py_hash_t)-1))) __PYX_ERR(0, 410, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_FromHash_t(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 410, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":409
 *             return UNICODE_PIECE_SYMBOLS[self.symbol().swapcase()]
 * 
 *     def __hash__(self):             # <<<<<<<<<<<<<<
 *         return hash(self.piece_type * (self.color + 1))
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Piece.__hash__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":412
 *         return hash(self.piece_type * (self.color + 1))
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_9__repr__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_9__repr__ = {"__repr__", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Piece_9__repr__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_9__repr__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_8__repr__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_8__repr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "chess/__init__cp.pyx":413
 * 
 *     def __repr__(self):
 *         return "Piece.from_symbol('{}')".format(self.symbol())             # <<<<<<<<<<<<<<
 * 
 *     def __str__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Piece_from_symbol, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 413, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_symbol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 413, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 413, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 413, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":412
 *         return hash(self.piece_type * (self.color + 1))
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Piece.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":415
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         return self.symbol()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_11__str__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_11__str__ = {"__str__", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Piece_11__str__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_11__str__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_10__str__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_10__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__str__", 0);

  /* "chess/__init__cp.pyx":416
 * 
 *     def __str__(self):
 *         return self.symbol()             # <<<<<<<<<<<<<<
 * 
 *     def _repr_svg_(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_symbol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 416, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 416, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":415
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         return self.symbol()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Piece.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":418
 *         return self.symbol()
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.piece(self, size=45)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_13_repr_svg_(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_13_repr_svg_ = {"_repr_svg_", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Piece_13_repr_svg_, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_13_repr_svg_(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_repr_svg_ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_12_repr_svg_(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_12_repr_svg_(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_chess = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("_repr_svg_", 0);

  /* "chess/__init__cp.pyx":419
 * 
 *     def _repr_svg_(self):
 *         import chess.svg             # <<<<<<<<<<<<<<
 *         return chess.svg.piece(self, size=45)
 * 
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_chess_svg, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_chess = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":420
 *     def _repr_svg_(self):
 *         import chess.svg
 *         return chess.svg.piece(self, size=45)             # <<<<<<<<<<<<<<
 * 
 *     def __eq__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_chess, __pyx_n_s_svg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_piece); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 420, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_self);
  __Pyx_GIVEREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_self);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 420, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_size, __pyx_int_45) < 0) __PYX_ERR(0, 420, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 420, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":418
 *         return self.symbol()
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.piece(self, size=45)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Piece._repr_svg_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_chess);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":422
 *         return chess.svg.piece(self, size=45)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_15__eq__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_15__eq__ = {"__eq__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Piece_15__eq__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_15__eq__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__eq__", 1, 2, 2, 1); __PYX_ERR(0, 422, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__eq__") < 0)) __PYX_ERR(0, 422, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__eq__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 422, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Piece.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_14__eq__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_14__eq__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_ne = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("__eq__", 0);

  /* "chess/__init__cp.pyx":423
 * 
 *     def __eq__(self, other):
 *         ne = self.__ne__(other)             # <<<<<<<<<<<<<<
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_ne); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 423, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 423, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":424
 *     def __eq__(self, other):
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne             # <<<<<<<<<<<<<<
 * 
 *     def __ne__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = (__pyx_v_ne == __pyx_builtin_NotImplemented);
  if ((__pyx_t_4 != 0)) {
    __Pyx_INCREF(__pyx_builtin_NotImplemented);
    __pyx_t_1 = __pyx_builtin_NotImplemented;
  } else {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_ne); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 424, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 424, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":422
 *         return chess.svg.piece(self, size=45)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Piece.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":426
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.piece_type != other.piece_type:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_17__ne__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_17__ne__ = {"__ne__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Piece_17__ne__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_17__ne__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ne__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__ne__", 1, 2, 2, 1); __PYX_ERR(0, 426, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__ne__") < 0)) __PYX_ERR(0, 426, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__ne__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 426, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Piece.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_16__ne__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_16__ne__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__ne__", 0);

  /* "chess/__init__cp.pyx":427
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.piece_type != other.piece_type:
 *                 return True
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":428
 *     def __ne__(self, other):
 *         try:
 *             if self.piece_type != other.piece_type:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.color != other.color:
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 428, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":429
 *         try:
 *             if self.piece_type != other.piece_type:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.color != other.color:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":428
 *     def __ne__(self, other):
 *         try:
 *             if self.piece_type != other.piece_type:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.color != other.color:
 */
      }

      /* "chess/__init__cp.pyx":430
 *             if self.piece_type != other.piece_type:
 *                 return True
 *             elif self.color != other.color:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_color); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 430, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_color); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 430, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 430, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 430, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":431
 *                 return True
 *             elif self.color != other.color:
 *                 return True             # <<<<<<<<<<<<<<
 *             else:
 *                 return False
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":430
 *             if self.piece_type != other.piece_type:
 *                 return True
 *             elif self.color != other.color:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
      }

      /* "chess/__init__cp.pyx":433
 *                 return True
 *             else:
 *                 return False             # <<<<<<<<<<<<<<
 *         except AttributeError:
 *             return NotImplemented
 */
      /*else*/ {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        goto __pyx_L7_try_return;
      }

      /* "chess/__init__cp.pyx":427
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.piece_type != other.piece_type:
 *                 return True
 */
    }
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":434
 *             else:
 *                 return False
 *         except AttributeError:             # <<<<<<<<<<<<<<
 *             return NotImplemented
 * 
 */
    __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AttributeError);
    if (__pyx_t_8) {
      __Pyx_AddTraceback("chess.__init__cp.Piece.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6) < 0) __PYX_ERR(0, 434, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);

      /* "chess/__init__cp.pyx":435
 *                 return False
 *         except AttributeError:
 *             return NotImplemented             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_builtin_NotImplemented);
      __pyx_r = __pyx_builtin_NotImplemented;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L6_except_return;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":427
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.piece_type != other.piece_type:
 *                 return True
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L6_except_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":426
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.piece_type != other.piece_type:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Piece.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":438
 * 
 *     @classmethod
 *     def from_symbol(cls, symbol):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.Piece` instance from a piece symbol.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_19from_symbol(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Piece_18from_symbol[] = "\n        Creates a :class:`~chess.Piece` instance from a piece symbol.\n\n        :raises: :exc:`ValueError` if the symbol is invalid.\n        ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Piece_19from_symbol = {"from_symbol", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Piece_19from_symbol, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Piece_18from_symbol};
static PyObject *__pyx_pw_5chess_10__init__cp_5Piece_19from_symbol(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_cls = 0;
  PyObject *__pyx_v_symbol = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_symbol (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_cls,&__pyx_n_s_symbol,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cls)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symbol)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("from_symbol", 1, 2, 2, 1); __PYX_ERR(0, 438, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_symbol") < 0)) __PYX_ERR(0, 438, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_cls = values[0];
    __pyx_v_symbol = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("from_symbol", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 438, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Piece.from_symbol", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Piece_18from_symbol(__pyx_self, __pyx_v_cls, __pyx_v_symbol);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Piece_18from_symbol(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_symbol) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("from_symbol", 0);

  /* "chess/__init__cp.pyx":444
 *         :raises: :exc:`ValueError` if the symbol is invalid.
 *         """
 *         if symbol.islower():             # <<<<<<<<<<<<<<
 *             return cls(PIECE_SYMBOLS.index(symbol), BLACK)
 *         else:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_symbol, __pyx_n_s_islower); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":445
 *         """
 *         if symbol.islower():
 *             return cls(PIECE_SYMBOLS.index(symbol), BLACK)             # <<<<<<<<<<<<<<
 *         else:
 *             return cls(PIECE_SYMBOLS.index(symbol.lower()), WHITE)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_index); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_3, __pyx_v_symbol) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_symbol);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_INCREF(__pyx_v_cls);
    __pyx_t_5 = __pyx_v_cls; __pyx_t_3 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_2, Py_False};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_2, Py_False};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 445, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_3) {
        __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __pyx_t_3 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_t_2);
      __Pyx_INCREF(Py_False);
      __Pyx_GIVEREF(Py_False);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, Py_False);
      __pyx_t_2 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":444
 *         :raises: :exc:`ValueError` if the symbol is invalid.
 *         """
 *         if symbol.islower():             # <<<<<<<<<<<<<<
 *             return cls(PIECE_SYMBOLS.index(symbol), BLACK)
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":447
 *             return cls(PIECE_SYMBOLS.index(symbol), BLACK)
 *         else:
 *             return cls(PIECE_SYMBOLS.index(symbol.lower()), WHITE)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 447, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 447, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_symbol, __pyx_n_s_lower); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 447, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_7 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 447, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 447, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v_cls);
    __pyx_t_2 = __pyx_v_cls; __pyx_t_7 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_5, Py_True};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 447, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_5, Py_True};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 447, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 447, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_6, __pyx_t_5);
      __Pyx_INCREF(Py_True);
      __Pyx_GIVEREF(Py_True);
      PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_6, Py_True);
      __pyx_t_5 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 447, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":438
 * 
 *     @classmethod
 *     def from_symbol(cls, symbol):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.Piece` instance from a piece symbol.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Piece.from_symbol", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":463
 *     cdef object drop
 * 
 *     def __init__(self, int from_square, int to_square,             # <<<<<<<<<<<<<<
 *                  promotion=None, drop=None):
 *         self.from_square = from_square
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_4Move_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_5chess_10__init__cp_4Move_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_from_square;
  int __pyx_v_to_square;
  PyObject *__pyx_v_promotion = 0;
  PyObject *__pyx_v_drop = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_square,&__pyx_n_s_to_square,&__pyx_n_s_promotion,&__pyx_n_s_drop,0};
    PyObject* values[4] = {0,0,0,0};

    /* "chess/__init__cp.pyx":464
 * 
 *     def __init__(self, int from_square, int to_square,
 *                  promotion=None, drop=None):             # <<<<<<<<<<<<<<
 *         self.from_square = from_square
 *         self.to_square = to_square
 */
    values[2] = ((PyObject *)Py_None);
    values[3] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_square)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, 1); __PYX_ERR(0, 463, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_promotion);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_drop);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 463, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_square = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_from_square == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 463, __pyx_L3_error)
    __pyx_v_to_square = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_to_square == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 463, __pyx_L3_error)
    __pyx_v_promotion = values[2];
    __pyx_v_drop = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 463, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Move.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move___init__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self), __pyx_v_from_square, __pyx_v_to_square, __pyx_v_promotion, __pyx_v_drop);

  /* "chess/__init__cp.pyx":463
 *     cdef object drop
 * 
 *     def __init__(self, int from_square, int to_square,             # <<<<<<<<<<<<<<
 *                  promotion=None, drop=None):
 *         self.from_square = from_square
 */

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_4Move___init__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, int __pyx_v_from_square, int __pyx_v_to_square, PyObject *__pyx_v_promotion, PyObject *__pyx_v_drop) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":465
 *     def __init__(self, int from_square, int to_square,
 *                  promotion=None, drop=None):
 *         self.from_square = from_square             # <<<<<<<<<<<<<<
 *         self.to_square = to_square
 *         self.promotion = promotion
 */
  __pyx_v_self->from_square = __pyx_v_from_square;

  /* "chess/__init__cp.pyx":466
 *                  promotion=None, drop=None):
 *         self.from_square = from_square
 *         self.to_square = to_square             # <<<<<<<<<<<<<<
 *         self.promotion = promotion
 *         self.drop = drop
 */
  __pyx_v_self->to_square = __pyx_v_to_square;

  /* "chess/__init__cp.pyx":467
 *         self.from_square = from_square
 *         self.to_square = to_square
 *         self.promotion = promotion             # <<<<<<<<<<<<<<
 *         self.drop = drop
 * 
 */
  __Pyx_INCREF(__pyx_v_promotion);
  __Pyx_GIVEREF(__pyx_v_promotion);
  __Pyx_GOTREF(__pyx_v_self->promotion);
  __Pyx_DECREF(__pyx_v_self->promotion);
  __pyx_v_self->promotion = __pyx_v_promotion;

  /* "chess/__init__cp.pyx":468
 *         self.to_square = to_square
 *         self.promotion = promotion
 *         self.drop = drop             # <<<<<<<<<<<<<<
 * 
 *     def uci(self):
 */
  __Pyx_INCREF(__pyx_v_drop);
  __Pyx_GIVEREF(__pyx_v_drop);
  __Pyx_GOTREF(__pyx_v_self->drop);
  __Pyx_DECREF(__pyx_v_self->drop);
  __pyx_v_self->drop = __pyx_v_drop;

  /* "chess/__init__cp.pyx":463
 *     cdef object drop
 * 
 *     def __init__(self, int from_square, int to_square,             # <<<<<<<<<<<<<<
 *                  promotion=None, drop=None):
 *         self.from_square = from_square
 */

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":470
 *         self.drop = drop
 * 
 *     def uci(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets an UCI string for the move.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_3uci(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_4Move_2uci[] = "\n        Gets an UCI string for the move.\n\n        For example, a move from a7 to a8 would be ``a7a8`` or ``a7a8q``\n        (if the latter is a promotion to a queen).\n\n        The UCI representation of a null move is ``0000``.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_3uci(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("uci (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_2uci(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_2uci(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("uci", 0);

  /* "chess/__init__cp.pyx":479
 *         The UCI representation of a null move is ``0000``.
 *         """
 *         if self.drop:             # <<<<<<<<<<<<<<
 *             return PIECE_SYMBOLS[self.drop].upper() + "@" + SQUARE_NAMES[self.to_square]
 *         elif self.promotion:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->drop); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 479, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":480
 *         """
 *         if self.drop:
 *             return PIECE_SYMBOLS[self.drop].upper() + "@" + SQUARE_NAMES[self.to_square]             # <<<<<<<<<<<<<<
 *         elif self.promotion:
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_self->drop); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_upper); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_self->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 480, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":479
 *         The UCI representation of a null move is ``0000``.
 *         """
 *         if self.drop:             # <<<<<<<<<<<<<<
 *             return PIECE_SYMBOLS[self.drop].upper() + "@" + SQUARE_NAMES[self.to_square]
 *         elif self.promotion:
 */
  }

  /* "chess/__init__cp.pyx":481
 *         if self.drop:
 *             return PIECE_SYMBOLS[self.drop].upper() + "@" + SQUARE_NAMES[self.to_square]
 *         elif self.promotion:             # <<<<<<<<<<<<<<
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]
 *         elif self:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->promotion); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 481, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":482
 *             return PIECE_SYMBOLS[self.drop].upper() + "@" + SQUARE_NAMES[self.to_square]
 *         elif self.promotion:
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]             # <<<<<<<<<<<<<<
 *         elif self:
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_self->from_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_self->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_self->promotion); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 482, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":481
 *         if self.drop:
 *             return PIECE_SYMBOLS[self.drop].upper() + "@" + SQUARE_NAMES[self.to_square]
 *         elif self.promotion:             # <<<<<<<<<<<<<<
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]
 *         elif self:
 */
  }

  /* "chess/__init__cp.pyx":483
 *         elif self.promotion:
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]
 *         elif self:             # <<<<<<<<<<<<<<
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square]
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 483, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":484
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]
 *         elif self:
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square]             # <<<<<<<<<<<<<<
 *         else:
 *             return "0000"
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 484, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_self->from_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 484, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 484, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_self->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 484, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 484, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":483
 *         elif self.promotion:
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square] + PIECE_SYMBOLS[self.promotion]
 *         elif self:             # <<<<<<<<<<<<<<
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square]
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":486
 *             return SQUARE_NAMES[self.from_square] + SQUARE_NAMES[self.to_square]
 *         else:
 *             return "0000"             # <<<<<<<<<<<<<<
 * 
 *     def __bool__(self):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u_0000);
    __pyx_r = __pyx_kp_u_0000;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":470
 *         self.drop = drop
 * 
 *     def uci(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets an UCI string for the move.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Move.uci", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":488
 *             return "0000"
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return bool(self.from_square or self.to_square or self.promotion or self.drop)
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_4Move_5__bool__(PyObject *__pyx_v_self); /*proto*/
static int __pyx_pw_5chess_10__init__cp_4Move_5__bool__(PyObject *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__bool__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_4__bool__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_4Move_4__bool__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("__bool__", 0);

  /* "chess/__init__cp.pyx":489
 * 
 *     def __bool__(self):
 *         return bool(self.from_square or self.to_square or self.promotion or self.drop)             # <<<<<<<<<<<<<<
 * 
 *     def __eq__(self, other):
 */
  __pyx_t_2 = (__pyx_v_self->from_square != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_2 = (__pyx_v_self->to_square != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_self->promotion); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 489, __pyx_L1_error)
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_self->drop); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 489, __pyx_L1_error)
  __pyx_t_1 = __pyx_t_2;
  __pyx_L3_bool_binop_done:;
  __pyx_r = (!(!__pyx_t_1));
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":488
 *             return "0000"
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return bool(self.from_square or self.to_square or self.promotion or self.drop)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Move.__bool__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":491
 *         return bool(self.from_square or self.to_square or self.promotion or self.drop)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_7__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_7__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_6__eq__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self), ((PyObject *)__pyx_v_other));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_6__eq__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_ne = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("__eq__", 0);

  /* "chess/__init__cp.pyx":492
 * 
 *     def __eq__(self, other):
 *         ne = self.__ne__(other)             # <<<<<<<<<<<<<<
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ne); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":493
 *     def __eq__(self, other):
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne             # <<<<<<<<<<<<<<
 * 
 *     def __ne__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = (__pyx_v_ne == __pyx_builtin_NotImplemented);
  if ((__pyx_t_4 != 0)) {
    __Pyx_INCREF(__pyx_builtin_NotImplemented);
    __pyx_t_1 = __pyx_builtin_NotImplemented;
  } else {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_ne); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 493, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 493, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":491
 *         return bool(self.from_square or self.to_square or self.promotion or self.drop)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Move.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":495
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.from_square != other.from_square:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_9__ne__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_9__ne__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ne__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_8__ne__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self), ((PyObject *)__pyx_v_other));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_8__ne__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__ne__", 0);

  /* "chess/__init__cp.pyx":496
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.from_square != other.from_square:
 *                 return True
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":497
 *     def __ne__(self, other):
 *         try:
 *             if self.from_square != other.from_square:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.to_square != other.to_square:
 */
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_self->from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 497, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_from_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 497, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 497, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 497, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":498
 *         try:
 *             if self.from_square != other.from_square:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.to_square != other.to_square:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":497
 *     def __ne__(self, other):
 *         try:
 *             if self.from_square != other.from_square:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.to_square != other.to_square:
 */
      }

      /* "chess/__init__cp.pyx":499
 *             if self.from_square != other.from_square:
 *                 return True
 *             elif self.to_square != other.to_square:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.promotion != other.promotion:
 */
      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->to_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 499, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 499, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 499, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 499, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":500
 *                 return True
 *             elif self.to_square != other.to_square:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.promotion != other.promotion:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":499
 *             if self.from_square != other.from_square:
 *                 return True
 *             elif self.to_square != other.to_square:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.promotion != other.promotion:
 */
      }

      /* "chess/__init__cp.pyx":501
 *             elif self.to_square != other.to_square:
 *                 return True
 *             elif self.promotion != other.promotion:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.drop != other.drop:
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_promotion); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 501, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_self->promotion, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 501, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 501, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":502
 *                 return True
 *             elif self.promotion != other.promotion:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.drop != other.drop:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":501
 *             elif self.to_square != other.to_square:
 *                 return True
 *             elif self.promotion != other.promotion:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.drop != other.drop:
 */
      }

      /* "chess/__init__cp.pyx":503
 *             elif self.promotion != other.promotion:
 *                 return True
 *             elif self.drop != other.drop:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_drop); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 503, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_self->drop, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 503, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 503, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":504
 *                 return True
 *             elif self.drop != other.drop:
 *                 return True             # <<<<<<<<<<<<<<
 *             else:
 *                 return False
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":503
 *             elif self.promotion != other.promotion:
 *                 return True
 *             elif self.drop != other.drop:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
      }

      /* "chess/__init__cp.pyx":506
 *                 return True
 *             else:
 *                 return False             # <<<<<<<<<<<<<<
 *         except AttributeError:
 *             return NotImplemented
 */
      /*else*/ {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        goto __pyx_L7_try_return;
      }

      /* "chess/__init__cp.pyx":496
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.from_square != other.from_square:
 *                 return True
 */
    }
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":507
 *             else:
 *                 return False
 *         except AttributeError:             # <<<<<<<<<<<<<<
 *             return NotImplemented
 * 
 */
    __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AttributeError);
    if (__pyx_t_8) {
      __Pyx_AddTraceback("chess.__init__cp.Move.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6) < 0) __PYX_ERR(0, 507, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);

      /* "chess/__init__cp.pyx":508
 *                 return False
 *         except AttributeError:
 *             return NotImplemented             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_builtin_NotImplemented);
      __pyx_r = __pyx_builtin_NotImplemented;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L6_except_return;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":496
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.from_square != other.from_square:
 *                 return True
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L6_except_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":495
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.from_square != other.from_square:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Move.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":510
 *             return NotImplemented
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "Move.from_uci('{}')".format(self.uci())
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_11__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_11__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_10__repr__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_10__repr__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "chess/__init__cp.pyx":511
 * 
 *     def __repr__(self):
 *         return "Move.from_uci('{}')".format(self.uci())             # <<<<<<<<<<<<<<
 * 
 *     def __str__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Move_from_uci, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_uci); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":510
 *             return NotImplemented
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "Move.from_uci('{}')".format(self.uci())
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Move.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":513
 *         return "Move.from_uci('{}')".format(self.uci())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         return self.uci()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_13__str__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_13__str__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_12__str__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_12__str__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__str__", 0);

  /* "chess/__init__cp.pyx":514
 * 
 *     def __str__(self):
 *         return self.uci()             # <<<<<<<<<<<<<<
 * 
 *     def __hash__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_uci); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":513
 *         return "Move.from_uci('{}')".format(self.uci())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         return self.uci()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Move.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":516
 *         return self.uci()
 * 
 *     def __hash__(self):             # <<<<<<<<<<<<<<
 *         return hash((self.to_square, self.from_square, self.promotion, self.drop))
 * 
 */

/* Python wrapper */
static Py_hash_t __pyx_pw_5chess_10__init__cp_4Move_15__hash__(PyObject *__pyx_v_self); /*proto*/
static Py_hash_t __pyx_pw_5chess_10__init__cp_4Move_15__hash__(PyObject *__pyx_v_self) {
  Py_hash_t __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__hash__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_14__hash__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static Py_hash_t __pyx_pf_5chess_10__init__cp_4Move_14__hash__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  Py_hash_t __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_hash_t __pyx_t_4;
  __Pyx_RefNannySetupContext("__hash__", 0);

  /* "chess/__init__cp.pyx":517
 * 
 *     def __hash__(self):
 *         return hash((self.to_square, self.from_square, self.promotion, self.drop))             # <<<<<<<<<<<<<<
 * 
 *     def __copy__(self):
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->to_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->from_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __Pyx_INCREF(__pyx_v_self->promotion);
  __Pyx_GIVEREF(__pyx_v_self->promotion);
  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_self->promotion);
  __Pyx_INCREF(__pyx_v_self->drop);
  __Pyx_GIVEREF(__pyx_v_self->drop);
  PyTuple_SET_ITEM(__pyx_t_3, 3, __pyx_v_self->drop);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_4 = PyObject_Hash(__pyx_t_3); if (unlikely(__pyx_t_4 == ((Py_hash_t)-1))) __PYX_ERR(0, 517, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":516
 *         return self.uci()
 * 
 *     def __hash__(self):             # <<<<<<<<<<<<<<
 *         return hash((self.to_square, self.from_square, self.promotion, self.drop))
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Move.__hash__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  if (unlikely(__pyx_r == -1) && !PyErr_Occurred()) __pyx_r = -2;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":519
 *         return hash((self.to_square, self.from_square, self.promotion, self.drop))
 * 
 *     def __copy__(self):             # <<<<<<<<<<<<<<
 *         return type(self)(self.from_square, self.to_square, self.promotion, self.drop)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_17__copy__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_17__copy__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__copy__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_16__copy__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_16__copy__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("__copy__", 0);

  /* "chess/__init__cp.pyx":520
 * 
 *     def __copy__(self):
 *         return type(self)(self.from_square, self.to_square, self.promotion, self.drop)             # <<<<<<<<<<<<<<
 * 
 *     def __deepcopy__(self, memo):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->from_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 520, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->to_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
  __pyx_t_4 = ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))); __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_t_2, __pyx_t_3, __pyx_v_self->promotion, __pyx_v_self->drop};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_t_2, __pyx_t_3, __pyx_v_self->promotion, __pyx_v_self->drop};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->promotion);
    __Pyx_GIVEREF(__pyx_v_self->promotion);
    PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, __pyx_v_self->promotion);
    __Pyx_INCREF(__pyx_v_self->drop);
    __Pyx_GIVEREF(__pyx_v_self->drop);
    PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, __pyx_v_self->drop);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":519
 *         return hash((self.to_square, self.from_square, self.promotion, self.drop))
 * 
 *     def __copy__(self):             # <<<<<<<<<<<<<<
 *         return type(self)(self.from_square, self.to_square, self.promotion, self.drop)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Move.__copy__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":522
 *         return type(self)(self.from_square, self.to_square, self.promotion, self.drop)
 * 
 *     def __deepcopy__(self, memo):             # <<<<<<<<<<<<<<
 *         move = self.__copy__()
 *         memo[id(self)] = move
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_19__deepcopy__(PyObject *__pyx_v_self, PyObject *__pyx_v_memo); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_19__deepcopy__(PyObject *__pyx_v_self, PyObject *__pyx_v_memo) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__deepcopy__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_18__deepcopy__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self), ((PyObject *)__pyx_v_memo));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_18__deepcopy__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v_memo) {
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__deepcopy__", 0);

  /* "chess/__init__cp.pyx":523
 * 
 *     def __deepcopy__(self, memo):
 *         move = self.__copy__()             # <<<<<<<<<<<<<<
 *         memo[id(self)] = move
 *         return move
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_move = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":524
 *     def __deepcopy__(self, memo):
 *         move = self.__copy__()
 *         memo[id(self)] = move             # <<<<<<<<<<<<<<
 *         return move
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 524, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(PyObject_SetItem(__pyx_v_memo, __pyx_t_1, __pyx_v_move) < 0)) __PYX_ERR(0, 524, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":525
 *         move = self.__copy__()
 *         memo[id(self)] = move
 *         return move             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_move);
  __pyx_r = __pyx_v_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":522
 *         return type(self)(self.from_square, self.to_square, self.promotion, self.drop)
 * 
 *     def __deepcopy__(self, memo):             # <<<<<<<<<<<<<<
 *         move = self.__copy__()
 *         memo[id(self)] = move
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Move.__deepcopy__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":528
 * 
 *     @classmethod
 *     def from_uci(cls, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses an UCI string.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_21from_uci(PyObject *__pyx_v_cls, PyObject *__pyx_v_uci); /*proto*/
static char __pyx_doc_5chess_10__init__cp_4Move_20from_uci[] = "\n        Parses an UCI string.\n\n        :raises: :exc:`ValueError` if the UCI string is invalid.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_21from_uci(PyObject *__pyx_v_cls, PyObject *__pyx_v_uci) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_uci (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_20from_uci(((PyTypeObject*)__pyx_v_cls), ((PyObject *)__pyx_v_uci));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_20from_uci(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_uci) {
  PyObject *__pyx_v_drop = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_promotion = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("from_uci", 0);

  /* "chess/__init__cp.pyx":534
 *         :raises: :exc:`ValueError` if the UCI string is invalid.
 *         """
 *         if uci == "0000":             # <<<<<<<<<<<<<<
 *             return cls.null()
 *         elif len(uci) == 4 and "@" == uci[1]:
 */
  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_uci, __pyx_kp_u_0000, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 534, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":535
 *         """
 *         if uci == "0000":
 *             return cls.null()             # <<<<<<<<<<<<<<
 *         elif len(uci) == 4 and "@" == uci[1]:
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_null); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 535, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":534
 *         :raises: :exc:`ValueError` if the UCI string is invalid.
 *         """
 *         if uci == "0000":             # <<<<<<<<<<<<<<
 *             return cls.null()
 *         elif len(uci) == 4 and "@" == uci[1]:
 */
  }

  /* "chess/__init__cp.pyx":536
 *         if uci == "0000":
 *             return cls.null()
 *         elif len(uci) == 4 and "@" == uci[1]:             # <<<<<<<<<<<<<<
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())
 *             square = SQUARE_NAMES.index(uci[2:])
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_uci); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 536, __pyx_L1_error)
  __pyx_t_6 = ((__pyx_t_5 == 4) != 0);
  if (__pyx_t_6) {
  } else {
    __pyx_t_1 = __pyx_t_6;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_uci, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_kp_u__5, __pyx_t_2, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 536, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_1 = __pyx_t_6;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":537
 *             return cls.null()
 *         elif len(uci) == 4 and "@" == uci[1]:
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())             # <<<<<<<<<<<<<<
 *             square = SQUARE_NAMES.index(uci[2:])
 *             return cls(square, square, drop=drop)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 537, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_uci, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 537, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_lower); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 537, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 537, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_drop = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":538
 *         elif len(uci) == 4 and "@" == uci[1]:
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())
 *             square = SQUARE_NAMES.index(uci[2:])             # <<<<<<<<<<<<<<
 *             return cls(square, square, drop=drop)
 *         elif len(uci) == 4:
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_index); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 538, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_v_uci, 2, 0, NULL, NULL, &__pyx_slice__6, 1, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_8, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_square = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":539
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())
 *             square = SQUARE_NAMES.index(uci[2:])
 *             return cls(square, square, drop=drop)             # <<<<<<<<<<<<<<
 *         elif len(uci) == 4:
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_square);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_square);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 539, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_drop, __pyx_v_drop) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":536
 *         if uci == "0000":
 *             return cls.null()
 *         elif len(uci) == 4 and "@" == uci[1]:             # <<<<<<<<<<<<<<
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())
 *             square = SQUARE_NAMES.index(uci[2:])
 */
  }

  /* "chess/__init__cp.pyx":540
 *             square = SQUARE_NAMES.index(uci[2:])
 *             return cls(square, square, drop=drop)
 *         elif len(uci) == 4:             # <<<<<<<<<<<<<<
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))
 *         elif len(uci) == 5:
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_uci); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
  __pyx_t_1 = ((__pyx_t_5 == 4) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":541
 *             return cls(square, square, drop=drop)
 *         elif len(uci) == 4:
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))             # <<<<<<<<<<<<<<
 *         elif len(uci) == 5:
 *             promotion = PIECE_SYMBOLS.index(uci[4])
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetSlice(__pyx_v_uci, 0, 2, NULL, NULL, &__pyx_slice__7, 1, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_4 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_8, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetSlice(__pyx_v_uci, 2, 4, NULL, NULL, &__pyx_slice__8, 1, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_2);
    __pyx_t_4 = 0;
    __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":540
 *             square = SQUARE_NAMES.index(uci[2:])
 *             return cls(square, square, drop=drop)
 *         elif len(uci) == 4:             # <<<<<<<<<<<<<<
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))
 *         elif len(uci) == 5:
 */
  }

  /* "chess/__init__cp.pyx":542
 *         elif len(uci) == 4:
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))
 *         elif len(uci) == 5:             # <<<<<<<<<<<<<<
 *             promotion = PIECE_SYMBOLS.index(uci[4])
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]), promotion=promotion)
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_uci); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 542, __pyx_L1_error)
  __pyx_t_1 = ((__pyx_t_5 == 5) != 0);
  if (likely(__pyx_t_1)) {

    /* "chess/__init__cp.pyx":543
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))
 *         elif len(uci) == 5:
 *             promotion = PIECE_SYMBOLS.index(uci[4])             # <<<<<<<<<<<<<<
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]), promotion=promotion)
 *         else:
 */
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 543, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_uci, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 543, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 543, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_promotion = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":544
 *         elif len(uci) == 5:
 *             promotion = PIECE_SYMBOLS.index(uci[4])
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]), promotion=promotion)             # <<<<<<<<<<<<<<
 *         else:
 *             raise ValueError("expected uci string to be of length 4 or 5: {}".format(repr(uci)))
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_v_uci, 0, 2, NULL, NULL, &__pyx_slice__7, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_index); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_v_uci, 2, 4, NULL, NULL, &__pyx_slice__8, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_8 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_8);
    __pyx_t_2 = 0;
    __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_promotion, __pyx_v_promotion) < 0) __PYX_ERR(0, 544, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 544, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":542
 *         elif len(uci) == 4:
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))
 *         elif len(uci) == 5:             # <<<<<<<<<<<<<<
 *             promotion = PIECE_SYMBOLS.index(uci[4])
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]), promotion=promotion)
 */
  }

  /* "chess/__init__cp.pyx":546
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]), promotion=promotion)
 *         else:
 *             raise ValueError("expected uci string to be of length 4 or 5: {}".format(repr(uci)))             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  /*else*/ {
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_expected_uci_string_to_be_of_len, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 546, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = PyObject_Repr(__pyx_v_uci); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 546, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 546, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_8, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __PYX_ERR(0, 546, __pyx_L1_error)
  }

  /* "chess/__init__cp.pyx":528
 * 
 *     @classmethod
 *     def from_uci(cls, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses an UCI string.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Move.from_uci", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_drop);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_promotion);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":549
 * 
 *     @classmethod
 *     def null(cls):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a null move.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_23null(PyObject *__pyx_v_cls, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_4Move_22null[] = "\n        Gets a null move.\n\n        A null move just passes the turn to the other side (and possibly\n        forfeits en passant capturing). Null moves evaluate to ``False`` in\n        boolean contexts.\n\n        >>> import chess\n        >>>\n        >>> bool(chess.Move.null())\n        False\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_23null(PyObject *__pyx_v_cls, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("null (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_22null(((PyTypeObject*)__pyx_v_cls));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_22null(PyTypeObject *__pyx_v_cls) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("null", 0);

  /* "chess/__init__cp.pyx":562
 *         False
 *         """
 *         return cls(0, 0)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":549
 * 
 *     @classmethod
 *     def null(cls):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a null move.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.Move.null", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_25__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_25__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_24__reduce_cython__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_24__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self) {
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v__dict = 0;
  int __pyx_v_use_setstate;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__reduce_cython__", 0);

  /* "(tree fragment)":5
 *     cdef object _dict
 *     cdef bint use_setstate
 *     state = (self.drop, self.from_square, self.promotion, self.to_square)             # <<<<<<<<<<<<<<
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_self->drop);
  __Pyx_GIVEREF(__pyx_v_self->drop);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->drop);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
  __Pyx_INCREF(__pyx_v_self->promotion);
  __Pyx_GIVEREF(__pyx_v_self->promotion);
  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_self->promotion);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 3, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_v_state = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "(tree fragment)":6
 *     cdef bint use_setstate
 *     state = (self.drop, self.from_square, self.promotion, self.to_square)
 *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
 *     if _dict is not None:
 *         state += (_dict,)
 */
  __pyx_t_3 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v__dict = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":7
 *     state = (self.drop, self.from_square, self.promotion, self.to_square)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
  __pyx_t_4 = (__pyx_v__dict != Py_None);
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (__pyx_t_5) {

    /* "(tree fragment)":8
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 *         state += (_dict,)             # <<<<<<<<<<<<<<
 *         use_setstate = True
 *     else:
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v__dict);
    __Pyx_GIVEREF(__pyx_v__dict);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v__dict);
    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "(tree fragment)":9
 *     if _dict is not None:
 *         state += (_dict,)
 *         use_setstate = True             # <<<<<<<<<<<<<<
 *     else:
 *         use_setstate = self.drop is not None or self.promotion is not None
 */
    __pyx_v_use_setstate = 1;

    /* "(tree fragment)":7
 *     state = (self.drop, self.from_square, self.promotion, self.to_square)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
    goto __pyx_L3;
  }

  /* "(tree fragment)":11
 *         use_setstate = True
 *     else:
 *         use_setstate = self.drop is not None or self.promotion is not None             # <<<<<<<<<<<<<<
 *     if use_setstate:
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, None), state
 */
  /*else*/ {
    __pyx_t_4 = (__pyx_v_self->drop != Py_None);
    __pyx_t_6 = (__pyx_t_4 != 0);
    if (!__pyx_t_6) {
    } else {
      __pyx_t_5 = __pyx_t_6;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_6 = (__pyx_v_self->promotion != Py_None);
    __pyx_t_4 = (__pyx_t_6 != 0);
    __pyx_t_5 = __pyx_t_4;
    __pyx_L4_bool_binop_done:;
    __pyx_v_use_setstate = __pyx_t_5;
  }
  __pyx_L3:;

  /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.drop is not None or self.promotion is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, None), state
 *     else:
 */
  __pyx_t_5 = (__pyx_v_use_setstate != 0);
  if (__pyx_t_5) {

    /* "(tree fragment)":13
 *         use_setstate = self.drop is not None or self.promotion is not None
 *     if use_setstate:
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, None), state             # <<<<<<<<<<<<<<
 *     else:
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, state)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pyx_unpickle_Move); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_95108563);
    __Pyx_GIVEREF(__pyx_int_95108563);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_int_95108563);
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_3, 2, Py_None);
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_state);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.drop is not None or self.promotion is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, None), state
 *     else:
 */
  }

  /* "(tree fragment)":15
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, None), state
 *     else:
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, state)             # <<<<<<<<<<<<<<
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_Move__set_state(self, __pyx_state)
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_pyx_unpickle_Move); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_95108563);
    __Pyx_GIVEREF(__pyx_int_95108563);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_int_95108563);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_state);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
    __pyx_t_1 = 0;
    __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }

  /* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Move.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v__dict);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_Move__set_state(self, __pyx_state)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_27__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_4Move_27__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_4Move_26__setstate_cython__(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_4Move_26__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__setstate_cython__", 0);

  /* "(tree fragment)":17
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, state)
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_Move__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
 */
  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_5chess_10__init__cp___pyx_unpickle_Move__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_Move, (type(self), 0x5ab3dd3, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_Move__set_state(self, __pyx_state)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.Move.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":596
 * 
 * 
 *     def __init__(self, str board_fen=STARTING_BOARD_FEN):             # <<<<<<<<<<<<<<
 *         self.occupied_co[0] = BB_EMPTY
 *         self.occupied_co[1] = BB_EMPTY
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_9BaseBoard_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_5chess_10__init__cp_9BaseBoard_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_board_fen = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_board_fen,0};
    PyObject* values[1] = {0};
    values[0] = __pyx_k__10;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_board_fen);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 596, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_board_fen = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 596, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_board_fen), (&PyUnicode_Type), 1, "board_fen", 1))) __PYX_ERR(0, 596, __pyx_L1_error)
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard___init__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_board_fen);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_9BaseBoard___init__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_board_fen) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":597
 * 
 *     def __init__(self, str board_fen=STARTING_BOARD_FEN):
 *         self.occupied_co[0] = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.occupied_co[1] = BB_EMPTY
 * 
 */
  (__pyx_v_self->occupied_co[0]) = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":598
 *     def __init__(self, str board_fen=STARTING_BOARD_FEN):
 *         self.occupied_co[0] = BB_EMPTY
 *         self.occupied_co[1] = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *         if board_fen is None:
 */
  (__pyx_v_self->occupied_co[1]) = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":600
 *         self.occupied_co[1] = BB_EMPTY
 * 
 *         if board_fen is None:             # <<<<<<<<<<<<<<
 *             self._clear_board()
 *         elif board_fen == STARTING_BOARD_FEN:
 */
  __pyx_t_1 = (__pyx_v_board_fen == ((PyObject*)Py_None));
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":601
 * 
 *         if board_fen is None:
 *             self._clear_board()             # <<<<<<<<<<<<<<
 *         elif board_fen == STARTING_BOARD_FEN:
 *             self._reset_board()
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_board); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 601, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 601, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":600
 *         self.occupied_co[1] = BB_EMPTY
 * 
 *         if board_fen is None:             # <<<<<<<<<<<<<<
 *             self._clear_board()
 *         elif board_fen == STARTING_BOARD_FEN:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":602
 *         if board_fen is None:
 *             self._clear_board()
 *         elif board_fen == STARTING_BOARD_FEN:             # <<<<<<<<<<<<<<
 *             self._reset_board()
 *         else:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_STARTING_BOARD_FEN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 602, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_board_fen, __pyx_t_3, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 602, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":603
 *             self._clear_board()
 *         elif board_fen == STARTING_BOARD_FEN:
 *             self._reset_board()             # <<<<<<<<<<<<<<
 *         else:
 *             self._set_board_fen(board_fen)
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset_board); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 603, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 603, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":602
 *         if board_fen is None:
 *             self._clear_board()
 *         elif board_fen == STARTING_BOARD_FEN:             # <<<<<<<<<<<<<<
 *             self._reset_board()
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":605
 *             self._reset_board()
 *         else:
 *             self._set_board_fen(board_fen)             # <<<<<<<<<<<<<<
 * 
 *     def _reset_board(self):
 */
  /*else*/ {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_board_fen); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 605, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_board_fen) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_board_fen);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 605, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":596
 * 
 * 
 *     def __init__(self, str board_fen=STARTING_BOARD_FEN):             # <<<<<<<<<<<<<<
 *         self.occupied_co[0] = BB_EMPTY
 *         self.occupied_co[1] = BB_EMPTY
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":607
 *             self._set_board_fen(board_fen)
 * 
 *     def _reset_board(self):             # <<<<<<<<<<<<<<
 *         self.pawns = BB_RANK_2 | BB_RANK_7
 *         self.knights = BB_B1 | BB_G1 | BB_B8 | BB_G8
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_3_reset_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_3_reset_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_reset_board (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_2_reset_board(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_2_reset_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  unsigned PY_LONG_LONG __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("_reset_board", 0);

  /* "chess/__init__cp.pyx":608
 * 
 *     def _reset_board(self):
 *         self.pawns = BB_RANK_2 | BB_RANK_7             # <<<<<<<<<<<<<<
 *         self.knights = BB_B1 | BB_G1 | BB_B8 | BB_G8
 *         self.bishops = BB_C1 | BB_F1 | BB_C8 | BB_F8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_3); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->pawns = __pyx_t_4;

  /* "chess/__init__cp.pyx":609
 *     def _reset_board(self):
 *         self.pawns = BB_RANK_2 | BB_RANK_7
 *         self.knights = BB_B1 | BB_G1 | BB_B8 | BB_G8             # <<<<<<<<<<<<<<
 *         self.bishops = BB_C1 | BB_F1 | BB_C8 | BB_F8
 *         self.rooks = BB_CORNERS
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_B1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_G1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_B8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_G8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 609, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->knights = __pyx_t_4;

  /* "chess/__init__cp.pyx":610
 *         self.pawns = BB_RANK_2 | BB_RANK_7
 *         self.knights = BB_B1 | BB_G1 | BB_B8 | BB_G8
 *         self.bishops = BB_C1 | BB_F1 | BB_C8 | BB_F8             # <<<<<<<<<<<<<<
 *         self.rooks = BB_CORNERS
 *         self.queens = BB_D1 | BB_D8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_C1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_F1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_C8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_F8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_3); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->bishops = __pyx_t_4;

  /* "chess/__init__cp.pyx":611
 *         self.knights = BB_B1 | BB_G1 | BB_B8 | BB_G8
 *         self.bishops = BB_C1 | BB_F1 | BB_C8 | BB_F8
 *         self.rooks = BB_CORNERS             # <<<<<<<<<<<<<<
 *         self.queens = BB_D1 | BB_D8
 *         self.kings = BB_E1 | BB_E8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_CORNERS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 611, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_3); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 611, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->rooks = __pyx_t_4;

  /* "chess/__init__cp.pyx":612
 *         self.bishops = BB_C1 | BB_F1 | BB_C8 | BB_F8
 *         self.rooks = BB_CORNERS
 *         self.queens = BB_D1 | BB_D8             # <<<<<<<<<<<<<<
 *         self.kings = BB_E1 | BB_E8
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_D1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_D8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 612, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->queens = __pyx_t_4;

  /* "chess/__init__cp.pyx":613
 *         self.rooks = BB_CORNERS
 *         self.queens = BB_D1 | BB_D8
 *         self.kings = BB_E1 | BB_E8             # <<<<<<<<<<<<<<
 * 
 *         self.promoted = BB_EMPTY
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_E1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_E8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_3); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->kings = __pyx_t_4;

  /* "chess/__init__cp.pyx":615
 *         self.kings = BB_E1 | BB_E8
 * 
 *         self.promoted = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2
 */
  __pyx_v_self->promoted = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":617
 *         self.promoted = BB_EMPTY
 * 
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2             # <<<<<<<<<<<<<<
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 617, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  (__pyx_v_self->occupied_co[1]) = __pyx_t_4;

  /* "chess/__init__cp.pyx":618
 * 
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8             # <<<<<<<<<<<<<<
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_3); if (unlikely((__pyx_t_4 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 618, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  (__pyx_v_self->occupied_co[0]) = __pyx_t_4;

  /* "chess/__init__cp.pyx":619
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8             # <<<<<<<<<<<<<<
 * 
 *     def reset_board(self):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 619, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->occupied = __pyx_t_5;

  /* "chess/__init__cp.pyx":607
 *             self._set_board_fen(board_fen)
 * 
 *     def _reset_board(self):             # <<<<<<<<<<<<<<
 *         self.pawns = BB_RANK_2 | BB_RANK_7
 *         self.knights = BB_B1 | BB_G1 | BB_B8 | BB_G8
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._reset_board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":621
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 * 
 *     def reset_board(self):             # <<<<<<<<<<<<<<
 *         self._reset_board()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_5reset_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_5reset_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reset_board (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_4reset_board(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_4reset_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("reset_board", 0);

  /* "chess/__init__cp.pyx":622
 * 
 *     def reset_board(self):
 *         self._reset_board()             # <<<<<<<<<<<<<<
 * 
 *     def _clear_board(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 622, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 622, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":621
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 * 
 *     def reset_board(self):             # <<<<<<<<<<<<<<
 *         self._reset_board()
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.reset_board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":624
 *         self._reset_board()
 * 
 *     def _clear_board(self):             # <<<<<<<<<<<<<<
 *         self.pawns = BB_EMPTY
 *         self.knights = BB_EMPTY
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_7_clear_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_7_clear_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_clear_board (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_6_clear_board(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_6_clear_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_clear_board", 0);

  /* "chess/__init__cp.pyx":625
 * 
 *     def _clear_board(self):
 *         self.pawns = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.knights = BB_EMPTY
 *         self.bishops = BB_EMPTY
 */
  __pyx_v_self->pawns = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":626
 *     def _clear_board(self):
 *         self.pawns = BB_EMPTY
 *         self.knights = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.bishops = BB_EMPTY
 *         self.rooks = BB_EMPTY
 */
  __pyx_v_self->knights = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":627
 *         self.pawns = BB_EMPTY
 *         self.knights = BB_EMPTY
 *         self.bishops = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.rooks = BB_EMPTY
 *         self.queens = BB_EMPTY
 */
  __pyx_v_self->bishops = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":628
 *         self.knights = BB_EMPTY
 *         self.bishops = BB_EMPTY
 *         self.rooks = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.queens = BB_EMPTY
 *         self.kings = BB_EMPTY
 */
  __pyx_v_self->rooks = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":629
 *         self.bishops = BB_EMPTY
 *         self.rooks = BB_EMPTY
 *         self.queens = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.kings = BB_EMPTY
 * 
 */
  __pyx_v_self->queens = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":630
 *         self.rooks = BB_EMPTY
 *         self.queens = BB_EMPTY
 *         self.kings = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *         self.promoted = BB_EMPTY
 */
  __pyx_v_self->kings = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":632
 *         self.kings = BB_EMPTY
 * 
 *         self.promoted = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *         self.occupied_co[WHITE] = BB_EMPTY
 */
  __pyx_v_self->promoted = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":634
 *         self.promoted = BB_EMPTY
 * 
 *         self.occupied_co[WHITE] = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.occupied_co[BLACK] = BB_EMPTY
 *         self.occupied = BB_EMPTY
 */
  (__pyx_v_self->occupied_co[1]) = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":635
 * 
 *         self.occupied_co[WHITE] = BB_EMPTY
 *         self.occupied_co[BLACK] = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.occupied = BB_EMPTY
 * 
 */
  (__pyx_v_self->occupied_co[0]) = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":636
 *         self.occupied_co[WHITE] = BB_EMPTY
 *         self.occupied_co[BLACK] = BB_EMPTY
 *         self.occupied = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *     def clear_board(self):
 */
  __pyx_v_self->occupied = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":624
 *         self._reset_board()
 * 
 *     def _clear_board(self):             # <<<<<<<<<<<<<<
 *         self.pawns = BB_EMPTY
 *         self.knights = BB_EMPTY
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":638
 *         self.occupied = BB_EMPTY
 * 
 *     def clear_board(self):             # <<<<<<<<<<<<<<
 *         """Clears the board."""
 *         self._clear_board()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_9clear_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_8clear_board[] = "Clears the board.";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_9clear_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clear_board (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_8clear_board(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_8clear_board(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("clear_board", 0);

  /* "chess/__init__cp.pyx":640
 *     def clear_board(self):
 *         """Clears the board."""
 *         self._clear_board()             # <<<<<<<<<<<<<<
 * 
 *     def pieces_mask(self, piece_type, color):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":638
 *         self.occupied = BB_EMPTY
 * 
 *     def clear_board(self):             # <<<<<<<<<<<<<<
 *         """Clears the board."""
 *         self._clear_board()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.clear_board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":642
 *         self._clear_board()
 * 
 *     def pieces_mask(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         if piece_type == PAWN:
 *             bb = self.pawns
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_11pieces_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_11pieces_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_piece_type = 0;
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pieces_mask (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_piece_type,&__pyx_n_s_color,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("pieces_mask", 1, 2, 2, 1); __PYX_ERR(0, 642, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "pieces_mask") < 0)) __PYX_ERR(0, 642, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_piece_type = values[0];
    __pyx_v_color = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("pieces_mask", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 642, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pieces_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_10pieces_mask(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_piece_type, __pyx_v_color);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_10pieces_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color) {
  unsigned PY_LONG_LONG __pyx_v_bb;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  unsigned PY_LONG_LONG __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  __Pyx_RefNannySetupContext("pieces_mask", 0);

  /* "chess/__init__cp.pyx":643
 * 
 *     def pieces_mask(self, piece_type, color):
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             bb = self.pawns
 *         elif piece_type == KNIGHT:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 643, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 643, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 643, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":644
 *     def pieces_mask(self, piece_type, color):
 *         if piece_type == PAWN:
 *             bb = self.pawns             # <<<<<<<<<<<<<<
 *         elif piece_type == KNIGHT:
 *             bb = self.knights
 */
    __pyx_t_4 = __pyx_v_self->pawns;
    __pyx_v_bb = __pyx_t_4;

    /* "chess/__init__cp.pyx":643
 * 
 *     def pieces_mask(self, piece_type, color):
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             bb = self.pawns
 *         elif piece_type == KNIGHT:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":645
 *         if piece_type == PAWN:
 *             bb = self.pawns
 *         elif piece_type == KNIGHT:             # <<<<<<<<<<<<<<
 *             bb = self.knights
 *         elif piece_type == BISHOP:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KNIGHT); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 645, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 645, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 645, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":646
 *             bb = self.pawns
 *         elif piece_type == KNIGHT:
 *             bb = self.knights             # <<<<<<<<<<<<<<
 *         elif piece_type == BISHOP:
 *             bb = self.bishops
 */
    __pyx_t_4 = __pyx_v_self->knights;
    __pyx_v_bb = __pyx_t_4;

    /* "chess/__init__cp.pyx":645
 *         if piece_type == PAWN:
 *             bb = self.pawns
 *         elif piece_type == KNIGHT:             # <<<<<<<<<<<<<<
 *             bb = self.knights
 *         elif piece_type == BISHOP:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":647
 *         elif piece_type == KNIGHT:
 *             bb = self.knights
 *         elif piece_type == BISHOP:             # <<<<<<<<<<<<<<
 *             bb = self.bishops
 *         elif piece_type == ROOK:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BISHOP); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 647, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 647, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":648
 *             bb = self.knights
 *         elif piece_type == BISHOP:
 *             bb = self.bishops             # <<<<<<<<<<<<<<
 *         elif piece_type == ROOK:
 *             bb = self.rooks
 */
    __pyx_t_4 = __pyx_v_self->bishops;
    __pyx_v_bb = __pyx_t_4;

    /* "chess/__init__cp.pyx":647
 *         elif piece_type == KNIGHT:
 *             bb = self.knights
 *         elif piece_type == BISHOP:             # <<<<<<<<<<<<<<
 *             bb = self.bishops
 *         elif piece_type == ROOK:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":649
 *         elif piece_type == BISHOP:
 *             bb = self.bishops
 *         elif piece_type == ROOK:             # <<<<<<<<<<<<<<
 *             bb = self.rooks
 *         elif piece_type == QUEEN:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 649, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 649, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 649, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":650
 *             bb = self.bishops
 *         elif piece_type == ROOK:
 *             bb = self.rooks             # <<<<<<<<<<<<<<
 *         elif piece_type == QUEEN:
 *             bb = self.queens
 */
    __pyx_t_4 = __pyx_v_self->rooks;
    __pyx_v_bb = __pyx_t_4;

    /* "chess/__init__cp.pyx":649
 *         elif piece_type == BISHOP:
 *             bb = self.bishops
 *         elif piece_type == ROOK:             # <<<<<<<<<<<<<<
 *             bb = self.rooks
 *         elif piece_type == QUEEN:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":651
 *         elif piece_type == ROOK:
 *             bb = self.rooks
 *         elif piece_type == QUEEN:             # <<<<<<<<<<<<<<
 *             bb = self.queens
 *         elif piece_type == KING:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_QUEEN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 651, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 651, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 651, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":652
 *             bb = self.rooks
 *         elif piece_type == QUEEN:
 *             bb = self.queens             # <<<<<<<<<<<<<<
 *         elif piece_type == KING:
 *             bb = self.kings
 */
    __pyx_t_4 = __pyx_v_self->queens;
    __pyx_v_bb = __pyx_t_4;

    /* "chess/__init__cp.pyx":651
 *         elif piece_type == ROOK:
 *             bb = self.rooks
 *         elif piece_type == QUEEN:             # <<<<<<<<<<<<<<
 *             bb = self.queens
 *         elif piece_type == KING:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":653
 *         elif piece_type == QUEEN:
 *             bb = self.queens
 *         elif piece_type == KING:             # <<<<<<<<<<<<<<
 *             bb = self.kings
 *         else:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KING); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 653, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 653, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 653, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":654
 *             bb = self.queens
 *         elif piece_type == KING:
 *             bb = self.kings             # <<<<<<<<<<<<<<
 *         else:
 *             bb = BB_EMPTY
 */
    __pyx_t_4 = __pyx_v_self->kings;
    __pyx_v_bb = __pyx_t_4;

    /* "chess/__init__cp.pyx":653
 *         elif piece_type == QUEEN:
 *             bb = self.queens
 *         elif piece_type == KING:             # <<<<<<<<<<<<<<
 *             bb = self.kings
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":656
 *             bb = self.kings
 *         else:
 *             bb = BB_EMPTY             # <<<<<<<<<<<<<<
 *         return bb & self.occupied_co[color]
 * 
 */
  /*else*/ {
    __pyx_v_bb = __pyx_v_5chess_10__init__cp_BB_EMPTY;
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":657
 *         else:
 *             bb = BB_EMPTY
 *         return bb & self.occupied_co[color]             # <<<<<<<<<<<<<<
 * 
 *     def pieces(self, piece_type, color):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_v_color); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 657, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_bb & (__pyx_v_self->occupied_co[__pyx_t_5]))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":642
 *         self._clear_board()
 * 
 *     def pieces_mask(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         if piece_type == PAWN:
 *             bb = self.pawns
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pieces_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":659
 *         return bb & self.occupied_co[color]
 * 
 *     def pieces(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         """
 *         Gets pieces of the given type and color.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_13pieces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_12pieces[] = "\n        Gets pieces of the given type and color.\n\n        Returns a :class:`set of squares <chess.SquareSet>`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_13pieces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_piece_type = 0;
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pieces (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_piece_type,&__pyx_n_s_color,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("pieces", 1, 2, 2, 1); __PYX_ERR(0, 659, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "pieces") < 0)) __PYX_ERR(0, 659, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_piece_type = values[0];
    __pyx_v_color = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("pieces", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 659, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pieces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_12pieces(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_piece_type, __pyx_v_color);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_12pieces(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("pieces", 0);

  /* "chess/__init__cp.pyx":665
 *         Returns a :class:`set of squares <chess.SquareSet>`.
 *         """
 *         return SquareSet(self.pieces_mask(piece_type, color))             # <<<<<<<<<<<<<<
 * 
 *     def piece_at(self, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 665, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_pieces_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 665, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_piece_type, __pyx_v_color};
    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 665, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_piece_type, __pyx_v_color};
    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 665, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 665, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(__pyx_v_piece_type);
    __Pyx_GIVEREF(__pyx_v_piece_type);
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_piece_type);
    __Pyx_INCREF(__pyx_v_color);
    __Pyx_GIVEREF(__pyx_v_color);
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_v_color);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 665, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 665, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":659
 *         return bb & self.occupied_co[color]
 * 
 *     def pieces(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         """
 *         Gets pieces of the given type and color.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pieces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":667
 *         return SquareSet(self.pieces_mask(piece_type, color))
 * 
 *     def piece_at(self, square):             # <<<<<<<<<<<<<<
 *         """Gets the :class:`piece <chess.Piece>` at the given square."""
 *         piece_type = self.piece_type_at(square)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_15piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_14piece_at[] = "Gets the :class:`piece <chess.Piece>` at the given square.";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_15piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("piece_at (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_14piece_at(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_14piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_piece_type = NULL;
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_v_color = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("piece_at", 0);

  /* "chess/__init__cp.pyx":669
 *     def piece_at(self, square):
 *         """Gets the :class:`piece <chess.Piece>` at the given square."""
 *         piece_type = self.piece_type_at(square)             # <<<<<<<<<<<<<<
 *         if piece_type:
 *             mask = BB_SQUARES[square]
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_type_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_piece_type = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":670
 *         """Gets the :class:`piece <chess.Piece>` at the given square."""
 *         piece_type = self.piece_type_at(square)
 *         if piece_type:             # <<<<<<<<<<<<<<
 *             mask = BB_SQUARES[square]
 *             color = bool(self.occupied_co[WHITE] & mask)
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_piece_type); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 670, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":671
 *         piece_type = self.piece_type_at(square)
 *         if piece_type:
 *             mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 *             color = bool(self.occupied_co[WHITE] & mask)
 *             return Piece(piece_type, color)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_mask = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":672
 *         if piece_type:
 *             mask = BB_SQUARES[square]
 *             color = bool(self.occupied_co[WHITE] & mask)             # <<<<<<<<<<<<<<
 *             return Piece(piece_type, color)
 * 
 */
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 672, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 672, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 672, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyBool_FromLong((!(!__pyx_t_4))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 672, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_v_color = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":673
 *             mask = BB_SQUARES[square]
 *             color = bool(self.occupied_co[WHITE] & mask)
 *             return Piece(piece_type, color)             # <<<<<<<<<<<<<<
 * 
 *     def piece_type_at(self, square):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_Piece); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_5 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_piece_type, __pyx_v_color};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_piece_type, __pyx_v_color};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_3) {
        __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
      }
      __Pyx_INCREF(__pyx_v_piece_type);
      __Pyx_GIVEREF(__pyx_v_piece_type);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_piece_type);
      __Pyx_INCREF(__pyx_v_color);
      __Pyx_GIVEREF(__pyx_v_color);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_color);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":670
 *         """Gets the :class:`piece <chess.Piece>` at the given square."""
 *         piece_type = self.piece_type_at(square)
 *         if piece_type:             # <<<<<<<<<<<<<<
 *             mask = BB_SQUARES[square]
 *             color = bool(self.occupied_co[WHITE] & mask)
 */
  }

  /* "chess/__init__cp.pyx":667
 *         return SquareSet(self.pieces_mask(piece_type, color))
 * 
 *     def piece_at(self, square):             # <<<<<<<<<<<<<<
 *         """Gets the :class:`piece <chess.Piece>` at the given square."""
 *         piece_type = self.piece_type_at(square)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_piece_type);
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XDECREF(__pyx_v_color);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":675
 *             return Piece(piece_type, color)
 * 
 *     def piece_type_at(self, square):             # <<<<<<<<<<<<<<
 *         """Gets the piece type at the given square."""
 *         mask = BB_SQUARES[square]
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_17piece_type_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_16piece_type_at[] = "Gets the piece type at the given square.";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_17piece_type_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("piece_type_at (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_16piece_type_at(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_16piece_type_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("piece_type_at", 0);

  /* "chess/__init__cp.pyx":677
 *     def piece_type_at(self, square):
 *         """Gets the piece type at the given square."""
 *         mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *         if not self.occupied & mask:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 677, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 677, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mask = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":679
 *         mask = BB_SQUARES[square]
 * 
 *         if not self.occupied & mask:             # <<<<<<<<<<<<<<
 *             return None
 *         elif self.pawns & mask:
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 679, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = ((!__pyx_t_3) != 0);
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":680
 * 
 *         if not self.occupied & mask:
 *             return None             # <<<<<<<<<<<<<<
 *         elif self.pawns & mask:
 *             return PAWN
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":679
 *         mask = BB_SQUARES[square]
 * 
 *         if not self.occupied & mask:             # <<<<<<<<<<<<<<
 *             return None
 *         elif self.pawns & mask:
 */
  }

  /* "chess/__init__cp.pyx":681
 *         if not self.occupied & mask:
 *             return None
 *         elif self.pawns & mask:             # <<<<<<<<<<<<<<
 *             return PAWN
 *         elif self.knights & mask:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 681, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 681, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 681, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":682
 *             return None
 *         elif self.pawns & mask:
 *             return PAWN             # <<<<<<<<<<<<<<
 *         elif self.knights & mask:
 *             return KNIGHT
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 682, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":681
 *         if not self.occupied & mask:
 *             return None
 *         elif self.pawns & mask:             # <<<<<<<<<<<<<<
 *             return PAWN
 *         elif self.knights & mask:
 */
  }

  /* "chess/__init__cp.pyx":683
 *         elif self.pawns & mask:
 *             return PAWN
 *         elif self.knights & mask:             # <<<<<<<<<<<<<<
 *             return KNIGHT
 *         elif self.bishops & mask:
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 683, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":684
 *             return PAWN
 *         elif self.knights & mask:
 *             return KNIGHT             # <<<<<<<<<<<<<<
 *         elif self.bishops & mask:
 *             return BISHOP
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_KNIGHT); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 684, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":683
 *         elif self.pawns & mask:
 *             return PAWN
 *         elif self.knights & mask:             # <<<<<<<<<<<<<<
 *             return KNIGHT
 *         elif self.bishops & mask:
 */
  }

  /* "chess/__init__cp.pyx":685
 *         elif self.knights & mask:
 *             return KNIGHT
 *         elif self.bishops & mask:             # <<<<<<<<<<<<<<
 *             return BISHOP
 *         elif self.rooks & mask:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 685, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 685, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 685, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":686
 *             return KNIGHT
 *         elif self.bishops & mask:
 *             return BISHOP             # <<<<<<<<<<<<<<
 *         elif self.rooks & mask:
 *             return ROOK
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BISHOP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 686, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":685
 *         elif self.knights & mask:
 *             return KNIGHT
 *         elif self.bishops & mask:             # <<<<<<<<<<<<<<
 *             return BISHOP
 *         elif self.rooks & mask:
 */
  }

  /* "chess/__init__cp.pyx":687
 *         elif self.bishops & mask:
 *             return BISHOP
 *         elif self.rooks & mask:             # <<<<<<<<<<<<<<
 *             return ROOK
 *         elif self.queens & mask:
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 687, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":688
 *             return BISHOP
 *         elif self.rooks & mask:
 *             return ROOK             # <<<<<<<<<<<<<<
 *         elif self.queens & mask:
 *             return QUEEN
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 688, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":687
 *         elif self.bishops & mask:
 *             return BISHOP
 *         elif self.rooks & mask:             # <<<<<<<<<<<<<<
 *             return ROOK
 *         elif self.queens & mask:
 */
  }

  /* "chess/__init__cp.pyx":689
 *         elif self.rooks & mask:
 *             return ROOK
 *         elif self.queens & mask:             # <<<<<<<<<<<<<<
 *             return QUEEN
 *         elif self.kings & mask:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 689, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":690
 *             return ROOK
 *         elif self.queens & mask:
 *             return QUEEN             # <<<<<<<<<<<<<<
 *         elif self.kings & mask:
 *             return KING
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_QUEEN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 690, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":689
 *         elif self.rooks & mask:
 *             return ROOK
 *         elif self.queens & mask:             # <<<<<<<<<<<<<<
 *             return QUEEN
 *         elif self.kings & mask:
 */
  }

  /* "chess/__init__cp.pyx":691
 *         elif self.queens & mask:
 *             return QUEEN
 *         elif self.kings & mask:             # <<<<<<<<<<<<<<
 *             return KING
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 691, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 691, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 691, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":692
 *             return QUEEN
 *         elif self.kings & mask:
 *             return KING             # <<<<<<<<<<<<<<
 * 
 *     def king(self, color):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_KING); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 692, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":691
 *         elif self.queens & mask:
 *             return QUEEN
 *         elif self.kings & mask:             # <<<<<<<<<<<<<<
 *             return KING
 * 
 */
  }

  /* "chess/__init__cp.pyx":675
 *             return Piece(piece_type, color)
 * 
 *     def piece_type_at(self, square):             # <<<<<<<<<<<<<<
 *         """Gets the piece type at the given square."""
 *         mask = BB_SQUARES[square]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.piece_type_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":694
 *             return KING
 * 
 *     def king(self, color):             # <<<<<<<<<<<<<<
 *         """
 *         Finds the king square of the given side. Returns ``None`` if there
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_19king(PyObject *__pyx_v_self, PyObject *__pyx_v_color); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_18king[] = "\n        Finds the king square of the given side. Returns ``None`` if there\n        is no king of that color.\n\n        In variants with king promotions, only non-promoted kings are\n        considered.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_19king(PyObject *__pyx_v_self, PyObject *__pyx_v_color) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("king (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_18king(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_color));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_18king(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color) {
  PyObject *__pyx_v_king_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  Py_ssize_t __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("king", 0);

  /* "chess/__init__cp.pyx":702
 *         considered.
 *         """
 *         king_mask = self.occupied_co[color] & self.kings & ~self.promoted             # <<<<<<<<<<<<<<
 *         if king_mask:
 *             return msb(king_mask)
 */
  __pyx_t_1 = __Pyx_PyIndex_AsSsize_t(__pyx_v_color); if (unlikely((__pyx_t_1 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 702, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((((__pyx_v_self->occupied_co[__pyx_t_1]) & __pyx_v_self->kings) & (~__pyx_v_self->promoted))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 702, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_king_mask = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":703
 *         """
 *         king_mask = self.occupied_co[color] & self.kings & ~self.promoted
 *         if king_mask:             # <<<<<<<<<<<<<<
 *             return msb(king_mask)
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_king_mask); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 703, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":704
 *         king_mask = self.occupied_co[color] & self.kings & ~self.promoted
 *         if king_mask:
 *             return msb(king_mask)             # <<<<<<<<<<<<<<
 * 
 *     def attacks_mask(self, square):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_msb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 704, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_king_mask) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_king_mask);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 704, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":703
 *         """
 *         king_mask = self.occupied_co[color] & self.kings & ~self.promoted
 *         if king_mask:             # <<<<<<<<<<<<<<
 *             return msb(king_mask)
 * 
 */
  }

  /* "chess/__init__cp.pyx":694
 *             return KING
 * 
 *     def king(self, color):             # <<<<<<<<<<<<<<
 *         """
 *         Finds the king square of the given side. Returns ``None`` if there
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.king", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_king_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":706
 *             return msb(king_mask)
 * 
 *     def attacks_mask(self, square):             # <<<<<<<<<<<<<<
 *         bb_square = BB_SQUARES[square]
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_21attacks_mask(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_21attacks_mask(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("attacks_mask (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_20attacks_mask(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_20attacks_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_bb_square = NULL;
  PyObject *__pyx_v_attacks = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("attacks_mask", 0);

  /* "chess/__init__cp.pyx":707
 * 
 *     def attacks_mask(self, square):
 *         bb_square = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *         if bb_square & self.pawns:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 707, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 707, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_bb_square = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":709
 *         bb_square = BB_SQUARES[square]
 * 
 *         if bb_square & self.pawns:             # <<<<<<<<<<<<<<
 *             if bb_square & self.occupied_co[WHITE]:
 *                 return BB_PAWN_ATTACKS[WHITE][square]
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 709, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_v_bb_square, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 709, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 709, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":710
 * 
 *         if bb_square & self.pawns:
 *             if bb_square & self.occupied_co[WHITE]:             # <<<<<<<<<<<<<<
 *                 return BB_PAWN_ATTACKS[WHITE][square]
 *             else:
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 710, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_v_bb_square, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 710, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 710, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":711
 *         if bb_square & self.pawns:
 *             if bb_square & self.occupied_co[WHITE]:
 *                 return BB_PAWN_ATTACKS[WHITE][square]             # <<<<<<<<<<<<<<
 *             else:
 *                 return BB_PAWN_ATTACKS[BLACK][square]
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_PAWN_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 711, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":710
 * 
 *         if bb_square & self.pawns:
 *             if bb_square & self.occupied_co[WHITE]:             # <<<<<<<<<<<<<<
 *                 return BB_PAWN_ATTACKS[WHITE][square]
 *             else:
 */
    }

    /* "chess/__init__cp.pyx":713
 *                 return BB_PAWN_ATTACKS[WHITE][square]
 *             else:
 *                 return BB_PAWN_ATTACKS[BLACK][square]             # <<<<<<<<<<<<<<
 *         elif bb_square & self.knights:
 *             return BB_KNIGHT_ATTACKS[square]
 */
    /*else*/ {
      __Pyx_XDECREF(__pyx_r);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_PAWN_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 713, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 713, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 713, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;
    }

    /* "chess/__init__cp.pyx":709
 *         bb_square = BB_SQUARES[square]
 * 
 *         if bb_square & self.pawns:             # <<<<<<<<<<<<<<
 *             if bb_square & self.occupied_co[WHITE]:
 *                 return BB_PAWN_ATTACKS[WHITE][square]
 */
  }

  /* "chess/__init__cp.pyx":714
 *             else:
 *                 return BB_PAWN_ATTACKS[BLACK][square]
 *         elif bb_square & self.knights:             # <<<<<<<<<<<<<<
 *             return BB_KNIGHT_ATTACKS[square]
 *         elif bb_square & self.kings:
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 714, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_v_bb_square, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 714, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 714, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":715
 *                 return BB_PAWN_ATTACKS[BLACK][square]
 *         elif bb_square & self.knights:
 *             return BB_KNIGHT_ATTACKS[square]             # <<<<<<<<<<<<<<
 *         elif bb_square & self.kings:
 *             return BB_KING_ATTACKS[square]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_KNIGHT_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 715, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 715, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":714
 *             else:
 *                 return BB_PAWN_ATTACKS[BLACK][square]
 *         elif bb_square & self.knights:             # <<<<<<<<<<<<<<
 *             return BB_KNIGHT_ATTACKS[square]
 *         elif bb_square & self.kings:
 */
  }

  /* "chess/__init__cp.pyx":716
 *         elif bb_square & self.knights:
 *             return BB_KNIGHT_ATTACKS[square]
 *         elif bb_square & self.kings:             # <<<<<<<<<<<<<<
 *             return BB_KING_ATTACKS[square]
 *         else:
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 716, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_v_bb_square, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 716, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 716, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":717
 *             return BB_KNIGHT_ATTACKS[square]
 *         elif bb_square & self.kings:
 *             return BB_KING_ATTACKS[square]             # <<<<<<<<<<<<<<
 *         else:
 *             attacks = 0
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_KING_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 717, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 717, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":716
 *         elif bb_square & self.knights:
 *             return BB_KNIGHT_ATTACKS[square]
 *         elif bb_square & self.kings:             # <<<<<<<<<<<<<<
 *             return BB_KING_ATTACKS[square]
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":719
 *             return BB_KING_ATTACKS[square]
 *         else:
 *             attacks = 0             # <<<<<<<<<<<<<<
 *             if bb_square & self.bishops or bb_square & self.queens:
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 */
  /*else*/ {
    __Pyx_INCREF(__pyx_int_0);
    __pyx_v_attacks = __pyx_int_0;

    /* "chess/__init__cp.pyx":720
 *         else:
 *             attacks = 0
 *             if bb_square & self.bishops or bb_square & self.queens:             # <<<<<<<<<<<<<<
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 *             if bb_square & self.rooks or bb_square & self.queens:
 */
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 720, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyNumber_And(__pyx_v_bb_square, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 720, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 720, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 720, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_v_bb_square, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 720, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 720, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_t_4;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":721
 *             attacks = 0
 *             if bb_square & self.bishops or bb_square & self.queens:
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]             # <<<<<<<<<<<<<<
 *             if bb_square & self.rooks or bb_square & self.queens:
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |
 */
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_DIAG_MASKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF_SET(__pyx_v_attacks, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":720
 *         else:
 *             attacks = 0
 *             if bb_square & self.bishops or bb_square & self.queens:             # <<<<<<<<<<<<<<
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 *             if bb_square & self.rooks or bb_square & self.queens:
 */
    }

    /* "chess/__init__cp.pyx":722
 *             if bb_square & self.bishops or bb_square & self.queens:
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 *             if bb_square & self.rooks or bb_square & self.queens:             # <<<<<<<<<<<<<<
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |
 *                             BB_FILE_ATTACKS[square][BB_FILE_MASKS[square] & self.occupied])
 */
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 722, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = PyNumber_And(__pyx_v_bb_square, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 722, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 722, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 722, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = PyNumber_And(__pyx_v_bb_square, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 722, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 722, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_t_4;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":723
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 *             if bb_square & self.rooks or bb_square & self.queens:
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |             # <<<<<<<<<<<<<<
 *                             BB_FILE_ATTACKS[square][BB_FILE_MASKS[square] & self.occupied])
 *             return attacks
 */
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_MASKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = PyNumber_And(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":724
 *             if bb_square & self.rooks or bb_square & self.queens:
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |
 *                             BB_FILE_ATTACKS[square][BB_FILE_MASKS[square] & self.occupied])             # <<<<<<<<<<<<<<
 *             return attacks
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_FILE_MASKS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = PyNumber_And(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "chess/__init__cp.pyx":723
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 *             if bb_square & self.rooks or bb_square & self.queens:
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |             # <<<<<<<<<<<<<<
 *                             BB_FILE_ATTACKS[square][BB_FILE_MASKS[square] & self.occupied])
 *             return attacks
 */
      __pyx_t_7 = PyNumber_Or(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyNumber_InPlaceOr(__pyx_v_attacks, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 723, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF_SET(__pyx_v_attacks, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":722
 *             if bb_square & self.bishops or bb_square & self.queens:
 *                 attacks = BB_DIAG_ATTACKS[square][BB_DIAG_MASKS[square] & self.occupied]
 *             if bb_square & self.rooks or bb_square & self.queens:             # <<<<<<<<<<<<<<
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |
 *                             BB_FILE_ATTACKS[square][BB_FILE_MASKS[square] & self.occupied])
 */
    }

    /* "chess/__init__cp.pyx":725
 *                 attacks |= (BB_RANK_ATTACKS[square][BB_RANK_MASKS[square] & self.occupied] |
 *                             BB_FILE_ATTACKS[square][BB_FILE_MASKS[square] & self.occupied])
 *             return attacks             # <<<<<<<<<<<<<<
 * 
 *     def attacks(self, square):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_attacks);
    __pyx_r = __pyx_v_attacks;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":706
 *             return msb(king_mask)
 * 
 *     def attacks_mask(self, square):             # <<<<<<<<<<<<<<
 *         bb_square = BB_SQUARES[square]
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.attacks_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_bb_square);
  __Pyx_XDECREF(__pyx_v_attacks);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":727
 *             return attacks
 * 
 *     def attacks(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a set of attacked squares from a given square.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_23attacks(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_22attacks[] = "\n        Gets a set of attacked squares from a given square.\n\n        There will be no attacks if the square is empty. Pinned pieces are\n        still attacking other squares.\n\n        Returns a :class:`set of squares <chess.SquareSet>`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_23attacks(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("attacks (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_22attacks(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_22attacks(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("attacks", 0);

  /* "chess/__init__cp.pyx":736
 *         Returns a :class:`set of squares <chess.SquareSet>`.
 *         """
 *         return SquareSet(self.attacks_mask(square))             # <<<<<<<<<<<<<<
 * 
 *     def _attackers_mask(self, color, square, occupied):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_attacks_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":727
 *             return attacks
 * 
 *     def attacks(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a set of attacked squares from a given square.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.attacks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":738
 *         return SquareSet(self.attacks_mask(square))
 * 
 *     def _attackers_mask(self, color, square, occupied):             # <<<<<<<<<<<<<<
 *         rank_pieces = BB_RANK_MASKS[square] & occupied
 *         file_pieces = BB_FILE_MASKS[square] & occupied
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_25_attackers_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_25_attackers_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_v_occupied = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_attackers_mask (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,&__pyx_n_s_occupied,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_attackers_mask", 1, 3, 3, 1); __PYX_ERR(0, 738, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_occupied)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_attackers_mask", 1, 3, 3, 2); __PYX_ERR(0, 738, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_attackers_mask") < 0)) __PYX_ERR(0, 738, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
    __pyx_v_occupied = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_attackers_mask", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 738, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._attackers_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_24_attackers_mask(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square, __pyx_v_occupied);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_24_attackers_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square, PyObject *__pyx_v_occupied) {
  PyObject *__pyx_v_rank_pieces = NULL;
  PyObject *__pyx_v_file_pieces = NULL;
  PyObject *__pyx_v_diag_pieces = NULL;
  unsigned PY_LONG_LONG __pyx_v_queens_and_rooks;
  unsigned PY_LONG_LONG __pyx_v_queens_and_bishops;
  PyObject *__pyx_v_attackers = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  __Pyx_RefNannySetupContext("_attackers_mask", 0);

  /* "chess/__init__cp.pyx":739
 * 
 *     def _attackers_mask(self, color, square, occupied):
 *         rank_pieces = BB_RANK_MASKS[square] & occupied             # <<<<<<<<<<<<<<
 *         file_pieces = BB_FILE_MASKS[square] & occupied
 *         diag_pieces = BB_DIAG_MASKS[square] & occupied
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_MASKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_rank_pieces = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":740
 *     def _attackers_mask(self, color, square, occupied):
 *         rank_pieces = BB_RANK_MASKS[square] & occupied
 *         file_pieces = BB_FILE_MASKS[square] & occupied             # <<<<<<<<<<<<<<
 *         diag_pieces = BB_DIAG_MASKS[square] & occupied
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILE_MASKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_file_pieces = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":741
 *         rank_pieces = BB_RANK_MASKS[square] & occupied
 *         file_pieces = BB_FILE_MASKS[square] & occupied
 *         diag_pieces = BB_DIAG_MASKS[square] & occupied             # <<<<<<<<<<<<<<
 * 
 *         queens_and_rooks = self.queens | self.rooks
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_DIAG_MASKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_diag_pieces = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":743
 *         diag_pieces = BB_DIAG_MASKS[square] & occupied
 * 
 *         queens_and_rooks = self.queens | self.rooks             # <<<<<<<<<<<<<<
 *         queens_and_bishops = self.queens | self.bishops
 * 
 */
  __pyx_v_queens_and_rooks = (__pyx_v_self->queens | __pyx_v_self->rooks);

  /* "chess/__init__cp.pyx":744
 * 
 *         queens_and_rooks = self.queens | self.rooks
 *         queens_and_bishops = self.queens | self.bishops             # <<<<<<<<<<<<<<
 * 
 *         attackers = (
 */
  __pyx_v_queens_and_bishops = (__pyx_v_self->queens | __pyx_v_self->bishops);

  /* "chess/__init__cp.pyx":747
 * 
 *         attackers = (
 *             (BB_KING_ATTACKS[square] & self.kings) |             # <<<<<<<<<<<<<<
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_KING_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 747, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":748
 *         attackers = (
 *             (BB_KING_ATTACKS[square] & self.kings) |
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |             # <<<<<<<<<<<<<<
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_KNIGHT_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":747
 * 
 *         attackers = (
 *             (BB_KING_ATTACKS[square] & self.kings) |             # <<<<<<<<<<<<<<
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 */
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":749
 *             (BB_KING_ATTACKS[square] & self.kings) |
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |             # <<<<<<<<<<<<<<
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_rank_pieces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_queens_and_rooks); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":748
 *         attackers = (
 *             (BB_KING_ATTACKS[square] & self.kings) |
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |             # <<<<<<<<<<<<<<
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 */
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":750
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |             # <<<<<<<<<<<<<<
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |
 *             (BB_PAWN_ATTACKS[not color][square] & self.pawns))
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_file_pieces); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_queens_and_rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":749
 *             (BB_KING_ATTACKS[square] & self.kings) |
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |             # <<<<<<<<<<<<<<
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |
 */
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":751
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |             # <<<<<<<<<<<<<<
 *             (BB_PAWN_ATTACKS[not color][square] & self.pawns))
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_diag_pieces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_queens_and_bishops); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":750
 *             (BB_KNIGHT_ATTACKS[square] & self.knights) |
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |             # <<<<<<<<<<<<<<
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |
 *             (BB_PAWN_ATTACKS[not color][square] & self.pawns))
 */
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":752
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |
 *             (BB_PAWN_ATTACKS[not color][square] & self.pawns))             # <<<<<<<<<<<<<<
 * 
 *         return attackers & self.occupied_co[color]
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_PAWN_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_color); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 752, __pyx_L1_error)
  __pyx_t_6 = (!__pyx_t_5);
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, __pyx_t_6, int, 1, __Pyx_PyBool_FromLong, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":751
 *             (BB_RANK_ATTACKS[square][rank_pieces] & queens_and_rooks) |
 *             (BB_FILE_ATTACKS[square][file_pieces] & queens_and_rooks) |
 *             (BB_DIAG_ATTACKS[square][diag_pieces] & queens_and_bishops) |             # <<<<<<<<<<<<<<
 *             (BB_PAWN_ATTACKS[not color][square] & self.pawns))
 * 
 */
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_attackers = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":754
 *             (BB_PAWN_ATTACKS[not color][square] & self.pawns))
 * 
 *         return attackers & self.occupied_co[color]             # <<<<<<<<<<<<<<
 * 
 *     def attackers_mask(self, color, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_7 = __Pyx_PyIndex_AsSsize_t(__pyx_v_color); if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 754, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[__pyx_t_7])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 754, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_v_attackers, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 754, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":738
 *         return SquareSet(self.attacks_mask(square))
 * 
 *     def _attackers_mask(self, color, square, occupied):             # <<<<<<<<<<<<<<
 *         rank_pieces = BB_RANK_MASKS[square] & occupied
 *         file_pieces = BB_FILE_MASKS[square] & occupied
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._attackers_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_rank_pieces);
  __Pyx_XDECREF(__pyx_v_file_pieces);
  __Pyx_XDECREF(__pyx_v_diag_pieces);
  __Pyx_XDECREF(__pyx_v_attackers);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":756
 *         return attackers & self.occupied_co[color]
 * 
 *     def attackers_mask(self, color, square):             # <<<<<<<<<<<<<<
 *         return self._attackers_mask(color, square, self.occupied)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_27attackers_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_27attackers_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("attackers_mask (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("attackers_mask", 1, 2, 2, 1); __PYX_ERR(0, 756, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "attackers_mask") < 0)) __PYX_ERR(0, 756, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("attackers_mask", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 756, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.attackers_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_26attackers_mask(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_26attackers_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("attackers_mask", 0);

  /* "chess/__init__cp.pyx":757
 * 
 *     def attackers_mask(self, color, square):
 *         return self._attackers_mask(color, square, self.occupied)             # <<<<<<<<<<<<<<
 * 
 *     def is_attacked_by(self, color, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_attackers_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_color, __pyx_v_square, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_color, __pyx_v_square, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 757, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_INCREF(__pyx_v_color);
    __Pyx_GIVEREF(__pyx_v_color);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_color);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_square);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_5, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":756
 *         return attackers & self.occupied_co[color]
 * 
 *     def attackers_mask(self, color, square):             # <<<<<<<<<<<<<<
 *         return self._attackers_mask(color, square, self.occupied)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.attackers_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":759
 *         return self._attackers_mask(color, square, self.occupied)
 * 
 *     def is_attacked_by(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given side attacks the given square.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_29is_attacked_by(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_28is_attacked_by[] = "\n        Checks if the given side attacks the given square.\n\n        Pinned pieces still count as attackers. Pawns that can be captured\n        en passant are **not** considered attacked.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_29is_attacked_by(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_attacked_by (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("is_attacked_by", 1, 2, 2, 1); __PYX_ERR(0, 759, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "is_attacked_by") < 0)) __PYX_ERR(0, 759, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("is_attacked_by", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 759, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.is_attacked_by", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_28is_attacked_by(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_28is_attacked_by(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("is_attacked_by", 0);

  /* "chess/__init__cp.pyx":766
 *         en passant are **not** considered attacked.
 *         """
 *         return bool(self.attackers_mask(color, square))             # <<<<<<<<<<<<<<
 * 
 *     def attackers(self, color, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_attackers_mask_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 766, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_color, __pyx_v_square};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_color, __pyx_v_square};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_INCREF(__pyx_v_color);
    __Pyx_GIVEREF(__pyx_v_color);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_color);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_square);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 766, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyBool_FromLong((!(!__pyx_t_6))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 766, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":759
 *         return self._attackers_mask(color, square, self.occupied)
 * 
 *     def is_attacked_by(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given side attacks the given square.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.is_attacked_by", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":768
 *         return bool(self.attackers_mask(color, square))
 * 
 *     def attackers(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a set of attackers of the given color for the given square.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_31attackers(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_30attackers[] = "\n        Gets a set of attackers of the given color for the given square.\n\n        Pinned pieces still count as attackers.\n\n        Returns a :class:`set of squares <chess.SquareSet>`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_31attackers(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("attackers (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("attackers", 1, 2, 2, 1); __PYX_ERR(0, 768, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "attackers") < 0)) __PYX_ERR(0, 768, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("attackers", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 768, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.attackers", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_30attackers(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_30attackers(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("attackers", 0);

  /* "chess/__init__cp.pyx":776
 *         Returns a :class:`set of squares <chess.SquareSet>`.
 *         """
 *         return SquareSet(self.attackers_mask(color, square))             # <<<<<<<<<<<<<<
 * 
 *     def pin_mask(self, color, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_attackers_mask_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 776, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_color, __pyx_v_square};
    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_color, __pyx_v_square};
    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 776, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(__pyx_v_color);
    __Pyx_GIVEREF(__pyx_v_color);
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_color);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_v_square);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":768
 *         return bool(self.attackers_mask(color, square))
 * 
 *     def attackers(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a set of attackers of the given color for the given square.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.attackers", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":778
 *         return SquareSet(self.attackers_mask(color, square))
 * 
 *     def pin_mask(self, color, square):             # <<<<<<<<<<<<<<
 *         king = self.king(color)
 *         if king is None:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_33pin_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_33pin_mask(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pin_mask (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("pin_mask", 1, 2, 2, 1); __PYX_ERR(0, 778, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "pin_mask") < 0)) __PYX_ERR(0, 778, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("pin_mask", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 778, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pin_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_32pin_mask(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_32pin_mask(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_king = NULL;
  PyObject *__pyx_v_square_mask = NULL;
  PyObject *__pyx_v_attacks = NULL;
  PyObject *__pyx_v_sliders = NULL;
  PyObject *__pyx_v_rays = NULL;
  PyObject *__pyx_v_snipers = NULL;
  PyObject *__pyx_v_sniper = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  __Pyx_RefNannySetupContext("pin_mask", 0);

  /* "chess/__init__cp.pyx":779
 * 
 *     def pin_mask(self, color, square):
 *         king = self.king(color)             # <<<<<<<<<<<<<<
 *         if king is None:
 *             return BB_ALL
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_color) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_color);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 779, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_king = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":780
 *     def pin_mask(self, color, square):
 *         king = self.king(color)
 *         if king is None:             # <<<<<<<<<<<<<<
 *             return BB_ALL
 * 
 */
  __pyx_t_4 = (__pyx_v_king == Py_None);
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":781
 *         king = self.king(color)
 *         if king is None:
 *             return BB_ALL             # <<<<<<<<<<<<<<
 * 
 *         square_mask = BB_SQUARES[square]
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 781, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":780
 *     def pin_mask(self, color, square):
 *         king = self.king(color)
 *         if king is None:             # <<<<<<<<<<<<<<
 *             return BB_ALL
 * 
 */
  }

  /* "chess/__init__cp.pyx":783
 *             return BB_ALL
 * 
 *         square_mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *         for attacks, sliders in [(BB_FILE_ATTACKS, self.rooks | self.queens),
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 783, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_square_mask = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":785
 *         square_mask = BB_SQUARES[square]
 * 
 *         for attacks, sliders in [(BB_FILE_ATTACKS, self.rooks | self.queens),             # <<<<<<<<<<<<<<
 *                                  (BB_RANK_ATTACKS, self.rooks | self.queens),
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->rooks | __pyx_v_self->queens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":786
 * 
 *         for attacks, sliders in [(BB_FILE_ATTACKS, self.rooks | self.queens),
 *                                  (BB_RANK_ATTACKS, self.rooks | self.queens),             # <<<<<<<<<<<<<<
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 *             rays = attacks[king][0]
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->rooks | __pyx_v_self->queens)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":787
 *         for attacks, sliders in [(BB_FILE_ATTACKS, self.rooks | self.queens),
 *                                  (BB_RANK_ATTACKS, self.rooks | self.queens),
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:             # <<<<<<<<<<<<<<
 *             rays = attacks[king][0]
 *             if rays & square_mask:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 787, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->bishops | __pyx_v_self->queens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 787, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 787, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":785
 *         square_mask = BB_SQUARES[square]
 * 
 *         for attacks, sliders in [(BB_FILE_ATTACKS, self.rooks | self.queens),             # <<<<<<<<<<<<<<
 *                                  (BB_RANK_ATTACKS, self.rooks | self.queens),
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 */
  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_7);
  __pyx_t_3 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = __pyx_t_1; __Pyx_INCREF(__pyx_t_7); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (__pyx_t_8 >= 3) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 785, __pyx_L1_error)
    #else
    __pyx_t_1 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    if (likely(__pyx_t_1 != Py_None)) {
      PyObject* sequence = __pyx_t_1;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 785, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_3);
      #else
      __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else {
      __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(0, 785, __pyx_L1_error)
    }
    __Pyx_XDECREF_SET(__pyx_v_attacks, __pyx_t_6);
    __pyx_t_6 = 0;
    __Pyx_XDECREF_SET(__pyx_v_sliders, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":788
 *                                  (BB_RANK_ATTACKS, self.rooks | self.queens),
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 *             rays = attacks[king][0]             # <<<<<<<<<<<<<<
 *             if rays & square_mask:
 *                 snipers = rays & sliders & self.occupied_co[not color]
 */
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_attacks, __pyx_v_king); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 788, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_rays, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":789
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 *             rays = attacks[king][0]
 *             if rays & square_mask:             # <<<<<<<<<<<<<<
 *                 snipers = rays & sliders & self.occupied_co[not color]
 *                 for sniper in scan_reversed(snipers):
 */
    __pyx_t_3 = PyNumber_And(__pyx_v_rays, __pyx_v_square_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 789, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 789, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":790
 *             rays = attacks[king][0]
 *             if rays & square_mask:
 *                 snipers = rays & sliders & self.occupied_co[not color]             # <<<<<<<<<<<<<<
 *                 for sniper in scan_reversed(snipers):
 *                     if BB_BETWEEN[sniper][king] & (self.occupied | square_mask) == square_mask:
 */
      __pyx_t_3 = PyNumber_And(__pyx_v_rays, __pyx_v_sliders); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 790, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_color); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 790, __pyx_L1_error)
      __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[(!__pyx_t_5)])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 790, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyNumber_And(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 790, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_snipers = __pyx_t_6;
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":791
 *             if rays & square_mask:
 *                 snipers = rays & sliders & self.occupied_co[not color]
 *                 for sniper in scan_reversed(snipers):             # <<<<<<<<<<<<<<
 *                     if BB_BETWEEN[sniper][king] & (self.occupied | square_mask) == square_mask:
 *                         return BB_RAYS[king][sniper]
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 791, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_v_snipers) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_snipers);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 791, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
        __pyx_t_1 = __pyx_t_6; __Pyx_INCREF(__pyx_t_1); __pyx_t_9 = 0;
        __pyx_t_10 = NULL;
      } else {
        __pyx_t_9 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 791, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 791, __pyx_L1_error)
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      for (;;) {
        if (likely(!__pyx_t_10)) {
          if (likely(PyList_CheckExact(__pyx_t_1))) {
            if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 791, __pyx_L1_error)
            #else
            __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 791, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            #endif
          } else {
            if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 791, __pyx_L1_error)
            #else
            __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 791, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            #endif
          }
        } else {
          __pyx_t_6 = __pyx_t_10(__pyx_t_1);
          if (unlikely(!__pyx_t_6)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 791, __pyx_L1_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_6);
        }
        __Pyx_XDECREF_SET(__pyx_v_sniper, __pyx_t_6);
        __pyx_t_6 = 0;

        /* "chess/__init__cp.pyx":792
 *                 snipers = rays & sliders & self.occupied_co[not color]
 *                 for sniper in scan_reversed(snipers):
 *                     if BB_BETWEEN[sniper][king] & (self.occupied | square_mask) == square_mask:             # <<<<<<<<<<<<<<
 *                         return BB_RAYS[king][sniper]
 * 
 */
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_sniper); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_king); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_2 = PyNumber_Or(__pyx_t_3, __pyx_v_square_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = PyNumber_And(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_v_square_mask, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 792, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (__pyx_t_5) {

          /* "chess/__init__cp.pyx":793
 *                 for sniper in scan_reversed(snipers):
 *                     if BB_BETWEEN[sniper][king] & (self.occupied | square_mask) == square_mask:
 *                         return BB_RAYS[king][sniper]             # <<<<<<<<<<<<<<
 * 
 *                 break
 */
          __Pyx_XDECREF(__pyx_r);
          __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RAYS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 793, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_king); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 793, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_sniper); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 793, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_r = __pyx_t_2;
          __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          goto __pyx_L0;

          /* "chess/__init__cp.pyx":792
 *                 snipers = rays & sliders & self.occupied_co[not color]
 *                 for sniper in scan_reversed(snipers):
 *                     if BB_BETWEEN[sniper][king] & (self.occupied | square_mask) == square_mask:             # <<<<<<<<<<<<<<
 *                         return BB_RAYS[king][sniper]
 * 
 */
        }

        /* "chess/__init__cp.pyx":791
 *             if rays & square_mask:
 *                 snipers = rays & sliders & self.occupied_co[not color]
 *                 for sniper in scan_reversed(snipers):             # <<<<<<<<<<<<<<
 *                     if BB_BETWEEN[sniper][king] & (self.occupied | square_mask) == square_mask:
 *                         return BB_RAYS[king][sniper]
 */
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":795
 *                         return BB_RAYS[king][sniper]
 * 
 *                 break             # <<<<<<<<<<<<<<
 * 
 *         return BB_ALL
 */
      goto __pyx_L5_break;

      /* "chess/__init__cp.pyx":789
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 *             rays = attacks[king][0]
 *             if rays & square_mask:             # <<<<<<<<<<<<<<
 *                 snipers = rays & sliders & self.occupied_co[not color]
 *                 for sniper in scan_reversed(snipers):
 */
    }

    /* "chess/__init__cp.pyx":785
 *         square_mask = BB_SQUARES[square]
 * 
 *         for attacks, sliders in [(BB_FILE_ATTACKS, self.rooks | self.queens),             # <<<<<<<<<<<<<<
 *                                  (BB_RANK_ATTACKS, self.rooks | self.queens),
 *                                  (BB_DIAG_ATTACKS, self.bishops | self.queens)]:
 */
  }
  __pyx_L5_break:;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":797
 *                 break
 * 
 *         return BB_ALL             # <<<<<<<<<<<<<<
 * 
 *     def pin(self, color, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_7 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":778
 *         return SquareSet(self.attackers_mask(color, square))
 * 
 *     def pin_mask(self, color, square):             # <<<<<<<<<<<<<<
 *         king = self.king(color)
 *         if king is None:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pin_mask", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_king);
  __Pyx_XDECREF(__pyx_v_square_mask);
  __Pyx_XDECREF(__pyx_v_attacks);
  __Pyx_XDECREF(__pyx_v_sliders);
  __Pyx_XDECREF(__pyx_v_rays);
  __Pyx_XDECREF(__pyx_v_snipers);
  __Pyx_XDECREF(__pyx_v_sniper);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":799
 *         return BB_ALL
 * 
 *     def pin(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Detects an absolute pin (and its direction) of the given square to
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_35pin(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_34pin[] = "\n        Detects an absolute pin (and its direction) of the given square to\n        the king of the given color.\n\n        >>> import chess\n        >>>\n        >>> board = chess.Board(\"rnb1k2r/ppp2ppp/5n2/3q4/1b1P4/2N5/PP3PPP/R1BQKBNR w KQkq - 3 7\")\n        >>> board.is_pinned(chess.WHITE, chess.C3)\n        True\n        >>> direction = board.pin(chess.WHITE, chess.C3)\n        >>> direction\n        SquareSet(0x0000000102040810)\n        >>> print(direction)\n        . . . . . . . .\n        . . . . . . . .\n        . . . . . . . .\n        1 . . . . . . .\n        . 1 . . . . . .\n        . . 1 . . . . .\n        . . . 1 . . . .\n        . . . . 1 . . .\n\n        Returns a :class:`set of squares <chess.SquareSet>` that mask the rank,\n        file or diagonal of the pin. If there is no pin, then a mask of the\n        entire board is returned.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_35pin(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pin (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("pin", 1, 2, 2, 1); __PYX_ERR(0, 799, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "pin") < 0)) __PYX_ERR(0, 799, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("pin", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 799, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pin", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_34pin(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_34pin(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("pin", 0);

  /* "chess/__init__cp.pyx":826
 *         entire board is returned.
 *         """
 *         return SquareSet(self.pin_mask(color, square))             # <<<<<<<<<<<<<<
 * 
 *     def is_pinned(self, color, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_pin_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_color, __pyx_v_square};
    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 826, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_color, __pyx_v_square};
    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 826, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 826, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(__pyx_v_color);
    __Pyx_GIVEREF(__pyx_v_color);
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_color);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_v_square);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 826, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":799
 *         return BB_ALL
 * 
 *     def pin(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Detects an absolute pin (and its direction) of the given square to
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.pin", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":828
 *         return SquareSet(self.pin_mask(color, square))
 * 
 *     def is_pinned(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Detects if the given square is pinned to the king of the given color.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_37is_pinned(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_36is_pinned[] = "\n        Detects if the given square is pinned to the king of the given color.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_37is_pinned(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_pinned (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_color,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("is_pinned", 1, 2, 2, 1); __PYX_ERR(0, 828, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "is_pinned") < 0)) __PYX_ERR(0, 828, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_color = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("is_pinned", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 828, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.is_pinned", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_36is_pinned(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_color, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_36is_pinned(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_color, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("is_pinned", 0);

  /* "chess/__init__cp.pyx":832
 *         Detects if the given square is pinned to the king of the given color.
 *         """
 *         return self.pin_mask(color, square) != BB_ALL             # <<<<<<<<<<<<<<
 * 
 *     def _remove_piece_at(self, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_pin_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 832, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_color, __pyx_v_square};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 832, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_color, __pyx_v_square};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 832, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 832, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_INCREF(__pyx_v_color);
    __Pyx_GIVEREF(__pyx_v_color);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_color);
    __Pyx_INCREF(__pyx_v_square);
    __Pyx_GIVEREF(__pyx_v_square);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_square);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 832, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 832, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 832, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":828
 *         return SquareSet(self.pin_mask(color, square))
 * 
 *     def is_pinned(self, color, square):             # <<<<<<<<<<<<<<
 *         """
 *         Detects if the given square is pinned to the king of the given color.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.is_pinned", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":834
 *         return self.pin_mask(color, square) != BB_ALL
 * 
 *     def _remove_piece_at(self, square):             # <<<<<<<<<<<<<<
 *         piece_type = self.piece_type_at(square)
 *         mask = BB_SQUARES[square]
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_39_remove_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_39_remove_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_remove_piece_at (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_38_remove_piece_at(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_38_remove_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_piece_type = NULL;
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  unsigned PY_LONG_LONG __pyx_t_5;
  __Pyx_RefNannySetupContext("_remove_piece_at", 0);

  /* "chess/__init__cp.pyx":835
 * 
 *     def _remove_piece_at(self, square):
 *         piece_type = self.piece_type_at(square)             # <<<<<<<<<<<<<<
 *         mask = BB_SQUARES[square]
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_type_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_piece_type = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":836
 *     def _remove_piece_at(self, square):
 *         piece_type = self.piece_type_at(square)
 *         mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *         if piece_type == PAWN:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 836, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mask = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":838
 *         mask = BB_SQUARES[square]
 * 
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             self.pawns ^= mask
 *         elif piece_type == KNIGHT:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 838, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 838, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 838, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":839
 * 
 *         if piece_type == PAWN:
 *             self.pawns ^= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == KNIGHT:
 *             self.knights ^= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 839, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 839, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->pawns = __pyx_t_5;

    /* "chess/__init__cp.pyx":838
 *         mask = BB_SQUARES[square]
 * 
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             self.pawns ^= mask
 *         elif piece_type == KNIGHT:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":840
 *         if piece_type == PAWN:
 *             self.pawns ^= mask
 *         elif piece_type == KNIGHT:             # <<<<<<<<<<<<<<
 *             self.knights ^= mask
 *         elif piece_type == BISHOP:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KNIGHT); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 840, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 840, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 840, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":841
 *             self.pawns ^= mask
 *         elif piece_type == KNIGHT:
 *             self.knights ^= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == BISHOP:
 *             self.bishops ^= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 841, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 841, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 841, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->knights = __pyx_t_5;

    /* "chess/__init__cp.pyx":840
 *         if piece_type == PAWN:
 *             self.pawns ^= mask
 *         elif piece_type == KNIGHT:             # <<<<<<<<<<<<<<
 *             self.knights ^= mask
 *         elif piece_type == BISHOP:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":842
 *         elif piece_type == KNIGHT:
 *             self.knights ^= mask
 *         elif piece_type == BISHOP:             # <<<<<<<<<<<<<<
 *             self.bishops ^= mask
 *         elif piece_type == ROOK:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BISHOP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 842, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 842, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 842, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":843
 *             self.knights ^= mask
 *         elif piece_type == BISHOP:
 *             self.bishops ^= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == ROOK:
 *             self.rooks ^= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 843, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 843, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 843, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->bishops = __pyx_t_5;

    /* "chess/__init__cp.pyx":842
 *         elif piece_type == KNIGHT:
 *             self.knights ^= mask
 *         elif piece_type == BISHOP:             # <<<<<<<<<<<<<<
 *             self.bishops ^= mask
 *         elif piece_type == ROOK:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":844
 *         elif piece_type == BISHOP:
 *             self.bishops ^= mask
 *         elif piece_type == ROOK:             # <<<<<<<<<<<<<<
 *             self.rooks ^= mask
 *         elif piece_type == QUEEN:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 844, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 844, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 844, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":845
 *             self.bishops ^= mask
 *         elif piece_type == ROOK:
 *             self.rooks ^= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == QUEEN:
 *             self.queens ^= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 845, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 845, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 845, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->rooks = __pyx_t_5;

    /* "chess/__init__cp.pyx":844
 *         elif piece_type == BISHOP:
 *             self.bishops ^= mask
 *         elif piece_type == ROOK:             # <<<<<<<<<<<<<<
 *             self.rooks ^= mask
 *         elif piece_type == QUEEN:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":846
 *         elif piece_type == ROOK:
 *             self.rooks ^= mask
 *         elif piece_type == QUEEN:             # <<<<<<<<<<<<<<
 *             self.queens ^= mask
 *         elif piece_type == KING:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_QUEEN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":847
 *             self.rooks ^= mask
 *         elif piece_type == QUEEN:
 *             self.queens ^= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == KING:
 *             self.kings ^= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->queens = __pyx_t_5;

    /* "chess/__init__cp.pyx":846
 *         elif piece_type == ROOK:
 *             self.rooks ^= mask
 *         elif piece_type == QUEEN:             # <<<<<<<<<<<<<<
 *             self.queens ^= mask
 *         elif piece_type == KING:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":848
 *         elif piece_type == QUEEN:
 *             self.queens ^= mask
 *         elif piece_type == KING:             # <<<<<<<<<<<<<<
 *             self.kings ^= mask
 *         else:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KING); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 848, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 848, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":849
 *             self.queens ^= mask
 *         elif piece_type == KING:
 *             self.kings ^= mask             # <<<<<<<<<<<<<<
 *         else:
 *             return
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 849, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 849, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->kings = __pyx_t_5;

    /* "chess/__init__cp.pyx":848
 *         elif piece_type == QUEEN:
 *             self.queens ^= mask
 *         elif piece_type == KING:             # <<<<<<<<<<<<<<
 *             self.kings ^= mask
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":851
 *             self.kings ^= mask
 *         else:
 *             return             # <<<<<<<<<<<<<<
 * 
 *         self.occupied ^= mask
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":853
 *             return
 * 
 *         self.occupied ^= mask             # <<<<<<<<<<<<<<
 *         self.occupied_co[WHITE] &= ~mask
 *         self.occupied_co[BLACK] &= ~mask
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_InPlaceXor(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 853, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->occupied = __pyx_t_4;

  /* "chess/__init__cp.pyx":854
 * 
 *         self.occupied ^= mask
 *         self.occupied_co[WHITE] &= ~mask             # <<<<<<<<<<<<<<
 *         self.occupied_co[BLACK] &= ~mask
 * 
 */
  __pyx_t_4 = 1;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[__pyx_t_4])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 854, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Invert(__pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 854, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 854, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_3); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 854, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  (__pyx_v_self->occupied_co[__pyx_t_4]) = __pyx_t_5;

  /* "chess/__init__cp.pyx":855
 *         self.occupied ^= mask
 *         self.occupied_co[WHITE] &= ~mask
 *         self.occupied_co[BLACK] &= ~mask             # <<<<<<<<<<<<<<
 * 
 *         self.promoted &= ~mask
 */
  __pyx_t_4 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[__pyx_t_4])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 855, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_Invert(__pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 855, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_InPlaceAnd(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 855, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 855, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  (__pyx_v_self->occupied_co[__pyx_t_4]) = __pyx_t_5;

  /* "chess/__init__cp.pyx":857
 *         self.occupied_co[BLACK] &= ~mask
 * 
 *         self.promoted &= ~mask             # <<<<<<<<<<<<<<
 * 
 *         return piece_type
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 857, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Invert(__pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 857, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 857, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 857, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->promoted = __pyx_t_4;

  /* "chess/__init__cp.pyx":859
 *         self.promoted &= ~mask
 * 
 *         return piece_type             # <<<<<<<<<<<<<<
 * 
 *     def remove_piece_at(self, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_piece_type);
  __pyx_r = __pyx_v_piece_type;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":834
 *         return self.pin_mask(color, square) != BB_ALL
 * 
 *     def _remove_piece_at(self, square):             # <<<<<<<<<<<<<<
 *         piece_type = self.piece_type_at(square)
 *         mask = BB_SQUARES[square]
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._remove_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_piece_type);
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":861
 *         return piece_type
 * 
 *     def remove_piece_at(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Removes the piece from the given square. Returns the
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_41remove_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_40remove_piece_at[] = "\n        Removes the piece from the given square. Returns the\n        :class:`~chess.Piece` or ``None`` if the square was already empty.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_41remove_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove_piece_at (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_40remove_piece_at(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_40remove_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_color = NULL;
  PyObject *__pyx_v_piece_type = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("remove_piece_at", 0);

  /* "chess/__init__cp.pyx":866
 *         :class:`~chess.Piece` or ``None`` if the square was already empty.
 *         """
 *         color = bool(self.occupied_co[WHITE] & BB_SQUARES[square])             # <<<<<<<<<<<<<<
 *         piece_type = self._remove_piece_at(square)
 *         if piece_type:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!(!__pyx_t_4))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_color = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":867
 *         """
 *         color = bool(self.occupied_co[WHITE] & BB_SQUARES[square])
 *         piece_type = self._remove_piece_at(square)             # <<<<<<<<<<<<<<
 *         if piece_type:
 *             return Piece(piece_type, color)
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 867, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 867, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_piece_type = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":868
 *         color = bool(self.occupied_co[WHITE] & BB_SQUARES[square])
 *         piece_type = self._remove_piece_at(square)
 *         if piece_type:             # <<<<<<<<<<<<<<
 *             return Piece(piece_type, color)
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_piece_type); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 868, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":869
 *         piece_type = self._remove_piece_at(square)
 *         if piece_type:
 *             return Piece(piece_type, color)             # <<<<<<<<<<<<<<
 * 
 *     def _set_piece_at(self, square, piece_type, color, promoted=False):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_Piece); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 869, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = NULL;
    __pyx_t_5 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_v_piece_type, __pyx_v_color};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_v_piece_type, __pyx_v_color};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    {
      __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 869, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_1) {
        __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
      }
      __Pyx_INCREF(__pyx_v_piece_type);
      __Pyx_GIVEREF(__pyx_v_piece_type);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_piece_type);
      __Pyx_INCREF(__pyx_v_color);
      __Pyx_GIVEREF(__pyx_v_color);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_color);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":868
 *         color = bool(self.occupied_co[WHITE] & BB_SQUARES[square])
 *         piece_type = self._remove_piece_at(square)
 *         if piece_type:             # <<<<<<<<<<<<<<
 *             return Piece(piece_type, color)
 * 
 */
  }

  /* "chess/__init__cp.pyx":861
 *         return piece_type
 * 
 *     def remove_piece_at(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Removes the piece from the given square. Returns the
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.remove_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_color);
  __Pyx_XDECREF(__pyx_v_piece_type);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":871
 *             return Piece(piece_type, color)
 * 
 *     def _set_piece_at(self, square, piece_type, color, promoted=False):             # <<<<<<<<<<<<<<
 *         self._remove_piece_at(square)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_43_set_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_43_set_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_v_piece_type = 0;
  PyObject *__pyx_v_color = 0;
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_set_piece_at (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_square,&__pyx_n_s_piece_type,&__pyx_n_s_color,&__pyx_n_s_promoted,0};
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece_type)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_set_piece_at", 0, 3, 4, 1); __PYX_ERR(0, 871, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_color)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_set_piece_at", 0, 3, 4, 2); __PYX_ERR(0, 871, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_promoted);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_set_piece_at") < 0)) __PYX_ERR(0, 871, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_square = values[0];
    __pyx_v_piece_type = values[1];
    __pyx_v_color = values[2];
    __pyx_v_promoted = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_set_piece_at", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 871, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._set_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_42_set_piece_at(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_square, __pyx_v_piece_type, __pyx_v_color, __pyx_v_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_42_set_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square, PyObject *__pyx_v_piece_type, PyObject *__pyx_v_color, PyObject *__pyx_v_promoted) {
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  unsigned PY_LONG_LONG __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  __Pyx_RefNannySetupContext("_set_piece_at", 0);

  /* "chess/__init__cp.pyx":872
 * 
 *     def _set_piece_at(self, square, piece_type, color, promoted=False):
 *         self._remove_piece_at(square)             # <<<<<<<<<<<<<<
 * 
 *         mask = BB_SQUARES[square]
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 872, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 872, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":874
 *         self._remove_piece_at(square)
 * 
 *         mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *         if piece_type == PAWN:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 874, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 874, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mask = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":876
 *         mask = BB_SQUARES[square]
 * 
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             self.pawns |= mask
 *         elif piece_type == KNIGHT:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 876, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 876, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 876, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":877
 * 
 *         if piece_type == PAWN:
 *             self.pawns |= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == KNIGHT:
 *             self.knights |= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 877, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->pawns = __pyx_t_5;

    /* "chess/__init__cp.pyx":876
 *         mask = BB_SQUARES[square]
 * 
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             self.pawns |= mask
 *         elif piece_type == KNIGHT:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":878
 *         if piece_type == PAWN:
 *             self.pawns |= mask
 *         elif piece_type == KNIGHT:             # <<<<<<<<<<<<<<
 *             self.knights |= mask
 *         elif piece_type == BISHOP:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KNIGHT); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 878, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 878, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 878, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":879
 *             self.pawns |= mask
 *         elif piece_type == KNIGHT:
 *             self.knights |= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == BISHOP:
 *             self.bishops |= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 879, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->knights = __pyx_t_5;

    /* "chess/__init__cp.pyx":878
 *         if piece_type == PAWN:
 *             self.pawns |= mask
 *         elif piece_type == KNIGHT:             # <<<<<<<<<<<<<<
 *             self.knights |= mask
 *         elif piece_type == BISHOP:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":880
 *         elif piece_type == KNIGHT:
 *             self.knights |= mask
 *         elif piece_type == BISHOP:             # <<<<<<<<<<<<<<
 *             self.bishops |= mask
 *         elif piece_type == ROOK:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BISHOP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 880, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 880, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":881
 *             self.knights |= mask
 *         elif piece_type == BISHOP:
 *             self.bishops |= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == ROOK:
 *             self.rooks |= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 881, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 881, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 881, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->bishops = __pyx_t_5;

    /* "chess/__init__cp.pyx":880
 *         elif piece_type == KNIGHT:
 *             self.knights |= mask
 *         elif piece_type == BISHOP:             # <<<<<<<<<<<<<<
 *             self.bishops |= mask
 *         elif piece_type == ROOK:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":882
 *         elif piece_type == BISHOP:
 *             self.bishops |= mask
 *         elif piece_type == ROOK:             # <<<<<<<<<<<<<<
 *             self.rooks |= mask
 *         elif piece_type == QUEEN:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 882, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 882, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 882, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":883
 *             self.bishops |= mask
 *         elif piece_type == ROOK:
 *             self.rooks |= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == QUEEN:
 *             self.queens |= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 883, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 883, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 883, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->rooks = __pyx_t_5;

    /* "chess/__init__cp.pyx":882
 *         elif piece_type == BISHOP:
 *             self.bishops |= mask
 *         elif piece_type == ROOK:             # <<<<<<<<<<<<<<
 *             self.rooks |= mask
 *         elif piece_type == QUEEN:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":884
 *         elif piece_type == ROOK:
 *             self.rooks |= mask
 *         elif piece_type == QUEEN:             # <<<<<<<<<<<<<<
 *             self.queens |= mask
 *         elif piece_type == KING:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_QUEEN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 884, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 884, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 884, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":885
 *             self.rooks |= mask
 *         elif piece_type == QUEEN:
 *             self.queens |= mask             # <<<<<<<<<<<<<<
 *         elif piece_type == KING:
 *             self.kings |= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 885, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 885, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 885, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->queens = __pyx_t_5;

    /* "chess/__init__cp.pyx":884
 *         elif piece_type == ROOK:
 *             self.rooks |= mask
 *         elif piece_type == QUEEN:             # <<<<<<<<<<<<<<
 *             self.queens |= mask
 *         elif piece_type == KING:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":886
 *         elif piece_type == QUEEN:
 *             self.queens |= mask
 *         elif piece_type == KING:             # <<<<<<<<<<<<<<
 *             self.kings |= mask
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KING); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 886, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 886, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 886, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":887
 *             self.queens |= mask
 *         elif piece_type == KING:
 *             self.kings |= mask             # <<<<<<<<<<<<<<
 * 
 *         self.occupied ^= mask
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 887, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_self->kings = __pyx_t_5;

    /* "chess/__init__cp.pyx":886
 *         elif piece_type == QUEEN:
 *             self.queens |= mask
 *         elif piece_type == KING:             # <<<<<<<<<<<<<<
 *             self.kings |= mask
 * 
 */
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":889
 *             self.kings |= mask
 * 
 *         self.occupied ^= mask             # <<<<<<<<<<<<<<
 *         self.occupied_co[color] ^= mask
 * 
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_InPlaceXor(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 889, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->occupied = __pyx_t_4;

  /* "chess/__init__cp.pyx":890
 * 
 *         self.occupied ^= mask
 *         self.occupied_co[color] ^= mask             # <<<<<<<<<<<<<<
 * 
 *         if promoted:
 */
  __pyx_t_6 = __Pyx_PyIndex_AsSsize_t(__pyx_v_color); if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 890, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[__pyx_t_6])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 890, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 890, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 890, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  (__pyx_v_self->occupied_co[__pyx_t_6]) = __pyx_t_5;

  /* "chess/__init__cp.pyx":892
 *         self.occupied_co[color] ^= mask
 * 
 *         if promoted:             # <<<<<<<<<<<<<<
 *             self.promoted ^= mask
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_promoted); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 892, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":893
 * 
 *         if promoted:
 *             self.promoted ^= mask             # <<<<<<<<<<<<<<
 * 
 *     def set_piece_at(self, square, piece, promoted=False):
 */
    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 893, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyNumber_InPlaceXor(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 893, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 893, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_self->promoted = __pyx_t_4;

    /* "chess/__init__cp.pyx":892
 *         self.occupied_co[color] ^= mask
 * 
 *         if promoted:             # <<<<<<<<<<<<<<
 *             self.promoted ^= mask
 * 
 */
  }

  /* "chess/__init__cp.pyx":871
 *             return Piece(piece_type, color)
 * 
 *     def _set_piece_at(self, square, piece_type, color, promoted=False):             # <<<<<<<<<<<<<<
 *         self._remove_piece_at(square)
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._set_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":895
 *             self.promoted ^= mask
 * 
 *     def set_piece_at(self, square, piece, promoted=False):             # <<<<<<<<<<<<<<
 *         """
 *         Sets a piece at the given square.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_45set_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_44set_piece_at[] = "\n        Sets a piece at the given square.\n\n        An existing piece is replaced. Setting *piece* to ``None`` is\n        equivalent to :func:`~chess.Board.remove_piece_at()`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_45set_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_v_piece = 0;
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_piece_at (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_square,&__pyx_n_s_piece,&__pyx_n_s_promoted,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("set_piece_at", 0, 2, 3, 1); __PYX_ERR(0, 895, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_promoted);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_piece_at") < 0)) __PYX_ERR(0, 895, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_square = values[0];
    __pyx_v_piece = values[1];
    __pyx_v_promoted = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("set_piece_at", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 895, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.set_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_44set_piece_at(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_square, __pyx_v_piece, __pyx_v_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_44set_piece_at(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_square, PyObject *__pyx_v_piece, PyObject *__pyx_v_promoted) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("set_piece_at", 0);

  /* "chess/__init__cp.pyx":902
 *         equivalent to :func:`~chess.Board.remove_piece_at()`.
 *         """
 *         if piece is None:             # <<<<<<<<<<<<<<
 *             self._remove_piece_at(square)
 *         else:
 */
  __pyx_t_1 = (__pyx_v_piece == Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":903
 *         """
 *         if piece is None:
 *             self._remove_piece_at(square)             # <<<<<<<<<<<<<<
 *         else:
 *             self._set_piece_at(square, piece.piece_type, piece.color, promoted)
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 903, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 903, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":902
 *         equivalent to :func:`~chess.Board.remove_piece_at()`.
 *         """
 *         if piece is None:             # <<<<<<<<<<<<<<
 *             self._remove_piece_at(square)
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":905
 *             self._remove_piece_at(square)
 *         else:
 *             self._set_piece_at(square, piece.piece_type, piece.color, promoted)             # <<<<<<<<<<<<<<
 * 
 *     def board_fen(self, *, promoted=False):
 */
  /*else*/ {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_color); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_square, __pyx_t_5, __pyx_t_6, __pyx_v_promoted};
      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 4+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 905, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_square, __pyx_t_5, __pyx_t_6, __pyx_v_promoted};
      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 4+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 905, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(4+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 905, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(__pyx_v_square);
      __Pyx_GIVEREF(__pyx_v_square);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_v_square);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, __pyx_t_6);
      __Pyx_INCREF(__pyx_v_promoted);
      __Pyx_GIVEREF(__pyx_v_promoted);
      PyTuple_SET_ITEM(__pyx_t_9, 3+__pyx_t_8, __pyx_v_promoted);
      __pyx_t_5 = 0;
      __pyx_t_6 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_9, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 905, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":895
 *             self.promoted ^= mask
 * 
 *     def set_piece_at(self, square, piece, promoted=False):             # <<<<<<<<<<<<<<
 *         """
 *         Sets a piece at the given square.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.set_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":907
 *             self._set_piece_at(square, piece.piece_type, piece.color, promoted)
 * 
 *     def board_fen(self, *, promoted=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the board FEN.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_47board_fen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_46board_fen[] = "\n        Gets the board FEN.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_47board_fen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("board_fen (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_promoted,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args == 1) {
        const Py_ssize_t index = 0;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "board_fen") < 0)) __PYX_ERR(0, 907, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_promoted = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("board_fen", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 907, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.board_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_46board_fen(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_46board_fen(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_promoted) {
  PyObject *__pyx_v_builder = NULL;
  PyObject *__pyx_v_empty = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("board_fen", 0);

  /* "chess/__init__cp.pyx":911
 *         Gets the board FEN.
 *         """
 *         builder = []             # <<<<<<<<<<<<<<
 *         empty = 0
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 911, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":912
 *         """
 *         builder = []
 *         empty = 0             # <<<<<<<<<<<<<<
 * 
 *         for square in SQUARES_180:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_empty = __pyx_int_0;

  /* "chess/__init__cp.pyx":914
 *         empty = 0
 * 
 *         for square in SQUARES_180:             # <<<<<<<<<<<<<<
 *             piece = self.piece_at(square)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARES_180); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 914, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 914, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 914, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 914, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 914, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 914, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":915
 * 
 *         for square in SQUARES_180:
 *             piece = self.piece_at(square)             # <<<<<<<<<<<<<<
 * 
 *             if not piece:
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_at); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 915, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 915, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_piece, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":917
 *             piece = self.piece_at(square)
 * 
 *             if not piece:             # <<<<<<<<<<<<<<
 *                 empty += 1
 *             else:
 */
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_piece); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 917, __pyx_L1_error)
    __pyx_t_8 = ((!__pyx_t_7) != 0);
    if (__pyx_t_8) {

      /* "chess/__init__cp.pyx":918
 * 
 *             if not piece:
 *                 empty += 1             # <<<<<<<<<<<<<<
 *             else:
 *                 if empty:
 */
      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_empty, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 918, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_empty, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":917
 *             piece = self.piece_at(square)
 * 
 *             if not piece:             # <<<<<<<<<<<<<<
 *                 empty += 1
 *             else:
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":920
 *                 empty += 1
 *             else:
 *                 if empty:             # <<<<<<<<<<<<<<
 *                     builder.append(str(empty))
 *                     empty = 0
 */
    /*else*/ {
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_empty); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 920, __pyx_L1_error)
      if (__pyx_t_8) {

        /* "chess/__init__cp.pyx":921
 *             else:
 *                 if empty:
 *                     builder.append(str(empty))             # <<<<<<<<<<<<<<
 *                     empty = 0
 *                 builder.append(piece.symbol())
 */
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 921, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_1); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 921, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":922
 *                 if empty:
 *                     builder.append(str(empty))
 *                     empty = 0             # <<<<<<<<<<<<<<
 *                 builder.append(piece.symbol())
 *                 if promoted and BB_SQUARES[square] & self.promoted:
 */
        __Pyx_INCREF(__pyx_int_0);
        __Pyx_DECREF_SET(__pyx_v_empty, __pyx_int_0);

        /* "chess/__init__cp.pyx":920
 *                 empty += 1
 *             else:
 *                 if empty:             # <<<<<<<<<<<<<<
 *                     builder.append(str(empty))
 *                     empty = 0
 */
      }

      /* "chess/__init__cp.pyx":923
 *                     builder.append(str(empty))
 *                     empty = 0
 *                 builder.append(piece.symbol())             # <<<<<<<<<<<<<<
 *                 if promoted and BB_SQUARES[square] & self.promoted:
 *                     builder.append("~")
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_symbol); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 923, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 923, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_1); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 923, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":924
 *                     empty = 0
 *                 builder.append(piece.symbol())
 *                 if promoted and BB_SQUARES[square] & self.promoted:             # <<<<<<<<<<<<<<
 *                     builder.append("~")
 * 
 */
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_promoted); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 924, __pyx_L1_error)
      if (__pyx_t_7) {
      } else {
        __pyx_t_8 = __pyx_t_7;
        goto __pyx_L8_bool_binop_done;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 924, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 924, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 924, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 924, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 924, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __pyx_t_7;
      __pyx_L8_bool_binop_done:;
      if (__pyx_t_8) {

        /* "chess/__init__cp.pyx":925
 *                 builder.append(piece.symbol())
 *                 if promoted and BB_SQUARES[square] & self.promoted:
 *                     builder.append("~")             # <<<<<<<<<<<<<<
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:
 */
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__11); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 925, __pyx_L1_error)

        /* "chess/__init__cp.pyx":924
 *                     empty = 0
 *                 builder.append(piece.symbol())
 *                 if promoted and BB_SQUARES[square] & self.promoted:             # <<<<<<<<<<<<<<
 *                     builder.append("~")
 * 
 */
      }
    }
    __pyx_L5:;

    /* "chess/__init__cp.pyx":927
 *                     builder.append("~")
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:             # <<<<<<<<<<<<<<
 *                 if empty:
 *                     builder.append(str(empty))
 */
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 927, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 927, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 927, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = PyNumber_And(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 927, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 927, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_8) {

      /* "chess/__init__cp.pyx":928
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:
 *                 if empty:             # <<<<<<<<<<<<<<
 *                     builder.append(str(empty))
 *                     empty = 0
 */
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_empty); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 928, __pyx_L1_error)
      if (__pyx_t_8) {

        /* "chess/__init__cp.pyx":929
 *             if BB_SQUARES[square] & BB_FILE_H:
 *                 if empty:
 *                     builder.append(str(empty))             # <<<<<<<<<<<<<<
 *                     empty = 0
 * 
 */
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 929, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_5); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 929, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "chess/__init__cp.pyx":930
 *                 if empty:
 *                     builder.append(str(empty))
 *                     empty = 0             # <<<<<<<<<<<<<<
 * 
 *                 if square != H1:
 */
        __Pyx_INCREF(__pyx_int_0);
        __Pyx_DECREF_SET(__pyx_v_empty, __pyx_int_0);

        /* "chess/__init__cp.pyx":928
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:
 *                 if empty:             # <<<<<<<<<<<<<<
 *                     builder.append(str(empty))
 *                     empty = 0
 */
      }

      /* "chess/__init__cp.pyx":932
 *                     empty = 0
 * 
 *                 if square != H1:             # <<<<<<<<<<<<<<
 *                     builder.append("/")
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_H1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 932, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_v_square, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 932, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 932, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_8) {

        /* "chess/__init__cp.pyx":933
 * 
 *                 if square != H1:
 *                     builder.append("/")             # <<<<<<<<<<<<<<
 * 
 *         return "".join(builder)
 */
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__12); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 933, __pyx_L1_error)

        /* "chess/__init__cp.pyx":932
 *                     empty = 0
 * 
 *                 if square != H1:             # <<<<<<<<<<<<<<
 *                     builder.append("/")
 * 
 */
      }

      /* "chess/__init__cp.pyx":927
 *                     builder.append("~")
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:             # <<<<<<<<<<<<<<
 *                 if empty:
 *                     builder.append(str(empty))
 */
    }

    /* "chess/__init__cp.pyx":914
 *         empty = 0
 * 
 *         for square in SQUARES_180:             # <<<<<<<<<<<<<<
 *             piece = self.piece_at(square)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":935
 *                     builder.append("/")
 * 
 *         return "".join(builder)             # <<<<<<<<<<<<<<
 * 
 *     def _set_board_fen(self, fen):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_builder); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":907
 *             self._set_piece_at(square, piece.piece_type, piece.color, promoted)
 * 
 *     def board_fen(self, *, promoted=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the board FEN.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.board_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_empty);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":937
 *         return "".join(builder)
 * 
 *     def _set_board_fen(self, fen):             # <<<<<<<<<<<<<<
 *         # Compability with set_fen().
 *         fen = fen.strip()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_49_set_board_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_49_set_board_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_set_board_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_48_set_board_fen(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_fen));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_48_set_board_fen(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_v_rows = NULL;
  PyObject *__pyx_v_row = NULL;
  PyObject *__pyx_v_field_sum = NULL;
  int __pyx_v_previous_was_digit;
  int __pyx_v_previous_was_piece;
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_v_square_index = NULL;
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  PyObject *__pyx_t_15 = NULL;
  __Pyx_RefNannySetupContext("_set_board_fen", 0);
  __Pyx_INCREF(__pyx_v_fen);

  /* "chess/__init__cp.pyx":939
 *     def _set_board_fen(self, fen):
 *         # Compability with set_fen().
 *         fen = fen.strip()             # <<<<<<<<<<<<<<
 *         if " " in fen:
 *             raise ValueError("expected position part of fen, got multiple parts: {}".format(repr(fen)))
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_fen, __pyx_n_s_strip); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 939, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 939, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_fen, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":940
 *         # Compability with set_fen().
 *         fen = fen.strip()
 *         if " " in fen:             # <<<<<<<<<<<<<<
 *             raise ValueError("expected position part of fen, got multiple parts: {}".format(repr(fen)))
 * 
 */
  __pyx_t_4 = (__Pyx_PySequence_ContainsTF(__pyx_kp_u__14, __pyx_v_fen, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 940, __pyx_L1_error)
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (unlikely(__pyx_t_5)) {

    /* "chess/__init__cp.pyx":941
 *         fen = fen.strip()
 *         if " " in fen:
 *             raise ValueError("expected position part of fen, got multiple parts: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Ensure the FEN is valid.
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_expected_position_part_of_fen_go, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 941, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 941, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 941, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 941, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 941, __pyx_L1_error)

    /* "chess/__init__cp.pyx":940
 *         # Compability with set_fen().
 *         fen = fen.strip()
 *         if " " in fen:             # <<<<<<<<<<<<<<
 *             raise ValueError("expected position part of fen, got multiple parts: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":944
 * 
 *         # Ensure the FEN is valid.
 *         rows = fen.split("/")             # <<<<<<<<<<<<<<
 *         if len(rows) != 8:
 *             raise ValueError("expected 8 rows in position part of fen: {}".format(repr(fen)))
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_fen, __pyx_n_s_split); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 944, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_kp_u__12) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_kp_u__12);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 944, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_rows = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":945
 *         # Ensure the FEN is valid.
 *         rows = fen.split("/")
 *         if len(rows) != 8:             # <<<<<<<<<<<<<<
 *             raise ValueError("expected 8 rows in position part of fen: {}".format(repr(fen)))
 * 
 */
  __pyx_t_7 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 945, __pyx_L1_error)
  __pyx_t_5 = ((__pyx_t_7 != 8) != 0);
  if (unlikely(__pyx_t_5)) {

    /* "chess/__init__cp.pyx":946
 *         rows = fen.split("/")
 *         if len(rows) != 8:
 *             raise ValueError("expected 8 rows in position part of fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Validate each row.
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_expected_8_rows_in_position_part, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 946, __pyx_L1_error)

    /* "chess/__init__cp.pyx":945
 *         # Ensure the FEN is valid.
 *         rows = fen.split("/")
 *         if len(rows) != 8:             # <<<<<<<<<<<<<<
 *             raise ValueError("expected 8 rows in position part of fen: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":949
 * 
 *         # Validate each row.
 *         for row in rows:             # <<<<<<<<<<<<<<
 *             field_sum = 0
 *             previous_was_digit = False
 */
  if (likely(PyList_CheckExact(__pyx_v_rows)) || PyTuple_CheckExact(__pyx_v_rows)) {
    __pyx_t_1 = __pyx_v_rows; __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_rows); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 949, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 949, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 949, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 949, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 949, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 949, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 949, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_row, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":950
 *         # Validate each row.
 *         for row in rows:
 *             field_sum = 0             # <<<<<<<<<<<<<<
 *             previous_was_digit = False
 *             previous_was_piece = False
 */
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_XDECREF_SET(__pyx_v_field_sum, __pyx_int_0);

    /* "chess/__init__cp.pyx":951
 *         for row in rows:
 *             field_sum = 0
 *             previous_was_digit = False             # <<<<<<<<<<<<<<
 *             previous_was_piece = False
 * 
 */
    __pyx_v_previous_was_digit = 0;

    /* "chess/__init__cp.pyx":952
 *             field_sum = 0
 *             previous_was_digit = False
 *             previous_was_piece = False             # <<<<<<<<<<<<<<
 * 
 *             for c in row:
 */
    __pyx_v_previous_was_piece = 0;

    /* "chess/__init__cp.pyx":954
 *             previous_was_piece = False
 * 
 *             for c in row:             # <<<<<<<<<<<<<<
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                     if previous_was_digit:
 */
    if (likely(PyList_CheckExact(__pyx_v_row)) || PyTuple_CheckExact(__pyx_v_row)) {
      __pyx_t_2 = __pyx_v_row; __Pyx_INCREF(__pyx_t_2); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_row); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 954, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 954, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_9); __Pyx_INCREF(__pyx_t_3); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 954, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 954, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_9); __Pyx_INCREF(__pyx_t_3); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 954, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 954, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_10(__pyx_t_2);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 954, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      __Pyx_XDECREF_SET(__pyx_v_c, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "chess/__init__cp.pyx":955
 * 
 *             for c in row:
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:             # <<<<<<<<<<<<<<
 *                     if previous_was_digit:
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))
 */
      __Pyx_INCREF(__pyx_v_c);
      __pyx_t_3 = __pyx_v_c;
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_1, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_2, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_3, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_4, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_5, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_6, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_7, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      if (!__pyx_t_4) {
      } else {
        __pyx_t_5 = __pyx_t_4;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_8, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 955, __pyx_L1_error)
      __pyx_t_5 = __pyx_t_4;
      __pyx_L10_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_4 = (__pyx_t_5 != 0);
      if (__pyx_t_4) {

        /* "chess/__init__cp.pyx":956
 *             for c in row:
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                     if previous_was_digit:             # <<<<<<<<<<<<<<
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))
 *                     field_sum += int(c)
 */
        __pyx_t_4 = (__pyx_v_previous_was_digit != 0);
        if (unlikely(__pyx_t_4)) {

          /* "chess/__init__cp.pyx":957
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                     if previous_was_digit:
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 *                     field_sum += int(c)
 *                     previous_was_digit = True
 */
          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_two_subsequent_digits_in_positio, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 957, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_11 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 957, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_12 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_6, function);
            }
          }
          __pyx_t_3 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_12, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_11);
          __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 957, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 957, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_Raise(__pyx_t_6, 0, 0, 0);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __PYX_ERR(0, 957, __pyx_L1_error)

          /* "chess/__init__cp.pyx":956
 *             for c in row:
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                     if previous_was_digit:             # <<<<<<<<<<<<<<
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))
 *                     field_sum += int(c)
 */
        }

        /* "chess/__init__cp.pyx":958
 *                     if previous_was_digit:
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))
 *                     field_sum += int(c)             # <<<<<<<<<<<<<<
 *                     previous_was_digit = True
 *                     previous_was_piece = False
 */
        __pyx_t_6 = __Pyx_PyNumber_Int(__pyx_v_c); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 958, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_field_sum, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 958, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF_SET(__pyx_v_field_sum, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "chess/__init__cp.pyx":959
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))
 *                     field_sum += int(c)
 *                     previous_was_digit = True             # <<<<<<<<<<<<<<
 *                     previous_was_piece = False
 *                 elif c == "~":
 */
        __pyx_v_previous_was_digit = 1;

        /* "chess/__init__cp.pyx":960
 *                     field_sum += int(c)
 *                     previous_was_digit = True
 *                     previous_was_piece = False             # <<<<<<<<<<<<<<
 *                 elif c == "~":
 *                     if not previous_was_piece:
 */
        __pyx_v_previous_was_piece = 0;

        /* "chess/__init__cp.pyx":955
 * 
 *             for c in row:
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:             # <<<<<<<<<<<<<<
 *                     if previous_was_digit:
 *                         raise ValueError("two subsequent digits in position part of fen: {}".format(repr(fen)))
 */
        goto __pyx_L9;
      }

      /* "chess/__init__cp.pyx":961
 *                     previous_was_digit = True
 *                     previous_was_piece = False
 *                 elif c == "~":             # <<<<<<<<<<<<<<
 *                     if not previous_was_piece:
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))
 */
      __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_v_c, __pyx_kp_u__11, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 961, __pyx_L1_error)
      if (__pyx_t_4) {

        /* "chess/__init__cp.pyx":962
 *                     previous_was_piece = False
 *                 elif c == "~":
 *                     if not previous_was_piece:             # <<<<<<<<<<<<<<
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))
 *                     previous_was_digit = False
 */
        __pyx_t_4 = ((!(__pyx_v_previous_was_piece != 0)) != 0);
        if (unlikely(__pyx_t_4)) {

          /* "chess/__init__cp.pyx":963
 *                 elif c == "~":
 *                     if not previous_was_piece:
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 *                     previous_was_digit = False
 *                     previous_was_piece = False
 */
          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_not_after_piece_in_position_par, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 963, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_11 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 963, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_12 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_6, function);
            }
          }
          __pyx_t_3 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_12, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_11);
          __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 963, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 963, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_Raise(__pyx_t_6, 0, 0, 0);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __PYX_ERR(0, 963, __pyx_L1_error)

          /* "chess/__init__cp.pyx":962
 *                     previous_was_piece = False
 *                 elif c == "~":
 *                     if not previous_was_piece:             # <<<<<<<<<<<<<<
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))
 *                     previous_was_digit = False
 */
        }

        /* "chess/__init__cp.pyx":964
 *                     if not previous_was_piece:
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))
 *                     previous_was_digit = False             # <<<<<<<<<<<<<<
 *                     previous_was_piece = False
 *                 elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 */
        __pyx_v_previous_was_digit = 0;

        /* "chess/__init__cp.pyx":965
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))
 *                     previous_was_digit = False
 *                     previous_was_piece = False             # <<<<<<<<<<<<<<
 *                 elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 *                     field_sum += 1
 */
        __pyx_v_previous_was_piece = 0;

        /* "chess/__init__cp.pyx":961
 *                     previous_was_digit = True
 *                     previous_was_piece = False
 *                 elif c == "~":             # <<<<<<<<<<<<<<
 *                     if not previous_was_piece:
 *                         raise ValueError("~ not after piece in position part of fen: {}".format(repr(fen)))
 */
        goto __pyx_L9;
      }

      /* "chess/__init__cp.pyx":966
 *                     previous_was_digit = False
 *                     previous_was_piece = False
 *                 elif c.lower() in ["p", "n", "b", "r", "q", "k"]:             # <<<<<<<<<<<<<<
 *                     field_sum += 1
 *                     previous_was_digit = False
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_c, __pyx_n_s_lower); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 966, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_11 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_6 = (__pyx_t_11) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_11) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 966, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_p, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_4 = __pyx_t_5;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_n, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_4 = __pyx_t_5;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_b, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_4 = __pyx_t_5;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_r, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_4 = __pyx_t_5;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_q, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_4 = __pyx_t_5;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_k, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
      __pyx_t_4 = __pyx_t_5;
      __pyx_L20_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_5 = (__pyx_t_4 != 0);
      if (likely(__pyx_t_5)) {

        /* "chess/__init__cp.pyx":967
 *                     previous_was_piece = False
 *                 elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 *                     field_sum += 1             # <<<<<<<<<<<<<<
 *                     previous_was_digit = False
 *                     previous_was_piece = True
 */
        __pyx_t_6 = __Pyx_PyInt_AddObjC(__pyx_v_field_sum, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 967, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF_SET(__pyx_v_field_sum, __pyx_t_6);
        __pyx_t_6 = 0;

        /* "chess/__init__cp.pyx":968
 *                 elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 *                     field_sum += 1
 *                     previous_was_digit = False             # <<<<<<<<<<<<<<
 *                     previous_was_piece = True
 *                 else:
 */
        __pyx_v_previous_was_digit = 0;

        /* "chess/__init__cp.pyx":969
 *                     field_sum += 1
 *                     previous_was_digit = False
 *                     previous_was_piece = True             # <<<<<<<<<<<<<<
 *                 else:
 *                     raise ValueError("invalid character in position part of fen: {}".format(repr(fen)))
 */
        __pyx_v_previous_was_piece = 1;

        /* "chess/__init__cp.pyx":966
 *                     previous_was_digit = False
 *                     previous_was_piece = False
 *                 elif c.lower() in ["p", "n", "b", "r", "q", "k"]:             # <<<<<<<<<<<<<<
 *                     field_sum += 1
 *                     previous_was_digit = False
 */
        goto __pyx_L9;
      }

      /* "chess/__init__cp.pyx":971
 *                     previous_was_piece = True
 *                 else:
 *                     raise ValueError("invalid character in position part of fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *             if field_sum != 8:
 */
      /*else*/ {
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_invalid_character_in_position_pa, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 971, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_11 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 971, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_12 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_12)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_12);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_12, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_11);
        __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 971, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 971, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_Raise(__pyx_t_3, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __PYX_ERR(0, 971, __pyx_L1_error)
      }
      __pyx_L9:;

      /* "chess/__init__cp.pyx":954
 *             previous_was_piece = False
 * 
 *             for c in row:             # <<<<<<<<<<<<<<
 *                 if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                     if previous_was_digit:
 */
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":973
 *                     raise ValueError("invalid character in position part of fen: {}".format(repr(fen)))
 * 
 *             if field_sum != 8:             # <<<<<<<<<<<<<<
 *                 raise ValueError("expected 8 columns per row in position part of fen: {}".format(repr(fen)))
 * 
 */
    __pyx_t_2 = __Pyx_PyInt_NeObjC(__pyx_v_field_sum, __pyx_int_8, 8, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 973, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 973, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(__pyx_t_5)) {

      /* "chess/__init__cp.pyx":974
 * 
 *             if field_sum != 8:
 *                 raise ValueError("expected 8 columns per row in position part of fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Clear the board.
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_expected_8_columns_per_row_in_po, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 974, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 974, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_11 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_11, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 974, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 974, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __PYX_ERR(0, 974, __pyx_L1_error)

      /* "chess/__init__cp.pyx":973
 *                     raise ValueError("invalid character in position part of fen: {}".format(repr(fen)))
 * 
 *             if field_sum != 8:             # <<<<<<<<<<<<<<
 *                 raise ValueError("expected 8 columns per row in position part of fen: {}".format(repr(fen)))
 * 
 */
    }

    /* "chess/__init__cp.pyx":949
 * 
 *         # Validate each row.
 *         for row in rows:             # <<<<<<<<<<<<<<
 *             field_sum = 0
 *             previous_was_digit = False
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":977
 * 
 *         # Clear the board.
 *         self._clear_board()             # <<<<<<<<<<<<<<
 * 
 *         # Put pieces on the board.
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_board); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 977, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 977, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":980
 * 
 *         # Put pieces on the board.
 *         square_index = 0             # <<<<<<<<<<<<<<
 *         for c in fen:
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_square_index = __pyx_int_0;

  /* "chess/__init__cp.pyx":981
 *         # Put pieces on the board.
 *         square_index = 0
 *         for c in fen:             # <<<<<<<<<<<<<<
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                 square_index += int(c)
 */
  if (likely(PyList_CheckExact(__pyx_v_fen)) || PyTuple_CheckExact(__pyx_v_fen)) {
    __pyx_t_1 = __pyx_v_fen; __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 981, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 981, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 981, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 981, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 981, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 981, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 981, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_c, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":982
 *         square_index = 0
 *         for c in fen:
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:             # <<<<<<<<<<<<<<
 *                 square_index += int(c)
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 */
    __Pyx_INCREF(__pyx_v_c);
    __pyx_t_3 = __pyx_v_c;
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_1, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_2, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_3, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_4, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_5, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_6, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_7, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    if (!__pyx_t_4) {
    } else {
      __pyx_t_5 = __pyx_t_4;
      goto __pyx_L30_bool_binop_done;
    }
    __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u_8, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 982, __pyx_L1_error)
    __pyx_t_5 = __pyx_t_4;
    __pyx_L30_bool_binop_done:;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_4 = (__pyx_t_5 != 0);
    if (__pyx_t_4) {

      /* "chess/__init__cp.pyx":983
 *         for c in fen:
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                 square_index += int(c)             # <<<<<<<<<<<<<<
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 *                 piece = Piece.from_symbol(c)
 */
      __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_v_c); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 983, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_square_index, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 983, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF_SET(__pyx_v_square_index, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":982
 *         square_index = 0
 *         for c in fen:
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:             # <<<<<<<<<<<<<<
 *                 square_index += int(c)
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 */
      goto __pyx_L29;
    }

    /* "chess/__init__cp.pyx":984
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                 square_index += int(c)
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:             # <<<<<<<<<<<<<<
 *                 piece = Piece.from_symbol(c)
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_c, __pyx_n_s_lower); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 984, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 984, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_p, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 984, __pyx_L1_error)
    if (!__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L38_bool_binop_done;
    }
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_n, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 984, __pyx_L1_error)
    if (!__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L38_bool_binop_done;
    }
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_b, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 984, __pyx_L1_error)
    if (!__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L38_bool_binop_done;
    }
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_r, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 984, __pyx_L1_error)
    if (!__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L38_bool_binop_done;
    }
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_q, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 984, __pyx_L1_error)
    if (!__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L38_bool_binop_done;
    }
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_k, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 984, __pyx_L1_error)
    __pyx_t_4 = __pyx_t_5;
    __pyx_L38_bool_binop_done:;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = (__pyx_t_4 != 0);
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":985
 *                 square_index += int(c)
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 *                 piece = Piece.from_symbol(c)             # <<<<<<<<<<<<<<
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)
 *                 square_index += 1
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_Piece); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 985, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_from_symbol); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 985, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_v_c) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_c);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 985, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF_SET(__pyx_v_piece, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":986
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:
 *                 piece = Piece.from_symbol(c)
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)             # <<<<<<<<<<<<<<
 *                 square_index += 1
 *             elif c == "~":
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SQUARES_180); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_square_index); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_color); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_13 = NULL;
      __pyx_t_14 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
          __pyx_t_14 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_6)) {
        PyObject *__pyx_temp[4] = {__pyx_t_13, __pyx_t_11, __pyx_t_3, __pyx_t_12};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_14, 3+__pyx_t_14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
        PyObject *__pyx_temp[4] = {__pyx_t_13, __pyx_t_11, __pyx_t_3, __pyx_t_12};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_14, 3+__pyx_t_14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      } else
      #endif
      {
        __pyx_t_15 = PyTuple_New(3+__pyx_t_14); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 986, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_15);
        if (__pyx_t_13) {
          __Pyx_GIVEREF(__pyx_t_13); PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_13); __pyx_t_13 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_15, 0+__pyx_t_14, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_15, 1+__pyx_t_14, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_15, 2+__pyx_t_14, __pyx_t_12);
        __pyx_t_11 = 0;
        __pyx_t_3 = 0;
        __pyx_t_12 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_15, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":987
 *                 piece = Piece.from_symbol(c)
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)
 *                 square_index += 1             # <<<<<<<<<<<<<<
 *             elif c == "~":
 *                 self.promoted |= BB_SQUARES[SQUARES_180[square_index - 1]]
 */
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_square_index, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF_SET(__pyx_v_square_index, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":984
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                 square_index += int(c)
 *             elif c.lower() in ["p", "n", "b", "r", "q", "k"]:             # <<<<<<<<<<<<<<
 *                 piece = Piece.from_symbol(c)
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)
 */
      goto __pyx_L29;
    }

    /* "chess/__init__cp.pyx":988
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)
 *                 square_index += 1
 *             elif c == "~":             # <<<<<<<<<<<<<<
 *                 self.promoted |= BB_SQUARES[SQUARES_180[square_index - 1]]
 * 
 */
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_c, __pyx_kp_u__11, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 988, __pyx_L1_error)
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":989
 *                 square_index += 1
 *             elif c == "~":
 *                 self.promoted |= BB_SQUARES[SQUARES_180[square_index - 1]]             # <<<<<<<<<<<<<<
 * 
 *     def set_board_fen(self, fen):
 */
      __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_SQUARES_180); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_15);
      __pyx_t_12 = __Pyx_PyInt_SubtractObjC(__pyx_v_square_index, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_15, __pyx_t_12); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_InPlaceOr(__pyx_t_2, __pyx_t_12); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 989, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_v_self->promoted = __pyx_t_5;

      /* "chess/__init__cp.pyx":988
 *                 self._set_piece_at(SQUARES_180[square_index], piece.piece_type, piece.color)
 *                 square_index += 1
 *             elif c == "~":             # <<<<<<<<<<<<<<
 *                 self.promoted |= BB_SQUARES[SQUARES_180[square_index - 1]]
 * 
 */
    }
    __pyx_L29:;

    /* "chess/__init__cp.pyx":981
 *         # Put pieces on the board.
 *         square_index = 0
 *         for c in fen:             # <<<<<<<<<<<<<<
 *             if c in ["1", "2", "3", "4", "5", "6", "7", "8"]:
 *                 square_index += int(c)
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":937
 *         return "".join(builder)
 * 
 *     def _set_board_fen(self, fen):             # <<<<<<<<<<<<<<
 *         # Compability with set_fen().
 *         fen = fen.strip()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._set_board_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_rows);
  __Pyx_XDECREF(__pyx_v_row);
  __Pyx_XDECREF(__pyx_v_field_sum);
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_XDECREF(__pyx_v_square_index);
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XDECREF(__pyx_v_fen);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":991
 *                 self.promoted |= BB_SQUARES[SQUARES_180[square_index - 1]]
 * 
 *     def set_board_fen(self, fen):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a FEN and sets the board from it.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_51set_board_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_50set_board_fen[] = "\n        Parses a FEN and sets the board from it.\n\n        :raises: :exc:`ValueError` if the FEN string is invalid.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_51set_board_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_board_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_50set_board_fen(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_fen));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_50set_board_fen(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_board_fen", 0);

  /* "chess/__init__cp.pyx":997
 *         :raises: :exc:`ValueError` if the FEN string is invalid.
 *         """
 *         self._set_board_fen(fen)             # <<<<<<<<<<<<<<
 * 
 *     def piece_map(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_board_fen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_fen) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_fen);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":991
 *                 self.promoted |= BB_SQUARES[SQUARES_180[square_index - 1]]
 * 
 *     def set_board_fen(self, fen):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a FEN and sets the board from it.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.set_board_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":999
 *         self._set_board_fen(fen)
 * 
 *     def piece_map(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a dictionary of :class:`pieces <chess.Piece>` by square index.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_53piece_map(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_52piece_map[] = "\n        Gets a dictionary of :class:`pieces <chess.Piece>` by square index.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_53piece_map(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("piece_map (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_52piece_map(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_52piece_map(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  __Pyx_RefNannySetupContext("piece_map", 0);

  /* "chess/__init__cp.pyx":1003
 *         Gets a dictionary of :class:`pieces <chess.Piece>` by square index.
 *         """
 *         result = {}             # <<<<<<<<<<<<<<
 *         for square in scan_reversed(self.occupied):
 *             result[square] = self.piece_at(square)
 */
  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1003, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1004
 *         """
 *         result = {}
 *         for square in scan_reversed(self.occupied):             # <<<<<<<<<<<<<<
 *             result[square] = self.piece_at(square)
 *         return result
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1004, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1004, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1004, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1004, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1004, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1004, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1004, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1005
 *         result = {}
 *         for square in scan_reversed(self.occupied):
 *             result[square] = self.piece_at(square)             # <<<<<<<<<<<<<<
 *         return result
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_at); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(PyDict_SetItem(__pyx_v_result, __pyx_v_square, __pyx_t_1) < 0)) __PYX_ERR(0, 1005, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1004
 *         """
 *         result = {}
 *         for square in scan_reversed(self.occupied):             # <<<<<<<<<<<<<<
 *             result[square] = self.piece_at(square)
 *         return result
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1006
 *         for square in scan_reversed(self.occupied):
 *             result[square] = self.piece_at(square)
 *         return result             # <<<<<<<<<<<<<<
 * 
 *     def _set_piece_map(self, pieces):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":999
 *         self._set_board_fen(fen)
 * 
 *     def piece_map(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a dictionary of :class:`pieces <chess.Piece>` by square index.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.piece_map", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1008
 *         return result
 * 
 *     def _set_piece_map(self, pieces):             # <<<<<<<<<<<<<<
 *         self._clear_board()
 *         for square, piece in pieces.items():
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_55_set_piece_map(PyObject *__pyx_v_self, PyObject *__pyx_v_pieces); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_55_set_piece_map(PyObject *__pyx_v_self, PyObject *__pyx_v_pieces) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_set_piece_map (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_54_set_piece_map(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_pieces));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_54_set_piece_map(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_pieces) {
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  __Pyx_RefNannySetupContext("_set_piece_map", 0);

  /* "chess/__init__cp.pyx":1009
 * 
 *     def _set_piece_map(self, pieces):
 *         self._clear_board()             # <<<<<<<<<<<<<<
 *         for square, piece in pieces.items():
 *             self._set_piece_at(square, piece.piece_type, piece.color)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1009, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1010
 *     def _set_piece_map(self, pieces):
 *         self._clear_board()
 *         for square, piece in pieces.items():             # <<<<<<<<<<<<<<
 *             self._set_piece_at(square, piece.piece_type, piece.color)
 * 
 */
  __pyx_t_4 = 0;
  if (unlikely(__pyx_v_pieces == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
    __PYX_ERR(0, 1010, __pyx_L1_error)
  }
  __pyx_t_2 = __Pyx_dict_iterator(__pyx_v_pieces, 0, __pyx_n_s_items, (&__pyx_t_5), (&__pyx_t_6)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1010, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_1);
  __pyx_t_1 = __pyx_t_2;
  __pyx_t_2 = 0;
  while (1) {
    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_5, &__pyx_t_4, &__pyx_t_2, &__pyx_t_3, NULL, __pyx_t_6);
    if (unlikely(__pyx_t_7 == 0)) break;
    if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 1010, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_piece, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1011
 *         self._clear_board()
 *         for square, piece in pieces.items():
 *             self._set_piece_at(square, piece.piece_type, piece.color)             # <<<<<<<<<<<<<<
 * 
 *     def set_piece_map(self, pieces):
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1011, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_piece_type); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1011, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_color); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1011, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_square, __pyx_t_8, __pyx_t_9};
      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1011, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_square, __pyx_t_8, __pyx_t_9};
      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1011, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    {
      __pyx_t_11 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1011, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      if (__pyx_t_10) {
        __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_10); __pyx_t_10 = NULL;
      }
      __Pyx_INCREF(__pyx_v_square);
      __Pyx_GIVEREF(__pyx_v_square);
      PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_7, __pyx_v_square);
      __Pyx_GIVEREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_7, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_7, __pyx_t_9);
      __pyx_t_8 = 0;
      __pyx_t_9 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1011, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1008
 *         return result
 * 
 *     def _set_piece_map(self, pieces):             # <<<<<<<<<<<<<<
 *         self._clear_board()
 *         for square, piece in pieces.items():
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._set_piece_map", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1013
 *             self._set_piece_at(square, piece.piece_type, piece.color)
 * 
 *     def set_piece_map(self, pieces):             # <<<<<<<<<<<<<<
 *         """
 *         Sets up the board from a dictionary of :class:`pieces <chess.Piece>`
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_57set_piece_map(PyObject *__pyx_v_self, PyObject *__pyx_v_pieces); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_56set_piece_map[] = "\n        Sets up the board from a dictionary of :class:`pieces <chess.Piece>`\n        by square index.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_57set_piece_map(PyObject *__pyx_v_self, PyObject *__pyx_v_pieces) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_piece_map (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_56set_piece_map(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_pieces));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_56set_piece_map(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_pieces) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_piece_map", 0);

  /* "chess/__init__cp.pyx":1018
 *         by square index.
 *         """
 *         self._set_piece_map(pieces)             # <<<<<<<<<<<<<<
 * 
 *     def _set_chess960_pos(self, sharnagl):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_map); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_pieces) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_pieces);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1018, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1013
 *             self._set_piece_at(square, piece.piece_type, piece.color)
 * 
 *     def set_piece_map(self, pieces):             # <<<<<<<<<<<<<<
 *         """
 *         Sets up the board from a dictionary of :class:`pieces <chess.Piece>`
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.set_piece_map", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1020
 *         self._set_piece_map(pieces)
 * 
 *     def _set_chess960_pos(self, sharnagl):             # <<<<<<<<<<<<<<
 *         if not 0 <= sharnagl <= 959:
 *             raise ValueError("chess960 position index not 0 <= {} <= 959".format(repr(sharnagl)))
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_59_set_chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_v_sharnagl); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_59_set_chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_set_chess960_pos (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_58_set_chess960_pos(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_sharnagl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_58_set_chess960_pos(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_v_bw = NULL;
  PyObject *__pyx_v_bb = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_n1 = NULL;
  PyObject *__pyx_v_n2 = NULL;
  PyObject *__pyx_v_bw_file = NULL;
  PyObject *__pyx_v_bb_file = NULL;
  PyObject *__pyx_v_q_file = NULL;
  PyObject *__pyx_v_used = NULL;
  long __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *(*__pyx_t_7)(PyObject *);
  long __pyx_t_8;
  unsigned PY_LONG_LONG __pyx_t_9;
  int __pyx_t_10;
  __Pyx_RefNannySetupContext("_set_chess960_pos", 0);

  /* "chess/__init__cp.pyx":1021
 * 
 *     def _set_chess960_pos(self, sharnagl):
 *         if not 0 <= sharnagl <= 959:             # <<<<<<<<<<<<<<
 *             raise ValueError("chess960 position index not 0 <= {} <= 959".format(repr(sharnagl)))
 * 
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_int_0, __pyx_v_sharnagl, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1021, __pyx_L1_error)
  if (__Pyx_PyObject_IsTrue(__pyx_t_1)) {
    __Pyx_DECREF(__pyx_t_1);
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_sharnagl, __pyx_int_959, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1021, __pyx_L1_error)
  }
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1021, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (unlikely(__pyx_t_3)) {

    /* "chess/__init__cp.pyx":1022
 *     def _set_chess960_pos(self, sharnagl):
 *         if not 0 <= sharnagl <= 959:
 *             raise ValueError("chess960 position index not 0 <= {} <= 959".format(repr(sharnagl)))             # <<<<<<<<<<<<<<
 * 
 *         # See http://www.russellcottrell.com/Chess/Chess960.htm for
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_chess960_position_index_not_0_95, __pyx_n_s_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1022, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_Repr(__pyx_v_sharnagl); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1022, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1022, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1022, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __PYX_ERR(0, 1022, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1021
 * 
 *     def _set_chess960_pos(self, sharnagl):
 *         if not 0 <= sharnagl <= 959:             # <<<<<<<<<<<<<<
 *             raise ValueError("chess960 position index not 0 <= {} <= 959".format(repr(sharnagl)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":1026
 *         # See http://www.russellcottrell.com/Chess/Chess960.htm for
 *         # a description of the algorithm.
 *         n, bw = divmod(sharnagl, 4)             # <<<<<<<<<<<<<<
 *         n, bb = divmod(n, 4)
 *         n, q = divmod(n, 6)
 */
  __pyx_t_4 = PyNumber_Divmod(__pyx_v_sharnagl, __pyx_int_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1026, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 1026, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_5);
    #else
    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1026, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1026, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1026, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_1 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_1)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    index = 1; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_5);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 1026, __pyx_L1_error)
    __pyx_t_7 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L5_unpacking_done;
    __pyx_L4_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 1026, __pyx_L1_error)
    __pyx_L5_unpacking_done:;
  }
  __pyx_v_n = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_bw = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":1027
 *         # a description of the algorithm.
 *         n, bw = divmod(sharnagl, 4)
 *         n, bb = divmod(n, 4)             # <<<<<<<<<<<<<<
 *         n, q = divmod(n, 6)
 * 
 */
  __pyx_t_4 = PyNumber_Divmod(__pyx_v_n, __pyx_int_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1027, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 1027, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_t_1);
    #else
    __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1027, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1027, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1027, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L6_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_5);
    index = 1; __pyx_t_1 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_1)) goto __pyx_L6_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 1027, __pyx_L1_error)
    __pyx_t_7 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L7_unpacking_done;
    __pyx_L6_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 1027, __pyx_L1_error)
    __pyx_L7_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_n, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_v_bb = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1028
 *         n, bw = divmod(sharnagl, 4)
 *         n, bb = divmod(n, 4)
 *         n, q = divmod(n, 6)             # <<<<<<<<<<<<<<
 * 
 *         for n1 in range(0, 4):
 */
  __pyx_t_4 = PyNumber_Divmod(__pyx_v_n, __pyx_int_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1028, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 1028, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_5);
    #else
    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1028, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1028, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1028, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_1 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_1)) goto __pyx_L8_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    index = 1; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L8_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_5);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 1028, __pyx_L1_error)
    __pyx_t_7 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L9_unpacking_done;
    __pyx_L8_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 1028, __pyx_L1_error)
    __pyx_L9_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_n, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_v_q = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":1030
 *         n, q = divmod(n, 6)
 * 
 *         for n1 in range(0, 4):             # <<<<<<<<<<<<<<
 *             n2 = n + (3 - n1) * (4 - n1) // 2 - 5
 *             if n1 < n2 and 1 <= n2 <= 4:
 */
  for (__pyx_t_8 = 0; __pyx_t_8 < 4; __pyx_t_8+=1) {
    __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1030, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_n1, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":1031
 * 
 *         for n1 in range(0, 4):
 *             n2 = n + (3 - n1) * (4 - n1) // 2 - 5             # <<<<<<<<<<<<<<
 *             if n1 < n2 and 1 <= n2 <= 4:
 *                 break
 */
    __pyx_t_4 = __Pyx_PyInt_SubtractCObj(__pyx_int_3, __pyx_v_n1, 3, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1031, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyInt_SubtractCObj(__pyx_int_4, __pyx_v_n1, 4, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1031, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyNumber_Multiply(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1031, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyInt_FloorDivideObjC(__pyx_t_1, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1031, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Add(__pyx_v_n, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1031, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_5, 5, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1031, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_n2, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":1032
 *         for n1 in range(0, 4):
 *             n2 = n + (3 - n1) * (4 - n1) // 2 - 5
 *             if n1 < n2 and 1 <= n2 <= 4:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_n1, __pyx_v_n2, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1032, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1032, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_2) {
    } else {
      __pyx_t_3 = __pyx_t_2;
      goto __pyx_L13_bool_binop_done;
    }
    __pyx_t_5 = PyObject_RichCompare(__pyx_int_1, __pyx_v_n2, Py_LE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1032, __pyx_L1_error)
    if (__Pyx_PyObject_IsTrue(__pyx_t_5)) {
      __Pyx_DECREF(__pyx_t_5);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_n2, __pyx_int_4, Py_LE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1032, __pyx_L1_error)
    }
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1032, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = __pyx_t_2;
    __pyx_L13_bool_binop_done:;
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":1033
 *             n2 = n + (3 - n1) * (4 - n1) // 2 - 5
 *             if n1 < n2 and 1 <= n2 <= 4:
 *                 break             # <<<<<<<<<<<<<<
 * 
 *         # Bishops.
 */
      goto __pyx_L11_break;

      /* "chess/__init__cp.pyx":1032
 *         for n1 in range(0, 4):
 *             n2 = n + (3 - n1) * (4 - n1) // 2 - 5
 *             if n1 < n2 and 1 <= n2 <= 4:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    }
  }
  __pyx_L11_break:;

  /* "chess/__init__cp.pyx":1036
 * 
 *         # Bishops.
 *         bw_file = bw * 2 + 1             # <<<<<<<<<<<<<<
 *         bb_file = bb * 2
 *         self.bishops = (BB_FILES[bw_file] | BB_FILES[bb_file]) & BB_BACKRANKS
 */
  __pyx_t_5 = PyNumber_Multiply(__pyx_v_bw, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1036, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_5, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1036, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_bw_file = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1037
 *         # Bishops.
 *         bw_file = bw * 2 + 1
 *         bb_file = bb * 2             # <<<<<<<<<<<<<<
 *         self.bishops = (BB_FILES[bw_file] | BB_FILES[bb_file]) & BB_BACKRANKS
 * 
 */
  __pyx_t_1 = PyNumber_Multiply(__pyx_v_bb, __pyx_int_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_bb_file = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1038
 *         bw_file = bw * 2 + 1
 *         bb_file = bb * 2
 *         self.bishops = (BB_FILES[bw_file] | BB_FILES[bb_file]) & BB_BACKRANKS             # <<<<<<<<<<<<<<
 * 
 *         # Queens.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_bw_file); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_bb_file); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyNumber_And(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_5); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1038, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_self->bishops = __pyx_t_9;

  /* "chess/__init__cp.pyx":1041
 * 
 *         # Queens.
 *         q_file = q             # <<<<<<<<<<<<<<
 *         q_file += int(min(bw_file, bb_file) <= q_file)
 *         q_file += int(max(bw_file, bb_file) <= q_file)
 */
  __Pyx_INCREF(__pyx_v_q);
  __pyx_v_q_file = __pyx_v_q;

  /* "chess/__init__cp.pyx":1042
 *         # Queens.
 *         q_file = q
 *         q_file += int(min(bw_file, bb_file) <= q_file)             # <<<<<<<<<<<<<<
 *         q_file += int(max(bw_file, bb_file) <= q_file)
 *         self.queens = BB_FILES[q_file] & BB_BACKRANKS
 */
  __Pyx_INCREF(__pyx_v_bb_file);
  __pyx_t_5 = __pyx_v_bb_file;
  __Pyx_INCREF(__pyx_v_bw_file);
  __pyx_t_4 = __pyx_v_bw_file;
  __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1042, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1042, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_3) {
    __Pyx_INCREF(__pyx_t_5);
    __pyx_t_1 = __pyx_t_5;
  } else {
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_1 = __pyx_t_4;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_q_file, Py_LE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1042, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_q_file, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1042, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_q_file, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":1043
 *         q_file = q
 *         q_file += int(min(bw_file, bb_file) <= q_file)
 *         q_file += int(max(bw_file, bb_file) <= q_file)             # <<<<<<<<<<<<<<
 *         self.queens = BB_FILES[q_file] & BB_BACKRANKS
 * 
 */
  __Pyx_INCREF(__pyx_v_bb_file);
  __pyx_t_5 = __pyx_v_bb_file;
  __Pyx_INCREF(__pyx_v_bw_file);
  __pyx_t_1 = __pyx_v_bw_file;
  __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1043, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1043, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_3) {
    __Pyx_INCREF(__pyx_t_5);
    __pyx_t_4 = __pyx_t_5;
  } else {
    __Pyx_INCREF(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_v_q_file, Py_LE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1043, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyNumber_Int(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1043, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_q_file, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1043, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF_SET(__pyx_v_q_file, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":1044
 *         q_file += int(min(bw_file, bb_file) <= q_file)
 *         q_file += int(max(bw_file, bb_file) <= q_file)
 *         self.queens = BB_FILES[q_file] & BB_BACKRANKS             # <<<<<<<<<<<<<<
 * 
 *         used = [bw_file, bb_file, q_file]
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1044, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_q_file); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1044, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1044, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = PyNumber_And(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1044, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1044, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->queens = __pyx_t_9;

  /* "chess/__init__cp.pyx":1046
 *         self.queens = BB_FILES[q_file] & BB_BACKRANKS
 * 
 *         used = [bw_file, bb_file, q_file]             # <<<<<<<<<<<<<<
 * 
 *         # Knights.
 */
  __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1046, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_bw_file);
  __Pyx_GIVEREF(__pyx_v_bw_file);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_bw_file);
  __Pyx_INCREF(__pyx_v_bb_file);
  __Pyx_GIVEREF(__pyx_v_bb_file);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_v_bb_file);
  __Pyx_INCREF(__pyx_v_q_file);
  __Pyx_GIVEREF(__pyx_v_q_file);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_v_q_file);
  __pyx_v_used = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1049
 * 
 *         # Knights.
 *         self.knights = BB_EMPTY             # <<<<<<<<<<<<<<
 *         for i in range(0, 8):
 *             if i not in used:
 */
  __pyx_v_self->knights = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":1050
 *         # Knights.
 *         self.knights = BB_EMPTY
 *         for i in range(0, 8):             # <<<<<<<<<<<<<<
 *             if i not in used:
 *                 if n1 == 0 or n2 == 0:
 */
  for (__pyx_t_8 = 0; __pyx_t_8 < 8; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;

    /* "chess/__init__cp.pyx":1051
 *         self.knights = BB_EMPTY
 *         for i in range(0, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 if n1 == 0 or n2 == 0:
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS
 */
    __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1051, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_used, Py_NE)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1051, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_2 = (__pyx_t_3 != 0);
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":1052
 *         for i in range(0, 8):
 *             if i not in used:
 *                 if n1 == 0 or n2 == 0:             # <<<<<<<<<<<<<<
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS
 *                     used.append(i)
 */
      if (unlikely(!__pyx_v_n1)) { __Pyx_RaiseUnboundLocalError("n1"); __PYX_ERR(0, 1052, __pyx_L1_error) }
      __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_v_n1, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1052, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1052, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (!__pyx_t_3) {
      } else {
        __pyx_t_2 = __pyx_t_3;
        goto __pyx_L19_bool_binop_done;
      }
      if (unlikely(!__pyx_v_n2)) { __Pyx_RaiseUnboundLocalError("n2"); __PYX_ERR(0, 1052, __pyx_L1_error) }
      __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_v_n2, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1052, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1052, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_2 = __pyx_t_3;
      __pyx_L19_bool_binop_done:;
      if (__pyx_t_2) {

        /* "chess/__init__cp.pyx":1053
 *             if i not in used:
 *                 if n1 == 0 or n2 == 0:
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS             # <<<<<<<<<<<<<<
 *                     used.append(i)
 *                 n1 -= 1
 */
        __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_i, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = PyNumber_And(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_5); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1053, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_self->knights = __pyx_t_9;

        /* "chess/__init__cp.pyx":1054
 *                 if n1 == 0 or n2 == 0:
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS
 *                     used.append(i)             # <<<<<<<<<<<<<<
 *                 n1 -= 1
 *                 n2 -= 1
 */
        __pyx_t_5 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1054, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_used, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1054, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "chess/__init__cp.pyx":1052
 *         for i in range(0, 8):
 *             if i not in used:
 *                 if n1 == 0 or n2 == 0:             # <<<<<<<<<<<<<<
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS
 *                     used.append(i)
 */
      }

      /* "chess/__init__cp.pyx":1055
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS
 *                     used.append(i)
 *                 n1 -= 1             # <<<<<<<<<<<<<<
 *                 n2 -= 1
 * 
 */
      if (unlikely(!__pyx_v_n1)) { __Pyx_RaiseUnboundLocalError("n1"); __PYX_ERR(0, 1055, __pyx_L1_error) }
      __pyx_t_5 = __Pyx_PyInt_SubtractObjC(__pyx_v_n1, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1055, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_XDECREF_SET(__pyx_v_n1, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":1056
 *                     used.append(i)
 *                 n1 -= 1
 *                 n2 -= 1             # <<<<<<<<<<<<<<
 * 
 *         # RKR.
 */
      if (unlikely(!__pyx_v_n2)) { __Pyx_RaiseUnboundLocalError("n2"); __PYX_ERR(0, 1056, __pyx_L1_error) }
      __pyx_t_5 = __Pyx_PyInt_SubtractObjC(__pyx_v_n2, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1056, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_XDECREF_SET(__pyx_v_n2, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":1051
 *         self.knights = BB_EMPTY
 *         for i in range(0, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 if n1 == 0 or n2 == 0:
 *                     self.knights |= BB_FILES[i] & BB_BACKRANKS
 */
    }
  }

  /* "chess/__init__cp.pyx":1059
 * 
 *         # RKR.
 *         for i in range(0, 8):             # <<<<<<<<<<<<<<
 *             if i not in used:
 *                 self.rooks = BB_FILES[i] & BB_BACKRANKS
 */
  for (__pyx_t_8 = 0; __pyx_t_8 < 8; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;

    /* "chess/__init__cp.pyx":1060
 *         # RKR.
 *         for i in range(0, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 self.rooks = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)
 */
    __pyx_t_5 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1060, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_5, __pyx_v_used, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1060, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = (__pyx_t_2 != 0);
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":1061
 *         for i in range(0, 8):
 *             if i not in used:
 *                 self.rooks = BB_FILES[i] & BB_BACKRANKS             # <<<<<<<<<<<<<<
 *                 used.append(i)
 *                 break
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1061, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_i, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1061, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1061, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyNumber_And(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1061, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_self->rooks = __pyx_t_9;

      /* "chess/__init__cp.pyx":1062
 *             if i not in used:
 *                 self.rooks = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)             # <<<<<<<<<<<<<<
 *                 break
 *         for i in range(1, 8):
 */
      __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1062, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_used, __pyx_t_1); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1062, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":1063
 *                 self.rooks = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)
 *                 break             # <<<<<<<<<<<<<<
 *         for i in range(1, 8):
 *             if i not in used:
 */
      goto __pyx_L22_break;

      /* "chess/__init__cp.pyx":1060
 *         # RKR.
 *         for i in range(0, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 self.rooks = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)
 */
    }
  }
  __pyx_L22_break:;

  /* "chess/__init__cp.pyx":1064
 *                 used.append(i)
 *                 break
 *         for i in range(1, 8):             # <<<<<<<<<<<<<<
 *             if i not in used:
 *                 self.kings = BB_FILES[i] & BB_BACKRANKS
 */
  for (__pyx_t_8 = 1; __pyx_t_8 < 8; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;

    /* "chess/__init__cp.pyx":1065
 *                 break
 *         for i in range(1, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 self.kings = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)
 */
    __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1065, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_used, Py_NE)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1065, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_2 = (__pyx_t_3 != 0);
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":1066
 *         for i in range(1, 8):
 *             if i not in used:
 *                 self.kings = BB_FILES[i] & BB_BACKRANKS             # <<<<<<<<<<<<<<
 *                 used.append(i)
 *                 break
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_6); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_v_self->kings = __pyx_t_9;

      /* "chess/__init__cp.pyx":1067
 *             if i not in used:
 *                 self.kings = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)             # <<<<<<<<<<<<<<
 *                 break
 *         for i in range(2, 8):
 */
      __pyx_t_6 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1067, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_used, __pyx_t_6); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1067, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":1068
 *                 self.kings = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)
 *                 break             # <<<<<<<<<<<<<<
 *         for i in range(2, 8):
 *             if i not in used:
 */
      goto __pyx_L25_break;

      /* "chess/__init__cp.pyx":1065
 *                 break
 *         for i in range(1, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 self.kings = BB_FILES[i] & BB_BACKRANKS
 *                 used.append(i)
 */
    }
  }
  __pyx_L25_break:;

  /* "chess/__init__cp.pyx":1069
 *                 used.append(i)
 *                 break
 *         for i in range(2, 8):             # <<<<<<<<<<<<<<
 *             if i not in used:
 *                 self.rooks |= BB_FILES[i] & BB_BACKRANKS
 */
  for (__pyx_t_8 = 2; __pyx_t_8 < 8; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;

    /* "chess/__init__cp.pyx":1070
 *                 break
 *         for i in range(2, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 self.rooks |= BB_FILES[i] & BB_BACKRANKS
 *                 break
 */
    __pyx_t_6 = __Pyx_PyInt_From_long(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_6, __pyx_v_used, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1070, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_3 = (__pyx_t_2 != 0);
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":1071
 *         for i in range(2, 8):
 *             if i not in used:
 *                 self.rooks |= BB_FILES[i] & BB_BACKRANKS             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
      __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyNumber_And(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_InPlaceOr(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1071, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_self->rooks = __pyx_t_9;

      /* "chess/__init__cp.pyx":1072
 *             if i not in used:
 *                 self.rooks |= BB_FILES[i] & BB_BACKRANKS
 *                 break             # <<<<<<<<<<<<<<
 * 
 *         # Finalize.
 */
      goto __pyx_L28_break;

      /* "chess/__init__cp.pyx":1070
 *                 break
 *         for i in range(2, 8):
 *             if i not in used:             # <<<<<<<<<<<<<<
 *                 self.rooks |= BB_FILES[i] & BB_BACKRANKS
 *                 break
 */
    }
  }
  __pyx_L28_break:;

  /* "chess/__init__cp.pyx":1075
 * 
 *         # Finalize.
 *         self.pawns = BB_RANK_2 | BB_RANK_7             # <<<<<<<<<<<<<<
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1075, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1075, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1075, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_6); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1075, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_self->pawns = __pyx_t_9;

  /* "chess/__init__cp.pyx":1076
 *         # Finalize.
 *         self.pawns = BB_RANK_2 | BB_RANK_7
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2             # <<<<<<<<<<<<<<
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1076, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1076, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Or(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1076, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  (__pyx_v_self->occupied_co[1]) = __pyx_t_9;

  /* "chess/__init__cp.pyx":1077
 *         self.pawns = BB_RANK_2 | BB_RANK_7
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8             # <<<<<<<<<<<<<<
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 *         self.promoted = BB_EMPTY
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1077, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1077, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1077, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_9 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_6); if (unlikely((__pyx_t_9 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1077, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  (__pyx_v_self->occupied_co[0]) = __pyx_t_9;

  /* "chess/__init__cp.pyx":1078
 *         self.occupied_co[WHITE] = BB_RANK_1 | BB_RANK_2
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8             # <<<<<<<<<<<<<<
 *         self.promoted = BB_EMPTY
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Or(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Or(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1078, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->occupied = __pyx_t_3;

  /* "chess/__init__cp.pyx":1079
 *         self.occupied_co[BLACK] = BB_RANK_7 | BB_RANK_8
 *         self.occupied = BB_RANK_1 | BB_RANK_2 | BB_RANK_7 | BB_RANK_8
 *         self.promoted = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *     def set_chess960_pos(self, sharnagl):
 */
  __pyx_v_self->promoted = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":1020
 *         self._set_piece_map(pieces)
 * 
 *     def _set_chess960_pos(self, sharnagl):             # <<<<<<<<<<<<<<
 *         if not 0 <= sharnagl <= 959:
 *             raise ValueError("chess960 position index not 0 <= {} <= 959".format(repr(sharnagl)))
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._set_chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XDECREF(__pyx_v_bw);
  __Pyx_XDECREF(__pyx_v_bb);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_n1);
  __Pyx_XDECREF(__pyx_v_n2);
  __Pyx_XDECREF(__pyx_v_bw_file);
  __Pyx_XDECREF(__pyx_v_bb_file);
  __Pyx_XDECREF(__pyx_v_q_file);
  __Pyx_XDECREF(__pyx_v_used);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1081
 *         self.promoted = BB_EMPTY
 * 
 *     def set_chess960_pos(self, sharnagl):             # <<<<<<<<<<<<<<
 *         """
 *         Sets up a Chess960 starting position given its index between 0 and 959.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_61set_chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_v_sharnagl); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_60set_chess960_pos[] = "\n        Sets up a Chess960 starting position given its index between 0 and 959.\n        Also see :func:`~chess.BaseBoard.from_chess960_pos()`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_61set_chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_chess960_pos (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_60set_chess960_pos(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_sharnagl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_60set_chess960_pos(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_chess960_pos", 0);

  /* "chess/__init__cp.pyx":1086
 *         Also see :func:`~chess.BaseBoard.from_chess960_pos()`.
 *         """
 *         self._set_chess960_pos(sharnagl)             # <<<<<<<<<<<<<<
 * 
 *     def chess960_pos(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_chess960_pos); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_sharnagl) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sharnagl);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1081
 *         self.promoted = BB_EMPTY
 * 
 *     def set_chess960_pos(self, sharnagl):             # <<<<<<<<<<<<<<
 *         """
 *         Sets up a Chess960 starting position given its index between 0 and 959.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.set_chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1088
 *         self._set_chess960_pos(sharnagl)
 * 
 *     def chess960_pos(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Chess960 starting position index between 0 and 959
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_63chess960_pos(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_62chess960_pos[] = "\n        Gets the Chess960 starting position index between 0 and 959\n        or ``None``.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_63chess960_pos(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("chess960_pos (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_62chess960_pos(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_62chess960_pos(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_x = NULL;
  PyObject *__pyx_v_bs1 = NULL;
  PyObject *__pyx_v_cc_pos = NULL;
  PyObject *__pyx_v_bs2 = NULL;
  PyObject *__pyx_v_q = NULL;
  int __pyx_v_qf;
  PyObject *__pyx_v_n0 = NULL;
  PyObject *__pyx_v_n1 = NULL;
  int __pyx_v_n0f;
  int __pyx_v_n1f;
  PyObject *__pyx_v_rf = NULL;
  PyObject *__pyx_v_n0s = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_bb = NULL;
  PyObject *__pyx_v_krn = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  __Pyx_RefNannySetupContext("chess960_pos", 0);

  /* "chess/__init__cp.pyx":1093
 *         or ``None``.
 *         """
 *         if self.occupied_co[WHITE] != BB_RANK_1 | BB_RANK_2:             # <<<<<<<<<<<<<<
 *             return None
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1093, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1093, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1093, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1093, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1093, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1093, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1094
 *         """
 *         if self.occupied_co[WHITE] != BB_RANK_1 | BB_RANK_2:
 *             return None             # <<<<<<<<<<<<<<
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1093
 *         or ``None``.
 *         """
 *         if self.occupied_co[WHITE] != BB_RANK_1 | BB_RANK_2:             # <<<<<<<<<<<<<<
 *             return None
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:
 */
  }

  /* "chess/__init__cp.pyx":1095
 *         if self.occupied_co[WHITE] != BB_RANK_1 | BB_RANK_2:
 *             return None
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:             # <<<<<<<<<<<<<<
 *             return None
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[0])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1095, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1095, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Or(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1095, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_2, Py_NE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1095, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1096
 *             return None
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:
 *             return None             # <<<<<<<<<<<<<<
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1095
 *         if self.occupied_co[WHITE] != BB_RANK_1 | BB_RANK_2:
 *             return None
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:             # <<<<<<<<<<<<<<
 *             return None
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:
 */
  }

  /* "chess/__init__cp.pyx":1097
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:
 *             return None
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:             # <<<<<<<<<<<<<<
 *             return None
 *         if self.promoted:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1098
 *             return None
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:
 *             return None             # <<<<<<<<<<<<<<
 *         if self.promoted:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1097
 *         if self.occupied_co[BLACK] != BB_RANK_7 | BB_RANK_8:
 *             return None
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:             # <<<<<<<<<<<<<<
 *             return None
 *         if self.promoted:
 */
  }

  /* "chess/__init__cp.pyx":1099
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:
 *             return None
 *         if self.promoted:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  __pyx_t_5 = (__pyx_v_self->promoted != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1100
 *             return None
 *         if self.promoted:
 *             return None             # <<<<<<<<<<<<<<
 * 
 *         if popcount(self.bishops) != 4:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1099
 *         if self.pawns != BB_RANK_2 | BB_RANK_7:
 *             return None
 *         if self.promoted:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  }

  /* "chess/__init__cp.pyx":1102
 *             return None
 * 
 *         if popcount(self.bishops) != 4:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.rooks) != 4:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_popcount); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_NeObjC(__pyx_t_3, __pyx_int_4, 4, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1102, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1103
 * 
 *         if popcount(self.bishops) != 4:
 *             return None             # <<<<<<<<<<<<<<
 *         if popcount(self.rooks) != 4:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1102
 *             return None
 * 
 *         if popcount(self.bishops) != 4:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.rooks) != 4:
 */
  }

  /* "chess/__init__cp.pyx":1104
 *         if popcount(self.bishops) != 4:
 *             return None
 *         if popcount(self.rooks) != 4:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.knights) != 4:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_popcount); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_NeObjC(__pyx_t_4, __pyx_int_4, 4, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1105
 *             return None
 *         if popcount(self.rooks) != 4:
 *             return None             # <<<<<<<<<<<<<<
 *         if popcount(self.knights) != 4:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1104
 *         if popcount(self.bishops) != 4:
 *             return None
 *         if popcount(self.rooks) != 4:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.knights) != 4:
 */
  }

  /* "chess/__init__cp.pyx":1106
 *         if popcount(self.rooks) != 4:
 *             return None
 *         if popcount(self.knights) != 4:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.queens) != 2:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_popcount); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_NeObjC(__pyx_t_3, __pyx_int_4, 4, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1106, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1107
 *             return None
 *         if popcount(self.knights) != 4:
 *             return None             # <<<<<<<<<<<<<<
 *         if popcount(self.queens) != 2:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1106
 *         if popcount(self.rooks) != 4:
 *             return None
 *         if popcount(self.knights) != 4:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.queens) != 2:
 */
  }

  /* "chess/__init__cp.pyx":1108
 *         if popcount(self.knights) != 4:
 *             return None
 *         if popcount(self.queens) != 2:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.kings) != 2:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_popcount); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_NeObjC(__pyx_t_4, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1108, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1109
 *             return None
 *         if popcount(self.queens) != 2:
 *             return None             # <<<<<<<<<<<<<<
 *         if popcount(self.kings) != 2:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1108
 *         if popcount(self.knights) != 4:
 *             return None
 *         if popcount(self.queens) != 2:             # <<<<<<<<<<<<<<
 *             return None
 *         if popcount(self.kings) != 2:
 */
  }

  /* "chess/__init__cp.pyx":1110
 *         if popcount(self.queens) != 2:
 *             return None
 *         if popcount(self.kings) != 2:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_popcount); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1110, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1110, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_NeObjC(__pyx_t_3, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1110, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1110, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1111
 *             return None
 *         if popcount(self.kings) != 2:
 *             return None             # <<<<<<<<<<<<<<
 * 
 *         if (BB_RANK_1 & self.knights) << 56 != BB_RANK_8 & self.knights:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1110
 *         if popcount(self.queens) != 2:
 *             return None
 *         if popcount(self.kings) != 2:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  }

  /* "chess/__init__cp.pyx":1113
 *             return None
 * 
 *         if (BB_RANK_1 & self.knights) << 56 != BB_RANK_8 & self.knights:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_56, 56, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_t_2, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1113, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1114
 * 
 *         if (BB_RANK_1 & self.knights) << 56 != BB_RANK_8 & self.knights:
 *             return None             # <<<<<<<<<<<<<<
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1113
 *             return None
 * 
 *         if (BB_RANK_1 & self.knights) << 56 != BB_RANK_8 & self.knights:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:
 */
  }

  /* "chess/__init__cp.pyx":1115
 *         if (BB_RANK_1 & self.knights) << 56 != BB_RANK_8 & self.knights:
 *             return None
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_LshiftObjC(__pyx_t_3, __pyx_int_56, 56, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_And(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1116
 *             return None
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:
 *             return None             # <<<<<<<<<<<<<<
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1115
 *         if (BB_RANK_1 & self.knights) << 56 != BB_RANK_8 & self.knights:
 *             return None
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:
 */
  }

  /* "chess/__init__cp.pyx":1117
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:
 *             return None
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_t_2, __pyx_int_56, 56, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_t_3, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1118
 *             return None
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:
 *             return None             # <<<<<<<<<<<<<<
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1117
 *         if (BB_RANK_1 & self.bishops) << 56 != BB_RANK_8 & self.bishops:
 *             return None
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:
 */
  }

  /* "chess/__init__cp.pyx":1119
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:
 *             return None
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.kings) << 56 != BB_RANK_8 & self.kings:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_LshiftObjC(__pyx_t_1, __pyx_int_56, 56, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_t_2, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1120
 *             return None
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:
 *             return None             # <<<<<<<<<<<<<<
 *         if (BB_RANK_1 & self.kings) << 56 != BB_RANK_8 & self.kings:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1119
 *         if (BB_RANK_1 & self.rooks) << 56 != BB_RANK_8 & self.rooks:
 *             return None
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:             # <<<<<<<<<<<<<<
 *             return None
 *         if (BB_RANK_1 & self.kings) << 56 != BB_RANK_8 & self.kings:
 */
  }

  /* "chess/__init__cp.pyx":1121
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:
 *             return None
 *         if (BB_RANK_1 & self.kings) << 56 != BB_RANK_8 & self.kings:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_LshiftObjC(__pyx_t_3, __pyx_int_56, 56, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_And(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1122
 *             return None
 *         if (BB_RANK_1 & self.kings) << 56 != BB_RANK_8 & self.kings:
 *             return None             # <<<<<<<<<<<<<<
 * 
 *         x = self.bishops & (2 + 8 + 32 + 128)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1121
 *         if (BB_RANK_1 & self.queens) << 56 != BB_RANK_8 & self.queens:
 *             return None
 *         if (BB_RANK_1 & self.kings) << 56 != BB_RANK_8 & self.kings:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  }

  /* "chess/__init__cp.pyx":1124
 *             return None
 * 
 *         x = self.bishops & (2 + 8 + 32 + 128)             # <<<<<<<<<<<<<<
 *         if not x:
 *             return None
 */
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->bishops & 0xAA)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_x = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1125
 * 
 *         x = self.bishops & (2 + 8 + 32 + 128)
 *         if not x:             # <<<<<<<<<<<<<<
 *             return None
 *         bs1 = (lsb(x) - 1) // 2
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_x); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1125, __pyx_L1_error)
  __pyx_t_6 = ((!__pyx_t_5) != 0);
  if (__pyx_t_6) {

    /* "chess/__init__cp.pyx":1126
 *         x = self.bishops & (2 + 8 + 32 + 128)
 *         if not x:
 *             return None             # <<<<<<<<<<<<<<
 *         bs1 = (lsb(x) - 1) // 2
 *         cc_pos = bs1
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1125
 * 
 *         x = self.bishops & (2 + 8 + 32 + 128)
 *         if not x:             # <<<<<<<<<<<<<<
 *             return None
 *         bs1 = (lsb(x) - 1) // 2
 */
  }

  /* "chess/__init__cp.pyx":1127
 *         if not x:
 *             return None
 *         bs1 = (lsb(x) - 1) // 2             # <<<<<<<<<<<<<<
 *         cc_pos = bs1
 *         x = self.bishops & (1 + 4 + 16 + 64)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_lsb); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1127, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_v_x) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_x);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1127, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1127, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_FloorDivideObjC(__pyx_t_1, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1127, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_bs1 = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1128
 *             return None
 *         bs1 = (lsb(x) - 1) // 2
 *         cc_pos = bs1             # <<<<<<<<<<<<<<
 *         x = self.bishops & (1 + 4 + 16 + 64)
 *         if not x:
 */
  __Pyx_INCREF(__pyx_v_bs1);
  __pyx_v_cc_pos = __pyx_v_bs1;

  /* "chess/__init__cp.pyx":1129
 *         bs1 = (lsb(x) - 1) // 2
 *         cc_pos = bs1
 *         x = self.bishops & (1 + 4 + 16 + 64)             # <<<<<<<<<<<<<<
 *         if not x:
 *             return None
 */
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->bishops & 85)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1129, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1130
 *         cc_pos = bs1
 *         x = self.bishops & (1 + 4 + 16 + 64)
 *         if not x:             # <<<<<<<<<<<<<<
 *             return None
 *         bs2 = lsb(x) * 2
 */
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_x); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1130, __pyx_L1_error)
  __pyx_t_5 = ((!__pyx_t_6) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1131
 *         x = self.bishops & (1 + 4 + 16 + 64)
 *         if not x:
 *             return None             # <<<<<<<<<<<<<<
 *         bs2 = lsb(x) * 2
 *         cc_pos += bs2
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1130
 *         cc_pos = bs1
 *         x = self.bishops & (1 + 4 + 16 + 64)
 *         if not x:             # <<<<<<<<<<<<<<
 *             return None
 *         bs2 = lsb(x) * 2
 */
  }

  /* "chess/__init__cp.pyx":1132
 *         if not x:
 *             return None
 *         bs2 = lsb(x) * 2             # <<<<<<<<<<<<<<
 *         cc_pos += bs2
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_lsb); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_v_x) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_x);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Multiply(__pyx_t_4, __pyx_int_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_bs2 = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1133
 *             return None
 *         bs2 = lsb(x) * 2
 *         cc_pos += bs2             # <<<<<<<<<<<<<<
 * 
 *         # Algorithm from ChessX, src/database/bitboard.cpp, r2254.
 */
  __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_cc_pos, __pyx_v_bs2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF_SET(__pyx_v_cc_pos, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1136
 * 
 *         # Algorithm from ChessX, src/database/bitboard.cpp, r2254.
 *         q = 0             # <<<<<<<<<<<<<<
 *         qf = False
 *         n0 = 0
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_q = __pyx_int_0;

  /* "chess/__init__cp.pyx":1137
 *         # Algorithm from ChessX, src/database/bitboard.cpp, r2254.
 *         q = 0
 *         qf = False             # <<<<<<<<<<<<<<
 *         n0 = 0
 *         n1 = 0
 */
  __pyx_v_qf = 0;

  /* "chess/__init__cp.pyx":1138
 *         q = 0
 *         qf = False
 *         n0 = 0             # <<<<<<<<<<<<<<
 *         n1 = 0
 *         n0f = False
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_n0 = __pyx_int_0;

  /* "chess/__init__cp.pyx":1139
 *         qf = False
 *         n0 = 0
 *         n1 = 0             # <<<<<<<<<<<<<<
 *         n0f = False
 *         n1f = False
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_n1 = __pyx_int_0;

  /* "chess/__init__cp.pyx":1140
 *         n0 = 0
 *         n1 = 0
 *         n0f = False             # <<<<<<<<<<<<<<
 *         n1f = False
 *         rf = 0
 */
  __pyx_v_n0f = 0;

  /* "chess/__init__cp.pyx":1141
 *         n1 = 0
 *         n0f = False
 *         n1f = False             # <<<<<<<<<<<<<<
 *         rf = 0
 *         n0s = [0, 4, 7, 9]
 */
  __pyx_v_n1f = 0;

  /* "chess/__init__cp.pyx":1142
 *         n0f = False
 *         n1f = False
 *         rf = 0             # <<<<<<<<<<<<<<
 *         n0s = [0, 4, 7, 9]
 *         for square in range(A1, H1 + 1):
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_rf = __pyx_int_0;

  /* "chess/__init__cp.pyx":1143
 *         n1f = False
 *         rf = 0
 *         n0s = [0, 4, 7, 9]             # <<<<<<<<<<<<<<
 *         for square in range(A1, H1 + 1):
 *             bb = BB_SQUARES[square]
 */
  __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1143, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
  __Pyx_INCREF(__pyx_int_4);
  __Pyx_GIVEREF(__pyx_int_4);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_4);
  __Pyx_INCREF(__pyx_int_7);
  __Pyx_GIVEREF(__pyx_int_7);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_7);
  __Pyx_INCREF(__pyx_int_9);
  __Pyx_GIVEREF(__pyx_int_9);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_int_9);
  __pyx_v_n0s = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1144
 *         rf = 0
 *         n0s = [0, 4, 7, 9]
 *         for square in range(A1, H1 + 1):             # <<<<<<<<<<<<<<
 *             bb = BB_SQUARES[square]
 *             if bb & self.queens:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_A1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_H1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_4 = __pyx_t_2; __Pyx_INCREF(__pyx_t_4); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1144, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1144, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1144, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1144, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1144, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1144, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_4);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1144, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1145
 *         n0s = [0, 4, 7, 9]
 *         for square in range(A1, H1 + 1):
 *             bb = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 *             if bb & self.queens:
 *                 qf = True
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1145, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1145, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_bb, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1146
 *         for square in range(A1, H1 + 1):
 *             bb = BB_SQUARES[square]
 *             if bb & self.queens:             # <<<<<<<<<<<<<<
 *                 qf = True
 *             elif bb & self.rooks or bb & self.kings:
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1146, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1146, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1146, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":1147
 *             bb = BB_SQUARES[square]
 *             if bb & self.queens:
 *                 qf = True             # <<<<<<<<<<<<<<
 *             elif bb & self.rooks or bb & self.kings:
 *                 if bb & self.kings:
 */
      __pyx_v_qf = 1;

      /* "chess/__init__cp.pyx":1146
 *         for square in range(A1, H1 + 1):
 *             bb = BB_SQUARES[square]
 *             if bb & self.queens:             # <<<<<<<<<<<<<<
 *                 qf = True
 *             elif bb & self.rooks or bb & self.kings:
 */
      goto __pyx_L21;
    }

    /* "chess/__init__cp.pyx":1148
 *             if bb & self.queens:
 *                 qf = True
 *             elif bb & self.rooks or bb & self.kings:             # <<<<<<<<<<<<<<
 *                 if bb & self.kings:
 *                     if rf != 1:
 */
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!__pyx_t_6) {
    } else {
      __pyx_t_5 = __pyx_t_6;
      goto __pyx_L22_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __pyx_t_6;
    __pyx_L22_bool_binop_done:;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":1149
 *                 qf = True
 *             elif bb & self.rooks or bb & self.kings:
 *                 if bb & self.kings:             # <<<<<<<<<<<<<<
 *                     if rf != 1:
 *                         return None
 */
      __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyNumber_And(__pyx_v_bb, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1149, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1150
 *             elif bb & self.rooks or bb & self.kings:
 *                 if bb & self.kings:
 *                     if rf != 1:             # <<<<<<<<<<<<<<
 *                         return None
 *                 else:
 */
        __pyx_t_1 = __Pyx_PyInt_NeObjC(__pyx_v_rf, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1150, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1150, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_5) {

          /* "chess/__init__cp.pyx":1151
 *                 if bb & self.kings:
 *                     if rf != 1:
 *                         return None             # <<<<<<<<<<<<<<
 *                 else:
 *                     rf += 1
 */
          __Pyx_XDECREF(__pyx_r);
          __pyx_r = Py_None; __Pyx_INCREF(Py_None);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L0;

          /* "chess/__init__cp.pyx":1150
 *             elif bb & self.rooks or bb & self.kings:
 *                 if bb & self.kings:
 *                     if rf != 1:             # <<<<<<<<<<<<<<
 *                         return None
 *                 else:
 */
        }

        /* "chess/__init__cp.pyx":1149
 *                 qf = True
 *             elif bb & self.rooks or bb & self.kings:
 *                 if bb & self.kings:             # <<<<<<<<<<<<<<
 *                     if rf != 1:
 *                         return None
 */
        goto __pyx_L24;
      }

      /* "chess/__init__cp.pyx":1153
 *                         return None
 *                 else:
 *                     rf += 1             # <<<<<<<<<<<<<<
 * 
 *                 if not qf:
 */
      /*else*/ {
        __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_rf, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1153, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_rf, __pyx_t_1);
        __pyx_t_1 = 0;
      }
      __pyx_L24:;

      /* "chess/__init__cp.pyx":1155
 *                     rf += 1
 * 
 *                 if not qf:             # <<<<<<<<<<<<<<
 *                     q += 1
 * 
 */
      __pyx_t_5 = ((!(__pyx_v_qf != 0)) != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1156
 * 
 *                 if not qf:
 *                     q += 1             # <<<<<<<<<<<<<<
 * 
 *                 if not n0f:
 */
        __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_q, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1156, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_q, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":1155
 *                     rf += 1
 * 
 *                 if not qf:             # <<<<<<<<<<<<<<
 *                     q += 1
 * 
 */
      }

      /* "chess/__init__cp.pyx":1158
 *                     q += 1
 * 
 *                 if not n0f:             # <<<<<<<<<<<<<<
 *                     n0 += 1
 *                 elif not n1f:
 */
      __pyx_t_5 = ((!(__pyx_v_n0f != 0)) != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1159
 * 
 *                 if not n0f:
 *                     n0 += 1             # <<<<<<<<<<<<<<
 *                 elif not n1f:
 *                     n1 += 1
 */
        __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_n0, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1159, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_n0, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":1158
 *                     q += 1
 * 
 *                 if not n0f:             # <<<<<<<<<<<<<<
 *                     n0 += 1
 *                 elif not n1f:
 */
        goto __pyx_L27;
      }

      /* "chess/__init__cp.pyx":1160
 *                 if not n0f:
 *                     n0 += 1
 *                 elif not n1f:             # <<<<<<<<<<<<<<
 *                     n1 += 1
 *             elif bb & self.knights:
 */
      __pyx_t_5 = ((!(__pyx_v_n1f != 0)) != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1161
 *                     n0 += 1
 *                 elif not n1f:
 *                     n1 += 1             # <<<<<<<<<<<<<<
 *             elif bb & self.knights:
 *                 if not qf:
 */
        __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_n1, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1161, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_n1, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":1160
 *                 if not n0f:
 *                     n0 += 1
 *                 elif not n1f:             # <<<<<<<<<<<<<<
 *                     n1 += 1
 *             elif bb & self.knights:
 */
      }
      __pyx_L27:;

      /* "chess/__init__cp.pyx":1148
 *             if bb & self.queens:
 *                 qf = True
 *             elif bb & self.rooks or bb & self.kings:             # <<<<<<<<<<<<<<
 *                 if bb & self.kings:
 *                     if rf != 1:
 */
      goto __pyx_L21;
    }

    /* "chess/__init__cp.pyx":1162
 *                 elif not n1f:
 *                     n1 += 1
 *             elif bb & self.knights:             # <<<<<<<<<<<<<<
 *                 if not qf:
 *                     q += 1
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_v_bb, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1162, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":1163
 *                     n1 += 1
 *             elif bb & self.knights:
 *                 if not qf:             # <<<<<<<<<<<<<<
 *                     q += 1
 * 
 */
      __pyx_t_5 = ((!(__pyx_v_qf != 0)) != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1164
 *             elif bb & self.knights:
 *                 if not qf:
 *                     q += 1             # <<<<<<<<<<<<<<
 * 
 *                 if not n0f:
 */
        __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_q, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1164, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF_SET(__pyx_v_q, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "chess/__init__cp.pyx":1163
 *                     n1 += 1
 *             elif bb & self.knights:
 *                 if not qf:             # <<<<<<<<<<<<<<
 *                     q += 1
 * 
 */
      }

      /* "chess/__init__cp.pyx":1166
 *                     q += 1
 * 
 *                 if not n0f:             # <<<<<<<<<<<<<<
 *                     n0f = True
 *                 elif not n1f:
 */
      __pyx_t_5 = ((!(__pyx_v_n0f != 0)) != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1167
 * 
 *                 if not n0f:
 *                     n0f = True             # <<<<<<<<<<<<<<
 *                 elif not n1f:
 *                     n1f = True
 */
        __pyx_v_n0f = 1;

        /* "chess/__init__cp.pyx":1166
 *                     q += 1
 * 
 *                 if not n0f:             # <<<<<<<<<<<<<<
 *                     n0f = True
 *                 elif not n1f:
 */
        goto __pyx_L29;
      }

      /* "chess/__init__cp.pyx":1168
 *                 if not n0f:
 *                     n0f = True
 *                 elif not n1f:             # <<<<<<<<<<<<<<
 *                     n1f = True
 * 
 */
      __pyx_t_5 = ((!(__pyx_v_n1f != 0)) != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":1169
 *                     n0f = True
 *                 elif not n1f:
 *                     n1f = True             # <<<<<<<<<<<<<<
 * 
 *         if n0 < 4 and n1f and qf:
 */
        __pyx_v_n1f = 1;

        /* "chess/__init__cp.pyx":1168
 *                 if not n0f:
 *                     n0f = True
 *                 elif not n1f:             # <<<<<<<<<<<<<<
 *                     n1f = True
 * 
 */
      }
      __pyx_L29:;

      /* "chess/__init__cp.pyx":1162
 *                 elif not n1f:
 *                     n1 += 1
 *             elif bb & self.knights:             # <<<<<<<<<<<<<<
 *                 if not qf:
 *                     q += 1
 */
    }
    __pyx_L21:;

    /* "chess/__init__cp.pyx":1144
 *         rf = 0
 *         n0s = [0, 4, 7, 9]
 *         for square in range(A1, H1 + 1):             # <<<<<<<<<<<<<<
 *             bb = BB_SQUARES[square]
 *             if bb & self.queens:
 */
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1171
 *                     n1f = True
 * 
 *         if n0 < 4 and n1f and qf:             # <<<<<<<<<<<<<<
 *             cc_pos += q * 16
 *             krn = n0s[n0] + n1
 */
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_n0, __pyx_int_4, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1171, __pyx_L1_error)
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1171, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L31_bool_binop_done;
  }
  __pyx_t_6 = (__pyx_v_n1f != 0);
  if (__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L31_bool_binop_done;
  }
  __pyx_t_6 = (__pyx_v_qf != 0);
  __pyx_t_5 = __pyx_t_6;
  __pyx_L31_bool_binop_done:;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1172
 * 
 *         if n0 < 4 and n1f and qf:
 *             cc_pos += q * 16             # <<<<<<<<<<<<<<
 *             krn = n0s[n0] + n1
 *             cc_pos += krn * 96
 */
    __pyx_t_4 = PyNumber_Multiply(__pyx_v_q, __pyx_int_16); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1172, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_cc_pos, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1172, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_cc_pos, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1173
 *         if n0 < 4 and n1f and qf:
 *             cc_pos += q * 16
 *             krn = n0s[n0] + n1             # <<<<<<<<<<<<<<
 *             cc_pos += krn * 96
 *             return cc_pos
 */
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_n0s, __pyx_v_n0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_v_n1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_krn = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":1174
 *             cc_pos += q * 16
 *             krn = n0s[n0] + n1
 *             cc_pos += krn * 96             # <<<<<<<<<<<<<<
 *             return cc_pos
 *         else:
 */
    __pyx_t_4 = PyNumber_Multiply(__pyx_v_krn, __pyx_int_96); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1174, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_cc_pos, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1174, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_cc_pos, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1175
 *             krn = n0s[n0] + n1
 *             cc_pos += krn * 96
 *             return cc_pos             # <<<<<<<<<<<<<<
 *         else:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_cc_pos);
    __pyx_r = __pyx_v_cc_pos;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1171
 *                     n1f = True
 * 
 *         if n0 < 4 and n1f and qf:             # <<<<<<<<<<<<<<
 *             cc_pos += q * 16
 *             krn = n0s[n0] + n1
 */
  }

  /* "chess/__init__cp.pyx":1177
 *             return cc_pos
 *         else:
 *             return None             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":1088
 *         self._set_chess960_pos(sharnagl)
 * 
 *     def chess960_pos(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Chess960 starting position index between 0 and 959
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_bs1);
  __Pyx_XDECREF(__pyx_v_cc_pos);
  __Pyx_XDECREF(__pyx_v_bs2);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_n0);
  __Pyx_XDECREF(__pyx_v_n1);
  __Pyx_XDECREF(__pyx_v_rf);
  __Pyx_XDECREF(__pyx_v_n0s);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_bb);
  __Pyx_XDECREF(__pyx_v_krn);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1179
 *             return None
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "{}('{}')".format(type(self).__name__, self.board_fen())
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_65__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_65__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_64__repr__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_64__repr__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "chess/__init__cp.pyx":1180
 * 
 *     def __repr__(self):
 *         return "{}('{}')".format(type(self).__name__, self.board_fen())             # <<<<<<<<<<<<<<
 * 
 *     def __str__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__15, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1180, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_n_s_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1180, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board_fen); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1180, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1180, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1180, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1180, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1180, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_7, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_7, __pyx_t_4);
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1180, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1179
 *             return None
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "{}('{}')".format(type(self).__name__, self.board_fen())
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1182
 *         return "{}('{}')".format(type(self).__name__, self.board_fen())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 *         print("_+_+_+_+_+_+_+_+_+_+_")
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_67__str__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_67__str__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_66__str__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_66__str__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_builder = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__str__", 0);

  /* "chess/__init__cp.pyx":1183
 * 
 *     def __str__(self):
 *         builder = []             # <<<<<<<<<<<<<<
 *         print("_+_+_+_+_+_+_+_+_+_+_")
 *         print(SQUARES_180)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1183, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1184
 *     def __str__(self):
 *         builder = []
 *         print("_+_+_+_+_+_+_+_+_+_+_")             # <<<<<<<<<<<<<<
 *         print(SQUARES_180)
 *         for square in SQUARES_180:
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1185
 *         builder = []
 *         print("_+_+_+_+_+_+_+_+_+_+_")
 *         print(SQUARES_180)             # <<<<<<<<<<<<<<
 *         for square in SQUARES_180:
 *             print(square)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARES_180); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1185, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1185, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1186
 *         print("_+_+_+_+_+_+_+_+_+_+_")
 *         print(SQUARES_180)
 *         for square in SQUARES_180:             # <<<<<<<<<<<<<<
 *             print(square)
 *             piece = self.piece_at(square)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SQUARES_180); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1186, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1186, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 1186, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1186, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 1186, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1186, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1186, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1187
 *         print(SQUARES_180)
 *         for square in SQUARES_180:
 *             print(square)             # <<<<<<<<<<<<<<
 *             piece = self.piece_at(square)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1187, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1188
 *         for square in SQUARES_180:
 *             print(square)
 *             piece = self.piece_at(square)             # <<<<<<<<<<<<<<
 * 
 *             if piece:
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_at); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_piece, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1190
 *             piece = self.piece_at(square)
 * 
 *             if piece:             # <<<<<<<<<<<<<<
 *                 builder.append(piece.symbol())
 *             else:
 */
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_piece); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1190, __pyx_L1_error)
    if (__pyx_t_7) {

      /* "chess/__init__cp.pyx":1191
 * 
 *             if piece:
 *                 builder.append(piece.symbol())             # <<<<<<<<<<<<<<
 *             else:
 *                 builder.append(".")
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_symbol); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1191, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1191, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_2); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 1191, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":1190
 *             piece = self.piece_at(square)
 * 
 *             if piece:             # <<<<<<<<<<<<<<
 *                 builder.append(piece.symbol())
 *             else:
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":1193
 *                 builder.append(piece.symbol())
 *             else:
 *                 builder.append(".")             # <<<<<<<<<<<<<<
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:
 */
    /*else*/ {
      __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__18); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 1193, __pyx_L1_error)
    }
    __pyx_L5:;

    /* "chess/__init__cp.pyx":1195
 *                 builder.append(".")
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:             # <<<<<<<<<<<<<<
 *                 if square != H1:
 *                     builder.append("\n")
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1195, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_7) {

      /* "chess/__init__cp.pyx":1196
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:
 *                 if square != H1:             # <<<<<<<<<<<<<<
 *                     builder.append("\n")
 *             else:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_H1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1196, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_2 = PyObject_RichCompare(__pyx_v_square, __pyx_t_6, Py_NE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1196, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1196, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1197
 *             if BB_SQUARES[square] & BB_FILE_H:
 *                 if square != H1:
 *                     builder.append("\n")             # <<<<<<<<<<<<<<
 *             else:
 *                 builder.append(" ")
 */
        __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__19); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 1197, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1196
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:
 *                 if square != H1:             # <<<<<<<<<<<<<<
 *                     builder.append("\n")
 *             else:
 */
      }

      /* "chess/__init__cp.pyx":1195
 *                 builder.append(".")
 * 
 *             if BB_SQUARES[square] & BB_FILE_H:             # <<<<<<<<<<<<<<
 *                 if square != H1:
 *                     builder.append("\n")
 */
      goto __pyx_L6;
    }

    /* "chess/__init__cp.pyx":1199
 *                     builder.append("\n")
 *             else:
 *                 builder.append(" ")             # <<<<<<<<<<<<<<
 * 
 *         return "".join(builder)
 */
    /*else*/ {
      __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__14); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 1199, __pyx_L1_error)
    }
    __pyx_L6:;

    /* "chess/__init__cp.pyx":1186
 *         print("_+_+_+_+_+_+_+_+_+_+_")
 *         print(SQUARES_180)
 *         for square in SQUARES_180:             # <<<<<<<<<<<<<<
 *             print(square)
 *             piece = self.piece_at(square)
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1201
 *                 builder.append(" ")
 * 
 *         return "".join(builder)             # <<<<<<<<<<<<<<
 * 
 *     def unicode(self, *, invert_color=False, borders=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_builder); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1201, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1182
 *         return "{}('{}')".format(type(self).__name__, self.board_fen())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 *         print("_+_+_+_+_+_+_+_+_+_+_")
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1203
 *         return "".join(builder)
 * 
 *     def unicode(self, *, invert_color=False, borders=False):             # <<<<<<<<<<<<<<
 *         """
 *         Returns a string representation of the board with Unicode pieces.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_69unicode(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_68unicode[] = "\n        Returns a string representation of the board with Unicode pieces.\n        Useful for pretty-printing to a terminal.\n\n        :param invert_color: Invert color of the Unicode pieces.\n        :param borders: Show borders and a coordinate margin.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_69unicode(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_invert_color = 0;
  PyObject *__pyx_v_borders = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("unicode (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_invert_color,&__pyx_n_s_borders,0};
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)Py_False);
    values[1] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args > 0 && likely(kw_args <= 2)) {
        Py_ssize_t index;
        for (index = 0; index < 2 && kw_args > 0; index++) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
          if (value) { values[index] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "unicode") < 0)) __PYX_ERR(0, 1203, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_invert_color = values[0];
    __pyx_v_borders = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("unicode", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1203, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.unicode", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_68unicode(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), __pyx_v_invert_color, __pyx_v_borders);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_68unicode(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_invert_color, PyObject *__pyx_v_borders) {
  PyObject *__pyx_v_builder = NULL;
  long __pyx_v_rank_index;
  long __pyx_v_file_index;
  PyObject *__pyx_v_square_index = NULL;
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  long __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  long __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  int __pyx_t_12;
  __Pyx_RefNannySetupContext("unicode", 0);

  /* "chess/__init__cp.pyx":1211
 *         :param borders: Show borders and a coordinate margin.
 *         """
 *         builder = []             # <<<<<<<<<<<<<<
 *         for rank_index in range(7, -1, -1):
 *             if borders:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1212
 *         """
 *         builder = []
 *         for rank_index in range(7, -1, -1):             # <<<<<<<<<<<<<<
 *             if borders:
 *                 builder.append("  ")
 */
  for (__pyx_t_2 = 7; __pyx_t_2 > -1L; __pyx_t_2-=1) {
    __pyx_v_rank_index = __pyx_t_2;

    /* "chess/__init__cp.pyx":1213
 *         builder = []
 *         for rank_index in range(7, -1, -1):
 *             if borders:             # <<<<<<<<<<<<<<
 *                 builder.append("  ")
 *                 builder.append("-" * 17)
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_borders); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1213, __pyx_L1_error)
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":1214
 *         for rank_index in range(7, -1, -1):
 *             if borders:
 *                 builder.append("  ")             # <<<<<<<<<<<<<<
 *                 builder.append("-" * 17)
 *                 builder.append("\n")
 */
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__20); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1214, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1215
 *             if borders:
 *                 builder.append("  ")
 *                 builder.append("-" * 17)             # <<<<<<<<<<<<<<
 *                 builder.append("\n")
 * 
 */
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__21); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1215, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1216
 *                 builder.append("  ")
 *                 builder.append("-" * 17)
 *                 builder.append("\n")             # <<<<<<<<<<<<<<
 * 
 *                 builder.append(RANK_NAMES[rank_index])
 */
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__19); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1216, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1218
 *                 builder.append("\n")
 * 
 *                 builder.append(RANK_NAMES[rank_index])             # <<<<<<<<<<<<<<
 *                 builder.append(" ")
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_RANK_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_rank_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_5); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1218, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":1219
 * 
 *                 builder.append(RANK_NAMES[rank_index])
 *                 builder.append(" ")             # <<<<<<<<<<<<<<
 * 
 *             for file_index in range(8):
 */
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__14); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1219, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1213
 *         builder = []
 *         for rank_index in range(7, -1, -1):
 *             if borders:             # <<<<<<<<<<<<<<
 *                 builder.append("  ")
 *                 builder.append("-" * 17)
 */
    }

    /* "chess/__init__cp.pyx":1221
 *                 builder.append(" ")
 * 
 *             for file_index in range(8):             # <<<<<<<<<<<<<<
 *                 square_index = square(file_index, rank_index)
 * 
 */
    for (__pyx_t_6 = 0; __pyx_t_6 < 8; __pyx_t_6+=1) {
      __pyx_v_file_index = __pyx_t_6;

      /* "chess/__init__cp.pyx":1222
 * 
 *             for file_index in range(8):
 *                 square_index = square(file_index, rank_index)             # <<<<<<<<<<<<<<
 * 
 *                 if borders:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = __Pyx_PyInt_From_long(__pyx_v_file_index); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = __Pyx_PyInt_From_long(__pyx_v_rank_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = NULL;
      __pyx_t_10 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_10 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_7, __pyx_t_8};
        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1222, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_7, __pyx_t_8};
        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1222, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      } else
      #endif
      {
        __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1222, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        if (__pyx_t_9) {
          __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_t_8);
        __pyx_t_7 = 0;
        __pyx_t_8 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1222, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_square_index, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":1224
 *                 square_index = square(file_index, rank_index)
 * 
 *                 if borders:             # <<<<<<<<<<<<<<
 *                     builder.append("|")
 *                 elif file_index > 0:
 */
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_borders); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1224, __pyx_L1_error)
      if (__pyx_t_3) {

        /* "chess/__init__cp.pyx":1225
 * 
 *                 if borders:
 *                     builder.append("|")             # <<<<<<<<<<<<<<
 *                 elif file_index > 0:
 *                     builder.append(" ")
 */
        __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__22); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1225, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1224
 *                 square_index = square(file_index, rank_index)
 * 
 *                 if borders:             # <<<<<<<<<<<<<<
 *                     builder.append("|")
 *                 elif file_index > 0:
 */
        goto __pyx_L8;
      }

      /* "chess/__init__cp.pyx":1226
 *                 if borders:
 *                     builder.append("|")
 *                 elif file_index > 0:             # <<<<<<<<<<<<<<
 *                     builder.append(" ")
 * 
 */
      __pyx_t_3 = ((__pyx_v_file_index > 0) != 0);
      if (__pyx_t_3) {

        /* "chess/__init__cp.pyx":1227
 *                     builder.append("|")
 *                 elif file_index > 0:
 *                     builder.append(" ")             # <<<<<<<<<<<<<<
 * 
 *                 piece = self.piece_at(square_index)
 */
        __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__14); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1227, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1226
 *                 if borders:
 *                     builder.append("|")
 *                 elif file_index > 0:             # <<<<<<<<<<<<<<
 *                     builder.append(" ")
 * 
 */
      }
      __pyx_L8:;

      /* "chess/__init__cp.pyx":1229
 *                     builder.append(" ")
 * 
 *                 piece = self.piece_at(square_index)             # <<<<<<<<<<<<<<
 * 
 *                 if piece:
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_at); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_11 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_5 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_11, __pyx_v_square_index) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_square_index);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_piece, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":1231
 *                 piece = self.piece_at(square_index)
 * 
 *                 if piece:             # <<<<<<<<<<<<<<
 *                     builder.append(piece.unicode_symbol(invert_color=invert_color))
 *                 else:
 */
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_piece); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1231, __pyx_L1_error)
      if (__pyx_t_3) {

        /* "chess/__init__cp.pyx":1232
 * 
 *                 if piece:
 *                     builder.append(piece.unicode_symbol(invert_color=invert_color))             # <<<<<<<<<<<<<<
 *                 else:
 *                     builder.append(u"")
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_piece, __pyx_n_s_unicode_symbol); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1232, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1232, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_invert_color, __pyx_v_invert_color) < 0) __PYX_ERR(0, 1232, __pyx_L1_error)
        __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1232, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_11); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1232, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

        /* "chess/__init__cp.pyx":1231
 *                 piece = self.piece_at(square_index)
 * 
 *                 if piece:             # <<<<<<<<<<<<<<
 *                     builder.append(piece.unicode_symbol(invert_color=invert_color))
 *                 else:
 */
        goto __pyx_L9;
      }

      /* "chess/__init__cp.pyx":1234
 *                     builder.append(piece.unicode_symbol(invert_color=invert_color))
 *                 else:
 *                     builder.append(u"")             # <<<<<<<<<<<<<<
 * 
 *             if borders:
 */
      /*else*/ {
        __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__23); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1234, __pyx_L1_error)
      }
      __pyx_L9:;
    }

    /* "chess/__init__cp.pyx":1236
 *                     builder.append(u"")
 * 
 *             if borders:             # <<<<<<<<<<<<<<
 *                 builder.append("|")
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_borders); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1236, __pyx_L1_error)
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":1237
 * 
 *             if borders:
 *                 builder.append("|")             # <<<<<<<<<<<<<<
 * 
 *             if borders or rank_index > 0:
 */
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__22); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1237, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1236
 *                     builder.append(u"")
 * 
 *             if borders:             # <<<<<<<<<<<<<<
 *                 builder.append("|")
 * 
 */
    }

    /* "chess/__init__cp.pyx":1239
 *                 builder.append("|")
 * 
 *             if borders or rank_index > 0:             # <<<<<<<<<<<<<<
 *                 builder.append("\n")
 * 
 */
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_borders); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1239, __pyx_L1_error)
    if (!__pyx_t_12) {
    } else {
      __pyx_t_3 = __pyx_t_12;
      goto __pyx_L12_bool_binop_done;
    }
    __pyx_t_12 = ((__pyx_v_rank_index > 0) != 0);
    __pyx_t_3 = __pyx_t_12;
    __pyx_L12_bool_binop_done:;
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":1240
 * 
 *             if borders or rank_index > 0:
 *                 builder.append("\n")             # <<<<<<<<<<<<<<
 * 
 *         if borders:
 */
      __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__19); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1240, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1239
 *                 builder.append("|")
 * 
 *             if borders or rank_index > 0:             # <<<<<<<<<<<<<<
 *                 builder.append("\n")
 * 
 */
    }
  }

  /* "chess/__init__cp.pyx":1242
 *                 builder.append("\n")
 * 
 *         if borders:             # <<<<<<<<<<<<<<
 *             builder.append("  ")
 *             builder.append("-" * 17)
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_borders); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1242, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":1243
 * 
 *         if borders:
 *             builder.append("  ")             # <<<<<<<<<<<<<<
 *             builder.append("-" * 17)
 *             builder.append("\n")
 */
    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__20); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1243, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1244
 *         if borders:
 *             builder.append("  ")
 *             builder.append("-" * 17)             # <<<<<<<<<<<<<<
 *             builder.append("\n")
 *             builder.append("   a b c d e f g h")
 */
    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__21); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1244, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1245
 *             builder.append("  ")
 *             builder.append("-" * 17)
 *             builder.append("\n")             # <<<<<<<<<<<<<<
 *             builder.append("   a b c d e f g h")
 * 
 */
    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__19); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1245, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1246
 *             builder.append("-" * 17)
 *             builder.append("\n")
 *             builder.append("   a b c d e f g h")             # <<<<<<<<<<<<<<
 * 
 *         return "".join(builder)
 */
    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u_a_b_c_d_e_f_g_h); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 1246, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1242
 *                 builder.append("\n")
 * 
 *         if borders:             # <<<<<<<<<<<<<<
 *             builder.append("  ")
 *             builder.append("-" * 17)
 */
  }

  /* "chess/__init__cp.pyx":1248
 *             builder.append("   a b c d e f g h")
 * 
 *         return "".join(builder)             # <<<<<<<<<<<<<<
 * 
 *     def _repr_svg_(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_11 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_builder); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1248, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1203
 *         return "".join(builder)
 * 
 *     def unicode(self, *, invert_color=False, borders=False):             # <<<<<<<<<<<<<<
 *         """
 *         Returns a string representation of the board with Unicode pieces.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.unicode", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_square_index);
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1250
 *         return "".join(builder)
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.board(board=self, size=400)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_71_repr_svg_(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_71_repr_svg_(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_repr_svg_ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_70_repr_svg_(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_70_repr_svg_(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_chess = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("_repr_svg_", 0);

  /* "chess/__init__cp.pyx":1251
 * 
 *     def _repr_svg_(self):
 *         import chess.svg             # <<<<<<<<<<<<<<
 *         return chess.svg.board(board=self, size=400)
 * 
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_chess_svg, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1251, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_chess = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1252
 *     def _repr_svg_(self):
 *         import chess.svg
 *         return chess.svg.board(board=self, size=400)             # <<<<<<<<<<<<<<
 * 
 *     def __eq__(self, board):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_chess, __pyx_n_s_svg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_board, ((PyObject *)__pyx_v_self)) < 0) __PYX_ERR(0, 1252, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_size, __pyx_int_400) < 0) __PYX_ERR(0, 1252, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1250
 *         return "".join(builder)
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.board(board=self, size=400)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard._repr_svg_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_chess);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1254
 *         return chess.svg.board(board=self, size=400)
 * 
 *     def __eq__(self, board):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(board)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_73__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_board); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_73__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_72__eq__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_board));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_72__eq__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_v_ne = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("__eq__", 0);

  /* "chess/__init__cp.pyx":1255
 * 
 *     def __eq__(self, board):
 *         ne = self.__ne__(board)             # <<<<<<<<<<<<<<
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ne); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_board) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_board);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1256
 *     def __eq__(self, board):
 *         ne = self.__ne__(board)
 *         return NotImplemented if ne is NotImplemented else not ne             # <<<<<<<<<<<<<<
 * 
 *     def __ne__(self, board):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = (__pyx_v_ne == __pyx_builtin_NotImplemented);
  if ((__pyx_t_4 != 0)) {
    __Pyx_INCREF(__pyx_builtin_NotImplemented);
    __pyx_t_1 = __pyx_builtin_NotImplemented;
  } else {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_ne); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1256, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1256, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1254
 *         return chess.svg.board(board=self, size=400)
 * 
 *     def __eq__(self, board):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(board)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1258
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, board):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.occupied != board.occupied:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_75__ne__(PyObject *__pyx_v_self, PyObject *__pyx_v_board); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_75__ne__(PyObject *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ne__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_74__ne__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_board));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_74__ne__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__ne__", 0);

  /* "chess/__init__cp.pyx":1259
 * 
 *     def __ne__(self, board):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.occupied != board.occupied:
 *                 return True
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":1260
 *     def __ne__(self, board):
 *         try:
 *             if self.occupied != board.occupied:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:
 */
      __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1260, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1260, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1260, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1260, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1261
 *         try:
 *             if self.occupied != board.occupied:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1260
 *     def __ne__(self, board):
 *         try:
 *             if self.occupied != board.occupied:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:
 */
      }

      /* "chess/__init__cp.pyx":1262
 *             if self.occupied != board.occupied:
 *                 return True
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.pawns != board.pawns:
 */
      __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1262, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1262, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, 1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1262, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1262, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1262, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1263
 *                 return True
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.pawns != board.pawns:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1262
 *             if self.occupied != board.occupied:
 *                 return True
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.pawns != board.pawns:
 */
      }

      /* "chess/__init__cp.pyx":1264
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:
 *                 return True
 *             elif self.pawns != board.pawns:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.knights != board.knights:
 */
      __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1264, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_pawns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1264, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1264, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1264, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1265
 *                 return True
 *             elif self.pawns != board.pawns:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.knights != board.knights:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1264
 *             elif self.occupied_co[WHITE] != board.occupied_co[WHITE]:
 *                 return True
 *             elif self.pawns != board.pawns:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.knights != board.knights:
 */
      }

      /* "chess/__init__cp.pyx":1266
 *             elif self.pawns != board.pawns:
 *                 return True
 *             elif self.knights != board.knights:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.bishops != board.bishops:
 */
      __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1266, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_knights); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1266, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1266, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1266, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1267
 *                 return True
 *             elif self.knights != board.knights:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.bishops != board.bishops:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1266
 *             elif self.pawns != board.pawns:
 *                 return True
 *             elif self.knights != board.knights:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.bishops != board.bishops:
 */
      }

      /* "chess/__init__cp.pyx":1268
 *             elif self.knights != board.knights:
 *                 return True
 *             elif self.bishops != board.bishops:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.rooks != board.rooks:
 */
      __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1268, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_bishops); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1268, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1268, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1268, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1269
 *                 return True
 *             elif self.bishops != board.bishops:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.rooks != board.rooks:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1268
 *             elif self.knights != board.knights:
 *                 return True
 *             elif self.bishops != board.bishops:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.rooks != board.rooks:
 */
      }

      /* "chess/__init__cp.pyx":1270
 *             elif self.bishops != board.bishops:
 *                 return True
 *             elif self.rooks != board.rooks:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.queens != board.queens:
 */
      __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1270, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_rooks); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1270, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1270, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1270, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1271
 *                 return True
 *             elif self.rooks != board.rooks:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.queens != board.queens:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1270
 *             elif self.bishops != board.bishops:
 *                 return True
 *             elif self.rooks != board.rooks:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.queens != board.queens:
 */
      }

      /* "chess/__init__cp.pyx":1272
 *             elif self.rooks != board.rooks:
 *                 return True
 *             elif self.queens != board.queens:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.kings != board.kings:
 */
      __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1272, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_queens); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1272, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1272, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1272, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1273
 *                 return True
 *             elif self.queens != board.queens:
 *                 return True             # <<<<<<<<<<<<<<
 *             elif self.kings != board.kings:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1272
 *             elif self.rooks != board.rooks:
 *                 return True
 *             elif self.queens != board.queens:             # <<<<<<<<<<<<<<
 *                 return True
 *             elif self.kings != board.kings:
 */
      }

      /* "chess/__init__cp.pyx":1274
 *             elif self.queens != board.queens:
 *                 return True
 *             elif self.kings != board.kings:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
      __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1274, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_kings); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1274, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1274, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1274, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":1275
 *                 return True
 *             elif self.kings != board.kings:
 *                 return True             # <<<<<<<<<<<<<<
 *             else:
 *                 return False
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":1274
 *             elif self.queens != board.queens:
 *                 return True
 *             elif self.kings != board.kings:             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
      }

      /* "chess/__init__cp.pyx":1277
 *                 return True
 *             else:
 *                 return False             # <<<<<<<<<<<<<<
 *         except AttributeError:
 *             return NotImplemented
 */
      /*else*/ {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        goto __pyx_L7_try_return;
      }

      /* "chess/__init__cp.pyx":1259
 * 
 *     def __ne__(self, board):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.occupied != board.occupied:
 *                 return True
 */
    }
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":1278
 *             else:
 *                 return False
 *         except AttributeError:             # <<<<<<<<<<<<<<
 *             return NotImplemented
 * 
 */
    __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AttributeError);
    if (__pyx_t_8) {
      __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_4, &__pyx_t_6) < 0) __PYX_ERR(0, 1278, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_6);

      /* "chess/__init__cp.pyx":1279
 *                 return False
 *         except AttributeError:
 *             return NotImplemented             # <<<<<<<<<<<<<<
 * 
 *     def apply_transform(self, f):
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_builtin_NotImplemented);
      __pyx_r = __pyx_builtin_NotImplemented;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L6_except_return;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":1259
 * 
 *     def __ne__(self, board):
 *         try:             # <<<<<<<<<<<<<<
 *             if self.occupied != board.occupied:
 *                 return True
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L6_except_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":1258
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, board):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.occupied != board.occupied:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1281
 *             return NotImplemented
 * 
 *     def apply_transform(self, f):             # <<<<<<<<<<<<<<
 *         self.pawns = f(self.pawns)
 *         self.knights = f(self.knights)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_77apply_transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_77apply_transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("apply_transform (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_76apply_transform(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_f));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_76apply_transform(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  unsigned PY_LONG_LONG __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("apply_transform", 0);

  /* "chess/__init__cp.pyx":1282
 * 
 *     def apply_transform(self, f):
 *         self.pawns = f(self.pawns)             # <<<<<<<<<<<<<<
 *         self.knights = f(self.knights)
 *         self.bishops = f(self.bishops)
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1282, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_3 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1282, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1282, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->pawns = __pyx_t_5;

  /* "chess/__init__cp.pyx":1283
 *     def apply_transform(self, f):
 *         self.pawns = f(self.pawns)
 *         self.knights = f(self.knights)             # <<<<<<<<<<<<<<
 *         self.bishops = f(self.bishops)
 *         self.rooks = f(self.rooks)
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_2 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1283, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->knights = __pyx_t_5;

  /* "chess/__init__cp.pyx":1284
 *         self.pawns = f(self.pawns)
 *         self.knights = f(self.knights)
 *         self.bishops = f(self.bishops)             # <<<<<<<<<<<<<<
 *         self.rooks = f(self.rooks)
 *         self.queens = f(self.queens)
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1284, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_3 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1284, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1284, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->bishops = __pyx_t_5;

  /* "chess/__init__cp.pyx":1285
 *         self.knights = f(self.knights)
 *         self.bishops = f(self.bishops)
 *         self.rooks = f(self.rooks)             # <<<<<<<<<<<<<<
 *         self.queens = f(self.queens)
 *         self.kings = f(self.kings)
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1285, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_2 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1285, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1285, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->rooks = __pyx_t_5;

  /* "chess/__init__cp.pyx":1286
 *         self.bishops = f(self.bishops)
 *         self.rooks = f(self.rooks)
 *         self.queens = f(self.queens)             # <<<<<<<<<<<<<<
 *         self.kings = f(self.kings)
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_3 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1286, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->queens = __pyx_t_5;

  /* "chess/__init__cp.pyx":1287
 *         self.rooks = f(self.rooks)
 *         self.queens = f(self.queens)
 *         self.kings = f(self.kings)             # <<<<<<<<<<<<<<
 * 
 *         self.occupied_co[WHITE] = f(self.occupied_co[WHITE])
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_2 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1287, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->kings = __pyx_t_5;

  /* "chess/__init__cp.pyx":1289
 *         self.kings = f(self.kings)
 * 
 *         self.occupied_co[WHITE] = f(self.occupied_co[WHITE])             # <<<<<<<<<<<<<<
 *         self.occupied_co[BLACK] = f(self.occupied_co[BLACK])
 *         self.occupied = f(self.occupied)
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1289, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_3 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1289, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1289, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  (__pyx_v_self->occupied_co[1]) = __pyx_t_5;

  /* "chess/__init__cp.pyx":1290
 * 
 *         self.occupied_co[WHITE] = f(self.occupied_co[WHITE])
 *         self.occupied_co[BLACK] = f(self.occupied_co[BLACK])             # <<<<<<<<<<<<<<
 *         self.occupied = f(self.occupied)
 *         self.promoted = f(self.promoted)
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[0])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1290, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_2 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1290, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_5 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1290, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  (__pyx_v_self->occupied_co[0]) = __pyx_t_5;

  /* "chess/__init__cp.pyx":1291
 *         self.occupied_co[WHITE] = f(self.occupied_co[WHITE])
 *         self.occupied_co[BLACK] = f(self.occupied_co[BLACK])
 *         self.occupied = f(self.occupied)             # <<<<<<<<<<<<<<
 *         self.promoted = f(self.promoted)
 * 
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1291, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_3 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1291, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1291, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->occupied = __pyx_t_6;

  /* "chess/__init__cp.pyx":1292
 *         self.occupied_co[BLACK] = f(self.occupied_co[BLACK])
 *         self.occupied = f(self.occupied)
 *         self.promoted = f(self.promoted)             # <<<<<<<<<<<<<<
 * 
 *     def transform(self, f):
 */
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1292, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_2 = __pyx_v_f; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1292, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1292, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->promoted = __pyx_t_6;

  /* "chess/__init__cp.pyx":1281
 *             return NotImplemented
 * 
 *     def apply_transform(self, f):             # <<<<<<<<<<<<<<
 *         self.pawns = f(self.pawns)
 *         self.knights = f(self.knights)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.apply_transform", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1294
 *         self.promoted = f(self.promoted)
 * 
 *     def transform(self, f):             # <<<<<<<<<<<<<<
 *         board = self.copy()
 *         board.apply_transform(f)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_79transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_79transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("transform (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_78transform(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_f));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_78transform(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("transform", 0);

  /* "chess/__init__cp.pyx":1295
 * 
 *     def transform(self, f):
 *         board = self.copy()             # <<<<<<<<<<<<<<
 *         board.apply_transform(f)
 *         return board
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1295, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1295, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1296
 *     def transform(self, f):
 *         board = self.copy()
 *         board.apply_transform(f)             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_apply_transform); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1296, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_f) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_f);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1296, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1297
 *         board = self.copy()
 *         board.apply_transform(f)
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     def mirror(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1294
 *         self.promoted = f(self.promoted)
 * 
 *     def transform(self, f):             # <<<<<<<<<<<<<<
 *         board = self.copy()
 *         board.apply_transform(f)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.transform", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1299
 *         return board
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         """
 *         Returns a mirrored copy of the board.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_81mirror(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_80mirror[] = "\n        Returns a mirrored copy of the board.\n\n        The board is mirrored vertically and piece colors are swapped, so that\n        the position is equivalent modulo color.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_81mirror(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_80mirror(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_80mirror(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("mirror", 0);

  /* "chess/__init__cp.pyx":1306
 *         the position is equivalent modulo color.
 *         """
 *         board = self.transform(flip_vertical)             # <<<<<<<<<<<<<<
 *         board.occupied_co[WHITE], board.occupied_co[BLACK] = board.occupied_co[BLACK], board.occupied_co[WHITE]
 *         return board
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transform); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1306, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_flip_vertical); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1306, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1306, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1307
 *         """
 *         board = self.transform(flip_vertical)
 *         board.occupied_co[WHITE], board.occupied_co[BLACK] = board.occupied_co[BLACK], board.occupied_co[WHITE]             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(__Pyx_SetItemInt(__pyx_t_1, 1, __pyx_t_2, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1) < 0)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(__Pyx_SetItemInt(__pyx_t_2, 0, __pyx_t_3, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1) < 0)) __PYX_ERR(0, 1307, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":1308
 *         board = self.transform(flip_vertical)
 *         board.occupied_co[WHITE], board.occupied_co[BLACK] = board.occupied_co[BLACK], board.occupied_co[WHITE]
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     def copy(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1299
 *         return board
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         """
 *         Returns a mirrored copy of the board.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.mirror", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1310
 *         return board
 * 
 *     def copy(self):             # <<<<<<<<<<<<<<
 *         """Creates a copy of the board."""
 *         board = type(self)(None)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_83copy(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_82copy[] = "Creates a copy of the board.";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_83copy(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("copy (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_82copy(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_82copy(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("copy", 0);

  /* "chess/__init__cp.pyx":1312
 *     def copy(self):
 *         """Creates a copy of the board."""
 *         board = type(self)(None)             # <<<<<<<<<<<<<<
 * 
 *         board.pawns = self.pawns
 */
  __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
  __pyx_t_2 = ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))); __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, Py_None) : __Pyx_PyObject_CallOneArg(__pyx_t_2, Py_None);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1312, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1314
 *         board = type(self)(None)
 * 
 *         board.pawns = self.pawns             # <<<<<<<<<<<<<<
 *         board.knights = self.knights
 *         board.bishops = self.bishops
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_pawns, __pyx_t_1) < 0) __PYX_ERR(0, 1314, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1315
 * 
 *         board.pawns = self.pawns
 *         board.knights = self.knights             # <<<<<<<<<<<<<<
 *         board.bishops = self.bishops
 *         board.rooks = self.rooks
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_knights, __pyx_t_1) < 0) __PYX_ERR(0, 1315, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1316
 *         board.pawns = self.pawns
 *         board.knights = self.knights
 *         board.bishops = self.bishops             # <<<<<<<<<<<<<<
 *         board.rooks = self.rooks
 *         board.queens = self.queens
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1316, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_bishops, __pyx_t_1) < 0) __PYX_ERR(0, 1316, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1317
 *         board.knights = self.knights
 *         board.bishops = self.bishops
 *         board.rooks = self.rooks             # <<<<<<<<<<<<<<
 *         board.queens = self.queens
 *         board.kings = self.kings
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_rooks, __pyx_t_1) < 0) __PYX_ERR(0, 1317, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1318
 *         board.bishops = self.bishops
 *         board.rooks = self.rooks
 *         board.queens = self.queens             # <<<<<<<<<<<<<<
 *         board.kings = self.kings
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_queens, __pyx_t_1) < 0) __PYX_ERR(0, 1318, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1319
 *         board.rooks = self.rooks
 *         board.queens = self.queens
 *         board.kings = self.kings             # <<<<<<<<<<<<<<
 * 
 *         board.occupied_co[WHITE] = self.occupied_co[WHITE]
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_kings, __pyx_t_1) < 0) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1321
 *         board.kings = self.kings
 * 
 *         board.occupied_co[WHITE] = self.occupied_co[WHITE]             # <<<<<<<<<<<<<<
 *         board.occupied_co[BLACK] = self.occupied_co[BLACK]
 *         board.occupied = self.occupied
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[1])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(__Pyx_SetItemInt(__pyx_t_2, 1, __pyx_t_1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1) < 0)) __PYX_ERR(0, 1321, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1322
 * 
 *         board.occupied_co[WHITE] = self.occupied_co[WHITE]
 *         board.occupied_co[BLACK] = self.occupied_co[BLACK]             # <<<<<<<<<<<<<<
 *         board.occupied = self.occupied
 *         board.promoted = self.promoted
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->occupied_co[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(__Pyx_SetItemInt(__pyx_t_2, 0, __pyx_t_1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1) < 0)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1323
 *         board.occupied_co[WHITE] = self.occupied_co[WHITE]
 *         board.occupied_co[BLACK] = self.occupied_co[BLACK]
 *         board.occupied = self.occupied             # <<<<<<<<<<<<<<
 *         board.promoted = self.promoted
 * 
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_occupied, __pyx_t_1) < 0) __PYX_ERR(0, 1323, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1324
 *         board.occupied_co[BLACK] = self.occupied_co[BLACK]
 *         board.occupied = self.occupied
 *         board.promoted = self.promoted             # <<<<<<<<<<<<<<
 * 
 *         return board
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_promoted, __pyx_t_1) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1326
 *         board.promoted = self.promoted
 * 
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     def __copy__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1310
 *         return board
 * 
 *     def copy(self):             # <<<<<<<<<<<<<<
 *         """Creates a copy of the board."""
 *         board = type(self)(None)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.copy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1328
 *         return board
 * 
 *     def __copy__(self):             # <<<<<<<<<<<<<<
 *         return self.copy()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_85__copy__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_85__copy__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__copy__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_84__copy__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_84__copy__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__copy__", 0);

  /* "chess/__init__cp.pyx":1329
 * 
 *     def __copy__(self):
 *         return self.copy()             # <<<<<<<<<<<<<<
 * 
 *     def __deepcopy__(self, memo):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1329, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1329, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1328
 *         return board
 * 
 *     def __copy__(self):             # <<<<<<<<<<<<<<
 *         return self.copy()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__copy__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1331
 *         return self.copy()
 * 
 *     def __deepcopy__(self, memo):             # <<<<<<<<<<<<<<
 *         board = self.copy()
 *         memo[id(self)] = board
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_87__deepcopy__(PyObject *__pyx_v_self, PyObject *__pyx_v_memo); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_87__deepcopy__(PyObject *__pyx_v_self, PyObject *__pyx_v_memo) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__deepcopy__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_86__deepcopy__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v_memo));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_86__deepcopy__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v_memo) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__deepcopy__", 0);

  /* "chess/__init__cp.pyx":1332
 * 
 *     def __deepcopy__(self, memo):
 *         board = self.copy()             # <<<<<<<<<<<<<<
 *         memo[id(self)] = board
 *         return board
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1332, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1333
 *     def __deepcopy__(self, memo):
 *         board = self.copy()
 *         memo[id(self)] = board             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1333, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(PyObject_SetItem(__pyx_v_memo, __pyx_t_1, __pyx_v_board) < 0)) __PYX_ERR(0, 1333, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1334
 *         board = self.copy()
 *         memo[id(self)] = board
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1331
 *         return self.copy()
 * 
 *     def __deepcopy__(self, memo):             # <<<<<<<<<<<<<<
 *         board = self.copy()
 *         memo[id(self)] = board
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__deepcopy__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1337
 * 
 *     @classmethod
 *     def empty(cls):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new empty board. Also see
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_89empty(PyObject *__pyx_v_cls, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_88empty[] = "\n        Creates a new empty board. Also see\n        :func:`~chess.BaseBoard.clear_board()`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_89empty(PyObject *__pyx_v_cls, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("empty (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_88empty(((PyTypeObject*)__pyx_v_cls));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_88empty(PyTypeObject *__pyx_v_cls) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("empty", 0);

  /* "chess/__init__cp.pyx":1342
 *         :func:`~chess.BaseBoard.clear_board()`.
 *         """
 *         return cls(None)             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1342, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1337
 * 
 *     @classmethod
 *     def empty(cls):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new empty board. Also see
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.empty", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1345
 * 
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new board, initialized with a Chess960 starting position.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_91from_chess960_pos(PyObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9BaseBoard_90from_chess960_pos[] = "\n        Creates a new board, initialized with a Chess960 starting position.\n\n        >>> import chess\n        >>> import random\n        >>>\n        >>> board = chess.Board.from_chess960_pos(random.randint(0, 959))\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_91from_chess960_pos(PyObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_chess960_pos (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_90from_chess960_pos(((PyTypeObject*)__pyx_v_cls), ((PyObject *)__pyx_v_sharnagl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_90from_chess960_pos(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("from_chess960_pos", 0);

  /* "chess/__init__cp.pyx":1354
 *         >>> board = chess.Board.from_chess960_pos(random.randint(0, 959))
 *         """
 *         board = cls.empty()             # <<<<<<<<<<<<<<
 *         board.set_chess960_pos(sharnagl)
 *         return board
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1355
 *         """
 *         board = cls.empty()
 *         board.set_chess960_pos(sharnagl)             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_set_chess960_pos_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_sharnagl) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sharnagl);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1356
 *         board = cls.empty()
 *         board.set_chess960_pos(sharnagl)
 *         return board             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1345
 * 
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new board, initialized with a Chess960 starting position.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.from_chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_93__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_93__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_92__reduce_cython__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_92__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self) {
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v__dict = 0;
  int __pyx_v_use_setstate;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  __Pyx_RefNannySetupContext("__reduce_cython__", 0);

  /* "(tree fragment)":5
 *     cdef object _dict
 *     cdef bint use_setstate
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)             # <<<<<<<<<<<<<<
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->chess960); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_self->fullmove_number); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->halfmove_clock); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->kings); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->knights); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyBool_FromLong(__pyx_v_self->occupied); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_carray_to_py_unsigned_PY_LONG_LONG(__pyx_v_self->occupied_co, 2); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->pawns); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = __Pyx_PyBool_FromLong(__pyx_v_self->promoted); if (unlikely(!__pyx_t_11)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->queens); if (unlikely(!__pyx_t_12)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __pyx_t_13 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->rooks); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_13);
  __pyx_t_14 = __Pyx_PyBool_FromLong(__pyx_v_self->turn); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_14);
  __pyx_t_15 = PyTuple_New(19); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_15);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_15, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_15, 2, __pyx_t_3);
  __Pyx_INCREF(__pyx_v_self->ep_square);
  __Pyx_GIVEREF(__pyx_v_self->ep_square);
  PyTuple_SET_ITEM(__pyx_t_15, 3, __pyx_v_self->ep_square);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_15, 4, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_15, 5, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_15, 6, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_15, 7, __pyx_t_7);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->legal_moves));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->legal_moves));
  PyTuple_SET_ITEM(__pyx_t_15, 8, ((PyObject *)__pyx_v_self->legal_moves));
  __Pyx_INCREF(__pyx_v_self->move_stack);
  __Pyx_GIVEREF(__pyx_v_self->move_stack);
  PyTuple_SET_ITEM(__pyx_t_15, 9, __pyx_v_self->move_stack);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_15, 10, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_15, 11, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_15, 12, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_15, 13, __pyx_t_11);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->pseudo_legal_moves));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->pseudo_legal_moves));
  PyTuple_SET_ITEM(__pyx_t_15, 14, ((PyObject *)__pyx_v_self->pseudo_legal_moves));
  __Pyx_GIVEREF(__pyx_t_12);
  PyTuple_SET_ITEM(__pyx_t_15, 15, __pyx_t_12);
  __Pyx_GIVEREF(__pyx_t_13);
  PyTuple_SET_ITEM(__pyx_t_15, 16, __pyx_t_13);
  __Pyx_INCREF(__pyx_v_self->stack);
  __Pyx_GIVEREF(__pyx_v_self->stack);
  PyTuple_SET_ITEM(__pyx_t_15, 17, __pyx_v_self->stack);
  __Pyx_GIVEREF(__pyx_t_14);
  PyTuple_SET_ITEM(__pyx_t_15, 18, __pyx_t_14);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_t_12 = 0;
  __pyx_t_13 = 0;
  __pyx_t_14 = 0;
  __pyx_v_state = ((PyObject*)__pyx_t_15);
  __pyx_t_15 = 0;

  /* "(tree fragment)":6
 *     cdef bint use_setstate
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)
 *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
 *     if _dict is not None:
 *         state += (_dict,)
 */
  __pyx_t_15 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_15);
  __pyx_v__dict = __pyx_t_15;
  __pyx_t_15 = 0;

  /* "(tree fragment)":7
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
  __pyx_t_16 = (__pyx_v__dict != Py_None);
  __pyx_t_17 = (__pyx_t_16 != 0);
  if (__pyx_t_17) {

    /* "(tree fragment)":8
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 *         state += (_dict,)             # <<<<<<<<<<<<<<
 *         use_setstate = True
 *     else:
 */
    __pyx_t_15 = PyTuple_New(1); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_INCREF(__pyx_v__dict);
    __Pyx_GIVEREF(__pyx_v__dict);
    PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_v__dict);
    __pyx_t_14 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_14));
    __pyx_t_14 = 0;

    /* "(tree fragment)":9
 *     if _dict is not None:
 *         state += (_dict,)
 *         use_setstate = True             # <<<<<<<<<<<<<<
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 */
    __pyx_v_use_setstate = 1;

    /* "(tree fragment)":7
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
    goto __pyx_L3;
  }

  /* "(tree fragment)":11
 *         use_setstate = True
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None             # <<<<<<<<<<<<<<
 *     if use_setstate:
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, None), state
 */
  /*else*/ {
    __pyx_t_16 = (__pyx_v_self->ep_square != Py_None);
    __pyx_t_18 = (__pyx_t_16 != 0);
    if (!__pyx_t_18) {
    } else {
      __pyx_t_17 = __pyx_t_18;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_18 = (((PyObject *)__pyx_v_self->legal_moves) != Py_None);
    __pyx_t_16 = (__pyx_t_18 != 0);
    if (!__pyx_t_16) {
    } else {
      __pyx_t_17 = __pyx_t_16;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_16 = (__pyx_v_self->move_stack != Py_None);
    __pyx_t_18 = (__pyx_t_16 != 0);
    if (!__pyx_t_18) {
    } else {
      __pyx_t_17 = __pyx_t_18;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_18 = (((PyObject *)__pyx_v_self->pseudo_legal_moves) != Py_None);
    __pyx_t_16 = (__pyx_t_18 != 0);
    if (!__pyx_t_16) {
    } else {
      __pyx_t_17 = __pyx_t_16;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_16 = (__pyx_v_self->stack != Py_None);
    __pyx_t_18 = (__pyx_t_16 != 0);
    __pyx_t_17 = __pyx_t_18;
    __pyx_L4_bool_binop_done:;
    __pyx_v_use_setstate = __pyx_t_17;
  }
  __pyx_L3:;

  /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, None), state
 *     else:
 */
  __pyx_t_17 = (__pyx_v_use_setstate != 0);
  if (__pyx_t_17) {

    /* "(tree fragment)":13
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 *     if use_setstate:
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, None), state             # <<<<<<<<<<<<<<
 *     else:
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, state)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_pyx_unpickle_BaseBoard); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __pyx_t_15 = PyTuple_New(3); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_15, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_56827727);
    __Pyx_GIVEREF(__pyx_int_56827727);
    PyTuple_SET_ITEM(__pyx_t_15, 1, __pyx_int_56827727);
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_15, 2, Py_None);
    __pyx_t_13 = PyTuple_New(3); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_14);
    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_14);
    __Pyx_GIVEREF(__pyx_t_15);
    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_15);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_13, 2, __pyx_v_state);
    __pyx_t_14 = 0;
    __pyx_t_15 = 0;
    __pyx_r = __pyx_t_13;
    __pyx_t_13 = 0;
    goto __pyx_L0;

    /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, None), state
 *     else:
 */
  }

  /* "(tree fragment)":15
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, None), state
 *     else:
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, state)             # <<<<<<<<<<<<<<
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_BaseBoard__set_state(self, __pyx_state)
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_pyx_unpickle_BaseBoard); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __pyx_t_15 = PyTuple_New(3); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_15, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_56827727);
    __Pyx_GIVEREF(__pyx_int_56827727);
    PyTuple_SET_ITEM(__pyx_t_15, 1, __pyx_int_56827727);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_15, 2, __pyx_v_state);
    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_GIVEREF(__pyx_t_13);
    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_15);
    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_15);
    __pyx_t_13 = 0;
    __pyx_t_15 = 0;
    __pyx_r = __pyx_t_14;
    __pyx_t_14 = 0;
    goto __pyx_L0;
  }

  /* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v__dict);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_BaseBoard__set_state(self, __pyx_state)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_95__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_9BaseBoard_95__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9BaseBoard_94__setstate_cython__(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9BaseBoard_94__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__setstate_cython__", 0);

  /* "(tree fragment)":17
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, state)
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_BaseBoard__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
 */
  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_5chess_10__init__cp___pyx_unpickle_BaseBoard__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_BaseBoard, (type(self), 0x3631f4f, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_BaseBoard__set_state(self, __pyx_state)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.BaseBoard.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1361
 * class _BoardState:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.pawns = board.pawns
 *         self.knights = board.knights
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_11_BoardState_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_11_BoardState_1__init__ = {"__init__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_11_BoardState_1__init__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_11_BoardState_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_board = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_board,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_board)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 1361, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1361, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_board = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1361, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp._BoardState.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_11_BoardState___init__(__pyx_self, __pyx_v_self, __pyx_v_board);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_11_BoardState___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":1362
 * 
 *     def __init__(self, board):
 *         self.pawns = board.pawns             # <<<<<<<<<<<<<<
 *         self.knights = board.knights
 *         self.bishops = board.bishops
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1362, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_pawns, __pyx_t_1) < 0) __PYX_ERR(0, 1362, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1363
 *     def __init__(self, board):
 *         self.pawns = board.pawns
 *         self.knights = board.knights             # <<<<<<<<<<<<<<
 *         self.bishops = board.bishops
 *         self.rooks = board.rooks
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1363, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_knights, __pyx_t_1) < 0) __PYX_ERR(0, 1363, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1364
 *         self.pawns = board.pawns
 *         self.knights = board.knights
 *         self.bishops = board.bishops             # <<<<<<<<<<<<<<
 *         self.rooks = board.rooks
 *         self.queens = board.queens
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1364, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_bishops, __pyx_t_1) < 0) __PYX_ERR(0, 1364, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1365
 *         self.knights = board.knights
 *         self.bishops = board.bishops
 *         self.rooks = board.rooks             # <<<<<<<<<<<<<<
 *         self.queens = board.queens
 *         self.kings = board.kings
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1365, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_rooks, __pyx_t_1) < 0) __PYX_ERR(0, 1365, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1366
 *         self.bishops = board.bishops
 *         self.rooks = board.rooks
 *         self.queens = board.queens             # <<<<<<<<<<<<<<
 *         self.kings = board.kings
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1366, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_queens, __pyx_t_1) < 0) __PYX_ERR(0, 1366, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1367
 *         self.rooks = board.rooks
 *         self.queens = board.queens
 *         self.kings = board.kings             # <<<<<<<<<<<<<<
 * 
 *         self.occupied_w = board.occupied_co[WHITE]
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1367, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_kings, __pyx_t_1) < 0) __PYX_ERR(0, 1367, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1369
 *         self.kings = board.kings
 * 
 *         self.occupied_w = board.occupied_co[WHITE]             # <<<<<<<<<<<<<<
 *         self.occupied_b = board.occupied_co[BLACK]
 *         self.occupied = board.occupied
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_occupied_w, __pyx_t_2) < 0) __PYX_ERR(0, 1369, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1370
 * 
 *         self.occupied_w = board.occupied_co[WHITE]
 *         self.occupied_b = board.occupied_co[BLACK]             # <<<<<<<<<<<<<<
 *         self.occupied = board.occupied
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1370, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1370, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_occupied_b, __pyx_t_1) < 0) __PYX_ERR(0, 1370, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1371
 *         self.occupied_w = board.occupied_co[WHITE]
 *         self.occupied_b = board.occupied_co[BLACK]
 *         self.occupied = board.occupied             # <<<<<<<<<<<<<<
 * 
 *         self.promoted = board.promoted
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1371, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_occupied, __pyx_t_1) < 0) __PYX_ERR(0, 1371, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1373
 *         self.occupied = board.occupied
 * 
 *         self.promoted = board.promoted             # <<<<<<<<<<<<<<
 * 
 *         self.turn = board.turn
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1373, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_promoted, __pyx_t_1) < 0) __PYX_ERR(0, 1373, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1375
 *         self.promoted = board.promoted
 * 
 *         self.turn = board.turn             # <<<<<<<<<<<<<<
 *         self.castling_rights = board.castling_rights
 *         self.ep_square = board.ep_square
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_turn); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_turn, __pyx_t_1) < 0) __PYX_ERR(0, 1375, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1376
 * 
 *         self.turn = board.turn
 *         self.castling_rights = board.castling_rights             # <<<<<<<<<<<<<<
 *         self.ep_square = board.ep_square
 *         self.halfmove_clock = board.halfmove_clock
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1376, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_castling_rights, __pyx_t_1) < 0) __PYX_ERR(0, 1376, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1377
 *         self.turn = board.turn
 *         self.castling_rights = board.castling_rights
 *         self.ep_square = board.ep_square             # <<<<<<<<<<<<<<
 *         self.halfmove_clock = board.halfmove_clock
 *         self.fullmove_number = board.fullmove_number
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_ep_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_ep_square, __pyx_t_1) < 0) __PYX_ERR(0, 1377, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1378
 *         self.castling_rights = board.castling_rights
 *         self.ep_square = board.ep_square
 *         self.halfmove_clock = board.halfmove_clock             # <<<<<<<<<<<<<<
 *         self.fullmove_number = board.fullmove_number
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_halfmove_clock); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_halfmove_clock, __pyx_t_1) < 0) __PYX_ERR(0, 1378, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1379
 *         self.ep_square = board.ep_square
 *         self.halfmove_clock = board.halfmove_clock
 *         self.fullmove_number = board.fullmove_number             # <<<<<<<<<<<<<<
 * 
 *     def restore(self, board):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_fullmove_number); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1379, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_fullmove_number, __pyx_t_1) < 0) __PYX_ERR(0, 1379, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1361
 * class _BoardState:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.pawns = board.pawns
 *         self.knights = board.knights
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp._BoardState.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1381
 *         self.fullmove_number = board.fullmove_number
 * 
 *     def restore(self, board):             # <<<<<<<<<<<<<<
 *         board.pawns = self.pawns
 *         board.knights = self.knights
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_11_BoardState_3restore(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_11_BoardState_3restore = {"restore", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_11_BoardState_3restore, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_11_BoardState_3restore(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_board = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("restore (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_board,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_board)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("restore", 1, 2, 2, 1); __PYX_ERR(0, 1381, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "restore") < 0)) __PYX_ERR(0, 1381, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_board = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("restore", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1381, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp._BoardState.restore", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_11_BoardState_2restore(__pyx_self, __pyx_v_self, __pyx_v_board);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_11_BoardState_2restore(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("restore", 0);

  /* "chess/__init__cp.pyx":1382
 * 
 *     def restore(self, board):
 *         board.pawns = self.pawns             # <<<<<<<<<<<<<<
 *         board.knights = self.knights
 *         board.bishops = self.bishops
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1382, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_pawns, __pyx_t_1) < 0) __PYX_ERR(0, 1382, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1383
 *     def restore(self, board):
 *         board.pawns = self.pawns
 *         board.knights = self.knights             # <<<<<<<<<<<<<<
 *         board.bishops = self.bishops
 *         board.rooks = self.rooks
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_knights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1383, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_knights, __pyx_t_1) < 0) __PYX_ERR(0, 1383, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1384
 *         board.pawns = self.pawns
 *         board.knights = self.knights
 *         board.bishops = self.bishops             # <<<<<<<<<<<<<<
 *         board.rooks = self.rooks
 *         board.queens = self.queens
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1384, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_bishops, __pyx_t_1) < 0) __PYX_ERR(0, 1384, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1385
 *         board.knights = self.knights
 *         board.bishops = self.bishops
 *         board.rooks = self.rooks             # <<<<<<<<<<<<<<
 *         board.queens = self.queens
 *         board.kings = self.kings
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_rooks); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1385, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_rooks, __pyx_t_1) < 0) __PYX_ERR(0, 1385, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1386
 *         board.bishops = self.bishops
 *         board.rooks = self.rooks
 *         board.queens = self.queens             # <<<<<<<<<<<<<<
 *         board.kings = self.kings
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1386, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_queens, __pyx_t_1) < 0) __PYX_ERR(0, 1386, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1387
 *         board.rooks = self.rooks
 *         board.queens = self.queens
 *         board.kings = self.kings             # <<<<<<<<<<<<<<
 * 
 *         board.occupied_co[WHITE] = self.occupied_w
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1387, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_kings, __pyx_t_1) < 0) __PYX_ERR(0, 1387, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1389
 *         board.kings = self.kings
 * 
 *         board.occupied_co[WHITE] = self.occupied_w             # <<<<<<<<<<<<<<
 *         board.occupied_co[BLACK] = self.occupied_b
 *         board.occupied = self.occupied
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_occupied_w); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(__Pyx_SetItemInt(__pyx_t_2, 1, __pyx_t_1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1) < 0)) __PYX_ERR(0, 1389, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1390
 * 
 *         board.occupied_co[WHITE] = self.occupied_w
 *         board.occupied_co[BLACK] = self.occupied_b             # <<<<<<<<<<<<<<
 *         board.occupied = self.occupied
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_occupied_b); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1390, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_occupied_co); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1390, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(__Pyx_SetItemInt(__pyx_t_2, 0, __pyx_t_1, int, 1, __Pyx_PyBool_FromLong, 0, 0, 1) < 0)) __PYX_ERR(0, 1390, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1391
 *         board.occupied_co[WHITE] = self.occupied_w
 *         board.occupied_co[BLACK] = self.occupied_b
 *         board.occupied = self.occupied             # <<<<<<<<<<<<<<
 * 
 *         board.promoted = self.promoted
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1391, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_occupied, __pyx_t_1) < 0) __PYX_ERR(0, 1391, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1393
 *         board.occupied = self.occupied
 * 
 *         board.promoted = self.promoted             # <<<<<<<<<<<<<<
 * 
 *         board.turn = self.turn
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1393, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_promoted, __pyx_t_1) < 0) __PYX_ERR(0, 1393, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1395
 *         board.promoted = self.promoted
 * 
 *         board.turn = self.turn             # <<<<<<<<<<<<<<
 *         board.castling_rights = self.castling_rights
 *         board.ep_square = self.ep_square
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_turn); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_turn, __pyx_t_1) < 0) __PYX_ERR(0, 1395, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1396
 * 
 *         board.turn = self.turn
 *         board.castling_rights = self.castling_rights             # <<<<<<<<<<<<<<
 *         board.ep_square = self.ep_square
 *         board.halfmove_clock = self.halfmove_clock
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1396, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_castling_rights, __pyx_t_1) < 0) __PYX_ERR(0, 1396, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1397
 *         board.turn = self.turn
 *         board.castling_rights = self.castling_rights
 *         board.ep_square = self.ep_square             # <<<<<<<<<<<<<<
 *         board.halfmove_clock = self.halfmove_clock
 *         board.fullmove_number = self.fullmove_number
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_ep_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1397, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_ep_square, __pyx_t_1) < 0) __PYX_ERR(0, 1397, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1398
 *         board.castling_rights = self.castling_rights
 *         board.ep_square = self.ep_square
 *         board.halfmove_clock = self.halfmove_clock             # <<<<<<<<<<<<<<
 *         board.fullmove_number = self.fullmove_number
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_halfmove_clock); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1398, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_halfmove_clock, __pyx_t_1) < 0) __PYX_ERR(0, 1398, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1399
 *         board.ep_square = self.ep_square
 *         board.halfmove_clock = self.halfmove_clock
 *         board.fullmove_number = self.fullmove_number             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_fullmove_number); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1399, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_fullmove_number, __pyx_t_1) < 0) __PYX_ERR(0, 1399, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1381
 *         self.fullmove_number = board.fullmove_number
 * 
 *     def restore(self, board):             # <<<<<<<<<<<<<<
 *         board.pawns = self.pawns
 *         board.knights = self.knights
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp._BoardState.restore", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1440
 * 
 * 
 *     def __init__(self, fen=STARTING_FEN, *, chess960=False):             # <<<<<<<<<<<<<<
 *         BaseBoard.__init__(self, None)
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_5Board_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_5chess_10__init__cp_5Board_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_fen = 0;
  PyObject *__pyx_v_chess960 = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_fen,&__pyx_n_s_chess960,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__25;
    values[1] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_fen);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1440, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_fen = values[0];
    __pyx_v_chess960 = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1440, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board___init__(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_fen, __pyx_v_chess960);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_5Board___init__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_fen, PyObject *__pyx_v_chess960) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":1441
 * 
 *     def __init__(self, fen=STARTING_FEN, *, chess960=False):
 *         BaseBoard.__init__(self, None)             # <<<<<<<<<<<<<<
 * 
 *         self.chess960 = chess960
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_BaseBoard), __pyx_n_s_init); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1441, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_self), Py_None};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1441, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_self), Py_None};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1441, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1441, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, ((PyObject *)__pyx_v_self));
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, Py_None);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1441, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1443
 *         BaseBoard.__init__(self, None)
 * 
 *         self.chess960 = chess960             # <<<<<<<<<<<<<<
 * 
 *         self.pseudo_legal_moves = PseudoLegalMoveGenerator(self)
 */
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_chess960); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1443, __pyx_L1_error)
  __pyx_v_self->__pyx_base.chess960 = __pyx_t_6;

  /* "chess/__init__cp.pyx":1445
 *         self.chess960 = chess960
 * 
 *         self.pseudo_legal_moves = PseudoLegalMoveGenerator(self)             # <<<<<<<<<<<<<<
 *         self.legal_moves = LegalMoveGenerator(self)
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_5chess_10__init__cp_PseudoLegalMoveGenerator), ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1445, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.pseudo_legal_moves);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->__pyx_base.pseudo_legal_moves));
  __pyx_v_self->__pyx_base.pseudo_legal_moves = ((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1446
 * 
 *         self.pseudo_legal_moves = PseudoLegalMoveGenerator(self)
 *         self.legal_moves = LegalMoveGenerator(self)             # <<<<<<<<<<<<<<
 * 
 *         self.move_stack = []
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_5chess_10__init__cp_LegalMoveGenerator), ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1446, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.legal_moves);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->__pyx_base.legal_moves));
  __pyx_v_self->__pyx_base.legal_moves = ((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1448
 *         self.legal_moves = LegalMoveGenerator(self)
 * 
 *         self.move_stack = []             # <<<<<<<<<<<<<<
 *         self.stack = []
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1448, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.move_stack);
  __Pyx_DECREF(__pyx_v_self->__pyx_base.move_stack);
  __pyx_v_self->__pyx_base.move_stack = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1449
 * 
 *         self.move_stack = []
 *         self.stack = []             # <<<<<<<<<<<<<<
 * 
 *         if fen is None:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1449, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.stack);
  __Pyx_DECREF(__pyx_v_self->__pyx_base.stack);
  __pyx_v_self->__pyx_base.stack = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1451
 *         self.stack = []
 * 
 *         if fen is None:             # <<<<<<<<<<<<<<
 *             self.clear()
 *         elif fen == type(self).starting_fen:
 */
  __pyx_t_6 = (__pyx_v_fen == Py_None);
  __pyx_t_7 = (__pyx_t_6 != 0);
  if (__pyx_t_7) {

    /* "chess/__init__cp.pyx":1452
 * 
 *         if fen is None:
 *             self.clear()             # <<<<<<<<<<<<<<
 *         elif fen == type(self).starting_fen:
 *             self.reset()
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1451
 *         self.stack = []
 * 
 *         if fen is None:             # <<<<<<<<<<<<<<
 *             self.clear()
 *         elif fen == type(self).starting_fen:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":1453
 *         if fen is None:
 *             self.clear()
 *         elif fen == type(self).starting_fen:             # <<<<<<<<<<<<<<
 *             self.reset()
 *         else:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_n_s_starting_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_fen, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_7) {

    /* "chess/__init__cp.pyx":1454
 *             self.clear()
 *         elif fen == type(self).starting_fen:
 *             self.reset()             # <<<<<<<<<<<<<<
 *         else:
 *             self.set_fen(fen)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1454, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1454, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1453
 *         if fen is None:
 *             self.clear()
 *         elif fen == type(self).starting_fen:             # <<<<<<<<<<<<<<
 *             self.reset()
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":1456
 *             self.reset()
 *         else:
 *             self.set_fen(fen)             # <<<<<<<<<<<<<<
 * 
 *     def reset(self):
 */
  /*else*/ {
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1456, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_v_fen) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_fen);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1456, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":1440
 * 
 * 
 *     def __init__(self, fen=STARTING_FEN, *, chess960=False):             # <<<<<<<<<<<<<<
 *         BaseBoard.__init__(self, None)
 * 
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1458
 *             self.set_fen(fen)
 * 
 *     def reset(self):             # <<<<<<<<<<<<<<
 *         """Restores the starting position."""
 *         self.turn = WHITE
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_3reset(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_2reset[] = "Restores the starting position.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_3reset(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reset (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_2reset(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_2reset(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  unsigned PY_LONG_LONG __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("reset", 0);

  /* "chess/__init__cp.pyx":1460
 *     def reset(self):
 *         """Restores the starting position."""
 *         self.turn = WHITE             # <<<<<<<<<<<<<<
 *         self.castling_rights = BB_CORNERS
 *         self.ep_square = None
 */
  __pyx_v_self->__pyx_base.turn = 1;

  /* "chess/__init__cp.pyx":1461
 *         """Restores the starting position."""
 *         self.turn = WHITE
 *         self.castling_rights = BB_CORNERS             # <<<<<<<<<<<<<<
 *         self.ep_square = None
 *         self.halfmove_clock = 0
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_CORNERS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1461, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1461, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->__pyx_base.castling_rights = __pyx_t_2;

  /* "chess/__init__cp.pyx":1462
 *         self.turn = WHITE
 *         self.castling_rights = BB_CORNERS
 *         self.ep_square = None             # <<<<<<<<<<<<<<
 *         self.halfmove_clock = 0
 *         self.fullmove_number = 1
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
  __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
  __pyx_v_self->__pyx_base.ep_square = Py_None;

  /* "chess/__init__cp.pyx":1463
 *         self.castling_rights = BB_CORNERS
 *         self.ep_square = None
 *         self.halfmove_clock = 0             # <<<<<<<<<<<<<<
 *         self.fullmove_number = 1
 * 
 */
  __pyx_v_self->__pyx_base.halfmove_clock = 0;

  /* "chess/__init__cp.pyx":1464
 *         self.ep_square = None
 *         self.halfmove_clock = 0
 *         self.fullmove_number = 1             # <<<<<<<<<<<<<<
 * 
 *         self.reset_board()
 */
  __pyx_v_self->__pyx_base.fullmove_number = 1;

  /* "chess/__init__cp.pyx":1466
 *         self.fullmove_number = 1
 * 
 *         self.reset_board()             # <<<<<<<<<<<<<<
 * 
 *     def reset_board(self):
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset_board_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1458
 *             self.set_fen(fen)
 * 
 *     def reset(self):             # <<<<<<<<<<<<<<
 *         """Restores the starting position."""
 *         self.turn = WHITE
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.reset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1468
 *         self.reset_board()
 * 
 *     def reset_board(self):             # <<<<<<<<<<<<<<
 *         super().reset_board()
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_5reset_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_5reset_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reset_board (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_4reset_board(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_4reset_board(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("reset_board", 0);

  /* "chess/__init__cp.pyx":1469
 * 
 *     def reset_board(self):
 *         super().reset_board()             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1469, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1469, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_reset_board_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1469, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1469, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1470
 *     def reset_board(self):
 *         super().reset_board()
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def clear(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1470, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1470, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1468
 *         self.reset_board()
 * 
 *     def reset_board(self):             # <<<<<<<<<<<<<<
 *         super().reset_board()
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.reset_board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1472
 *         self.clear_stack()
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         """
 *         Clears the board.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_7clear(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_6clear[] = "\n        Clears the board.\n\n        Resets move stacks and move counters. The side to move is white. There\n        are no rooks or kings, so castling rights are removed.\n\n        In order to be in a valid :func:`~chess.Board.status()` at least kings\n        need to be put on the board.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_7clear(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clear (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_6clear(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_6clear(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("clear", 0);

  /* "chess/__init__cp.pyx":1482
 *         need to be put on the board.
 *         """
 *         self.turn = WHITE             # <<<<<<<<<<<<<<
 *         self.castling_rights = BB_EMPTY
 *         self.ep_square = None
 */
  __pyx_v_self->__pyx_base.turn = 1;

  /* "chess/__init__cp.pyx":1483
 *         """
 *         self.turn = WHITE
 *         self.castling_rights = BB_EMPTY             # <<<<<<<<<<<<<<
 *         self.ep_square = None
 *         self.halfmove_clock = 0
 */
  __pyx_v_self->__pyx_base.castling_rights = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":1484
 *         self.turn = WHITE
 *         self.castling_rights = BB_EMPTY
 *         self.ep_square = None             # <<<<<<<<<<<<<<
 *         self.halfmove_clock = 0
 *         self.fullmove_number = 1
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
  __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
  __pyx_v_self->__pyx_base.ep_square = Py_None;

  /* "chess/__init__cp.pyx":1485
 *         self.castling_rights = BB_EMPTY
 *         self.ep_square = None
 *         self.halfmove_clock = 0             # <<<<<<<<<<<<<<
 *         self.fullmove_number = 1
 * 
 */
  __pyx_v_self->__pyx_base.halfmove_clock = 0;

  /* "chess/__init__cp.pyx":1486
 *         self.ep_square = None
 *         self.halfmove_clock = 0
 *         self.fullmove_number = 1             # <<<<<<<<<<<<<<
 * 
 *         self.clear_board()
 */
  __pyx_v_self->__pyx_base.fullmove_number = 1;

  /* "chess/__init__cp.pyx":1488
 *         self.fullmove_number = 1
 * 
 *         self.clear_board()             # <<<<<<<<<<<<<<
 * 
 *     def clear_board(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_board_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1488, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1488, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1472
 *         self.clear_stack()
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         """
 *         Clears the board.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.clear", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1490
 *         self.clear_board()
 * 
 *     def clear_board(self):             # <<<<<<<<<<<<<<
 *         super().clear_board()
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_9clear_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_9clear_board(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clear_board (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_8clear_board(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_8clear_board(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("clear_board", 0);

  /* "chess/__init__cp.pyx":1491
 * 
 *     def clear_board(self):
 *         super().clear_board()             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_clear_board_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1492
 *     def clear_board(self):
 *         super().clear_board()
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def clear_stack(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1490
 *         self.clear_board()
 * 
 *     def clear_board(self):             # <<<<<<<<<<<<<<
 *         super().clear_board()
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.clear_board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1494
 *         self.clear_stack()
 * 
 *     def clear_stack(self):             # <<<<<<<<<<<<<<
 *         """Clears the move stack."""
 *         del self.move_stack[:]
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_11clear_stack(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_10clear_stack[] = "Clears the move stack.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_11clear_stack(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clear_stack (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_10clear_stack(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_10clear_stack(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clear_stack", 0);

  /* "chess/__init__cp.pyx":1496
 *     def clear_stack(self):
 *         """Clears the move stack."""
 *         del self.move_stack[:]             # <<<<<<<<<<<<<<
 *         del self.stack[:]
 * 
 */
  if (__Pyx_PyObject_DelSlice(__pyx_v_self->__pyx_base.move_stack, 0, 0, NULL, NULL, &__pyx_slice__26, 0, 0, 1) < 0) __PYX_ERR(0, 1496, __pyx_L1_error)

  /* "chess/__init__cp.pyx":1497
 *         """Clears the move stack."""
 *         del self.move_stack[:]
 *         del self.stack[:]             # <<<<<<<<<<<<<<
 * 
 *     def root(self):
 */
  if (__Pyx_PyObject_DelSlice(__pyx_v_self->__pyx_base.stack, 0, 0, NULL, NULL, &__pyx_slice__26, 0, 0, 1) < 0) __PYX_ERR(0, 1497, __pyx_L1_error)

  /* "chess/__init__cp.pyx":1494
 *         self.clear_stack()
 * 
 *     def clear_stack(self):             # <<<<<<<<<<<<<<
 *         """Clears the move stack."""
 *         del self.move_stack[:]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.clear_stack", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1499
 *         del self.stack[:]
 * 
 *     def root(self):             # <<<<<<<<<<<<<<
 *         """Returns a copy of the root position."""
 *         if self.stack:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_13root(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_12root[] = "Returns a copy of the root position.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_13root(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("root (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_12root(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_12root(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("root", 0);

  /* "chess/__init__cp.pyx":1501
 *     def root(self):
 *         """Returns a copy of the root position."""
 *         if self.stack:             # <<<<<<<<<<<<<<
 *             board = type(self)(None, chess960=self.chess960)
 *             self.stack[0].restore(board)
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.stack); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1501, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1502
 *         """Returns a copy of the root position."""
 *         if self.stack:
 *             board = type(self)(None, chess960=self.chess960)             # <<<<<<<<<<<<<<
 *             self.stack[0].restore(board)
 *             return board
 */
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_chess960, __pyx_t_3) < 0) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_tuple__24, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_board = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1503
 *         if self.stack:
 *             board = type(self)(None, chess960=self.chess960)
 *             self.stack[0].restore(board)             # <<<<<<<<<<<<<<
 *             return board
 *         else:
 */
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_self->__pyx_base.stack, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1503, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_restore); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1503, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_board) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_board);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1503, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1504
 *             board = type(self)(None, chess960=self.chess960)
 *             self.stack[0].restore(board)
 *             return board             # <<<<<<<<<<<<<<
 *         else:
 *             return self.copy(stack=False)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_board);
    __pyx_r = __pyx_v_board;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1501
 *     def root(self):
 *         """Returns a copy of the root position."""
 *         if self.stack:             # <<<<<<<<<<<<<<
 *             board = type(self)(None, chess960=self.chess960)
 *             self.stack[0].restore(board)
 */
  }

  /* "chess/__init__cp.pyx":1506
 *             return board
 *         else:
 *             return self.copy(stack=False)             # <<<<<<<<<<<<<<
 * 
 *     def remove_piece_at(self, square):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1506, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1506, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_stack, Py_False) < 0) __PYX_ERR(0, 1506, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1506, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":1499
 *         del self.stack[:]
 * 
 *     def root(self):             # <<<<<<<<<<<<<<
 *         """Returns a copy of the root position."""
 *         if self.stack:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.root", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1508
 *             return self.copy(stack=False)
 * 
 *     def remove_piece_at(self, square):             # <<<<<<<<<<<<<<
 *         piece = super().remove_piece_at(square)
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_15remove_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_15remove_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove_piece_at (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_14remove_piece_at(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_square));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_14remove_piece_at(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("remove_piece_at", 0);

  /* "chess/__init__cp.pyx":1509
 * 
 *     def remove_piece_at(self, square):
 *         piece = super().remove_piece_at(square)             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 *         return piece
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1509, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1509, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_remove_piece_at_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1509, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_square);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1509, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_piece = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1510
 *     def remove_piece_at(self, square):
 *         piece = super().remove_piece_at(square)
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 *         return piece
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1511
 *         piece = super().remove_piece_at(square)
 *         self.clear_stack()
 *         return piece             # <<<<<<<<<<<<<<
 * 
 *     def set_piece_at(self, square, piece, promoted=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_piece);
  __pyx_r = __pyx_v_piece;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1508
 *             return self.copy(stack=False)
 * 
 *     def remove_piece_at(self, square):             # <<<<<<<<<<<<<<
 *         piece = super().remove_piece_at(square)
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.remove_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1513
 *         return piece
 * 
 *     def set_piece_at(self, square, piece, promoted=False):             # <<<<<<<<<<<<<<
 *         super().set_piece_at(square, piece, promoted=promoted)
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_17set_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_17set_piece_at(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_v_piece = 0;
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_piece_at (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_square,&__pyx_n_s_piece,&__pyx_n_s_promoted,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("set_piece_at", 0, 2, 3, 1); __PYX_ERR(0, 1513, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_promoted);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_piece_at") < 0)) __PYX_ERR(0, 1513, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_square = values[0];
    __pyx_v_piece = values[1];
    __pyx_v_promoted = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("set_piece_at", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1513, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.set_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_16set_piece_at(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_square, __pyx_v_piece, __pyx_v_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_16set_piece_at(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_square, PyObject *__pyx_v_piece, PyObject *__pyx_v_promoted) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("set_piece_at", 0);

  /* "chess/__init__cp.pyx":1514
 * 
 *     def set_piece_at(self, square, piece, promoted=False):
 *         super().set_piece_at(square, piece, promoted=promoted)             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_set_piece_at_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_square);
  __Pyx_GIVEREF(__pyx_v_square);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_square);
  __Pyx_INCREF(__pyx_v_piece);
  __Pyx_GIVEREF(__pyx_v_piece);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_piece);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_promoted, __pyx_v_promoted) < 0) __PYX_ERR(0, 1514, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1515
 *     def set_piece_at(self, square, piece, promoted=False):
 *         super().set_piece_at(square, piece, promoted=promoted)
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def generate_pseudo_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1515, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1515, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1513
 *         return piece
 * 
 *     def set_piece_at(self, square, piece, promoted=False):             # <<<<<<<<<<<<<<
 *         super().set_piece_at(square, piece, promoted=promoted)
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_piece_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_20generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":1517
 *         self.clear_stack()
 * 
 *     def generate_pseudo_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         our_pieces = self.occupied_co[self.turn]
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_19generate_pseudo_legal_moves(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_19generate_pseudo_legal_moves(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_moves (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__27;
    values[1] = __pyx_k__28;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_pseudo_legal_moves") < 0)) __PYX_ERR(0, 1517, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_pseudo_legal_moves", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1517, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_pseudo_legal_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_18generate_pseudo_legal_moves(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_18generate_pseudo_legal_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_moves", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 1517, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_from_mask = __pyx_v_from_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
  __pyx_cur_scope->__pyx_v_to_mask = __pyx_v_to_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_20generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_generate_pseudo_legal_moves, __pyx_n_s_Board_generate_pseudo_legal_move, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 1517, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_pseudo_legal_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_20generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_moves", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L8_resume_from_yield;
    case 2: goto __pyx_L10_resume_from_yield_from;
    case 3: goto __pyx_L19_resume_from_yield;
    case 4: goto __pyx_L20_resume_from_yield;
    case 5: goto __pyx_L21_resume_from_yield;
    case 6: goto __pyx_L22_resume_from_yield;
    case 7: goto __pyx_L23_resume_from_yield;
    case 8: goto __pyx_L30_resume_from_yield;
    case 9: goto __pyx_L31_resume_from_yield;
    case 10: goto __pyx_L32_resume_from_yield;
    case 11: goto __pyx_L33_resume_from_yield;
    case 12: goto __pyx_L34_resume_from_yield;
    case 13: goto __pyx_L37_resume_from_yield;
    case 14: goto __pyx_L39_resume_from_yield_from;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1517, __pyx_L1_error)

  /* "chess/__init__cp.pyx":1518
 * 
 *     def generate_pseudo_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         our_pieces = self.occupied_co[self.turn]             # <<<<<<<<<<<<<<
 * 
 *         # Generate piece moves.
 */
  __pyx_cur_scope->__pyx_v_our_pieces = (__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[__pyx_cur_scope->__pyx_v_self->__pyx_base.turn]);

  /* "chess/__init__cp.pyx":1521
 * 
 *         # Generate piece moves.
 *         non_pawns = our_pieces & ~self.pawns & from_mask             # <<<<<<<<<<<<<<
 *         for from_square in scan_reversed(non_pawns):
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_cur_scope->__pyx_v_our_pieces & (~__pyx_cur_scope->__pyx_v_self->__pyx_base.pawns))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1521, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_cur_scope->__pyx_v_from_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1521, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_cur_scope->__pyx_v_non_pawns = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1522
 *         # Generate piece moves.
 *         non_pawns = our_pieces & ~self.pawns & from_mask
 *         for from_square in scan_reversed(non_pawns):             # <<<<<<<<<<<<<<
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask
 *             for to_square in scan_reversed(moves):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1522, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_cur_scope->__pyx_v_non_pawns) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_cur_scope->__pyx_v_non_pawns);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1522, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1522, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1522, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1522, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1522, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1522, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_from_square);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_from_square, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1523
 *         non_pawns = our_pieces & ~self.pawns & from_mask
 *         for from_square in scan_reversed(non_pawns):
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask             # <<<<<<<<<<<<<<
 *             for to_square in scan_reversed(moves):
 *                 yield Move(from_square, to_square)
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_attacks_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1523, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_cur_scope->__pyx_v_from_square) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_from_square);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1523, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((~__pyx_cur_scope->__pyx_v_our_pieces)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1523, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1523, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_And(__pyx_t_6, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1523, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_moves);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_moves, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1524
 *         for from_square in scan_reversed(non_pawns):
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask
 *             for to_square in scan_reversed(moves):             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1524, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_cur_scope->__pyx_v_moves) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_moves);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1524, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
      __pyx_t_6 = __pyx_t_3; __Pyx_INCREF(__pyx_t_6); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1524, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1524, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1524, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1524, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1524, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1524, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_8(__pyx_t_6);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 1524, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_3 = 0;

      /* "chess/__init__cp.pyx":1525
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask
 *             for to_square in scan_reversed(moves):
 *                 yield Move(from_square, to_square)             # <<<<<<<<<<<<<<
 * 
 *         # Generate castling moves.
 */
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1525, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_cur_scope->__pyx_v_from_square);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_cur_scope->__pyx_v_to_square);
      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1525, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      __Pyx_XGIVEREF(__pyx_t_1);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_t_6);
      __pyx_cur_scope->__pyx_t_3 = __pyx_t_6;
      __pyx_cur_scope->__pyx_t_4 = __pyx_t_7;
      __pyx_cur_scope->__pyx_t_5 = __pyx_t_8;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L8_resume_from_yield:;
      __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_1);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      __pyx_t_6 = __pyx_cur_scope->__pyx_t_3;
      __pyx_cur_scope->__pyx_t_3 = 0;
      __Pyx_XGOTREF(__pyx_t_6);
      __pyx_t_7 = __pyx_cur_scope->__pyx_t_4;
      __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1525, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1524
 *         for from_square in scan_reversed(non_pawns):
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask
 *             for to_square in scan_reversed(moves):             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square)
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":1522
 *         # Generate piece moves.
 *         non_pawns = our_pieces & ~self.pawns & from_mask
 *         for from_square in scan_reversed(non_pawns):             # <<<<<<<<<<<<<<
 *             moves = self.attacks_mask(from_square) & ~our_pieces & to_mask
 *             for to_square in scan_reversed(moves):
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1528
 * 
 *         # Generate castling moves.
 *         if from_mask & self.kings:             # <<<<<<<<<<<<<<
 *             yield from self.generate_castling_moves(from_mask, to_mask)
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_cur_scope->__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = PyNumber_And(__pyx_cur_scope->__pyx_v_from_mask, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1528, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_9) {

    /* "chess/__init__cp.pyx":1529
 *         # Generate castling moves.
 *         if from_mask & self.kings:
 *             yield from self.generate_castling_moves(from_mask, to_mask)             # <<<<<<<<<<<<<<
 * 
 *         # The remaining moves are all pawn moves.
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_castling_moves); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1529, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1529, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GOTREF(__pyx_t_6);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1529, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GOTREF(__pyx_t_6);
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1529, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (__pyx_t_2) {
        __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2); __pyx_t_2 = NULL;
      }
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_10, __pyx_cur_scope->__pyx_v_from_mask);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
      PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_10, __pyx_cur_scope->__pyx_v_to_mask);
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1529, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_6);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XGOTREF(__pyx_r);
    if (likely(__pyx_r)) {
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 2;
      return __pyx_r;
      __pyx_L10_resume_from_yield_from:;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1529, __pyx_L1_error)
    } else {
      PyObject* exc_type = __Pyx_PyErr_Occurred();
      if (exc_type) {
        if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
        else __PYX_ERR(0, 1529, __pyx_L1_error)
      }
    }

    /* "chess/__init__cp.pyx":1528
 * 
 *         # Generate castling moves.
 *         if from_mask & self.kings:             # <<<<<<<<<<<<<<
 *             yield from self.generate_castling_moves(from_mask, to_mask)
 * 
 */
  }

  /* "chess/__init__cp.pyx":1532
 * 
 *         # The remaining moves are all pawn moves.
 *         pawns = self.pawns & self.occupied_co[self.turn] & from_mask             # <<<<<<<<<<<<<<
 *         if not pawns:
 *             return
 */
  __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_cur_scope->__pyx_v_self->__pyx_base.pawns & (__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[__pyx_cur_scope->__pyx_v_self->__pyx_base.turn]))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1532, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_1 = PyNumber_And(__pyx_t_6, __pyx_cur_scope->__pyx_v_from_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1532, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_pawns = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1533
 *         # The remaining moves are all pawn moves.
 *         pawns = self.pawns & self.occupied_co[self.turn] & from_mask
 *         if not pawns:             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_pawns); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1533, __pyx_L1_error)
  __pyx_t_11 = ((!__pyx_t_9) != 0);
  if (__pyx_t_11) {

    /* "chess/__init__cp.pyx":1534
 *         pawns = self.pawns & self.occupied_co[self.turn] & from_mask
 *         if not pawns:
 *             return             # <<<<<<<<<<<<<<
 * 
 *         # Generate pawn captures.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1533
 *         # The remaining moves are all pawn moves.
 *         pawns = self.pawns & self.occupied_co[self.turn] & from_mask
 *         if not pawns:             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":1537
 * 
 *         # Generate pawn captures.
 *         capturers = pawns             # <<<<<<<<<<<<<<
 *         for from_square in scan_reversed(capturers):
 *             targets = (
 */
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_pawns);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_pawns);
  __pyx_cur_scope->__pyx_v_capturers = __pyx_cur_scope->__pyx_v_pawns;

  /* "chess/__init__cp.pyx":1538
 *         # Generate pawn captures.
 *         capturers = pawns
 *         for from_square in scan_reversed(capturers):             # <<<<<<<<<<<<<<
 *             targets = (
 *                 BB_PAWN_ATTACKS[self.turn][from_square] &
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1538, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_cur_scope->__pyx_v_capturers) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_capturers);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1538, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_6 = __pyx_t_1; __Pyx_INCREF(__pyx_t_6); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1538, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1538, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_6))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1538, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_6, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1538, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1538, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_6, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1538, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_6);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1538, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_from_square);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_from_square, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1540
 *         for from_square in scan_reversed(capturers):
 *             targets = (
 *                 BB_PAWN_ATTACKS[self.turn][from_square] &             # <<<<<<<<<<<<<<
 *                 self.occupied_co[not self.turn] & to_mask)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_PAWN_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1540, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, __pyx_cur_scope->__pyx_v_self->__pyx_base.turn, int, 1, __Pyx_PyBool_FromLong, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1540, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_cur_scope->__pyx_v_from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1540, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1541
 *             targets = (
 *                 BB_PAWN_ATTACKS[self.turn][from_square] &
 *                 self.occupied_co[not self.turn] & to_mask)             # <<<<<<<<<<<<<<
 * 
 *             for to_square in scan_reversed(targets):
 */
    __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_cur_scope->__pyx_v_self->__pyx_base.turn != 0))])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "chess/__init__cp.pyx":1540
 *         for from_square in scan_reversed(capturers):
 *             targets = (
 *                 BB_PAWN_ATTACKS[self.turn][from_square] &             # <<<<<<<<<<<<<<
 *                 self.occupied_co[not self.turn] & to_mask)
 * 
 */
    __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1540, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1541
 *             targets = (
 *                 BB_PAWN_ATTACKS[self.turn][from_square] &
 *                 self.occupied_co[not self.turn] & to_mask)             # <<<<<<<<<<<<<<
 * 
 *             for to_square in scan_reversed(targets):
 */
    __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_targets);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_targets, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1543
 *                 self.occupied_co[not self.turn] & to_mask)
 * 
 *             for to_square in scan_reversed(targets):             # <<<<<<<<<<<<<<
 *                 if square_rank(to_square) in [0, 7]:
 *                     yield Move(from_square, to_square, QUEEN)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1543, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_cur_scope->__pyx_v_targets) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_v_targets);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1543, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
      __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1543, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1543, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1543, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1543, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1543, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1543, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_8(__pyx_t_2);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 1543, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_3 = 0;

      /* "chess/__init__cp.pyx":1544
 * 
 *             for to_square in scan_reversed(targets):
 *                 if square_rank(to_square) in [0, 7]:             # <<<<<<<<<<<<<<
 *                     yield Move(from_square, to_square, QUEEN)
 *                     yield Move(from_square, to_square, ROOK)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1544, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_12 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_12)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_12);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_3 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_12, __pyx_cur_scope->__pyx_v_to_square) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_cur_scope->__pyx_v_to_square);
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1544, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_3, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1544, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1544, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (!__pyx_t_9) {
      } else {
        __pyx_t_11 = __pyx_t_9;
        goto __pyx_L17_bool_binop_done;
      }
      __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_3, __pyx_int_7, 7, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1544, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1544, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = __pyx_t_9;
      __pyx_L17_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_9 = (__pyx_t_11 != 0);
      if (__pyx_t_9) {

        /* "chess/__init__cp.pyx":1545
 *             for to_square in scan_reversed(targets):
 *                 if square_rank(to_square) in [0, 7]:
 *                     yield Move(from_square, to_square, QUEEN)             # <<<<<<<<<<<<<<
 *                     yield Move(from_square, to_square, ROOK)
 *                     yield Move(from_square, to_square, BISHOP)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_QUEEN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1545, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1545, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_from_square);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1545, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        __Pyx_XGIVEREF(__pyx_t_2);
        __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
        __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
        __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
        __Pyx_XGIVEREF(__pyx_t_6);
        __pyx_cur_scope->__pyx_t_3 = __pyx_t_6;
        __pyx_cur_scope->__pyx_t_4 = __pyx_t_7;
        __pyx_cur_scope->__pyx_t_5 = __pyx_t_8;
        __Pyx_XGIVEREF(__pyx_r);
        __Pyx_RefNannyFinishContext();
        __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
        /* return from generator, yielding value */
        __pyx_generator->resume_label = 3;
        return __pyx_r;
        __pyx_L19_resume_from_yield:;
        __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
        __pyx_cur_scope->__pyx_t_0 = 0;
        __Pyx_XGOTREF(__pyx_t_2);
        __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
        __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
        __pyx_t_6 = __pyx_cur_scope->__pyx_t_3;
        __pyx_cur_scope->__pyx_t_3 = 0;
        __Pyx_XGOTREF(__pyx_t_6);
        __pyx_t_7 = __pyx_cur_scope->__pyx_t_4;
        __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1545, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1546
 *                 if square_rank(to_square) in [0, 7]:
 *                     yield Move(from_square, to_square, QUEEN)
 *                     yield Move(from_square, to_square, ROOK)             # <<<<<<<<<<<<<<
 *                     yield Move(from_square, to_square, BISHOP)
 *                     yield Move(from_square, to_square, KNIGHT)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_from_square);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        __Pyx_XGIVEREF(__pyx_t_2);
        __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
        __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
        __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
        __Pyx_XGIVEREF(__pyx_t_6);
        __pyx_cur_scope->__pyx_t_3 = __pyx_t_6;
        __pyx_cur_scope->__pyx_t_4 = __pyx_t_7;
        __pyx_cur_scope->__pyx_t_5 = __pyx_t_8;
        __Pyx_XGIVEREF(__pyx_r);
        __Pyx_RefNannyFinishContext();
        __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
        /* return from generator, yielding value */
        __pyx_generator->resume_label = 4;
        return __pyx_r;
        __pyx_L20_resume_from_yield:;
        __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
        __pyx_cur_scope->__pyx_t_0 = 0;
        __Pyx_XGOTREF(__pyx_t_2);
        __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
        __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
        __pyx_t_6 = __pyx_cur_scope->__pyx_t_3;
        __pyx_cur_scope->__pyx_t_3 = 0;
        __Pyx_XGOTREF(__pyx_t_6);
        __pyx_t_7 = __pyx_cur_scope->__pyx_t_4;
        __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1546, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1547
 *                     yield Move(from_square, to_square, QUEEN)
 *                     yield Move(from_square, to_square, ROOK)
 *                     yield Move(from_square, to_square, BISHOP)             # <<<<<<<<<<<<<<
 *                     yield Move(from_square, to_square, KNIGHT)
 *                 else:
 */
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BISHOP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1547, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1547, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_from_square);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1547, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        __Pyx_XGIVEREF(__pyx_t_2);
        __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
        __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
        __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
        __Pyx_XGIVEREF(__pyx_t_6);
        __pyx_cur_scope->__pyx_t_3 = __pyx_t_6;
        __pyx_cur_scope->__pyx_t_4 = __pyx_t_7;
        __pyx_cur_scope->__pyx_t_5 = __pyx_t_8;
        __Pyx_XGIVEREF(__pyx_r);
        __Pyx_RefNannyFinishContext();
        __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
        /* return from generator, yielding value */
        __pyx_generator->resume_label = 5;
        return __pyx_r;
        __pyx_L21_resume_from_yield:;
        __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
        __pyx_cur_scope->__pyx_t_0 = 0;
        __Pyx_XGOTREF(__pyx_t_2);
        __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
        __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
        __pyx_t_6 = __pyx_cur_scope->__pyx_t_3;
        __pyx_cur_scope->__pyx_t_3 = 0;
        __Pyx_XGOTREF(__pyx_t_6);
        __pyx_t_7 = __pyx_cur_scope->__pyx_t_4;
        __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1547, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1548
 *                     yield Move(from_square, to_square, ROOK)
 *                     yield Move(from_square, to_square, BISHOP)
 *                     yield Move(from_square, to_square, KNIGHT)             # <<<<<<<<<<<<<<
 *                 else:
 *                     yield Move(from_square, to_square)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_KNIGHT); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1548, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1548, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_from_square);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1548, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_r = __pyx_t_3;
        __pyx_t_3 = 0;
        __Pyx_XGIVEREF(__pyx_t_2);
        __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
        __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
        __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
        __Pyx_XGIVEREF(__pyx_t_6);
        __pyx_cur_scope->__pyx_t_3 = __pyx_t_6;
        __pyx_cur_scope->__pyx_t_4 = __pyx_t_7;
        __pyx_cur_scope->__pyx_t_5 = __pyx_t_8;
        __Pyx_XGIVEREF(__pyx_r);
        __Pyx_RefNannyFinishContext();
        __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
        /* return from generator, yielding value */
        __pyx_generator->resume_label = 6;
        return __pyx_r;
        __pyx_L22_resume_from_yield:;
        __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
        __pyx_cur_scope->__pyx_t_0 = 0;
        __Pyx_XGOTREF(__pyx_t_2);
        __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
        __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
        __pyx_t_6 = __pyx_cur_scope->__pyx_t_3;
        __pyx_cur_scope->__pyx_t_3 = 0;
        __Pyx_XGOTREF(__pyx_t_6);
        __pyx_t_7 = __pyx_cur_scope->__pyx_t_4;
        __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1548, __pyx_L1_error)

        /* "chess/__init__cp.pyx":1544
 * 
 *             for to_square in scan_reversed(targets):
 *                 if square_rank(to_square) in [0, 7]:             # <<<<<<<<<<<<<<
 *                     yield Move(from_square, to_square, QUEEN)
 *                     yield Move(from_square, to_square, ROOK)
 */
        goto __pyx_L16;
      }

      /* "chess/__init__cp.pyx":1550
 *                     yield Move(from_square, to_square, KNIGHT)
 *                 else:
 *                     yield Move(from_square, to_square)             # <<<<<<<<<<<<<<
 * 
 *         # Prepare pawn advance generation.
 */
      /*else*/ {
        __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1550, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_cur_scope->__pyx_v_from_square);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_cur_scope->__pyx_v_to_square);
        __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1550, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_1;
        __pyx_t_1 = 0;
        __Pyx_XGIVEREF(__pyx_t_2);
        __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
        __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
        __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
        __Pyx_XGIVEREF(__pyx_t_6);
        __pyx_cur_scope->__pyx_t_3 = __pyx_t_6;
        __pyx_cur_scope->__pyx_t_4 = __pyx_t_7;
        __pyx_cur_scope->__pyx_t_5 = __pyx_t_8;
        __Pyx_XGIVEREF(__pyx_r);
        __Pyx_RefNannyFinishContext();
        __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
        /* return from generator, yielding value */
        __pyx_generator->resume_label = 7;
        return __pyx_r;
        __pyx_L23_resume_from_yield:;
        __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
        __pyx_cur_scope->__pyx_t_0 = 0;
        __Pyx_XGOTREF(__pyx_t_2);
        __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
        __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
        __pyx_t_6 = __pyx_cur_scope->__pyx_t_3;
        __pyx_cur_scope->__pyx_t_3 = 0;
        __Pyx_XGOTREF(__pyx_t_6);
        __pyx_t_7 = __pyx_cur_scope->__pyx_t_4;
        __pyx_t_8 = __pyx_cur_scope->__pyx_t_5;
        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1550, __pyx_L1_error)
      }
      __pyx_L16:;

      /* "chess/__init__cp.pyx":1543
 *                 self.occupied_co[not self.turn] & to_mask)
 * 
 *             for to_square in scan_reversed(targets):             # <<<<<<<<<<<<<<
 *                 if square_rank(to_square) in [0, 7]:
 *                     yield Move(from_square, to_square, QUEEN)
 */
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1538
 *         # Generate pawn captures.
 *         capturers = pawns
 *         for from_square in scan_reversed(capturers):             # <<<<<<<<<<<<<<
 *             targets = (
 *                 BB_PAWN_ATTACKS[self.turn][from_square] &
 */
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1553
 * 
 *         # Prepare pawn advance generation.
 *         if self.turn == WHITE:             # <<<<<<<<<<<<<<
 *             single_moves = pawns << 8 & ~self.occupied
 *             double_moves = single_moves << 8 & ~self.occupied & (BB_RANK_3 | BB_RANK_4)
 */
  __pyx_t_9 = ((__pyx_cur_scope->__pyx_v_self->__pyx_base.turn == 1) != 0);
  if (__pyx_t_9) {

    /* "chess/__init__cp.pyx":1554
 *         # Prepare pawn advance generation.
 *         if self.turn == WHITE:
 *             single_moves = pawns << 8 & ~self.occupied             # <<<<<<<<<<<<<<
 *             double_moves = single_moves << 8 & ~self.occupied & (BB_RANK_3 | BB_RANK_4)
 *         else:
 */
    __pyx_t_6 = __Pyx_PyInt_LshiftObjC(__pyx_cur_scope->__pyx_v_pawns, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1554, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = __Pyx_PyInt_From_int((~__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1554, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyNumber_And(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1554, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_v_single_moves = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1555
 *         if self.turn == WHITE:
 *             single_moves = pawns << 8 & ~self.occupied
 *             double_moves = single_moves << 8 & ~self.occupied & (BB_RANK_3 | BB_RANK_4)             # <<<<<<<<<<<<<<
 *         else:
 *             single_moves = pawns >> 8 & ~self.occupied
 */
    __pyx_t_1 = __Pyx_PyInt_LshiftObjC(__pyx_cur_scope->__pyx_v_single_moves, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyInt_From_int((~__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = PyNumber_And(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_Or(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_And(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1555, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_v_double_moves = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1553
 * 
 *         # Prepare pawn advance generation.
 *         if self.turn == WHITE:             # <<<<<<<<<<<<<<
 *             single_moves = pawns << 8 & ~self.occupied
 *             double_moves = single_moves << 8 & ~self.occupied & (BB_RANK_3 | BB_RANK_4)
 */
    goto __pyx_L24;
  }

  /* "chess/__init__cp.pyx":1557
 *             double_moves = single_moves << 8 & ~self.occupied & (BB_RANK_3 | BB_RANK_4)
 *         else:
 *             single_moves = pawns >> 8 & ~self.occupied             # <<<<<<<<<<<<<<
 *             double_moves = single_moves >> 8 & ~self.occupied & (BB_RANK_6 | BB_RANK_5)
 * 
 */
  /*else*/ {
    __pyx_t_1 = __Pyx_PyInt_RshiftObjC(__pyx_cur_scope->__pyx_v_pawns, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyInt_From_int((~__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_cur_scope->__pyx_v_single_moves = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":1558
 *         else:
 *             single_moves = pawns >> 8 & ~self.occupied
 *             double_moves = single_moves >> 8 & ~self.occupied & (BB_RANK_6 | BB_RANK_5)             # <<<<<<<<<<<<<<
 * 
 *         single_moves &= to_mask
 */
    __pyx_t_6 = __Pyx_PyInt_RshiftObjC(__pyx_cur_scope->__pyx_v_single_moves, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_3 = __Pyx_PyInt_From_int((~__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyNumber_And(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_RANK_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = PyNumber_Or(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_And(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_cur_scope->__pyx_v_double_moves = __pyx_t_6;
    __pyx_t_6 = 0;
  }
  __pyx_L24:;

  /* "chess/__init__cp.pyx":1560
 *             double_moves = single_moves >> 8 & ~self.occupied & (BB_RANK_6 | BB_RANK_5)
 * 
 *         single_moves &= to_mask             # <<<<<<<<<<<<<<
 *         double_moves &= to_mask
 * 
 */
  __pyx_t_6 = PyNumber_InPlaceAnd(__pyx_cur_scope->__pyx_v_single_moves, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1560, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_single_moves);
  __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_single_moves, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_6);
  __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1561
 * 
 *         single_moves &= to_mask
 *         double_moves &= to_mask             # <<<<<<<<<<<<<<
 * 
 *         # Generate single pawn moves.
 */
  __pyx_t_6 = PyNumber_InPlaceAnd(__pyx_cur_scope->__pyx_v_double_moves, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1561, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_double_moves);
  __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_double_moves, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_6);
  __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1564
 * 
 *         # Generate single pawn moves.
 *         for to_square in scan_reversed(single_moves):             # <<<<<<<<<<<<<<
 *             from_square = to_square + (8 if self.turn == BLACK else -8)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1564, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_cur_scope->__pyx_v_single_moves) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_v_single_moves);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1564, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
    __pyx_t_2 = __pyx_t_6; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1564, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1564, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1564, __pyx_L1_error)
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1564, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1564, __pyx_L1_error)
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1564, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1564, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_to_square);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":1565
 *         # Generate single pawn moves.
 *         for to_square in scan_reversed(single_moves):
 *             from_square = to_square + (8 if self.turn == BLACK else -8)             # <<<<<<<<<<<<<<
 * 
 *             if square_rank(to_square) in [0, 7]:
 */
    if (((__pyx_cur_scope->__pyx_v_self->__pyx_base.turn == 0) != 0)) {
      __Pyx_INCREF(__pyx_int_8);
      __pyx_t_6 = __pyx_int_8;
    } else {
      __Pyx_INCREF(__pyx_int_neg_8);
      __pyx_t_6 = __pyx_int_neg_8;
    }
    __pyx_t_1 = PyNumber_Add(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1565, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_from_square);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_from_square, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1567
 *             from_square = to_square + (8 if self.turn == BLACK else -8)
 * 
 *             if square_rank(to_square) in [0, 7]:             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square, QUEEN)
 *                 yield Move(from_square, to_square, ROOK)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1567, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_cur_scope->__pyx_v_to_square) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_to_square);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1567, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1567, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1567, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (!__pyx_t_11) {
    } else {
      __pyx_t_9 = __pyx_t_11;
      goto __pyx_L28_bool_binop_done;
    }
    __pyx_t_6 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_7, 7, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1567, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1567, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_9 = __pyx_t_11;
    __pyx_L28_bool_binop_done:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = (__pyx_t_9 != 0);
    if (__pyx_t_11) {

      /* "chess/__init__cp.pyx":1568
 * 
 *             if square_rank(to_square) in [0, 7]:
 *                 yield Move(from_square, to_square, QUEEN)             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square, ROOK)
 *                 yield Move(from_square, to_square, BISHOP)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_QUEEN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1568, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1568, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_from_square);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1568, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_r = __pyx_t_1;
      __pyx_t_1 = 0;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 8;
      return __pyx_r;
      __pyx_L30_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1568, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1569
 *             if square_rank(to_square) in [0, 7]:
 *                 yield Move(from_square, to_square, QUEEN)
 *                 yield Move(from_square, to_square, ROOK)             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square, BISHOP)
 *                 yield Move(from_square, to_square, KNIGHT)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1569, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1569, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_from_square);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1569, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_r = __pyx_t_1;
      __pyx_t_1 = 0;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 9;
      return __pyx_r;
      __pyx_L31_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1569, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1570
 *                 yield Move(from_square, to_square, QUEEN)
 *                 yield Move(from_square, to_square, ROOK)
 *                 yield Move(from_square, to_square, BISHOP)             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square, KNIGHT)
 *             else:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BISHOP); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1570, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1570, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_from_square);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1570, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_r = __pyx_t_1;
      __pyx_t_1 = 0;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 10;
      return __pyx_r;
      __pyx_L32_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1570, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1571
 *                 yield Move(from_square, to_square, ROOK)
 *                 yield Move(from_square, to_square, BISHOP)
 *                 yield Move(from_square, to_square, KNIGHT)             # <<<<<<<<<<<<<<
 *             else:
 *                 yield Move(from_square, to_square)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_KNIGHT); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1571, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1571, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_from_square);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1571, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_r = __pyx_t_1;
      __pyx_t_1 = 0;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 11;
      return __pyx_r;
      __pyx_L33_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1571, __pyx_L1_error)

      /* "chess/__init__cp.pyx":1567
 *             from_square = to_square + (8 if self.turn == BLACK else -8)
 * 
 *             if square_rank(to_square) in [0, 7]:             # <<<<<<<<<<<<<<
 *                 yield Move(from_square, to_square, QUEEN)
 *                 yield Move(from_square, to_square, ROOK)
 */
      goto __pyx_L27;
    }

    /* "chess/__init__cp.pyx":1573
 *                 yield Move(from_square, to_square, KNIGHT)
 *             else:
 *                 yield Move(from_square, to_square)             # <<<<<<<<<<<<<<
 * 
 *         # Generate double pawn moves.
 */
    /*else*/ {
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1573, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_from_square);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
      __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1573, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_r = __pyx_t_6;
      __pyx_t_6 = 0;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 12;
      return __pyx_r;
      __pyx_L34_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1573, __pyx_L1_error)
    }
    __pyx_L27:;

    /* "chess/__init__cp.pyx":1564
 * 
 *         # Generate single pawn moves.
 *         for to_square in scan_reversed(single_moves):             # <<<<<<<<<<<<<<
 *             from_square = to_square + (8 if self.turn == BLACK else -8)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1576
 * 
 *         # Generate double pawn moves.
 *         for to_square in scan_reversed(double_moves):             # <<<<<<<<<<<<<<
 *             from_square = to_square + (16 if self.turn == BLACK else -16)
 *             yield Move(from_square, to_square)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1576, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_1, __pyx_cur_scope->__pyx_v_double_moves) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_double_moves);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1576, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_6 = __pyx_t_2; __Pyx_INCREF(__pyx_t_6); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1576, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_6))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1576, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_6, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1576, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1576, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_6, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1576, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_6);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1576, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_to_square);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":1577
 *         # Generate double pawn moves.
 *         for to_square in scan_reversed(double_moves):
 *             from_square = to_square + (16 if self.turn == BLACK else -16)             # <<<<<<<<<<<<<<
 *             yield Move(from_square, to_square)
 * 
 */
    if (((__pyx_cur_scope->__pyx_v_self->__pyx_base.turn == 0) != 0)) {
      __Pyx_INCREF(__pyx_int_16);
      __pyx_t_2 = __pyx_int_16;
    } else {
      __Pyx_INCREF(__pyx_int_neg_16);
      __pyx_t_2 = __pyx_int_neg_16;
    }
    __pyx_t_1 = PyNumber_Add(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1577, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_from_square);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_from_square, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1578
 *         for to_square in scan_reversed(double_moves):
 *             from_square = to_square + (16 if self.turn == BLACK else -16)
 *             yield Move(from_square, to_square)             # <<<<<<<<<<<<<<
 * 
 *         # Generate en passant captures.
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1578, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_square);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_square);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_from_square);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1578, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
    __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
    __Pyx_XGIVEREF(__pyx_t_6);
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_6;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 13;
    return __pyx_r;
    __pyx_L37_resume_from_yield:;
    __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
    __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
    __pyx_t_6 = __pyx_cur_scope->__pyx_t_0;
    __pyx_cur_scope->__pyx_t_0 = 0;
    __Pyx_XGOTREF(__pyx_t_6);
    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1578, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1576
 * 
 *         # Generate double pawn moves.
 *         for to_square in scan_reversed(double_moves):             # <<<<<<<<<<<<<<
 *             from_square = to_square + (16 if self.turn == BLACK else -16)
 *             yield Move(from_square, to_square)
 */
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1581
 * 
 *         # Generate en passant captures.
 *         if self.ep_square:             # <<<<<<<<<<<<<<
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 */
  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1581, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "chess/__init__cp.pyx":1582
 *         # Generate en passant captures.
 *         if self.ep_square:
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)             # <<<<<<<<<<<<<<
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_pseudo_legal_ep); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1582, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_6);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_6);
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (__pyx_t_1) {
        __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __pyx_t_1 = NULL;
      }
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_10, __pyx_cur_scope->__pyx_v_from_mask);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
      PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_10, __pyx_cur_scope->__pyx_v_to_mask);
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_6);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XGOTREF(__pyx_r);
    if (likely(__pyx_r)) {
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 14;
      return __pyx_r;
      __pyx_L39_resume_from_yield_from:;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1582, __pyx_L1_error)
    } else {
      PyObject* exc_type = __Pyx_PyErr_Occurred();
      if (exc_type) {
        if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
        else __PYX_ERR(0, 1582, __pyx_L1_error)
      }
    }

    /* "chess/__init__cp.pyx":1581
 * 
 *         # Generate en passant captures.
 *         if self.ep_square:             # <<<<<<<<<<<<<<
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 */
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":1517
 *         self.clear_stack()
 * 
 *     def generate_pseudo_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         our_pieces = self.occupied_co[self.turn]
 * 
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("generate_pseudo_legal_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_23generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":1584
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:
 *             return
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_22generate_pseudo_legal_ep(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_22generate_pseudo_legal_ep(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_ep (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__29;
    values[1] = __pyx_k__30;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_pseudo_legal_ep") < 0)) __PYX_ERR(0, 1584, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_pseudo_legal_ep", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1584, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_pseudo_legal_ep", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_21generate_pseudo_legal_ep(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_21generate_pseudo_legal_ep(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_ep", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 1584, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_from_mask = __pyx_v_from_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
  __pyx_cur_scope->__pyx_v_to_mask = __pyx_v_to_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_23generator4, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_generate_pseudo_legal_ep, __pyx_n_s_Board_generate_pseudo_legal_ep, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 1584, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_pseudo_legal_ep", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_23generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_ep", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L10_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1584, __pyx_L1_error)

  /* "chess/__init__cp.pyx":1585
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1585, __pyx_L1_error)
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (!__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L5_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_And(__pyx_t_5, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1585, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = ((!__pyx_t_3) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L5_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1586
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:
 *             return             # <<<<<<<<<<<<<<
 * 
 *         if BB_SQUARES[self.ep_square] & self.occupied:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1585
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":1588
 *             return
 * 
 *         if BB_SQUARES[self.ep_square] & self.occupied:             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1588, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1589
 * 
 *         if BB_SQUARES[self.ep_square] & self.occupied:
 *             return             # <<<<<<<<<<<<<<
 * 
 *         capturers = (
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1588
 *             return
 * 
 *         if BB_SQUARES[self.ep_square] & self.occupied:             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":1592
 * 
 *         capturers = (
 *             self.pawns & self.occupied_co[self.turn] & from_mask &             # <<<<<<<<<<<<<<
 *             BB_PAWN_ATTACKS[not self.turn][self.ep_square] &
 *             BB_RANKS[4 if self.turn else 3])
 */
  __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_cur_scope->__pyx_v_self->__pyx_base.pawns & (__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[__pyx_cur_scope->__pyx_v_self->__pyx_base.turn]))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1592, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = PyNumber_And(__pyx_t_6, __pyx_cur_scope->__pyx_v_from_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1592, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1593
 *         capturers = (
 *             self.pawns & self.occupied_co[self.turn] & from_mask &
 *             BB_PAWN_ATTACKS[not self.turn][self.ep_square] &             # <<<<<<<<<<<<<<
 *             BB_RANKS[4 if self.turn else 3])
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_PAWN_ATTACKS); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_1 = (!(__pyx_cur_scope->__pyx_v_self->__pyx_base.turn != 0));
  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, __pyx_t_1, int, 1, __Pyx_PyBool_FromLong, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":1592
 * 
 *         capturers = (
 *             self.pawns & self.occupied_co[self.turn] & from_mask &             # <<<<<<<<<<<<<<
 *             BB_PAWN_ATTACKS[not self.turn][self.ep_square] &
 *             BB_RANKS[4 if self.turn else 3])
 */
  __pyx_t_5 = PyNumber_And(__pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1592, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1594
 *             self.pawns & self.occupied_co[self.turn] & from_mask &
 *             BB_PAWN_ATTACKS[not self.turn][self.ep_square] &
 *             BB_RANKS[4 if self.turn else 3])             # <<<<<<<<<<<<<<
 * 
 *         for capturer in scan_reversed(capturers):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_RANKS); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1594, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if ((__pyx_cur_scope->__pyx_v_self->__pyx_base.turn != 0)) {
    __pyx_t_7 = 4;
  } else {
    __pyx_t_7 = 3;
  }
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_6, __pyx_t_7, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1594, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1593
 *         capturers = (
 *             self.pawns & self.occupied_co[self.turn] & from_mask &
 *             BB_PAWN_ATTACKS[not self.turn][self.ep_square] &             # <<<<<<<<<<<<<<
 *             BB_RANKS[4 if self.turn else 3])
 * 
 */
  __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_GIVEREF(__pyx_t_6);
  __pyx_cur_scope->__pyx_v_capturers = __pyx_t_6;
  __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":1596
 *             BB_RANKS[4 if self.turn else 3])
 * 
 *         for capturer in scan_reversed(capturers):             # <<<<<<<<<<<<<<
 *             yield Move(capturer, self.ep_square)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_cur_scope->__pyx_v_capturers) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_cur_scope->__pyx_v_capturers);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
    __pyx_t_4 = __pyx_t_6; __Pyx_INCREF(__pyx_t_4); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1596, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1596, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_6); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1596, __pyx_L1_error)
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1596, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_6); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1596, __pyx_L1_error)
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1596, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_8(__pyx_t_4);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1596, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_capturer);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_capturer, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":1597
 * 
 *         for capturer in scan_reversed(capturers):
 *             yield Move(capturer, self.ep_square)             # <<<<<<<<<<<<<<
 * 
 *     def generate_pseudo_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1597, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_capturer);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_capturer);
    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_capturer);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square);
    PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square);
    __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1597, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    __Pyx_XGIVEREF(__pyx_t_4);
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_4;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_7;
    __pyx_cur_scope->__pyx_t_2 = __pyx_t_8;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L10_resume_from_yield:;
    __pyx_t_4 = __pyx_cur_scope->__pyx_t_0;
    __pyx_cur_scope->__pyx_t_0 = 0;
    __Pyx_XGOTREF(__pyx_t_4);
    __pyx_t_7 = __pyx_cur_scope->__pyx_t_1;
    __pyx_t_8 = __pyx_cur_scope->__pyx_t_2;
    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1597, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1596
 *             BB_RANKS[4 if self.turn else 3])
 * 
 *         for capturer in scan_reversed(capturers):             # <<<<<<<<<<<<<<
 *             yield Move(capturer, self.ep_square)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":1584
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:
 *             return
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("generate_pseudo_legal_ep", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1599
 *             yield Move(capturer, self.ep_square)
 * 
 *     def generate_pseudo_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         return itertools.chain(
 *             self.generate_pseudo_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_25generate_pseudo_legal_captures(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_25generate_pseudo_legal_captures(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_pseudo_legal_captures (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__31;
    values[1] = __pyx_k__32;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_pseudo_legal_captures") < 0)) __PYX_ERR(0, 1599, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_pseudo_legal_captures", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1599, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_pseudo_legal_captures", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_24generate_pseudo_legal_captures(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_24generate_pseudo_legal_captures(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("generate_pseudo_legal_captures", 0);

  /* "chess/__init__cp.pyx":1600
 * 
 *     def generate_pseudo_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         return itertools.chain(             # <<<<<<<<<<<<<<
 *             self.generate_pseudo_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 *             self.generate_pseudo_legal_ep(from_mask, to_mask))
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_itertools); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1601
 *     def generate_pseudo_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         return itertools.chain(
 *             self.generate_pseudo_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),             # <<<<<<<<<<<<<<
 *             self.generate_pseudo_legal_ep(from_mask, to_mask))
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1601, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))])); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1601, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyNumber_And(__pyx_v_to_mask, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1601, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_from_mask, __pyx_t_6};
    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1601, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_from_mask, __pyx_t_6};
    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1601, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1601, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(__pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_v_from_mask);
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1601, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1602
 *         return itertools.chain(
 *             self.generate_pseudo_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 *             self.generate_pseudo_legal_ep(from_mask, to_mask))             # <<<<<<<<<<<<<<
 * 
 *     def is_check(self):
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_pseudo_legal_ep); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1602, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_from_mask, __pyx_v_to_mask};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1602, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_from_mask, __pyx_v_to_mask};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1602, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1602, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_6) {
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_INCREF(__pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_v_from_mask);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_v_from_mask);
    __Pyx_INCREF(__pyx_v_to_mask);
    __Pyx_GIVEREF(__pyx_v_to_mask);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_v_to_mask);
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1602, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1600, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1600, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1600, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_8) {
      __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_t_4);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1600, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1599
 *             yield Move(capturer, self.ep_square)
 * 
 *     def generate_pseudo_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         return itertools.chain(
 *             self.generate_pseudo_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_pseudo_legal_captures", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1604
 *             self.generate_pseudo_legal_ep(from_mask, to_mask))
 * 
 *     def is_check(self):             # <<<<<<<<<<<<<<
 *         """Returns if the current side to move is in check."""
 *         king = self.king(self.turn)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_27is_check(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_26is_check[] = "Returns if the current side to move is in check.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_27is_check(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_check (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_26is_check(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_26is_check(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_king = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("is_check", 0);

  /* "chess/__init__cp.pyx":1606
 *     def is_check(self):
 *         """Returns if the current side to move is in check."""
 *         king = self.king(self.turn)             # <<<<<<<<<<<<<<
 *         return king is not None and self.is_attacked_by(not self.turn, king)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1606, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1606, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1606, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_king = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1607
 *         """Returns if the current side to move is in check."""
 *         king = self.king(self.turn)
 *         return king is not None and self.is_attacked_by(not self.turn, king)             # <<<<<<<<<<<<<<
 * 
 *     def is_into_check(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = (__pyx_v_king != Py_None);
  if (__pyx_t_5) {
  } else {
    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1607, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_attacked_by); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyBool_FromLong((!(__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_v_king};
    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1607, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_v_king};
    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1607, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1607, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_6) {
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_4);
    __Pyx_INCREF(__pyx_v_king);
    __Pyx_GIVEREF(__pyx_v_king);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_king);
    __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1607, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_1 = __pyx_t_2;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1604
 *             self.generate_pseudo_legal_ep(from_mask, to_mask))
 * 
 *     def is_check(self):             # <<<<<<<<<<<<<<
 *         """Returns if the current side to move is in check."""
 *         king = self.king(self.turn)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_check", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_king);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1609
 *         return king is not None and self.is_attacked_by(not self.turn, king)
 * 
 *     def is_into_check(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given move would leave the king in check or put it into
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_29is_into_check(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_28is_into_check[] = "\n        Checks if the given move would leave the king in check or put it into\n        check. The move must be at least pseudo legal.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_29is_into_check(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_into_check (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_28is_into_check(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_28is_into_check(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_v_king = NULL;
  PyObject *__pyx_v_checkers = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("is_into_check", 0);

  /* "chess/__init__cp.pyx":1614
 *         check. The move must be at least pseudo legal.
 *         """
 *         king = self.king(self.turn)             # <<<<<<<<<<<<<<
 *         if king is None:
 *             return False
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1614, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1614, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1614, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_king = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1615
 *         """
 *         king = self.king(self.turn)
 *         if king is None:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_5 = (__pyx_v_king == Py_None);
  __pyx_t_6 = (__pyx_t_5 != 0);
  if (__pyx_t_6) {

    /* "chess/__init__cp.pyx":1616
 *         king = self.king(self.turn)
 *         if king is None:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         checkers = self.attackers_mask(not self.turn, king)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1615
 *         """
 *         king = self.king(self.turn)
 *         if king is None:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1618
 *             return False
 * 
 *         checkers = self.attackers_mask(not self.turn, king)             # <<<<<<<<<<<<<<
 *         if checkers:
 *             # If already in check, look if it is an evasion.
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_attackers_mask_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong((!(__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_3, __pyx_v_king};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_3, __pyx_v_king};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1618, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
    __Pyx_INCREF(__pyx_v_king);
    __Pyx_GIVEREF(__pyx_v_king);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_king);
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_checkers = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1619
 * 
 *         checkers = self.attackers_mask(not self.turn, king)
 *         if checkers:             # <<<<<<<<<<<<<<
 *             # If already in check, look if it is an evasion.
 *             if move not in self._generate_evasions(king, checkers, BB_SQUARES[move.from_square], BB_SQUARES[move.to_square]):
 */
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_checkers); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1619, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "chess/__init__cp.pyx":1621
 *         if checkers:
 *             # If already in check, look if it is an evasion.
 *             if move not in self._generate_evasions(king, checkers, BB_SQUARES[move.from_square], BB_SQUARES[move.to_square]):             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_evasions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_8, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[5] = {__pyx_t_8, __pyx_v_king, __pyx_v_checkers, __pyx_t_4, __pyx_t_9};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1621, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[5] = {__pyx_t_8, __pyx_v_king, __pyx_v_checkers, __pyx_t_4, __pyx_t_9};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1621, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(4+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1621, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (__pyx_t_8) {
        __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_8); __pyx_t_8 = NULL;
      }
      __Pyx_INCREF(__pyx_v_king);
      __Pyx_GIVEREF(__pyx_v_king);
      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_7, __pyx_v_king);
      __Pyx_INCREF(__pyx_v_checkers);
      __Pyx_GIVEREF(__pyx_v_checkers);
      PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_7, __pyx_v_checkers);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_7, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_3, 3+__pyx_t_7, __pyx_t_9);
      __pyx_t_4 = 0;
      __pyx_t_9 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1621, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_v_move, __pyx_t_1, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = (__pyx_t_6 != 0);
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":1622
 *             # If already in check, look if it is an evasion.
 *             if move not in self._generate_evasions(king, checkers, BB_SQUARES[move.from_square], BB_SQUARES[move.to_square]):
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *         return not self._is_safe(king, self._slider_blockers(king), move)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1621
 *         if checkers:
 *             # If already in check, look if it is an evasion.
 *             if move not in self._generate_evasions(king, checkers, BB_SQUARES[move.from_square], BB_SQUARES[move.to_square]):             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    }

    /* "chess/__init__cp.pyx":1619
 * 
 *         checkers = self.attackers_mask(not self.turn, king)
 *         if checkers:             # <<<<<<<<<<<<<<
 *             # If already in check, look if it is an evasion.
 *             if move not in self._generate_evasions(king, checkers, BB_SQUARES[move.from_square], BB_SQUARES[move.to_square]):
 */
  }

  /* "chess/__init__cp.pyx":1624
 *                 return True
 * 
 *         return not self._is_safe(king, self._slider_blockers(king), move)             # <<<<<<<<<<<<<<
 * 
 *     def was_into_check(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_safe); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1624, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_slider_blockers); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1624, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_4, __pyx_v_king) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_king);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1624, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_9, __pyx_v_king, __pyx_t_3, __pyx_v_move};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_9, __pyx_v_king, __pyx_t_3, __pyx_v_move};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_4 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (__pyx_t_9) {
      __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    __Pyx_INCREF(__pyx_v_king);
    __Pyx_GIVEREF(__pyx_v_king);
    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_7, __pyx_v_king);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_7, __pyx_t_3);
    __Pyx_INCREF(__pyx_v_move);
    __Pyx_GIVEREF(__pyx_v_move);
    PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_7, __pyx_v_move);
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1624, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyBool_FromLong((!__pyx_t_5)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1609
 *         return king is not None and self.is_attacked_by(not self.turn, king)
 * 
 *     def is_into_check(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given move would leave the king in check or put it into
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_into_check", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_king);
  __Pyx_XDECREF(__pyx_v_checkers);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1626
 *         return not self._is_safe(king, self._slider_blockers(king), move)
 * 
 *     def was_into_check(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the king of the other side is attacked. Such a position is not
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_31was_into_check(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_30was_into_check[] = "\n        Checks if the king of the other side is attacked. Such a position is not\n        valid and could only be reached by an illegal move.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_31was_into_check(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("was_into_check (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_30was_into_check(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_30was_into_check(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_king = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("was_into_check", 0);

  /* "chess/__init__cp.pyx":1631
 *         valid and could only be reached by an illegal move.
 *         """
 *         king = self.king(not self.turn)             # <<<<<<<<<<<<<<
 *         return king is not None and self.is_attacked_by(self.turn, king)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong((!(__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_king = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1632
 *         """
 *         king = self.king(not self.turn)
 *         return king is not None and self.is_attacked_by(self.turn, king)             # <<<<<<<<<<<<<<
 * 
 *     def is_pseudo_legal(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = (__pyx_v_king != Py_None);
  if (__pyx_t_5) {
  } else {
    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1632, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_attacked_by); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_v_king};
    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1632, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_v_king};
    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1632, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1632, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_6) {
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_4);
    __Pyx_INCREF(__pyx_v_king);
    __Pyx_GIVEREF(__pyx_v_king);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_king);
    __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1632, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_1 = __pyx_t_2;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1626
 *         return not self._is_safe(king, self._slider_blockers(king), move)
 * 
 *     def was_into_check(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the king of the other side is attacked. Such a position is not
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Board.was_into_check", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_king);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1634
 *         return king is not None and self.is_attacked_by(self.turn, king)
 * 
 *     def is_pseudo_legal(self, move):             # <<<<<<<<<<<<<<
 *         # Null moves are not pseudo legal.
 *         if not move:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_33is_pseudo_legal(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_33is_pseudo_legal(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_pseudo_legal (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_32is_pseudo_legal(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_32is_pseudo_legal(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_v_from_mask = NULL;
  PyObject *__pyx_v_to_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("is_pseudo_legal", 0);

  /* "chess/__init__cp.pyx":1636
 *     def is_pseudo_legal(self, move):
 *         # Null moves are not pseudo legal.
 *         if not move:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_move); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1636, __pyx_L1_error)
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":1637
 *         # Null moves are not pseudo legal.
 *         if not move:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # Drops are not pseudo legal.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1636
 *     def is_pseudo_legal(self, move):
 *         # Null moves are not pseudo legal.
 *         if not move:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1640
 * 
 *         # Drops are not pseudo legal.
 *         if move.drop:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1640, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1640, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":1641
 *         # Drops are not pseudo legal.
 *         if move.drop:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # Source square must not be vacant.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1640
 * 
 *         # Drops are not pseudo legal.
 *         if move.drop:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1644
 * 
 *         # Source square must not be vacant.
 *         piece = self.piece_type_at(move.from_square)             # <<<<<<<<<<<<<<
 *         if not piece:
 *             return False
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_type_at); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_piece = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":1645
 *         # Source square must not be vacant.
 *         piece = self.piece_type_at(move.from_square)
 *         if not piece:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_piece); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1645, __pyx_L1_error)
  __pyx_t_1 = ((!__pyx_t_2) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1646
 *         piece = self.piece_type_at(move.from_square)
 *         if not piece:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # Get square masks.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1645
 *         # Source square must not be vacant.
 *         piece = self.piece_type_at(move.from_square)
 *         if not piece:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1649
 * 
 *         # Get square masks.
 *         from_mask = BB_SQUARES[move.from_square]             # <<<<<<<<<<<<<<
 *         to_mask = BB_SQUARES[move.to_square]
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1649, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1649, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1649, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_from_mask = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":1650
 *         # Get square masks.
 *         from_mask = BB_SQUARES[move.from_square]
 *         to_mask = BB_SQUARES[move.to_square]             # <<<<<<<<<<<<<<
 * 
 *         # Check turn.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1650, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1650, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1650, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_to_mask = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":1653
 * 
 *         # Check turn.
 *         if not self.occupied_co[self.turn] & from_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[__pyx_v_self->__pyx_base.turn])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1653, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_v_from_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1653, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1653, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":1654
 *         # Check turn.
 *         if not self.occupied_co[self.turn] & from_mask:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # Only pawns can promote and only on the back rank.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1653
 * 
 *         # Check turn.
 *         if not self.occupied_co[self.turn] & from_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1657
 * 
 *         # Only pawns can promote and only on the back rank.
 *         if move.promotion:             # <<<<<<<<<<<<<<
 *             if piece != PAWN:
 *                 return False
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1657, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":1658
 *         # Only pawns can promote and only on the back rank.
 *         if move.promotion:
 *             if piece != PAWN:             # <<<<<<<<<<<<<<
 *                 return False
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1658, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_piece, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1658, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1658, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":1659
 *         if move.promotion:
 *             if piece != PAWN:
 *                 return False             # <<<<<<<<<<<<<<
 * 
 *             if self.turn == WHITE and square_rank(move.to_square) != 7:
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_False);
      __pyx_r = Py_False;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1658
 *         # Only pawns can promote and only on the back rank.
 *         if move.promotion:
 *             if piece != PAWN:             # <<<<<<<<<<<<<<
 *                 return False
 * 
 */
    }

    /* "chess/__init__cp.pyx":1661
 *                 return False
 * 
 *             if self.turn == WHITE and square_rank(move.to_square) != 7:             # <<<<<<<<<<<<<<
 *                 return False
 *             elif self.turn == BLACK and square_rank(move.to_square) != 0:
 */
    __pyx_t_1 = ((__pyx_v_self->__pyx_base.turn == 1) != 0);
    if (__pyx_t_1) {
    } else {
      __pyx_t_2 = __pyx_t_1;
      goto __pyx_L10_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyInt_NeObjC(__pyx_t_3, __pyx_int_7, 7, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1661, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __pyx_t_1;
    __pyx_L10_bool_binop_done:;
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":1662
 * 
 *             if self.turn == WHITE and square_rank(move.to_square) != 7:
 *                 return False             # <<<<<<<<<<<<<<
 *             elif self.turn == BLACK and square_rank(move.to_square) != 0:
 *                 return False
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_False);
      __pyx_r = Py_False;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1661
 *                 return False
 * 
 *             if self.turn == WHITE and square_rank(move.to_square) != 7:             # <<<<<<<<<<<<<<
 *                 return False
 *             elif self.turn == BLACK and square_rank(move.to_square) != 0:
 */
    }

    /* "chess/__init__cp.pyx":1663
 *             if self.turn == WHITE and square_rank(move.to_square) != 7:
 *                 return False
 *             elif self.turn == BLACK and square_rank(move.to_square) != 0:             # <<<<<<<<<<<<<<
 *                 return False
 * 
 */
    __pyx_t_1 = ((__pyx_v_self->__pyx_base.turn == 0) != 0);
    if (__pyx_t_1) {
    } else {
      __pyx_t_2 = __pyx_t_1;
      goto __pyx_L12_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1663, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1663, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1663, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyInt_NeObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1663, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1663, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_2 = __pyx_t_1;
    __pyx_L12_bool_binop_done:;
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":1664
 *                 return False
 *             elif self.turn == BLACK and square_rank(move.to_square) != 0:
 *                 return False             # <<<<<<<<<<<<<<
 * 
 *         # Handle castling.
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_False);
      __pyx_r = Py_False;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1663
 *             if self.turn == WHITE and square_rank(move.to_square) != 7:
 *                 return False
 *             elif self.turn == BLACK and square_rank(move.to_square) != 0:             # <<<<<<<<<<<<<<
 *                 return False
 * 
 */
    }

    /* "chess/__init__cp.pyx":1657
 * 
 *         # Only pawns can promote and only on the back rank.
 *         if move.promotion:             # <<<<<<<<<<<<<<
 *             if piece != PAWN:
 *                 return False
 */
  }

  /* "chess/__init__cp.pyx":1667
 * 
 *         # Handle castling.
 *         if piece == KING:             # <<<<<<<<<<<<<<
 *             if move in self.generate_castling_moves():
 *                 return True
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_KING); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1667, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_piece, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1667, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1667, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":1668
 *         # Handle castling.
 *         if piece == KING:
 *             if move in self.generate_castling_moves():             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_castling_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1668, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1668, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_move, __pyx_t_4, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1668, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = (__pyx_t_2 != 0);
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":1669
 *         if piece == KING:
 *             if move in self.generate_castling_moves():
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *         # Destination square can not be occupied.
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1668
 *         # Handle castling.
 *         if piece == KING:
 *             if move in self.generate_castling_moves():             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    }

    /* "chess/__init__cp.pyx":1667
 * 
 *         # Handle castling.
 *         if piece == KING:             # <<<<<<<<<<<<<<
 *             if move in self.generate_castling_moves():
 *                 return True
 */
  }

  /* "chess/__init__cp.pyx":1672
 * 
 *         # Destination square can not be occupied.
 *         if self.occupied_co[self.turn] & to_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[__pyx_v_self->__pyx_base.turn])); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1672, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_v_to_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1672, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1672, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1673
 *         # Destination square can not be occupied.
 *         if self.occupied_co[self.turn] & to_mask:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # Handle pawn moves.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1672
 * 
 *         # Destination square can not be occupied.
 *         if self.occupied_co[self.turn] & to_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1676
 * 
 *         # Handle pawn moves.
 *         if piece == PAWN:             # <<<<<<<<<<<<<<
 *             return move in self.generate_pseudo_legal_moves(from_mask, to_mask)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1676, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_piece, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1676, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1676, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1677
 *         # Handle pawn moves.
 *         if piece == PAWN:
 *             return move in self.generate_pseudo_legal_moves(from_mask, to_mask)             # <<<<<<<<<<<<<<
 * 
 *         # Handle all other pieces.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_from_mask, __pyx_v_to_mask};
      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1677, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_from_mask, __pyx_v_to_mask};
      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1677, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    {
      __pyx_t_6 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1677, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_INCREF(__pyx_v_from_mask);
      __Pyx_GIVEREF(__pyx_v_from_mask);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_7, __pyx_v_from_mask);
      __Pyx_INCREF(__pyx_v_to_mask);
      __Pyx_GIVEREF(__pyx_v_to_mask);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_7, __pyx_v_to_mask);
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1677, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = (__Pyx_PySequence_ContainsTF(__pyx_v_move, __pyx_t_4, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1677, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1676
 * 
 *         # Handle pawn moves.
 *         if piece == PAWN:             # <<<<<<<<<<<<<<
 *             return move in self.generate_pseudo_legal_moves(from_mask, to_mask)
 * 
 */
  }

  /* "chess/__init__cp.pyx":1680
 * 
 *         # Handle all other pieces.
 *         return bool(self.attacks_mask(move.from_square) & to_mask)             # <<<<<<<<<<<<<<
 * 
 *     def is_legal(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_attacks_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_v_to_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1680, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyBool_FromLong((!(!__pyx_t_1))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1634
 *         return king is not None and self.is_attacked_by(self.turn, king)
 * 
 *     def is_pseudo_legal(self, move):             # <<<<<<<<<<<<<<
 *         # Null moves are not pseudo legal.
 *         if not move:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_pseudo_legal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XDECREF(__pyx_v_from_mask);
  __Pyx_XDECREF(__pyx_v_to_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1682
 *         return bool(self.attacks_mask(move.from_square) & to_mask)
 * 
 *     def is_legal(self, move):             # <<<<<<<<<<<<<<
 *         return not self.is_variant_end() and self.is_pseudo_legal(move) and not self.is_into_check(move)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_35is_legal(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_35is_legal(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_legal (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_34is_legal(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_34is_legal(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("is_legal", 0);

  /* "chess/__init__cp.pyx":1683
 * 
 *     def is_legal(self, move):
 *         return not self.is_variant_end() and self.is_pseudo_legal(move) and not self.is_into_check(move)             # <<<<<<<<<<<<<<
 * 
 *     def is_variant_end(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_end); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = (!__pyx_t_5);
  if (__pyx_t_6) {
  } else {
    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1683, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_pseudo_legal); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1683, __pyx_L1_error)
  if (__pyx_t_6) {
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_into_check); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = (!__pyx_t_6);
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1682
 *         return bool(self.attacks_mask(move.from_square) & to_mask)
 * 
 *     def is_legal(self, move):             # <<<<<<<<<<<<<<
 *         return not self.is_variant_end() and self.is_pseudo_legal(move) and not self.is_into_check(move)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_legal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1685
 *         return not self.is_variant_end() and self.is_pseudo_legal(move) and not self.is_into_check(move)
 * 
 *     def is_variant_end(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the game is over due to a special variant end condition.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_37is_variant_end(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_36is_variant_end[] = "\n        Checks if the game is over due to a special variant end condition.\n\n        Note, for example, that stalemate is not considered a variant-specific\n        end condition (this method will return ``False``), yet it can have a\n        special **result** in suicide chess (any of\n        :func:`~chess.Board.is_variant_loss()`,\n        :func:`~chess.Board.is_variant_win()`,\n        :func:`~chess.Board.is_variant_draw()` might return ``True``).\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_37is_variant_end(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_end (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_36is_variant_end(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_36is_variant_end(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_end", 0);

  /* "chess/__init__cp.pyx":1696
 *         :func:`~chess.Board.is_variant_draw()` might return ``True``).
 *         """
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def is_variant_loss(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1685
 *         return not self.is_variant_end() and self.is_pseudo_legal(move) and not self.is_into_check(move)
 * 
 *     def is_variant_end(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the game is over due to a special variant end condition.
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1698
 *         return False
 * 
 *     def is_variant_loss(self):             # <<<<<<<<<<<<<<
 *         """Checks if a special variant-specific loss condition is fulfilled."""
 *         return False
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_39is_variant_loss(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_38is_variant_loss[] = "Checks if a special variant-specific loss condition is fulfilled.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_39is_variant_loss(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_loss (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_38is_variant_loss(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_38is_variant_loss(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_loss", 0);

  /* "chess/__init__cp.pyx":1700
 *     def is_variant_loss(self):
 *         """Checks if a special variant-specific loss condition is fulfilled."""
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def is_variant_win(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1698
 *         return False
 * 
 *     def is_variant_loss(self):             # <<<<<<<<<<<<<<
 *         """Checks if a special variant-specific loss condition is fulfilled."""
 *         return False
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1702
 *         return False
 * 
 *     def is_variant_win(self):             # <<<<<<<<<<<<<<
 *         """Checks if a special variant-specific win condition is fulfilled."""
 *         return False
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_41is_variant_win(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_40is_variant_win[] = "Checks if a special variant-specific win condition is fulfilled.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_41is_variant_win(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_win (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_40is_variant_win(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_40is_variant_win(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_win", 0);

  /* "chess/__init__cp.pyx":1704
 *     def is_variant_win(self):
 *         """Checks if a special variant-specific win condition is fulfilled."""
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def is_variant_draw(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1702
 *         return False
 * 
 *     def is_variant_win(self):             # <<<<<<<<<<<<<<
 *         """Checks if a special variant-specific win condition is fulfilled."""
 *         return False
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1706
 *         return False
 * 
 *     def is_variant_draw(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if a special variant-specific drawing condition is fulfilled.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_43is_variant_draw(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_42is_variant_draw[] = "\n        Checks if a special variant-specific drawing condition is fulfilled.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_43is_variant_draw(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_draw (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_42is_variant_draw(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_42is_variant_draw(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_variant_draw", 0);

  /* "chess/__init__cp.pyx":1710
 *         Checks if a special variant-specific drawing condition is fulfilled.
 *         """
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def is_game_over(self, *, claim_draw=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1706
 *         return False
 * 
 *     def is_variant_draw(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if a special variant-specific drawing condition is fulfilled.
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1712
 *         return False
 * 
 *     def is_game_over(self, *, claim_draw=False):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the game is over due to
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_45is_game_over(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_44is_game_over[] = "\n        Checks if the game is over due to\n        :func:`checkmate <chess.Board.is_checkmate()>`,\n        :func:`stalemate <chess.Board.is_stalemate()>`,\n        :func:`insufficient material <chess.Board.is_insufficient_material()>`,\n        the :func:`seventyfive-move rule <chess.Board.is_seventyfive_moves()>`,\n        :func:`fivefold repetition <chess.Board.is_fivefold_repetition()>`\n        or a :func:`variant end condition <chess.Board.is_variant_end()>`.\n\n        The game is not considered to be over by\n        :func:`threefold repetition <chess.Board.can_claim_threefold_repetition()>`\n        or the :func:`fifty-move rule <chess.Board.can_claim_fifty_moves()>`,\n        unless *claim_draw* is given.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_45is_game_over(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_claim_draw = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_game_over (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_claim_draw,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args == 1) {
        const Py_ssize_t index = 0;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "is_game_over") < 0)) __PYX_ERR(0, 1712, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_claim_draw = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("is_game_over", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1712, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.is_game_over", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_44is_game_over(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_claim_draw);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_44is_game_over(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_claim_draw) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("is_game_over", 0);

  /* "chess/__init__cp.pyx":1728
 *         """
 *         # Seventyfive-move rule.
 *         if self.is_seventyfive_moves():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_seventyfive_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1728, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1728, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1728, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1729
 *         # Seventyfive-move rule.
 *         if self.is_seventyfive_moves():
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # Insufficient material.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1728
 *         """
 *         # Seventyfive-move rule.
 *         if self.is_seventyfive_moves():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1732
 * 
 *         # Insufficient material.
 *         if self.is_insufficient_material():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_insufficient_material); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1732, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1733
 *         # Insufficient material.
 *         if self.is_insufficient_material():
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # Stalemate or checkmate.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1732
 * 
 *         # Insufficient material.
 *         if self.is_insufficient_material():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1736
 * 
 *         # Stalemate or checkmate.
 *         if not any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1736, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1737
 *         # Stalemate or checkmate.
 *         if not any(self.generate_legal_moves()):
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # Fivefold repetition.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1736
 * 
 *         # Stalemate or checkmate.
 *         if not any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1740
 * 
 *         # Fivefold repetition.
 *         if self.is_fivefold_repetition():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_fivefold_repetition); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1740, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1741
 *         # Fivefold repetition.
 *         if self.is_fivefold_repetition():
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # Claim draw.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1740
 * 
 *         # Fivefold repetition.
 *         if self.is_fivefold_repetition():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1744
 * 
 *         # Claim draw.
 *         if claim_draw and self.can_claim_draw():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_claim_draw); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1744, __pyx_L1_error)
  if (__pyx_t_4) {
  } else {
    __pyx_t_5 = __pyx_t_4;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_can_claim_draw); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_t_4;
  __pyx_L8_bool_binop_done:;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1745
 *         # Claim draw.
 *         if claim_draw and self.can_claim_draw():
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1744
 * 
 *         # Claim draw.
 *         if claim_draw and self.can_claim_draw():             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1747
 *             return True
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def result(self, *, claim_draw=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1712
 *         return False
 * 
 *     def is_game_over(self, *, claim_draw=False):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the game is over due to
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_game_over", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1749
 *         return False
 * 
 *     def result(self, *, claim_draw=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the game result.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_47result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_46result[] = "\n        Gets the game result.\n\n        ``1-0``, ``0-1`` or ``1/2-1/2`` if the\n        :func:`game is over <chess.Board.is_game_over()>`. Otherwise, the\n        result is undetermined: ``*``.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_47result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_claim_draw = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("result (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_claim_draw,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args == 1) {
        const Py_ssize_t index = 0;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "result") < 0)) __PYX_ERR(0, 1749, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_claim_draw = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("result", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1749, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_46result(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_claim_draw);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_46result(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_claim_draw) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("result", 0);

  /* "chess/__init__cp.pyx":1758
 *         """
 *         # Chess variant support.
 *         if self.is_variant_loss():             # <<<<<<<<<<<<<<
 *             return "0-1" if self.turn == WHITE else "1-0"
 *         elif self.is_variant_win():
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_loss); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1758, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1759
 *         # Chess variant support.
 *         if self.is_variant_loss():
 *             return "0-1" if self.turn == WHITE else "1-0"             # <<<<<<<<<<<<<<
 *         elif self.is_variant_win():
 *             return "1-0" if self.turn == WHITE else "0-1"
 */
    __Pyx_XDECREF(__pyx_r);
    if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
      __Pyx_INCREF(__pyx_kp_u_0_1);
      __pyx_t_1 = __pyx_kp_u_0_1;
    } else {
      __Pyx_INCREF(__pyx_kp_u_1_0);
      __pyx_t_1 = __pyx_kp_u_1_0;
    }
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1758
 *         """
 *         # Chess variant support.
 *         if self.is_variant_loss():             # <<<<<<<<<<<<<<
 *             return "0-1" if self.turn == WHITE else "1-0"
 *         elif self.is_variant_win():
 */
  }

  /* "chess/__init__cp.pyx":1760
 *         if self.is_variant_loss():
 *             return "0-1" if self.turn == WHITE else "1-0"
 *         elif self.is_variant_win():             # <<<<<<<<<<<<<<
 *             return "1-0" if self.turn == WHITE else "0-1"
 *         elif self.is_variant_draw():
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_win); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1760, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1761
 *             return "0-1" if self.turn == WHITE else "1-0"
 *         elif self.is_variant_win():
 *             return "1-0" if self.turn == WHITE else "0-1"             # <<<<<<<<<<<<<<
 *         elif self.is_variant_draw():
 *             return "1/2-1/2"
 */
    __Pyx_XDECREF(__pyx_r);
    if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
      __Pyx_INCREF(__pyx_kp_u_1_0);
      __pyx_t_1 = __pyx_kp_u_1_0;
    } else {
      __Pyx_INCREF(__pyx_kp_u_0_1);
      __pyx_t_1 = __pyx_kp_u_0_1;
    }
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1760
 *         if self.is_variant_loss():
 *             return "0-1" if self.turn == WHITE else "1-0"
 *         elif self.is_variant_win():             # <<<<<<<<<<<<<<
 *             return "1-0" if self.turn == WHITE else "0-1"
 *         elif self.is_variant_draw():
 */
  }

  /* "chess/__init__cp.pyx":1762
 *         elif self.is_variant_win():
 *             return "1-0" if self.turn == WHITE else "0-1"
 *         elif self.is_variant_draw():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_draw); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1762, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1763
 *             return "1-0" if self.turn == WHITE else "0-1"
 *         elif self.is_variant_draw():
 *             return "1/2-1/2"             # <<<<<<<<<<<<<<
 * 
 *         # Checkmate.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u_1_2_1_2);
    __pyx_r = __pyx_kp_u_1_2_1_2;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1762
 *         elif self.is_variant_win():
 *             return "1-0" if self.turn == WHITE else "0-1"
 *         elif self.is_variant_draw():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  }

  /* "chess/__init__cp.pyx":1766
 * 
 *         # Checkmate.
 *         if self.is_checkmate():             # <<<<<<<<<<<<<<
 *             return "0-1" if self.turn == WHITE else "1-0"
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_checkmate); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1766, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1766, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1766, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1767
 *         # Checkmate.
 *         if self.is_checkmate():
 *             return "0-1" if self.turn == WHITE else "1-0"             # <<<<<<<<<<<<<<
 * 
 *         # Draw claimed.
 */
    __Pyx_XDECREF(__pyx_r);
    if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
      __Pyx_INCREF(__pyx_kp_u_0_1);
      __pyx_t_1 = __pyx_kp_u_0_1;
    } else {
      __Pyx_INCREF(__pyx_kp_u_1_0);
      __pyx_t_1 = __pyx_kp_u_1_0;
    }
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1766
 * 
 *         # Checkmate.
 *         if self.is_checkmate():             # <<<<<<<<<<<<<<
 *             return "0-1" if self.turn == WHITE else "1-0"
 * 
 */
  }

  /* "chess/__init__cp.pyx":1770
 * 
 *         # Draw claimed.
 *         if claim_draw and self.can_claim_draw():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_claim_draw); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1770, __pyx_L1_error)
  if (__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L6_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_can_claim_draw); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1770, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1770, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1770, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __pyx_t_5;
  __pyx_L6_bool_binop_done:;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1771
 *         # Draw claimed.
 *         if claim_draw and self.can_claim_draw():
 *             return "1/2-1/2"             # <<<<<<<<<<<<<<
 * 
 *         # Seventyfive-move rule or fivefold repetition.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u_1_2_1_2);
    __pyx_r = __pyx_kp_u_1_2_1_2;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1770
 * 
 *         # Draw claimed.
 *         if claim_draw and self.can_claim_draw():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  }

  /* "chess/__init__cp.pyx":1774
 * 
 *         # Seventyfive-move rule or fivefold repetition.
 *         if self.is_seventyfive_moves() or self.is_fivefold_repetition():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_seventyfive_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1774, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1774, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1774, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L9_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_fivefold_repetition); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1774, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1774, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1774, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __pyx_t_5;
  __pyx_L9_bool_binop_done:;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1775
 *         # Seventyfive-move rule or fivefold repetition.
 *         if self.is_seventyfive_moves() or self.is_fivefold_repetition():
 *             return "1/2-1/2"             # <<<<<<<<<<<<<<
 * 
 *         # Insufficient material.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u_1_2_1_2);
    __pyx_r = __pyx_kp_u_1_2_1_2;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1774
 * 
 *         # Seventyfive-move rule or fivefold repetition.
 *         if self.is_seventyfive_moves() or self.is_fivefold_repetition():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  }

  /* "chess/__init__cp.pyx":1778
 * 
 *         # Insufficient material.
 *         if self.is_insufficient_material():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_insufficient_material); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1778, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1778, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1778, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1779
 *         # Insufficient material.
 *         if self.is_insufficient_material():
 *             return "1/2-1/2"             # <<<<<<<<<<<<<<
 * 
 *         # Stalemate.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u_1_2_1_2);
    __pyx_r = __pyx_kp_u_1_2_1_2;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1778
 * 
 *         # Insufficient material.
 *         if self.is_insufficient_material():             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  }

  /* "chess/__init__cp.pyx":1782
 * 
 *         # Stalemate.
 *         if not any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1782, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1783
 *         # Stalemate.
 *         if not any(self.generate_legal_moves()):
 *             return "1/2-1/2"             # <<<<<<<<<<<<<<
 * 
 *         # Undetermined.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u_1_2_1_2);
    __pyx_r = __pyx_kp_u_1_2_1_2;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1782
 * 
 *         # Stalemate.
 *         if not any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *             return "1/2-1/2"
 * 
 */
  }

  /* "chess/__init__cp.pyx":1786
 * 
 *         # Undetermined.
 *         return "*"             # <<<<<<<<<<<<<<
 * 
 *     def is_checkmate(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_kp_u__33);
  __pyx_r = __pyx_kp_u__33;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1749
 *         return False
 * 
 *     def result(self, *, claim_draw=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the game result.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1788
 *         return "*"
 * 
 *     def is_checkmate(self):             # <<<<<<<<<<<<<<
 *         """Checks if the current position is a checkmate."""
 *         if not self.is_check():
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_49is_checkmate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_48is_checkmate[] = "Checks if the current position is a checkmate.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_49is_checkmate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_checkmate (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_48is_checkmate(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_48is_checkmate(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("is_checkmate", 0);

  /* "chess/__init__cp.pyx":1790
 *     def is_checkmate(self):
 *         """Checks if the current position is a checkmate."""
 *         if not self.is_check():             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_check); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1790, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1790, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1790, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1791
 *         """Checks if the current position is a checkmate."""
 *         if not self.is_check():
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         return not any(self.generate_legal_moves())
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1790
 *     def is_checkmate(self):
 *         """Checks if the current position is a checkmate."""
 *         if not self.is_check():             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1793
 *             return False
 * 
 *         return not any(self.generate_legal_moves())             # <<<<<<<<<<<<<<
 * 
 *     def is_stalemate(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1788
 *         return "*"
 * 
 *     def is_checkmate(self):             # <<<<<<<<<<<<<<
 *         """Checks if the current position is a checkmate."""
 *         if not self.is_check():
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_checkmate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1795
 *         return not any(self.generate_legal_moves())
 * 
 *     def is_stalemate(self):             # <<<<<<<<<<<<<<
 *         """Checks if the current position is a stalemate."""
 *         if self.is_check():
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_51is_stalemate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_50is_stalemate[] = "Checks if the current position is a stalemate.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_51is_stalemate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_stalemate (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_50is_stalemate(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_50is_stalemate(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("is_stalemate", 0);

  /* "chess/__init__cp.pyx":1797
 *     def is_stalemate(self):
 *         """Checks if the current position is a stalemate."""
 *         if self.is_check():             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_check); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1797, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1798
 *         """Checks if the current position is a stalemate."""
 *         if self.is_check():
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         if self.is_variant_end():
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1797
 *     def is_stalemate(self):
 *         """Checks if the current position is a stalemate."""
 *         if self.is_check():             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1800
 *             return False
 * 
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_end); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1800, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1800, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1800, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":1801
 * 
 *         if self.is_variant_end():
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         return not any(self.generate_legal_moves())
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1800
 *             return False
 * 
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1803
 *             return False
 * 
 *         return not any(self.generate_legal_moves())             # <<<<<<<<<<<<<<
 * 
 *     def is_insufficient_material(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1803, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_4)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1795
 *         return not any(self.generate_legal_moves())
 * 
 *     def is_stalemate(self):             # <<<<<<<<<<<<<<
 *         """Checks if the current position is a stalemate."""
 *         if self.is_check():
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_stalemate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1805
 *         return not any(self.generate_legal_moves())
 * 
 *     def is_insufficient_material(self):             # <<<<<<<<<<<<<<
 *         """Checks for a draw due to insufficient mating material."""
 *         # Enough material to mate.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_53is_insufficient_material(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_52is_insufficient_material[] = "Checks for a draw due to insufficient mating material.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_53is_insufficient_material(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_insufficient_material (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_52is_insufficient_material(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_52is_insufficient_material(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("is_insufficient_material", 0);

  /* "chess/__init__cp.pyx":1808
 *         """Checks for a draw due to insufficient mating material."""
 *         # Enough material to mate.
 *         if self.pawns or self.rooks or self.queens:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_2 = (__pyx_v_self->__pyx_base.pawns != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = (__pyx_v_self->__pyx_base.rooks != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = (__pyx_v_self->__pyx_base.queens != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1809
 *         # Enough material to mate.
 *         if self.pawns or self.rooks or self.queens:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # A single knight or a single bishop.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1808
 *         """Checks for a draw due to insufficient mating material."""
 *         # Enough material to mate.
 *         if self.pawns or self.rooks or self.queens:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1812
 * 
 *         # A single knight or a single bishop.
 *         if popcount(self.occupied) <= 3:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_popcount); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1812, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1812, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1812, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_int_3, Py_LE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1812, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1812, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1813
 *         # A single knight or a single bishop.
 *         if popcount(self.occupied) <= 3:
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # More than a single knight.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1812
 * 
 *         # A single knight or a single bishop.
 *         if popcount(self.occupied) <= 3:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1816
 * 
 *         # More than a single knight.
 *         if self.knights:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_1 = (__pyx_v_self->__pyx_base.knights != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1817
 *         # More than a single knight.
 *         if self.knights:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         # All bishops on the same color.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1816
 * 
 *         # More than a single knight.
 *         if self.knights:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":1820
 * 
 *         # All bishops on the same color.
 *         if self.bishops & BB_DARK_SQUARES == 0:             # <<<<<<<<<<<<<<
 *             return True
 *         elif self.bishops & BB_LIGHT_SQUARES == 0:
 */
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.bishops); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_DARK_SQUARES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1821
 *         # All bishops on the same color.
 *         if self.bishops & BB_DARK_SQUARES == 0:
 *             return True             # <<<<<<<<<<<<<<
 *         elif self.bishops & BB_LIGHT_SQUARES == 0:
 *             return True
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1820
 * 
 *         # All bishops on the same color.
 *         if self.bishops & BB_DARK_SQUARES == 0:             # <<<<<<<<<<<<<<
 *             return True
 *         elif self.bishops & BB_LIGHT_SQUARES == 0:
 */
  }

  /* "chess/__init__cp.pyx":1822
 *         if self.bishops & BB_DARK_SQUARES == 0:
 *             return True
 *         elif self.bishops & BB_LIGHT_SQUARES == 0:             # <<<<<<<<<<<<<<
 *             return True
 *         else:
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.bishops); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_LIGHT_SQUARES); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1823
 *             return True
 *         elif self.bishops & BB_LIGHT_SQUARES == 0:
 *             return True             # <<<<<<<<<<<<<<
 *         else:
 *             return False
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1822
 *         if self.bishops & BB_DARK_SQUARES == 0:
 *             return True
 *         elif self.bishops & BB_LIGHT_SQUARES == 0:             # <<<<<<<<<<<<<<
 *             return True
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":1825
 *             return True
 *         else:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *     def is_seventyfive_moves(self):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":1805
 *         return not any(self.generate_legal_moves())
 * 
 *     def is_insufficient_material(self):             # <<<<<<<<<<<<<<
 *         """Checks for a draw due to insufficient mating material."""
 *         # Enough material to mate.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_insufficient_material", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1827
 *             return False
 * 
 *     def is_seventyfive_moves(self):             # <<<<<<<<<<<<<<
 *         """
 *         Since the 1st of July 2014, a game is automatically drawn (without
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_55is_seventyfive_moves(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_54is_seventyfive_moves[] = "\n        Since the 1st of July 2014, a game is automatically drawn (without\n        a claim by one of the players) if the half-move clock since a capture\n        or pawn move is equal to or grather than 150. Other means to end a game\n        take precedence.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_55is_seventyfive_moves(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_seventyfive_moves (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_54is_seventyfive_moves(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_54is_seventyfive_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("is_seventyfive_moves", 0);

  /* "chess/__init__cp.pyx":1834
 *         take precedence.
 *         """
 *         if self.halfmove_clock >= 150:             # <<<<<<<<<<<<<<
 *             if any(self.generate_legal_moves()):
 *                 return True
 */
  __pyx_t_1 = ((__pyx_v_self->__pyx_base.halfmove_clock >= 0x96) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1835
 *         """
 *         if self.halfmove_clock >= 150:
 *             if any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1835, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1835, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1835, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1835, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":1836
 *         if self.halfmove_clock >= 150:
 *             if any(self.generate_legal_moves()):
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1835
 *         """
 *         if self.halfmove_clock >= 150:
 *             if any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    }

    /* "chess/__init__cp.pyx":1834
 *         take precedence.
 *         """
 *         if self.halfmove_clock >= 150:             # <<<<<<<<<<<<<<
 *             if any(self.generate_legal_moves()):
 *                 return True
 */
  }

  /* "chess/__init__cp.pyx":1838
 *                 return True
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def is_fivefold_repetition(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1827
 *             return False
 * 
 *     def is_seventyfive_moves(self):             # <<<<<<<<<<<<<<
 *         """
 *         Since the 1st of July 2014, a game is automatically drawn (without
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_seventyfive_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1840
 *         return False
 * 
 *     def is_fivefold_repetition(self):             # <<<<<<<<<<<<<<
 *         """
 *         Since the 1st of July 2014 a game is automatically drawn (without
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_57is_fivefold_repetition(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_56is_fivefold_repetition[] = "\n        Since the 1st of July 2014 a game is automatically drawn (without\n        a claim by one of the players) if a position occurs for the fifth time.\n        Originally this had to occur on consecutive alternating moves, but\n        this has since been revised.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_57is_fivefold_repetition(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_fivefold_repetition (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_56is_fivefold_repetition(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_56is_fivefold_repetition(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_transposition_key = NULL;
  PyObject *__pyx_v_repetitions = NULL;
  PyObject *__pyx_v_switchyard = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("is_fivefold_repetition", 0);

  /* "chess/__init__cp.pyx":1847
 *         this has since been revised.
 *         """
 *         transposition_key = self._transposition_key()             # <<<<<<<<<<<<<<
 *         repetitions = 1
 *         switchyard = []
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_transposition_key = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1848
 *         """
 *         transposition_key = self._transposition_key()
 *         repetitions = 1             # <<<<<<<<<<<<<<
 *         switchyard = []
 * 
 */
  __Pyx_INCREF(__pyx_int_1);
  __pyx_v_repetitions = __pyx_int_1;

  /* "chess/__init__cp.pyx":1849
 *         transposition_key = self._transposition_key()
 *         repetitions = 1
 *         switchyard = []             # <<<<<<<<<<<<<<
 * 
 *         while self.move_stack and repetitions < 5:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_switchyard = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1851
 *         switchyard = []
 * 
 *         while self.move_stack and repetitions < 5:             # <<<<<<<<<<<<<<
 *             move = self.pop()
 *             switchyard.append(move)
 */
  while (1) {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.move_stack); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1851, __pyx_L1_error)
    if (__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L5_bool_binop_done;
    }
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_repetitions, __pyx_int_5, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1851, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1851, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __pyx_t_5;
    __pyx_L5_bool_binop_done:;
    if (!__pyx_t_4) break;

    /* "chess/__init__cp.pyx":1852
 * 
 *         while self.move_stack and repetitions < 5:
 *             move = self.pop()             # <<<<<<<<<<<<<<
 *             switchyard.append(move)
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_Pop(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1852, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1853
 *         while self.move_stack and repetitions < 5:
 *             move = self.pop()
 *             switchyard.append(move)             # <<<<<<<<<<<<<<
 * 
 *             if self.is_irreversible(move):
 */
    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_switchyard, __pyx_v_move); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1853, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1855
 *             switchyard.append(move)
 * 
 *             if self.is_irreversible(move):             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_irreversible); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1855, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1855, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1855, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_4) {

      /* "chess/__init__cp.pyx":1856
 * 
 *             if self.is_irreversible(move):
 *                 break             # <<<<<<<<<<<<<<
 * 
 *             if self._transposition_key() == transposition_key:
 */
      goto __pyx_L4_break;

      /* "chess/__init__cp.pyx":1855
 *             switchyard.append(move)
 * 
 *             if self.is_irreversible(move):             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    }

    /* "chess/__init__cp.pyx":1858
 *                 break
 * 
 *             if self._transposition_key() == transposition_key:             # <<<<<<<<<<<<<<
 *                 repetitions += 1
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1858, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1858, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_v_transposition_key, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1858, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1858, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_4) {

      /* "chess/__init__cp.pyx":1859
 * 
 *             if self._transposition_key() == transposition_key:
 *                 repetitions += 1             # <<<<<<<<<<<<<<
 * 
 *         while switchyard:
 */
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_repetitions, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1859, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF_SET(__pyx_v_repetitions, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":1858
 *                 break
 * 
 *             if self._transposition_key() == transposition_key:             # <<<<<<<<<<<<<<
 *                 repetitions += 1
 * 
 */
    }
  }
  __pyx_L4_break:;

  /* "chess/__init__cp.pyx":1861
 *                 repetitions += 1
 * 
 *         while switchyard:             # <<<<<<<<<<<<<<
 *             self.push(switchyard.pop())
 * 
 */
  while (1) {
    __pyx_t_4 = (PyList_GET_SIZE(__pyx_v_switchyard) != 0);
    if (!__pyx_t_4) break;

    /* "chess/__init__cp.pyx":1862
 * 
 *         while switchyard:
 *             self.push(switchyard.pop())             # <<<<<<<<<<<<<<
 * 
 *         return repetitions >= 5
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1862, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyList_Pop(__pyx_v_switchyard); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1862, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1862, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }

  /* "chess/__init__cp.pyx":1864
 *             self.push(switchyard.pop())
 * 
 *         return repetitions >= 5             # <<<<<<<<<<<<<<
 * 
 *     def can_claim_draw(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_repetitions, __pyx_int_5, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1864, __pyx_L1_error)
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1840
 *         return False
 * 
 *     def is_fivefold_repetition(self):             # <<<<<<<<<<<<<<
 *         """
 *         Since the 1st of July 2014 a game is automatically drawn (without
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_fivefold_repetition", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_transposition_key);
  __Pyx_XDECREF(__pyx_v_repetitions);
  __Pyx_XDECREF(__pyx_v_switchyard);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1866
 *         return repetitions >= 5
 * 
 *     def can_claim_draw(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the side to move can claim a draw by the fifty-move rule or
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_59can_claim_draw(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_58can_claim_draw[] = "\n        Checks if the side to move can claim a draw by the fifty-move rule or\n        by threefold repetition.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_59can_claim_draw(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("can_claim_draw (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_58can_claim_draw(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_58can_claim_draw(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("can_claim_draw", 0);

  /* "chess/__init__cp.pyx":1871
 *         by threefold repetition.
 *         """
 *         return self.can_claim_fifty_moves() or self.can_claim_threefold_repetition()             # <<<<<<<<<<<<<<
 * 
 *     def can_claim_fifty_moves(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_can_claim_fifty_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1871, __pyx_L1_error)
  if (!__pyx_t_5) {
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_can_claim_threefold_repetition); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_1 = __pyx_t_2;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1866
 *         return repetitions >= 5
 * 
 *     def can_claim_draw(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the side to move can claim a draw by the fifty-move rule or
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.can_claim_draw", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1873
 *         return self.can_claim_fifty_moves() or self.can_claim_threefold_repetition()
 * 
 *     def can_claim_fifty_moves(self):             # <<<<<<<<<<<<<<
 *         """
 *         Draw by the fifty-move rule can be claimed once the clock of halfmoves
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_61can_claim_fifty_moves(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_60can_claim_fifty_moves[] = "\n        Draw by the fifty-move rule can be claimed once the clock of halfmoves\n        since the last capture or pawn move becomes equal or greater to 100\n        and the side to move still has a legal move they can make.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_61can_claim_fifty_moves(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("can_claim_fifty_moves (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_60can_claim_fifty_moves(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_60can_claim_fifty_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("can_claim_fifty_moves", 0);

  /* "chess/__init__cp.pyx":1880
 *         """
 *         # Fifty-move rule.
 *         if self.halfmove_clock >= 100:             # <<<<<<<<<<<<<<
 *             if any(self.generate_legal_moves()):
 *                 return True
 */
  __pyx_t_1 = ((__pyx_v_self->__pyx_base.halfmove_clock >= 0x64) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":1881
 *         # Fifty-move rule.
 *         if self.halfmove_clock >= 100:
 *             if any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1881, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1881, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1881, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1881, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":1882
 *         if self.halfmove_clock >= 100:
 *             if any(self.generate_legal_moves()):
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1881
 *         # Fifty-move rule.
 *         if self.halfmove_clock >= 100:
 *             if any(self.generate_legal_moves()):             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    }

    /* "chess/__init__cp.pyx":1880
 *         """
 *         # Fifty-move rule.
 *         if self.halfmove_clock >= 100:             # <<<<<<<<<<<<<<
 *             if any(self.generate_legal_moves()):
 *                 return True
 */
  }

  /* "chess/__init__cp.pyx":1884
 *                 return True
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def can_claim_threefold_repetition(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1873
 *         return self.can_claim_fifty_moves() or self.can_claim_threefold_repetition()
 * 
 *     def can_claim_fifty_moves(self):             # <<<<<<<<<<<<<<
 *         """
 *         Draw by the fifty-move rule can be claimed once the clock of halfmoves
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.can_claim_fifty_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1886
 *         return False
 * 
 *     def can_claim_threefold_repetition(self):             # <<<<<<<<<<<<<<
 *         """
 *         Draw by threefold repetition can be claimed if the position on the
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_63can_claim_threefold_repetition(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_62can_claim_threefold_repetition[] = "\n        Draw by threefold repetition can be claimed if the position on the\n        board occured for the third time or if such a repetition is reached\n        with one of the possible legal moves.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_63can_claim_threefold_repetition(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("can_claim_threefold_repetition (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_62can_claim_threefold_repetition(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_62can_claim_threefold_repetition(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_transposition_key = NULL;
  PyObject *__pyx_v_transpositions = NULL;
  PyObject *__pyx_v_switchyard = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  __Pyx_RefNannySetupContext("can_claim_threefold_repetition", 0);

  /* "chess/__init__cp.pyx":1892
 *         with one of the possible legal moves.
 *         """
 *         transposition_key = self._transposition_key()             # <<<<<<<<<<<<<<
 *         transpositions = collections.Counter()
 *         transpositions.update((transposition_key, ))
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_transposition_key = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1893
 *         """
 *         transposition_key = self._transposition_key()
 *         transpositions = collections.Counter()             # <<<<<<<<<<<<<<
 *         transpositions.update((transposition_key, ))
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_collections); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_Counter); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_transpositions = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1894
 *         transposition_key = self._transposition_key()
 *         transpositions = collections.Counter()
 *         transpositions.update((transposition_key, ))             # <<<<<<<<<<<<<<
 * 
 *         # Count positions.
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_transpositions, __pyx_n_s_update); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_transposition_key);
  __Pyx_GIVEREF(__pyx_v_transposition_key);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_transposition_key);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1897
 * 
 *         # Count positions.
 *         switchyard = []             # <<<<<<<<<<<<<<
 *         while self.move_stack:
 *             move = self.pop()
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1897, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_switchyard = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1898
 *         # Count positions.
 *         switchyard = []
 *         while self.move_stack:             # <<<<<<<<<<<<<<
 *             move = self.pop()
 *             switchyard.append(move)
 */
  while (1) {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.move_stack); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1898, __pyx_L1_error)
    if (!__pyx_t_5) break;

    /* "chess/__init__cp.pyx":1899
 *         switchyard = []
 *         while self.move_stack:
 *             move = self.pop()             # <<<<<<<<<<<<<<
 *             switchyard.append(move)
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_Pop(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1899, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1900
 *         while self.move_stack:
 *             move = self.pop()
 *             switchyard.append(move)             # <<<<<<<<<<<<<<
 * 
 *             if self.is_irreversible(move):
 */
    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_switchyard, __pyx_v_move); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1900, __pyx_L1_error)

    /* "chess/__init__cp.pyx":1902
 *             switchyard.append(move)
 * 
 *             if self.is_irreversible(move):             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_irreversible); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1902, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1902, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1902, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":1903
 * 
 *             if self.is_irreversible(move):
 *                 break             # <<<<<<<<<<<<<<
 * 
 *             transpositions.update((self._transposition_key(), ))
 */
      goto __pyx_L4_break;

      /* "chess/__init__cp.pyx":1902
 *             switchyard.append(move)
 * 
 *             if self.is_irreversible(move):             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    }

    /* "chess/__init__cp.pyx":1905
 *                 break
 * 
 *             transpositions.update((self._transposition_key(), ))             # <<<<<<<<<<<<<<
 * 
 *         while switchyard:
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_transpositions, __pyx_n_s_update); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_L4_break:;

  /* "chess/__init__cp.pyx":1907
 *             transpositions.update((self._transposition_key(), ))
 * 
 *         while switchyard:             # <<<<<<<<<<<<<<
 *             self.push(switchyard.pop())
 * 
 */
  while (1) {
    __pyx_t_5 = (PyList_GET_SIZE(__pyx_v_switchyard) != 0);
    if (!__pyx_t_5) break;

    /* "chess/__init__cp.pyx":1908
 * 
 *         while switchyard:
 *             self.push(switchyard.pop())             # <<<<<<<<<<<<<<
 * 
 *         # Threefold repetition occured.
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1908, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyList_Pop(__pyx_v_switchyard); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1908, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1908, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "chess/__init__cp.pyx":1911
 * 
 *         # Threefold repetition occured.
 *         if transpositions[transposition_key] >= 3:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_transpositions, __pyx_v_transposition_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1911, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_int_3, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1911, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1911, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":1912
 *         # Threefold repetition occured.
 *         if transpositions[transposition_key] >= 3:
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # The next legal move is a threefold repetition.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1911
 * 
 *         # Threefold repetition occured.
 *         if transpositions[transposition_key] >= 3:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":1915
 * 
 *         # The next legal move is a threefold repetition.
 *         for move in self.generate_legal_moves():             # <<<<<<<<<<<<<<
 *             self.push(move)
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1915, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1915, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1915, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1915, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_9)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1915, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1915, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1915, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1915, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_9(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1915, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1916
 *         # The next legal move is a threefold repetition.
 *         for move in self.generate_legal_moves():
 *             self.push(move)             # <<<<<<<<<<<<<<
 * 
 *             if transpositions[self._transposition_key()] >= 2:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1916, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_move);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1916, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1918
 *             self.push(move)
 * 
 *             if transpositions[self._transposition_key()] >= 2:             # <<<<<<<<<<<<<<
 *                 self.pop()
 *                 return True
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1918, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1918, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_transpositions, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1918, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_int_2, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1918, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1918, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":1919
 * 
 *             if transpositions[self._transposition_key()] >= 2:
 *                 self.pop()             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
      __pyx_t_3 = __Pyx_PyObject_Pop(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1919, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "chess/__init__cp.pyx":1920
 *             if transpositions[self._transposition_key()] >= 2:
 *                 self.pop()
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *             self.pop()
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":1918
 *             self.push(move)
 * 
 *             if transpositions[self._transposition_key()] >= 2:             # <<<<<<<<<<<<<<
 *                 self.pop()
 *                 return True
 */
    }

    /* "chess/__init__cp.pyx":1922
 *                 return True
 * 
 *             self.pop()             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
    __pyx_t_3 = __Pyx_PyObject_Pop(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1922, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":1915
 * 
 *         # The next legal move is a threefold repetition.
 *         for move in self.generate_legal_moves():             # <<<<<<<<<<<<<<
 *             self.push(move)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1924
 *             self.pop()
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def _push_capture(self, move, capture_square, piece_type, was_promoted):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":1886
 *         return False
 * 
 *     def can_claim_threefold_repetition(self):             # <<<<<<<<<<<<<<
 *         """
 *         Draw by threefold repetition can be claimed if the position on the
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.can_claim_threefold_repetition", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_transposition_key);
  __Pyx_XDECREF(__pyx_v_transpositions);
  __Pyx_XDECREF(__pyx_v_switchyard);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1926
 *         return False
 * 
 *     def _push_capture(self, move, capture_square, piece_type, was_promoted):             # <<<<<<<<<<<<<<
 *         pass
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_65_push_capture(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_65_push_capture(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_move = 0;
  CYTHON_UNUSED PyObject *__pyx_v_capture_square = 0;
  CYTHON_UNUSED PyObject *__pyx_v_piece_type = 0;
  CYTHON_UNUSED PyObject *__pyx_v_was_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_push_capture (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_move,&__pyx_n_s_capture_square,&__pyx_n_s_piece_type,&__pyx_n_s_was_promoted,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_move)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capture_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_push_capture", 1, 4, 4, 1); __PYX_ERR(0, 1926, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_piece_type)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_push_capture", 1, 4, 4, 2); __PYX_ERR(0, 1926, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_was_promoted)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_push_capture", 1, 4, 4, 3); __PYX_ERR(0, 1926, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_push_capture") < 0)) __PYX_ERR(0, 1926, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_move = values[0];
    __pyx_v_capture_square = values[1];
    __pyx_v_piece_type = values[2];
    __pyx_v_was_promoted = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_push_capture", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1926, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._push_capture", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_64_push_capture(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_move, __pyx_v_capture_square, __pyx_v_piece_type, __pyx_v_was_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_64_push_capture(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_move, CYTHON_UNUSED PyObject *__pyx_v_capture_square, CYTHON_UNUSED PyObject *__pyx_v_piece_type, CYTHON_UNUSED PyObject *__pyx_v_was_promoted) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_push_capture", 0);

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":1929
 *         pass
 * 
 *     def push(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Updates the position with the given move and puts it onto the
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_67push(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_66push[] = "\n        Updates the position with the given move and puts it onto the\n        move stack.\n\n        >>> import chess\n        >>>\n        >>> board = chess.Board()\n        >>>\n        >>> Nf3 = chess.Move.from_uci(\"g1f3\")\n        >>> board.push(Nf3)  # Make the move\n\n        >>> board.pop()  # Unmake the last move\n        Move.from_uci('g1f3')\n\n        Null moves just increment the move counters, switch turns and forfeit\n        en passant capturing.\n\n        :warning: Moves are not checked for legality.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_67push(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("push (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_66push(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_66push(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_v_ep_square = NULL;
  PyObject *__pyx_v_from_bb = NULL;
  PyObject *__pyx_v_to_bb = NULL;
  PyObject *__pyx_v_promoted = NULL;
  PyObject *__pyx_v_piece_type = NULL;
  PyObject *__pyx_v_capture_square = NULL;
  PyObject *__pyx_v_captured_piece_type = NULL;
  PyObject *__pyx_v_diff = NULL;
  PyObject *__pyx_v_down = NULL;
  PyObject *__pyx_v_castling = NULL;
  PyObject *__pyx_v_a_side = NULL;
  PyObject *__pyx_v_was_promoted = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  unsigned PY_LONG_LONG __pyx_t_14;
  int __pyx_t_15;
  __Pyx_RefNannySetupContext("push", 0);
  __Pyx_INCREF(__pyx_v_move);

  /* "chess/__init__cp.pyx":1950
 *         """
 *         # Push move and remember board state.
 *         move = self._to_chess960(move)             # <<<<<<<<<<<<<<
 *         self.move_stack.append(self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop))
 *         self.stack.append(_BoardState(self))
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_chess960); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1950, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1950, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_move, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1951
 *         # Push move and remember board state.
 *         move = self._to_chess960(move)
 *         self.move_stack.append(self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop))             # <<<<<<<<<<<<<<
 *         self.stack.append(_BoardState(self))
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_from_chess960); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[6] = {__pyx_t_8, __pyx_t_3, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 5+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1951, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[6] = {__pyx_t_8, __pyx_t_3, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 5+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1951, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else
  #endif
  {
    __pyx_t_10 = PyTuple_New(5+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1951, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    if (__pyx_t_8) {
      __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_10, 2+__pyx_t_9, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_10, 3+__pyx_t_9, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_10, 4+__pyx_t_9, __pyx_t_7);
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1951, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_11 = __Pyx_PyObject_Append(__pyx_v_self->__pyx_base.move_stack, __pyx_t_1); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1951, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1952
 *         move = self._to_chess960(move)
 *         self.move_stack.append(self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop))
 *         self.stack.append(_BoardState(self))             # <<<<<<<<<<<<<<
 * 
 *         # Reset en passant square.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BoardState); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1952, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_10, ((PyObject *)__pyx_v_self)) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_self));
  __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1952, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_11 = __Pyx_PyObject_Append(__pyx_v_self->__pyx_base.stack, __pyx_t_1); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1952, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1955
 * 
 *         # Reset en passant square.
 *         ep_square = self.ep_square             # <<<<<<<<<<<<<<
 *         self.ep_square = None
 * 
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base.ep_square;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_ep_square = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1956
 *         # Reset en passant square.
 *         ep_square = self.ep_square
 *         self.ep_square = None             # <<<<<<<<<<<<<<
 * 
 *         # Increment move counters.
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
  __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
  __pyx_v_self->__pyx_base.ep_square = Py_None;

  /* "chess/__init__cp.pyx":1959
 * 
 *         # Increment move counters.
 *         self.halfmove_clock += 1             # <<<<<<<<<<<<<<
 *         if self.turn == BLACK:
 *             self.fullmove_number += 1
 */
  __pyx_v_self->__pyx_base.halfmove_clock = (__pyx_v_self->__pyx_base.halfmove_clock + 1);

  /* "chess/__init__cp.pyx":1960
 *         # Increment move counters.
 *         self.halfmove_clock += 1
 *         if self.turn == BLACK:             # <<<<<<<<<<<<<<
 *             self.fullmove_number += 1
 * 
 */
  __pyx_t_12 = ((__pyx_v_self->__pyx_base.turn == 0) != 0);
  if (__pyx_t_12) {

    /* "chess/__init__cp.pyx":1961
 *         self.halfmove_clock += 1
 *         if self.turn == BLACK:
 *             self.fullmove_number += 1             # <<<<<<<<<<<<<<
 * 
 *         # On a null move, simply swap turns and reset the en passant square.
 */
    __pyx_v_self->__pyx_base.fullmove_number = (__pyx_v_self->__pyx_base.fullmove_number + 1);

    /* "chess/__init__cp.pyx":1960
 *         # Increment move counters.
 *         self.halfmove_clock += 1
 *         if self.turn == BLACK:             # <<<<<<<<<<<<<<
 *             self.fullmove_number += 1
 * 
 */
  }

  /* "chess/__init__cp.pyx":1964
 * 
 *         # On a null move, simply swap turns and reset the en passant square.
 *         if not move:             # <<<<<<<<<<<<<<
 *             self.turn = not self.turn
 *             return
 */
  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_move); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1964, __pyx_L1_error)
  __pyx_t_13 = ((!__pyx_t_12) != 0);
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":1965
 *         # On a null move, simply swap turns and reset the en passant square.
 *         if not move:
 *             self.turn = not self.turn             # <<<<<<<<<<<<<<
 *             return
 * 
 */
    __pyx_v_self->__pyx_base.turn = (!(__pyx_v_self->__pyx_base.turn != 0));

    /* "chess/__init__cp.pyx":1966
 *         if not move:
 *             self.turn = not self.turn
 *             return             # <<<<<<<<<<<<<<
 * 
 *         # Drops.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1964
 * 
 *         # On a null move, simply swap turns and reset the en passant square.
 *         if not move:             # <<<<<<<<<<<<<<
 *             self.turn = not self.turn
 *             return
 */
  }

  /* "chess/__init__cp.pyx":1969
 * 
 *         # Drops.
 *         if move.drop:             # <<<<<<<<<<<<<<
 *             self._set_piece_at(move.to_square, move.drop, self.turn)
 *             self.turn = not self.turn
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1969, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 1969, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":1970
 *         # Drops.
 *         if move.drop:
 *             self._set_piece_at(move.to_square, move.drop, self.turn)             # <<<<<<<<<<<<<<
 *             self.turn = not self.turn
 *             return
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1970, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1970, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1970, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1970, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_10, __pyx_t_7, __pyx_t_6};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1970, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_10, __pyx_t_7, __pyx_t_6};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1970, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1970, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_9, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_9, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_9, __pyx_t_6);
      __pyx_t_10 = 0;
      __pyx_t_7 = 0;
      __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1970, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":1971
 *         if move.drop:
 *             self._set_piece_at(move.to_square, move.drop, self.turn)
 *             self.turn = not self.turn             # <<<<<<<<<<<<<<
 *             return
 * 
 */
    __pyx_v_self->__pyx_base.turn = (!(__pyx_v_self->__pyx_base.turn != 0));

    /* "chess/__init__cp.pyx":1972
 *             self._set_piece_at(move.to_square, move.drop, self.turn)
 *             self.turn = not self.turn
 *             return             # <<<<<<<<<<<<<<
 * 
 *         # Zero the half-move clock.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":1969
 * 
 *         # Drops.
 *         if move.drop:             # <<<<<<<<<<<<<<
 *             self._set_piece_at(move.to_square, move.drop, self.turn)
 *             self.turn = not self.turn
 */
  }

  /* "chess/__init__cp.pyx":1975
 * 
 *         # Zero the half-move clock.
 *         if self.is_zeroing(move):             # <<<<<<<<<<<<<<
 *             self.halfmove_clock = 0
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_zeroing); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1975, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1975, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 1975, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":1976
 *         # Zero the half-move clock.
 *         if self.is_zeroing(move):
 *             self.halfmove_clock = 0             # <<<<<<<<<<<<<<
 * 
 *         from_bb = BB_SQUARES[move.from_square]
 */
    __pyx_v_self->__pyx_base.halfmove_clock = 0;

    /* "chess/__init__cp.pyx":1975
 * 
 *         # Zero the half-move clock.
 *         if self.is_zeroing(move):             # <<<<<<<<<<<<<<
 *             self.halfmove_clock = 0
 * 
 */
  }

  /* "chess/__init__cp.pyx":1978
 *             self.halfmove_clock = 0
 * 
 *         from_bb = BB_SQUARES[move.from_square]             # <<<<<<<<<<<<<<
 *         to_bb = BB_SQUARES[move.to_square]
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1978, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1978, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1978, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_from_bb = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":1979
 * 
 *         from_bb = BB_SQUARES[move.from_square]
 *         to_bb = BB_SQUARES[move.to_square]             # <<<<<<<<<<<<<<
 * 
 *         promoted = self.promoted & from_bb
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1979, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1979, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1979, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_to_bb = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1981
 *         to_bb = BB_SQUARES[move.to_square]
 * 
 *         promoted = self.promoted & from_bb             # <<<<<<<<<<<<<<
 *         piece_type = self._remove_piece_at(move.from_square)
 *         capture_square = move.to_square
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1981, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_from_bb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1981, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_promoted = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1982
 * 
 *         promoted = self.promoted & from_bb
 *         piece_type = self._remove_piece_at(move.from_square)             # <<<<<<<<<<<<<<
 *         capture_square = move.to_square
 *         captured_piece_type = self.piece_type_at(capture_square)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1982, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1982, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1982, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_piece_type = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1983
 *         promoted = self.promoted & from_bb
 *         piece_type = self._remove_piece_at(move.from_square)
 *         capture_square = move.to_square             # <<<<<<<<<<<<<<
 *         captured_piece_type = self.piece_type_at(capture_square)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1983, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_capture_square = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1984
 *         piece_type = self._remove_piece_at(move.from_square)
 *         capture_square = move.to_square
 *         captured_piece_type = self.piece_type_at(capture_square)             # <<<<<<<<<<<<<<
 * 
 *         # Update castling rights.
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_type_at); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1984, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_v_capture_square) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_capture_square);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1984, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_captured_piece_type = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":1987
 * 
 *         # Update castling rights.
 *         self.castling_rights = self.clean_castling_rights() & ~to_bb & ~from_bb             # <<<<<<<<<<<<<<
 *         if piece_type == KING and not promoted:
 *             if self.turn == WHITE:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Invert(__pyx_v_to_bb); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Invert(__pyx_v_from_bb); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_14 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_14 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1987, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_self->__pyx_base.castling_rights = __pyx_t_14;

  /* "chess/__init__cp.pyx":1988
 *         # Update castling rights.
 *         self.castling_rights = self.clean_castling_rights() & ~to_bb & ~from_bb
 *         if piece_type == KING and not promoted:             # <<<<<<<<<<<<<<
 *             if self.turn == WHITE:
 *                 self.castling_rights &= ~BB_RANK_1
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KING); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1988, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1988, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_12) {
  } else {
    __pyx_t_13 = __pyx_t_12;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_promoted); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1988, __pyx_L1_error)
  __pyx_t_15 = ((!__pyx_t_12) != 0);
  __pyx_t_13 = __pyx_t_15;
  __pyx_L8_bool_binop_done:;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":1989
 *         self.castling_rights = self.clean_castling_rights() & ~to_bb & ~from_bb
 *         if piece_type == KING and not promoted:
 *             if self.turn == WHITE:             # <<<<<<<<<<<<<<
 *                 self.castling_rights &= ~BB_RANK_1
 *             else:
 */
    __pyx_t_13 = ((__pyx_v_self->__pyx_base.turn == 1) != 0);
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":1990
 *         if piece_type == KING and not promoted:
 *             if self.turn == WHITE:
 *                 self.castling_rights &= ~BB_RANK_1             # <<<<<<<<<<<<<<
 *             else:
 *                 self.castling_rights &= ~BB_RANK_8
 */
      __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1990, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1990, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1990, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1990, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_14 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_2); if (unlikely((__pyx_t_14 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1990, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_self->__pyx_base.castling_rights = __pyx_t_14;

      /* "chess/__init__cp.pyx":1989
 *         self.castling_rights = self.clean_castling_rights() & ~to_bb & ~from_bb
 *         if piece_type == KING and not promoted:
 *             if self.turn == WHITE:             # <<<<<<<<<<<<<<
 *                 self.castling_rights &= ~BB_RANK_1
 *             else:
 */
      goto __pyx_L10;
    }

    /* "chess/__init__cp.pyx":1992
 *                 self.castling_rights &= ~BB_RANK_1
 *             else:
 *                 self.castling_rights &= ~BB_RANK_8             # <<<<<<<<<<<<<<
 *         elif captured_piece_type == KING and not self.promoted & to_bb:
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:
 */
    /*else*/ {
      __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1992, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1992, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = PyNumber_Invert(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1992, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_InPlaceAnd(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1992, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_14 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_14 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1992, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_self->__pyx_base.castling_rights = __pyx_t_14;
    }
    __pyx_L10:;

    /* "chess/__init__cp.pyx":1988
 *         # Update castling rights.
 *         self.castling_rights = self.clean_castling_rights() & ~to_bb & ~from_bb
 *         if piece_type == KING and not promoted:             # <<<<<<<<<<<<<<
 *             if self.turn == WHITE:
 *                 self.castling_rights &= ~BB_RANK_1
 */
    goto __pyx_L7;
  }

  /* "chess/__init__cp.pyx":1993
 *             else:
 *                 self.castling_rights &= ~BB_RANK_8
 *         elif captured_piece_type == KING and not self.promoted & to_bb:             # <<<<<<<<<<<<<<
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:
 *                 self.castling_rights &= ~BB_RANK_8
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_KING); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_captured_piece_type, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_15) {
  } else {
    __pyx_t_13 = __pyx_t_15;
    goto __pyx_L11_bool_binop_done;
  }
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_1, __pyx_v_to_bb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_12 = ((!__pyx_t_15) != 0);
  __pyx_t_13 = __pyx_t_12;
  __pyx_L11_bool_binop_done:;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":1994
 *                 self.castling_rights &= ~BB_RANK_8
 *         elif captured_piece_type == KING and not self.promoted & to_bb:
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:             # <<<<<<<<<<<<<<
 *                 self.castling_rights &= ~BB_RANK_8
 *             elif self.turn == BLACK and square_rank(move.to_square) == 0:
 */
    __pyx_t_12 = ((__pyx_v_self->__pyx_base.turn == 1) != 0);
    if (__pyx_t_12) {
    } else {
      __pyx_t_13 = __pyx_t_12;
      goto __pyx_L14_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1994, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1994, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1994, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_7, 7, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1994, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1994, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_13 = __pyx_t_12;
    __pyx_L14_bool_binop_done:;
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":1995
 *         elif captured_piece_type == KING and not self.promoted & to_bb:
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:
 *                 self.castling_rights &= ~BB_RANK_8             # <<<<<<<<<<<<<<
 *             elif self.turn == BLACK and square_rank(move.to_square) == 0:
 *                 self.castling_rights &= ~BB_RANK_1
 */
      __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1995, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1995, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = PyNumber_Invert(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1995, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1995, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_14 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_14 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1995, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_self->__pyx_base.castling_rights = __pyx_t_14;

      /* "chess/__init__cp.pyx":1994
 *                 self.castling_rights &= ~BB_RANK_8
 *         elif captured_piece_type == KING and not self.promoted & to_bb:
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:             # <<<<<<<<<<<<<<
 *                 self.castling_rights &= ~BB_RANK_8
 *             elif self.turn == BLACK and square_rank(move.to_square) == 0:
 */
      goto __pyx_L13;
    }

    /* "chess/__init__cp.pyx":1996
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:
 *                 self.castling_rights &= ~BB_RANK_8
 *             elif self.turn == BLACK and square_rank(move.to_square) == 0:             # <<<<<<<<<<<<<<
 *                 self.castling_rights &= ~BB_RANK_1
 * 
 */
    __pyx_t_12 = ((__pyx_v_self->__pyx_base.turn == 0) != 0);
    if (__pyx_t_12) {
    } else {
      __pyx_t_13 = __pyx_t_12;
      goto __pyx_L16_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1996, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1996, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1996, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1996, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1996, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_13 = __pyx_t_12;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":1997
 *                 self.castling_rights &= ~BB_RANK_8
 *             elif self.turn == BLACK and square_rank(move.to_square) == 0:
 *                 self.castling_rights &= ~BB_RANK_1             # <<<<<<<<<<<<<<
 * 
 *         # Handle special pawn moves.
 */
      __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1997, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1997, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = PyNumber_Invert(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1997, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_InPlaceAnd(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1997, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_14 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_14 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 1997, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_self->__pyx_base.castling_rights = __pyx_t_14;

      /* "chess/__init__cp.pyx":1996
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:
 *                 self.castling_rights &= ~BB_RANK_8
 *             elif self.turn == BLACK and square_rank(move.to_square) == 0:             # <<<<<<<<<<<<<<
 *                 self.castling_rights &= ~BB_RANK_1
 * 
 */
    }
    __pyx_L13:;

    /* "chess/__init__cp.pyx":1993
 *             else:
 *                 self.castling_rights &= ~BB_RANK_8
 *         elif captured_piece_type == KING and not self.promoted & to_bb:             # <<<<<<<<<<<<<<
 *             if self.turn == WHITE and square_rank(move.to_square) == 7:
 *                 self.castling_rights &= ~BB_RANK_8
 */
  }
  __pyx_L7:;

  /* "chess/__init__cp.pyx":2000
 * 
 *         # Handle special pawn moves.
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             diff = move.to_square - move.from_square
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2000, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2000, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 2000, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":2001
 *         # Handle special pawn moves.
 *         if piece_type == PAWN:
 *             diff = move.to_square - move.from_square             # <<<<<<<<<<<<<<
 * 
 *             if diff == 16 and square_rank(move.from_square) == 1:
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2001, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2001, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_Subtract(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2001, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_diff = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2003
 *             diff = move.to_square - move.from_square
 * 
 *             if diff == 16 and square_rank(move.from_square) == 1:             # <<<<<<<<<<<<<<
 *                 self.ep_square = move.from_square + 8
 *             elif diff == -16 and square_rank(move.from_square) == 6:
 */
    __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_v_diff, __pyx_int_16, 16, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_12) {
    } else {
      __pyx_t_13 = __pyx_t_12;
      goto __pyx_L20_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_t_2, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 2003, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_13 = __pyx_t_12;
    __pyx_L20_bool_binop_done:;
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":2004
 * 
 *             if diff == 16 and square_rank(move.from_square) == 1:
 *                 self.ep_square = move.from_square + 8             # <<<<<<<<<<<<<<
 *             elif diff == -16 and square_rank(move.from_square) == 6:
 *                 self.ep_square = move.from_square - 8
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2004, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2004, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GIVEREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
      __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
      __pyx_v_self->__pyx_base.ep_square = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":2003
 *             diff = move.to_square - move.from_square
 * 
 *             if diff == 16 and square_rank(move.from_square) == 1:             # <<<<<<<<<<<<<<
 *                 self.ep_square = move.from_square + 8
 *             elif diff == -16 and square_rank(move.from_square) == 6:
 */
      goto __pyx_L19;
    }

    /* "chess/__init__cp.pyx":2005
 *             if diff == 16 and square_rank(move.from_square) == 1:
 *                 self.ep_square = move.from_square + 8
 *             elif diff == -16 and square_rank(move.from_square) == 6:             # <<<<<<<<<<<<<<
 *                 self.ep_square = move.from_square - 8
 *             elif move.to_square == ep_square and abs(diff) in [7, 9] and not captured_piece_type:
 */
    __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_v_diff, __pyx_int_neg_16, -16L, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_12) {
    } else {
      __pyx_t_13 = __pyx_t_12;
      goto __pyx_L22_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_t_2, __pyx_int_6, 6, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 2005, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_13 = __pyx_t_12;
    __pyx_L22_bool_binop_done:;
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":2006
 *                 self.ep_square = move.from_square + 8
 *             elif diff == -16 and square_rank(move.from_square) == 6:
 *                 self.ep_square = move.from_square - 8             # <<<<<<<<<<<<<<
 *             elif move.to_square == ep_square and abs(diff) in [7, 9] and not captured_piece_type:
 *                 # Remove pawns captured en passant.
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2006, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_8, 8, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2006, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GIVEREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
      __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
      __pyx_v_self->__pyx_base.ep_square = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":2005
 *             if diff == 16 and square_rank(move.from_square) == 1:
 *                 self.ep_square = move.from_square + 8
 *             elif diff == -16 and square_rank(move.from_square) == 6:             # <<<<<<<<<<<<<<
 *                 self.ep_square = move.from_square - 8
 *             elif move.to_square == ep_square and abs(diff) in [7, 9] and not captured_piece_type:
 */
      goto __pyx_L19;
    }

    /* "chess/__init__cp.pyx":2007
 *             elif diff == -16 and square_rank(move.from_square) == 6:
 *                 self.ep_square = move.from_square - 8
 *             elif move.to_square == ep_square and abs(diff) in [7, 9] and not captured_piece_type:             # <<<<<<<<<<<<<<
 *                 # Remove pawns captured en passant.
 *                 down = -8 if self.turn == WHITE else 8
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_v_ep_square, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_12) {
    } else {
      __pyx_t_13 = __pyx_t_12;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_4 = __Pyx_PyNumber_Absolute(__pyx_v_diff); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_7, 7, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!__pyx_t_15) {
    } else {
      __pyx_t_12 = __pyx_t_15;
      goto __pyx_L27_bool_binop_done;
    }
    __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_9, 9, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __pyx_t_15;
    __pyx_L27_bool_binop_done:;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_15 = (__pyx_t_12 != 0);
    if (__pyx_t_15) {
    } else {
      __pyx_t_13 = __pyx_t_15;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_v_captured_piece_type); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 2007, __pyx_L1_error)
    __pyx_t_12 = ((!__pyx_t_15) != 0);
    __pyx_t_13 = __pyx_t_12;
    __pyx_L24_bool_binop_done:;
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":2009
 *             elif move.to_square == ep_square and abs(diff) in [7, 9] and not captured_piece_type:
 *                 # Remove pawns captured en passant.
 *                 down = -8 if self.turn == WHITE else 8             # <<<<<<<<<<<<<<
 *                 capture_square = ep_square + down
 *                 captured_piece_type = self._remove_piece_at(capture_square)
 */
      if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
        __Pyx_INCREF(__pyx_int_neg_8);
        __pyx_t_4 = __pyx_int_neg_8;
      } else {
        __Pyx_INCREF(__pyx_int_8);
        __pyx_t_4 = __pyx_int_8;
      }
      __pyx_v_down = __pyx_t_4;
      __pyx_t_4 = 0;

      /* "chess/__init__cp.pyx":2010
 *                 # Remove pawns captured en passant.
 *                 down = -8 if self.turn == WHITE else 8
 *                 capture_square = ep_square + down             # <<<<<<<<<<<<<<
 *                 captured_piece_type = self._remove_piece_at(capture_square)
 * 
 */
      __pyx_t_4 = PyNumber_Add(__pyx_v_ep_square, __pyx_v_down); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2010, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF_SET(__pyx_v_capture_square, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "chess/__init__cp.pyx":2011
 *                 down = -8 if self.turn == WHITE else 8
 *                 capture_square = ep_square + down
 *                 captured_piece_type = self._remove_piece_at(capture_square)             # <<<<<<<<<<<<<<
 * 
 *         # Promotion.
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2011, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_v_capture_square) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_capture_square);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2011, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF_SET(__pyx_v_captured_piece_type, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "chess/__init__cp.pyx":2007
 *             elif diff == -16 and square_rank(move.from_square) == 6:
 *                 self.ep_square = move.from_square - 8
 *             elif move.to_square == ep_square and abs(diff) in [7, 9] and not captured_piece_type:             # <<<<<<<<<<<<<<
 *                 # Remove pawns captured en passant.
 *                 down = -8 if self.turn == WHITE else 8
 */
    }
    __pyx_L19:;

    /* "chess/__init__cp.pyx":2000
 * 
 *         # Handle special pawn moves.
 *         if piece_type == PAWN:             # <<<<<<<<<<<<<<
 *             diff = move.to_square - move.from_square
 * 
 */
  }

  /* "chess/__init__cp.pyx":2014
 * 
 *         # Promotion.
 *         if move.promotion:             # <<<<<<<<<<<<<<
 *             promoted = True
 *             piece_type = move.promotion
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2014, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 2014, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":2015
 *         # Promotion.
 *         if move.promotion:
 *             promoted = True             # <<<<<<<<<<<<<<
 *             piece_type = move.promotion
 * 
 */
    __Pyx_INCREF(Py_True);
    __Pyx_DECREF_SET(__pyx_v_promoted, Py_True);

    /* "chess/__init__cp.pyx":2016
 *         if move.promotion:
 *             promoted = True
 *             piece_type = move.promotion             # <<<<<<<<<<<<<<
 * 
 *         # Castling.
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2016, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF_SET(__pyx_v_piece_type, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2014
 * 
 *         # Promotion.
 *         if move.promotion:             # <<<<<<<<<<<<<<
 *             promoted = True
 *             piece_type = move.promotion
 */
  }

  /* "chess/__init__cp.pyx":2019
 * 
 *         # Castling.
 *         castling = piece_type == KING and self.occupied_co[self.turn] & to_bb             # <<<<<<<<<<<<<<
 *         if castling:
 *             a_side = square_file(move.to_square) < square_file(move.from_square)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_KING); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2019, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_piece_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2019, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 2019, __pyx_L1_error)
  if (__pyx_t_13) {
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L30_bool_binop_done;
  }
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[__pyx_v_self->__pyx_base.turn])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2019, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_to_bb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2019, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_4 = __pyx_t_2;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_L30_bool_binop_done:;
  __pyx_v_castling = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":2020
 *         # Castling.
 *         castling = piece_type == KING and self.occupied_co[self.turn] & to_bb
 *         if castling:             # <<<<<<<<<<<<<<
 *             a_side = square_file(move.to_square) < square_file(move.from_square)
 * 
 */
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_castling); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 2020, __pyx_L1_error)
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":2021
 *         castling = piece_type == KING and self.occupied_co[self.turn] & to_bb
 *         if castling:
 *             a_side = square_file(move.to_square) < square_file(move.from_square)             # <<<<<<<<<<<<<<
 * 
 *             self._remove_piece_at(move.from_square)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_square_file); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_square_file); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_t_2, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2021, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_a_side = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2023
 *             a_side = square_file(move.to_square) < square_file(move.from_square)
 * 
 *             self._remove_piece_at(move.from_square)             # <<<<<<<<<<<<<<
 *             self._remove_piece_at(move.to_square)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2023, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2023, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2023, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2024
 * 
 *             self._remove_piece_at(move.from_square)
 *             self._remove_piece_at(move.to_square)             # <<<<<<<<<<<<<<
 * 
 *             if a_side:
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2024, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2024, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2024, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2026
 *             self._remove_piece_at(move.to_square)
 * 
 *             if a_side:             # <<<<<<<<<<<<<<
 *                 self._set_piece_at(C1 if self.turn == WHITE else C8, KING, self.turn)
 *                 self._set_piece_at(D1 if self.turn == WHITE else D8, ROOK, self.turn)
 */
    __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_a_side); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 2026, __pyx_L1_error)
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":2027
 * 
 *             if a_side:
 *                 self._set_piece_at(C1 if self.turn == WHITE else C8, KING, self.turn)             # <<<<<<<<<<<<<<
 *                 self._set_piece_at(D1 if self.turn == WHITE else D8, ROOK, self.turn)
 *             else:
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2027, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_C1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2027, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_4 = __pyx_t_6;
        __pyx_t_6 = 0;
      } else {
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_C8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2027, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_4 = __pyx_t_6;
        __pyx_t_6 = 0;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_KING); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2027, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2027, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_10 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_9 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_t_4, __pyx_t_6, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2027, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_t_4, __pyx_t_6, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2027, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      {
        __pyx_t_5 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2027, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (__pyx_t_10) {
          __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_10); __pyx_t_10 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_9, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_9, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_9, __pyx_t_7);
        __pyx_t_4 = 0;
        __pyx_t_6 = 0;
        __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2027, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":2028
 *             if a_side:
 *                 self._set_piece_at(C1 if self.turn == WHITE else C8, KING, self.turn)
 *                 self._set_piece_at(D1 if self.turn == WHITE else D8, ROOK, self.turn)             # <<<<<<<<<<<<<<
 *             else:
 *                 self._set_piece_at(G1 if self.turn == WHITE else G8, KING, self.turn)
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2028, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_D1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2028, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_5 = __pyx_t_7;
        __pyx_t_7 = 0;
      } else {
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_D8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2028, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_5 = __pyx_t_7;
        __pyx_t_7 = 0;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2028, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2028, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_9 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_t_5, __pyx_t_7, __pyx_t_6};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2028, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_t_5, __pyx_t_7, __pyx_t_6};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2028, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_10 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2028, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        if (__pyx_t_4) {
          __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_4); __pyx_t_4 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_10, 2+__pyx_t_9, __pyx_t_6);
        __pyx_t_5 = 0;
        __pyx_t_7 = 0;
        __pyx_t_6 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2028, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":2026
 *             self._remove_piece_at(move.to_square)
 * 
 *             if a_side:             # <<<<<<<<<<<<<<
 *                 self._set_piece_at(C1 if self.turn == WHITE else C8, KING, self.turn)
 *                 self._set_piece_at(D1 if self.turn == WHITE else D8, ROOK, self.turn)
 */
      goto __pyx_L33;
    }

    /* "chess/__init__cp.pyx":2030
 *                 self._set_piece_at(D1 if self.turn == WHITE else D8, ROOK, self.turn)
 *             else:
 *                 self._set_piece_at(G1 if self.turn == WHITE else G8, KING, self.turn)             # <<<<<<<<<<<<<<
 *                 self._set_piece_at(F1 if self.turn == WHITE else F8, ROOK, self.turn)
 * 
 */
    /*else*/ {
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2030, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_G1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2030, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_10 = __pyx_t_6;
        __pyx_t_6 = 0;
      } else {
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_G8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2030, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_10 = __pyx_t_6;
        __pyx_t_6 = 0;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_KING); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2030, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2030, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_9 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_10, __pyx_t_6, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2030, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_10, __pyx_t_6, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2030, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      {
        __pyx_t_4 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2030, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        if (__pyx_t_5) {
          __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_9, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_9, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_9, __pyx_t_7);
        __pyx_t_10 = 0;
        __pyx_t_6 = 0;
        __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2030, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":2031
 *             else:
 *                 self._set_piece_at(G1 if self.turn == WHITE else G8, KING, self.turn)
 *                 self._set_piece_at(F1 if self.turn == WHITE else F8, ROOK, self.turn)             # <<<<<<<<<<<<<<
 * 
 *         # Put the piece on the target square.
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2031, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_F1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2031, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = __pyx_t_7;
        __pyx_t_7 = 0;
      } else {
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_F8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2031, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = __pyx_t_7;
        __pyx_t_7 = 0;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_ROOK); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2031, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2031, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_9 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_t_4, __pyx_t_7, __pyx_t_6};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2031, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_t_4, __pyx_t_7, __pyx_t_6};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2031, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_5 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2031, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (__pyx_t_10) {
          __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_10); __pyx_t_10 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_9, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_9, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_9, __pyx_t_6);
        __pyx_t_4 = 0;
        __pyx_t_7 = 0;
        __pyx_t_6 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2031, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_L33:;

    /* "chess/__init__cp.pyx":2020
 *         # Castling.
 *         castling = piece_type == KING and self.occupied_co[self.turn] & to_bb
 *         if castling:             # <<<<<<<<<<<<<<
 *             a_side = square_file(move.to_square) < square_file(move.from_square)
 * 
 */
  }

  /* "chess/__init__cp.pyx":2034
 * 
 *         # Put the piece on the target square.
 *         if not castling and piece_type:             # <<<<<<<<<<<<<<
 *             was_promoted = self.promoted & to_bb
 *             self._set_piece_at(move.to_square, piece_type, self.turn, promoted)
 */
  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_castling); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 2034, __pyx_L1_error)
  __pyx_t_15 = ((!__pyx_t_12) != 0);
  if (__pyx_t_15) {
  } else {
    __pyx_t_13 = __pyx_t_15;
    goto __pyx_L35_bool_binop_done;
  }
  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_v_piece_type); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 2034, __pyx_L1_error)
  __pyx_t_13 = __pyx_t_15;
  __pyx_L35_bool_binop_done:;
  if (__pyx_t_13) {

    /* "chess/__init__cp.pyx":2035
 *         # Put the piece on the target square.
 *         if not castling and piece_type:
 *             was_promoted = self.promoted & to_bb             # <<<<<<<<<<<<<<
 *             self._set_piece_at(move.to_square, piece_type, self.turn, promoted)
 * 
 */
    __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.promoted); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2035, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_to_bb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2035, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_was_promoted = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2036
 *         if not castling and piece_type:
 *             was_promoted = self.promoted & to_bb
 *             self._set_piece_at(move.to_square, piece_type, self.turn, promoted)             # <<<<<<<<<<<<<<
 * 
 *             if captured_piece_type:
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_piece_at); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2036, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2036, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2036, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_t_5, __pyx_v_piece_type, __pyx_t_6, __pyx_v_promoted};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 4+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2036, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_t_5, __pyx_v_piece_type, __pyx_t_6, __pyx_v_promoted};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 4+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2036, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(4+__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2036, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_9, __pyx_t_5);
      __Pyx_INCREF(__pyx_v_piece_type);
      __Pyx_GIVEREF(__pyx_v_piece_type);
      PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_9, __pyx_v_piece_type);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_9, __pyx_t_6);
      __Pyx_INCREF(__pyx_v_promoted);
      __Pyx_GIVEREF(__pyx_v_promoted);
      PyTuple_SET_ITEM(__pyx_t_4, 3+__pyx_t_9, __pyx_v_promoted);
      __pyx_t_5 = 0;
      __pyx_t_6 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2036, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2038
 *             self._set_piece_at(move.to_square, piece_type, self.turn, promoted)
 * 
 *             if captured_piece_type:             # <<<<<<<<<<<<<<
 *                 self._push_capture(move, capture_square, captured_piece_type, was_promoted)
 * 
 */
    __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_captured_piece_type); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 2038, __pyx_L1_error)
    if (__pyx_t_13) {

      /* "chess/__init__cp.pyx":2039
 * 
 *             if captured_piece_type:
 *                 self._push_capture(move, capture_square, captured_piece_type, was_promoted)             # <<<<<<<<<<<<<<
 * 
 *         # Swap turn.
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push_capture); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2039, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_9 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[5] = {__pyx_t_4, __pyx_v_move, __pyx_v_capture_square, __pyx_v_captured_piece_type, __pyx_v_was_promoted};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 4+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2039, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[5] = {__pyx_t_4, __pyx_v_move, __pyx_v_capture_square, __pyx_v_captured_piece_type, __pyx_v_was_promoted};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 4+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2039, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else
      #endif
      {
        __pyx_t_6 = PyTuple_New(4+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2039, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        if (__pyx_t_4) {
          __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
        }
        __Pyx_INCREF(__pyx_v_move);
        __Pyx_GIVEREF(__pyx_v_move);
        PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_9, __pyx_v_move);
        __Pyx_INCREF(__pyx_v_capture_square);
        __Pyx_GIVEREF(__pyx_v_capture_square);
        PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_9, __pyx_v_capture_square);
        __Pyx_INCREF(__pyx_v_captured_piece_type);
        __Pyx_GIVEREF(__pyx_v_captured_piece_type);
        PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_9, __pyx_v_captured_piece_type);
        __Pyx_INCREF(__pyx_v_was_promoted);
        __Pyx_GIVEREF(__pyx_v_was_promoted);
        PyTuple_SET_ITEM(__pyx_t_6, 3+__pyx_t_9, __pyx_v_was_promoted);
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2039, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":2038
 *             self._set_piece_at(move.to_square, piece_type, self.turn, promoted)
 * 
 *             if captured_piece_type:             # <<<<<<<<<<<<<<
 *                 self._push_capture(move, capture_square, captured_piece_type, was_promoted)
 * 
 */
    }

    /* "chess/__init__cp.pyx":2034
 * 
 *         # Put the piece on the target square.
 *         if not castling and piece_type:             # <<<<<<<<<<<<<<
 *             was_promoted = self.promoted & to_bb
 *             self._set_piece_at(move.to_square, piece_type, self.turn, promoted)
 */
  }

  /* "chess/__init__cp.pyx":2042
 * 
 *         # Swap turn.
 *         self.turn = not self.turn             # <<<<<<<<<<<<<<
 * 
 *     def pop(self):
 */
  __pyx_v_self->__pyx_base.turn = (!(__pyx_v_self->__pyx_base.turn != 0));

  /* "chess/__init__cp.pyx":1929
 *         pass
 * 
 *     def push(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Updates the position with the given move and puts it onto the
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("chess.__init__cp.Board.push", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ep_square);
  __Pyx_XDECREF(__pyx_v_from_bb);
  __Pyx_XDECREF(__pyx_v_to_bb);
  __Pyx_XDECREF(__pyx_v_promoted);
  __Pyx_XDECREF(__pyx_v_piece_type);
  __Pyx_XDECREF(__pyx_v_capture_square);
  __Pyx_XDECREF(__pyx_v_captured_piece_type);
  __Pyx_XDECREF(__pyx_v_diff);
  __Pyx_XDECREF(__pyx_v_down);
  __Pyx_XDECREF(__pyx_v_castling);
  __Pyx_XDECREF(__pyx_v_a_side);
  __Pyx_XDECREF(__pyx_v_was_promoted);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2044
 *         self.turn = not self.turn
 * 
 *     def pop(self):             # <<<<<<<<<<<<<<
 *         """
 *         Restores the previous position and returns the last move from the stack.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_69pop(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_68pop[] = "\n        Restores the previous position and returns the last move from the stack.\n\n        :raises: :exc:`IndexError` if the stack is empty.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_69pop(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pop (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_68pop(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_68pop(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("pop", 0);

  /* "chess/__init__cp.pyx":2050
 *         :raises: :exc:`IndexError` if the stack is empty.
 *         """
 *         move = self.move_stack.pop()             # <<<<<<<<<<<<<<
 *         self.stack.pop().restore(self)
 *         return move
 */
  __pyx_t_1 = __Pyx_PyObject_Pop(__pyx_v_self->__pyx_base.move_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2050, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_move = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2051
 *         """
 *         move = self.move_stack.pop()
 *         self.stack.pop().restore(self)             # <<<<<<<<<<<<<<
 *         return move
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_Pop(__pyx_v_self->__pyx_base.stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2051, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_restore); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2051, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_self)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_self));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2051, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2052
 *         move = self.move_stack.pop()
 *         self.stack.pop().restore(self)
 *         return move             # <<<<<<<<<<<<<<
 * 
 *     def peek(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_move);
  __pyx_r = __pyx_v_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2044
 *         self.turn = not self.turn
 * 
 *     def pop(self):             # <<<<<<<<<<<<<<
 *         """
 *         Restores the previous position and returns the last move from the stack.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.pop", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2054
 *         return move
 * 
 *     def peek(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the last move from the move stack.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_71peek(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_70peek[] = "\n        Gets the last move from the move stack.\n\n        :raises: :exc:`IndexError` if the move stack is empty.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_71peek(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("peek (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_70peek(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_70peek(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("peek", 0);

  /* "chess/__init__cp.pyx":2060
 *         :raises: :exc:`IndexError` if the move stack is empty.
 *         """
 *         return self.move_stack[-1]             # <<<<<<<<<<<<<<
 * 
 *     def castling_shredder_fen(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->__pyx_base.move_stack, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2060, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2054
 *         return move
 * 
 *     def peek(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the last move from the move stack.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.Board.peek", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2062
 *         return self.move_stack[-1]
 * 
 *     def castling_shredder_fen(self):             # <<<<<<<<<<<<<<
 *         castling_rights = self.clean_castling_rights()
 *         if not castling_rights:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_73castling_shredder_fen(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_73castling_shredder_fen(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("castling_shredder_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_72castling_shredder_fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_72castling_shredder_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_castling_rights = NULL;
  PyObject *__pyx_v_builder = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  __Pyx_RefNannySetupContext("castling_shredder_fen", 0);

  /* "chess/__init__cp.pyx":2063
 * 
 *     def castling_shredder_fen(self):
 *         castling_rights = self.clean_castling_rights()             # <<<<<<<<<<<<<<
 *         if not castling_rights:
 *             return "-"
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_castling_rights = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2064
 *     def castling_shredder_fen(self):
 *         castling_rights = self.clean_castling_rights()
 *         if not castling_rights:             # <<<<<<<<<<<<<<
 *             return "-"
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_castling_rights); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2064, __pyx_L1_error)
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2065
 *         castling_rights = self.clean_castling_rights()
 *         if not castling_rights:
 *             return "-"             # <<<<<<<<<<<<<<
 * 
 *         builder = []
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u__34);
    __pyx_r = __pyx_kp_u__34;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2064
 *     def castling_shredder_fen(self):
 *         castling_rights = self.clean_castling_rights()
 *         if not castling_rights:             # <<<<<<<<<<<<<<
 *             return "-"
 * 
 */
  }

  /* "chess/__init__cp.pyx":2067
 *             return "-"
 * 
 *         builder = []             # <<<<<<<<<<<<<<
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_1):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2067, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2069
 *         builder = []
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_1):             # <<<<<<<<<<<<<<
 *             builder.append(FILE_NAMES[square_file(square)].upper())
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2069, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2069, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2069, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2069, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2069, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2069, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 2069, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2069, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 2069, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2069, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_8(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2069, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2070
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_1):
 *             builder.append(FILE_NAMES[square_file(square)].upper())             # <<<<<<<<<<<<<<
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_8):
 */
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_square_file); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_10, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_upper); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_9) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_9) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_1); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 2070, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2069
 *         builder = []
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_1):             # <<<<<<<<<<<<<<
 *             builder.append(FILE_NAMES[square_file(square)].upper())
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2072
 *             builder.append(FILE_NAMES[square_file(square)].upper())
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_8):             # <<<<<<<<<<<<<<
 *             builder.append(FILE_NAMES[square_file(square)])
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2072, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2072, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_9 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2072, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_9);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2072, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2072, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 2072, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2072, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 2072, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2072, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2072, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2073
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_8):
 *             builder.append(FILE_NAMES[square_file(square)])             # <<<<<<<<<<<<<<
 * 
 *         return "".join(builder)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2073, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2073, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_9 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2073, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2073, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_3); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 2073, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2072
 *             builder.append(FILE_NAMES[square_file(square)].upper())
 * 
 *         for square in scan_reversed(castling_rights & BB_RANK_8):             # <<<<<<<<<<<<<<
 *             builder.append(FILE_NAMES[square_file(square)])
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2075
 *             builder.append(FILE_NAMES[square_file(square)])
 * 
 *         return "".join(builder)             # <<<<<<<<<<<<<<
 * 
 *     def castling_xfen(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_builder); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2075, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2062
 *         return self.move_stack[-1]
 * 
 *     def castling_shredder_fen(self):             # <<<<<<<<<<<<<<
 *         castling_rights = self.clean_castling_rights()
 *         if not castling_rights:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("chess.__init__cp.Board.castling_shredder_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_castling_rights);
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2077
 *         return "".join(builder)
 * 
 *     def castling_xfen(self):             # <<<<<<<<<<<<<<
 *         builder = []
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_75castling_xfen(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_75castling_xfen(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("castling_xfen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_74castling_xfen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_13castling_xfen_2generator9(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":2094
 *                 other_rooks = self.occupied_co[color] & self.rooks & backrank & ~BB_SQUARES[rook_square]
 * 
 *                 if any((square_file(other) < rook_file) == a_side for other in scan_reversed(other_rooks)):             # <<<<<<<<<<<<<<
 *                     ch = FILE_NAMES[rook_file]
 *                 else:
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_13castling_xfen_genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_6_genexpr(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_6_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 2094, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *) __pyx_self;
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_13castling_xfen_2generator9, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_castling_xfen_locals_genexpr, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.castling_xfen.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_13castling_xfen_2generator9(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 2094, __pyx_L1_error)
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_other_rooks)) { __Pyx_RaiseClosureNameError("other_rooks"); __PYX_ERR(0, 2094, __pyx_L1_error) }
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_other_rooks) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_other_rooks);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2094, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2094, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2094, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2094, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2094, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2094, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_other);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_other, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_cur_scope->__pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_other);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_rook_file)) { __Pyx_RaiseClosureNameError("rook_file"); __PYX_ERR(0, 2094, __pyx_L1_error) }
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_rook_file, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_a_side)) { __Pyx_RaiseClosureNameError("a_side"); __PYX_ERR(0, 2094, __pyx_L1_error) }
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_a_side, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_7) {
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L0;
    }
  }
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2077
 *         return "".join(builder)
 * 
 *     def castling_xfen(self):             # <<<<<<<<<<<<<<
 *         builder = []
 * 
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_74castling_xfen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *__pyx_cur_scope;
  PyObject *__pyx_v_builder = NULL;
  int __pyx_v_color;
  PyObject *__pyx_v_king = NULL;
  PyObject *__pyx_v_king_file = NULL;
  PyObject *__pyx_v_backrank = NULL;
  PyObject *__pyx_v_rook_square = NULL;
  PyObject *__pyx_v_ch = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int *__pyx_t_2;
  int *__pyx_t_3;
  int *__pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  PyObject *(*__pyx_t_12)(PyObject *);
  int __pyx_t_13;
  __Pyx_RefNannySetupContext("castling_xfen", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 2077, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }

  /* "chess/__init__cp.pyx":2078
 * 
 *     def castling_xfen(self):
 *         builder = []             # <<<<<<<<<<<<<<
 * 
 *         for color in COLORS:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2080
 *         builder = []
 * 
 *         for color in COLORS:             # <<<<<<<<<<<<<<
 *             king = self.king(color)
 *             if king is None:
 */
  __pyx_t_3 = (__pyx_v_5chess_10__init__cp_COLORS + 2);
  for (__pyx_t_4 = __pyx_v_5chess_10__init__cp_COLORS; __pyx_t_4 < __pyx_t_3; __pyx_t_4++) {
    __pyx_t_2 = __pyx_t_4;
    __pyx_v_color = (__pyx_t_2[0]);

    /* "chess/__init__cp.pyx":2081
 * 
 *         for color in COLORS:
 *             king = self.king(color)             # <<<<<<<<<<<<<<
 *             if king is None:
 *                 continue
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2081, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_color); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2081, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2081, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_king, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2082
 *         for color in COLORS:
 *             king = self.king(color)
 *             if king is None:             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
    __pyx_t_8 = (__pyx_v_king == Py_None);
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "chess/__init__cp.pyx":2083
 *             king = self.king(color)
 *             if king is None:
 *                 continue             # <<<<<<<<<<<<<<
 * 
 *             king_file = square_file(king)
 */
      goto __pyx_L3_continue;

      /* "chess/__init__cp.pyx":2082
 *         for color in COLORS:
 *             king = self.king(color)
 *             if king is None:             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
    }

    /* "chess/__init__cp.pyx":2085
 *                 continue
 * 
 *             king_file = square_file(king)             # <<<<<<<<<<<<<<
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_square_file); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2085, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_v_king) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_king);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2085, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_king_file, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2086
 * 
 *             king_file = square_file(king)
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 * 
 *             for rook_square in scan_reversed(self.clean_castling_rights() & backrank):
 */
    if (((__pyx_v_color == 1) != 0)) {
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2086, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = __pyx_t_5;
      __pyx_t_5 = 0;
    } else {
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2086, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = __pyx_t_5;
      __pyx_t_5 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_backrank, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2088
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 * 
 *             for rook_square in scan_reversed(self.clean_castling_rights() & backrank):             # <<<<<<<<<<<<<<
 *                 rook_file = square_file(rook_square)
 *                 a_side = rook_file < king_file
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2088, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2088, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_6 = (__pyx_t_10) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2088, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyNumber_And(__pyx_t_6, __pyx_v_backrank); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2088, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2088, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_5 = __pyx_t_1; __Pyx_INCREF(__pyx_t_5); __pyx_t_11 = 0;
      __pyx_t_12 = NULL;
    } else {
      __pyx_t_11 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2088, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_12 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2088, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_12)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_11); __Pyx_INCREF(__pyx_t_1); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 2088, __pyx_L1_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_5, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2088, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_11); __Pyx_INCREF(__pyx_t_1); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 2088, __pyx_L1_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_5, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2088, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_12(__pyx_t_5);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 2088, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_rook_square, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":2089
 * 
 *             for rook_square in scan_reversed(self.clean_castling_rights() & backrank):
 *                 rook_file = square_file(rook_square)             # <<<<<<<<<<<<<<
 *                 a_side = rook_file < king_file
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_square_file); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2089, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_v_rook_square) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_rook_square);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2089, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_rook_file);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_rook_file, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":2090
 *             for rook_square in scan_reversed(self.clean_castling_rights() & backrank):
 *                 rook_file = square_file(rook_square)
 *                 a_side = rook_file < king_file             # <<<<<<<<<<<<<<
 * 
 *                 other_rooks = self.occupied_co[color] & self.rooks & backrank & ~BB_SQUARES[rook_square]
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_rook_file, __pyx_v_king_file, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2090, __pyx_L1_error)
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_a_side);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_a_side, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":2092
 *                 a_side = rook_file < king_file
 * 
 *                 other_rooks = self.occupied_co[color] & self.rooks & backrank & ~BB_SQUARES[rook_square]             # <<<<<<<<<<<<<<
 * 
 *                 if any((square_file(other) < rook_file) == a_side for other in scan_reversed(other_rooks)):
 */
      __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[__pyx_v_color]) & __pyx_v_self->__pyx_base.rooks)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyNumber_And(__pyx_t_1, __pyx_v_backrank); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_rook_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Invert(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyNumber_And(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_other_rooks);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_other_rooks, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2094
 *                 other_rooks = self.occupied_co[color] & self.rooks & backrank & ~BB_SQUARES[rook_square]
 * 
 *                 if any((square_file(other) < rook_file) == a_side for other in scan_reversed(other_rooks)):             # <<<<<<<<<<<<<<
 *                     ch = FILE_NAMES[rook_file]
 *                 else:
 */
      __pyx_t_6 = __pyx_pf_5chess_10__init__cp_5Board_13castling_xfen_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2094, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_1 = __Pyx_Generator_Next(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2094, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2094, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_9) {

        /* "chess/__init__cp.pyx":2095
 * 
 *                 if any((square_file(other) < rook_file) == a_side for other in scan_reversed(other_rooks)):
 *                     ch = FILE_NAMES[rook_file]             # <<<<<<<<<<<<<<
 *                 else:
 *                     ch = "q" if a_side else "k"
 */
        __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2095, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_cur_scope->__pyx_v_rook_file); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2095, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF_SET(__pyx_v_ch, __pyx_t_6);
        __pyx_t_6 = 0;

        /* "chess/__init__cp.pyx":2094
 *                 other_rooks = self.occupied_co[color] & self.rooks & backrank & ~BB_SQUARES[rook_square]
 * 
 *                 if any((square_file(other) < rook_file) == a_side for other in scan_reversed(other_rooks)):             # <<<<<<<<<<<<<<
 *                     ch = FILE_NAMES[rook_file]
 *                 else:
 */
        goto __pyx_L8;
      }

      /* "chess/__init__cp.pyx":2097
 *                     ch = FILE_NAMES[rook_file]
 *                 else:
 *                     ch = "q" if a_side else "k"             # <<<<<<<<<<<<<<
 * 
 *                 builder.append(ch.upper() if color == WHITE else ch)
 */
      /*else*/ {
        __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_a_side); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2097, __pyx_L1_error)
        if (__pyx_t_9) {
          __Pyx_INCREF(__pyx_n_u_q);
          __pyx_t_6 = __pyx_n_u_q;
        } else {
          __Pyx_INCREF(__pyx_n_u_k);
          __pyx_t_6 = __pyx_n_u_k;
        }
        __Pyx_XDECREF_SET(__pyx_v_ch, __pyx_t_6);
        __pyx_t_6 = 0;
      }
      __pyx_L8:;

      /* "chess/__init__cp.pyx":2099
 *                     ch = "q" if a_side else "k"
 * 
 *                 builder.append(ch.upper() if color == WHITE else ch)             # <<<<<<<<<<<<<<
 * 
 *         if builder:
 */
      if (((__pyx_v_color == 1) != 0)) {
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_ch, __pyx_n_s_upper); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2099, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_10 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        __pyx_t_1 = (__pyx_t_10) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2099, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_6 = __pyx_t_1;
        __pyx_t_1 = 0;
      } else {
        __Pyx_INCREF(__pyx_v_ch);
        __pyx_t_6 = __pyx_v_ch;
      }
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_6); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 2099, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2088
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 * 
 *             for rook_square in scan_reversed(self.clean_castling_rights() & backrank):             # <<<<<<<<<<<<<<
 *                 rook_file = square_file(rook_square)
 *                 a_side = rook_file < king_file
 */
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_L3_continue:;
  }

  /* "chess/__init__cp.pyx":2101
 *                 builder.append(ch.upper() if color == WHITE else ch)
 * 
 *         if builder:             # <<<<<<<<<<<<<<
 *             return "".join(builder)
 *         else:
 */
  __pyx_t_9 = (PyList_GET_SIZE(__pyx_v_builder) != 0);
  if (__pyx_t_9) {

    /* "chess/__init__cp.pyx":2102
 * 
 *         if builder:
 *             return "".join(builder)             # <<<<<<<<<<<<<<
 *         else:
 *             return "-"
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_builder); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2102, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2101
 *                 builder.append(ch.upper() if color == WHITE else ch)
 * 
 *         if builder:             # <<<<<<<<<<<<<<
 *             return "".join(builder)
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":2104
 *             return "".join(builder)
 *         else:
 *             return "-"             # <<<<<<<<<<<<<<
 * 
 *     def has_pseudo_legal_en_passant(self):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u__34);
    __pyx_r = __pyx_kp_u__34;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":2077
 *         return "".join(builder)
 * 
 *     def castling_xfen(self):             # <<<<<<<<<<<<<<
 *         builder = []
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("chess.__init__cp.Board.castling_xfen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_king);
  __Pyx_XDECREF(__pyx_v_king_file);
  __Pyx_XDECREF(__pyx_v_backrank);
  __Pyx_XDECREF(__pyx_v_rook_square);
  __Pyx_XDECREF(__pyx_v_ch);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2106
 *             return "-"
 * 
 *     def has_pseudo_legal_en_passant(self):             # <<<<<<<<<<<<<<
 *         """Checks if there is a pseudo-legal en passant capture."""
 *         return self.ep_square and any(self.generate_pseudo_legal_ep())
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_77has_pseudo_legal_en_passant(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_76has_pseudo_legal_en_passant[] = "Checks if there is a pseudo-legal en passant capture.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_77has_pseudo_legal_en_passant(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_pseudo_legal_en_passant (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_76has_pseudo_legal_en_passant(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_76has_pseudo_legal_en_passant(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("has_pseudo_legal_en_passant", 0);

  /* "chess/__init__cp.pyx":2108
 *     def has_pseudo_legal_en_passant(self):
 *         """Checks if there is a pseudo-legal en passant capture."""
 *         return self.ep_square and any(self.generate_pseudo_legal_ep())             # <<<<<<<<<<<<<<
 * 
 *     def has_legal_en_passant(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2108, __pyx_L1_error)
  if (__pyx_t_2) {
  } else {
    __Pyx_INCREF(__pyx_v_self->__pyx_base.ep_square);
    __pyx_t_1 = __pyx_v_self->__pyx_base.ep_square;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_pseudo_legal_ep); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2106
 *             return "-"
 * 
 *     def has_pseudo_legal_en_passant(self):             # <<<<<<<<<<<<<<
 *         """Checks if there is a pseudo-legal en passant capture."""
 *         return self.ep_square and any(self.generate_pseudo_legal_ep())
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.has_pseudo_legal_en_passant", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2110
 *         return self.ep_square and any(self.generate_pseudo_legal_ep())
 * 
 *     def has_legal_en_passant(self):             # <<<<<<<<<<<<<<
 *         """Checks if there is a legal en passant capture."""
 *         return self.ep_square and any(self.generate_legal_ep())
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_79has_legal_en_passant(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_78has_legal_en_passant[] = "Checks if there is a legal en passant capture.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_79has_legal_en_passant(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_legal_en_passant (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_78has_legal_en_passant(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_78has_legal_en_passant(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("has_legal_en_passant", 0);

  /* "chess/__init__cp.pyx":2112
 *     def has_legal_en_passant(self):
 *         """Checks if there is a legal en passant capture."""
 *         return self.ep_square and any(self.generate_legal_ep())             # <<<<<<<<<<<<<<
 * 
 *     def fen(self, *, shredder=False, en_passant="legal", promoted=None):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2112, __pyx_L1_error)
  if (__pyx_t_2) {
  } else {
    __Pyx_INCREF(__pyx_v_self->__pyx_base.ep_square);
    __pyx_t_1 = __pyx_v_self->__pyx_base.ep_square;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_ep); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2112, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2112, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2112, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2110
 *         return self.ep_square and any(self.generate_pseudo_legal_ep())
 * 
 *     def has_legal_en_passant(self):             # <<<<<<<<<<<<<<
 *         """Checks if there is a legal en passant capture."""
 *         return self.ep_square and any(self.generate_legal_ep())
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.has_legal_en_passant", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2114
 *         return self.ep_square and any(self.generate_legal_ep())
 * 
 *     def fen(self, *, shredder=False, en_passant="legal", promoted=None):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a FEN representation of the position.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_81fen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_80fen[] = "\n        Gets a FEN representation of the position.\n\n        A FEN string (e.g.,\n        ``rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1``) consists\n        of the position part :func:`~chess.Board.board_fen()`, the\n        :data:`~chess.Board.turn`, the castling part\n        (:data:`~chess.Board.castling_rights`),\n        the en passant square (:data:`~chess.Board.ep_square`),\n        the :data:`~chess.Board.halfmove_clock`\n        and the :data:`~chess.Board.fullmove_number`.\n\n        :param shredder: Use :func:`~chess.Board.castling_shredder_fen()`\n            and encode castling rights by the file of the rook\n            (like ``HAha``) instead of the default\n            :func:`~chess.Board.castling_xfen()` (like ``KQkq``).\n        :param en_passant: By default, only fully legal en passant squares\n            are included (:func:`~chess.Board.has_legal_en_passant()`).\n            Pass ``fen`` to strictly follow the FEN specification\n            (always include the en passant square after a two-step pawn move)\n            or ``xfen`` to follow the X-FEN specification\n            (:func:`~chess.Board.has_pseudo_legal_en_passant()`).\n        :param promoted: Mark promoted pieces like ``Q~``. By default, this is\n            only enabled in chess variants where this is relevant.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_81fen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_shredder = 0;
  PyObject *__pyx_v_en_passant = 0;
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("fen (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_shredder,&__pyx_n_s_en_passant,&__pyx_n_s_promoted,0};
    PyObject* values[3] = {0,0,0};
    values[0] = ((PyObject *)Py_False);
    values[1] = ((PyObject *)__pyx_n_u_legal);
    values[2] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args > 0 && likely(kw_args <= 3)) {
        Py_ssize_t index;
        for (index = 0; index < 3 && kw_args > 0; index++) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
          if (value) { values[index] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "fen") < 0)) __PYX_ERR(0, 2114, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_shredder = values[0];
    __pyx_v_en_passant = values[1];
    __pyx_v_promoted = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("fen", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2114, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_80fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_shredder, __pyx_v_en_passant, __pyx_v_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_80fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_shredder, PyObject *__pyx_v_en_passant, PyObject *__pyx_v_promoted) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("fen", 0);

  /* "chess/__init__cp.pyx":2140
 *             only enabled in chess variants where this is relevant.
 *         """
 *         return " ".join([             # <<<<<<<<<<<<<<
 *             self.epd(shredder=shredder, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),
 */
  __Pyx_XDECREF(__pyx_r);

  /* "chess/__init__cp.pyx":2141
 *         """
 *         return " ".join([
 *             self.epd(shredder=shredder, en_passant=en_passant, promoted=promoted),             # <<<<<<<<<<<<<<
 *             str(self.halfmove_clock),
 *             str(self.fullmove_number)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_epd); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shredder, __pyx_v_shredder) < 0) __PYX_ERR(0, 2141, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_en_passant, __pyx_v_en_passant) < 0) __PYX_ERR(0, 2141, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_promoted, __pyx_v_promoted) < 0) __PYX_ERR(0, 2141, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2142
 *         return " ".join([
 *             self.epd(shredder=shredder, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),             # <<<<<<<<<<<<<<
 *             str(self.fullmove_number)
 *         ])
 */
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.halfmove_clock); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2143
 *             self.epd(shredder=shredder, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),
 *             str(self.fullmove_number)             # <<<<<<<<<<<<<<
 *         ])
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.fullmove_number); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2143, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2143, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2140
 *             only enabled in chess variants where this is relevant.
 *         """
 *         return " ".join([             # <<<<<<<<<<<<<<
 *             self.epd(shredder=shredder, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),
 */
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyList_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_4);
  PyList_SET_ITEM(__pyx_t_2, 2, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__14, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2114
 *         return self.ep_square and any(self.generate_legal_ep())
 * 
 *     def fen(self, *, shredder=False, en_passant="legal", promoted=None):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a FEN representation of the position.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2146
 *         ])
 * 
 *     def shredder_fen(self, *, en_passant="legal", promoted=None):             # <<<<<<<<<<<<<<
 *         return " ".join([
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_83shredder_fen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_83shredder_fen(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_en_passant = 0;
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("shredder_fen (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_en_passant,&__pyx_n_s_promoted,0};
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)__pyx_n_u_legal);
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args > 0 && likely(kw_args <= 2)) {
        Py_ssize_t index;
        for (index = 0; index < 2 && kw_args > 0; index++) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
          if (value) { values[index] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "shredder_fen") < 0)) __PYX_ERR(0, 2146, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_en_passant = values[0];
    __pyx_v_promoted = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("shredder_fen", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2146, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.shredder_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_82shredder_fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_en_passant, __pyx_v_promoted);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_82shredder_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_en_passant, PyObject *__pyx_v_promoted) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("shredder_fen", 0);

  /* "chess/__init__cp.pyx":2147
 * 
 *     def shredder_fen(self, *, en_passant="legal", promoted=None):
 *         return " ".join([             # <<<<<<<<<<<<<<
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),
 */
  __Pyx_XDECREF(__pyx_r);

  /* "chess/__init__cp.pyx":2148
 *     def shredder_fen(self, *, en_passant="legal", promoted=None):
 *         return " ".join([
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),             # <<<<<<<<<<<<<<
 *             str(self.halfmove_clock),
 *             str(self.fullmove_number)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_epd); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shredder, Py_True) < 0) __PYX_ERR(0, 2148, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_en_passant, __pyx_v_en_passant) < 0) __PYX_ERR(0, 2148, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_promoted, __pyx_v_promoted) < 0) __PYX_ERR(0, 2148, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2149
 *         return " ".join([
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),             # <<<<<<<<<<<<<<
 *             str(self.fullmove_number)
 *         ])
 */
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.halfmove_clock); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2149, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2149, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2150
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),
 *             str(self.fullmove_number)             # <<<<<<<<<<<<<<
 *         ])
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.fullmove_number); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2150, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2150, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2147
 * 
 *     def shredder_fen(self, *, en_passant="legal", promoted=None):
 *         return " ".join([             # <<<<<<<<<<<<<<
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),
 *             str(self.halfmove_clock),
 */
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2147, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyList_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_4);
  PyList_SET_ITEM(__pyx_t_2, 2, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__14, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2147, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2146
 *         ])
 * 
 *     def shredder_fen(self, *, en_passant="legal", promoted=None):             # <<<<<<<<<<<<<<
 *         return " ".join([
 *             self.epd(shredder=True, en_passant=en_passant, promoted=promoted),
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.shredder_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2153
 *         ])
 * 
 *     def set_fen(self, fen):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a FEN and sets the position from it.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_85set_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_84set_fen[] = "\n        Parses a FEN and sets the position from it.\n\n        :raises: :exc:`ValueError` if the FEN string is invalid.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_85set_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_84set_fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_fen));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_84set_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_v_parts = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("set_fen", 0);

  /* "chess/__init__cp.pyx":2160
 *         """
 *         # Ensure there are six parts.
 *         parts = fen.split()             # <<<<<<<<<<<<<<
 *         if len(parts) != 6:
 *             raise ValueError("fen string should consist of 6 parts: {}".format(repr(fen)))
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_fen, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2160, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2160, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_parts = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2161
 *         # Ensure there are six parts.
 *         parts = fen.split()
 *         if len(parts) != 6:             # <<<<<<<<<<<<<<
 *             raise ValueError("fen string should consist of 6 parts: {}".format(repr(fen)))
 * 
 */
  __pyx_t_4 = PyObject_Length(__pyx_v_parts); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2161, __pyx_L1_error)
  __pyx_t_5 = ((__pyx_t_4 != 6) != 0);
  if (unlikely(__pyx_t_5)) {

    /* "chess/__init__cp.pyx":2162
 *         parts = fen.split()
 *         if len(parts) != 6:
 *             raise ValueError("fen string should consist of 6 parts: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Check that the turn part is valid.
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_fen_string_should_consist_of_6_p, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 2162, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2161
 *         # Ensure there are six parts.
 *         parts = fen.split()
 *         if len(parts) != 6:             # <<<<<<<<<<<<<<
 *             raise ValueError("fen string should consist of 6 parts: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2165
 * 
 *         # Check that the turn part is valid.
 *         if not parts[1] in ["w", "b"]:             # <<<<<<<<<<<<<<
 *             raise ValueError("expected 'w' or 'b' for turn part of fen: {}".format(repr(fen)))
 * 
 */
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_parts, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2165, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_w, Py_NE)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2165, __pyx_L1_error)
  if (__pyx_t_7) {
  } else {
    __pyx_t_5 = __pyx_t_7;
    goto __pyx_L5_bool_binop_done;
  }
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_b, Py_NE)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2165, __pyx_L1_error)
  __pyx_t_5 = __pyx_t_7;
  __pyx_L5_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = (__pyx_t_5 != 0);
  if (unlikely(__pyx_t_7)) {

    /* "chess/__init__cp.pyx":2166
 *         # Check that the turn part is valid.
 *         if not parts[1] in ["w", "b"]:
 *             raise ValueError("expected 'w' or 'b' for turn part of fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Check that the castling part is valid.
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_expected_w_or_b_for_turn_part_of, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 2166, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2165
 * 
 *         # Check that the turn part is valid.
 *         if not parts[1] in ["w", "b"]:             # <<<<<<<<<<<<<<
 *             raise ValueError("expected 'w' or 'b' for turn part of fen: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2169
 * 
 *         # Check that the castling part is valid.
 *         if not FEN_CASTLING_REGEX.match(parts[2]):             # <<<<<<<<<<<<<<
 *             raise ValueError("invalid castling part in fen: {}".format(repr(fen)))
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FEN_CASTLING_REGEX); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_parts, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2169, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = ((!__pyx_t_7) != 0);
  if (unlikely(__pyx_t_5)) {

    /* "chess/__init__cp.pyx":2170
 *         # Check that the castling part is valid.
 *         if not FEN_CASTLING_REGEX.match(parts[2]):
 *             raise ValueError("invalid castling part in fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Check that the en passant part is valid.
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_invalid_castling_part_in_fen, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2170, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2170, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2170, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2170, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 2170, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2169
 * 
 *         # Check that the castling part is valid.
 *         if not FEN_CASTLING_REGEX.match(parts[2]):             # <<<<<<<<<<<<<<
 *             raise ValueError("invalid castling part in fen: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2173
 * 
 *         # Check that the en passant part is valid.
 *         if parts[3] != "-":             # <<<<<<<<<<<<<<
 *             if parts[3] not in SQUARE_NAMES:
 *                 raise ValueError("invalid en passant part in fen: {}".format(repr(fen)))
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_parts, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2173, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u__34, Py_NE)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2173, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2174
 *         # Check that the en passant part is valid.
 *         if parts[3] != "-":
 *             if parts[3] not in SQUARE_NAMES:             # <<<<<<<<<<<<<<
 *                 raise ValueError("invalid en passant part in fen: {}".format(repr(fen)))
 * 
 */
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_parts, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2174, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2174, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = (__Pyx_PySequence_ContainsTF(__pyx_t_3, __pyx_t_1, Py_NE)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2174, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = (__pyx_t_5 != 0);
    if (unlikely(__pyx_t_7)) {

      /* "chess/__init__cp.pyx":2175
 *         if parts[3] != "-":
 *             if parts[3] not in SQUARE_NAMES:
 *                 raise ValueError("invalid en passant part in fen: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Check that the half-move part is valid.
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_invalid_en_passant_part_in_fen, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2175, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2175, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2175, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2175, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __PYX_ERR(0, 2175, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2174
 *         # Check that the en passant part is valid.
 *         if parts[3] != "-":
 *             if parts[3] not in SQUARE_NAMES:             # <<<<<<<<<<<<<<
 *                 raise ValueError("invalid en passant part in fen: {}".format(repr(fen)))
 * 
 */
    }

    /* "chess/__init__cp.pyx":2173
 * 
 *         # Check that the en passant part is valid.
 *         if parts[3] != "-":             # <<<<<<<<<<<<<<
 *             if parts[3] not in SQUARE_NAMES:
 *                 raise ValueError("invalid en passant part in fen: {}".format(repr(fen)))
 */
  }

  /* "chess/__init__cp.pyx":2178
 * 
 *         # Check that the half-move part is valid.
 *         if int(parts[4]) < 0:             # <<<<<<<<<<<<<<
 *             raise ValueError("half-move clock can not be negative: {}".format(repr(fen)))
 * 
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_parts, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2178, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2178, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(__pyx_t_7)) {

    /* "chess/__init__cp.pyx":2179
 *         # Check that the half-move part is valid.
 *         if int(parts[4]) < 0:
 *             raise ValueError("half-move clock can not be negative: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Check that the full-move number part is valid.
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_half_move_clock_can_not_be_negat, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2179, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2179, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2179, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2179, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 2179, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2178
 * 
 *         # Check that the half-move part is valid.
 *         if int(parts[4]) < 0:             # <<<<<<<<<<<<<<
 *             raise ValueError("half-move clock can not be negative: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2183
 *         # Check that the full-move number part is valid.
 *         # 0 is allowed for compability, but later replaced with 1.
 *         if int(parts[5]) < 0:             # <<<<<<<<<<<<<<
 *             raise ValueError("full-move number must be positive: {}".format(repr(fen)))
 * 
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_parts, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2183, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2183, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2183, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2183, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(__pyx_t_7)) {

    /* "chess/__init__cp.pyx":2184
 *         # 0 is allowed for compability, but later replaced with 1.
 *         if int(parts[5]) < 0:
 *             raise ValueError("full-move number must be positive: {}".format(repr(fen)))             # <<<<<<<<<<<<<<
 * 
 *         # Validate the board part and set it.
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_full_move_number_must_be_positiv, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2184, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_Repr(__pyx_v_fen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2184, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2184, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2184, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 2184, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2183
 *         # Check that the full-move number part is valid.
 *         # 0 is allowed for compability, but later replaced with 1.
 *         if int(parts[5]) < 0:             # <<<<<<<<<<<<<<
 *             raise ValueError("full-move number must be positive: {}".format(repr(fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2187
 * 
 *         # Validate the board part and set it.
 *         self._set_board_fen(parts[0])             # <<<<<<<<<<<<<<
 * 
 *         # Set the turn.
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_board_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_parts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2190
 * 
 *         # Set the turn.
 *         if parts[1] == "w":             # <<<<<<<<<<<<<<
 *             self.turn = WHITE
 *         else:
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_parts, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2190, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_w, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2190, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_7) {

    /* "chess/__init__cp.pyx":2191
 *         # Set the turn.
 *         if parts[1] == "w":
 *             self.turn = WHITE             # <<<<<<<<<<<<<<
 *         else:
 *             self.turn = BLACK
 */
    __pyx_v_self->__pyx_base.turn = 1;

    /* "chess/__init__cp.pyx":2190
 * 
 *         # Set the turn.
 *         if parts[1] == "w":             # <<<<<<<<<<<<<<
 *             self.turn = WHITE
 *         else:
 */
    goto __pyx_L12;
  }

  /* "chess/__init__cp.pyx":2193
 *             self.turn = WHITE
 *         else:
 *             self.turn = BLACK             # <<<<<<<<<<<<<<
 * 
 *         # Set castling flags.
 */
  /*else*/ {
    __pyx_v_self->__pyx_base.turn = 0;
  }
  __pyx_L12:;

  /* "chess/__init__cp.pyx":2196
 * 
 *         # Set castling flags.
 *         self._set_castling_fen(parts[2])             # <<<<<<<<<<<<<<
 * 
 *         # Set the en passant square.
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_castling_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_parts, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2199
 * 
 *         # Set the en passant square.
 *         if parts[3] == "-":             # <<<<<<<<<<<<<<
 *             self.ep_square = None
 *         else:
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_parts, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_kp_u__34, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2199, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_7) {

    /* "chess/__init__cp.pyx":2200
 *         # Set the en passant square.
 *         if parts[3] == "-":
 *             self.ep_square = None             # <<<<<<<<<<<<<<
 *         else:
 *             self.ep_square = SQUARE_NAMES.index(parts[3])
 */
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
    __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
    __pyx_v_self->__pyx_base.ep_square = Py_None;

    /* "chess/__init__cp.pyx":2199
 * 
 *         # Set the en passant square.
 *         if parts[3] == "-":             # <<<<<<<<<<<<<<
 *             self.ep_square = None
 *         else:
 */
    goto __pyx_L13;
  }

  /* "chess/__init__cp.pyx":2202
 *             self.ep_square = None
 *         else:
 *             self.ep_square = SQUARE_NAMES.index(parts[3])             # <<<<<<<<<<<<<<
 * 
 *         # Set the mover counters.
 */
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2202, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2202, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_parts, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2202, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2202, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
    __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
    __pyx_v_self->__pyx_base.ep_square = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L13:;

  /* "chess/__init__cp.pyx":2205
 * 
 *         # Set the mover counters.
 *         self.halfmove_clock = int(parts[4])             # <<<<<<<<<<<<<<
 *         self.fullmove_number = int(parts[5]) or 1
 * 
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_parts, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 2205, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_self->__pyx_base.halfmove_clock = __pyx_t_8;

  /* "chess/__init__cp.pyx":2206
 *         # Set the mover counters.
 *         self.halfmove_clock = int(parts[4])
 *         self.fullmove_number = int(parts[5]) or 1             # <<<<<<<<<<<<<<
 * 
 *         # Clear move stack.
 */
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_parts, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2206, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2206, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2206, __pyx_L1_error)
  if (!__pyx_t_7) {
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 2206, __pyx_L1_error)
    __pyx_t_8 = __pyx_t_9;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L14_bool_binop_done;
  }
  __pyx_t_8 = 1;
  __pyx_L14_bool_binop_done:;
  __pyx_v_self->__pyx_base.fullmove_number = __pyx_t_8;

  /* "chess/__init__cp.pyx":2209
 * 
 *         # Clear move stack.
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def _set_castling_fen(self, castling_fen):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2209, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2209, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2153
 *         ])
 * 
 *     def set_fen(self, fen):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a FEN and sets the position from it.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_parts);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2211
 *         self.clear_stack()
 * 
 *     def _set_castling_fen(self, castling_fen):             # <<<<<<<<<<<<<<
 *         if not castling_fen or castling_fen == "-":
 *             self.castling_rights = BB_EMPTY
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_87_set_castling_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_castling_fen); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_87_set_castling_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_castling_fen) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_set_castling_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_86_set_castling_fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_castling_fen));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_86_set_castling_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_castling_fen) {
  PyObject *__pyx_v_flag = NULL;
  int __pyx_v_color;
  PyObject *__pyx_v_backrank = NULL;
  PyObject *__pyx_v_rooks = NULL;
  PyObject *__pyx_v_king = NULL;
  PyObject *__pyx_v_rook = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  PyObject *__pyx_t_10 = NULL;
  unsigned PY_LONG_LONG __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  __Pyx_RefNannySetupContext("_set_castling_fen", 0);

  /* "chess/__init__cp.pyx":2212
 * 
 *     def _set_castling_fen(self, castling_fen):
 *         if not castling_fen or castling_fen == "-":             # <<<<<<<<<<<<<<
 *             self.castling_rights = BB_EMPTY
 *             return
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_castling_fen); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2212, __pyx_L1_error)
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (!__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_v_castling_fen, __pyx_kp_u__34, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2212, __pyx_L1_error)
  __pyx_t_1 = __pyx_t_3;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2213
 *     def _set_castling_fen(self, castling_fen):
 *         if not castling_fen or castling_fen == "-":
 *             self.castling_rights = BB_EMPTY             # <<<<<<<<<<<<<<
 *             return
 * 
 */
    __pyx_v_self->__pyx_base.castling_rights = __pyx_v_5chess_10__init__cp_BB_EMPTY;

    /* "chess/__init__cp.pyx":2214
 *         if not castling_fen or castling_fen == "-":
 *             self.castling_rights = BB_EMPTY
 *             return             # <<<<<<<<<<<<<<
 * 
 *         if not FEN_CASTLING_REGEX.match(castling_fen):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2212
 * 
 *     def _set_castling_fen(self, castling_fen):
 *         if not castling_fen or castling_fen == "-":             # <<<<<<<<<<<<<<
 *             self.castling_rights = BB_EMPTY
 *             return
 */
  }

  /* "chess/__init__cp.pyx":2216
 *             return
 * 
 *         if not FEN_CASTLING_REGEX.match(castling_fen):             # <<<<<<<<<<<<<<
 *             raise ValueError("invalid castling fen: {}".format(repr(castling_fen)))
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FEN_CASTLING_REGEX); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_match); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_v_castling_fen) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_castling_fen);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2216, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = ((!__pyx_t_1) != 0);
  if (unlikely(__pyx_t_3)) {

    /* "chess/__init__cp.pyx":2217
 * 
 *         if not FEN_CASTLING_REGEX.match(castling_fen):
 *             raise ValueError("invalid castling fen: {}".format(repr(castling_fen)))             # <<<<<<<<<<<<<<
 * 
 *         self.castling_rights = BB_EMPTY
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_invalid_castling_fen, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = PyObject_Repr(__pyx_v_castling_fen); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_6, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __PYX_ERR(0, 2217, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2216
 *             return
 * 
 *         if not FEN_CASTLING_REGEX.match(castling_fen):             # <<<<<<<<<<<<<<
 *             raise ValueError("invalid castling fen: {}".format(repr(castling_fen)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2219
 *             raise ValueError("invalid castling fen: {}".format(repr(castling_fen)))
 * 
 *         self.castling_rights = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *         for flag in castling_fen:
 */
  __pyx_v_self->__pyx_base.castling_rights = __pyx_v_5chess_10__init__cp_BB_EMPTY;

  /* "chess/__init__cp.pyx":2221
 *         self.castling_rights = BB_EMPTY
 * 
 *         for flag in castling_fen:             # <<<<<<<<<<<<<<
 *             color = WHITE if flag.isupper() else BLACK
 *             flag = flag.lower()
 */
  if (likely(PyList_CheckExact(__pyx_v_castling_fen)) || PyTuple_CheckExact(__pyx_v_castling_fen)) {
    __pyx_t_6 = __pyx_v_castling_fen; __Pyx_INCREF(__pyx_t_6); __pyx_t_8 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_8 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_castling_fen); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2221, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_9 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2221, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_9)) {
      if (likely(PyList_CheckExact(__pyx_t_6))) {
        if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 2221, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_6, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2221, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 2221, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_6, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2221, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_9(__pyx_t_6);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2221, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_flag, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2222
 * 
 *         for flag in castling_fen:
 *             color = WHITE if flag.isupper() else BLACK             # <<<<<<<<<<<<<<
 *             flag = flag.lower()
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_flag, __pyx_n_s_isupper); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2222, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2222, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2222, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {
      __pyx_t_3 = 1;
    } else {
      __pyx_t_3 = 0;
    }
    __pyx_v_color = __pyx_t_3;

    /* "chess/__init__cp.pyx":2223
 *         for flag in castling_fen:
 *             color = WHITE if flag.isupper() else BLACK
 *             flag = flag.lower()             # <<<<<<<<<<<<<<
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *             rooks = self.occupied_co[color] & self.rooks & backrank
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_flag, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_flag, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2224
 *             color = WHITE if flag.isupper() else BLACK
 *             flag = flag.lower()
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 *             rooks = self.occupied_co[color] & self.rooks & backrank
 *             king = self.king(color)
 */
    if (((__pyx_v_color == 1) != 0)) {
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __pyx_t_5;
      __pyx_t_5 = 0;
    } else {
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __pyx_t_5;
      __pyx_t_5 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_backrank, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2225
 *             flag = flag.lower()
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *             rooks = self.occupied_co[color] & self.rooks & backrank             # <<<<<<<<<<<<<<
 *             king = self.king(color)
 * 
 */
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[__pyx_v_color]) & __pyx_v_self->__pyx_base.rooks)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2225, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyNumber_And(__pyx_t_4, __pyx_v_backrank); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2225, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_rooks, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2226
 *             backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *             rooks = self.occupied_co[color] & self.rooks & backrank
 *             king = self.king(color)             # <<<<<<<<<<<<<<
 * 
 *             if flag == "q":
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2226, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_color); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2226, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2226, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_king, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2228
 *             king = self.king(color)
 * 
 *             if flag == "q":             # <<<<<<<<<<<<<<
 *                 # Select the leftmost rook.
 *                 if king is not None and lsb(rooks) < king:
 */
    __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_v_flag, __pyx_n_u_q, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2228, __pyx_L1_error)
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":2230
 *             if flag == "q":
 *                 # Select the leftmost rook.
 *                 if king is not None and lsb(rooks) < king:             # <<<<<<<<<<<<<<
 *                     self.castling_rights |= rooks & -rooks
 *                 else:
 */
      __pyx_t_1 = (__pyx_v_king != Py_None);
      __pyx_t_2 = (__pyx_t_1 != 0);
      if (__pyx_t_2) {
      } else {
        __pyx_t_3 = __pyx_t_2;
        goto __pyx_L11_bool_binop_done;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_lsb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2230, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_v_rooks) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_rooks);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2230, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_king, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2230, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2230, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_3 = __pyx_t_2;
      __pyx_L11_bool_binop_done:;
      if (__pyx_t_3) {

        /* "chess/__init__cp.pyx":2231
 *                 # Select the leftmost rook.
 *                 if king is not None and lsb(rooks) < king:
 *                     self.castling_rights |= rooks & -rooks             # <<<<<<<<<<<<<<
 *                 else:
 *                     self.castling_rights |= BB_FILE_A & backrank
 */
        __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2231, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyNumber_Negative(__pyx_v_rooks); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2231, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyNumber_And(__pyx_v_rooks, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2231, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyNumber_InPlaceOr(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2231, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_11 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_5); if (unlikely((__pyx_t_11 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 2231, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_self->__pyx_base.castling_rights = __pyx_t_11;

        /* "chess/__init__cp.pyx":2230
 *             if flag == "q":
 *                 # Select the leftmost rook.
 *                 if king is not None and lsb(rooks) < king:             # <<<<<<<<<<<<<<
 *                     self.castling_rights |= rooks & -rooks
 *                 else:
 */
        goto __pyx_L10;
      }

      /* "chess/__init__cp.pyx":2233
 *                     self.castling_rights |= rooks & -rooks
 *                 else:
 *                     self.castling_rights |= BB_FILE_A & backrank             # <<<<<<<<<<<<<<
 *             elif flag == "k":
 *                 # Select the rightmost rook.
 */
      /*else*/ {
        __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_BB_FILE_A); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = PyNumber_And(__pyx_t_7, __pyx_v_backrank); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = PyNumber_InPlaceOr(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_11 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_7); if (unlikely((__pyx_t_11 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 2233, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_v_self->__pyx_base.castling_rights = __pyx_t_11;
      }
      __pyx_L10:;

      /* "chess/__init__cp.pyx":2228
 *             king = self.king(color)
 * 
 *             if flag == "q":             # <<<<<<<<<<<<<<
 *                 # Select the leftmost rook.
 *                 if king is not None and lsb(rooks) < king:
 */
      goto __pyx_L9;
    }

    /* "chess/__init__cp.pyx":2234
 *                 else:
 *                     self.castling_rights |= BB_FILE_A & backrank
 *             elif flag == "k":             # <<<<<<<<<<<<<<
 *                 # Select the rightmost rook.
 *                 rook = msb(rooks)
 */
    __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_v_flag, __pyx_n_u_k, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2234, __pyx_L1_error)
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":2236
 *             elif flag == "k":
 *                 # Select the rightmost rook.
 *                 rook = msb(rooks)             # <<<<<<<<<<<<<<
 *                 if king is not None and king < rook:
 *                     self.castling_rights |= BB_SQUARES[rook]
 */
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_msb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2236, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_7 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_rooks) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_rooks);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2236, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_rook, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "chess/__init__cp.pyx":2237
 *                 # Select the rightmost rook.
 *                 rook = msb(rooks)
 *                 if king is not None and king < rook:             # <<<<<<<<<<<<<<
 *                     self.castling_rights |= BB_SQUARES[rook]
 *                 else:
 */
      __pyx_t_2 = (__pyx_v_king != Py_None);
      __pyx_t_1 = (__pyx_t_2 != 0);
      if (__pyx_t_1) {
      } else {
        __pyx_t_3 = __pyx_t_1;
        goto __pyx_L14_bool_binop_done;
      }
      __pyx_t_7 = PyObject_RichCompare(__pyx_v_king, __pyx_v_rook, Py_LT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2237, __pyx_L1_error)
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2237, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_3 = __pyx_t_1;
      __pyx_L14_bool_binop_done:;
      if (__pyx_t_3) {

        /* "chess/__init__cp.pyx":2238
 *                 rook = msb(rooks)
 *                 if king is not None and king < rook:
 *                     self.castling_rights |= BB_SQUARES[rook]             # <<<<<<<<<<<<<<
 *                 else:
 *                     self.castling_rights |= BB_FILE_H & backrank
 */
        __pyx_t_7 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2238, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2238, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_rook); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2238, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyNumber_InPlaceOr(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2238, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_11 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_11 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 2238, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_v_self->__pyx_base.castling_rights = __pyx_t_11;

        /* "chess/__init__cp.pyx":2237
 *                 # Select the rightmost rook.
 *                 rook = msb(rooks)
 *                 if king is not None and king < rook:             # <<<<<<<<<<<<<<
 *                     self.castling_rights |= BB_SQUARES[rook]
 *                 else:
 */
        goto __pyx_L13;
      }

      /* "chess/__init__cp.pyx":2240
 *                     self.castling_rights |= BB_SQUARES[rook]
 *                 else:
 *                     self.castling_rights |= BB_FILE_H & backrank             # <<<<<<<<<<<<<<
 *             else:
 *                 self.castling_rights |= BB_FILES[FILE_NAMES.index(flag)] & backrank
 */
      /*else*/ {
        __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2240, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2240, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyNumber_And(__pyx_t_5, __pyx_v_backrank); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2240, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyNumber_InPlaceOr(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2240, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_11 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_5); if (unlikely((__pyx_t_11 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 2240, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_self->__pyx_base.castling_rights = __pyx_t_11;
      }
      __pyx_L13:;

      /* "chess/__init__cp.pyx":2234
 *                 else:
 *                     self.castling_rights |= BB_FILE_A & backrank
 *             elif flag == "k":             # <<<<<<<<<<<<<<
 *                 # Select the rightmost rook.
 *                 rook = msb(rooks)
 */
      goto __pyx_L9;
    }

    /* "chess/__init__cp.pyx":2242
 *                     self.castling_rights |= BB_FILE_H & backrank
 *             else:
 *                 self.castling_rights |= BB_FILES[FILE_NAMES.index(flag)] & backrank             # <<<<<<<<<<<<<<
 * 
 *     def set_castling_fen(self, castling_fen):
 */
    /*else*/ {
      __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_index); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      __pyx_t_4 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_10, __pyx_v_flag) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_v_flag);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_And(__pyx_t_12, __pyx_v_backrank); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = PyNumber_InPlaceOr(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_11 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_12); if (unlikely((__pyx_t_11 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 2242, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_v_self->__pyx_base.castling_rights = __pyx_t_11;
    }
    __pyx_L9:;

    /* "chess/__init__cp.pyx":2221
 *         self.castling_rights = BB_EMPTY
 * 
 *         for flag in castling_fen:             # <<<<<<<<<<<<<<
 *             color = WHITE if flag.isupper() else BLACK
 *             flag = flag.lower()
 */
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":2211
 *         self.clear_stack()
 * 
 *     def _set_castling_fen(self, castling_fen):             # <<<<<<<<<<<<<<
 *         if not castling_fen or castling_fen == "-":
 *             self.castling_rights = BB_EMPTY
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("chess.__init__cp.Board._set_castling_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_flag);
  __Pyx_XDECREF(__pyx_v_backrank);
  __Pyx_XDECREF(__pyx_v_rooks);
  __Pyx_XDECREF(__pyx_v_king);
  __Pyx_XDECREF(__pyx_v_rook);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2244
 *                 self.castling_rights |= BB_FILES[FILE_NAMES.index(flag)] & backrank
 * 
 *     def set_castling_fen(self, castling_fen):             # <<<<<<<<<<<<<<
 *         """
 *         Sets castling rights from a string in FEN notation like ``Qqk``.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_89set_castling_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_castling_fen); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_88set_castling_fen[] = "\n        Sets castling rights from a string in FEN notation like ``Qqk``.\n\n        :raises: :exc:`ValueError` if the castling FEN is syntactically\n            invalid.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_89set_castling_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_castling_fen) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_castling_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_88set_castling_fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_castling_fen));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_88set_castling_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_castling_fen) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_castling_fen", 0);

  /* "chess/__init__cp.pyx":2251
 *             invalid.
 *         """
 *         self._set_castling_fen(castling_fen)             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_castling_fen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2251, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_castling_fen) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_castling_fen);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2251, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2252
 *         """
 *         self._set_castling_fen(castling_fen)
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def set_board_fen(self, fen):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2244
 *                 self.castling_rights |= BB_FILES[FILE_NAMES.index(flag)] & backrank
 * 
 *     def set_castling_fen(self, castling_fen):             # <<<<<<<<<<<<<<
 *         """
 *         Sets castling rights from a string in FEN notation like ``Qqk``.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_castling_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2254
 *         self.clear_stack()
 * 
 *     def set_board_fen(self, fen):             # <<<<<<<<<<<<<<
 *         super().set_board_fen(fen)
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_91set_board_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_91set_board_fen(PyObject *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_board_fen (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_90set_board_fen(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_fen));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_90set_board_fen(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_fen) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_board_fen", 0);

  /* "chess/__init__cp.pyx":2255
 * 
 *     def set_board_fen(self, fen):
 *         super().set_board_fen(fen)             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_set_board_fen_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_fen) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_fen);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2256
 *     def set_board_fen(self, fen):
 *         super().set_board_fen(fen)
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def set_piece_map(self, pieces):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2256, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2256, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2254
 *         self.clear_stack()
 * 
 *     def set_board_fen(self, fen):             # <<<<<<<<<<<<<<
 *         super().set_board_fen(fen)
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_board_fen", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2258
 *         self.clear_stack()
 * 
 *     def set_piece_map(self, pieces):             # <<<<<<<<<<<<<<
 *         super().set_piece_map(pieces)
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_93set_piece_map(PyObject *__pyx_v_self, PyObject *__pyx_v_pieces); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_93set_piece_map(PyObject *__pyx_v_self, PyObject *__pyx_v_pieces) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_piece_map (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_92set_piece_map(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_pieces));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_92set_piece_map(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_pieces) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_piece_map", 0);

  /* "chess/__init__cp.pyx":2259
 * 
 *     def set_piece_map(self, pieces):
 *         super().set_piece_map(pieces)             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_set_piece_map_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_pieces) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_pieces);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2260
 *     def set_piece_map(self, pieces):
 *         super().set_piece_map(pieces)
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def set_chess960_pos(self, sharnagl):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2258
 *         self.clear_stack()
 * 
 *     def set_piece_map(self, pieces):             # <<<<<<<<<<<<<<
 *         super().set_piece_map(pieces)
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_piece_map", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2262
 *         self.clear_stack()
 * 
 *     def set_chess960_pos(self, sharnagl):             # <<<<<<<<<<<<<<
 *         super().set_chess960_pos(sharnagl)
 *         self.chess960 = True
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_95set_chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_v_sharnagl); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_95set_chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_chess960_pos (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_94set_chess960_pos(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_sharnagl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_94set_chess960_pos(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  unsigned PY_LONG_LONG __pyx_t_4;
  __Pyx_RefNannySetupContext("set_chess960_pos", 0);

  /* "chess/__init__cp.pyx":2263
 * 
 *     def set_chess960_pos(self, sharnagl):
 *         super().set_chess960_pos(sharnagl)             # <<<<<<<<<<<<<<
 *         self.chess960 = True
 *         self.turn = WHITE
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_set_chess960_pos_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_sharnagl) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sharnagl);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2264
 *     def set_chess960_pos(self, sharnagl):
 *         super().set_chess960_pos(sharnagl)
 *         self.chess960 = True             # <<<<<<<<<<<<<<
 *         self.turn = WHITE
 *         self.castling_rights = self.rooks
 */
  __pyx_v_self->__pyx_base.chess960 = 1;

  /* "chess/__init__cp.pyx":2265
 *         super().set_chess960_pos(sharnagl)
 *         self.chess960 = True
 *         self.turn = WHITE             # <<<<<<<<<<<<<<
 *         self.castling_rights = self.rooks
 *         self.ep_square = None
 */
  __pyx_v_self->__pyx_base.turn = 1;

  /* "chess/__init__cp.pyx":2266
 *         self.chess960 = True
 *         self.turn = WHITE
 *         self.castling_rights = self.rooks             # <<<<<<<<<<<<<<
 *         self.ep_square = None
 *         self.halfmove_clock = 0
 */
  __pyx_t_4 = __pyx_v_self->__pyx_base.rooks;
  __pyx_v_self->__pyx_base.castling_rights = __pyx_t_4;

  /* "chess/__init__cp.pyx":2267
 *         self.turn = WHITE
 *         self.castling_rights = self.rooks
 *         self.ep_square = None             # <<<<<<<<<<<<<<
 *         self.halfmove_clock = 0
 *         self.fullmove_number = 1
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->__pyx_base.ep_square);
  __Pyx_DECREF(__pyx_v_self->__pyx_base.ep_square);
  __pyx_v_self->__pyx_base.ep_square = Py_None;

  /* "chess/__init__cp.pyx":2268
 *         self.castling_rights = self.rooks
 *         self.ep_square = None
 *         self.halfmove_clock = 0             # <<<<<<<<<<<<<<
 *         self.fullmove_number = 1
 * 
 */
  __pyx_v_self->__pyx_base.halfmove_clock = 0;

  /* "chess/__init__cp.pyx":2269
 *         self.ep_square = None
 *         self.halfmove_clock = 0
 *         self.fullmove_number = 1             # <<<<<<<<<<<<<<
 * 
 *         self.clear_stack()
 */
  __pyx_v_self->__pyx_base.fullmove_number = 1;

  /* "chess/__init__cp.pyx":2271
 *         self.fullmove_number = 1
 * 
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def chess960_pos(self, *, ignore_turn=False, ignore_castling=False, ignore_counters=True):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2271, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2262
 *         self.clear_stack()
 * 
 *     def set_chess960_pos(self, sharnagl):             # <<<<<<<<<<<<<<
 *         super().set_chess960_pos(sharnagl)
 *         self.chess960 = True
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2273
 *         self.clear_stack()
 * 
 *     def chess960_pos(self, *, ignore_turn=False, ignore_castling=False, ignore_counters=True):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Chess960 starting position index between 0 and 956
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_97chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_96chess960_pos[] = "\n        Gets the Chess960 starting position index between 0 and 956\n        or ``None`` if the current position is not a Chess960 starting\n        position.\n\n        By default white to move (**ignore_turn**) and full castling rights\n        (**ignore_castling**) are required, but move counters\n        (**ignore_counters**) are ignored.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_97chess960_pos(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ignore_turn = 0;
  PyObject *__pyx_v_ignore_castling = 0;
  PyObject *__pyx_v_ignore_counters = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("chess960_pos (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ignore_turn,&__pyx_n_s_ignore_castling,&__pyx_n_s_ignore_counters,0};
    PyObject* values[3] = {0,0,0};
    values[0] = ((PyObject *)Py_False);
    values[1] = ((PyObject *)Py_False);
    values[2] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args > 0 && likely(kw_args <= 3)) {
        Py_ssize_t index;
        for (index = 0; index < 3 && kw_args > 0; index++) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
          if (value) { values[index] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "chess960_pos") < 0)) __PYX_ERR(0, 2273, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_ignore_turn = values[0];
    __pyx_v_ignore_castling = values[1];
    __pyx_v_ignore_counters = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("chess960_pos", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2273, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_96chess960_pos(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_ignore_turn, __pyx_v_ignore_castling, __pyx_v_ignore_counters);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_96chess960_pos(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_ignore_turn, PyObject *__pyx_v_ignore_castling, PyObject *__pyx_v_ignore_counters) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("chess960_pos", 0);

  /* "chess/__init__cp.pyx":2283
 *         (**ignore_counters**) are ignored.
 *         """
 *         if self.ep_square:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2283, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2284
 *         """
 *         if self.ep_square:
 *             return None             # <<<<<<<<<<<<<<
 * 
 *         if not ignore_turn:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2283
 *         (**ignore_counters**) are ignored.
 *         """
 *         if self.ep_square:             # <<<<<<<<<<<<<<
 *             return None
 * 
 */
  }

  /* "chess/__init__cp.pyx":2286
 *             return None
 * 
 *         if not ignore_turn:             # <<<<<<<<<<<<<<
 *             if self.turn != WHITE:
 *                 return None
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_ignore_turn); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2286, __pyx_L1_error)
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2287
 * 
 *         if not ignore_turn:
 *             if self.turn != WHITE:             # <<<<<<<<<<<<<<
 *                 return None
 * 
 */
    __pyx_t_2 = ((__pyx_v_self->__pyx_base.turn != 1) != 0);
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2288
 *         if not ignore_turn:
 *             if self.turn != WHITE:
 *                 return None             # <<<<<<<<<<<<<<
 * 
 *         if not ignore_castling:
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2287
 * 
 *         if not ignore_turn:
 *             if self.turn != WHITE:             # <<<<<<<<<<<<<<
 *                 return None
 * 
 */
    }

    /* "chess/__init__cp.pyx":2286
 *             return None
 * 
 *         if not ignore_turn:             # <<<<<<<<<<<<<<
 *             if self.turn != WHITE:
 *                 return None
 */
  }

  /* "chess/__init__cp.pyx":2290
 *                 return None
 * 
 *         if not ignore_castling:             # <<<<<<<<<<<<<<
 *             if self.clean_castling_rights() != self.rooks:
 *                 return None
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_ignore_castling); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2290, __pyx_L1_error)
  __pyx_t_1 = ((!__pyx_t_2) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2291
 * 
 *         if not ignore_castling:
 *             if self.clean_castling_rights() != self.rooks:             # <<<<<<<<<<<<<<
 *                 return None
 * 
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2291, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2291, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2291, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2291, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2291, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2292
 *         if not ignore_castling:
 *             if self.clean_castling_rights() != self.rooks:
 *                 return None             # <<<<<<<<<<<<<<
 * 
 *         if not ignore_counters:
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2291
 * 
 *         if not ignore_castling:
 *             if self.clean_castling_rights() != self.rooks:             # <<<<<<<<<<<<<<
 *                 return None
 * 
 */
    }

    /* "chess/__init__cp.pyx":2290
 *                 return None
 * 
 *         if not ignore_castling:             # <<<<<<<<<<<<<<
 *             if self.clean_castling_rights() != self.rooks:
 *                 return None
 */
  }

  /* "chess/__init__cp.pyx":2294
 *                 return None
 * 
 *         if not ignore_counters:             # <<<<<<<<<<<<<<
 *             if self.fullmove_number != 1 or self.halfmove_clock != 0:
 *                 return None
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_ignore_counters); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2294, __pyx_L1_error)
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2295
 * 
 *         if not ignore_counters:
 *             if self.fullmove_number != 1 or self.halfmove_clock != 0:             # <<<<<<<<<<<<<<
 *                 return None
 * 
 */
    __pyx_t_1 = ((__pyx_v_self->__pyx_base.fullmove_number != 1) != 0);
    if (!__pyx_t_1) {
    } else {
      __pyx_t_2 = __pyx_t_1;
      goto __pyx_L10_bool_binop_done;
    }
    __pyx_t_1 = ((__pyx_v_self->__pyx_base.halfmove_clock != 0) != 0);
    __pyx_t_2 = __pyx_t_1;
    __pyx_L10_bool_binop_done:;
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2296
 *         if not ignore_counters:
 *             if self.fullmove_number != 1 or self.halfmove_clock != 0:
 *                 return None             # <<<<<<<<<<<<<<
 * 
 *         return super().chess960_pos()
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2295
 * 
 *         if not ignore_counters:
 *             if self.fullmove_number != 1 or self.halfmove_clock != 0:             # <<<<<<<<<<<<<<
 *                 return None
 * 
 */
    }

    /* "chess/__init__cp.pyx":2294
 *                 return None
 * 
 *         if not ignore_counters:             # <<<<<<<<<<<<<<
 *             if self.fullmove_number != 1 or self.halfmove_clock != 0:
 *                 return None
 */
  }

  /* "chess/__init__cp.pyx":2298
 *                 return None
 * 
 *         return super().chess960_pos()             # <<<<<<<<<<<<<<
 * 
 *     def _epd_operations(self, operations):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2298, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2298, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_chess960_pos); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2298, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2298, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2273
 *         self.clear_stack()
 * 
 *     def chess960_pos(self, *, ignore_turn=False, ignore_castling=False, ignore_counters=True):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Chess960 starting position index between 0 and 956
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2300
 *         return super().chess960_pos()
 * 
 *     def _epd_operations(self, operations):             # <<<<<<<<<<<<<<
 *         epd = []
 *         first_op = True
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_99_epd_operations(PyObject *__pyx_v_self, PyObject *__pyx_v_operations); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_99_epd_operations(PyObject *__pyx_v_self, PyObject *__pyx_v_operations) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_epd_operations (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_98_epd_operations(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_operations));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_98_epd_operations(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_operations) {
  PyObject *__pyx_v_epd = NULL;
  int __pyx_v_first_op;
  PyObject *__pyx_v_opcode = NULL;
  PyObject *__pyx_v_operand = NULL;
  struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_position = NULL;
  PyObject *__pyx_v_iterator = NULL;
  PyObject *__pyx_v_first_move = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  Py_ssize_t __pyx_t_14;
  PyObject *(*__pyx_t_15)(PyObject *);
  __Pyx_RefNannySetupContext("_epd_operations", 0);

  /* "chess/__init__cp.pyx":2301
 * 
 *     def _epd_operations(self, operations):
 *         epd = []             # <<<<<<<<<<<<<<
 *         first_op = True
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2301, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_epd = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2302
 *     def _epd_operations(self, operations):
 *         epd = []
 *         first_op = True             # <<<<<<<<<<<<<<
 * 
 *         for opcode, operand in operations.items():
 */
  __pyx_v_first_op = 1;

  /* "chess/__init__cp.pyx":2304
 *         first_op = True
 * 
 *         for opcode, operand in operations.items():             # <<<<<<<<<<<<<<
 *             if not first_op:
 *                 epd.append(" ")
 */
  __pyx_t_2 = 0;
  if (unlikely(__pyx_v_operations == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
    __PYX_ERR(0, 2304, __pyx_L1_error)
  }
  __pyx_t_5 = __Pyx_dict_iterator(__pyx_v_operations, 0, __pyx_n_s_items, (&__pyx_t_3), (&__pyx_t_4)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2304, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_1);
  __pyx_t_1 = __pyx_t_5;
  __pyx_t_5 = 0;
  while (1) {
    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_3, &__pyx_t_2, &__pyx_t_5, &__pyx_t_6, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_7 == 0)) break;
    if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 2304, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_opcode, __pyx_t_5);
    __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_operand, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2305
 * 
 *         for opcode, operand in operations.items():
 *             if not first_op:             # <<<<<<<<<<<<<<
 *                 epd.append(" ")
 *             first_op = False
 */
    __pyx_t_8 = ((!(__pyx_v_first_op != 0)) != 0);
    if (__pyx_t_8) {

      /* "chess/__init__cp.pyx":2306
 *         for opcode, operand in operations.items():
 *             if not first_op:
 *                 epd.append(" ")             # <<<<<<<<<<<<<<
 *             first_op = False
 *             epd.append(opcode)
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__14); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2306, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2305
 * 
 *         for opcode, operand in operations.items():
 *             if not first_op:             # <<<<<<<<<<<<<<
 *                 epd.append(" ")
 *             first_op = False
 */
    }

    /* "chess/__init__cp.pyx":2307
 *             if not first_op:
 *                 epd.append(" ")
 *             first_op = False             # <<<<<<<<<<<<<<
 *             epd.append(opcode)
 * 
 */
    __pyx_v_first_op = 0;

    /* "chess/__init__cp.pyx":2308
 *                 epd.append(" ")
 *             first_op = False
 *             epd.append(opcode)             # <<<<<<<<<<<<<<
 * 
 *             # Value is empty.
 */
    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_v_opcode); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2308, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2311
 * 
 *             # Value is empty.
 *             if operand is None:             # <<<<<<<<<<<<<<
 *                 epd.append(";")
 *                 continue
 */
    __pyx_t_8 = (__pyx_v_operand == Py_None);
    __pyx_t_10 = (__pyx_t_8 != 0);
    if (__pyx_t_10) {

      /* "chess/__init__cp.pyx":2312
 *             # Value is empty.
 *             if operand is None:
 *                 epd.append(";")             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__35); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2312, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2313
 *             if operand is None:
 *                 epd.append(";")
 *                 continue             # <<<<<<<<<<<<<<
 * 
 *             # Value is a move.
 */
      goto __pyx_L3_continue;

      /* "chess/__init__cp.pyx":2311
 * 
 *             # Value is empty.
 *             if operand is None:             # <<<<<<<<<<<<<<
 *                 epd.append(";")
 *                 continue
 */
    }

    /* "chess/__init__cp.pyx":2316
 * 
 *             # Value is a move.
 *             if hasattr(operand, "from_square") and hasattr(operand, "to_square") and hasattr(operand, "promotion"):             # <<<<<<<<<<<<<<
 *                 # Append SAN for moves.
 *                 epd.append(" ")
 */
    __pyx_t_8 = __Pyx_HasAttr(__pyx_v_operand, __pyx_n_u_from_square); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2316, __pyx_L1_error)
    __pyx_t_11 = (__pyx_t_8 != 0);
    if (__pyx_t_11) {
    } else {
      __pyx_t_10 = __pyx_t_11;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_11 = __Pyx_HasAttr(__pyx_v_operand, __pyx_n_u_to_square); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 2316, __pyx_L1_error)
    __pyx_t_8 = (__pyx_t_11 != 0);
    if (__pyx_t_8) {
    } else {
      __pyx_t_10 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_8 = __Pyx_HasAttr(__pyx_v_operand, __pyx_n_u_promotion); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2316, __pyx_L1_error)
    __pyx_t_11 = (__pyx_t_8 != 0);
    __pyx_t_10 = __pyx_t_11;
    __pyx_L8_bool_binop_done:;
    if (__pyx_t_10) {

      /* "chess/__init__cp.pyx":2318
 *             if hasattr(operand, "from_square") and hasattr(operand, "to_square") and hasattr(operand, "promotion"):
 *                 # Append SAN for moves.
 *                 epd.append(" ")             # <<<<<<<<<<<<<<
 *                 epd.append(self.san(operand))
 *                 epd.append(";")
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__14); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2318, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2319
 *                 # Append SAN for moves.
 *                 epd.append(" ")
 *                 epd.append(self.san(operand))             # <<<<<<<<<<<<<<
 *                 epd.append(";")
 *                 continue
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_san); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2319, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_12 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_12)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_12);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_12, __pyx_v_operand) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_operand);
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2319, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_6); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2319, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2320
 *                 epd.append(" ")
 *                 epd.append(self.san(operand))
 *                 epd.append(";")             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__35); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2320, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2321
 *                 epd.append(self.san(operand))
 *                 epd.append(";")
 *                 continue             # <<<<<<<<<<<<<<
 * 
 *             # Value is numeric.
 */
      goto __pyx_L3_continue;

      /* "chess/__init__cp.pyx":2316
 * 
 *             # Value is a move.
 *             if hasattr(operand, "from_square") and hasattr(operand, "to_square") and hasattr(operand, "promotion"):             # <<<<<<<<<<<<<<
 *                 # Append SAN for moves.
 *                 epd.append(" ")
 */
    }

    /* "chess/__init__cp.pyx":2324
 * 
 *             # Value is numeric.
 *             if isinstance(operand, (int, float)):             # <<<<<<<<<<<<<<
 *                 # Append integer or float.
 *                 epd.append(" ")
 */
    __pyx_t_11 = PyInt_Check(__pyx_v_operand); 
    __pyx_t_8 = (__pyx_t_11 != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_10 = __pyx_t_8;
      goto __pyx_L12_bool_binop_done;
    }
    __pyx_t_8 = PyFloat_Check(__pyx_v_operand); 
    __pyx_t_11 = (__pyx_t_8 != 0);
    __pyx_t_10 = __pyx_t_11;
    __pyx_L12_bool_binop_done:;
    __pyx_t_11 = (__pyx_t_10 != 0);
    if (__pyx_t_11) {

      /* "chess/__init__cp.pyx":2326
 *             if isinstance(operand, (int, float)):
 *                 # Append integer or float.
 *                 epd.append(" ")             # <<<<<<<<<<<<<<
 *                 epd.append(str(operand))
 *                 epd.append(";")
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__14); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2326, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2327
 *                 # Append integer or float.
 *                 epd.append(" ")
 *                 epd.append(str(operand))             # <<<<<<<<<<<<<<
 *                 epd.append(";")
 *                 continue
 */
      __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_operand); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2327, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_6); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2327, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2328
 *                 epd.append(" ")
 *                 epd.append(str(operand))
 *                 epd.append(";")             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__35); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2328, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2329
 *                 epd.append(str(operand))
 *                 epd.append(";")
 *                 continue             # <<<<<<<<<<<<<<
 * 
 *             # Value is a set of moves or a variation.
 */
      goto __pyx_L3_continue;

      /* "chess/__init__cp.pyx":2324
 * 
 *             # Value is numeric.
 *             if isinstance(operand, (int, float)):             # <<<<<<<<<<<<<<
 *                 # Append integer or float.
 *                 epd.append(" ")
 */
    }

    /* "chess/__init__cp.pyx":2332
 * 
 *             # Value is a set of moves or a variation.
 *             if hasattr(operand, "__iter__"):             # <<<<<<<<<<<<<<
 *                 position = Board(self.shredder_fen()) if opcode == "pv" else self
 *                 iterator = operand.__iter__()
 */
    __pyx_t_11 = __Pyx_HasAttr(__pyx_v_operand, __pyx_n_u_iter); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 2332, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_11 != 0);
    if (__pyx_t_10) {

      /* "chess/__init__cp.pyx":2333
 *             # Value is a set of moves or a variation.
 *             if hasattr(operand, "__iter__"):
 *                 position = Board(self.shredder_fen()) if opcode == "pv" else self             # <<<<<<<<<<<<<<
 *                 iterator = operand.__iter__()
 *                 first_move = next(iterator)
 */
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_opcode, __pyx_n_u_pv, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2333, __pyx_L1_error)
      if (__pyx_t_10) {
        __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_shredder_fen); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2333, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_13 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_12))) {
          __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
          if (likely(__pyx_t_13)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
            __Pyx_INCREF(__pyx_t_13);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_12, function);
          }
        }
        __pyx_t_5 = (__pyx_t_13) ? __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_13) : __Pyx_PyObject_CallNoArg(__pyx_t_12);
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2333, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board), __pyx_t_5); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2333, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_6 = __pyx_t_12;
        __pyx_t_12 = 0;
      } else {
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        __pyx_t_6 = ((PyObject *)__pyx_v_self);
      }
      __Pyx_XDECREF_SET(__pyx_v_position, ((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_t_6));
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2334
 *             if hasattr(operand, "__iter__"):
 *                 position = Board(self.shredder_fen()) if opcode == "pv" else self
 *                 iterator = operand.__iter__()             # <<<<<<<<<<<<<<
 *                 first_move = next(iterator)
 *                 if hasattr(first_move, "from_square") and hasattr(first_move, "to_square") and hasattr(first_move, "promotion"):
 */
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_operand, __pyx_n_s_iter); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2334, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_12);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2334, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_XDECREF_SET(__pyx_v_iterator, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2335
 *                 position = Board(self.shredder_fen()) if opcode == "pv" else self
 *                 iterator = operand.__iter__()
 *                 first_move = next(iterator)             # <<<<<<<<<<<<<<
 *                 if hasattr(first_move, "from_square") and hasattr(first_move, "to_square") and hasattr(first_move, "promotion"):
 *                     epd.append(" ")
 */
      __pyx_t_6 = __Pyx_PyIter_Next(__pyx_v_iterator); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2335, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_XDECREF_SET(__pyx_v_first_move, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2336
 *                 iterator = operand.__iter__()
 *                 first_move = next(iterator)
 *                 if hasattr(first_move, "from_square") and hasattr(first_move, "to_square") and hasattr(first_move, "promotion"):             # <<<<<<<<<<<<<<
 *                     epd.append(" ")
 *                     epd.append(position.san(first_move))
 */
      __pyx_t_11 = __Pyx_HasAttr(__pyx_v_first_move, __pyx_n_u_from_square); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 2336, __pyx_L1_error)
      __pyx_t_8 = (__pyx_t_11 != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_10 = __pyx_t_8;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_8 = __Pyx_HasAttr(__pyx_v_first_move, __pyx_n_u_to_square); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2336, __pyx_L1_error)
      __pyx_t_11 = (__pyx_t_8 != 0);
      if (__pyx_t_11) {
      } else {
        __pyx_t_10 = __pyx_t_11;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_11 = __Pyx_HasAttr(__pyx_v_first_move, __pyx_n_u_promotion); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 2336, __pyx_L1_error)
      __pyx_t_8 = (__pyx_t_11 != 0);
      __pyx_t_10 = __pyx_t_8;
      __pyx_L16_bool_binop_done:;
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2337
 *                 first_move = next(iterator)
 *                 if hasattr(first_move, "from_square") and hasattr(first_move, "to_square") and hasattr(first_move, "promotion"):
 *                     epd.append(" ")             # <<<<<<<<<<<<<<
 *                     epd.append(position.san(first_move))
 *                     if opcode == "pv":
 */
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__14); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2337, __pyx_L1_error)

        /* "chess/__init__cp.pyx":2338
 *                 if hasattr(first_move, "from_square") and hasattr(first_move, "to_square") and hasattr(first_move, "promotion"):
 *                     epd.append(" ")
 *                     epd.append(position.san(first_move))             # <<<<<<<<<<<<<<
 *                     if opcode == "pv":
 *                         position.push(first_move)
 */
        __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_position), __pyx_n_s_san); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2338, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_5 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_12))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_12);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_12, function);
          }
        }
        __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_5, __pyx_v_first_move) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_v_first_move);
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2338, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_6); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2338, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

        /* "chess/__init__cp.pyx":2339
 *                     epd.append(" ")
 *                     epd.append(position.san(first_move))
 *                     if opcode == "pv":             # <<<<<<<<<<<<<<
 *                         position.push(first_move)
 * 
 */
        __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_opcode, __pyx_n_u_pv, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2339, __pyx_L1_error)
        if (__pyx_t_10) {

          /* "chess/__init__cp.pyx":2340
 *                     epd.append(position.san(first_move))
 *                     if opcode == "pv":
 *                         position.push(first_move)             # <<<<<<<<<<<<<<
 * 
 *                     for move in iterator:
 */
          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_position), __pyx_n_s_push); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2340, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_5 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_12))) {
            __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_12);
            if (likely(__pyx_t_5)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_12, function);
            }
          }
          __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_5, __pyx_v_first_move) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_v_first_move);
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2340, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

          /* "chess/__init__cp.pyx":2339
 *                     epd.append(" ")
 *                     epd.append(position.san(first_move))
 *                     if opcode == "pv":             # <<<<<<<<<<<<<<
 *                         position.push(first_move)
 * 
 */
        }

        /* "chess/__init__cp.pyx":2342
 *                         position.push(first_move)
 * 
 *                     for move in iterator:             # <<<<<<<<<<<<<<
 *                         epd.append(" ")
 *                         epd.append(position.san(move))
 */
        if (likely(PyList_CheckExact(__pyx_v_iterator)) || PyTuple_CheckExact(__pyx_v_iterator)) {
          __pyx_t_6 = __pyx_v_iterator; __Pyx_INCREF(__pyx_t_6); __pyx_t_14 = 0;
          __pyx_t_15 = NULL;
        } else {
          __pyx_t_14 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_iterator); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2342, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_15 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2342, __pyx_L1_error)
        }
        for (;;) {
          if (likely(!__pyx_t_15)) {
            if (likely(PyList_CheckExact(__pyx_t_6))) {
              if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_6)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_12 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_14); __Pyx_INCREF(__pyx_t_12); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 2342, __pyx_L1_error)
              #else
              __pyx_t_12 = PySequence_ITEM(__pyx_t_6, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2342, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_12);
              #endif
            } else {
              if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_12 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_14); __Pyx_INCREF(__pyx_t_12); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 2342, __pyx_L1_error)
              #else
              __pyx_t_12 = PySequence_ITEM(__pyx_t_6, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2342, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_12);
              #endif
            }
          } else {
            __pyx_t_12 = __pyx_t_15(__pyx_t_6);
            if (unlikely(!__pyx_t_12)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 2342, __pyx_L1_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_12);
          }
          __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_12);
          __pyx_t_12 = 0;

          /* "chess/__init__cp.pyx":2343
 * 
 *                     for move in iterator:
 *                         epd.append(" ")             # <<<<<<<<<<<<<<
 *                         epd.append(position.san(move))
 *                         if opcode == "pv":
 */
          __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__14); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2343, __pyx_L1_error)

          /* "chess/__init__cp.pyx":2344
 *                     for move in iterator:
 *                         epd.append(" ")
 *                         epd.append(position.san(move))             # <<<<<<<<<<<<<<
 *                         if opcode == "pv":
 *                             position.push(move)
 */
          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_position), __pyx_n_s_san); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2344, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_13 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_13)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_13);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_12 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_13, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_move);
          __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
          if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2344, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_12); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2344, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

          /* "chess/__init__cp.pyx":2345
 *                         epd.append(" ")
 *                         epd.append(position.san(move))
 *                         if opcode == "pv":             # <<<<<<<<<<<<<<
 *                             position.push(move)
 * 
 */
          __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_opcode, __pyx_n_u_pv, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2345, __pyx_L1_error)
          if (__pyx_t_10) {

            /* "chess/__init__cp.pyx":2346
 *                         epd.append(position.san(move))
 *                         if opcode == "pv":
 *                             position.push(move)             # <<<<<<<<<<<<<<
 * 
 *                     epd.append(";")
 */
            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_position), __pyx_n_s_push); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2346, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __pyx_t_13 = NULL;
            if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
              __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
              if (likely(__pyx_t_13)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
                __Pyx_INCREF(__pyx_t_13);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_5, function);
              }
            }
            __pyx_t_12 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_13, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_move);
            __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
            if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2346, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

            /* "chess/__init__cp.pyx":2345
 *                         epd.append(" ")
 *                         epd.append(position.san(move))
 *                         if opcode == "pv":             # <<<<<<<<<<<<<<
 *                             position.push(move)
 * 
 */
          }

          /* "chess/__init__cp.pyx":2342
 *                         position.push(first_move)
 * 
 *                     for move in iterator:             # <<<<<<<<<<<<<<
 *                         epd.append(" ")
 *                         epd.append(position.san(move))
 */
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

        /* "chess/__init__cp.pyx":2348
 *                             position.push(move)
 * 
 *                     epd.append(";")             # <<<<<<<<<<<<<<
 *                     continue
 * 
 */
        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__35); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2348, __pyx_L1_error)

        /* "chess/__init__cp.pyx":2349
 * 
 *                     epd.append(";")
 *                     continue             # <<<<<<<<<<<<<<
 * 
 *             # Append as escaped string.
 */
        goto __pyx_L3_continue;

        /* "chess/__init__cp.pyx":2336
 *                 iterator = operand.__iter__()
 *                 first_move = next(iterator)
 *                 if hasattr(first_move, "from_square") and hasattr(first_move, "to_square") and hasattr(first_move, "promotion"):             # <<<<<<<<<<<<<<
 *                     epd.append(" ")
 *                     epd.append(position.san(first_move))
 */
      }

      /* "chess/__init__cp.pyx":2332
 * 
 *             # Value is a set of moves or a variation.
 *             if hasattr(operand, "__iter__"):             # <<<<<<<<<<<<<<
 *                 position = Board(self.shredder_fen()) if opcode == "pv" else self
 *                 iterator = operand.__iter__()
 */
    }

    /* "chess/__init__cp.pyx":2352
 * 
 *             # Append as escaped string.
 *             epd.append(" \"")             # <<<<<<<<<<<<<<
 *             epd.append(str(operand).replace("\r", "").replace("\n", " ").replace("\\", "\\\\").replace("\"", "\\\""))
 *             epd.append("\";")
 */
    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__36); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2352, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2353
 *             # Append as escaped string.
 *             epd.append(" \"")
 *             epd.append(str(operand).replace("\r", "").replace("\n", " ").replace("\\", "\\\\").replace("\"", "\\\""))             # <<<<<<<<<<<<<<
 *             epd.append("\";")
 * 
 */
    __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_operand); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2353, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_12 = PyUnicode_Replace(((PyObject*)__pyx_t_6), __pyx_kp_u__37, __pyx_kp_u__13, -1L); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2353, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyUnicode_Replace(((PyObject*)__pyx_t_12), __pyx_kp_u__19, __pyx_kp_u__14, -1L); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2353, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = PyUnicode_Replace(((PyObject*)__pyx_t_6), __pyx_kp_u__38, __pyx_kp_u__39, -1L); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2353, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyUnicode_Replace(((PyObject*)__pyx_t_12), __pyx_kp_u__40, __pyx_kp_u__41, -1L); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2353, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_6); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2353, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2354
 *             epd.append(" \"")
 *             epd.append(str(operand).replace("\r", "").replace("\n", " ").replace("\\", "\\\\").replace("\"", "\\\""))
 *             epd.append("\";")             # <<<<<<<<<<<<<<
 * 
 *         return "".join(epd)
 */
    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_kp_u__42); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 2354, __pyx_L1_error)
    __pyx_L3_continue:;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2356
 *             epd.append("\";")
 * 
 *         return "".join(epd)             # <<<<<<<<<<<<<<
 * 
 *     def epd(self, *, shredder=False, en_passant="legal", promoted=None, **operations):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_epd); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2300
 *         return super().chess960_pos()
 * 
 *     def _epd_operations(self, operations):             # <<<<<<<<<<<<<<
 *         epd = []
 *         first_op = True
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("chess.__init__cp.Board._epd_operations", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_epd);
  __Pyx_XDECREF(__pyx_v_opcode);
  __Pyx_XDECREF(__pyx_v_operand);
  __Pyx_XDECREF((PyObject *)__pyx_v_position);
  __Pyx_XDECREF(__pyx_v_iterator);
  __Pyx_XDECREF(__pyx_v_first_move);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2358
 *         return "".join(epd)
 * 
 *     def epd(self, *, shredder=False, en_passant="legal", promoted=None, **operations):             # <<<<<<<<<<<<<<
 *         """
 *         Gets an EPD representation of the current position.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_101epd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_100epd[] = "\n        Gets an EPD representation of the current position.\n\n        See :func:`~chess.Board.fen()` for FEN formatting options (*shredder*,\n        *ep_square* and *promoted*).\n\n        EPD operations can be given as keyword arguments. Supported operands\n        are strings, integers, floats, moves, lists of moves and ``None``.\n        All other operands are converted to strings.\n\n        A list of moves for *pv* will be interpreted as a variation. All other\n        move lists are interpreted as a set of moves in the current position.\n\n        *hmvc* and *fmvc* are not included by default. You can use:\n\n        >>> import chess\n        >>>\n        >>> board = chess.Board()\n        >>> board.epd(hmvc=board.halfmove_clock, fmvc=board.fullmove_number)\n        'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - hmvc 0; fmvc 1;'\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_101epd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_shredder = 0;
  PyObject *__pyx_v_en_passant = 0;
  PyObject *__pyx_v_promoted = 0;
  PyObject *__pyx_v_operations = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("epd (wrapper)", 0);
  __pyx_v_operations = PyDict_New(); if (unlikely(!__pyx_v_operations)) return NULL;
  __Pyx_GOTREF(__pyx_v_operations);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_shredder,&__pyx_n_s_en_passant,&__pyx_n_s_promoted,0};
    PyObject* values[3] = {0,0,0};
    values[0] = ((PyObject *)Py_False);
    values[1] = ((PyObject *)__pyx_n_u_legal);
    values[2] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args > 0 && (kw_args <= 3)) {
        Py_ssize_t index;
        for (index = 0; index < 3 && kw_args > 0; index++) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
          if (value) { values[index] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_operations, values, 0, "epd") < 0)) __PYX_ERR(0, 2358, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_shredder = values[0];
    __pyx_v_en_passant = values[1];
    __pyx_v_promoted = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("epd", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2358, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_DECREF(__pyx_v_operations); __pyx_v_operations = 0;
  __Pyx_AddTraceback("chess.__init__cp.Board.epd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_100epd(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_shredder, __pyx_v_en_passant, __pyx_v_promoted, __pyx_v_operations);

  /* function exit code */
  __Pyx_XDECREF(__pyx_v_operations);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_100epd(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_shredder, PyObject *__pyx_v_en_passant, PyObject *__pyx_v_promoted, PyObject *__pyx_v_operations) {
  PyObject *__pyx_v_epd = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("epd", 0);

  /* "chess/__init__cp.pyx":2380
 *         'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - hmvc 0; fmvc 1;'
 *         """
 *         epd = [self.board_fen(promoted=promoted),             # <<<<<<<<<<<<<<
 *                "w" if self.turn == WHITE else "b",
 *                self.castling_shredder_fen() if shredder else self.castling_xfen()]
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_promoted, __pyx_v_promoted) < 0) __PYX_ERR(0, 2380, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2381
 *         """
 *         epd = [self.board_fen(promoted=promoted),
 *                "w" if self.turn == WHITE else "b",             # <<<<<<<<<<<<<<
 *                self.castling_shredder_fen() if shredder else self.castling_xfen()]
 * 
 */
  if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
    __Pyx_INCREF(__pyx_n_u_w);
    __pyx_t_2 = __pyx_n_u_w;
  } else {
    __Pyx_INCREF(__pyx_n_u_b);
    __pyx_t_2 = __pyx_n_u_b;
  }

  /* "chess/__init__cp.pyx":2382
 *         epd = [self.board_fen(promoted=promoted),
 *                "w" if self.turn == WHITE else "b",
 *                self.castling_shredder_fen() if shredder else self.castling_xfen()]             # <<<<<<<<<<<<<<
 * 
 *         if en_passant == "fen":
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_shredder); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2382, __pyx_L1_error)
  if (__pyx_t_4) {
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_castling_shredder_fen); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2382, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2382, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_1 = __pyx_t_5;
    __pyx_t_5 = 0;
  } else {
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_castling_xfen); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2382, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2382, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_1 = __pyx_t_5;
    __pyx_t_5 = 0;
  }

  /* "chess/__init__cp.pyx":2380
 *         'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - hmvc 0; fmvc 1;'
 *         """
 *         epd = [self.board_fen(promoted=promoted),             # <<<<<<<<<<<<<<
 *                "w" if self.turn == WHITE else "b",
 *                self.castling_shredder_fen() if shredder else self.castling_xfen()]
 */
  __pyx_t_5 = PyList_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_3);
  PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyList_SET_ITEM(__pyx_t_5, 2, __pyx_t_1);
  __pyx_t_3 = 0;
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;
  __pyx_v_epd = ((PyObject*)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":2384
 *                self.castling_shredder_fen() if shredder else self.castling_xfen()]
 * 
 *         if en_passant == "fen":             # <<<<<<<<<<<<<<
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.ep_square is not None else "-")
 *         elif en_passant == "xfen":
 */
  __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_v_en_passant, __pyx_n_u_fen, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2384, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":2385
 * 
 *         if en_passant == "fen":
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.ep_square is not None else "-")             # <<<<<<<<<<<<<<
 *         elif en_passant == "xfen":
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_pseudo_legal_en_passant() else "-")
 */
    __pyx_t_4 = (__pyx_v_self->__pyx_base.ep_square != Py_None);
    if ((__pyx_t_4 != 0)) {
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2385, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2385, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_5 = __pyx_t_2;
      __pyx_t_2 = 0;
    } else {
      __Pyx_INCREF(__pyx_kp_u__34);
      __pyx_t_5 = __pyx_kp_u__34;
    }
    __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_5); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2385, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2384
 *                self.castling_shredder_fen() if shredder else self.castling_xfen()]
 * 
 *         if en_passant == "fen":             # <<<<<<<<<<<<<<
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.ep_square is not None else "-")
 *         elif en_passant == "xfen":
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":2386
 *         if en_passant == "fen":
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.ep_square is not None else "-")
 *         elif en_passant == "xfen":             # <<<<<<<<<<<<<<
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_pseudo_legal_en_passant() else "-")
 *         else:
 */
  __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_v_en_passant, __pyx_n_u_xfen, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2386, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":2387
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.ep_square is not None else "-")
 *         elif en_passant == "xfen":
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_pseudo_legal_en_passant() else "-")             # <<<<<<<<<<<<<<
 *         else:
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_legal_en_passant() else "-")
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_pseudo_legal_en_passant); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2387, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2387, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2387, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_4) {
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2387, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2387, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_5 = __pyx_t_1;
      __pyx_t_1 = 0;
    } else {
      __Pyx_INCREF(__pyx_kp_u__34);
      __pyx_t_5 = __pyx_kp_u__34;
    }
    __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_5); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2387, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2386
 *         if en_passant == "fen":
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.ep_square is not None else "-")
 *         elif en_passant == "xfen":             # <<<<<<<<<<<<<<
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_pseudo_legal_en_passant() else "-")
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":2389
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_pseudo_legal_en_passant() else "-")
 *         else:
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_legal_en_passant() else "-")             # <<<<<<<<<<<<<<
 * 
 *         if operations:
 */
  /*else*/ {
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_legal_en_passant); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2389, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2389, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2389, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_4) {
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2389, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2389, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_5 = __pyx_t_2;
      __pyx_t_2 = 0;
    } else {
      __Pyx_INCREF(__pyx_kp_u__34);
      __pyx_t_5 = __pyx_kp_u__34;
    }
    __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_5); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2389, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":2391
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_legal_en_passant() else "-")
 * 
 *         if operations:             # <<<<<<<<<<<<<<
 *             epd.append(self._epd_operations(operations))
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_operations); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2391, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":2392
 * 
 *         if operations:
 *             epd.append(self._epd_operations(operations))             # <<<<<<<<<<<<<<
 * 
 *         return " ".join(epd)
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_epd_operations); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2392, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_5 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_v_operations) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_operations);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2392, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_epd, __pyx_t_5); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 2392, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2391
 *             epd.append(SQUARE_NAMES[self.ep_square] if self.has_legal_en_passant() else "-")
 * 
 *         if operations:             # <<<<<<<<<<<<<<
 *             epd.append(self._epd_operations(operations))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2394
 *             epd.append(self._epd_operations(operations))
 * 
 *         return " ".join(epd)             # <<<<<<<<<<<<<<
 * 
 *     def _parse_epd_ops(self, operation_part, make_board):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = PyUnicode_Join(__pyx_kp_u__14, __pyx_v_epd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2394, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2358
 *         return "".join(epd)
 * 
 *     def epd(self, *, shredder=False, en_passant="legal", promoted=None, **operations):             # <<<<<<<<<<<<<<
 *         """
 *         Gets an EPD representation of the current position.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.epd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_epd);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2396
 *         return " ".join(epd)
 * 
 *     def _parse_epd_ops(self, operation_part, make_board):             # <<<<<<<<<<<<<<
 *         operations = {}
 *         state = "opcode"
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_103_parse_epd_ops(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_103_parse_epd_ops(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_operation_part = 0;
  PyObject *__pyx_v_make_board = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_parse_epd_ops (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_operation_part,&__pyx_n_s_make_board,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_operation_part)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_make_board)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_parse_epd_ops", 1, 2, 2, 1); __PYX_ERR(0, 2396, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_parse_epd_ops") < 0)) __PYX_ERR(0, 2396, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_operation_part = values[0];
    __pyx_v_make_board = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_parse_epd_ops", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2396, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._parse_epd_ops", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_102_parse_epd_ops(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_operation_part, __pyx_v_make_board);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_102_parse_epd_ops(CYTHON_UNUSED struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_operation_part, PyObject *__pyx_v_make_board) {
  PyObject *__pyx_v_operations = NULL;
  PyObject *__pyx_v_state = NULL;
  PyObject *__pyx_v_opcode = NULL;
  PyObject *__pyx_v_operand = NULL;
  PyObject *__pyx_v_position = NULL;
  PyObject *__pyx_v_ch = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_9genexpr10__pyx_v_token = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  Py_ssize_t __pyx_t_14;
  PyObject *(*__pyx_t_15)(PyObject *);
  int __pyx_t_16;
  PyObject *__pyx_t_17 = NULL;
  __Pyx_RefNannySetupContext("_parse_epd_ops", 0);

  /* "chess/__init__cp.pyx":2397
 * 
 *     def _parse_epd_ops(self, operation_part, make_board):
 *         operations = {}             # <<<<<<<<<<<<<<
 *         state = "opcode"
 *         opcode = ""
 */
  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2397, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_operations = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2398
 *     def _parse_epd_ops(self, operation_part, make_board):
 *         operations = {}
 *         state = "opcode"             # <<<<<<<<<<<<<<
 *         opcode = ""
 *         operand = ""
 */
  __Pyx_INCREF(__pyx_n_u_opcode);
  __pyx_v_state = __pyx_n_u_opcode;

  /* "chess/__init__cp.pyx":2399
 *         operations = {}
 *         state = "opcode"
 *         opcode = ""             # <<<<<<<<<<<<<<
 *         operand = ""
 *         position = None
 */
  __Pyx_INCREF(__pyx_kp_u__13);
  __pyx_v_opcode = __pyx_kp_u__13;

  /* "chess/__init__cp.pyx":2400
 *         state = "opcode"
 *         opcode = ""
 *         operand = ""             # <<<<<<<<<<<<<<
 *         position = None
 * 
 */
  __Pyx_INCREF(__pyx_kp_u__13);
  __pyx_v_operand = __pyx_kp_u__13;

  /* "chess/__init__cp.pyx":2401
 *         opcode = ""
 *         operand = ""
 *         position = None             # <<<<<<<<<<<<<<
 * 
 *         for ch in itertools.chain(operation_part, [None]):
 */
  __Pyx_INCREF(Py_None);
  __pyx_v_position = Py_None;

  /* "chess/__init__cp.pyx":2403
 *         position = None
 * 
 *         for ch in itertools.chain(operation_part, [None]):             # <<<<<<<<<<<<<<
 *             if state == "opcode":
 *                 if ch == " ":
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_itertools); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2403, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2403, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2403, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  PyList_SET_ITEM(__pyx_t_2, 0, Py_None);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_operation_part, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2403, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_operation_part, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2403, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2403, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_INCREF(__pyx_v_operation_part);
    __Pyx_GIVEREF(__pyx_v_operation_part);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_operation_part);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2403, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; __Pyx_INCREF(__pyx_t_3); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2403, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2403, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 2403, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2403, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 2403, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2403, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_8(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2403, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_ch, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2404
 * 
 *         for ch in itertools.chain(operation_part, [None]):
 *             if state == "opcode":             # <<<<<<<<<<<<<<
 *                 if ch == " ":
 *                     if opcode:
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_opcode, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2404, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_9 != 0);
    if (__pyx_t_10) {

      /* "chess/__init__cp.pyx":2405
 *         for ch in itertools.chain(operation_part, [None]):
 *             if state == "opcode":
 *                 if ch == " ":             # <<<<<<<<<<<<<<
 *                     if opcode:
 *                         state = "after_opcode"
 */
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_ch, __pyx_kp_u__14, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2405, __pyx_L1_error)
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2406
 *             if state == "opcode":
 *                 if ch == " ":
 *                     if opcode:             # <<<<<<<<<<<<<<
 *                         state = "after_opcode"
 *                 elif ch in [";", None]:
 */
        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_v_opcode); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2406, __pyx_L1_error)
        if (__pyx_t_10) {

          /* "chess/__init__cp.pyx":2407
 *                 if ch == " ":
 *                     if opcode:
 *                         state = "after_opcode"             # <<<<<<<<<<<<<<
 *                 elif ch in [";", None]:
 *                     if opcode:
 */
          __Pyx_INCREF(__pyx_n_u_after_opcode);
          __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_after_opcode);

          /* "chess/__init__cp.pyx":2406
 *             if state == "opcode":
 *                 if ch == " ":
 *                     if opcode:             # <<<<<<<<<<<<<<
 *                         state = "after_opcode"
 *                 elif ch in [";", None]:
 */
        }

        /* "chess/__init__cp.pyx":2405
 *         for ch in itertools.chain(operation_part, [None]):
 *             if state == "opcode":
 *                 if ch == " ":             # <<<<<<<<<<<<<<
 *                     if opcode:
 *                         state = "after_opcode"
 */
        goto __pyx_L6;
      }

      /* "chess/__init__cp.pyx":2408
 *                     if opcode:
 *                         state = "after_opcode"
 *                 elif ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     if opcode:
 *                         operations[opcode] = None
 */
      __Pyx_INCREF(__pyx_v_ch);
      __pyx_t_1 = __pyx_v_ch;
      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__35, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2408, __pyx_L1_error)
      if (!__pyx_t_9) {
      } else {
        __pyx_t_10 = __pyx_t_9;
        goto __pyx_L8_bool_binop_done;
      }
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2408, __pyx_L1_error)
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2408, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_t_9;
      __pyx_L8_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = (__pyx_t_10 != 0);
      if (__pyx_t_9) {

        /* "chess/__init__cp.pyx":2409
 *                         state = "after_opcode"
 *                 elif ch in [";", None]:
 *                     if opcode:             # <<<<<<<<<<<<<<
 *                         operations[opcode] = None
 *                         opcode = ""
 */
        __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_opcode); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2409, __pyx_L1_error)
        if (__pyx_t_9) {

          /* "chess/__init__cp.pyx":2410
 *                 elif ch in [";", None]:
 *                     if opcode:
 *                         operations[opcode] = None             # <<<<<<<<<<<<<<
 *                         opcode = ""
 *                 else:
 */
          if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, Py_None) < 0)) __PYX_ERR(0, 2410, __pyx_L1_error)

          /* "chess/__init__cp.pyx":2411
 *                     if opcode:
 *                         operations[opcode] = None
 *                         opcode = ""             # <<<<<<<<<<<<<<
 *                 else:
 *                     opcode += ch
 */
          __Pyx_INCREF(__pyx_kp_u__13);
          __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_kp_u__13);

          /* "chess/__init__cp.pyx":2409
 *                         state = "after_opcode"
 *                 elif ch in [";", None]:
 *                     if opcode:             # <<<<<<<<<<<<<<
 *                         operations[opcode] = None
 *                         opcode = ""
 */
        }

        /* "chess/__init__cp.pyx":2408
 *                     if opcode:
 *                         state = "after_opcode"
 *                 elif ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     if opcode:
 *                         operations[opcode] = None
 */
        goto __pyx_L6;
      }

      /* "chess/__init__cp.pyx":2413
 *                         opcode = ""
 *                 else:
 *                     opcode += ch             # <<<<<<<<<<<<<<
 *             elif state == "after_opcode":
 *                 if ch == " ":
 */
      /*else*/ {
        __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_opcode, __pyx_v_ch); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2413, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_t_1);
        __pyx_t_1 = 0;
      }
      __pyx_L6:;

      /* "chess/__init__cp.pyx":2404
 * 
 *         for ch in itertools.chain(operation_part, [None]):
 *             if state == "opcode":             # <<<<<<<<<<<<<<
 *                 if ch == " ":
 *                     if opcode:
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":2414
 *                 else:
 *                     opcode += ch
 *             elif state == "after_opcode":             # <<<<<<<<<<<<<<
 *                 if ch == " ":
 *                     pass
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_after_opcode, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2414, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_9 != 0);
    if (__pyx_t_10) {

      /* "chess/__init__cp.pyx":2415
 *                     opcode += ch
 *             elif state == "after_opcode":
 *                 if ch == " ":             # <<<<<<<<<<<<<<
 *                     pass
 *                 elif ch in "+-.0123456789":
 */
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_ch, __pyx_kp_u__14, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2415, __pyx_L1_error)
      if (__pyx_t_10) {
        goto __pyx_L11;
      }

      /* "chess/__init__cp.pyx":2417
 *                 if ch == " ":
 *                     pass
 *                 elif ch in "+-.0123456789":             # <<<<<<<<<<<<<<
 *                     operand = ch
 *                     state = "numeric"
 */
      __pyx_t_10 = (__Pyx_PyUnicode_ContainsTF(__pyx_v_ch, __pyx_kp_u_0123456789, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2417, __pyx_L1_error)
      __pyx_t_9 = (__pyx_t_10 != 0);
      if (__pyx_t_9) {

        /* "chess/__init__cp.pyx":2418
 *                     pass
 *                 elif ch in "+-.0123456789":
 *                     operand = ch             # <<<<<<<<<<<<<<
 *                     state = "numeric"
 *                 elif ch == "\"":
 */
        __Pyx_INCREF(__pyx_v_ch);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_v_ch);

        /* "chess/__init__cp.pyx":2419
 *                 elif ch in "+-.0123456789":
 *                     operand = ch
 *                     state = "numeric"             # <<<<<<<<<<<<<<
 *                 elif ch == "\"":
 *                     state = "string"
 */
        __Pyx_INCREF(__pyx_n_u_numeric);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_numeric);

        /* "chess/__init__cp.pyx":2417
 *                 if ch == " ":
 *                     pass
 *                 elif ch in "+-.0123456789":             # <<<<<<<<<<<<<<
 *                     operand = ch
 *                     state = "numeric"
 */
        goto __pyx_L11;
      }

      /* "chess/__init__cp.pyx":2420
 *                     operand = ch
 *                     state = "numeric"
 *                 elif ch == "\"":             # <<<<<<<<<<<<<<
 *                     state = "string"
 *                 elif ch in [";", None]:
 */
      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_ch, __pyx_kp_u__40, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2420, __pyx_L1_error)
      if (__pyx_t_9) {

        /* "chess/__init__cp.pyx":2421
 *                     state = "numeric"
 *                 elif ch == "\"":
 *                     state = "string"             # <<<<<<<<<<<<<<
 *                 elif ch in [";", None]:
 *                     if opcode:
 */
        __Pyx_INCREF(__pyx_n_u_string);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_string);

        /* "chess/__init__cp.pyx":2420
 *                     operand = ch
 *                     state = "numeric"
 *                 elif ch == "\"":             # <<<<<<<<<<<<<<
 *                     state = "string"
 *                 elif ch in [";", None]:
 */
        goto __pyx_L11;
      }

      /* "chess/__init__cp.pyx":2422
 *                 elif ch == "\"":
 *                     state = "string"
 *                 elif ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     if opcode:
 *                         operations[opcode] = None
 */
      __Pyx_INCREF(__pyx_v_ch);
      __pyx_t_1 = __pyx_v_ch;
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__35, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2422, __pyx_L1_error)
      if (!__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L12_bool_binop_done;
      }
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2422, __pyx_L1_error)
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2422, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = __pyx_t_10;
      __pyx_L12_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = (__pyx_t_9 != 0);
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2423
 *                     state = "string"
 *                 elif ch in [";", None]:
 *                     if opcode:             # <<<<<<<<<<<<<<
 *                         operations[opcode] = None
 *                         opcode = ""
 */
        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_v_opcode); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2423, __pyx_L1_error)
        if (__pyx_t_10) {

          /* "chess/__init__cp.pyx":2424
 *                 elif ch in [";", None]:
 *                     if opcode:
 *                         operations[opcode] = None             # <<<<<<<<<<<<<<
 *                         opcode = ""
 *                     state = "opcode"
 */
          if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, Py_None) < 0)) __PYX_ERR(0, 2424, __pyx_L1_error)

          /* "chess/__init__cp.pyx":2425
 *                     if opcode:
 *                         operations[opcode] = None
 *                         opcode = ""             # <<<<<<<<<<<<<<
 *                     state = "opcode"
 *                 else:
 */
          __Pyx_INCREF(__pyx_kp_u__13);
          __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_kp_u__13);

          /* "chess/__init__cp.pyx":2423
 *                     state = "string"
 *                 elif ch in [";", None]:
 *                     if opcode:             # <<<<<<<<<<<<<<
 *                         operations[opcode] = None
 *                         opcode = ""
 */
        }

        /* "chess/__init__cp.pyx":2426
 *                         operations[opcode] = None
 *                         opcode = ""
 *                     state = "opcode"             # <<<<<<<<<<<<<<
 *                 else:
 *                     operand = ch
 */
        __Pyx_INCREF(__pyx_n_u_opcode);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_opcode);

        /* "chess/__init__cp.pyx":2422
 *                 elif ch == "\"":
 *                     state = "string"
 *                 elif ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     if opcode:
 *                         operations[opcode] = None
 */
        goto __pyx_L11;
      }

      /* "chess/__init__cp.pyx":2428
 *                     state = "opcode"
 *                 else:
 *                     operand = ch             # <<<<<<<<<<<<<<
 *                     state = "san"
 *             elif state == "numeric":
 */
      /*else*/ {
        __Pyx_INCREF(__pyx_v_ch);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_v_ch);

        /* "chess/__init__cp.pyx":2429
 *                 else:
 *                     operand = ch
 *                     state = "san"             # <<<<<<<<<<<<<<
 *             elif state == "numeric":
 *                 if ch in [";", None]:
 */
        __Pyx_INCREF(__pyx_n_u_san);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_san);
      }
      __pyx_L11:;

      /* "chess/__init__cp.pyx":2414
 *                 else:
 *                     opcode += ch
 *             elif state == "after_opcode":             # <<<<<<<<<<<<<<
 *                 if ch == " ":
 *                     pass
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":2430
 *                     operand = ch
 *                     state = "san"
 *             elif state == "numeric":             # <<<<<<<<<<<<<<
 *                 if ch in [";", None]:
 *                     operations[opcode] = float(operand)
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_numeric, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2430, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "chess/__init__cp.pyx":2431
 *                     state = "san"
 *             elif state == "numeric":
 *                 if ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     operations[opcode] = float(operand)
 *                     try:
 */
      __Pyx_INCREF(__pyx_v_ch);
      __pyx_t_1 = __pyx_v_ch;
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__35, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2431, __pyx_L1_error)
      if (!__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2431, __pyx_L1_error)
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2431, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = __pyx_t_10;
      __pyx_L16_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = (__pyx_t_9 != 0);
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2432
 *             elif state == "numeric":
 *                 if ch in [";", None]:
 *                     operations[opcode] = float(operand)             # <<<<<<<<<<<<<<
 *                     try:
 *                         operations[opcode] = int(operand)
 */
        __pyx_t_1 = __Pyx_PyNumber_Float(__pyx_v_operand); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2432, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_t_1) < 0)) __PYX_ERR(0, 2432, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":2433
 *                 if ch in [";", None]:
 *                     operations[opcode] = float(operand)
 *                     try:             # <<<<<<<<<<<<<<
 *                         operations[opcode] = int(operand)
 *                     except:
 */
        {
          __Pyx_PyThreadState_declare
          __Pyx_PyThreadState_assign
          __Pyx_ExceptionSave(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13);
          __Pyx_XGOTREF(__pyx_t_11);
          __Pyx_XGOTREF(__pyx_t_12);
          __Pyx_XGOTREF(__pyx_t_13);
          /*try:*/ {

            /* "chess/__init__cp.pyx":2434
 *                     operations[opcode] = float(operand)
 *                     try:
 *                         operations[opcode] = int(operand)             # <<<<<<<<<<<<<<
 *                     except:
 *                         pass
 */
            __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_v_operand); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2434, __pyx_L18_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_t_1) < 0)) __PYX_ERR(0, 2434, __pyx_L18_error)
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

            /* "chess/__init__cp.pyx":2433
 *                 if ch in [";", None]:
 *                     operations[opcode] = float(operand)
 *                     try:             # <<<<<<<<<<<<<<
 *                         operations[opcode] = int(operand)
 *                     except:
 */
          }
          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
          goto __pyx_L25_try_end;
          __pyx_L18_error:;
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

          /* "chess/__init__cp.pyx":2435
 *                     try:
 *                         operations[opcode] = int(operand)
 *                     except:             # <<<<<<<<<<<<<<
 *                         pass
 *                     opcode = ""
 */
          /*except:*/ {
            __Pyx_ErrRestore(0,0,0);
            goto __pyx_L19_exception_handled;
          }
          __pyx_L19_exception_handled:;
          __Pyx_XGIVEREF(__pyx_t_11);
          __Pyx_XGIVEREF(__pyx_t_12);
          __Pyx_XGIVEREF(__pyx_t_13);
          __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
          __pyx_L25_try_end:;
        }

        /* "chess/__init__cp.pyx":2437
 *                     except:
 *                         pass
 *                     opcode = ""             # <<<<<<<<<<<<<<
 *                     operand = ""
 *                     state = "opcode"
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2438
 *                         pass
 *                     opcode = ""
 *                     operand = ""             # <<<<<<<<<<<<<<
 *                     state = "opcode"
 *                 else:
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2439
 *                     opcode = ""
 *                     operand = ""
 *                     state = "opcode"             # <<<<<<<<<<<<<<
 *                 else:
 *                     operand += ch
 */
        __Pyx_INCREF(__pyx_n_u_opcode);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_opcode);

        /* "chess/__init__cp.pyx":2431
 *                     state = "san"
 *             elif state == "numeric":
 *                 if ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     operations[opcode] = float(operand)
 *                     try:
 */
        goto __pyx_L15;
      }

      /* "chess/__init__cp.pyx":2441
 *                     state = "opcode"
 *                 else:
 *                     operand += ch             # <<<<<<<<<<<<<<
 *             elif state == "string":
 *                 if ch in ["\"", None]:
 */
      /*else*/ {
        __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_operand, __pyx_v_ch); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2441, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_t_1);
        __pyx_t_1 = 0;
      }
      __pyx_L15:;

      /* "chess/__init__cp.pyx":2430
 *                     operand = ch
 *                     state = "san"
 *             elif state == "numeric":             # <<<<<<<<<<<<<<
 *                 if ch in [";", None]:
 *                     operations[opcode] = float(operand)
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":2442
 *                 else:
 *                     operand += ch
 *             elif state == "string":             # <<<<<<<<<<<<<<
 *                 if ch in ["\"", None]:
 *                     operations[opcode] = operand
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_string, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2442, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "chess/__init__cp.pyx":2443
 *                     operand += ch
 *             elif state == "string":
 *                 if ch in ["\"", None]:             # <<<<<<<<<<<<<<
 *                     operations[opcode] = operand
 *                     opcode = ""
 */
      __Pyx_INCREF(__pyx_v_ch);
      __pyx_t_1 = __pyx_v_ch;
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__40, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2443, __pyx_L1_error)
      if (!__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L27_bool_binop_done;
      }
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2443, __pyx_L1_error)
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2443, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = __pyx_t_10;
      __pyx_L27_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = (__pyx_t_9 != 0);
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2444
 *             elif state == "string":
 *                 if ch in ["\"", None]:
 *                     operations[opcode] = operand             # <<<<<<<<<<<<<<
 *                     opcode = ""
 *                     operand = ""
 */
        if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_v_operand) < 0)) __PYX_ERR(0, 2444, __pyx_L1_error)

        /* "chess/__init__cp.pyx":2445
 *                 if ch in ["\"", None]:
 *                     operations[opcode] = operand
 *                     opcode = ""             # <<<<<<<<<<<<<<
 *                     operand = ""
 *                     state = "opcode"
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2446
 *                     operations[opcode] = operand
 *                     opcode = ""
 *                     operand = ""             # <<<<<<<<<<<<<<
 *                     state = "opcode"
 *                 elif ch == "\\":
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2447
 *                     opcode = ""
 *                     operand = ""
 *                     state = "opcode"             # <<<<<<<<<<<<<<
 *                 elif ch == "\\":
 *                     state = "string_escape"
 */
        __Pyx_INCREF(__pyx_n_u_opcode);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_opcode);

        /* "chess/__init__cp.pyx":2443
 *                     operand += ch
 *             elif state == "string":
 *                 if ch in ["\"", None]:             # <<<<<<<<<<<<<<
 *                     operations[opcode] = operand
 *                     opcode = ""
 */
        goto __pyx_L26;
      }

      /* "chess/__init__cp.pyx":2448
 *                     operand = ""
 *                     state = "opcode"
 *                 elif ch == "\\":             # <<<<<<<<<<<<<<
 *                     state = "string_escape"
 *                 else:
 */
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_ch, __pyx_kp_u__38, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2448, __pyx_L1_error)
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2449
 *                     state = "opcode"
 *                 elif ch == "\\":
 *                     state = "string_escape"             # <<<<<<<<<<<<<<
 *                 else:
 *                     operand += ch
 */
        __Pyx_INCREF(__pyx_n_u_string_escape);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_string_escape);

        /* "chess/__init__cp.pyx":2448
 *                     operand = ""
 *                     state = "opcode"
 *                 elif ch == "\\":             # <<<<<<<<<<<<<<
 *                     state = "string_escape"
 *                 else:
 */
        goto __pyx_L26;
      }

      /* "chess/__init__cp.pyx":2451
 *                     state = "string_escape"
 *                 else:
 *                     operand += ch             # <<<<<<<<<<<<<<
 *             elif state == "string_escape":
 *                 if ch is None:
 */
      /*else*/ {
        __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_operand, __pyx_v_ch); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2451, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_t_1);
        __pyx_t_1 = 0;
      }
      __pyx_L26:;

      /* "chess/__init__cp.pyx":2442
 *                 else:
 *                     operand += ch
 *             elif state == "string":             # <<<<<<<<<<<<<<
 *                 if ch in ["\"", None]:
 *                     operations[opcode] = operand
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":2452
 *                 else:
 *                     operand += ch
 *             elif state == "string_escape":             # <<<<<<<<<<<<<<
 *                 if ch is None:
 *                     operations[opcode] = operand
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_string_escape, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2452, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "chess/__init__cp.pyx":2453
 *                     operand += ch
 *             elif state == "string_escape":
 *                 if ch is None:             # <<<<<<<<<<<<<<
 *                     operations[opcode] = operand
 *                     opcode = ""
 */
      __pyx_t_9 = (__pyx_v_ch == Py_None);
      __pyx_t_10 = (__pyx_t_9 != 0);
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2454
 *             elif state == "string_escape":
 *                 if ch is None:
 *                     operations[opcode] = operand             # <<<<<<<<<<<<<<
 *                     opcode = ""
 *                     operand = ""
 */
        if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_v_operand) < 0)) __PYX_ERR(0, 2454, __pyx_L1_error)

        /* "chess/__init__cp.pyx":2455
 *                 if ch is None:
 *                     operations[opcode] = operand
 *                     opcode = ""             # <<<<<<<<<<<<<<
 *                     operand = ""
 *                     state = "opcode"
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2456
 *                     operations[opcode] = operand
 *                     opcode = ""
 *                     operand = ""             # <<<<<<<<<<<<<<
 *                     state = "opcode"
 *                 else:
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2457
 *                     opcode = ""
 *                     operand = ""
 *                     state = "opcode"             # <<<<<<<<<<<<<<
 *                 else:
 *                     operand += ch
 */
        __Pyx_INCREF(__pyx_n_u_opcode);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_opcode);

        /* "chess/__init__cp.pyx":2453
 *                     operand += ch
 *             elif state == "string_escape":
 *                 if ch is None:             # <<<<<<<<<<<<<<
 *                     operations[opcode] = operand
 *                     opcode = ""
 */
        goto __pyx_L29;
      }

      /* "chess/__init__cp.pyx":2459
 *                     state = "opcode"
 *                 else:
 *                     operand += ch             # <<<<<<<<<<<<<<
 *                     state = "string"
 *             elif state == "san":
 */
      /*else*/ {
        __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_operand, __pyx_v_ch); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2459, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":2460
 *                 else:
 *                     operand += ch
 *                     state = "string"             # <<<<<<<<<<<<<<
 *             elif state == "san":
 *                 if ch in [";", None]:
 */
        __Pyx_INCREF(__pyx_n_u_string);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_string);
      }
      __pyx_L29:;

      /* "chess/__init__cp.pyx":2452
 *                 else:
 *                     operand += ch
 *             elif state == "string_escape":             # <<<<<<<<<<<<<<
 *                 if ch is None:
 *                     operations[opcode] = operand
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":2461
 *                     operand += ch
 *                     state = "string"
 *             elif state == "san":             # <<<<<<<<<<<<<<
 *                 if ch in [";", None]:
 *                     if position is None:
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_san, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2461, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "chess/__init__cp.pyx":2462
 *                     state = "string"
 *             elif state == "san":
 *                 if ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     if position is None:
 *                         position = make_board()
 */
      __Pyx_INCREF(__pyx_v_ch);
      __pyx_t_1 = __pyx_v_ch;
      __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__35, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2462, __pyx_L1_error)
      if (!__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L31_bool_binop_done;
      }
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2462, __pyx_L1_error)
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2462, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = __pyx_t_10;
      __pyx_L31_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = (__pyx_t_9 != 0);
      if (__pyx_t_10) {

        /* "chess/__init__cp.pyx":2463
 *             elif state == "san":
 *                 if ch in [";", None]:
 *                     if position is None:             # <<<<<<<<<<<<<<
 *                         position = make_board()
 * 
 */
        __pyx_t_10 = (__pyx_v_position == Py_None);
        __pyx_t_9 = (__pyx_t_10 != 0);
        if (__pyx_t_9) {

          /* "chess/__init__cp.pyx":2464
 *                 if ch in [";", None]:
 *                     if position is None:
 *                         position = make_board()             # <<<<<<<<<<<<<<
 * 
 *                     if opcode == "pv":
 */
          __Pyx_INCREF(__pyx_v_make_board);
          __pyx_t_6 = __pyx_v_make_board; __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_6, function);
            }
          }
          __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2464, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_DECREF_SET(__pyx_v_position, __pyx_t_1);
          __pyx_t_1 = 0;

          /* "chess/__init__cp.pyx":2463
 *             elif state == "san":
 *                 if ch in [";", None]:
 *                     if position is None:             # <<<<<<<<<<<<<<
 *                         position = make_board()
 * 
 */
        }

        /* "chess/__init__cp.pyx":2466
 *                         position = make_board()
 * 
 *                     if opcode == "pv":             # <<<<<<<<<<<<<<
 *                         # A variation.
 *                         operations[opcode] = []
 */
        __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_opcode, __pyx_n_u_pv, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2466, __pyx_L1_error)
        if (__pyx_t_9) {

          /* "chess/__init__cp.pyx":2468
 *                     if opcode == "pv":
 *                         # A variation.
 *                         operations[opcode] = []             # <<<<<<<<<<<<<<
 *                         for token in operand.split():
 *                             move = position.parse_san(token)
 */
          __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2468, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_t_1) < 0)) __PYX_ERR(0, 2468, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

          /* "chess/__init__cp.pyx":2469
 *                         # A variation.
 *                         operations[opcode] = []
 *                         for token in operand.split():             # <<<<<<<<<<<<<<
 *                             move = position.parse_san(token)
 *                             operations[opcode].append(move)
 */
          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_operand, __pyx_n_s_split); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_6, function);
            }
          }
          __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
            __pyx_t_6 = __pyx_t_1; __Pyx_INCREF(__pyx_t_6); __pyx_t_14 = 0;
            __pyx_t_15 = NULL;
          } else {
            __pyx_t_14 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2469, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __pyx_t_15 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2469, __pyx_L1_error)
          }
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          for (;;) {
            if (likely(!__pyx_t_15)) {
              if (likely(PyList_CheckExact(__pyx_t_6))) {
                if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_6)) break;
                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_1 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 2469, __pyx_L1_error)
                #else
                __pyx_t_1 = PySequence_ITEM(__pyx_t_6, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2469, __pyx_L1_error)
                __Pyx_GOTREF(__pyx_t_1);
                #endif
              } else {
                if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 2469, __pyx_L1_error)
                #else
                __pyx_t_1 = PySequence_ITEM(__pyx_t_6, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2469, __pyx_L1_error)
                __Pyx_GOTREF(__pyx_t_1);
                #endif
              }
            } else {
              __pyx_t_1 = __pyx_t_15(__pyx_t_6);
              if (unlikely(!__pyx_t_1)) {
                PyObject* exc_type = PyErr_Occurred();
                if (exc_type) {
                  if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                  else __PYX_ERR(0, 2469, __pyx_L1_error)
                }
                break;
              }
              __Pyx_GOTREF(__pyx_t_1);
            }
            __Pyx_XDECREF_SET(__pyx_v_token, __pyx_t_1);
            __pyx_t_1 = 0;

            /* "chess/__init__cp.pyx":2470
 *                         operations[opcode] = []
 *                         for token in operand.split():
 *                             move = position.parse_san(token)             # <<<<<<<<<<<<<<
 *                             operations[opcode].append(move)
 *                             position.push(move)
 */
            __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_position, __pyx_n_s_parse_san); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2470, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            __pyx_t_4 = NULL;
            if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
              __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
              if (likely(__pyx_t_4)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
                __Pyx_INCREF(__pyx_t_4);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_2, function);
              }
            }
            __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_token) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_token);
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2470, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_1);
            __pyx_t_1 = 0;

            /* "chess/__init__cp.pyx":2471
 *                         for token in operand.split():
 *                             move = position.parse_san(token)
 *                             operations[opcode].append(move)             # <<<<<<<<<<<<<<
 *                             position.push(move)
 * 
 */
            __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_operations, __pyx_v_opcode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2471, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __pyx_t_16 = __Pyx_PyObject_Append(__pyx_t_1, __pyx_v_move); if (unlikely(__pyx_t_16 == ((int)-1))) __PYX_ERR(0, 2471, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

            /* "chess/__init__cp.pyx":2472
 *                             move = position.parse_san(token)
 *                             operations[opcode].append(move)
 *                             position.push(move)             # <<<<<<<<<<<<<<
 * 
 *                         # Reset the position.
 */
            __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_position, __pyx_n_s_push); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2472, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            __pyx_t_4 = NULL;
            if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
              __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
              if (likely(__pyx_t_4)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
                __Pyx_INCREF(__pyx_t_4);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_2, function);
              }
            }
            __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2472, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

            /* "chess/__init__cp.pyx":2469
 *                         # A variation.
 *                         operations[opcode] = []
 *                         for token in operand.split():             # <<<<<<<<<<<<<<
 *                             move = position.parse_san(token)
 *                             operations[opcode].append(move)
 */
          }
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

          /* "chess/__init__cp.pyx":2475
 * 
 *                         # Reset the position.
 *                         while position.move_stack:             # <<<<<<<<<<<<<<
 *                             position.pop()
 *                     elif opcode in ["bm", "am"]:
 */
          while (1) {
            __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_position, __pyx_n_s_move_stack); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2475, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 2475, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            if (!__pyx_t_9) break;

            /* "chess/__init__cp.pyx":2476
 *                         # Reset the position.
 *                         while position.move_stack:
 *                             position.pop()             # <<<<<<<<<<<<<<
 *                     elif opcode in ["bm", "am"]:
 *                         # A set of moves.
 */
            __pyx_t_6 = __Pyx_PyObject_Pop(__pyx_v_position); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2476, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          }

          /* "chess/__init__cp.pyx":2466
 *                         position = make_board()
 * 
 *                     if opcode == "pv":             # <<<<<<<<<<<<<<
 *                         # A variation.
 *                         operations[opcode] = []
 */
          goto __pyx_L34;
        }

        /* "chess/__init__cp.pyx":2477
 *                         while position.move_stack:
 *                             position.pop()
 *                     elif opcode in ["bm", "am"]:             # <<<<<<<<<<<<<<
 *                         # A set of moves.
 *                         operations[opcode] = [position.parse_san(token) for token in operand.split()]
 */
        __Pyx_INCREF(__pyx_v_opcode);
        __pyx_t_6 = __pyx_v_opcode;
        __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_bm, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2477, __pyx_L1_error)
        if (!__pyx_t_10) {
        } else {
          __pyx_t_9 = __pyx_t_10;
          goto __pyx_L39_bool_binop_done;
        }
        __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_am, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2477, __pyx_L1_error)
        __pyx_t_9 = __pyx_t_10;
        __pyx_L39_bool_binop_done:;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_10 = (__pyx_t_9 != 0);
        if (__pyx_t_10) {

          /* "chess/__init__cp.pyx":2479
 *                     elif opcode in ["bm", "am"]:
 *                         # A set of moves.
 *                         operations[opcode] = [position.parse_san(token) for token in operand.split()]             # <<<<<<<<<<<<<<
 *                     else:
 *                         # A single move.
 */
          { /* enter inner scope */
            __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2479, __pyx_L43_error)
            __Pyx_GOTREF(__pyx_t_6);
            __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_operand, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2479, __pyx_L43_error)
            __Pyx_GOTREF(__pyx_t_2);
            __pyx_t_4 = NULL;
            if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
              __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
              if (likely(__pyx_t_4)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
                __Pyx_INCREF(__pyx_t_4);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_2, function);
              }
            }
            __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2479, __pyx_L43_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
              __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_14 = 0;
              __pyx_t_15 = NULL;
            } else {
              __pyx_t_14 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2479, __pyx_L43_error)
              __Pyx_GOTREF(__pyx_t_2);
              __pyx_t_15 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2479, __pyx_L43_error)
            }
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            for (;;) {
              if (likely(!__pyx_t_15)) {
                if (likely(PyList_CheckExact(__pyx_t_2))) {
                  if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_2)) break;
                  #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                  __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 2479, __pyx_L43_error)
                  #else
                  __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2479, __pyx_L43_error)
                  __Pyx_GOTREF(__pyx_t_1);
                  #endif
                } else {
                  if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
                  #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                  __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 2479, __pyx_L43_error)
                  #else
                  __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2479, __pyx_L43_error)
                  __Pyx_GOTREF(__pyx_t_1);
                  #endif
                }
              } else {
                __pyx_t_1 = __pyx_t_15(__pyx_t_2);
                if (unlikely(!__pyx_t_1)) {
                  PyObject* exc_type = PyErr_Occurred();
                  if (exc_type) {
                    if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                    else __PYX_ERR(0, 2479, __pyx_L43_error)
                  }
                  break;
                }
                __Pyx_GOTREF(__pyx_t_1);
              }
              __Pyx_XDECREF_SET(__pyx_9genexpr10__pyx_v_token, __pyx_t_1);
              __pyx_t_1 = 0;
              __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_position, __pyx_n_s_parse_san); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2479, __pyx_L43_error)
              __Pyx_GOTREF(__pyx_t_4);
              __pyx_t_17 = NULL;
              if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
                __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_4);
                if (likely(__pyx_t_17)) {
                  PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
                  __Pyx_INCREF(__pyx_t_17);
                  __Pyx_INCREF(function);
                  __Pyx_DECREF_SET(__pyx_t_4, function);
                }
              }
              __pyx_t_1 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_17, __pyx_9genexpr10__pyx_v_token) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_9genexpr10__pyx_v_token);
              __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
              if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2479, __pyx_L43_error)
              __Pyx_GOTREF(__pyx_t_1);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              if (unlikely(__Pyx_ListComp_Append(__pyx_t_6, (PyObject*)__pyx_t_1))) __PYX_ERR(0, 2479, __pyx_L43_error)
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            }
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_token); __pyx_9genexpr10__pyx_v_token = 0;
            goto __pyx_L46_exit_scope;
            __pyx_L43_error:;
            __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_token); __pyx_9genexpr10__pyx_v_token = 0;
            goto __pyx_L1_error;
            __pyx_L46_exit_scope:;
          } /* exit inner scope */
          if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_t_6) < 0)) __PYX_ERR(0, 2479, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

          /* "chess/__init__cp.pyx":2477
 *                         while position.move_stack:
 *                             position.pop()
 *                     elif opcode in ["bm", "am"]:             # <<<<<<<<<<<<<<
 *                         # A set of moves.
 *                         operations[opcode] = [position.parse_san(token) for token in operand.split()]
 */
          goto __pyx_L34;
        }

        /* "chess/__init__cp.pyx":2482
 *                     else:
 *                         # A single move.
 *                         operations[opcode] = position.parse_san(operand)             # <<<<<<<<<<<<<<
 * 
 *                     opcode = ""
 */
        /*else*/ {
          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_position, __pyx_n_s_parse_san); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2482, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_1 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_2, function);
            }
          }
          __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_v_operand) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_operand);
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2482, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(PyDict_SetItem(__pyx_v_operations, __pyx_v_opcode, __pyx_t_6) < 0)) __PYX_ERR(0, 2482, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
        __pyx_L34:;

        /* "chess/__init__cp.pyx":2484
 *                         operations[opcode] = position.parse_san(operand)
 * 
 *                     opcode = ""             # <<<<<<<<<<<<<<
 *                     operand = ""
 *                     state = "opcode"
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_opcode, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2485
 * 
 *                     opcode = ""
 *                     operand = ""             # <<<<<<<<<<<<<<
 *                     state = "opcode"
 *                 else:
 */
        __Pyx_INCREF(__pyx_kp_u__13);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_kp_u__13);

        /* "chess/__init__cp.pyx":2486
 *                     opcode = ""
 *                     operand = ""
 *                     state = "opcode"             # <<<<<<<<<<<<<<
 *                 else:
 *                     operand += ch
 */
        __Pyx_INCREF(__pyx_n_u_opcode);
        __Pyx_DECREF_SET(__pyx_v_state, __pyx_n_u_opcode);

        /* "chess/__init__cp.pyx":2462
 *                     state = "string"
 *             elif state == "san":
 *                 if ch in [";", None]:             # <<<<<<<<<<<<<<
 *                     if position is None:
 *                         position = make_board()
 */
        goto __pyx_L30;
      }

      /* "chess/__init__cp.pyx":2488
 *                     state = "opcode"
 *                 else:
 *                     operand += ch             # <<<<<<<<<<<<<<
 * 
 *         assert state == "opcode"
 */
      /*else*/ {
        __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_operand, __pyx_v_ch); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2488, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF_SET(__pyx_v_operand, __pyx_t_6);
        __pyx_t_6 = 0;
      }
      __pyx_L30:;

      /* "chess/__init__cp.pyx":2461
 *                     operand += ch
 *                     state = "string"
 *             elif state == "san":             # <<<<<<<<<<<<<<
 *                 if ch in [";", None]:
 *                     if position is None:
 */
    }
    __pyx_L5:;

    /* "chess/__init__cp.pyx":2403
 *         position = None
 * 
 *         for ch in itertools.chain(operation_part, [None]):             # <<<<<<<<<<<<<<
 *             if state == "opcode":
 *                 if ch == " ":
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2490
 *                     operand += ch
 * 
 *         assert state == "opcode"             # <<<<<<<<<<<<<<
 *         return operations
 * 
 */
  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_state, __pyx_n_u_opcode, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 2490, __pyx_L1_error)
    if (unlikely(!(__pyx_t_10 != 0))) {
      PyErr_SetNone(PyExc_AssertionError);
      __PYX_ERR(0, 2490, __pyx_L1_error)
    }
  }
  #endif

  /* "chess/__init__cp.pyx":2491
 * 
 *         assert state == "opcode"
 *         return operations             # <<<<<<<<<<<<<<
 * 
 *     def set_epd(self, epd):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_operations);
  __pyx_r = __pyx_v_operations;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2396
 *         return " ".join(epd)
 * 
 *     def _parse_epd_ops(self, operation_part, make_board):             # <<<<<<<<<<<<<<
 *         operations = {}
 *         state = "opcode"
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_17);
  __Pyx_AddTraceback("chess.__init__cp.Board._parse_epd_ops", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_operations);
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v_opcode);
  __Pyx_XDECREF(__pyx_v_operand);
  __Pyx_XDECREF(__pyx_v_position);
  __Pyx_XDECREF(__pyx_v_ch);
  __Pyx_XDECREF(__pyx_v_token);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_token);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2493
 *         return operations
 * 
 *     def set_epd(self, epd):             # <<<<<<<<<<<<<<
 *         """
 *         Parses the given EPD string and uses it to set the position.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_105set_epd(PyObject *__pyx_v_self, PyObject *__pyx_v_epd); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_104set_epd[] = "\n        Parses the given EPD string and uses it to set the position.\n\n        If present, ``hmvc`` and ``fmvn`` are used to set the half-move\n        clock and the full-move number. Otherwise, ``0`` and ``1`` are used.\n\n        Returns a dictionary of parsed operations. Values can be strings,\n        integers, floats, move objects, or lists of moves.\n\n        :raises: :exc:`ValueError` if the EPD string is invalid.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_105set_epd(PyObject *__pyx_v_self, PyObject *__pyx_v_epd) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_epd (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_104set_epd(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_epd));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2512
 *         # Parse ops.
 *         if len(parts) > 4:
 *             operations = self._parse_epd_ops(parts.pop(), lambda: type(self)(" ".join(parts) + " 0 1"))             # <<<<<<<<<<<<<<
 *         else:
 *             operations = {}
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_7set_epd_lambda1(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_5Board_7set_epd_lambda1 = {"lambda1", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_7set_epd_lambda1, METH_NOARGS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_7set_epd_lambda1(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lambda1 (wrapper)", 0);
  __pyx_r = __pyx_lambda_funcdef_lambda1(__pyx_self);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_lambda_funcdef_lambda1(PyObject *__pyx_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *__pyx_cur_scope;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *__pyx_outer_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("lambda1", 0);
  __pyx_outer_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 2512, __pyx_L1_error) }
  if (unlikely(!__pyx_cur_scope->__pyx_v_parts)) { __Pyx_RaiseClosureNameError("parts"); __PYX_ERR(0, 2512, __pyx_L1_error) }
  __pyx_t_2 = __pyx_cur_scope->__pyx_v_parts;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_3 = PyUnicode_Join(__pyx_kp_u__14, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2512, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_t_3, __pyx_kp_u_0_1_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2512, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_cur_scope->__pyx_v_self))));
  __pyx_t_3 = ((PyObject *)Py_TYPE(((PyObject *)__pyx_cur_scope->__pyx_v_self))); __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2512, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_epd.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2493
 *         return operations
 * 
 *     def set_epd(self, epd):             # <<<<<<<<<<<<<<
 *         """
 *         Parses the given EPD string and uses it to set the position.
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_104set_epd(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_epd) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *__pyx_cur_scope;
  PyObject *__pyx_v_operations = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  __Pyx_RefNannySetupContext("set_epd", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_7_set_epd(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_7_set_epd, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 2493, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);

  /* "chess/__init__cp.pyx":2506
 *         """
 *         # Split into 4 or 5 parts.
 *         parts = epd.strip().rstrip(";").split(None, 4)             # <<<<<<<<<<<<<<
 *         if len(parts) < 4:
 *             raise ValueError("epd should consist of at least 4 parts: {}".format(repr(epd)))
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_epd, __pyx_n_s_strip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_kp_u__35) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u__35);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_split); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__43, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_parts = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2507
 *         # Split into 4 or 5 parts.
 *         parts = epd.strip().rstrip(";").split(None, 4)
 *         if len(parts) < 4:             # <<<<<<<<<<<<<<
 *             raise ValueError("epd should consist of at least 4 parts: {}".format(repr(epd)))
 * 
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_parts;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_5 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2507, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = ((__pyx_t_5 < 4) != 0);
  if (unlikely(__pyx_t_6)) {

    /* "chess/__init__cp.pyx":2508
 *         parts = epd.strip().rstrip(";").split(None, 4)
 *         if len(parts) < 4:
 *             raise ValueError("epd should consist of at least 4 parts: {}".format(repr(epd)))             # <<<<<<<<<<<<<<
 * 
 *         # Parse ops.
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_epd_should_consist_of_at_least_4, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2508, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_Repr(__pyx_v_epd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2508, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2508, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2508, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 2508, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2507
 *         # Split into 4 or 5 parts.
 *         parts = epd.strip().rstrip(";").split(None, 4)
 *         if len(parts) < 4:             # <<<<<<<<<<<<<<
 *             raise ValueError("epd should consist of at least 4 parts: {}".format(repr(epd)))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2511
 * 
 *         # Parse ops.
 *         if len(parts) > 4:             # <<<<<<<<<<<<<<
 *             operations = self._parse_epd_ops(parts.pop(), lambda: type(self)(" ".join(parts) + " 0 1"))
 *         else:
 */
  __pyx_t_3 = __pyx_cur_scope->__pyx_v_parts;
  __Pyx_INCREF(__pyx_t_3);
  __pyx_t_5 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2511, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = ((__pyx_t_5 > 4) != 0);
  if (__pyx_t_6) {

    /* "chess/__init__cp.pyx":2512
 *         # Parse ops.
 *         if len(parts) > 4:
 *             operations = self._parse_epd_ops(parts.pop(), lambda: type(self)(" ".join(parts) + " 0 1"))             # <<<<<<<<<<<<<<
 *         else:
 *             operations = {}
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_parse_epd_ops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_Pop(__pyx_cur_scope->__pyx_v_parts); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Board_7set_epd_lambda1, 0, __pyx_n_s_set_epd_locals_lambda, ((PyObject*)__pyx_cur_scope), __pyx_n_s_chess___init__cp, __pyx_d, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_2, __pyx_t_4};
      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2512, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_2, __pyx_t_4};
      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2512, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2512, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_4);
      __pyx_t_2 = 0;
      __pyx_t_4 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2512, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_operations = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2511
 * 
 *         # Parse ops.
 *         if len(parts) > 4:             # <<<<<<<<<<<<<<
 *             operations = self._parse_epd_ops(parts.pop(), lambda: type(self)(" ".join(parts) + " 0 1"))
 *         else:
 */
    goto __pyx_L4;
  }

  /* "chess/__init__cp.pyx":2514
 *             operations = self._parse_epd_ops(parts.pop(), lambda: type(self)(" ".join(parts) + " 0 1"))
 *         else:
 *             operations = {}             # <<<<<<<<<<<<<<
 * 
 *         # Create a full FEN and parse it.
 */
  /*else*/ {
    __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2514, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_v_operations = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L4:;

  /* "chess/__init__cp.pyx":2517
 * 
 *         # Create a full FEN and parse it.
 *         parts.append(str(operations["hmvc"]) if "hmvc" in operations else "0")             # <<<<<<<<<<<<<<
 *         parts.append(str(operations["fmvn"]) if "fmvn" in operations else "1")
 *         self.set_fen(" ".join(parts))
 */
  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_hmvc, __pyx_v_operations, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2517, __pyx_L1_error)
  if ((__pyx_t_6 != 0)) {
    __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_v_operations, __pyx_n_u_hmvc); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2517, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2517, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_t_9;
    __pyx_t_9 = 0;
  } else {
    __Pyx_INCREF(__pyx_kp_u_0);
    __pyx_t_3 = __pyx_kp_u_0;
  }
  __pyx_t_10 = __Pyx_PyObject_Append(__pyx_cur_scope->__pyx_v_parts, __pyx_t_3); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 2517, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2518
 *         # Create a full FEN and parse it.
 *         parts.append(str(operations["hmvc"]) if "hmvc" in operations else "0")
 *         parts.append(str(operations["fmvn"]) if "fmvn" in operations else "1")             # <<<<<<<<<<<<<<
 *         self.set_fen(" ".join(parts))
 * 
 */
  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_fmvn, __pyx_v_operations, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2518, __pyx_L1_error)
  if ((__pyx_t_6 != 0)) {
    __pyx_t_9 = __Pyx_PyObject_Dict_GetItem(__pyx_v_operations, __pyx_n_u_fmvn); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2518, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2518, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_3 = __pyx_t_1;
    __pyx_t_1 = 0;
  } else {
    __Pyx_INCREF(__pyx_kp_u_1);
    __pyx_t_3 = __pyx_kp_u_1;
  }
  __pyx_t_10 = __Pyx_PyObject_Append(__pyx_cur_scope->__pyx_v_parts, __pyx_t_3); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 2518, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2519
 *         parts.append(str(operations["hmvc"]) if "hmvc" in operations else "0")
 *         parts.append(str(operations["fmvn"]) if "fmvn" in operations else "1")
 *         self.set_fen(" ".join(parts))             # <<<<<<<<<<<<<<
 * 
 *         return operations
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_set_fen); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2519, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __pyx_cur_scope->__pyx_v_parts;
  __Pyx_INCREF(__pyx_t_9);
  __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__14, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2519, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2519, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2521
 *         self.set_fen(" ".join(parts))
 * 
 *         return operations             # <<<<<<<<<<<<<<
 * 
 *     def san(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_operations);
  __pyx_r = __pyx_v_operations;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2493
 *         return operations
 * 
 *     def set_epd(self, epd):             # <<<<<<<<<<<<<<
 *         """
 *         Parses the given EPD string and uses it to set the position.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("chess.__init__cp.Board.set_epd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_operations);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2523
 *         return operations
 * 
 *     def san(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the standard algebraic notation of the given move in the context
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_107san(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_106san[] = "\n        Gets the standard algebraic notation of the given move in the context\n        of the current position.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_107san(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("san (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_106san(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_106san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("san", 0);

  /* "chess/__init__cp.pyx":2528
 *         of the current position.
 *         """
 *         return self._algebraic(move)             # <<<<<<<<<<<<<<
 * 
 *     def lan(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_algebraic); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2523
 *         return operations
 * 
 *     def san(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the standard algebraic notation of the given move in the context
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.san", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2530
 *         return self._algebraic(move)
 * 
 *     def lan(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the long algebraic notation of the given move in the context of
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_109lan(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_108lan[] = "\n        Gets the long algebraic notation of the given move in the context of\n        the current position.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_109lan(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lan (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_108lan(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_108lan(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("lan", 0);

  /* "chess/__init__cp.pyx":2535
 *         the current position.
 *         """
 *         return self._algebraic(move, long_notation=True)             # <<<<<<<<<<<<<<
 * 
 *     def _algebraic(self, move, long_notation=False):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_algebraic); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2535, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2535, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_move);
  __Pyx_GIVEREF(__pyx_v_move);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_move);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2535, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_long_notation, Py_True) < 0) __PYX_ERR(0, 2535, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2535, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2530
 *         return self._algebraic(move)
 * 
 *     def lan(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the long algebraic notation of the given move in the context of
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.lan", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2537
 *         return self._algebraic(move, long_notation=True)
 * 
 *     def _algebraic(self, move, long_notation=False):             # <<<<<<<<<<<<<<
 *         if not move:
 *             # Null move.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_111_algebraic(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_111_algebraic(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_move = 0;
  PyObject *__pyx_v_long_notation = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_algebraic (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_move,&__pyx_n_s_long_notation,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_move)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_long_notation);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_algebraic") < 0)) __PYX_ERR(0, 2537, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_move = values[0];
    __pyx_v_long_notation = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_algebraic", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2537, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._algebraic", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_110_algebraic(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_move, __pyx_v_long_notation);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_110_algebraic(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move, PyObject *__pyx_v_long_notation) {
  PyObject *__pyx_v_is_check = NULL;
  PyObject *__pyx_v_is_checkmate = NULL;
  PyObject *__pyx_v_san = NULL;
  PyObject *__pyx_v_piece = NULL;
  PyObject *__pyx_v_capture = NULL;
  PyObject *__pyx_v_others = NULL;
  PyObject *__pyx_v_from_mask = NULL;
  PyObject *__pyx_v_to_mask = NULL;
  PyObject *__pyx_v_candidate = NULL;
  int __pyx_v_row;
  int __pyx_v_column;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  __Pyx_RefNannySetupContext("_algebraic", 0);

  /* "chess/__init__cp.pyx":2538
 * 
 *     def _algebraic(self, move, long_notation=False):
 *         if not move:             # <<<<<<<<<<<<<<
 *             # Null move.
 *             return "--"
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_move); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2538, __pyx_L1_error)
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2540
 *         if not move:
 *             # Null move.
 *             return "--"             # <<<<<<<<<<<<<<
 * 
 *         # Look ahead for check or checkmate.
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_u__44);
    __pyx_r = __pyx_kp_u__44;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2538
 * 
 *     def _algebraic(self, move, long_notation=False):
 *         if not move:             # <<<<<<<<<<<<<<
 *             # Null move.
 *             return "--"
 */
  }

  /* "chess/__init__cp.pyx":2543
 * 
 *         # Look ahead for check or checkmate.
 *         self.push(move)             # <<<<<<<<<<<<<<
 *         is_check = self.is_check()
 *         is_checkmate = (is_check and self.is_checkmate()) or self.is_variant_loss() or self.is_variant_win()
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2544
 *         # Look ahead for check or checkmate.
 *         self.push(move)
 *         is_check = self.is_check()             # <<<<<<<<<<<<<<
 *         is_checkmate = (is_check and self.is_checkmate()) or self.is_variant_loss() or self.is_variant_win()
 *         self.pop()
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_check); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2544, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2544, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_is_check = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2545
 *         self.push(move)
 *         is_check = self.is_check()
 *         is_checkmate = (is_check and self.is_checkmate()) or self.is_variant_loss() or self.is_variant_win()             # <<<<<<<<<<<<<<
 *         self.pop()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_is_check); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2545, __pyx_L1_error)
  if (!__pyx_t_2) {
    goto __pyx_L5_next_or;
  } else {
  }
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_checkmate); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2545, __pyx_L1_error)
  if (!__pyx_t_2) {
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_3 = __pyx_t_4;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_L5_next_or:;
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_loss); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2545, __pyx_L1_error)
  if (!__pyx_t_2) {
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_3 = __pyx_t_4;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_variant_win); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_3 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L4_bool_binop_done:;
  __pyx_v_is_checkmate = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2546
 *         is_check = self.is_check()
 *         is_checkmate = (is_check and self.is_checkmate()) or self.is_variant_loss() or self.is_variant_win()
 *         self.pop()             # <<<<<<<<<<<<<<
 * 
 *         # Drops.
 */
  __pyx_t_3 = __Pyx_PyObject_Pop(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2546, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2549
 * 
 *         # Drops.
 *         if move.drop:             # <<<<<<<<<<<<<<
 *             san = ""
 *             if move.drop != PAWN:
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2549, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2549, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2550
 *         # Drops.
 *         if move.drop:
 *             san = ""             # <<<<<<<<<<<<<<
 *             if move.drop != PAWN:
 *                 san = PIECE_SYMBOLS[move.drop].upper()
 */
    __Pyx_INCREF(__pyx_kp_u__13);
    __pyx_v_san = __pyx_kp_u__13;

    /* "chess/__init__cp.pyx":2551
 *         if move.drop:
 *             san = ""
 *             if move.drop != PAWN:             # <<<<<<<<<<<<<<
 *                 san = PIECE_SYMBOLS[move.drop].upper()
 *             san += "@" + SQUARE_NAMES[move.to_square]
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2551, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2551, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2551, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2551, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2552
 *             san = ""
 *             if move.drop != PAWN:
 *                 san = PIECE_SYMBOLS[move.drop].upper()             # <<<<<<<<<<<<<<
 *             san += "@" + SQUARE_NAMES[move.to_square]
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2552, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2552, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2552, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_upper); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2552, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2552, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "chess/__init__cp.pyx":2551
 *         if move.drop:
 *             san = ""
 *             if move.drop != PAWN:             # <<<<<<<<<<<<<<
 *                 san = PIECE_SYMBOLS[move.drop].upper()
 *             san += "@" + SQUARE_NAMES[move.to_square]
 */
    }

    /* "chess/__init__cp.pyx":2553
 *             if move.drop != PAWN:
 *                 san = PIECE_SYMBOLS[move.drop].upper()
 *             san += "@" + SQUARE_NAMES[move.to_square]             # <<<<<<<<<<<<<<
 * 
 *         # Castling.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2553, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2553, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2553, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(__pyx_kp_u__5, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2553, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2553, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2549
 * 
 *         # Drops.
 *         if move.drop:             # <<<<<<<<<<<<<<
 *             san = ""
 *             if move.drop != PAWN:
 */
  }

  /* "chess/__init__cp.pyx":2556
 * 
 *         # Castling.
 *         if self.is_castling(move):             # <<<<<<<<<<<<<<
 *             if square_file(move.to_square) < square_file(move.from_square):
 *                 san = "O-O-O"
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_castling); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2556, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2556, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2556, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2557
 *         # Castling.
 *         if self.is_castling(move):
 *             if square_file(move.to_square) < square_file(move.from_square):             # <<<<<<<<<<<<<<
 *                 san = "O-O-O"
 *             else:
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_square_file); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2557, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2558
 *         if self.is_castling(move):
 *             if square_file(move.to_square) < square_file(move.from_square):
 *                 san = "O-O-O"             # <<<<<<<<<<<<<<
 *             else:
 *                 san = "O-O"
 */
      __Pyx_INCREF(__pyx_kp_u_O_O_O);
      __Pyx_XDECREF_SET(__pyx_v_san, __pyx_kp_u_O_O_O);

      /* "chess/__init__cp.pyx":2557
 *         # Castling.
 *         if self.is_castling(move):
 *             if square_file(move.to_square) < square_file(move.from_square):             # <<<<<<<<<<<<<<
 *                 san = "O-O-O"
 *             else:
 */
      goto __pyx_L11;
    }

    /* "chess/__init__cp.pyx":2560
 *                 san = "O-O-O"
 *             else:
 *                 san = "O-O"             # <<<<<<<<<<<<<<
 * 
 *         if move.drop or self.is_castling(move):
 */
    /*else*/ {
      __Pyx_INCREF(__pyx_kp_u_O_O);
      __Pyx_XDECREF_SET(__pyx_v_san, __pyx_kp_u_O_O);
    }
    __pyx_L11:;

    /* "chess/__init__cp.pyx":2556
 * 
 *         # Castling.
 *         if self.is_castling(move):             # <<<<<<<<<<<<<<
 *             if square_file(move.to_square) < square_file(move.from_square):
 *                 san = "O-O-O"
 */
  }

  /* "chess/__init__cp.pyx":2562
 *                 san = "O-O"
 * 
 *         if move.drop or self.is_castling(move):             # <<<<<<<<<<<<<<
 *             if is_checkmate:
 *                 return san + "#"
 */
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2562, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (!__pyx_t_1) {
  } else {
    __pyx_t_2 = __pyx_t_1;
    goto __pyx_L13_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_castling); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2562, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = __pyx_t_1;
  __pyx_L13_bool_binop_done:;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2563
 * 
 *         if move.drop or self.is_castling(move):
 *             if is_checkmate:             # <<<<<<<<<<<<<<
 *                 return san + "#"
 *             elif is_check:
 */
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_is_checkmate); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2563, __pyx_L1_error)
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2564
 *         if move.drop or self.is_castling(move):
 *             if is_checkmate:
 *                 return san + "#"             # <<<<<<<<<<<<<<
 *             elif is_check:
 *                 return san + "+"
 */
      __Pyx_XDECREF(__pyx_r);
      if (unlikely(!__pyx_v_san)) { __Pyx_RaiseUnboundLocalError("san"); __PYX_ERR(0, 2564, __pyx_L1_error) }
      __pyx_t_5 = PyNumber_Add(__pyx_v_san, __pyx_kp_u__45); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2564, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2563
 * 
 *         if move.drop or self.is_castling(move):
 *             if is_checkmate:             # <<<<<<<<<<<<<<
 *                 return san + "#"
 *             elif is_check:
 */
    }

    /* "chess/__init__cp.pyx":2565
 *             if is_checkmate:
 *                 return san + "#"
 *             elif is_check:             # <<<<<<<<<<<<<<
 *                 return san + "+"
 *             else:
 */
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_is_check); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2565, __pyx_L1_error)
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2566
 *                 return san + "#"
 *             elif is_check:
 *                 return san + "+"             # <<<<<<<<<<<<<<
 *             else:
 *                 return san
 */
      __Pyx_XDECREF(__pyx_r);
      if (unlikely(!__pyx_v_san)) { __Pyx_RaiseUnboundLocalError("san"); __PYX_ERR(0, 2566, __pyx_L1_error) }
      __pyx_t_5 = PyNumber_Add(__pyx_v_san, __pyx_kp_u__46); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2566, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2565
 *             if is_checkmate:
 *                 return san + "#"
 *             elif is_check:             # <<<<<<<<<<<<<<
 *                 return san + "+"
 *             else:
 */
    }

    /* "chess/__init__cp.pyx":2568
 *                 return san + "+"
 *             else:
 *                 return san             # <<<<<<<<<<<<<<
 * 
 *         piece = self.piece_type_at(move.from_square)
 */
    /*else*/ {
      __Pyx_XDECREF(__pyx_r);
      if (unlikely(!__pyx_v_san)) { __Pyx_RaiseUnboundLocalError("san"); __PYX_ERR(0, 2568, __pyx_L1_error) }
      __Pyx_INCREF(__pyx_v_san);
      __pyx_r = __pyx_v_san;
      goto __pyx_L0;
    }

    /* "chess/__init__cp.pyx":2562
 *                 san = "O-O"
 * 
 *         if move.drop or self.is_castling(move):             # <<<<<<<<<<<<<<
 *             if is_checkmate:
 *                 return san + "#"
 */
  }

  /* "chess/__init__cp.pyx":2570
 *                 return san
 * 
 *         piece = self.piece_type_at(move.from_square)             # <<<<<<<<<<<<<<
 *         capture = self.is_capture(move)
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_piece_type_at); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2570, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2570, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2570, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_piece = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":2571
 * 
 *         piece = self.piece_type_at(move.from_square)
 *         capture = self.is_capture(move)             # <<<<<<<<<<<<<<
 * 
 *         if piece == PAWN:
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_capture); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2571, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2571, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_capture = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":2573
 *         capture = self.is_capture(move)
 * 
 *         if piece == PAWN:             # <<<<<<<<<<<<<<
 *             san = ""
 *         else:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2573, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = PyObject_RichCompare(__pyx_v_piece, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2573, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2573, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2574
 * 
 *         if piece == PAWN:
 *             san = ""             # <<<<<<<<<<<<<<
 *         else:
 *             san = PIECE_SYMBOLS[piece].upper()
 */
    __Pyx_INCREF(__pyx_kp_u__13);
    __Pyx_XDECREF_SET(__pyx_v_san, __pyx_kp_u__13);

    /* "chess/__init__cp.pyx":2573
 *         capture = self.is_capture(move)
 * 
 *         if piece == PAWN:             # <<<<<<<<<<<<<<
 *             san = ""
 *         else:
 */
    goto __pyx_L16;
  }

  /* "chess/__init__cp.pyx":2576
 *             san = ""
 *         else:
 *             san = PIECE_SYMBOLS[piece].upper()             # <<<<<<<<<<<<<<
 * 
 *         if long_notation:
 */
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_piece); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_upper); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_san, __pyx_t_3);
    __pyx_t_3 = 0;
  }
  __pyx_L16:;

  /* "chess/__init__cp.pyx":2578
 *             san = PIECE_SYMBOLS[piece].upper()
 * 
 *         if long_notation:             # <<<<<<<<<<<<<<
 *             san += SQUARE_NAMES[move.from_square]
 *         elif piece != PAWN:
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_long_notation); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2578, __pyx_L1_error)
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2579
 * 
 *         if long_notation:
 *             san += SQUARE_NAMES[move.from_square]             # <<<<<<<<<<<<<<
 *         elif piece != PAWN:
 *             # Get ambiguous move candidates.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2578
 *             san = PIECE_SYMBOLS[piece].upper()
 * 
 *         if long_notation:             # <<<<<<<<<<<<<<
 *             san += SQUARE_NAMES[move.from_square]
 *         elif piece != PAWN:
 */
    goto __pyx_L17;
  }

  /* "chess/__init__cp.pyx":2580
 *         if long_notation:
 *             san += SQUARE_NAMES[move.from_square]
 *         elif piece != PAWN:             # <<<<<<<<<<<<<<
 *             # Get ambiguous move candidates.
 *             # Relevant candidates: not exactly the current move,
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_PAWN); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2580, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyObject_RichCompare(__pyx_v_piece, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2580, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2580, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2584
 *             # Relevant candidates: not exactly the current move,
 *             # but to the same square.
 *             others = 0             # <<<<<<<<<<<<<<
 *             from_mask = self.pieces_mask(piece, self.turn)
 *             from_mask &= ~BB_SQUARES[move.from_square]
 */
    __Pyx_INCREF(__pyx_int_0);
    __pyx_v_others = __pyx_int_0;

    /* "chess/__init__cp.pyx":2585
 *             # but to the same square.
 *             others = 0
 *             from_mask = self.pieces_mask(piece, self.turn)             # <<<<<<<<<<<<<<
 *             from_mask &= ~BB_SQUARES[move.from_square]
 *             to_mask = BB_SQUARES[move.to_square]
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_pieces_mask); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2585, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2585, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_piece, __pyx_t_3};
      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2585, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_piece, __pyx_t_3};
      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2585, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2585, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_INCREF(__pyx_v_piece);
      __Pyx_GIVEREF(__pyx_v_piece);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_v_piece);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2585, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_from_mask = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2586
 *             others = 0
 *             from_mask = self.pieces_mask(piece, self.turn)
 *             from_mask &= ~BB_SQUARES[move.from_square]             # <<<<<<<<<<<<<<
 *             to_mask = BB_SQUARES[move.to_square]
 *             for candidate in self.generate_legal_moves(from_mask, to_mask):
 */
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2586, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2586, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2586, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Invert(__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2586, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyNumber_InPlaceAnd(__pyx_v_from_mask, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2586, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_from_mask, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2587
 *             from_mask = self.pieces_mask(piece, self.turn)
 *             from_mask &= ~BB_SQUARES[move.from_square]
 *             to_mask = BB_SQUARES[move.to_square]             # <<<<<<<<<<<<<<
 *             for candidate in self.generate_legal_moves(from_mask, to_mask):
 *                 others |= BB_SQUARES[candidate.from_square]
 */
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2587, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2587, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2587, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_to_mask = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2588
 *             from_mask &= ~BB_SQUARES[move.from_square]
 *             to_mask = BB_SQUARES[move.to_square]
 *             for candidate in self.generate_legal_moves(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *                 others |= BB_SQUARES[candidate.from_square]
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2588, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_v_from_mask, __pyx_v_to_mask};
      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2588, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_6);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_v_from_mask, __pyx_v_to_mask};
      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2588, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_6);
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2588, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(__pyx_v_from_mask);
      __Pyx_GIVEREF(__pyx_v_from_mask);
      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_8, __pyx_v_from_mask);
      __Pyx_INCREF(__pyx_v_to_mask);
      __Pyx_GIVEREF(__pyx_v_to_mask);
      PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_8, __pyx_v_to_mask);
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2588, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
      __pyx_t_5 = __pyx_t_6; __Pyx_INCREF(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2588, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2588, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 2588, __pyx_L1_error)
          #else
          __pyx_t_6 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2588, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 2588, __pyx_L1_error)
          #else
          __pyx_t_6 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2588, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        }
      } else {
        __pyx_t_6 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_6)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 2588, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_6);
      }
      __Pyx_XDECREF_SET(__pyx_v_candidate, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":2589
 *             to_mask = BB_SQUARES[move.to_square]
 *             for candidate in self.generate_legal_moves(from_mask, to_mask):
 *                 others |= BB_SQUARES[candidate.from_square]             # <<<<<<<<<<<<<<
 * 
 *             # Disambiguate.
 */
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2589, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_candidate, __pyx_n_s_from_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2589, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2589, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_others, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2589, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF_SET(__pyx_v_others, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "chess/__init__cp.pyx":2588
 *             from_mask &= ~BB_SQUARES[move.from_square]
 *             to_mask = BB_SQUARES[move.to_square]
 *             for candidate in self.generate_legal_moves(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *                 others |= BB_SQUARES[candidate.from_square]
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2592
 * 
 *             # Disambiguate.
 *             if others:             # <<<<<<<<<<<<<<
 *                 row, column = False, False
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_others); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 2592, __pyx_L1_error)
    if (__pyx_t_2) {

      /* "chess/__init__cp.pyx":2593
 *             # Disambiguate.
 *             if others:
 *                 row, column = False, False             # <<<<<<<<<<<<<<
 * 
 *                 if others & BB_RANKS[square_rank(move.from_square)]:
 */
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_v_row = __pyx_t_2;
      __pyx_v_column = __pyx_t_1;

      /* "chess/__init__cp.pyx":2595
 *                 row, column = False, False
 * 
 *                 if others & BB_RANKS[square_rank(move.from_square)]:             # <<<<<<<<<<<<<<
 *                     column = True
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_RANKS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_And(__pyx_v_others, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2595, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":2596
 * 
 *                 if others & BB_RANKS[square_rank(move.from_square)]:
 *                     column = True             # <<<<<<<<<<<<<<
 * 
 *                 if others & BB_FILES[square_file(move.from_square)]:
 */
        __pyx_v_column = 1;

        /* "chess/__init__cp.pyx":2595
 *                 row, column = False, False
 * 
 *                 if others & BB_RANKS[square_rank(move.from_square)]:             # <<<<<<<<<<<<<<
 *                     column = True
 * 
 */
      }

      /* "chess/__init__cp.pyx":2598
 *                     column = True
 * 
 *                 if others & BB_FILES[square_file(move.from_square)]:             # <<<<<<<<<<<<<<
 *                     row = True
 *                 else:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_square_file); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_7 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_And(__pyx_v_others, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":2599
 * 
 *                 if others & BB_FILES[square_file(move.from_square)]:
 *                     row = True             # <<<<<<<<<<<<<<
 *                 else:
 *                     column = True
 */
        __pyx_v_row = 1;

        /* "chess/__init__cp.pyx":2598
 *                     column = True
 * 
 *                 if others & BB_FILES[square_file(move.from_square)]:             # <<<<<<<<<<<<<<
 *                     row = True
 *                 else:
 */
        goto __pyx_L22;
      }

      /* "chess/__init__cp.pyx":2601
 *                     row = True
 *                 else:
 *                     column = True             # <<<<<<<<<<<<<<
 * 
 *                 if column:
 */
      /*else*/ {
        __pyx_v_column = 1;
      }
      __pyx_L22:;

      /* "chess/__init__cp.pyx":2603
 *                     column = True
 * 
 *                 if column:             # <<<<<<<<<<<<<<
 *                     san += FILE_NAMES[square_file(move.from_square)]
 *                 if row:
 */
      __pyx_t_1 = (__pyx_v_column != 0);
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":2604
 * 
 *                 if column:
 *                     san += FILE_NAMES[square_file(move.from_square)]             # <<<<<<<<<<<<<<
 *                 if row:
 *                     san += RANK_NAMES[square_rank(move.from_square)]
 */
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_4 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
        __pyx_t_5 = 0;

        /* "chess/__init__cp.pyx":2603
 *                     column = True
 * 
 *                 if column:             # <<<<<<<<<<<<<<
 *                     san += FILE_NAMES[square_file(move.from_square)]
 *                 if row:
 */
      }

      /* "chess/__init__cp.pyx":2605
 *                 if column:
 *                     san += FILE_NAMES[square_file(move.from_square)]
 *                 if row:             # <<<<<<<<<<<<<<
 *                     san += RANK_NAMES[square_rank(move.from_square)]
 *         elif capture:
 */
      __pyx_t_1 = (__pyx_v_row != 0);
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":2606
 *                     san += FILE_NAMES[square_file(move.from_square)]
 *                 if row:
 *                     san += RANK_NAMES[square_rank(move.from_square)]             # <<<<<<<<<<<<<<
 *         elif capture:
 *             san += FILE_NAMES[square_file(move.from_square)]
 */
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_RANK_NAMES); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_4 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "chess/__init__cp.pyx":2605
 *                 if column:
 *                     san += FILE_NAMES[square_file(move.from_square)]
 *                 if row:             # <<<<<<<<<<<<<<
 *                     san += RANK_NAMES[square_rank(move.from_square)]
 *         elif capture:
 */
      }

      /* "chess/__init__cp.pyx":2592
 * 
 *             # Disambiguate.
 *             if others:             # <<<<<<<<<<<<<<
 *                 row, column = False, False
 * 
 */
    }

    /* "chess/__init__cp.pyx":2580
 *         if long_notation:
 *             san += SQUARE_NAMES[move.from_square]
 *         elif piece != PAWN:             # <<<<<<<<<<<<<<
 *             # Get ambiguous move candidates.
 *             # Relevant candidates: not exactly the current move,
 */
    goto __pyx_L17;
  }

  /* "chess/__init__cp.pyx":2607
 *                 if row:
 *                     san += RANK_NAMES[square_rank(move.from_square)]
 *         elif capture:             # <<<<<<<<<<<<<<
 *             san += FILE_NAMES[square_file(move.from_square)]
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_capture); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2607, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2608
 *                     san += RANK_NAMES[square_rank(move.from_square)]
 *         elif capture:
 *             san += FILE_NAMES[square_file(move.from_square)]             # <<<<<<<<<<<<<<
 * 
 *         # Captures.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_square_file); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_7 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2607
 *                 if row:
 *                     san += RANK_NAMES[square_rank(move.from_square)]
 *         elif capture:             # <<<<<<<<<<<<<<
 *             san += FILE_NAMES[square_file(move.from_square)]
 * 
 */
  }
  __pyx_L17:;

  /* "chess/__init__cp.pyx":2611
 * 
 *         # Captures.
 *         if capture:             # <<<<<<<<<<<<<<
 *             san += "x"
 *         elif long_notation:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_capture); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2611, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2612
 *         # Captures.
 *         if capture:
 *             san += "x"             # <<<<<<<<<<<<<<
 *         elif long_notation:
 *             san += "-"
 */
    __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_n_u_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2612, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2611
 * 
 *         # Captures.
 *         if capture:             # <<<<<<<<<<<<<<
 *             san += "x"
 *         elif long_notation:
 */
    goto __pyx_L25;
  }

  /* "chess/__init__cp.pyx":2613
 *         if capture:
 *             san += "x"
 *         elif long_notation:             # <<<<<<<<<<<<<<
 *             san += "-"
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_long_notation); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2613, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2614
 *             san += "x"
 *         elif long_notation:
 *             san += "-"             # <<<<<<<<<<<<<<
 * 
 *         # Destination square.
 */
    __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_kp_u__34); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2614, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2613
 *         if capture:
 *             san += "x"
 *         elif long_notation:             # <<<<<<<<<<<<<<
 *             san += "-"
 * 
 */
  }
  __pyx_L25:;

  /* "chess/__init__cp.pyx":2617
 * 
 *         # Destination square.
 *         san += SQUARE_NAMES[move.to_square]             # <<<<<<<<<<<<<<
 * 
 *         # Promotion.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":2620
 * 
 *         # Promotion.
 *         if move.promotion:             # <<<<<<<<<<<<<<
 *             san += "=" + PIECE_SYMBOLS[move.promotion].upper()
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2620, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2620, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2621
 *         # Promotion.
 *         if move.promotion:
 *             san += "=" + PIECE_SYMBOLS[move.promotion].upper()             # <<<<<<<<<<<<<<
 * 
 *         # Add check or checkmate suffix.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_upper); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyNumber_Add(__pyx_kp_u__47, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2620
 * 
 *         # Promotion.
 *         if move.promotion:             # <<<<<<<<<<<<<<
 *             san += "=" + PIECE_SYMBOLS[move.promotion].upper()
 * 
 */
  }

  /* "chess/__init__cp.pyx":2624
 * 
 *         # Add check or checkmate suffix.
 *         if is_checkmate:             # <<<<<<<<<<<<<<
 *             san += "#"
 *         elif is_check:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_is_checkmate); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2624, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2625
 *         # Add check or checkmate suffix.
 *         if is_checkmate:
 *             san += "#"             # <<<<<<<<<<<<<<
 *         elif is_check:
 *             san += "+"
 */
    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_kp_u__45); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2625, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2624
 * 
 *         # Add check or checkmate suffix.
 *         if is_checkmate:             # <<<<<<<<<<<<<<
 *             san += "#"
 *         elif is_check:
 */
    goto __pyx_L27;
  }

  /* "chess/__init__cp.pyx":2626
 *         if is_checkmate:
 *             san += "#"
 *         elif is_check:             # <<<<<<<<<<<<<<
 *             san += "+"
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_is_check); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2626, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2627
 *             san += "#"
 *         elif is_check:
 *             san += "+"             # <<<<<<<<<<<<<<
 * 
 *         return san
 */
    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_san, __pyx_kp_u__46); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2627, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF_SET(__pyx_v_san, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2626
 *         if is_checkmate:
 *             san += "#"
 *         elif is_check:             # <<<<<<<<<<<<<<
 *             san += "+"
 * 
 */
  }
  __pyx_L27:;

  /* "chess/__init__cp.pyx":2629
 *             san += "+"
 * 
 *         return san             # <<<<<<<<<<<<<<
 * 
 *     def variation_san(self, variation):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_san);
  __pyx_r = __pyx_v_san;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2537
 *         return self._algebraic(move, long_notation=True)
 * 
 *     def _algebraic(self, move, long_notation=False):             # <<<<<<<<<<<<<<
 *         if not move:
 *             # Null move.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board._algebraic", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_is_check);
  __Pyx_XDECREF(__pyx_v_is_checkmate);
  __Pyx_XDECREF(__pyx_v_san);
  __Pyx_XDECREF(__pyx_v_piece);
  __Pyx_XDECREF(__pyx_v_capture);
  __Pyx_XDECREF(__pyx_v_others);
  __Pyx_XDECREF(__pyx_v_from_mask);
  __Pyx_XDECREF(__pyx_v_to_mask);
  __Pyx_XDECREF(__pyx_v_candidate);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2631
 *         return san
 * 
 *     def variation_san(self, variation):             # <<<<<<<<<<<<<<
 *         """
 *         Given a sequence of moves, returns a string representing the sequence
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_113variation_san(PyObject *__pyx_v_self, PyObject *__pyx_v_variation); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_112variation_san[] = "\n        Given a sequence of moves, returns a string representing the sequence\n        in standard algebraic notation (e.g., ``1. e4 e5 2. Nf3 Nc6`` or\n        ``37...Bg6 38. fxg6``).\n\n        The board will not be modified as a result of calling this.\n\n        :raises: :exc:`ValueError` if any moves in the sequence are illegal.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_113variation_san(PyObject *__pyx_v_self, PyObject *__pyx_v_variation) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("variation_san (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_112variation_san(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_variation));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_112variation_san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_variation) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_v_san = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  __Pyx_RefNannySetupContext("variation_san", 0);

  /* "chess/__init__cp.pyx":2641
 *         :raises: :exc:`ValueError` if any moves in the sequence are illegal.
 *         """
 *         board = self.copy(stack=False)             # <<<<<<<<<<<<<<
 *         san = []
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2641, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2641, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_stack, Py_False) < 0) __PYX_ERR(0, 2641, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2641, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2642
 *         """
 *         board = self.copy(stack=False)
 *         san = []             # <<<<<<<<<<<<<<
 * 
 *         for move in variation:
 */
  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2642, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_san = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2644
 *         san = []
 * 
 *         for move in variation:             # <<<<<<<<<<<<<<
 *             if not board.is_legal(move):
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))
 */
  if (likely(PyList_CheckExact(__pyx_v_variation)) || PyTuple_CheckExact(__pyx_v_variation)) {
    __pyx_t_3 = __pyx_v_variation; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_variation); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2644, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2644, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2644, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2644, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2644, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2644, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2644, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2645
 * 
 *         for move in variation:
 *             if not board.is_legal(move):             # <<<<<<<<<<<<<<
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_is_legal); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2645, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_move);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2645, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2645, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = ((!__pyx_t_7) != 0);
    if (unlikely(__pyx_t_8)) {

      /* "chess/__init__cp.pyx":2646
 *         for move in variation:
 *             if not board.is_legal(move):
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))             # <<<<<<<<<<<<<<
 * 
 *             if board.turn == WHITE:
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_illegal_move_in_position, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_fen); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
        }
      }
      __pyx_t_6 = (__pyx_t_10) ? __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10) : __Pyx_PyObject_CallNoArg(__pyx_t_9);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_11 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_move, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2646, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_move, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2646, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_10 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2646, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        if (__pyx_t_9) {
          __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9); __pyx_t_9 = NULL;
        }
        __Pyx_INCREF(__pyx_v_move);
        __Pyx_GIVEREF(__pyx_v_move);
        PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_11, __pyx_v_move);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_11, __pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2646, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __PYX_ERR(0, 2646, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2645
 * 
 *         for move in variation:
 *             if not board.is_legal(move):             # <<<<<<<<<<<<<<
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))
 * 
 */
    }

    /* "chess/__init__cp.pyx":2648
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))
 * 
 *             if board.turn == WHITE:             # <<<<<<<<<<<<<<
 *                 san.append("{}. {}".format(board.fullmove_number, board.san(move)))
 *             elif not san:
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_turn); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2648, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2648, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 2648, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_8) {

      /* "chess/__init__cp.pyx":2649
 * 
 *             if board.turn == WHITE:
 *                 san.append("{}. {}".format(board.fullmove_number, board.san(move)))             # <<<<<<<<<<<<<<
 *             elif not san:
 *                 san.append("{}...{}".format(board.fullmove_number, board.san(move)))
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__48, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_fullmove_number); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_san); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_12 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_12)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_12);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
        }
      }
      __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_12, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_move);
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_11 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_10, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2649, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_10, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2649, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2649, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        if (__pyx_t_9) {
          __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_9); __pyx_t_9 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_t_6);
        __pyx_t_10 = 0;
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_12, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2649, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_san, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 2649, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":2648
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))
 * 
 *             if board.turn == WHITE:             # <<<<<<<<<<<<<<
 *                 san.append("{}. {}".format(board.fullmove_number, board.san(move)))
 *             elif not san:
 */
      goto __pyx_L6;
    }

    /* "chess/__init__cp.pyx":2650
 *             if board.turn == WHITE:
 *                 san.append("{}. {}".format(board.fullmove_number, board.san(move)))
 *             elif not san:             # <<<<<<<<<<<<<<
 *                 san.append("{}...{}".format(board.fullmove_number, board.san(move)))
 *             else:
 */
    __pyx_t_8 = (PyList_GET_SIZE(__pyx_v_san) != 0);
    __pyx_t_7 = ((!__pyx_t_8) != 0);
    if (__pyx_t_7) {

      /* "chess/__init__cp.pyx":2651
 *                 san.append("{}. {}".format(board.fullmove_number, board.san(move)))
 *             elif not san:
 *                 san.append("{}...{}".format(board.fullmove_number, board.san(move)))             # <<<<<<<<<<<<<<
 *             else:
 *                 san.append(board.san(move))
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__49, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2651, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_fullmove_number); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2651, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_san); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2651, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_9 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      __pyx_t_6 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_9, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_v_move);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2651, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_11 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_12, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2651, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_12, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2651, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_9 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2651, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        if (__pyx_t_10) {
          __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_10); __pyx_t_10 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_11, __pyx_t_12);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_11, __pyx_t_6);
        __pyx_t_12 = 0;
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2651, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_san, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 2651, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":2650
 *             if board.turn == WHITE:
 *                 san.append("{}. {}".format(board.fullmove_number, board.san(move)))
 *             elif not san:             # <<<<<<<<<<<<<<
 *                 san.append("{}...{}".format(board.fullmove_number, board.san(move)))
 *             else:
 */
      goto __pyx_L6;
    }

    /* "chess/__init__cp.pyx":2653
 *                 san.append("{}...{}".format(board.fullmove_number, board.san(move)))
 *             else:
 *                 san.append(board.san(move))             # <<<<<<<<<<<<<<
 * 
 *             board.push(move)
 */
    /*else*/ {
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_san); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2653, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_move);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2653, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_san, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 2653, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_L6:;

    /* "chess/__init__cp.pyx":2655
 *                 san.append(board.san(move))
 * 
 *             board.push(move)             # <<<<<<<<<<<<<<
 * 
 *         return " ".join(san)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_push); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_move);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2644
 *         san = []
 * 
 *         for move in variation:             # <<<<<<<<<<<<<<
 *             if not board.is_legal(move):
 *                 raise ValueError("illegal move {} in position {}".format(move, board.fen()))
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2657
 *             board.push(move)
 * 
 *         return " ".join(san)             # <<<<<<<<<<<<<<
 * 
 *     def parse_san(self, san):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyUnicode_Join(__pyx_kp_u__14, __pyx_v_san); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2631
 *         return san
 * 
 *     def variation_san(self, variation):             # <<<<<<<<<<<<<<
 *         """
 *         Given a sequence of moves, returns a string representing the sequence
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("chess.__init__cp.Board.variation_san", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XDECREF(__pyx_v_san);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2659
 *         return " ".join(san)
 * 
 *     def parse_san(self, san):             # <<<<<<<<<<<<<<
 *         """
 *         Uses the current position as the context to parse a move in standard
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_115parse_san(PyObject *__pyx_v_self, PyObject *__pyx_v_san); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_114parse_san[] = "\n        Uses the current position as the context to parse a move in standard\n        algebraic notation and returns the corresponding move object.\n\n        The returned move is guaranteed to be either legal or a null move.\n\n        :raises: :exc:`ValueError` if the SAN is invalid or ambiguous.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_115parse_san(PyObject *__pyx_v_self, PyObject *__pyx_v_san) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("parse_san (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_114parse_san(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_san));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_9parse_san_2generator10(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":2671
 *         try:
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))             # <<<<<<<<<<<<<<
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_9parse_san_genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_9_genexpr(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_9_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 2671, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *) __pyx_self;
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_9parse_san_2generator10, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_parse_san_locals_genexpr, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 2671, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.parse_san.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_9parse_san_2generator10(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L7_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 2671, __pyx_L1_error)
  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 2671, __pyx_L1_error) }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_generate_castling_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2671, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2671, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2671, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2671, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2671, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2671, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2671, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2671, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_move, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 2671, __pyx_L1_error) }
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_is_kingside_castling); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_cur_scope->__pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2671, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_7) {
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
      __pyx_r = __pyx_cur_scope->__pyx_v_move;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L7_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 2671, __pyx_L1_error)
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_9parse_san_5generator11(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":2673
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))             # <<<<<<<<<<<<<<
 *         except StopIteration:
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_9parse_san_3genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_10_genexpr(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_10_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 2673, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *) __pyx_self;
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_9parse_san_5generator11, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_parse_san_locals_genexpr, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 2673, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.parse_san.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_9parse_san_5generator11(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L7_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 2673, __pyx_L1_error)
  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 2673, __pyx_L1_error) }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_generate_castling_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2673, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2673, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2673, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2673, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2673, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 2673, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2673, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2673, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_move, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 2673, __pyx_L1_error) }
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_is_queenside_castling); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_cur_scope->__pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2673, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_7) {
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
      __pyx_r = __pyx_cur_scope->__pyx_v_move;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L7_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 2673, __pyx_L1_error)
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2659
 *         return " ".join(san)
 * 
 *     def parse_san(self, san):             # <<<<<<<<<<<<<<
 *         """
 *         Uses the current position as the context to parse a move in standard
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_114parse_san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_san) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *__pyx_cur_scope;
  PyObject *__pyx_v_match = NULL;
  PyObject *__pyx_v_to_square = NULL;
  PyObject *__pyx_v_to_mask = NULL;
  PyObject *__pyx_v_p = NULL;
  PyObject *__pyx_v_promotion = NULL;
  PyObject *__pyx_v_piece_type = NULL;
  PyObject *__pyx_v_from_mask = NULL;
  PyObject *__pyx_v_matched_move = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  Py_ssize_t __pyx_t_16;
  PyObject *(*__pyx_t_17)(PyObject *);
  __Pyx_RefNannySetupContext("parse_san", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_8_parse_san(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_8_parse_san, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 2659, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);

  /* "chess/__init__cp.pyx":2669
 *         """
 *         # Castling.
 *         try:             # <<<<<<<<<<<<<<
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":2670
 *         # Castling.
 *         try:
 *             if san in ["O-O", "O-O+", "O-O#"]:             # <<<<<<<<<<<<<<
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 */
      __Pyx_INCREF(__pyx_v_san);
      __pyx_t_4 = __pyx_v_san;
      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u_O_O, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2670, __pyx_L3_error)
      if (!__pyx_t_6) {
      } else {
        __pyx_t_5 = __pyx_t_6;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u_O_O_2, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2670, __pyx_L3_error)
      if (!__pyx_t_6) {
      } else {
        __pyx_t_5 = __pyx_t_6;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u_O_O_3, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2670, __pyx_L3_error)
      __pyx_t_5 = __pyx_t_6;
      __pyx_L10_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_6 = (__pyx_t_5 != 0);
      if (__pyx_t_6) {

        /* "chess/__init__cp.pyx":2671
 *         try:
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))             # <<<<<<<<<<<<<<
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_4 = __pyx_pf_5chess_10__init__cp_5Board_9parse_san_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2671, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_7 = __Pyx_PyIter_Next(__pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2671, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_7;
        __pyx_t_7 = 0;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":2670
 *         # Castling.
 *         try:
 *             if san in ["O-O", "O-O+", "O-O#"]:             # <<<<<<<<<<<<<<
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 */
      }

      /* "chess/__init__cp.pyx":2672
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:             # <<<<<<<<<<<<<<
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 *         except StopIteration:
 */
      __Pyx_INCREF(__pyx_v_san);
      __pyx_t_7 = __pyx_v_san;
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_7, __pyx_kp_u_O_O_O, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2672, __pyx_L3_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_6 = __pyx_t_5;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_7, __pyx_kp_u_O_O_O_2, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2672, __pyx_L3_error)
      if (!__pyx_t_5) {
      } else {
        __pyx_t_6 = __pyx_t_5;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_7, __pyx_kp_u_O_O_O_3, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2672, __pyx_L3_error)
      __pyx_t_6 = __pyx_t_5;
      __pyx_L13_bool_binop_done:;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_5 = (__pyx_t_6 != 0);
      if (__pyx_t_5) {

        /* "chess/__init__cp.pyx":2673
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))             # <<<<<<<<<<<<<<
 *         except StopIteration:
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_7 = __pyx_pf_5chess_10__init__cp_5Board_9parse_san_3genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2673, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = __Pyx_PyIter_Next(__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2673, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":2672
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:             # <<<<<<<<<<<<<<
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 *         except StopIteration:
 */
      }

      /* "chess/__init__cp.pyx":2669
 *         """
 *         # Castling.
 *         try:             # <<<<<<<<<<<<<<
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 */
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2674
 *             elif san in ["O-O-O", "O-O-O+", "O-O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 *         except StopIteration:             # <<<<<<<<<<<<<<
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 * 
 */
    __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_StopIteration);
    if (__pyx_t_8) {
      __Pyx_AddTraceback("chess.__init__cp.Board.parse_san", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_7, &__pyx_t_9) < 0) __PYX_ERR(0, 2674, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_GOTREF(__pyx_t_9);

      /* "chess/__init__cp.pyx":2675
 *                 return next(move for move in self.generate_castling_moves() if self.is_queenside_castling(move))
 *         except StopIteration:
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))             # <<<<<<<<<<<<<<
 * 
 *         # Match normal moves.
 */
      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_illegal_san_in, __pyx_n_s_format); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_12 = PyObject_Repr(__pyx_v_san); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_14 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_fen); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_14);
      __pyx_t_15 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
        __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_14);
        if (likely(__pyx_t_15)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
          __Pyx_INCREF(__pyx_t_15);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_14, function);
        }
      }
      __pyx_t_13 = (__pyx_t_15) ? __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_15) : __Pyx_PyObject_CallNoArg(__pyx_t_14);
      __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
      if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_13);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      __pyx_t_14 = NULL;
      __pyx_t_8 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
        __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_11);
        if (likely(__pyx_t_14)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
          __Pyx_INCREF(__pyx_t_14);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_11, function);
          __pyx_t_8 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_11)) {
        PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_12, __pyx_t_13};
        __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
        PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_12, __pyx_t_13};
        __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      } else
      #endif
      {
        __pyx_t_15 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
        __Pyx_GOTREF(__pyx_t_15);
        if (__pyx_t_14) {
          __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_14); __pyx_t_14 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_15, 0+__pyx_t_8, __pyx_t_12);
        __Pyx_GIVEREF(__pyx_t_13);
        PyTuple_SET_ITEM(__pyx_t_15, 1+__pyx_t_8, __pyx_t_13);
        __pyx_t_12 = 0;
        __pyx_t_13 = 0;
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_15, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      }
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2675, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_Raise(__pyx_t_11, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __PYX_ERR(0, 2675, __pyx_L5_except_error)
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":2669
 *         """
 *         # Castling.
 *         try:             # <<<<<<<<<<<<<<
 *             if san in ["O-O", "O-O+", "O-O#"]:
 *                 return next(move for move in self.generate_castling_moves() if self.is_kingside_castling(move))
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L8_try_end:;
  }

  /* "chess/__init__cp.pyx":2678
 * 
 *         # Match normal moves.
 *         match = SAN_REGEX.match(san)             # <<<<<<<<<<<<<<
 *         if not match:
 *             # Null moves.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_SAN_REGEX); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_9 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_v_san) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_san);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_match = __pyx_t_9;
  __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":2679
 *         # Match normal moves.
 *         match = SAN_REGEX.match(san)
 *         if not match:             # <<<<<<<<<<<<<<
 *             # Null moves.
 *             if san in ["--", "Z0"]:
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_match); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2679, __pyx_L1_error)
  __pyx_t_6 = ((!__pyx_t_5) != 0);
  if (__pyx_t_6) {

    /* "chess/__init__cp.pyx":2681
 *         if not match:
 *             # Null moves.
 *             if san in ["--", "Z0"]:             # <<<<<<<<<<<<<<
 *                 return Move.null()
 * 
 */
    __Pyx_INCREF(__pyx_v_san);
    __pyx_t_9 = __pyx_v_san;
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_9, __pyx_kp_u__44, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2681, __pyx_L1_error)
    if (!__pyx_t_5) {
    } else {
      __pyx_t_6 = __pyx_t_5;
      goto __pyx_L20_bool_binop_done;
    }
    __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_9, __pyx_n_u_Z0, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2681, __pyx_L1_error)
    __pyx_t_6 = __pyx_t_5;
    __pyx_L20_bool_binop_done:;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_5 = (__pyx_t_6 != 0);
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":2682
 *             # Null moves.
 *             if san in ["--", "Z0"]:
 *                 return Move.null()             # <<<<<<<<<<<<<<
 * 
 *             raise ValueError("invalid san: {}".format(repr(san)))
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_n_s_null); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2682, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_9 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2682, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_9;
      __pyx_t_9 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2681
 *         if not match:
 *             # Null moves.
 *             if san in ["--", "Z0"]:             # <<<<<<<<<<<<<<
 *                 return Move.null()
 * 
 */
    }

    /* "chess/__init__cp.pyx":2684
 *                 return Move.null()
 * 
 *             raise ValueError("invalid san: {}".format(repr(san)))             # <<<<<<<<<<<<<<
 * 
 *         # Get target square.
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_invalid_san, __pyx_n_s_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2684, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = PyObject_Repr(__pyx_v_san); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2684, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_11 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_9 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_11, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2684, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2684, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __PYX_ERR(0, 2684, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2679
 *         # Match normal moves.
 *         match = SAN_REGEX.match(san)
 *         if not match:             # <<<<<<<<<<<<<<
 *             # Null moves.
 *             if san in ["--", "Z0"]:
 */
  }

  /* "chess/__init__cp.pyx":2687
 * 
 *         # Get target square.
 *         to_square = SQUARE_NAMES.index(match.group(4))             # <<<<<<<<<<<<<<
 *         to_mask = BB_SQUARES[to_square]
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_SQUARE_NAMES); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_index); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_10, __pyx_int_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_int_4);
  __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_11)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_11);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  __pyx_t_4 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_11, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_to_square = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":2688
 *         # Get target square.
 *         to_square = SQUARE_NAMES.index(match.group(4))
 *         to_mask = BB_SQUARES[to_square]             # <<<<<<<<<<<<<<
 * 
 *         # Get the promotion type.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_to_square); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_to_mask = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":2691
 * 
 *         # Get the promotion type.
 *         p = match.group(5)             # <<<<<<<<<<<<<<
 *         promotion = p and PIECE_SYMBOLS.index(p[-1].lower())
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2691, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_7 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_9, __pyx_int_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_int_5);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2691, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_p = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":2692
 *         # Get the promotion type.
 *         p = match.group(5)
 *         promotion = p and PIECE_SYMBOLS.index(p[-1].lower())             # <<<<<<<<<<<<<<
 * 
 *         # Filter by piece type.
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_p); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2692, __pyx_L1_error)
  if (__pyx_t_5) {
  } else {
    __Pyx_INCREF(__pyx_v_p);
    __pyx_t_7 = __pyx_v_p;
    goto __pyx_L22_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_index); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_p, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_lower); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_15);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_15))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_15);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_15, function);
    }
  }
  __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_t_10) : __Pyx_PyObject_CallNoArg(__pyx_t_15);
  __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_t_15 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_15)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_15);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  __pyx_t_4 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_15, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_9);
  __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_7 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L22_bool_binop_done:;
  __pyx_v_promotion = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":2695
 * 
 *         # Filter by piece type.
 *         if match.group(1):             # <<<<<<<<<<<<<<
 *             piece_type = PIECE_SYMBOLS.index(match.group(1).lower())
 *             from_mask = self.pieces_mask(piece_type, self.turn)
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2695, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_11 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_11)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_11);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_7 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_11, __pyx_int_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_int_1);
  __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2695, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2695, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2696
 *         # Filter by piece type.
 *         if match.group(1):
 *             piece_type = PIECE_SYMBOLS.index(match.group(1).lower())             # <<<<<<<<<<<<<<
 *             from_mask = self.pieces_mask(piece_type, self.turn)
 *         else:
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_PIECE_SYMBOLS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_index); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_15))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_15);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_15, function);
      }
    }
    __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_10, __pyx_int_1) : __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_int_1);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_lower); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_15))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_15);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_15, function);
      }
    }
    __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_t_9) : __Pyx_PyObject_CallNoArg(__pyx_t_15);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_15)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_15);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
      }
    }
    __pyx_t_7 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_15, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_v_piece_type = __pyx_t_7;
    __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2697
 *         if match.group(1):
 *             piece_type = PIECE_SYMBOLS.index(match.group(1).lower())
 *             from_mask = self.pieces_mask(piece_type, self.turn)             # <<<<<<<<<<<<<<
 *         else:
 *             from_mask = self.pawns
 */
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_pieces_mask); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2697, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_cur_scope->__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2697, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_15 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_15)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_15);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_11)) {
      PyObject *__pyx_temp[3] = {__pyx_t_15, __pyx_v_piece_type, __pyx_t_4};
      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2697, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
      PyObject *__pyx_temp[3] = {__pyx_t_15, __pyx_v_piece_type, __pyx_t_4};
      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2697, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2697, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_15) {
        __Pyx_GIVEREF(__pyx_t_15); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_15); __pyx_t_15 = NULL;
      }
      __Pyx_INCREF(__pyx_v_piece_type);
      __Pyx_GIVEREF(__pyx_v_piece_type);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_v_piece_type);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_9, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2697, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_v_from_mask = __pyx_t_7;
    __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":2695
 * 
 *         # Filter by piece type.
 *         if match.group(1):             # <<<<<<<<<<<<<<
 *             piece_type = PIECE_SYMBOLS.index(match.group(1).lower())
 *             from_mask = self.pieces_mask(piece_type, self.turn)
 */
    goto __pyx_L24;
  }

  /* "chess/__init__cp.pyx":2699
 *             from_mask = self.pieces_mask(piece_type, self.turn)
 *         else:
 *             from_mask = self.pawns             # <<<<<<<<<<<<<<
 * 
 *         # Filter by source file.
 */
  /*else*/ {
    __pyx_t_7 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_cur_scope->__pyx_v_self->__pyx_base.pawns); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2699, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_v_from_mask = __pyx_t_7;
    __pyx_t_7 = 0;
  }
  __pyx_L24:;

  /* "chess/__init__cp.pyx":2702
 * 
 *         # Filter by source file.
 *         if match.group(2):             # <<<<<<<<<<<<<<
 *             from_mask &= BB_FILES[FILE_NAMES.index(match.group(2))]
 * 
 */
  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2702, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  __pyx_t_7 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_9, __pyx_int_2) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_int_2);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2702, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2702, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2703
 *         # Filter by source file.
 *         if match.group(2):
 *             from_mask &= BB_FILES[FILE_NAMES.index(match.group(2))]             # <<<<<<<<<<<<<<
 * 
 *         # Filter by source rank.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_BB_FILES); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_15))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_15);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_15, function);
      }
    }
    __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_10, __pyx_int_2) : __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_int_2);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_15)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_15);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_11 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_15, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_9);
    __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = PyNumber_InPlaceAnd(__pyx_v_from_mask, __pyx_t_4); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2703, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_from_mask, __pyx_t_11);
    __pyx_t_11 = 0;

    /* "chess/__init__cp.pyx":2702
 * 
 *         # Filter by source file.
 *         if match.group(2):             # <<<<<<<<<<<<<<
 *             from_mask &= BB_FILES[FILE_NAMES.index(match.group(2))]
 * 
 */
  }

  /* "chess/__init__cp.pyx":2706
 * 
 *         # Filter by source rank.
 *         if match.group(3):             # <<<<<<<<<<<<<<
 *             from_mask &= BB_RANKS[int(match.group(3)) - 1]
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2706, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_11 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_int_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_int_3);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2706, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2706, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2707
 *         # Filter by source rank.
 *         if match.group(3):
 *             from_mask &= BB_RANKS[int(match.group(3)) - 1]             # <<<<<<<<<<<<<<
 * 
 *         # Match legal moves.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_BB_RANKS); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_match, __pyx_n_s_group); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_9, __pyx_int_3) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_int_3);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyNumber_Int(__pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyInt_SubtractObjC(__pyx_t_7, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_11, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_InPlaceAnd(__pyx_v_from_mask, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2707, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF_SET(__pyx_v_from_mask, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2706
 * 
 *         # Filter by source rank.
 *         if match.group(3):             # <<<<<<<<<<<<<<
 *             from_mask &= BB_RANKS[int(match.group(3)) - 1]
 * 
 */
  }

  /* "chess/__init__cp.pyx":2710
 * 
 *         # Match legal moves.
 *         matched_move = None             # <<<<<<<<<<<<<<
 *         for move in self.generate_legal_moves(from_mask, to_mask):
 *             if move.promotion != promotion:
 */
  __Pyx_INCREF(Py_None);
  __pyx_v_matched_move = Py_None;

  /* "chess/__init__cp.pyx":2711
 *         # Match legal moves.
 *         matched_move = None
 *         for move in self.generate_legal_moves(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *             if move.promotion != promotion:
 *                 continue
 */
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2711, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_11 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_11)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_11);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_11, __pyx_v_from_mask, __pyx_v_to_mask};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2711, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_11, __pyx_v_from_mask, __pyx_v_to_mask};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2711, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2711, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (__pyx_t_11) {
      __Pyx_GIVEREF(__pyx_t_11); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_11); __pyx_t_11 = NULL;
    }
    __Pyx_INCREF(__pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_v_from_mask);
    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_v_from_mask);
    __Pyx_INCREF(__pyx_v_to_mask);
    __Pyx_GIVEREF(__pyx_v_to_mask);
    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_v_to_mask);
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2711, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
    __pyx_t_7 = __pyx_t_4; __Pyx_INCREF(__pyx_t_7); __pyx_t_16 = 0;
    __pyx_t_17 = NULL;
  } else {
    __pyx_t_16 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2711, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_17 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 2711, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (likely(!__pyx_t_17)) {
      if (likely(PyList_CheckExact(__pyx_t_7))) {
        if (__pyx_t_16 >= PyList_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_16); __Pyx_INCREF(__pyx_t_4); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 2711, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_7, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_16 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_16); __Pyx_INCREF(__pyx_t_4); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 2711, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_7, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_17(__pyx_t_7);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2711, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2712
 *         matched_move = None
 *         for move in self.generate_legal_moves(from_mask, to_mask):
 *             if move.promotion != promotion:             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2712, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_9 = PyObject_RichCompare(__pyx_t_4, __pyx_v_promotion, Py_NE); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2712, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2712, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":2713
 *         for move in self.generate_legal_moves(from_mask, to_mask):
 *             if move.promotion != promotion:
 *                 continue             # <<<<<<<<<<<<<<
 * 
 *             if matched_move:
 */
      goto __pyx_L27_continue;

      /* "chess/__init__cp.pyx":2712
 *         matched_move = None
 *         for move in self.generate_legal_moves(from_mask, to_mask):
 *             if move.promotion != promotion:             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
    }

    /* "chess/__init__cp.pyx":2715
 *                 continue
 * 
 *             if matched_move:             # <<<<<<<<<<<<<<
 *                 raise ValueError("ambiguous san: {} in {}".format(repr(san), self.fen()))
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_matched_move); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2715, __pyx_L1_error)
    if (unlikely(__pyx_t_5)) {

      /* "chess/__init__cp.pyx":2716
 * 
 *             if matched_move:
 *                 raise ValueError("ambiguous san: {} in {}".format(repr(san), self.fen()))             # <<<<<<<<<<<<<<
 * 
 *             matched_move = move
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_ambiguous_san_in, __pyx_n_s_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2716, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_11 = PyObject_Repr(__pyx_v_san); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2716, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_fen); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2716, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_13 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      __pyx_t_15 = (__pyx_t_13) ? __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_13) : __Pyx_PyObject_CallNoArg(__pyx_t_10);
      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
      if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2716, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_15);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_8 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_8 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_11, __pyx_t_15};
        __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2716, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_11, __pyx_t_15};
        __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2716, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      } else
      #endif
      {
        __pyx_t_13 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2716, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_13);
        if (__pyx_t_10) {
          __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_10); __pyx_t_10 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_8, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_15);
        PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_8, __pyx_t_15);
        __pyx_t_11 = 0;
        __pyx_t_15 = 0;
        __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_13, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2716, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2716, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __PYX_ERR(0, 2716, __pyx_L1_error)

      /* "chess/__init__cp.pyx":2715
 *                 continue
 * 
 *             if matched_move:             # <<<<<<<<<<<<<<
 *                 raise ValueError("ambiguous san: {} in {}".format(repr(san), self.fen()))
 * 
 */
    }

    /* "chess/__init__cp.pyx":2718
 *                 raise ValueError("ambiguous san: {} in {}".format(repr(san), self.fen()))
 * 
 *             matched_move = move             # <<<<<<<<<<<<<<
 * 
 *         if not matched_move:
 */
    __Pyx_INCREF(__pyx_v_move);
    __Pyx_DECREF_SET(__pyx_v_matched_move, __pyx_v_move);

    /* "chess/__init__cp.pyx":2711
 *         # Match legal moves.
 *         matched_move = None
 *         for move in self.generate_legal_moves(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *             if move.promotion != promotion:
 *                 continue
 */
    __pyx_L27_continue:;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":2720
 *             matched_move = move
 * 
 *         if not matched_move:             # <<<<<<<<<<<<<<
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_matched_move); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2720, __pyx_L1_error)
  __pyx_t_6 = ((!__pyx_t_5) != 0);
  if (unlikely(__pyx_t_6)) {

    /* "chess/__init__cp.pyx":2721
 * 
 *         if not matched_move:
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))             # <<<<<<<<<<<<<<
 * 
 *         return matched_move
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_illegal_san_in, __pyx_n_s_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2721, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_9 = PyObject_Repr(__pyx_v_san); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2721, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_fen); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2721, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __pyx_t_11 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_15))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_15);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_15, function);
      }
    }
    __pyx_t_13 = (__pyx_t_11) ? __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_t_11) : __Pyx_PyObject_CallNoArg(__pyx_t_15);
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2721, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_15)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_15);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[3] = {__pyx_t_15, __pyx_t_9, __pyx_t_13};
      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2721, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[3] = {__pyx_t_15, __pyx_t_9, __pyx_t_13};
      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2721, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    {
      __pyx_t_11 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      if (__pyx_t_15) {
        __Pyx_GIVEREF(__pyx_t_15); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_15); __pyx_t_15 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_8, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_13);
      PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_8, __pyx_t_13);
      __pyx_t_9 = 0;
      __pyx_t_13 = 0;
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2721, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2721, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __PYX_ERR(0, 2721, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2720
 *             matched_move = move
 * 
 *         if not matched_move:             # <<<<<<<<<<<<<<
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2723
 *             raise ValueError("illegal san: {} in {}".format(repr(san), self.fen()))
 * 
 *         return matched_move             # <<<<<<<<<<<<<<
 * 
 *     def push_san(self, san):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_matched_move);
  __pyx_r = __pyx_v_matched_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2659
 *         return " ".join(san)
 * 
 *     def parse_san(self, san):             # <<<<<<<<<<<<<<
 *         """
 *         Uses the current position as the context to parse a move in standard
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("chess.__init__cp.Board.parse_san", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_match);
  __Pyx_XDECREF(__pyx_v_to_square);
  __Pyx_XDECREF(__pyx_v_to_mask);
  __Pyx_XDECREF(__pyx_v_p);
  __Pyx_XDECREF(__pyx_v_promotion);
  __Pyx_XDECREF(__pyx_v_piece_type);
  __Pyx_XDECREF(__pyx_v_from_mask);
  __Pyx_XDECREF(__pyx_v_matched_move);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2725
 *         return matched_move
 * 
 *     def push_san(self, san):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a move in standard algebraic notation, makes the move and puts
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_117push_san(PyObject *__pyx_v_self, PyObject *__pyx_v_san); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_116push_san[] = "\n        Parses a move in standard algebraic notation, makes the move and puts\n        it on the the move stack.\n\n        Returns the move.\n\n        :raises: :exc:`ValueError` if neither legal nor a null move.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_117push_san(PyObject *__pyx_v_self, PyObject *__pyx_v_san) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("push_san (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_116push_san(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_san));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_116push_san(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_san) {
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("push_san", 0);

  /* "chess/__init__cp.pyx":2734
 *         :raises: :exc:`ValueError` if neither legal nor a null move.
 *         """
 *         move = self.parse_san(san)             # <<<<<<<<<<<<<<
 *         self.push(move)
 *         return move
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parse_san); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2734, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_san) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_san);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2734, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_move = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2735
 *         """
 *         move = self.parse_san(san)
 *         self.push(move)             # <<<<<<<<<<<<<<
 *         return move
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2736
 *         move = self.parse_san(san)
 *         self.push(move)
 *         return move             # <<<<<<<<<<<<<<
 * 
 *     def uci(self, move, *, chess960=None):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_move);
  __pyx_r = __pyx_v_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2725
 *         return matched_move
 * 
 *     def push_san(self, san):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a move in standard algebraic notation, makes the move and puts
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.push_san", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2738
 *         return move
 * 
 *     def uci(self, move, *, chess960=None):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the UCI notation of the move.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_119uci(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_118uci[] = "\n        Gets the UCI notation of the move.\n\n        *chess960* defaults to the mode of the board. Pass ``True`` to force\n        Chess960 mode.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_119uci(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_move = 0;
  PyObject *__pyx_v_chess960 = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("uci (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_move,&__pyx_n_s_chess960,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_move)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "uci") < 0)) __PYX_ERR(0, 2738, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_move = values[0];
    __pyx_v_chess960 = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("uci", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2738, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.uci", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_118uci(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_move, __pyx_v_chess960);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_118uci(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move, PyObject *__pyx_v_chess960) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  __Pyx_RefNannySetupContext("uci", 0);
  __Pyx_INCREF(__pyx_v_move);
  __Pyx_INCREF(__pyx_v_chess960);

  /* "chess/__init__cp.pyx":2745
 *         Chess960 mode.
 *         """
 *         if chess960 is None:             # <<<<<<<<<<<<<<
 *             chess960 = self.chess960
 * 
 */
  __pyx_t_1 = (__pyx_v_chess960 == Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2746
 *         """
 *         if chess960 is None:
 *             chess960 = self.chess960             # <<<<<<<<<<<<<<
 * 
 *         move = self._to_chess960(move)
 */
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2746, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_chess960, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2745
 *         Chess960 mode.
 *         """
 *         if chess960 is None:             # <<<<<<<<<<<<<<
 *             chess960 = self.chess960
 * 
 */
  }

  /* "chess/__init__cp.pyx":2748
 *             chess960 = self.chess960
 * 
 *         move = self._to_chess960(move)             # <<<<<<<<<<<<<<
 *         move = self._from_chess960(chess960, move.from_square, move.to_square, move.promotion, move.drop)
 *         return move.uci()
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_chess960); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF_SET(__pyx_v_move, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2749
 * 
 *         move = self._to_chess960(move)
 *         move = self._from_chess960(chess960, move.from_square, move.to_square, move.promotion, move.drop)             # <<<<<<<<<<<<<<
 *         return move.uci()
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_from_chess960); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_10 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[6] = {__pyx_t_9, __pyx_v_chess960, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8};
    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 5+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2749, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[6] = {__pyx_t_9, __pyx_v_chess960, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8};
    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 5+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2749, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_11 = PyTuple_New(5+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2749, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    if (__pyx_t_9) {
      __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    __Pyx_INCREF(__pyx_v_chess960);
    __Pyx_GIVEREF(__pyx_v_chess960);
    PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_v_chess960);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_10, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_11, 3+__pyx_t_10, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_11, 4+__pyx_t_10, __pyx_t_8);
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_8 = 0;
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2749, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF_SET(__pyx_v_move, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2750
 *         move = self._to_chess960(move)
 *         move = self._from_chess960(chess960, move.from_square, move.to_square, move.promotion, move.drop)
 *         return move.uci()             # <<<<<<<<<<<<<<
 * 
 *     def parse_uci(self, uci):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_uci); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_11 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_11)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_11);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_11) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_11) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2738
 *         return move
 * 
 *     def uci(self, move, *, chess960=None):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the UCI notation of the move.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("chess.__init__cp.Board.uci", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XDECREF(__pyx_v_chess960);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2752
 *         return move.uci()
 * 
 *     def parse_uci(self, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses the given move in UCI notation.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_121parse_uci(PyObject *__pyx_v_self, PyObject *__pyx_v_uci); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_120parse_uci[] = "\n        Parses the given move in UCI notation.\n\n        Supports both Chess960 and standard UCI notation.\n\n        The returned move is guaranteed to be either legal or a null move.\n\n        :raises: :exc:`ValueError` if the move is invalid or illegal in the\n            current position (but not a null move).\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_121parse_uci(PyObject *__pyx_v_self, PyObject *__pyx_v_uci) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("parse_uci (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_120parse_uci(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_uci));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_120parse_uci(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_uci) {
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  __Pyx_RefNannySetupContext("parse_uci", 0);

  /* "chess/__init__cp.pyx":2763
 *             current position (but not a null move).
 *         """
 *         move = Move.from_uci(uci)             # <<<<<<<<<<<<<<
 * 
 *         if not move:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_n_s_from_uci); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2763, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_uci) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_uci);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2763, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_move = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2765
 *         move = Move.from_uci(uci)
 * 
 *         if not move:             # <<<<<<<<<<<<<<
 *             return move
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_move); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2765, __pyx_L1_error)
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2766
 * 
 *         if not move:
 *             return move             # <<<<<<<<<<<<<<
 * 
 *         move = self._to_chess960(move)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_move);
    __pyx_r = __pyx_v_move;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2765
 *         move = Move.from_uci(uci)
 * 
 *         if not move:             # <<<<<<<<<<<<<<
 *             return move
 * 
 */
  }

  /* "chess/__init__cp.pyx":2768
 *             return move
 * 
 *         move = self._to_chess960(move)             # <<<<<<<<<<<<<<
 *         move = self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_chess960); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_move, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2769
 * 
 *         move = self._to_chess960(move)
 *         move = self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop)             # <<<<<<<<<<<<<<
 * 
 *         if not self.is_legal(move):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_from_chess960); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2769, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2769, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2769, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2769, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_promotion); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2769, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_drop); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2769, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = NULL;
  __pyx_t_11 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_11 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[6] = {__pyx_t_10, __pyx_t_3, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 5+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2769, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[6] = {__pyx_t_10, __pyx_t_3, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 5+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2769, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  {
    __pyx_t_12 = PyTuple_New(5+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2769, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    if (__pyx_t_10) {
      __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_12, 2+__pyx_t_11, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_12, 3+__pyx_t_11, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_12, 4+__pyx_t_11, __pyx_t_9);
    __pyx_t_3 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_8 = 0;
    __pyx_t_9 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2769, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_move, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2771
 *         move = self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop)
 * 
 *         if not self.is_legal(move):             # <<<<<<<<<<<<<<
 *             raise ValueError("illegal uci: {} in {}".format(repr(uci), self.fen()))
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_legal); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2771, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_12 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_12)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_12);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_12, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2771, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2771, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = ((!__pyx_t_5) != 0);
  if (unlikely(__pyx_t_4)) {

    /* "chess/__init__cp.pyx":2772
 * 
 *         if not self.is_legal(move):
 *             raise ValueError("illegal uci: {} in {}".format(repr(uci), self.fen()))             # <<<<<<<<<<<<<<
 * 
 *         return move
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_illegal_uci_in, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_12 = PyObject_Repr(__pyx_v_uci); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_fen); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_9 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    __pyx_t_11 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_11 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_12, __pyx_t_9};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2772, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_12, __pyx_t_9};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2772, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2772, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_8) {
        __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8); __pyx_t_8 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_11, __pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_11, __pyx_t_9);
      __pyx_t_12 = 0;
      __pyx_t_9 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2772, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 2772, __pyx_L1_error)

    /* "chess/__init__cp.pyx":2771
 *         move = self._from_chess960(self.chess960, move.from_square, move.to_square, move.promotion, move.drop)
 * 
 *         if not self.is_legal(move):             # <<<<<<<<<<<<<<
 *             raise ValueError("illegal uci: {} in {}".format(repr(uci), self.fen()))
 * 
 */
  }

  /* "chess/__init__cp.pyx":2774
 *             raise ValueError("illegal uci: {} in {}".format(repr(uci), self.fen()))
 * 
 *         return move             # <<<<<<<<<<<<<<
 * 
 *     def push_uci(self, uci):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_move);
  __pyx_r = __pyx_v_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2752
 *         return move.uci()
 * 
 *     def parse_uci(self, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses the given move in UCI notation.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("chess.__init__cp.Board.parse_uci", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2776
 *         return move
 * 
 *     def push_uci(self, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a move in UCI notation and puts it on the move stack.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_123push_uci(PyObject *__pyx_v_self, PyObject *__pyx_v_uci); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_122push_uci[] = "\n        Parses a move in UCI notation and puts it on the move stack.\n\n        Returns the move.\n\n        :raises: :exc:`ValueError` if the move is invalid or illegal in the\n            current position (but not a null move).\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_123push_uci(PyObject *__pyx_v_self, PyObject *__pyx_v_uci) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("push_uci (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_122push_uci(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_uci));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_122push_uci(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_uci) {
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("push_uci", 0);

  /* "chess/__init__cp.pyx":2785
 *             current position (but not a null move).
 *         """
 *         move = self.parse_uci(uci)             # <<<<<<<<<<<<<<
 *         self.push(move)
 *         return move
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parse_uci); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_uci) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_uci);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_move = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2786
 *         """
 *         move = self.parse_uci(uci)
 *         self.push(move)             # <<<<<<<<<<<<<<
 *         return move
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_push); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2787
 *         move = self.parse_uci(uci)
 *         self.push(move)
 *         return move             # <<<<<<<<<<<<<<
 * 
 *     def is_en_passant(self, Move move):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_move);
  __pyx_r = __pyx_v_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2776
 *         return move
 * 
 *     def push_uci(self, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses a move in UCI notation and puts it on the move stack.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.push_uci", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2789
 *         return move
 * 
 *     def is_en_passant(self, Move move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is an en passant capture."""
 *         return (self.ep_square == move.to_square and
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_125is_en_passant(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_124is_en_passant[] = "Checks if the given pseudo-legal move is an en passant capture.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_125is_en_passant(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_en_passant (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_move), __pyx_ptype_5chess_10__init__cp_Move, 1, "move", 0))) __PYX_ERR(0, 2789, __pyx_L1_error)
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_124is_en_passant(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_move));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_124is_en_passant(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("is_en_passant", 0);

  /* "chess/__init__cp.pyx":2791
 *     def is_en_passant(self, Move move):
 *         """Checks if the given pseudo-legal move is an en passant capture."""
 *         return (self.ep_square == move.to_square and             # <<<<<<<<<<<<<<
 *                 bool(self.pawns & BB_SQUARES[move.from_square]) and
 *                 abs(move.to_square - move.from_square) in [7, 9] and
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_move->to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_RichCompare(__pyx_v_self->__pyx_base.ep_square, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2791, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2791, __pyx_L1_error)
  if (__pyx_t_4) {
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_3);
    __pyx_t_1 = __pyx_t_3;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L3_bool_binop_done;
  }

  /* "chess/__init__cp.pyx":2792
 *         """Checks if the given pseudo-legal move is an en passant capture."""
 *         return (self.ep_square == move.to_square and
 *                 bool(self.pawns & BB_SQUARES[move.from_square]) and             # <<<<<<<<<<<<<<
 *                 abs(move.to_square - move.from_square) in [7, 9] and
 *                 not self.occupied & BB_SQUARES[move.to_square])
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.pawns); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_move->from_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2792, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!(!__pyx_t_4))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2792, __pyx_L1_error)
  if (__pyx_t_4) {
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }

  /* "chess/__init__cp.pyx":2793
 *         return (self.ep_square == move.to_square and
 *                 bool(self.pawns & BB_SQUARES[move.from_square]) and
 *                 abs(move.to_square - move.from_square) in [7, 9] and             # <<<<<<<<<<<<<<
 *                 not self.occupied & BB_SQUARES[move.to_square])
 * 
 */
  __pyx_t_6 = abs((__pyx_v_move->to_square - __pyx_v_move->from_square)); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 2793, __pyx_L1_error)
  __pyx_t_7 = ((__pyx_t_6 == 7) != 0);
  if (!__pyx_t_7) {
  } else {
    __pyx_t_4 = __pyx_t_7;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_7 = ((__pyx_t_6 == 9) != 0);
  __pyx_t_4 = __pyx_t_7;
  __pyx_L7_bool_binop_done:;
  __pyx_t_7 = __pyx_t_4;
  if (__pyx_t_7) {
  } else {
    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2793, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }

  /* "chess/__init__cp.pyx":2794
 *                 bool(self.pawns & BB_SQUARES[move.from_square]) and
 *                 abs(move.to_square - move.from_square) in [7, 9] and
 *                 not self.occupied & BB_SQUARES[move.to_square])             # <<<<<<<<<<<<<<
 * 
 *     def is_capture(self, Move move):
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_move->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_4 = (!__pyx_t_7);
  __pyx_t_5 = __Pyx_PyBool_FromLong(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = __pyx_t_5;
  __pyx_t_5 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2789
 *         return move
 * 
 *     def is_en_passant(self, Move move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is an en passant capture."""
 *         return (self.ep_square == move.to_square and
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_en_passant", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2796
 *                 not self.occupied & BB_SQUARES[move.to_square])
 * 
 *     def is_capture(self, Move move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is a capture."""
 *         return bool(BB_SQUARES[move.to_square] & self.occupied_co[not self.turn]) or self.is_en_passant(move)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_127is_capture(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_126is_capture[] = "Checks if the given pseudo-legal move is a capture.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_127is_capture(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_capture (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_move), __pyx_ptype_5chess_10__init__cp_Move, 1, "move", 0))) __PYX_ERR(0, 2796, __pyx_L1_error)
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_126is_capture(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_move));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_126is_capture(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("is_capture", 0);

  /* "chess/__init__cp.pyx":2798
 *     def is_capture(self, Move move):
 *         """Checks if the given pseudo-legal move is a capture."""
 *         return bool(BB_SQUARES[move.to_square] & self.occupied_co[not self.turn]) or self.is_en_passant(move)             # <<<<<<<<<<<<<<
 * 
 *     def is_zeroing(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_move->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))])); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyBool_FromLong((!(!__pyx_t_5))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2798, __pyx_L1_error)
  if (!__pyx_t_5) {
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_1 = __pyx_t_4;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_en_passant); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_move)) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_move));
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2796
 *                 not self.occupied & BB_SQUARES[move.to_square])
 * 
 *     def is_capture(self, Move move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is a capture."""
 *         return bool(BB_SQUARES[move.to_square] & self.occupied_co[not self.turn]) or self.is_en_passant(move)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_capture", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2800
 *         return bool(BB_SQUARES[move.to_square] & self.occupied_co[not self.turn]) or self.is_en_passant(move)
 * 
 *     def is_zeroing(self, move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is a capture or pawn move."""
 *         return bool(BB_SQUARES[move.from_square] & self.pawns or BB_SQUARES[move.to_square] & self.occupied_co[not self.turn])
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_129is_zeroing(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_128is_zeroing[] = "Checks if the given pseudo-legal move is a capture or pawn move.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_129is_zeroing(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_zeroing (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_128is_zeroing(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_128is_zeroing(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("is_zeroing", 0);

  /* "chess/__init__cp.pyx":2802
 *     def is_zeroing(self, move):
 *         """Checks if the given pseudo-legal move is a capture or pawn move."""
 *         return bool(BB_SQUARES[move.from_square] & self.pawns or BB_SQUARES[move.to_square] & self.occupied_co[not self.turn])             # <<<<<<<<<<<<<<
 * 
 *     def is_irreversible(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.pawns); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_5) {
  } else {
    __pyx_t_1 = __pyx_t_5;
    goto __pyx_L3_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_1 = __pyx_t_5;
  __pyx_L3_bool_binop_done:;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!(!__pyx_t_1))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2800
 *         return bool(BB_SQUARES[move.to_square] & self.occupied_co[not self.turn]) or self.is_en_passant(move)
 * 
 *     def is_zeroing(self, move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is a capture or pawn move."""
 *         return bool(BB_SQUARES[move.from_square] & self.pawns or BB_SQUARES[move.to_square] & self.occupied_co[not self.turn])
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_zeroing", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2804
 *         return bool(BB_SQUARES[move.from_square] & self.pawns or BB_SQUARES[move.to_square] & self.occupied_co[not self.turn])
 * 
 *     def is_irreversible(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given pseudo-legal move is irreversible.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_131is_irreversible(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_130is_irreversible[] = "\n        Checks if the given pseudo-legal move is irreversible.\n\n        In standard chess, pawn moves, captures and moves that destroy castling\n        rights are irreversible.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_131is_irreversible(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_irreversible (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_130is_irreversible(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_130is_irreversible(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_v_backrank = NULL;
  PyObject *__pyx_v_cr = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("is_irreversible", 0);

  /* "chess/__init__cp.pyx":2811
 *         rights are irreversible.
 *         """
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 *         cr = self.clean_castling_rights() & backrank
 *         return bool(self.is_zeroing(move) or
 */
  if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2811, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2811, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_v_backrank = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2812
 *         """
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8
 *         cr = self.clean_castling_rights() & backrank             # <<<<<<<<<<<<<<
 *         return bool(self.is_zeroing(move) or
 *                     cr and BB_SQUARES[move.from_square] & self.kings & ~self.promoted or
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2812, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2812, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2812, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_cr = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2813
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8
 *         cr = self.clean_castling_rights() & backrank
 *         return bool(self.is_zeroing(move) or             # <<<<<<<<<<<<<<
 *                     cr and BB_SQUARES[move.from_square] & self.kings & ~self.promoted or
 *                     cr & BB_SQUARES[move.from_square] or
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_zeroing); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2813, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2813, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2813, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L3_bool_binop_done;
  }

  /* "chess/__init__cp.pyx":2814
 *         cr = self.clean_castling_rights() & backrank
 *         return bool(self.is_zeroing(move) or
 *                     cr and BB_SQUARES[move.from_square] & self.kings & ~self.promoted or             # <<<<<<<<<<<<<<
 *                     cr & BB_SQUARES[move.from_square] or
 *                     cr & BB_SQUARES[move.to_square])
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_cr); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2814, __pyx_L1_error)
  if (!__pyx_t_5) {
    goto __pyx_L5_next_or;
  } else {
  }
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_int((~__pyx_v_self->__pyx_base.promoted)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2814, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (!__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_L5_next_or:;

  /* "chess/__init__cp.pyx":2815
 *         return bool(self.is_zeroing(move) or
 *                     cr and BB_SQUARES[move.from_square] & self.kings & ~self.promoted or
 *                     cr & BB_SQUARES[move.from_square] or             # <<<<<<<<<<<<<<
 *                     cr & BB_SQUARES[move.to_square])
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2815, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2815, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2815, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_v_cr, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2815, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2815, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L3_bool_binop_done;
  }

  /* "chess/__init__cp.pyx":2816
 *                     cr and BB_SQUARES[move.from_square] & self.kings & ~self.promoted or
 *                     cr & BB_SQUARES[move.from_square] or
 *                     cr & BB_SQUARES[move.to_square])             # <<<<<<<<<<<<<<
 * 
 *     def is_castling(self, Move move):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2816, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2816, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2816, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_v_cr, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2816, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2816, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __pyx_t_5;
  __pyx_L3_bool_binop_done:;

  /* "chess/__init__cp.pyx":2813
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8
 *         cr = self.clean_castling_rights() & backrank
 *         return bool(self.is_zeroing(move) or             # <<<<<<<<<<<<<<
 *                     cr and BB_SQUARES[move.from_square] & self.kings & ~self.promoted or
 *                     cr & BB_SQUARES[move.from_square] or
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong((!(!__pyx_t_4))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2813, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2804
 *         return bool(BB_SQUARES[move.from_square] & self.pawns or BB_SQUARES[move.to_square] & self.occupied_co[not self.turn])
 * 
 *     def is_irreversible(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given pseudo-legal move is irreversible.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_irreversible", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_backrank);
  __Pyx_XDECREF(__pyx_v_cr);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2818
 *                     cr & BB_SQUARES[move.to_square])
 * 
 *     def is_castling(self, Move move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is a castling move."""
 *         if self.kings & BB_SQUARES[move.from_square]:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_133is_castling(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_132is_castling[] = "Checks if the given pseudo-legal move is a castling move.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_133is_castling(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_castling (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_move), __pyx_ptype_5chess_10__init__cp_Move, 1, "move", 0))) __PYX_ERR(0, 2818, __pyx_L1_error)
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_132is_castling(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_move));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_132is_castling(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move) {
  PyObject *__pyx_v_diff = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("is_castling", 0);

  /* "chess/__init__cp.pyx":2820
 *     def is_castling(self, Move move):
 *         """Checks if the given pseudo-legal move is a castling move."""
 *         if self.kings & BB_SQUARES[move.from_square]:             # <<<<<<<<<<<<<<
 *             diff = square_file(move.from_square) - square_file(move.to_square)
 *             return abs(diff) > 1 or bool(self.rooks & self.occupied_co[self.turn] & BB_SQUARES[move.to_square])
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_move->from_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2820, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":2821
 *         """Checks if the given pseudo-legal move is a castling move."""
 *         if self.kings & BB_SQUARES[move.from_square]:
 *             diff = square_file(move.from_square) - square_file(move.to_square)             # <<<<<<<<<<<<<<
 *             return abs(diff) > 1 or bool(self.rooks & self.occupied_co[self.turn] & BB_SQUARES[move.to_square])
 *         return False
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_move->from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_square_file); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_move->to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Subtract(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_diff = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2822
 *         if self.kings & BB_SQUARES[move.from_square]:
 *             diff = square_file(move.from_square) - square_file(move.to_square)
 *             return abs(diff) > 1 or bool(self.rooks & self.occupied_co[self.turn] & BB_SQUARES[move.to_square])             # <<<<<<<<<<<<<<
 *         return False
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyNumber_Absolute(__pyx_v_diff); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2822, __pyx_L1_error)
    if (!__pyx_t_4) {
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      __Pyx_INCREF(__pyx_t_2);
      __pyx_t_1 = __pyx_t_2;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.rooks & (__pyx_v_self->__pyx_base.occupied_co[__pyx_v_self->__pyx_base.turn]))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_move->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyBool_FromLong((!(!__pyx_t_4))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_3);
    __pyx_t_1 = __pyx_t_3;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_L4_bool_binop_done:;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2820
 *     def is_castling(self, Move move):
 *         """Checks if the given pseudo-legal move is a castling move."""
 *         if self.kings & BB_SQUARES[move.from_square]:             # <<<<<<<<<<<<<<
 *             diff = square_file(move.from_square) - square_file(move.to_square)
 *             return abs(diff) > 1 or bool(self.rooks & self.occupied_co[self.turn] & BB_SQUARES[move.to_square])
 */
  }

  /* "chess/__init__cp.pyx":2823
 *             diff = square_file(move.from_square) - square_file(move.to_square)
 *             return abs(diff) > 1 or bool(self.rooks & self.occupied_co[self.turn] & BB_SQUARES[move.to_square])
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def is_kingside_castling(self, Move move):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2818
 *                     cr & BB_SQUARES[move.to_square])
 * 
 *     def is_castling(self, Move move):             # <<<<<<<<<<<<<<
 *         """Checks if the given pseudo-legal move is a castling move."""
 *         if self.kings & BB_SQUARES[move.from_square]:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_castling", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_diff);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2825
 *         return False
 * 
 *     def is_kingside_castling(self, Move move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given pseudo-legal move is a kingside castling move.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_135is_kingside_castling(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_134is_kingside_castling[] = "\n        Checks if the given pseudo-legal move is a kingside castling move.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_135is_kingside_castling(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_kingside_castling (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_move), __pyx_ptype_5chess_10__init__cp_Move, 1, "move", 0))) __PYX_ERR(0, 2825, __pyx_L1_error)
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_134is_kingside_castling(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v_move));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_134is_kingside_castling(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("is_kingside_castling", 0);

  /* "chess/__init__cp.pyx":2829
 *         Checks if the given pseudo-legal move is a kingside castling move.
 *         """
 *         return self.is_castling(move) and square_file(move.to_square) > square_file(move.from_square)             # <<<<<<<<<<<<<<
 * 
 *     def is_queenside_castling(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_castling); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_move)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_move));
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2829, __pyx_L1_error)
  if (__pyx_t_5) {
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_move->to_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_file); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_move->from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2825
 *         return False
 * 
 *     def is_kingside_castling(self, Move move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given pseudo-legal move is a kingside castling move.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_kingside_castling", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2831
 *         return self.is_castling(move) and square_file(move.to_square) > square_file(move.from_square)
 * 
 *     def is_queenside_castling(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given pseudo-legal move is a queenside castling move.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_137is_queenside_castling(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_136is_queenside_castling[] = "\n        Checks if the given pseudo-legal move is a queenside castling move.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_137is_queenside_castling(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_queenside_castling (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_136is_queenside_castling(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_136is_queenside_castling(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("is_queenside_castling", 0);

  /* "chess/__init__cp.pyx":2835
 *         Checks if the given pseudo-legal move is a queenside castling move.
 *         """
 *         return self.is_castling(move) and square_file(move.to_square) < square_file(move.from_square)             # <<<<<<<<<<<<<<
 * 
 *     def clean_castling_rights(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_castling); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2835, __pyx_L1_error)
  if (__pyx_t_5) {
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_square_file); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2835, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2831
 *         return self.is_castling(move) and square_file(move.to_square) > square_file(move.from_square)
 * 
 *     def is_queenside_castling(self, move):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given pseudo-legal move is a queenside castling move.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_queenside_castling", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2837
 *         return self.is_castling(move) and square_file(move.to_square) < square_file(move.from_square)
 * 
 *     def clean_castling_rights(self):             # <<<<<<<<<<<<<<
 *         """
 *         Returns valid castling rights filtered from
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_139clean_castling_rights(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_138clean_castling_rights[] = "\n        Returns valid castling rights filtered from\n        :data:`~chess.Board.castling_rights`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_139clean_castling_rights(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clean_castling_rights (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_138clean_castling_rights(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_138clean_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  unsigned PY_LONG_LONG __pyx_v_castling;
  PyObject *__pyx_v_white_castling = NULL;
  PyObject *__pyx_v_black_castling = NULL;
  PyObject *__pyx_v_white_king_mask = NULL;
  PyObject *__pyx_v_black_king_mask = NULL;
  PyObject *__pyx_v_white_a_side = NULL;
  PyObject *__pyx_v_white_h_side = NULL;
  PyObject *__pyx_v_black_a_side = NULL;
  PyObject *__pyx_v_black_h_side = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("clean_castling_rights", 0);

  /* "chess/__init__cp.pyx":2842
 *         :data:`~chess.Board.castling_rights`.
 *         """
 *         if self.stack:             # <<<<<<<<<<<<<<
 *             # Castling rights do not change in a game, so we can assume them to
 *             # be filtered already.
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.stack); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2842, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2845
 *             # Castling rights do not change in a game, so we can assume them to
 *             # be filtered already.
 *             return self.castling_rights             # <<<<<<<<<<<<<<
 * 
 *         castling = self.castling_rights & self.rooks
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2845, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2842
 *         :data:`~chess.Board.castling_rights`.
 *         """
 *         if self.stack:             # <<<<<<<<<<<<<<
 *             # Castling rights do not change in a game, so we can assume them to
 *             # be filtered already.
 */
  }

  /* "chess/__init__cp.pyx":2847
 *             return self.castling_rights
 * 
 *         castling = self.castling_rights & self.rooks             # <<<<<<<<<<<<<<
 *         white_castling = castling & BB_RANK_1 & self.occupied_co[WHITE]
 *         black_castling = castling & BB_RANK_8 & self.occupied_co[BLACK]
 */
  __pyx_v_castling = (__pyx_v_self->__pyx_base.castling_rights & __pyx_v_self->__pyx_base.rooks);

  /* "chess/__init__cp.pyx":2848
 * 
 *         castling = self.castling_rights & self.rooks
 *         white_castling = castling & BB_RANK_1 & self.occupied_co[WHITE]             # <<<<<<<<<<<<<<
 *         black_castling = castling & BB_RANK_8 & self.occupied_co[BLACK]
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_castling); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[1])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_white_castling = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2849
 *         castling = self.castling_rights & self.rooks
 *         white_castling = castling & BB_RANK_1 & self.occupied_co[WHITE]
 *         black_castling = castling & BB_RANK_8 & self.occupied_co[BLACK]             # <<<<<<<<<<<<<<
 * 
 *         if not self.chess960:
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_castling); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[0])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_black_castling = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2851
 *         black_castling = castling & BB_RANK_8 & self.occupied_co[BLACK]
 * 
 *         if not self.chess960:             # <<<<<<<<<<<<<<
 *             # The rooks must be on a1, h1, a8 or h8.
 *             white_castling &= (BB_A1 | BB_H1)
 */
  __pyx_t_1 = ((!(__pyx_v_self->__pyx_base.chess960 != 0)) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2853
 *         if not self.chess960:
 *             # The rooks must be on a1, h1, a8 or h8.
 *             white_castling &= (BB_A1 | BB_H1)             # <<<<<<<<<<<<<<
 *             black_castling &= (BB_A8 | BB_H8)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_A1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2853, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_H1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2853, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2853, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_v_white_castling, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2853, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_white_castling, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2854
 *             # The rooks must be on a1, h1, a8 or h8.
 *             white_castling &= (BB_A1 | BB_H1)
 *             black_castling &= (BB_A8 | BB_H8)             # <<<<<<<<<<<<<<
 * 
 *             # The kings must be on e1 or e8.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_A8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2854, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_H8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2854, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_Or(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2854, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_InPlaceAnd(__pyx_v_black_castling, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2854, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_black_castling, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2857
 * 
 *             # The kings must be on e1 or e8.
 *             if not self.occupied_co[WHITE] & self.kings & ~self.promoted & BB_E1:             # <<<<<<<<<<<<<<
 *                 white_castling = 0
 *             if not self.occupied_co[BLACK] & self.kings & ~self.promoted & BB_E8:
 */
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((((__pyx_v_self->__pyx_base.occupied_co[1]) & __pyx_v_self->__pyx_base.kings) & (~__pyx_v_self->__pyx_base.promoted))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2857, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_E1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2857, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2857, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2857, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = ((!__pyx_t_1) != 0);
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":2858
 *             # The kings must be on e1 or e8.
 *             if not self.occupied_co[WHITE] & self.kings & ~self.promoted & BB_E1:
 *                 white_castling = 0             # <<<<<<<<<<<<<<
 *             if not self.occupied_co[BLACK] & self.kings & ~self.promoted & BB_E8:
 *                 black_castling = 0
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_white_castling, __pyx_int_0);

      /* "chess/__init__cp.pyx":2857
 * 
 *             # The kings must be on e1 or e8.
 *             if not self.occupied_co[WHITE] & self.kings & ~self.promoted & BB_E1:             # <<<<<<<<<<<<<<
 *                 white_castling = 0
 *             if not self.occupied_co[BLACK] & self.kings & ~self.promoted & BB_E8:
 */
    }

    /* "chess/__init__cp.pyx":2859
 *             if not self.occupied_co[WHITE] & self.kings & ~self.promoted & BB_E1:
 *                 white_castling = 0
 *             if not self.occupied_co[BLACK] & self.kings & ~self.promoted & BB_E8:             # <<<<<<<<<<<<<<
 *                 black_castling = 0
 * 
 */
    __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((((__pyx_v_self->__pyx_base.occupied_co[0]) & __pyx_v_self->__pyx_base.kings) & (~__pyx_v_self->__pyx_base.promoted))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_E8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = ((!__pyx_t_5) != 0);
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2860
 *                 white_castling = 0
 *             if not self.occupied_co[BLACK] & self.kings & ~self.promoted & BB_E8:
 *                 black_castling = 0             # <<<<<<<<<<<<<<
 * 
 *             return white_castling | black_castling
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_black_castling, __pyx_int_0);

      /* "chess/__init__cp.pyx":2859
 *             if not self.occupied_co[WHITE] & self.kings & ~self.promoted & BB_E1:
 *                 white_castling = 0
 *             if not self.occupied_co[BLACK] & self.kings & ~self.promoted & BB_E8:             # <<<<<<<<<<<<<<
 *                 black_castling = 0
 * 
 */
    }

    /* "chess/__init__cp.pyx":2862
 *                 black_castling = 0
 * 
 *             return white_castling | black_castling             # <<<<<<<<<<<<<<
 *         else:
 *             # The kings must be on the back rank.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_4 = PyNumber_Or(__pyx_v_white_castling, __pyx_v_black_castling); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2862, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2851
 *         black_castling = castling & BB_RANK_8 & self.occupied_co[BLACK]
 * 
 *         if not self.chess960:             # <<<<<<<<<<<<<<
 *             # The rooks must be on a1, h1, a8 or h8.
 *             white_castling &= (BB_A1 | BB_H1)
 */
  }

  /* "chess/__init__cp.pyx":2865
 *         else:
 *             # The kings must be on the back rank.
 *             white_king_mask = self.occupied_co[WHITE] & self.kings & BB_RANK_1 & ~self.promoted             # <<<<<<<<<<<<<<
 *             black_king_mask = self.occupied_co[BLACK] & self.kings & BB_RANK_8 & ~self.promoted
 *             if not white_king_mask:
 */
  /*else*/ {
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[1]) & __pyx_v_self->__pyx_base.kings)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyInt_From_int((~__pyx_v_self->__pyx_base.promoted)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_white_king_mask = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2866
 *             # The kings must be on the back rank.
 *             white_king_mask = self.occupied_co[WHITE] & self.kings & BB_RANK_1 & ~self.promoted
 *             black_king_mask = self.occupied_co[BLACK] & self.kings & BB_RANK_8 & ~self.promoted             # <<<<<<<<<<<<<<
 *             if not white_king_mask:
 *                 white_castling = 0
 */
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[0]) & __pyx_v_self->__pyx_base.kings)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2866, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2866, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2866, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyInt_From_int((~__pyx_v_self->__pyx_base.promoted)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2866, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2866, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_black_king_mask = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":2867
 *             white_king_mask = self.occupied_co[WHITE] & self.kings & BB_RANK_1 & ~self.promoted
 *             black_king_mask = self.occupied_co[BLACK] & self.kings & BB_RANK_8 & ~self.promoted
 *             if not white_king_mask:             # <<<<<<<<<<<<<<
 *                 white_castling = 0
 *             if not black_king_mask:
 */
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_white_king_mask); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2867, __pyx_L1_error)
    __pyx_t_5 = ((!__pyx_t_1) != 0);
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":2868
 *             black_king_mask = self.occupied_co[BLACK] & self.kings & BB_RANK_8 & ~self.promoted
 *             if not white_king_mask:
 *                 white_castling = 0             # <<<<<<<<<<<<<<
 *             if not black_king_mask:
 *                 black_castling = 0
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_white_castling, __pyx_int_0);

      /* "chess/__init__cp.pyx":2867
 *             white_king_mask = self.occupied_co[WHITE] & self.kings & BB_RANK_1 & ~self.promoted
 *             black_king_mask = self.occupied_co[BLACK] & self.kings & BB_RANK_8 & ~self.promoted
 *             if not white_king_mask:             # <<<<<<<<<<<<<<
 *                 white_castling = 0
 *             if not black_king_mask:
 */
    }

    /* "chess/__init__cp.pyx":2869
 *             if not white_king_mask:
 *                 white_castling = 0
 *             if not black_king_mask:             # <<<<<<<<<<<<<<
 *                 black_castling = 0
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_black_king_mask); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2869, __pyx_L1_error)
    __pyx_t_1 = ((!__pyx_t_5) != 0);
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2870
 *                 white_castling = 0
 *             if not black_king_mask:
 *                 black_castling = 0             # <<<<<<<<<<<<<<
 * 
 *             # There are only two ways of castling, a-side and h-side, and the
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_black_castling, __pyx_int_0);

      /* "chess/__init__cp.pyx":2869
 *             if not white_king_mask:
 *                 white_castling = 0
 *             if not black_king_mask:             # <<<<<<<<<<<<<<
 *                 black_castling = 0
 * 
 */
    }

    /* "chess/__init__cp.pyx":2874
 *             # There are only two ways of castling, a-side and h-side, and the
 *             # king must be between the rooks.
 *             white_a_side = white_castling & -white_castling             # <<<<<<<<<<<<<<
 *             white_h_side = BB_SQUARES[msb(white_castling)] if white_castling else 0
 * 
 */
    __pyx_t_4 = PyNumber_Negative(__pyx_v_white_castling); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2874, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_And(__pyx_v_white_castling, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2874, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_white_a_side = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2875
 *             # king must be between the rooks.
 *             white_a_side = white_castling & -white_castling
 *             white_h_side = BB_SQUARES[msb(white_castling)] if white_castling else 0             # <<<<<<<<<<<<<<
 * 
 *             if white_a_side and msb(white_a_side) > msb(white_king_mask):
 */
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_white_castling); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2875, __pyx_L1_error)
    if (__pyx_t_1) {
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2875, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_msb); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2875, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_v_white_castling) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_white_castling);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2875, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2875, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_2 = __pyx_t_6;
      __pyx_t_6 = 0;
    } else {
      __Pyx_INCREF(__pyx_int_0);
      __pyx_t_2 = __pyx_int_0;
    }
    __pyx_v_white_h_side = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":2877
 *             white_h_side = BB_SQUARES[msb(white_castling)] if white_castling else 0
 * 
 *             if white_a_side and msb(white_a_side) > msb(white_king_mask):             # <<<<<<<<<<<<<<
 *                 white_a_side = 0
 *             if white_h_side and msb(white_h_side) < msb(white_king_mask):
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_white_a_side); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2877, __pyx_L1_error)
    if (__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L10_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_msb); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_v_white_a_side) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_white_a_side);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_white_king_mask) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_white_king_mask);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, __pyx_t_6, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2877, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2877, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __pyx_t_5;
    __pyx_L10_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2878
 * 
 *             if white_a_side and msb(white_a_side) > msb(white_king_mask):
 *                 white_a_side = 0             # <<<<<<<<<<<<<<
 *             if white_h_side and msb(white_h_side) < msb(white_king_mask):
 *                 white_h_side = 0
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_white_a_side, __pyx_int_0);

      /* "chess/__init__cp.pyx":2877
 *             white_h_side = BB_SQUARES[msb(white_castling)] if white_castling else 0
 * 
 *             if white_a_side and msb(white_a_side) > msb(white_king_mask):             # <<<<<<<<<<<<<<
 *                 white_a_side = 0
 *             if white_h_side and msb(white_h_side) < msb(white_king_mask):
 */
    }

    /* "chess/__init__cp.pyx":2879
 *             if white_a_side and msb(white_a_side) > msb(white_king_mask):
 *                 white_a_side = 0
 *             if white_h_side and msb(white_h_side) < msb(white_king_mask):             # <<<<<<<<<<<<<<
 *                 white_h_side = 0
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_white_h_side); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2879, __pyx_L1_error)
    if (__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L13_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_msb); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_v_white_h_side) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_white_h_side);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_msb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_white_king_mask) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_white_king_mask);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_t_6, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2879, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2879, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = __pyx_t_5;
    __pyx_L13_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2880
 *                 white_a_side = 0
 *             if white_h_side and msb(white_h_side) < msb(white_king_mask):
 *                 white_h_side = 0             # <<<<<<<<<<<<<<
 * 
 *             black_a_side = (black_castling & -black_castling)
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_white_h_side, __pyx_int_0);

      /* "chess/__init__cp.pyx":2879
 *             if white_a_side and msb(white_a_side) > msb(white_king_mask):
 *                 white_a_side = 0
 *             if white_h_side and msb(white_h_side) < msb(white_king_mask):             # <<<<<<<<<<<<<<
 *                 white_h_side = 0
 * 
 */
    }

    /* "chess/__init__cp.pyx":2882
 *                 white_h_side = 0
 * 
 *             black_a_side = (black_castling & -black_castling)             # <<<<<<<<<<<<<<
 *             black_h_side = BB_SQUARES[msb(black_castling)] if black_castling else BB_EMPTY
 * 
 */
    __pyx_t_2 = PyNumber_Negative(__pyx_v_black_castling); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2882, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = PyNumber_And(__pyx_v_black_castling, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2882, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_black_a_side = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2883
 * 
 *             black_a_side = (black_castling & -black_castling)
 *             black_h_side = BB_SQUARES[msb(black_castling)] if black_castling else BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *             if black_a_side and msb(black_a_side) > msb(black_king_mask):
 */
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_black_castling); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2883, __pyx_L1_error)
    if (__pyx_t_1) {
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2883, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_msb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2883, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_v_black_castling) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_black_castling);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2883, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2883, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_6 = __pyx_t_4;
      __pyx_t_4 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_EMPTY); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2883, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = __pyx_t_4;
      __pyx_t_4 = 0;
    }
    __pyx_v_black_h_side = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":2885
 *             black_h_side = BB_SQUARES[msb(black_castling)] if black_castling else BB_EMPTY
 * 
 *             if black_a_side and msb(black_a_side) > msb(black_king_mask):             # <<<<<<<<<<<<<<
 *                 black_a_side = 0
 *             if black_h_side and msb(black_h_side) < msb(black_king_mask):
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_black_a_side); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2885, __pyx_L1_error)
    if (__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L16_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_msb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2885, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_black_a_side) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_black_a_side);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2885, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2885, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_black_king_mask) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_black_king_mask);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2885, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2885, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2885, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __pyx_t_5;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2886
 * 
 *             if black_a_side and msb(black_a_side) > msb(black_king_mask):
 *                 black_a_side = 0             # <<<<<<<<<<<<<<
 *             if black_h_side and msb(black_h_side) < msb(black_king_mask):
 *                 black_h_side = 0
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_black_a_side, __pyx_int_0);

      /* "chess/__init__cp.pyx":2885
 *             black_h_side = BB_SQUARES[msb(black_castling)] if black_castling else BB_EMPTY
 * 
 *             if black_a_side and msb(black_a_side) > msb(black_king_mask):             # <<<<<<<<<<<<<<
 *                 black_a_side = 0
 *             if black_h_side and msb(black_h_side) < msb(black_king_mask):
 */
    }

    /* "chess/__init__cp.pyx":2887
 *             if black_a_side and msb(black_a_side) > msb(black_king_mask):
 *                 black_a_side = 0
 *             if black_h_side and msb(black_h_side) < msb(black_king_mask):             # <<<<<<<<<<<<<<
 *                 black_h_side = 0
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_black_h_side); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2887, __pyx_L1_error)
    if (__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L19_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_msb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_v_black_h_side) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_black_h_side);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_msb); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_v_black_king_mask) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_black_king_mask);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2887, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2887, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_1 = __pyx_t_5;
    __pyx_L19_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":2888
 *                 black_a_side = 0
 *             if black_h_side and msb(black_h_side) < msb(black_king_mask):
 *                 black_h_side = 0             # <<<<<<<<<<<<<<
 * 
 *             # Done.
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_black_h_side, __pyx_int_0);

      /* "chess/__init__cp.pyx":2887
 *             if black_a_side and msb(black_a_side) > msb(black_king_mask):
 *                 black_a_side = 0
 *             if black_h_side and msb(black_h_side) < msb(black_king_mask):             # <<<<<<<<<<<<<<
 *                 black_h_side = 0
 * 
 */
    }

    /* "chess/__init__cp.pyx":2891
 * 
 *             # Done.
 *             return black_a_side | black_h_side | white_a_side | white_h_side             # <<<<<<<<<<<<<<
 * 
 *     def has_castling_rights(self, color):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = PyNumber_Or(__pyx_v_black_a_side, __pyx_v_black_h_side); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2891, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = PyNumber_Or(__pyx_t_6, __pyx_v_white_a_side); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2891, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_Or(__pyx_t_4, __pyx_v_white_h_side); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2891, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":2837
 *         return self.is_castling(move) and square_file(move.to_square) < square_file(move.from_square)
 * 
 *     def clean_castling_rights(self):             # <<<<<<<<<<<<<<
 *         """
 *         Returns valid castling rights filtered from
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.clean_castling_rights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_white_castling);
  __Pyx_XDECREF(__pyx_v_black_castling);
  __Pyx_XDECREF(__pyx_v_white_king_mask);
  __Pyx_XDECREF(__pyx_v_black_king_mask);
  __Pyx_XDECREF(__pyx_v_white_a_side);
  __Pyx_XDECREF(__pyx_v_white_h_side);
  __Pyx_XDECREF(__pyx_v_black_a_side);
  __Pyx_XDECREF(__pyx_v_black_h_side);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2893
 *             return black_a_side | black_h_side | white_a_side | white_h_side
 * 
 *     def has_castling_rights(self, color):             # <<<<<<<<<<<<<<
 *         """Checks if the given side has castling rights."""
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_141has_castling_rights(PyObject *__pyx_v_self, PyObject *__pyx_v_color); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_140has_castling_rights[] = "Checks if the given side has castling rights.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_141has_castling_rights(PyObject *__pyx_v_self, PyObject *__pyx_v_color) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_castling_rights (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_140has_castling_rights(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_color));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_140has_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_color) {
  PyObject *__pyx_v_backrank = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("has_castling_rights", 0);

  /* "chess/__init__cp.pyx":2895
 *     def has_castling_rights(self, color):
 *         """Checks if the given side has castling rights."""
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 *         return bool(self.clean_castling_rights() & backrank)
 * 
 */
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_color, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2895, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2895, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2895, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2895, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_v_backrank = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2896
 *         """Checks if the given side has castling rights."""
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         return bool(self.clean_castling_rights() & backrank)             # <<<<<<<<<<<<<<
 * 
 *     def has_kingside_castling_rights(self, bint color):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!(!__pyx_t_3))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2893
 *             return black_a_side | black_h_side | white_a_side | white_h_side
 * 
 *     def has_castling_rights(self, color):             # <<<<<<<<<<<<<<
 *         """Checks if the given side has castling rights."""
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.has_castling_rights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_backrank);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2898
 *         return bool(self.clean_castling_rights() & backrank)
 * 
 *     def has_kingside_castling_rights(self, bint color):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given side has kingside (that is h-side in Chess960)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_143has_kingside_castling_rights(PyObject *__pyx_v_self, PyObject *__pyx_arg_color); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_142has_kingside_castling_rights[] = "\n        Checks if the given side has kingside (that is h-side in Chess960)\n        castling rights.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_143has_kingside_castling_rights(PyObject *__pyx_v_self, PyObject *__pyx_arg_color) {
  int __pyx_v_color;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_kingside_castling_rights (wrapper)", 0);
  assert(__pyx_arg_color); {
    __pyx_v_color = __Pyx_PyObject_IsTrue(__pyx_arg_color); if (unlikely((__pyx_v_color == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 2898, __pyx_L3_error)
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.has_kingside_castling_rights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_142has_kingside_castling_rights(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((int)__pyx_v_color));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_142has_kingside_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, int __pyx_v_color) {
  PyObject *__pyx_v_backrank = NULL;
  PyObject *__pyx_v_king_mask = NULL;
  PyObject *__pyx_v_castling_rights = NULL;
  PyObject *__pyx_v_rook = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("has_kingside_castling_rights", 0);

  /* "chess/__init__cp.pyx":2903
 *         castling rights.
 *         """
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:
 */
  if (((__pyx_v_color == 1) != 0)) {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2903, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2903, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_v_backrank = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2904
 *         """
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted             # <<<<<<<<<<<<<<
 *         if not king_mask:
 *             return False
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.kings & (__pyx_v_self->__pyx_base.occupied_co[__pyx_v_color]))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2904, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2904, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_int((~__pyx_v_self->__pyx_base.promoted)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2904, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2904, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_king_mask = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":2905
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_king_mask); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 2905, __pyx_L1_error)
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "chess/__init__cp.pyx":2906
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         castling_rights = self.clean_castling_rights() & backrank
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2905
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":2908
 *             return False
 * 
 *         castling_rights = self.clean_castling_rights() & backrank             # <<<<<<<<<<<<<<
 *         while castling_rights:
 *             rook = castling_rights & -castling_rights
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2908, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2908, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_3, __pyx_v_backrank); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2908, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_castling_rights = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2909
 * 
 *         castling_rights = self.clean_castling_rights() & backrank
 *         while castling_rights:             # <<<<<<<<<<<<<<
 *             rook = castling_rights & -castling_rights
 * 
 */
  while (1) {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_castling_rights); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2909, __pyx_L1_error)
    if (!__pyx_t_5) break;

    /* "chess/__init__cp.pyx":2910
 *         castling_rights = self.clean_castling_rights() & backrank
 *         while castling_rights:
 *             rook = castling_rights & -castling_rights             # <<<<<<<<<<<<<<
 * 
 *             if rook > king_mask:
 */
    __pyx_t_1 = PyNumber_Negative(__pyx_v_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2910, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2910, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_rook, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2912
 *             rook = castling_rights & -castling_rights
 * 
 *             if rook > king_mask:             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_rook, __pyx_v_king_mask, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2912, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2912, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {

      /* "chess/__init__cp.pyx":2913
 * 
 *             if rook > king_mask:
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *             castling_rights = castling_rights & (castling_rights - 1)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2912
 *             rook = castling_rights & -castling_rights
 * 
 *             if rook > king_mask:             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    }

    /* "chess/__init__cp.pyx":2915
 *                 return True
 * 
 *             castling_rights = castling_rights & (castling_rights - 1)             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
    __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_v_castling_rights, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2915, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2915, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_castling_rights, __pyx_t_1);
    __pyx_t_1 = 0;
  }

  /* "chess/__init__cp.pyx":2917
 *             castling_rights = castling_rights & (castling_rights - 1)
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def has_queenside_castling_rights(self, color):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2898
 *         return bool(self.clean_castling_rights() & backrank)
 * 
 *     def has_kingside_castling_rights(self, bint color):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given side has kingside (that is h-side in Chess960)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.has_kingside_castling_rights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_backrank);
  __Pyx_XDECREF(__pyx_v_king_mask);
  __Pyx_XDECREF(__pyx_v_castling_rights);
  __Pyx_XDECREF(__pyx_v_rook);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2919
 *         return False
 * 
 *     def has_queenside_castling_rights(self, color):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given side has queenside (that is a-side in Chess960)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_145has_queenside_castling_rights(PyObject *__pyx_v_self, PyObject *__pyx_v_color); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_144has_queenside_castling_rights[] = "\n        Checks if the given side has queenside (that is a-side in Chess960)\n        castling rights.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_145has_queenside_castling_rights(PyObject *__pyx_v_self, PyObject *__pyx_v_color) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_queenside_castling_rights (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_144has_queenside_castling_rights(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_color));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_144has_queenside_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_color) {
  PyObject *__pyx_v_backrank = NULL;
  PyObject *__pyx_v_king_mask = NULL;
  PyObject *__pyx_v_castling_rights = NULL;
  PyObject *__pyx_v_rook = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("has_queenside_castling_rights", 0);

  /* "chess/__init__cp.pyx":2924
 *         castling rights.
 *         """
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:
 */
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_color, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2924, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2924, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2924, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2924, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_v_backrank = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2925
 *         """
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted             # <<<<<<<<<<<<<<
 *         if not king_mask:
 *             return False
 */
  __pyx_t_4 = __Pyx_PyIndex_AsSsize_t(__pyx_v_color); if (unlikely((__pyx_t_4 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2925, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.kings & (__pyx_v_self->__pyx_base.occupied_co[__pyx_t_4]))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2925, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2925, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_int((~__pyx_v_self->__pyx_base.promoted)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2925, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2925, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_king_mask = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "chess/__init__cp.pyx":2926
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_king_mask); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 2926, __pyx_L1_error)
  __pyx_t_6 = ((!__pyx_t_3) != 0);
  if (__pyx_t_6) {

    /* "chess/__init__cp.pyx":2927
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *         castling_rights = self.clean_castling_rights() & backrank
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2926
 *         backrank = BB_RANK_1 if color == WHITE else BB_RANK_8
 *         king_mask = self.kings & self.occupied_co[color] & backrank & ~self.promoted
 *         if not king_mask:             # <<<<<<<<<<<<<<
 *             return False
 * 
 */
  }

  /* "chess/__init__cp.pyx":2929
 *             return False
 * 
 *         castling_rights = self.clean_castling_rights() & backrank             # <<<<<<<<<<<<<<
 *         while castling_rights:
 *             rook = castling_rights & -castling_rights
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2929, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2929, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_5, __pyx_v_backrank); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2929, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_castling_rights = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2930
 * 
 *         castling_rights = self.clean_castling_rights() & backrank
 *         while castling_rights:             # <<<<<<<<<<<<<<
 *             rook = castling_rights & -castling_rights
 * 
 */
  while (1) {
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_castling_rights); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2930, __pyx_L1_error)
    if (!__pyx_t_6) break;

    /* "chess/__init__cp.pyx":2931
 *         castling_rights = self.clean_castling_rights() & backrank
 *         while castling_rights:
 *             rook = castling_rights & -castling_rights             # <<<<<<<<<<<<<<
 * 
 *             if rook < king_mask:
 */
    __pyx_t_1 = PyNumber_Negative(__pyx_v_castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2931, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2931, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_rook, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":2933
 *             rook = castling_rights & -castling_rights
 * 
 *             if rook < king_mask:             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_rook, __pyx_v_king_mask, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2933, __pyx_L1_error)
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2933, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":2934
 * 
 *             if rook < king_mask:
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *             castling_rights = castling_rights & (castling_rights - 1)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":2933
 *             rook = castling_rights & -castling_rights
 * 
 *             if rook < king_mask:             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
    }

    /* "chess/__init__cp.pyx":2936
 *                 return True
 * 
 *             castling_rights = castling_rights & (castling_rights - 1)             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
    __pyx_t_5 = __Pyx_PyInt_SubtractObjC(__pyx_v_castling_rights, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2936, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2936, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_castling_rights, __pyx_t_1);
    __pyx_t_1 = 0;
  }

  /* "chess/__init__cp.pyx":2938
 *             castling_rights = castling_rights & (castling_rights - 1)
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def has_chess960_castling_rights(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2919
 *         return False
 * 
 *     def has_queenside_castling_rights(self, color):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the given side has queenside (that is a-side in Chess960)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.has_queenside_castling_rights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_backrank);
  __Pyx_XDECREF(__pyx_v_king_mask);
  __Pyx_XDECREF(__pyx_v_castling_rights);
  __Pyx_XDECREF(__pyx_v_rook);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2940
 *         return False
 * 
 *     def has_chess960_castling_rights(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if there are castling rights that are only possible in Chess960.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_147has_chess960_castling_rights(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_146has_chess960_castling_rights[] = "\n        Checks if there are castling rights that are only possible in Chess960.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_147has_chess960_castling_rights(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_chess960_castling_rights (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_146has_chess960_castling_rights(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_146has_chess960_castling_rights(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  int __pyx_v_chess960;
  PyObject *__pyx_v_castling_rights = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("has_chess960_castling_rights", 0);

  /* "chess/__init__cp.pyx":2945
 *         """
 *         # Get valid Chess960 castling rights.
 *         chess960 = self.chess960             # <<<<<<<<<<<<<<
 *         self.chess960 = True
 *         castling_rights = self.clean_castling_rights()
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base.chess960;
  __pyx_v_chess960 = __pyx_t_1;

  /* "chess/__init__cp.pyx":2946
 *         # Get valid Chess960 castling rights.
 *         chess960 = self.chess960
 *         self.chess960 = True             # <<<<<<<<<<<<<<
 *         castling_rights = self.clean_castling_rights()
 *         self.chess960 = chess960
 */
  __pyx_v_self->__pyx_base.chess960 = 1;

  /* "chess/__init__cp.pyx":2947
 *         chess960 = self.chess960
 *         self.chess960 = True
 *         castling_rights = self.clean_castling_rights()             # <<<<<<<<<<<<<<
 *         self.chess960 = chess960
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_castling_rights = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":2948
 *         self.chess960 = True
 *         castling_rights = self.clean_castling_rights()
 *         self.chess960 = chess960             # <<<<<<<<<<<<<<
 * 
 *         # Standard chess castling rights can only be on the standard
 */
  __pyx_v_self->__pyx_base.chess960 = __pyx_v_chess960;

  /* "chess/__init__cp.pyx":2952
 *         # Standard chess castling rights can only be on the standard
 *         # starting rook squares.
 *         if castling_rights & ~BB_CORNERS:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_CORNERS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2952, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2952, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2952, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2952, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2953
 *         # starting rook squares.
 *         if castling_rights & ~BB_CORNERS:
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # If there are any castling rights in standard chess, the king must be
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2952
 *         # Standard chess castling rights can only be on the standard
 *         # starting rook squares.
 *         if castling_rights & ~BB_CORNERS:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":2957
 *         # If there are any castling rights in standard chess, the king must be
 *         # on e1 or e8.
 *         if castling_rights & BB_RANK_1 and not self.occupied_co[WHITE] & self.kings & BB_E1:             # <<<<<<<<<<<<<<
 *             return True
 *         if castling_rights & BB_RANK_8 and not self.occupied_co[BLACK] & self.kings & BB_E8:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {
  } else {
    __pyx_t_1 = __pyx_t_5;
    goto __pyx_L5_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[1]) & __pyx_v_self->__pyx_base.kings)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_E1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 2957, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = ((!__pyx_t_5) != 0);
  __pyx_t_1 = __pyx_t_6;
  __pyx_L5_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2958
 *         # on e1 or e8.
 *         if castling_rights & BB_RANK_1 and not self.occupied_co[WHITE] & self.kings & BB_E1:
 *             return True             # <<<<<<<<<<<<<<
 *         if castling_rights & BB_RANK_8 and not self.occupied_co[BLACK] & self.kings & BB_E8:
 *             return True
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2957
 *         # If there are any castling rights in standard chess, the king must be
 *         # on e1 or e8.
 *         if castling_rights & BB_RANK_1 and not self.occupied_co[WHITE] & self.kings & BB_E1:             # <<<<<<<<<<<<<<
 *             return True
 *         if castling_rights & BB_RANK_8 and not self.occupied_co[BLACK] & self.kings & BB_E8:
 */
  }

  /* "chess/__init__cp.pyx":2959
 *         if castling_rights & BB_RANK_1 and not self.occupied_co[WHITE] & self.kings & BB_E1:
 *             return True
 *         if castling_rights & BB_RANK_8 and not self.occupied_co[BLACK] & self.kings & BB_E8:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyNumber_And(__pyx_v_castling_rights, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_6) {
  } else {
    __pyx_t_1 = __pyx_t_6;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[0]) & __pyx_v_self->__pyx_base.kings)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_E8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 2959, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = ((!__pyx_t_6) != 0);
  __pyx_t_1 = __pyx_t_5;
  __pyx_L8_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":2960
 *             return True
 *         if castling_rights & BB_RANK_8 and not self.occupied_co[BLACK] & self.kings & BB_E8:
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":2959
 *         if castling_rights & BB_RANK_1 and not self.occupied_co[WHITE] & self.kings & BB_E1:
 *             return True
 *         if castling_rights & BB_RANK_8 and not self.occupied_co[BLACK] & self.kings & BB_E8:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":2962
 *             return True
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def status(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2940
 *         return False
 * 
 *     def has_chess960_castling_rights(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if there are castling rights that are only possible in Chess960.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board.has_chess960_castling_rights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_castling_rights);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":2964
 *         return False
 * 
 *     def status(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a bitmask of possible problems with the position.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_149status(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_148status[] = "\n        Gets a bitmask of possible problems with the position.\n\n        Move making, generation and validation are only guaranteed to work on\n        a completely valid board.\n\n        :data:`~chess.STATUS_VALID` for a completely valid board.\n\n        Otherwise, bitwise combinations of:\n        :data:`~chess.STATUS_NO_WHITE_KING`,\n        :data:`~chess.STATUS_NO_BLACK_KING`,\n        :data:`~chess.STATUS_TOO_MANY_KINGS`,\n        :data:`~chess.STATUS_TOO_MANY_WHITE_PAWNS`,\n        :data:`~chess.STATUS_TOO_MANY_BLACK_PAWNS`,\n        :data:`~chess.STATUS_PAWNS_ON_BACKRANK`,\n        :data:`~chess.STATUS_TOO_MANY_WHITE_PIECES`,\n        :data:`~chess.STATUS_TOO_MANY_BLACK_PIECES`,\n        :data:`~chess.STATUS_BAD_CASTLING_RIGHTS`,\n        :data:`~chess.STATUS_INVALID_EP_SQUARE`,\n        :data:`~chess.STATUS_OPPOSITE_CHECK`,\n        :data:`~chess.STATUS_EMPTY`,\n        :data:`~chess.STATUS_RACE_CHECK`,\n        :data:`~chess.STATUS_RACE_OVER`,\n        :data:`~chess.STATUS_RACE_MATERIAL`.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_149status(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("status (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_148status(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_148status(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_errors = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("status", 0);

  /* "chess/__init__cp.pyx":2990
 *         :data:`~chess.STATUS_RACE_MATERIAL`.
 *         """
 *         errors = STATUS_VALID             # <<<<<<<<<<<<<<
 * 
 *         # There must be at least one piece.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_VALID); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_errors = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":2993
 * 
 *         # There must be at least one piece.
 *         if not self.occupied:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_EMPTY
 * 
 */
  __pyx_t_2 = ((!(__pyx_v_self->__pyx_base.occupied != 0)) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2994
 *         # There must be at least one piece.
 *         if not self.occupied:
 *             errors |= STATUS_EMPTY             # <<<<<<<<<<<<<<
 * 
 *         # There must be exactly one king of each color.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_EMPTY); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2994, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2994, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2993
 * 
 *         # There must be at least one piece.
 *         if not self.occupied:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_EMPTY
 * 
 */
  }

  /* "chess/__init__cp.pyx":2997
 * 
 *         # There must be exactly one king of each color.
 *         if not self.occupied_co[WHITE] & self.kings:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_NO_WHITE_KING
 *         if not self.occupied_co[BLACK] & self.kings:
 */
  __pyx_t_2 = ((!(((__pyx_v_self->__pyx_base.occupied_co[1]) & __pyx_v_self->__pyx_base.kings) != 0)) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":2998
 *         # There must be exactly one king of each color.
 *         if not self.occupied_co[WHITE] & self.kings:
 *             errors |= STATUS_NO_WHITE_KING             # <<<<<<<<<<<<<<
 *         if not self.occupied_co[BLACK] & self.kings:
 *             errors |= STATUS_NO_BLACK_KING
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_STATUS_NO_WHITE_KING); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2998, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2998, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":2997
 * 
 *         # There must be exactly one king of each color.
 *         if not self.occupied_co[WHITE] & self.kings:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_NO_WHITE_KING
 *         if not self.occupied_co[BLACK] & self.kings:
 */
  }

  /* "chess/__init__cp.pyx":2999
 *         if not self.occupied_co[WHITE] & self.kings:
 *             errors |= STATUS_NO_WHITE_KING
 *         if not self.occupied_co[BLACK] & self.kings:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_NO_BLACK_KING
 *         if popcount(self.occupied & self.kings) > 2:
 */
  __pyx_t_2 = ((!(((__pyx_v_self->__pyx_base.occupied_co[0]) & __pyx_v_self->__pyx_base.kings) != 0)) != 0);
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3000
 *             errors |= STATUS_NO_WHITE_KING
 *         if not self.occupied_co[BLACK] & self.kings:
 *             errors |= STATUS_NO_BLACK_KING             # <<<<<<<<<<<<<<
 *         if popcount(self.occupied & self.kings) > 2:
 *             errors |= STATUS_TOO_MANY_KINGS
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_NO_BLACK_KING); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3000, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3000, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":2999
 *         if not self.occupied_co[WHITE] & self.kings:
 *             errors |= STATUS_NO_WHITE_KING
 *         if not self.occupied_co[BLACK] & self.kings:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_NO_BLACK_KING
 *         if popcount(self.occupied & self.kings) > 2:
 */
  }

  /* "chess/__init__cp.pyx":3001
 *         if not self.occupied_co[BLACK] & self.kings:
 *             errors |= STATUS_NO_BLACK_KING
 *         if popcount(self.occupied & self.kings) > 2:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_KINGS
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_popcount); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3001, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied & __pyx_v_self->__pyx_base.kings)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3001, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3001, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_2, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3001, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3001, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3002
 *             errors |= STATUS_NO_BLACK_KING
 *         if popcount(self.occupied & self.kings) > 2:
 *             errors |= STATUS_TOO_MANY_KINGS             # <<<<<<<<<<<<<<
 * 
 *         # There can not be more than 16 pieces of any color.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_TOO_MANY_KINGS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3002, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3002, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3001
 *         if not self.occupied_co[BLACK] & self.kings:
 *             errors |= STATUS_NO_BLACK_KING
 *         if popcount(self.occupied & self.kings) > 2:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_KINGS
 * 
 */
  }

  /* "chess/__init__cp.pyx":3005
 * 
 *         # There can not be more than 16 pieces of any color.
 *         if popcount(self.occupied_co[WHITE]) > 16:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_WHITE_PIECES
 *         if popcount(self.occupied_co[BLACK]) > 16:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_popcount); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3005, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[1])); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3005, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3005, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_16, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3005, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3005, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3006
 *         # There can not be more than 16 pieces of any color.
 *         if popcount(self.occupied_co[WHITE]) > 16:
 *             errors |= STATUS_TOO_MANY_WHITE_PIECES             # <<<<<<<<<<<<<<
 *         if popcount(self.occupied_co[BLACK]) > 16:
 *             errors |= STATUS_TOO_MANY_BLACK_PIECES
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_TOO_MANY_WHITE_PIECES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3006, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3006, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3005
 * 
 *         # There can not be more than 16 pieces of any color.
 *         if popcount(self.occupied_co[WHITE]) > 16:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_WHITE_PIECES
 *         if popcount(self.occupied_co[BLACK]) > 16:
 */
  }

  /* "chess/__init__cp.pyx":3007
 *         if popcount(self.occupied_co[WHITE]) > 16:
 *             errors |= STATUS_TOO_MANY_WHITE_PIECES
 *         if popcount(self.occupied_co[BLACK]) > 16:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_BLACK_PIECES
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_popcount); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3007, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[0])); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3007, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3007, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_16, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3007, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3007, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3008
 *             errors |= STATUS_TOO_MANY_WHITE_PIECES
 *         if popcount(self.occupied_co[BLACK]) > 16:
 *             errors |= STATUS_TOO_MANY_BLACK_PIECES             # <<<<<<<<<<<<<<
 * 
 *         # There can not be more than 8 pawns of any color.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_TOO_MANY_BLACK_PIECES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3008, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3008, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3007
 *         if popcount(self.occupied_co[WHITE]) > 16:
 *             errors |= STATUS_TOO_MANY_WHITE_PIECES
 *         if popcount(self.occupied_co[BLACK]) > 16:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_BLACK_PIECES
 * 
 */
  }

  /* "chess/__init__cp.pyx":3011
 * 
 *         # There can not be more than 8 pawns of any color.
 *         if popcount(self.occupied_co[WHITE] & self.pawns) > 8:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_WHITE_PAWNS
 *         if popcount(self.occupied_co[BLACK] & self.pawns) > 8:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_popcount); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3011, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[1]) & __pyx_v_self->__pyx_base.pawns)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3011, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3011, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_8, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3011, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3011, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3012
 *         # There can not be more than 8 pawns of any color.
 *         if popcount(self.occupied_co[WHITE] & self.pawns) > 8:
 *             errors |= STATUS_TOO_MANY_WHITE_PAWNS             # <<<<<<<<<<<<<<
 *         if popcount(self.occupied_co[BLACK] & self.pawns) > 8:
 *             errors |= STATUS_TOO_MANY_BLACK_PAWNS
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_TOO_MANY_WHITE_PAWNS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3012, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3012, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3011
 * 
 *         # There can not be more than 8 pawns of any color.
 *         if popcount(self.occupied_co[WHITE] & self.pawns) > 8:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_WHITE_PAWNS
 *         if popcount(self.occupied_co[BLACK] & self.pawns) > 8:
 */
  }

  /* "chess/__init__cp.pyx":3013
 *         if popcount(self.occupied_co[WHITE] & self.pawns) > 8:
 *             errors |= STATUS_TOO_MANY_WHITE_PAWNS
 *         if popcount(self.occupied_co[BLACK] & self.pawns) > 8:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_BLACK_PAWNS
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_popcount); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3013, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_v_self->__pyx_base.occupied_co[0]) & __pyx_v_self->__pyx_base.pawns)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3013, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3013, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_8, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3013, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3013, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3014
 *             errors |= STATUS_TOO_MANY_WHITE_PAWNS
 *         if popcount(self.occupied_co[BLACK] & self.pawns) > 8:
 *             errors |= STATUS_TOO_MANY_BLACK_PAWNS             # <<<<<<<<<<<<<<
 * 
 *         # Pawns can not be on the back rank.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STATUS_TOO_MANY_BLACK_PAWNS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3014, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3014, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3013
 *         if popcount(self.occupied_co[WHITE] & self.pawns) > 8:
 *             errors |= STATUS_TOO_MANY_WHITE_PAWNS
 *         if popcount(self.occupied_co[BLACK] & self.pawns) > 8:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_TOO_MANY_BLACK_PAWNS
 * 
 */
  }

  /* "chess/__init__cp.pyx":3017
 * 
 *         # Pawns can not be on the back rank.
 *         if self.pawns & BB_BACKRANKS:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_PAWNS_ON_BACKRANK
 * 
 */
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.pawns); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3017, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_BACKRANKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3017, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3017, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3017, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3018
 *         # Pawns can not be on the back rank.
 *         if self.pawns & BB_BACKRANKS:
 *             errors |= STATUS_PAWNS_ON_BACKRANK             # <<<<<<<<<<<<<<
 * 
 *         # Castling rights.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_STATUS_PAWNS_ON_BACKRANK); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3018, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3018, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3017
 * 
 *         # Pawns can not be on the back rank.
 *         if self.pawns & BB_BACKRANKS:             # <<<<<<<<<<<<<<
 *             errors |= STATUS_PAWNS_ON_BACKRANK
 * 
 */
  }

  /* "chess/__init__cp.pyx":3021
 * 
 *         # Castling rights.
 *         if self.castling_rights != self.clean_castling_rights():             # <<<<<<<<<<<<<<
 *             errors |= STATUS_BAD_CASTLING_RIGHTS
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3021, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3021, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3021, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3021, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3021, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3022
 *         # Castling rights.
 *         if self.castling_rights != self.clean_castling_rights():
 *             errors |= STATUS_BAD_CASTLING_RIGHTS             # <<<<<<<<<<<<<<
 * 
 *         # En passant.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_STATUS_BAD_CASTLING_RIGHTS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3022, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3022, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":3021
 * 
 *         # Castling rights.
 *         if self.castling_rights != self.clean_castling_rights():             # <<<<<<<<<<<<<<
 *             errors |= STATUS_BAD_CASTLING_RIGHTS
 * 
 */
  }

  /* "chess/__init__cp.pyx":3025
 * 
 *         # En passant.
 *         if self.ep_square != self._valid_ep_square():             # <<<<<<<<<<<<<<
 *             errors |= STATUS_INVALID_EP_SQUARE
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_valid_ep_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3025, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3025, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_v_self->__pyx_base.ep_square, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3025, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3025, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3026
 *         # En passant.
 *         if self.ep_square != self._valid_ep_square():
 *             errors |= STATUS_INVALID_EP_SQUARE             # <<<<<<<<<<<<<<
 * 
 *         # Side to move giving check.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_STATUS_INVALID_EP_SQUARE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3026, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3026, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":3025
 * 
 *         # En passant.
 *         if self.ep_square != self._valid_ep_square():             # <<<<<<<<<<<<<<
 *             errors |= STATUS_INVALID_EP_SQUARE
 * 
 */
  }

  /* "chess/__init__cp.pyx":3029
 * 
 *         # Side to move giving check.
 *         if self.was_into_check():             # <<<<<<<<<<<<<<
 *             errors |= STATUS_OPPOSITE_CHECK
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_was_into_check); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3029, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3029, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3029, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_2) {

    /* "chess/__init__cp.pyx":3030
 *         # Side to move giving check.
 *         if self.was_into_check():
 *             errors |= STATUS_OPPOSITE_CHECK             # <<<<<<<<<<<<<<
 * 
 *         return errors
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_STATUS_OPPOSITE_CHECK); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3030, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_errors, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3030, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_errors, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3029
 * 
 *         # Side to move giving check.
 *         if self.was_into_check():             # <<<<<<<<<<<<<<
 *             errors |= STATUS_OPPOSITE_CHECK
 * 
 */
  }

  /* "chess/__init__cp.pyx":3032
 *             errors |= STATUS_OPPOSITE_CHECK
 * 
 *         return errors             # <<<<<<<<<<<<<<
 * 
 *     def _valid_ep_square(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_errors);
  __pyx_r = __pyx_v_errors;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":2964
 *         return False
 * 
 *     def status(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a bitmask of possible problems with the position.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board.status", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_errors);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3034
 *         return errors
 * 
 *     def _valid_ep_square(self):             # <<<<<<<<<<<<<<
 *         if self.ep_square:
 *             if self.turn == WHITE:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_151_valid_ep_square(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_151_valid_ep_square(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_valid_ep_square (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_150_valid_ep_square(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_150_valid_ep_square(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  long __pyx_v_ep_rank;
  PyObject *__pyx_v_pawn_mask = NULL;
  PyObject *__pyx_v_seventh_rank_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("_valid_ep_square", 0);

  /* "chess/__init__cp.pyx":3035
 * 
 *     def _valid_ep_square(self):
 *         if self.ep_square:             # <<<<<<<<<<<<<<
 *             if self.turn == WHITE:
 *                 ep_rank = 5
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3035, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":3036
 *     def _valid_ep_square(self):
 *         if self.ep_square:
 *             if self.turn == WHITE:             # <<<<<<<<<<<<<<
 *                 ep_rank = 5
 *                 pawn_mask = shift_down(BB_SQUARES[self.ep_square])
 */
    __pyx_t_1 = ((__pyx_v_self->__pyx_base.turn == 1) != 0);
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3037
 *         if self.ep_square:
 *             if self.turn == WHITE:
 *                 ep_rank = 5             # <<<<<<<<<<<<<<
 *                 pawn_mask = shift_down(BB_SQUARES[self.ep_square])
 *                 seventh_rank_mask = shift_up(BB_SQUARES[self.ep_square])
 */
      __pyx_v_ep_rank = 5;

      /* "chess/__init__cp.pyx":3038
 *             if self.turn == WHITE:
 *                 ep_rank = 5
 *                 pawn_mask = shift_down(BB_SQUARES[self.ep_square])             # <<<<<<<<<<<<<<
 *                 seventh_rank_mask = shift_up(BB_SQUARES[self.ep_square])
 *             else:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_shift_down); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3038, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3038, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3038, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3038, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_v_pawn_mask = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":3039
 *                 ep_rank = 5
 *                 pawn_mask = shift_down(BB_SQUARES[self.ep_square])
 *                 seventh_rank_mask = shift_up(BB_SQUARES[self.ep_square])             # <<<<<<<<<<<<<<
 *             else:
 *                 ep_rank = 2
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_shift_up); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3039, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3039, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3039, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3039, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_v_seventh_rank_mask = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":3036
 *     def _valid_ep_square(self):
 *         if self.ep_square:
 *             if self.turn == WHITE:             # <<<<<<<<<<<<<<
 *                 ep_rank = 5
 *                 pawn_mask = shift_down(BB_SQUARES[self.ep_square])
 */
      goto __pyx_L4;
    }

    /* "chess/__init__cp.pyx":3041
 *                 seventh_rank_mask = shift_up(BB_SQUARES[self.ep_square])
 *             else:
 *                 ep_rank = 2             # <<<<<<<<<<<<<<
 *                 pawn_mask = shift_up(BB_SQUARES[self.ep_square])
 *                 seventh_rank_mask = shift_down(BB_SQUARES[self.ep_square])
 */
    /*else*/ {
      __pyx_v_ep_rank = 2;

      /* "chess/__init__cp.pyx":3042
 *             else:
 *                 ep_rank = 2
 *                 pawn_mask = shift_up(BB_SQUARES[self.ep_square])             # <<<<<<<<<<<<<<
 *                 seventh_rank_mask = shift_down(BB_SQUARES[self.ep_square])
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_shift_up); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3042, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3042, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3042, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3042, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_v_pawn_mask = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":3043
 *                 ep_rank = 2
 *                 pawn_mask = shift_up(BB_SQUARES[self.ep_square])
 *                 seventh_rank_mask = shift_down(BB_SQUARES[self.ep_square])             # <<<<<<<<<<<<<<
 * 
 *             # The en passant square must be on the third or sixth rank.
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_shift_down); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3043, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3043, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3043, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3043, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_v_seventh_rank_mask = __pyx_t_2;
      __pyx_t_2 = 0;
    }
    __pyx_L4:;

    /* "chess/__init__cp.pyx":3046
 * 
 *             # The en passant square must be on the third or sixth rank.
 *             if square_rank(self.ep_square) != ep_rank:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_square_rank); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3046, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_self->__pyx_base.ep_square) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_self->__pyx_base.ep_square);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3046, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyInt_From_long(__pyx_v_ep_rank); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3046, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3046, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3046, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3047
 *             # The en passant square must be on the third or sixth rank.
 *             if square_rank(self.ep_square) != ep_rank:
 *                 return             # <<<<<<<<<<<<<<
 * 
 *             # The last move must have been a double pawn push, so there must
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3046
 * 
 *             # The en passant square must be on the third or sixth rank.
 *             if square_rank(self.ep_square) != ep_rank:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    }

    /* "chess/__init__cp.pyx":3051
 *             # The last move must have been a double pawn push, so there must
 *             # be a pawn of the correct color on the fourth or fifth rank.
 *             if not self.pawns & self.occupied_co[not self.turn] & pawn_mask:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.pawns & (__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))]))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3051, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyNumber_And(__pyx_t_4, __pyx_v_pawn_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3051, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3051, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = ((!__pyx_t_1) != 0);
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":3052
 *             # be a pawn of the correct color on the fourth or fifth rank.
 *             if not self.pawns & self.occupied_co[not self.turn] & pawn_mask:
 *                 return             # <<<<<<<<<<<<<<
 * 
 *             # And the en passant square must be empty.
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3051
 *             # The last move must have been a double pawn push, so there must
 *             # be a pawn of the correct color on the fourth or fifth rank.
 *             if not self.pawns & self.occupied_co[not self.turn] & pawn_mask:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    }

    /* "chess/__init__cp.pyx":3055
 * 
 *             # And the en passant square must be empty.
 *             if self.occupied & BB_SQUARES[self.ep_square]:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3055, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":3056
 *             # And the en passant square must be empty.
 *             if self.occupied & BB_SQUARES[self.ep_square]:
 *                 return             # <<<<<<<<<<<<<<
 * 
 *             # And the second rank must be empty.
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3055
 * 
 *             # And the en passant square must be empty.
 *             if self.occupied & BB_SQUARES[self.ep_square]:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    }

    /* "chess/__init__cp.pyx":3059
 * 
 *             # And the second rank must be empty.
 *             if self.occupied & seventh_rank_mask:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3059, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_v_seventh_rank_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3059, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3059, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":3060
 *             # And the second rank must be empty.
 *             if self.occupied & seventh_rank_mask:
 *                 return             # <<<<<<<<<<<<<<
 * 
 *             return self.ep_square
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3059
 * 
 *             # And the second rank must be empty.
 *             if self.occupied & seventh_rank_mask:             # <<<<<<<<<<<<<<
 *                 return
 * 
 */
    }

    /* "chess/__init__cp.pyx":3062
 *                 return
 * 
 *             return self.ep_square             # <<<<<<<<<<<<<<
 * 
 *     def is_valid(self):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_self->__pyx_base.ep_square);
    __pyx_r = __pyx_v_self->__pyx_base.ep_square;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3035
 * 
 *     def _valid_ep_square(self):
 *         if self.ep_square:             # <<<<<<<<<<<<<<
 *             if self.turn == WHITE:
 *                 ep_rank = 5
 */
  }

  /* "chess/__init__cp.pyx":3034
 *         return errors
 * 
 *     def _valid_ep_square(self):             # <<<<<<<<<<<<<<
 *         if self.ep_square:
 *             if self.turn == WHITE:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.Board._valid_ep_square", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_pawn_mask);
  __Pyx_XDECREF(__pyx_v_seventh_rank_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3064
 *             return self.ep_square
 * 
 *     def is_valid(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the board is valid.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_153is_valid(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_152is_valid[] = "\n        Checks if the board is valid.\n\n        Move making, generation and validation are only guaranteed to work on\n        a completely valid board.\n\n        See :func:`~chess.Board.status()` for details.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_153is_valid(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_valid (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_152is_valid(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_152is_valid(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("is_valid", 0);

  /* "chess/__init__cp.pyx":3073
 *         See :func:`~chess.Board.status()` for details.
 *         """
 *         return self.status() == STATUS_VALID             # <<<<<<<<<<<<<<
 * 
 *     def _ep_skewered(self, king, capturer):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_status); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3073, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3073, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_STATUS_VALID); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3073, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3073, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3064
 *             return self.ep_square
 * 
 *     def is_valid(self):             # <<<<<<<<<<<<<<
 *         """
 *         Checks if the board is valid.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.is_valid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3075
 *         return self.status() == STATUS_VALID
 * 
 *     def _ep_skewered(self, king, capturer):             # <<<<<<<<<<<<<<
 *         # Handle the special case where the king would be in check if the
 *         # pawn and its capturer disappear from the rank.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_155_ep_skewered(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_155_ep_skewered(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_king = 0;
  PyObject *__pyx_v_capturer = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_ep_skewered (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_king,&__pyx_n_s_capturer,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_king)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capturer)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_ep_skewered", 1, 2, 2, 1); __PYX_ERR(0, 3075, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_ep_skewered") < 0)) __PYX_ERR(0, 3075, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_king = values[0];
    __pyx_v_capturer = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_ep_skewered", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3075, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._ep_skewered", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_154_ep_skewered(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_king, __pyx_v_capturer);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_154_ep_skewered(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king, PyObject *__pyx_v_capturer) {
  PyObject *__pyx_v_last_double = NULL;
  PyObject *__pyx_v_occupancy = NULL;
  unsigned PY_LONG_LONG __pyx_v_horizontal_attackers;
  unsigned PY_LONG_LONG __pyx_v_diagonal_attackers;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("_ep_skewered", 0);

  /* "chess/__init__cp.pyx":3082
 *         # the capturer are not handled here.)
 * 
 *         last_double = self.ep_square + (-8 if self.turn == WHITE else 8)             # <<<<<<<<<<<<<<
 * 
 *         occupancy = (self.occupied & ~BB_SQUARES[last_double] &
 */
  if (((__pyx_v_self->__pyx_base.turn == 1) != 0)) {
    __Pyx_INCREF(__pyx_int_neg_8);
    __pyx_t_1 = __pyx_int_neg_8;
  } else {
    __Pyx_INCREF(__pyx_int_8);
    __pyx_t_1 = __pyx_int_8;
  }
  __pyx_t_2 = PyNumber_Add(__pyx_v_self->__pyx_base.ep_square, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3082, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_last_double = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3084
 *         last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 * 
 *         occupancy = (self.occupied & ~BB_SQUARES[last_double] &             # <<<<<<<<<<<<<<
 *                      ~BB_SQUARES[capturer] | BB_SQUARES[self.ep_square])
 * 
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_last_double); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Invert(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3085
 * 
 *         occupancy = (self.occupied & ~BB_SQUARES[last_double] &
 *                      ~BB_SQUARES[capturer] | BB_SQUARES[self.ep_square])             # <<<<<<<<<<<<<<
 * 
 *         # Horizontal attack on the fifth or fourth rank.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_capturer); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3084
 *         last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 * 
 *         occupancy = (self.occupied & ~BB_SQUARES[last_double] &             # <<<<<<<<<<<<<<
 *                      ~BB_SQUARES[capturer] | BB_SQUARES[self.ep_square])
 * 
 */
  __pyx_t_2 = PyNumber_And(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3085
 * 
 *         occupancy = (self.occupied & ~BB_SQUARES[last_double] &
 *                      ~BB_SQUARES[capturer] | BB_SQUARES[self.ep_square])             # <<<<<<<<<<<<<<
 * 
 *         # Horizontal attack on the fifth or fourth rank.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Or(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_occupancy = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3088
 * 
 *         # Horizontal attack on the fifth or fourth rank.
 *         horizontal_attackers = self.occupied_co[not self.turn] & (self.rooks | self.queens)             # <<<<<<<<<<<<<<
 *         if BB_RANK_ATTACKS[king][BB_RANK_MASKS[king] & occupancy] & horizontal_attackers:
 *             return True
 */
  __pyx_v_horizontal_attackers = ((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))]) & (__pyx_v_self->__pyx_base.rooks | __pyx_v_self->__pyx_base.queens));

  /* "chess/__init__cp.pyx":3089
 *         # Horizontal attack on the fifth or fourth rank.
 *         horizontal_attackers = self.occupied_co[not self.turn] & (self.rooks | self.queens)
 *         if BB_RANK_ATTACKS[king][BB_RANK_MASKS[king] & occupancy] & horizontal_attackers:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_king); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_MASKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_occupancy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_horizontal_attackers); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3089, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3090
 *         horizontal_attackers = self.occupied_co[not self.turn] & (self.rooks | self.queens)
 *         if BB_RANK_ATTACKS[king][BB_RANK_MASKS[king] & occupancy] & horizontal_attackers:
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         # Diagonal skewers. These are not actually possible in a real game,
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3089
 *         # Horizontal attack on the fifth or fourth rank.
 *         horizontal_attackers = self.occupied_co[not self.turn] & (self.rooks | self.queens)
 *         if BB_RANK_ATTACKS[king][BB_RANK_MASKS[king] & occupancy] & horizontal_attackers:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":3095
 *         # because if the latest double pawn move covers a diagonal attack,
 *         # then the other side would have been in check already.
 *         diagonal_attackers = self.occupied_co[not self.turn] & (self.bishops | self.queens)             # <<<<<<<<<<<<<<
 *         if BB_DIAG_ATTACKS[king][BB_DIAG_MASKS[king] & occupancy] & diagonal_attackers:
 *             return True
 */
  __pyx_v_diagonal_attackers = ((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))]) & (__pyx_v_self->__pyx_base.bishops | __pyx_v_self->__pyx_base.queens));

  /* "chess/__init__cp.pyx":3096
 *         # then the other side would have been in check already.
 *         diagonal_attackers = self.occupied_co[not self.turn] & (self.bishops | self.queens)
 *         if BB_DIAG_ATTACKS[king][BB_DIAG_MASKS[king] & occupancy] & diagonal_attackers:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_king); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_DIAG_MASKS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_v_occupancy); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_diagonal_attackers); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3096, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3097
 *         diagonal_attackers = self.occupied_co[not self.turn] & (self.bishops | self.queens)
 *         if BB_DIAG_ATTACKS[king][BB_DIAG_MASKS[king] & occupancy] & diagonal_attackers:
 *             return True             # <<<<<<<<<<<<<<
 * 
 *         return False
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3096
 *         # then the other side would have been in check already.
 *         diagonal_attackers = self.occupied_co[not self.turn] & (self.bishops | self.queens)
 *         if BB_DIAG_ATTACKS[king][BB_DIAG_MASKS[king] & occupancy] & diagonal_attackers:             # <<<<<<<<<<<<<<
 *             return True
 * 
 */
  }

  /* "chess/__init__cp.pyx":3099
 *             return True
 * 
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def _slider_blockers(self, king):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3075
 *         return self.status() == STATUS_VALID
 * 
 *     def _ep_skewered(self, king, capturer):             # <<<<<<<<<<<<<<
 *         # Handle the special case where the king would be in check if the
 *         # pawn and its capturer disappear from the rank.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board._ep_skewered", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_last_double);
  __Pyx_XDECREF(__pyx_v_occupancy);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3101
 *         return False
 * 
 *     def _slider_blockers(self, king):             # <<<<<<<<<<<<<<
 *         rooks_and_queens = self.rooks | self.queens
 *         bishops_and_queens = self.bishops | self.queens
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_157_slider_blockers(PyObject *__pyx_v_self, PyObject *__pyx_v_king); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_157_slider_blockers(PyObject *__pyx_v_self, PyObject *__pyx_v_king) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_slider_blockers (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_156_slider_blockers(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_king));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_156_slider_blockers(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king) {
  unsigned PY_LONG_LONG __pyx_v_rooks_and_queens;
  unsigned PY_LONG_LONG __pyx_v_bishops_and_queens;
  PyObject *__pyx_v_snipers = NULL;
  PyObject *__pyx_v_blockers = NULL;
  PyObject *__pyx_v_sniper = NULL;
  PyObject *__pyx_v_b = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("_slider_blockers", 0);

  /* "chess/__init__cp.pyx":3102
 * 
 *     def _slider_blockers(self, king):
 *         rooks_and_queens = self.rooks | self.queens             # <<<<<<<<<<<<<<
 *         bishops_and_queens = self.bishops | self.queens
 * 
 */
  __pyx_v_rooks_and_queens = (__pyx_v_self->__pyx_base.rooks | __pyx_v_self->__pyx_base.queens);

  /* "chess/__init__cp.pyx":3103
 *     def _slider_blockers(self, king):
 *         rooks_and_queens = self.rooks | self.queens
 *         bishops_and_queens = self.bishops | self.queens             # <<<<<<<<<<<<<<
 * 
 *         snipers = ((BB_RANK_ATTACKS[king][0] & rooks_and_queens) |
 */
  __pyx_v_bishops_and_queens = (__pyx_v_self->__pyx_base.bishops | __pyx_v_self->__pyx_base.queens);

  /* "chess/__init__cp.pyx":3105
 *         bishops_and_queens = self.bishops | self.queens
 * 
 *         snipers = ((BB_RANK_ATTACKS[king][0] & rooks_and_queens) |             # <<<<<<<<<<<<<<
 *                    (BB_FILE_ATTACKS[king][0] & rooks_and_queens) |
 *                    (BB_DIAG_ATTACKS[king][0] & bishops_and_queens))
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_rooks_and_queens); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_And(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3106
 * 
 *         snipers = ((BB_RANK_ATTACKS[king][0] & rooks_and_queens) |
 *                    (BB_FILE_ATTACKS[king][0] & rooks_and_queens) |             # <<<<<<<<<<<<<<
 *                    (BB_DIAG_ATTACKS[king][0] & bishops_and_queens))
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_ATTACKS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_king); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_rooks_and_queens); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3105
 *         bishops_and_queens = self.bishops | self.queens
 * 
 *         snipers = ((BB_RANK_ATTACKS[king][0] & rooks_and_queens) |             # <<<<<<<<<<<<<<
 *                    (BB_FILE_ATTACKS[king][0] & rooks_and_queens) |
 *                    (BB_DIAG_ATTACKS[king][0] & bishops_and_queens))
 */
  __pyx_t_1 = PyNumber_Or(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":3107
 *         snipers = ((BB_RANK_ATTACKS[king][0] & rooks_and_queens) |
 *                    (BB_FILE_ATTACKS[king][0] & rooks_and_queens) |
 *                    (BB_DIAG_ATTACKS[king][0] & bishops_and_queens))             # <<<<<<<<<<<<<<
 * 
 *         blockers = 0
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_DIAG_ATTACKS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_king); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_bishops_and_queens); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3106
 * 
 *         snipers = ((BB_RANK_ATTACKS[king][0] & rooks_and_queens) |
 *                    (BB_FILE_ATTACKS[king][0] & rooks_and_queens) |             # <<<<<<<<<<<<<<
 *                    (BB_DIAG_ATTACKS[king][0] & bishops_and_queens))
 * 
 */
  __pyx_t_3 = PyNumber_Or(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_snipers = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3109
 *                    (BB_DIAG_ATTACKS[king][0] & bishops_and_queens))
 * 
 *         blockers = 0             # <<<<<<<<<<<<<<
 * 
 *         for sniper in scan_reversed(snipers & self.occupied_co[not self.turn]):
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_blockers = __pyx_int_0;

  /* "chess/__init__cp.pyx":3111
 *         blockers = 0
 * 
 *         for sniper in scan_reversed(snipers & self.occupied_co[not self.turn]):             # <<<<<<<<<<<<<<
 *             b = BB_BETWEEN[king][sniper] & self.occupied
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3111, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3111, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_And(__pyx_v_snipers, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3111, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3111, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3111, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3111, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 3111, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3111, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 3111, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3111, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3111, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_sniper, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3112
 * 
 *         for sniper in scan_reversed(snipers & self.occupied_co[not self.turn]):
 *             b = BB_BETWEEN[king][sniper] & self.occupied             # <<<<<<<<<<<<<<
 * 
 *             # Add to blockers if exactly one piece in-between.
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3112, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_king); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3112, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_sniper); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3112, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3112, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyNumber_And(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3112, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_b, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3115
 * 
 *             # Add to blockers if exactly one piece in-between.
 *             if b and BB_SQUARES[msb(b)] == b:             # <<<<<<<<<<<<<<
 *                 blockers |= b
 * 
 */
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_b); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 3115, __pyx_L1_error)
    if (__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L6_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, __pyx_v_b) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_b);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_v_b, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3115, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 3115, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_7 = __pyx_t_8;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_7) {

      /* "chess/__init__cp.pyx":3116
 *             # Add to blockers if exactly one piece in-between.
 *             if b and BB_SQUARES[msb(b)] == b:
 *                 blockers |= b             # <<<<<<<<<<<<<<
 * 
 *         return blockers & self.occupied_co[self.turn]
 */
      __pyx_t_4 = PyNumber_InPlaceOr(__pyx_v_blockers, __pyx_v_b); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3116, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF_SET(__pyx_v_blockers, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "chess/__init__cp.pyx":3115
 * 
 *             # Add to blockers if exactly one piece in-between.
 *             if b and BB_SQUARES[msb(b)] == b:             # <<<<<<<<<<<<<<
 *                 blockers |= b
 * 
 */
    }

    /* "chess/__init__cp.pyx":3111
 *         blockers = 0
 * 
 *         for sniper in scan_reversed(snipers & self.occupied_co[not self.turn]):             # <<<<<<<<<<<<<<
 *             b = BB_BETWEEN[king][sniper] & self.occupied
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3118
 *                 blockers |= b
 * 
 *         return blockers & self.occupied_co[self.turn]             # <<<<<<<<<<<<<<
 * 
 *     def _is_safe(self, king, blockers, Move move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[__pyx_v_self->__pyx_base.turn])); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3118, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyNumber_And(__pyx_v_blockers, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3118, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3101
 *         return False
 * 
 *     def _slider_blockers(self, king):             # <<<<<<<<<<<<<<
 *         rooks_and_queens = self.rooks | self.queens
 *         bishops_and_queens = self.bishops | self.queens
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("chess.__init__cp.Board._slider_blockers", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_snipers);
  __Pyx_XDECREF(__pyx_v_blockers);
  __Pyx_XDECREF(__pyx_v_sniper);
  __Pyx_XDECREF(__pyx_v_b);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3120
 *         return blockers & self.occupied_co[self.turn]
 * 
 *     def _is_safe(self, king, blockers, Move move):             # <<<<<<<<<<<<<<
 *         if move.from_square == king:
 *             if self.is_castling(move):
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_159_is_safe(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_159_is_safe(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_king = 0;
  PyObject *__pyx_v_blockers = 0;
  struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_is_safe (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_king,&__pyx_n_s_blockers,&__pyx_n_s_move,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_king)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_blockers)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_is_safe", 1, 3, 3, 1); __PYX_ERR(0, 3120, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_move)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_is_safe", 1, 3, 3, 2); __PYX_ERR(0, 3120, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_is_safe") < 0)) __PYX_ERR(0, 3120, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_king = values[0];
    __pyx_v_blockers = values[1];
    __pyx_v_move = ((struct __pyx_obj_5chess_10__init__cp_Move *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_is_safe", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3120, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._is_safe", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_move), __pyx_ptype_5chess_10__init__cp_Move, 1, "move", 0))) __PYX_ERR(0, 3120, __pyx_L1_error)
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_158_is_safe(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_king, __pyx_v_blockers, __pyx_v_move);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_158_is_safe(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king, PyObject *__pyx_v_blockers, struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  __Pyx_RefNannySetupContext("_is_safe", 0);

  /* "chess/__init__cp.pyx":3121
 * 
 *     def _is_safe(self, king, blockers, Move move):
 *         if move.from_square == king:             # <<<<<<<<<<<<<<
 *             if self.is_castling(move):
 *                 return True
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_move->from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_v_king, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":3122
 *     def _is_safe(self, king, blockers, Move move):
 *         if move.from_square == king:
 *             if self.is_castling(move):             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_castling); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3122, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, ((PyObject *)__pyx_v_move)) : __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_move));
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3122, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3122, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_3) {

      /* "chess/__init__cp.pyx":3123
 *         if move.from_square == king:
 *             if self.is_castling(move):
 *                 return True             # <<<<<<<<<<<<<<
 *             else:
 *                 return not self.is_attacked_by(not self.turn, move.to_square)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3122
 *     def _is_safe(self, king, blockers, Move move):
 *         if move.from_square == king:
 *             if self.is_castling(move):             # <<<<<<<<<<<<<<
 *                 return True
 *             else:
 */
    }

    /* "chess/__init__cp.pyx":3125
 *                 return True
 *             else:
 *                 return not self.is_attacked_by(not self.turn, move.to_square)             # <<<<<<<<<<<<<<
 *         elif self.is_en_passant(move):
 *             return (self.pin_mask(self.turn, move.from_square) & BB_SQUARES[move.to_square] and
 */
    /*else*/ {
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_attacked_by); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3125, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = __Pyx_PyBool_FromLong((!(__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3125, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_move->to_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3125, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = NULL;
      __pyx_t_7 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_7 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_t_5};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3125, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_t_5};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3125, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3125, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_5);
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3125, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3125, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_3)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3125, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;
    }

    /* "chess/__init__cp.pyx":3121
 * 
 *     def _is_safe(self, king, blockers, Move move):
 *         if move.from_square == king:             # <<<<<<<<<<<<<<
 *             if self.is_castling(move):
 *                 return True
 */
  }

  /* "chess/__init__cp.pyx":3126
 *             else:
 *                 return not self.is_attacked_by(not self.turn, move.to_square)
 *         elif self.is_en_passant(move):             # <<<<<<<<<<<<<<
 *             return (self.pin_mask(self.turn, move.from_square) & BB_SQUARES[move.to_square] and
 *                     not self._ep_skewered(king, move.from_square))
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_en_passant); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, ((PyObject *)__pyx_v_move)) : __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_move));
  __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3126, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "chess/__init__cp.pyx":3127
 *                 return not self.is_attacked_by(not self.turn, move.to_square)
 *         elif self.is_en_passant(move):
 *             return (self.pin_mask(self.turn, move.from_square) & BB_SQUARES[move.to_square] and             # <<<<<<<<<<<<<<
 *                     not self._ep_skewered(king, move.from_square))
 *         else:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_pin_mask); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_5 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_move->from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_8)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_5, __pyx_t_4};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3127, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_5, __pyx_t_4};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3127, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3127, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_6) {
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_7, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_7, __pyx_t_4);
      __pyx_t_5 = 0;
      __pyx_t_4 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3127, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_GetItemInt(__pyx_t_8, __pyx_v_move->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyNumber_And(__pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3127, __pyx_L1_error)
    if (__pyx_t_3) {
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __Pyx_INCREF(__pyx_t_8);
      __pyx_t_2 = __pyx_t_8;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      goto __pyx_L5_bool_binop_done;
    }

    /* "chess/__init__cp.pyx":3128
 *         elif self.is_en_passant(move):
 *             return (self.pin_mask(self.turn, move.from_square) & BB_SQUARES[move.to_square] and
 *                     not self._ep_skewered(king, move.from_square))             # <<<<<<<<<<<<<<
 *         else:
 *             return (not blockers & BB_SQUARES[move.from_square] or
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ep_skewered); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_move->from_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_9)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_king, __pyx_t_1};
      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3128, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_king, __pyx_t_1};
      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3128, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3128, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_INCREF(__pyx_v_king);
      __Pyx_GIVEREF(__pyx_v_king);
      PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_v_king);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_5, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3128, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3128, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_10 = (!__pyx_t_3);
    __pyx_t_8 = __Pyx_PyBool_FromLong(__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_2 = __pyx_t_8;
    __pyx_t_8 = 0;
    __pyx_L5_bool_binop_done:;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3126
 *             else:
 *                 return not self.is_attacked_by(not self.turn, move.to_square)
 *         elif self.is_en_passant(move):             # <<<<<<<<<<<<<<
 *             return (self.pin_mask(self.turn, move.from_square) & BB_SQUARES[move.to_square] and
 *                     not self._ep_skewered(king, move.from_square))
 */
  }

  /* "chess/__init__cp.pyx":3130
 *                     not self._ep_skewered(king, move.from_square))
 *         else:
 *             return (not blockers & BB_SQUARES[move.from_square] or             # <<<<<<<<<<<<<<
 *                     BB_RAYS[move.from_square][move.to_square] & BB_SQUARES[king])
 * 
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_GetItemInt(__pyx_t_8, __pyx_v_move->from_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyNumber_And(__pyx_v_blockers, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 3130, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_3 = (!__pyx_t_10);
    if (!__pyx_t_3) {
    } else {
      __pyx_t_8 = __Pyx_PyBool_FromLong(__pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3130, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_2 = __pyx_t_8;
      __pyx_t_8 = 0;
      goto __pyx_L7_bool_binop_done;
    }

    /* "chess/__init__cp.pyx":3131
 *         else:
 *             return (not blockers & BB_SQUARES[move.from_square] or
 *                     BB_RAYS[move.from_square][move.to_square] & BB_SQUARES[king])             # <<<<<<<<<<<<<<
 * 
 *     def _generate_evasions(self, king, checkers, from_mask=BB_ALL, to_mask=BB_ALL):
 */
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_BB_RAYS); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_GetItemInt(__pyx_t_8, __pyx_v_move->from_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_9, __pyx_v_move->to_square, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_9, __pyx_v_king); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyNumber_And(__pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_INCREF(__pyx_t_9);
    __pyx_t_2 = __pyx_t_9;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_L7_bool_binop_done:;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":3120
 *         return blockers & self.occupied_co[self.turn]
 * 
 *     def _is_safe(self, king, blockers, Move move):             # <<<<<<<<<<<<<<
 *         if move.from_square == king:
 *             if self.is_castling(move):
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("chess.__init__cp.Board._is_safe", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_162generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":3133
 *                     BB_RAYS[move.from_square][move.to_square] & BB_SQUARES[king])
 * 
 *     def _generate_evasions(self, king, checkers, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         sliders = checkers & (self.bishops | self.rooks | self.queens)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_161_generate_evasions(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_161_generate_evasions(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_king = 0;
  PyObject *__pyx_v_checkers = 0;
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_generate_evasions (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_king,&__pyx_n_s_checkers,&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[4] = {0,0,0,0};
    values[2] = __pyx_k__50;
    values[3] = __pyx_k__51;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_king)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_checkers)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_generate_evasions", 0, 2, 4, 1); __PYX_ERR(0, 3133, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_generate_evasions") < 0)) __PYX_ERR(0, 3133, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_king = values[0];
    __pyx_v_checkers = values[1];
    __pyx_v_from_mask = values[2];
    __pyx_v_to_mask = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_generate_evasions", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3133, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._generate_evasions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_160_generate_evasions(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_king, __pyx_v_checkers, __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_160_generate_evasions(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_king, PyObject *__pyx_v_checkers, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_generate_evasions", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3133, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_king = __pyx_v_king;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
  __pyx_cur_scope->__pyx_v_checkers = __pyx_v_checkers;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_checkers);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_checkers);
  __pyx_cur_scope->__pyx_v_from_mask = __pyx_v_from_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
  __pyx_cur_scope->__pyx_v_to_mask = __pyx_v_to_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_162generator5, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_generate_evasions, __pyx_n_s_Board__generate_evasions, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 3133, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._generate_evasions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_162generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  int __pyx_t_12;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_generate_evasions", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L9_resume_from_yield;
    case 2: goto __pyx_L11_resume_from_yield_from;
    case 3: goto __pyx_L16_resume_from_yield_from;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3133, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3134
 * 
 *     def _generate_evasions(self, king, checkers, from_mask=BB_ALL, to_mask=BB_ALL):
 *         sliders = checkers & (self.bishops | self.rooks | self.queens)             # <<<<<<<<<<<<<<
 * 
 *         attacked = 0
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(((__pyx_cur_scope->__pyx_v_self->__pyx_base.bishops | __pyx_cur_scope->__pyx_v_self->__pyx_base.rooks) | __pyx_cur_scope->__pyx_v_self->__pyx_base.queens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3134, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_cur_scope->__pyx_v_checkers, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3134, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_cur_scope->__pyx_v_sliders = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3136
 *         sliders = checkers & (self.bishops | self.rooks | self.queens)
 * 
 *         attacked = 0             # <<<<<<<<<<<<<<
 *         for checker in scan_reversed(sliders):
 *             attacked |= BB_RAYS[king][checker] & ~BB_SQUARES[checker]
 */
  __Pyx_INCREF(__pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __pyx_cur_scope->__pyx_v_attacked = __pyx_int_0;

  /* "chess/__init__cp.pyx":3137
 * 
 *         attacked = 0
 *         for checker in scan_reversed(sliders):             # <<<<<<<<<<<<<<
 *             attacked |= BB_RAYS[king][checker] & ~BB_SQUARES[checker]
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3137, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_cur_scope->__pyx_v_sliders) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_cur_scope->__pyx_v_sliders);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3137, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3137, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3137, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 3137, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3137, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 3137, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3137, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3137, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_checker);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_checker, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":3138
 *         attacked = 0
 *         for checker in scan_reversed(sliders):
 *             attacked |= BB_RAYS[king][checker] & ~BB_SQUARES[checker]             # <<<<<<<<<<<<<<
 * 
 *         if BB_SQUARES[king] & from_mask:
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RAYS); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_cur_scope->__pyx_v_checker); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_cur_scope->__pyx_v_checker); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Invert(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_cur_scope->__pyx_v_attacked, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3138, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_attacked);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_attacked, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3137
 * 
 *         attacked = 0
 *         for checker in scan_reversed(sliders):             # <<<<<<<<<<<<<<
 *             attacked |= BB_RAYS[king][checker] & ~BB_SQUARES[checker]
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3140
 *             attacked |= BB_RAYS[king][checker] & ~BB_SQUARES[checker]
 * 
 *         if BB_SQUARES[king] & from_mask:             # <<<<<<<<<<<<<<
 *             for to_square in scan_reversed(BB_KING_ATTACKS[king] & ~self.occupied_co[self.turn] & ~attacked & to_mask):
 *                 yield Move(king, to_square)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_3, __pyx_cur_scope->__pyx_v_from_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3140, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_7) {

    /* "chess/__init__cp.pyx":3141
 * 
 *         if BB_SQUARES[king] & from_mask:
 *             for to_square in scan_reversed(BB_KING_ATTACKS[king] & ~self.occupied_co[self.turn] & ~attacked & to_mask):             # <<<<<<<<<<<<<<
 *                 yield Move(king, to_square)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_KING_ATTACKS); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((~(__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[__pyx_cur_scope->__pyx_v_self->__pyx_base.turn]))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_8 = PyNumber_And(__pyx_t_2, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_Invert(__pyx_cur_scope->__pyx_v_attacked); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = PyNumber_And(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_And(__pyx_t_2, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3141, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_3 = __pyx_t_1; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
      __pyx_t_5 = NULL;
    } else {
      __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3141, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3141, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_5)) {
        if (likely(PyList_CheckExact(__pyx_t_3))) {
          if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 3141, __pyx_L1_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3141, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 3141, __pyx_L1_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3141, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_5(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 3141, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_to_square, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;

      /* "chess/__init__cp.pyx":3142
 *         if BB_SQUARES[king] & from_mask:
 *             for to_square in scan_reversed(BB_KING_ATTACKS[king] & ~self.occupied_co[self.turn] & ~attacked & to_mask):
 *                 yield Move(king, to_square)             # <<<<<<<<<<<<<<
 * 
 *         checker = msb(checkers)
 */
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3142, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_king);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_square);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_square);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_to_square);
      __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_1, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3142, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_r = __pyx_t_6;
      __pyx_t_6 = 0;
      __Pyx_XGIVEREF(__pyx_t_3);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_3;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_4;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_5;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L9_resume_from_yield:;
      __pyx_t_3 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_3);
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_5 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3142, __pyx_L1_error)

      /* "chess/__init__cp.pyx":3141
 * 
 *         if BB_SQUARES[king] & from_mask:
 *             for to_square in scan_reversed(BB_KING_ATTACKS[king] & ~self.occupied_co[self.turn] & ~attacked & to_mask):             # <<<<<<<<<<<<<<
 *                 yield Move(king, to_square)
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3140
 *             attacked |= BB_RAYS[king][checker] & ~BB_SQUARES[checker]
 * 
 *         if BB_SQUARES[king] & from_mask:             # <<<<<<<<<<<<<<
 *             for to_square in scan_reversed(BB_KING_ATTACKS[king] & ~self.occupied_co[self.turn] & ~attacked & to_mask):
 *                 yield Move(king, to_square)
 */
  }

  /* "chess/__init__cp.pyx":3144
 *                 yield Move(king, to_square)
 * 
 *         checker = msb(checkers)             # <<<<<<<<<<<<<<
 *         if BB_SQUARES[checker] == checkers:
 *             # Capture or block a single checker.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_msb); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_1, __pyx_cur_scope->__pyx_v_checkers) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_checkers);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3144, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_checker);
  __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_checker, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3145
 * 
 *         checker = msb(checkers)
 *         if BB_SQUARES[checker] == checkers:             # <<<<<<<<<<<<<<
 *             # Capture or block a single checker.
 *             target = BB_BETWEEN[king][checker] | checkers
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3145, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_cur_scope->__pyx_v_checker); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3145, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_6, __pyx_cur_scope->__pyx_v_checkers, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3145, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3145, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_7) {

    /* "chess/__init__cp.pyx":3147
 *         if BB_SQUARES[checker] == checkers:
 *             # Capture or block a single checker.
 *             target = BB_BETWEEN[king][checker] | checkers             # <<<<<<<<<<<<<<
 * 
 *             yield from self.generate_pseudo_legal_moves(~self.kings & from_mask, target & to_mask)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_cur_scope->__pyx_v_checker); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_Or(__pyx_t_3, __pyx_cur_scope->__pyx_v_checkers); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_cur_scope->__pyx_v_target = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":3149
 *             target = BB_BETWEEN[king][checker] | checkers
 * 
 *             yield from self.generate_pseudo_legal_moves(~self.kings & from_mask, target & to_mask)             # <<<<<<<<<<<<<<
 * 
 *             # Capture the checking pawn en passant (but avoid yielding
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3149, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((~__pyx_cur_scope->__pyx_v_self->__pyx_base.kings)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3149, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_cur_scope->__pyx_v_from_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3149, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_And(__pyx_cur_scope->__pyx_v_target, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3149, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_2, __pyx_t_1};
      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3149, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_2, __pyx_t_1};
      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3149, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    {
      __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      if (__pyx_t_8) {
        __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_6);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XGOTREF(__pyx_r);
    if (likely(__pyx_r)) {
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 2;
      return __pyx_r;
      __pyx_L11_resume_from_yield_from:;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3149, __pyx_L1_error)
    } else {
      PyObject* exc_type = __Pyx_PyErr_Occurred();
      if (exc_type) {
        if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
        else __PYX_ERR(0, 3149, __pyx_L1_error)
      }
    }

    /* "chess/__init__cp.pyx":3153
 *             # Capture the checking pawn en passant (but avoid yielding
 *             # duplicate moves).
 *             if self.ep_square and not BB_SQUARES[self.ep_square] & target:             # <<<<<<<<<<<<<<
 *                 last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 *                 if last_double == checker:
 */
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 3153, __pyx_L1_error)
    if (__pyx_t_11) {
    } else {
      __pyx_t_7 = __pyx_t_11;
      goto __pyx_L13_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3153, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3153, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_And(__pyx_t_3, __pyx_cur_scope->__pyx_v_target); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3153, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 3153, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_12 = ((!__pyx_t_11) != 0);
    __pyx_t_7 = __pyx_t_12;
    __pyx_L13_bool_binop_done:;
    if (__pyx_t_7) {

      /* "chess/__init__cp.pyx":3154
 *             # duplicate moves).
 *             if self.ep_square and not BB_SQUARES[self.ep_square] & target:
 *                 last_double = self.ep_square + (-8 if self.turn == WHITE else 8)             # <<<<<<<<<<<<<<
 *                 if last_double == checker:
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 */
      if (((__pyx_cur_scope->__pyx_v_self->__pyx_base.turn == 1) != 0)) {
        __Pyx_INCREF(__pyx_int_neg_8);
        __pyx_t_6 = __pyx_int_neg_8;
      } else {
        __Pyx_INCREF(__pyx_int_8);
        __pyx_t_6 = __pyx_int_8;
      }
      __pyx_t_3 = PyNumber_Add(__pyx_cur_scope->__pyx_v_self->__pyx_base.ep_square, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3154, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_cur_scope->__pyx_v_last_double = __pyx_t_3;
      __pyx_t_3 = 0;

      /* "chess/__init__cp.pyx":3155
 *             if self.ep_square and not BB_SQUARES[self.ep_square] & target:
 *                 last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 *                 if last_double == checker:             # <<<<<<<<<<<<<<
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 */
      __pyx_t_3 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_last_double, __pyx_cur_scope->__pyx_v_checker, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3155, __pyx_L1_error)
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3155, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":3156
 *                 last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 *                 if last_double == checker:
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)             # <<<<<<<<<<<<<<
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_pseudo_legal_ep); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3156, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_10 = NULL;
        __pyx_t_9 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
            __pyx_t_9 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_6)) {
          PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
          __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3156, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
          PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
          __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3156, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else
        #endif
        {
          __pyx_t_1 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3156, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (__pyx_t_10) {
            __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10); __pyx_t_10 = NULL;
          }
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
          PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_9, __pyx_cur_scope->__pyx_v_from_mask);
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
          PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_9, __pyx_cur_scope->__pyx_v_to_mask);
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3156, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_3);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XGOTREF(__pyx_r);
        if (likely(__pyx_r)) {
          __Pyx_XGIVEREF(__pyx_r);
          __Pyx_RefNannyFinishContext();
          __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
          /* return from generator, yielding value */
          __pyx_generator->resume_label = 3;
          return __pyx_r;
          __pyx_L16_resume_from_yield_from:;
          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3156, __pyx_L1_error)
        } else {
          PyObject* exc_type = __Pyx_PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
            else __PYX_ERR(0, 3156, __pyx_L1_error)
          }
        }

        /* "chess/__init__cp.pyx":3155
 *             if self.ep_square and not BB_SQUARES[self.ep_square] & target:
 *                 last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 *                 if last_double == checker:             # <<<<<<<<<<<<<<
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 */
      }

      /* "chess/__init__cp.pyx":3153
 *             # Capture the checking pawn en passant (but avoid yielding
 *             # duplicate moves).
 *             if self.ep_square and not BB_SQUARES[self.ep_square] & target:             # <<<<<<<<<<<<<<
 *                 last_double = self.ep_square + (-8 if self.turn == WHITE else 8)
 *                 if last_double == checker:
 */
    }

    /* "chess/__init__cp.pyx":3145
 * 
 *         checker = msb(checkers)
 *         if BB_SQUARES[checker] == checkers:             # <<<<<<<<<<<<<<
 *             # Capture or block a single checker.
 *             target = BB_BETWEEN[king][checker] | checkers
 */
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":3133
 *                     BB_RAYS[move.from_square][move.to_square] & BB_SQUARES[king])
 * 
 *     def _generate_evasions(self, king, checkers, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         sliders = checkers & (self.bishops | self.rooks | self.queens)
 * 
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("_generate_evasions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_165generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":3158
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_164generate_legal_moves(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_164generate_legal_moves(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_moves (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__52;
    values[1] = __pyx_k__53;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_legal_moves") < 0)) __PYX_ERR(0, 3158, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_legal_moves", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3158, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_legal_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_163generate_legal_moves(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_163generate_legal_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_moves", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3158, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_from_mask = __pyx_v_from_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
  __pyx_cur_scope->__pyx_v_to_mask = __pyx_v_to_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_165generator6, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_generate_legal_moves, __pyx_n_s_Board_generate_legal_moves, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 3158, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_legal_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_165generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_moves", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L10_resume_from_yield;
    case 2: goto __pyx_L14_resume_from_yield;
    case 3: goto __pyx_L15_resume_from_yield_from;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3158, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3159
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_is_variant_end); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3160
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():
 *             return             # <<<<<<<<<<<<<<
 * 
 *         king_mask = self.kings & self.occupied_co[self.turn]
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3159
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":3162
 *             return
 * 
 *         king_mask = self.kings & self.occupied_co[self.turn]             # <<<<<<<<<<<<<<
 *         if king_mask:
 *             king = msb(king_mask)
 */
  __pyx_cur_scope->__pyx_v_king_mask = (__pyx_cur_scope->__pyx_v_self->__pyx_base.kings & (__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[__pyx_cur_scope->__pyx_v_self->__pyx_base.turn]));

  /* "chess/__init__cp.pyx":3163
 * 
 *         king_mask = self.kings & self.occupied_co[self.turn]
 *         if king_mask:             # <<<<<<<<<<<<<<
 *             king = msb(king_mask)
 *             blockers = self._slider_blockers(king)
 */
  __pyx_t_4 = (__pyx_cur_scope->__pyx_v_king_mask != 0);
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3164
 *         king_mask = self.kings & self.occupied_co[self.turn]
 *         if king_mask:
 *             king = msb(king_mask)             # <<<<<<<<<<<<<<
 *             blockers = self._slider_blockers(king)
 *             checkers = self.attackers_mask(not self.turn, king)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_msb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3164, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_cur_scope->__pyx_v_king_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3164, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3164, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_v_king = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3165
 *         if king_mask:
 *             king = msb(king_mask)
 *             blockers = self._slider_blockers(king)             # <<<<<<<<<<<<<<
 *             checkers = self.attackers_mask(not self.turn, king)
 *             if checkers:
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_slider_blockers); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3165, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_cur_scope->__pyx_v_king) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_v_king);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3165, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_v_blockers = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3166
 *             king = msb(king_mask)
 *             blockers = self._slider_blockers(king)
 *             checkers = self.attackers_mask(not self.turn, king)             # <<<<<<<<<<<<<<
 *             if checkers:
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_attackers_mask_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyBool_FromLong((!(__pyx_cur_scope->__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_cur_scope->__pyx_v_king};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3166, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_cur_scope->__pyx_v_king};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3166, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3166, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_t_3);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_cur_scope->__pyx_v_king);
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3166, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_cur_scope->__pyx_v_checkers = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3167
 *             blockers = self._slider_blockers(king)
 *             checkers = self.attackers_mask(not self.turn, king)
 *             if checkers:             # <<<<<<<<<<<<<<
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):
 */
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_checkers); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3167, __pyx_L1_error)
    if (__pyx_t_4) {

      /* "chess/__init__cp.pyx":3168
 *             checkers = self.attackers_mask(not self.turn, king)
 *             if checkers:
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):             # <<<<<<<<<<<<<<
 *                     if self._is_safe(king, blockers, move):
 *                         yield move
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_evasions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3168, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = NULL;
      __pyx_t_6 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_6 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_checkers, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3168, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
        PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_checkers, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3168, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
      } else
      #endif
      {
        __pyx_t_3 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3168, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        if (__pyx_t_7) {
          __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __pyx_t_7 = NULL;
        }
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
        PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_6, __pyx_cur_scope->__pyx_v_king);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_checkers);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_checkers);
        PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_6, __pyx_cur_scope->__pyx_v_checkers);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
        PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_6, __pyx_cur_scope->__pyx_v_from_mask);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
        PyTuple_SET_ITEM(__pyx_t_3, 3+__pyx_t_6, __pyx_cur_scope->__pyx_v_to_mask);
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3168, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
        __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_8 = 0;
        __pyx_t_9 = NULL;
      } else {
        __pyx_t_8 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3168, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_9 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3168, __pyx_L1_error)
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      for (;;) {
        if (likely(!__pyx_t_9)) {
          if (likely(PyList_CheckExact(__pyx_t_2))) {
            if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_2)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 3168, __pyx_L1_error)
            #else
            __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3168, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            #endif
          } else {
            if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 3168, __pyx_L1_error)
            #else
            __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3168, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            #endif
          }
        } else {
          __pyx_t_1 = __pyx_t_9(__pyx_t_2);
          if (unlikely(!__pyx_t_1)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 3168, __pyx_L1_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_1);
        }
        __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_move);
        __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_move, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        __pyx_t_1 = 0;

        /* "chess/__init__cp.pyx":3169
 *             if checkers:
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):             # <<<<<<<<<<<<<<
 *                         yield move
 *             else:
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_is_safe); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3169, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_3)) {
          PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_blockers, __pyx_cur_scope->__pyx_v_move};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3169, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_1);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
          PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_blockers, __pyx_cur_scope->__pyx_v_move};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3169, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_1);
        } else
        #endif
        {
          __pyx_t_5 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3169, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if (__pyx_t_7) {
            __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7); __pyx_t_7 = NULL;
          }
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
          PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_cur_scope->__pyx_v_king);
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_blockers);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_blockers);
          PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_cur_scope->__pyx_v_blockers);
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_move);
          PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, __pyx_cur_scope->__pyx_v_move);
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3169, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3169, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_4) {

          /* "chess/__init__cp.pyx":3170
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):
 *                         yield move             # <<<<<<<<<<<<<<
 *             else:
 *                 for move in self.generate_pseudo_legal_moves(from_mask, to_mask):
 */
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
          __pyx_r = __pyx_cur_scope->__pyx_v_move;
          __Pyx_XGIVEREF(__pyx_t_2);
          __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
          __pyx_cur_scope->__pyx_t_1 = __pyx_t_8;
          __pyx_cur_scope->__pyx_t_2 = __pyx_t_9;
          __Pyx_XGIVEREF(__pyx_r);
          __Pyx_RefNannyFinishContext();
          __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
          /* return from generator, yielding value */
          __pyx_generator->resume_label = 1;
          return __pyx_r;
          __pyx_L10_resume_from_yield:;
          __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
          __pyx_cur_scope->__pyx_t_0 = 0;
          __Pyx_XGOTREF(__pyx_t_2);
          __pyx_t_8 = __pyx_cur_scope->__pyx_t_1;
          __pyx_t_9 = __pyx_cur_scope->__pyx_t_2;
          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3170, __pyx_L1_error)

          /* "chess/__init__cp.pyx":3169
 *             if checkers:
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):             # <<<<<<<<<<<<<<
 *                         yield move
 *             else:
 */
        }

        /* "chess/__init__cp.pyx":3168
 *             checkers = self.attackers_mask(not self.turn, king)
 *             if checkers:
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):             # <<<<<<<<<<<<<<
 *                     if self._is_safe(king, blockers, move):
 *                         yield move
 */
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":3167
 *             blockers = self._slider_blockers(king)
 *             checkers = self.attackers_mask(not self.turn, king)
 *             if checkers:             # <<<<<<<<<<<<<<
 *                 for move in self._generate_evasions(king, checkers, from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):
 */
      goto __pyx_L6;
    }

    /* "chess/__init__cp.pyx":3172
 *                         yield move
 *             else:
 *                 for move in self.generate_pseudo_legal_moves(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *                     if self._is_safe(king, blockers, move):
 *                         yield move
 */
    /*else*/ {
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3172, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = NULL;
      __pyx_t_6 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3172, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3172, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else
      #endif
      {
        __pyx_t_5 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3172, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (__pyx_t_3) {
          __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
        }
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
        PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_cur_scope->__pyx_v_from_mask);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
        PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_cur_scope->__pyx_v_to_mask);
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3172, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
        __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
        __pyx_t_9 = NULL;
      } else {
        __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3172, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3172, __pyx_L1_error)
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      for (;;) {
        if (likely(!__pyx_t_9)) {
          if (likely(PyList_CheckExact(__pyx_t_1))) {
            if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 3172, __pyx_L1_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3172, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          } else {
            if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 3172, __pyx_L1_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3172, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_9(__pyx_t_1);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 3172, __pyx_L1_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_2);
        }
        __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_move);
        __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_move, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;

        /* "chess/__init__cp.pyx":3173
 *             else:
 *                 for move in self.generate_pseudo_legal_moves(from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):             # <<<<<<<<<<<<<<
 *                         yield move
 *         else:
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_is_safe); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3173, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_3 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_blockers, __pyx_cur_scope->__pyx_v_move};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3173, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_GOTREF(__pyx_t_2);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_blockers, __pyx_cur_scope->__pyx_v_move};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3173, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_GOTREF(__pyx_t_2);
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3173, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_3) {
            __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __pyx_t_3 = NULL;
          }
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_cur_scope->__pyx_v_king);
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_blockers);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_blockers);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_cur_scope->__pyx_v_blockers);
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
          __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_move);
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, __pyx_cur_scope->__pyx_v_move);
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3173, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3173, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (__pyx_t_4) {

          /* "chess/__init__cp.pyx":3174
 *                 for move in self.generate_pseudo_legal_moves(from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):
 *                         yield move             # <<<<<<<<<<<<<<
 *         else:
 *             yield from self.generate_pseudo_legal_moves(from_mask, to_mask)
 */
          __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
          __pyx_r = __pyx_cur_scope->__pyx_v_move;
          __Pyx_XGIVEREF(__pyx_t_1);
          __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
          __pyx_cur_scope->__pyx_t_1 = __pyx_t_8;
          __pyx_cur_scope->__pyx_t_2 = __pyx_t_9;
          __Pyx_XGIVEREF(__pyx_r);
          __Pyx_RefNannyFinishContext();
          __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
          /* return from generator, yielding value */
          __pyx_generator->resume_label = 2;
          return __pyx_r;
          __pyx_L14_resume_from_yield:;
          __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
          __pyx_cur_scope->__pyx_t_0 = 0;
          __Pyx_XGOTREF(__pyx_t_1);
          __pyx_t_8 = __pyx_cur_scope->__pyx_t_1;
          __pyx_t_9 = __pyx_cur_scope->__pyx_t_2;
          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3174, __pyx_L1_error)

          /* "chess/__init__cp.pyx":3173
 *             else:
 *                 for move in self.generate_pseudo_legal_moves(from_mask, to_mask):
 *                     if self._is_safe(king, blockers, move):             # <<<<<<<<<<<<<<
 *                         yield move
 *         else:
 */
        }

        /* "chess/__init__cp.pyx":3172
 *                         yield move
 *             else:
 *                 for move in self.generate_pseudo_legal_moves(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *                     if self._is_safe(king, blockers, move):
 *                         yield move
 */
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_L6:;

    /* "chess/__init__cp.pyx":3163
 * 
 *         king_mask = self.kings & self.occupied_co[self.turn]
 *         if king_mask:             # <<<<<<<<<<<<<<
 *             king = msb(king_mask)
 *             blockers = self._slider_blockers(king)
 */
    goto __pyx_L5;
  }

  /* "chess/__init__cp.pyx":3176
 *                         yield move
 *         else:
 *             yield from self.generate_pseudo_legal_moves(from_mask, to_mask)             # <<<<<<<<<<<<<<
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
  /*else*/ {
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3176, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3176, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3176, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3176, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_cur_scope->__pyx_v_from_mask);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_cur_scope->__pyx_v_to_mask);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3176, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XGOTREF(__pyx_r);
    if (likely(__pyx_r)) {
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 3;
      return __pyx_r;
      __pyx_L15_resume_from_yield_from:;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3176, __pyx_L1_error)
    } else {
      PyObject* exc_type = __Pyx_PyErr_Occurred();
      if (exc_type) {
        if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
        else __PYX_ERR(0, 3176, __pyx_L1_error)
      }
    }
  }
  __pyx_L5:;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":3158
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("generate_legal_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_168generator7(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":3178
 *             yield from self.generate_pseudo_legal_moves(from_mask, to_mask)
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_167generate_legal_ep(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_167generate_legal_ep(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_ep (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__54;
    values[1] = __pyx_k__55;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_legal_ep") < 0)) __PYX_ERR(0, 3178, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_legal_ep", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3178, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_legal_ep", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_166generate_legal_ep(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_166generate_legal_ep(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_ep", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3178, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_from_mask = __pyx_v_from_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
  __pyx_cur_scope->__pyx_v_to_mask = __pyx_v_to_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_168generator7, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_generate_legal_ep, __pyx_n_s_Board_generate_legal_ep, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 3178, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_legal_ep", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_168generator7(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_ep", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L8_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3178, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3179
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_is_variant_end); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3179, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3179, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3179, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3180
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():
 *             return             # <<<<<<<<<<<<<<
 * 
 *         for move in self.generate_pseudo_legal_ep(from_mask, to_mask):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3179
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":3182
 *             return
 * 
 *         for move in self.generate_pseudo_legal_ep(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *             if not self.is_into_check(move):
 *                 yield move
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_generate_pseudo_legal_ep); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3182, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3182, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_from_mask, __pyx_cur_scope->__pyx_v_to_mask};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3182, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3182, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_cur_scope->__pyx_v_from_mask);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_cur_scope->__pyx_v_to_mask);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3182, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3182, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3182, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 3182, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3182, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 3182, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3182, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_8(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3182, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_move, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3183
 * 
 *         for move in self.generate_pseudo_legal_ep(from_mask, to_mask):
 *             if not self.is_into_check(move):             # <<<<<<<<<<<<<<
 *                 yield move
 * 
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_is_into_check); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3183, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_cur_scope->__pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3183, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3183, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = ((!__pyx_t_4) != 0);
    if (__pyx_t_9) {

      /* "chess/__init__cp.pyx":3184
 *         for move in self.generate_pseudo_legal_ep(from_mask, to_mask):
 *             if not self.is_into_check(move):
 *                 yield move             # <<<<<<<<<<<<<<
 * 
 *     def generate_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_move);
      __pyx_r = __pyx_cur_scope->__pyx_v_move;
      __Pyx_XGIVEREF(__pyx_t_2);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_7;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_8;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L8_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_2);
      __pyx_t_7 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_8 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3184, __pyx_L1_error)

      /* "chess/__init__cp.pyx":3183
 * 
 *         for move in self.generate_pseudo_legal_ep(from_mask, to_mask):
 *             if not self.is_into_check(move):             # <<<<<<<<<<<<<<
 *                 yield move
 * 
 */
    }

    /* "chess/__init__cp.pyx":3182
 *             return
 * 
 *         for move in self.generate_pseudo_legal_ep(from_mask, to_mask):             # <<<<<<<<<<<<<<
 *             if not self.is_into_check(move):
 *                 yield move
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":3178
 *             yield from self.generate_pseudo_legal_moves(from_mask, to_mask)
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("generate_legal_ep", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3186
 *                 yield move
 * 
 *     def generate_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         return itertools.chain(
 *             self.generate_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_170generate_legal_captures(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_170generate_legal_captures(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_legal_captures (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__56;
    values[1] = __pyx_k__57;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_legal_captures") < 0)) __PYX_ERR(0, 3186, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_legal_captures", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3186, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_legal_captures", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_169generate_legal_captures(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_169generate_legal_captures(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("generate_legal_captures", 0);

  /* "chess/__init__cp.pyx":3187
 * 
 *     def generate_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         return itertools.chain(             # <<<<<<<<<<<<<<
 *             self.generate_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 *             self.generate_legal_ep(from_mask, to_mask))
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_itertools); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3188
 *     def generate_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         return itertools.chain(
 *             self.generate_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),             # <<<<<<<<<<<<<<
 *             self.generate_legal_ep(from_mask, to_mask))
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))])); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyNumber_And(__pyx_v_to_mask, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_from_mask, __pyx_t_6};
    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3188, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_from_mask, __pyx_t_6};
    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3188, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(__pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_v_from_mask);
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":3189
 *         return itertools.chain(
 *             self.generate_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 *             self.generate_legal_ep(from_mask, to_mask))             # <<<<<<<<<<<<<<
 * 
 *     def _attacked_for_king(self, path, occupied):
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_generate_legal_ep); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3189, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_from_mask, __pyx_v_to_mask};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3189, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_from_mask, __pyx_v_to_mask};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3189, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3189, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_6) {
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_INCREF(__pyx_v_from_mask);
    __Pyx_GIVEREF(__pyx_v_from_mask);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_v_from_mask);
    __Pyx_INCREF(__pyx_v_to_mask);
    __Pyx_GIVEREF(__pyx_v_to_mask);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_v_to_mask);
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3189, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3187, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3187, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3187, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_8) {
      __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_t_4);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3187, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3186
 *                 yield move
 * 
 *     def generate_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         return itertools.chain(
 *             self.generate_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_legal_captures", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3191
 *             self.generate_legal_ep(from_mask, to_mask))
 * 
 *     def _attacked_for_king(self, path, occupied):             # <<<<<<<<<<<<<<
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_172_attacked_for_king(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_172_attacked_for_king(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_path = 0;
  PyObject *__pyx_v_occupied = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_attacked_for_king (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_path,&__pyx_n_s_occupied,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_path)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_occupied)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_attacked_for_king", 1, 2, 2, 1); __PYX_ERR(0, 3191, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_attacked_for_king") < 0)) __PYX_ERR(0, 3191, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_path = values[0];
    __pyx_v_occupied = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_attacked_for_king", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3191, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._attacked_for_king", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_171_attacked_for_king(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_path, __pyx_v_occupied);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_18_attacked_for_king_2generator12(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":3192
 * 
 *     def _attacked_for_king(self, path, occupied):
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))             # <<<<<<<<<<<<<<
 * 
 *     def _castling_uncovers_rank_attack(self, rook_bb, king_to):
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_18_attacked_for_king_genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_15_genexpr(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_15_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3192, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *) __pyx_self;
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_18_attacked_for_king_2generator12, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_attacked_for_king_locals_genexp, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 3192, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._attacked_for_king.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_18_attacked_for_king_2generator12(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3192, __pyx_L1_error)
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3192, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_path)) { __Pyx_RaiseClosureNameError("path"); __PYX_ERR(0, 3192, __pyx_L1_error) }
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_path) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_path);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3192, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 3192, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 3192, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3192, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_sq);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_sq, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 3192, __pyx_L1_error) }
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_attackers_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 3192, __pyx_L1_error) }
    __pyx_t_6 = __Pyx_PyBool_FromLong((!(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_occupied)) { __Pyx_RaiseClosureNameError("occupied"); __PYX_ERR(0, 3192, __pyx_L1_error) }
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_6, __pyx_cur_scope->__pyx_v_sq, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_occupied};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_6, __pyx_cur_scope->__pyx_v_sq, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_occupied};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3192, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_t_6);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_sq);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_sq);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_cur_scope->__pyx_v_sq);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_occupied);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_occupied);
      PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_occupied);
      __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 3192, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_10) {
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L0;
    }
  }
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3191
 *             self.generate_legal_ep(from_mask, to_mask))
 * 
 *     def _attacked_for_king(self, path, occupied):             # <<<<<<<<<<<<<<
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))
 * 
 */

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_171_attacked_for_king(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_path, PyObject *__pyx_v_occupied) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("_attacked_for_king", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3191, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_path = __pyx_v_path;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_path);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_path);
  __pyx_cur_scope->__pyx_v_occupied = __pyx_v_occupied;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_occupied);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_occupied);

  /* "chess/__init__cp.pyx":3192
 * 
 *     def _attacked_for_king(self, path, occupied):
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))             # <<<<<<<<<<<<<<
 * 
 *     def _castling_uncovers_rank_attack(self, rook_bb, king_to):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_pf_5chess_10__init__cp_5Board_18_attacked_for_king_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3192, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_Generator_Next(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3192, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3191
 *             self.generate_legal_ep(from_mask, to_mask))
 * 
 *     def _attacked_for_king(self, path, occupied):             # <<<<<<<<<<<<<<
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.Board._attacked_for_king", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3194
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))
 * 
 *     def _castling_uncovers_rank_attack(self, rook_bb, king_to):             # <<<<<<<<<<<<<<
 *         # Test the special case where we castle and our rook shielded us from
 *         # an attack, so castling would be into check.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_174_castling_uncovers_rank_attack(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_174_castling_uncovers_rank_attack(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_rook_bb = 0;
  PyObject *__pyx_v_king_to = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_castling_uncovers_rank_attack (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_rook_bb,&__pyx_n_s_king_to,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rook_bb)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_king_to)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_castling_uncovers_rank_attack", 1, 2, 2, 1); __PYX_ERR(0, 3194, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_castling_uncovers_rank_attack") < 0)) __PYX_ERR(0, 3194, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_rook_bb = values[0];
    __pyx_v_king_to = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_castling_uncovers_rank_attack", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3194, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._castling_uncovers_rank_attack", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_173_castling_uncovers_rank_attack(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_rook_bb, __pyx_v_king_to);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_173_castling_uncovers_rank_attack(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_rook_bb, PyObject *__pyx_v_king_to) {
  PyObject *__pyx_v_rank_pieces = NULL;
  unsigned PY_LONG_LONG __pyx_v_sliders;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("_castling_uncovers_rank_attack", 0);

  /* "chess/__init__cp.pyx":3197
 *         # Test the special case where we castle and our rook shielded us from
 *         # an attack, so castling would be into check.
 *         rank_pieces = BB_RANK_MASKS[king_to] & (self.occupied ^ rook_bb)             # <<<<<<<<<<<<<<
 *         sliders = (self.queens | self.rooks) & self.occupied_co[not self.turn]
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_MASKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_king_to); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Xor(__pyx_t_1, __pyx_v_rook_bb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_rank_pieces = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3198
 *         # an attack, so castling would be into check.
 *         rank_pieces = BB_RANK_MASKS[king_to] & (self.occupied ^ rook_bb)
 *         sliders = (self.queens | self.rooks) & self.occupied_co[not self.turn]             # <<<<<<<<<<<<<<
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders
 * 
 */
  __pyx_v_sliders = ((__pyx_v_self->__pyx_base.queens | __pyx_v_self->__pyx_base.rooks) & (__pyx_v_self->__pyx_base.occupied_co[(!(__pyx_v_self->__pyx_base.turn != 0))]));

  /* "chess/__init__cp.pyx":3199
 *         rank_pieces = BB_RANK_MASKS[king_to] & (self.occupied ^ rook_bb)
 *         sliders = (self.queens | self.rooks) & self.occupied_co[not self.turn]
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders             # <<<<<<<<<<<<<<
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_ATTACKS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_king_to); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_rank_pieces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_sliders); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3194
 *         return any(self._attackers_mask(not self.turn, sq, occupied) for sq in scan_reversed(path))
 * 
 *     def _castling_uncovers_rank_attack(self, rook_bb, king_to):             # <<<<<<<<<<<<<<
 *         # Test the special case where we castle and our rook shielded us from
 *         # an attack, so castling would be into check.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board._castling_uncovers_rank_attack", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_rank_pieces);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_5Board_177generator8(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":3201
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_176generate_castling_moves(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_176generate_castling_moves(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_from_mask = 0;
  PyObject *__pyx_v_to_mask = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_castling_moves (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_from_mask,&__pyx_n_s_to_mask,0};
    PyObject* values[2] = {0,0};
    values[0] = __pyx_k__58;
    values[1] = __pyx_k__59;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_mask);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_mask);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "generate_castling_moves") < 0)) __PYX_ERR(0, 3201, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_from_mask = values[0];
    __pyx_v_to_mask = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("generate_castling_moves", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3201, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_castling_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_175generate_castling_moves(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_from_mask, __pyx_v_to_mask);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_175generate_castling_moves(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_from_mask, PyObject *__pyx_v_to_mask) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_castling_moves", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3201, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __pyx_cur_scope->__pyx_v_from_mask = __pyx_v_from_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_from_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_from_mask);
  __pyx_cur_scope->__pyx_v_to_mask = __pyx_v_to_mask;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_to_mask);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_to_mask);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_5Board_177generator8, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_generate_castling_moves, __pyx_n_s_Board_generate_castling_moves, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 3201, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.generate_castling_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_5Board_177generator8(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  PyObject *(*__pyx_t_11)(PyObject *);
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("generate_castling_moves", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L19_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3201, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3202
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_is_variant_end); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3202, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3202, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3202, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3203
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():
 *             return             # <<<<<<<<<<<<<<
 * 
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3202
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):
 *         if self.is_variant_end():             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":3205
 *             return
 * 
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8             # <<<<<<<<<<<<<<
 *         king = self.occupied_co[self.turn] & self.kings & ~self.promoted & backrank & from_mask
 *         king = king & -king
 */
  if (((__pyx_cur_scope->__pyx_v_self->__pyx_base.turn == 1) != 0)) {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_backrank = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3206
 * 
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8
 *         king = self.occupied_co[self.turn] & self.kings & ~self.promoted & backrank & from_mask             # <<<<<<<<<<<<<<
 *         king = king & -king
 *         if not king or self._attacked_for_king(king, self.occupied):
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((((__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied_co[__pyx_cur_scope->__pyx_v_self->__pyx_base.turn]) & __pyx_cur_scope->__pyx_v_self->__pyx_base.kings) & (~__pyx_cur_scope->__pyx_v_self->__pyx_base.promoted))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3206, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_cur_scope->__pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3206, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_cur_scope->__pyx_v_from_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3206, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_king = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3207
 *         backrank = BB_RANK_1 if self.turn == WHITE else BB_RANK_8
 *         king = self.occupied_co[self.turn] & self.kings & ~self.promoted & backrank & from_mask
 *         king = king & -king             # <<<<<<<<<<<<<<
 *         if not king or self._attacked_for_king(king, self.occupied):
 *             return
 */
  __pyx_t_1 = PyNumber_Negative(__pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3207, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_cur_scope->__pyx_v_king, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3207, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_king);
  __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_king, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3208
 *         king = self.occupied_co[self.turn] & self.kings & ~self.promoted & backrank & from_mask
 *         king = king & -king
 *         if not king or self._attacked_for_king(king, self.occupied):             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_king); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3208, __pyx_L1_error)
  __pyx_t_6 = ((!__pyx_t_5) != 0);
  if (!__pyx_t_6) {
  } else {
    __pyx_t_4 = __pyx_t_6;
    goto __pyx_L6_bool_binop_done;
  }
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_attacked_for_king); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3208, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3208, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_king, __pyx_t_3};
    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3208, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_king, __pyx_t_3};
    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3208, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3208, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (__pyx_t_7) {
      __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
    }
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king);
    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_cur_scope->__pyx_v_king);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3208, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3208, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __pyx_t_6;
  __pyx_L6_bool_binop_done:;
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3209
 *         king = king & -king
 *         if not king or self._attacked_for_king(king, self.occupied):
 *             return             # <<<<<<<<<<<<<<
 * 
 *         bb_c = BB_FILE_C & backrank
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = NULL;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3208
 *         king = self.occupied_co[self.turn] & self.kings & ~self.promoted & backrank & from_mask
 *         king = king & -king
 *         if not king or self._attacked_for_king(king, self.occupied):             # <<<<<<<<<<<<<<
 *             return
 * 
 */
  }

  /* "chess/__init__cp.pyx":3211
 *             return
 * 
 *         bb_c = BB_FILE_C & backrank             # <<<<<<<<<<<<<<
 *         bb_d = BB_FILE_D & backrank
 *         bb_f = BB_FILE_F & backrank
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_C); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_cur_scope->__pyx_v_backrank); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_bb_c = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3212
 * 
 *         bb_c = BB_FILE_C & backrank
 *         bb_d = BB_FILE_D & backrank             # <<<<<<<<<<<<<<
 *         bb_f = BB_FILE_F & backrank
 *         bb_g = BB_FILE_G & backrank
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILE_D); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3212, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_cur_scope->__pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3212, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_cur_scope->__pyx_v_bb_d = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3213
 *         bb_c = BB_FILE_C & backrank
 *         bb_d = BB_FILE_D & backrank
 *         bb_f = BB_FILE_F & backrank             # <<<<<<<<<<<<<<
 *         bb_g = BB_FILE_G & backrank
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_FILE_F); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3213, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_cur_scope->__pyx_v_backrank); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3213, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_bb_f = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3214
 *         bb_d = BB_FILE_D & backrank
 *         bb_f = BB_FILE_F & backrank
 *         bb_g = BB_FILE_G & backrank             # <<<<<<<<<<<<<<
 * 
 *         for candidate in scan_reversed(self.clean_castling_rights() & backrank & to_mask):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILE_G); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3214, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_cur_scope->__pyx_v_backrank); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3214, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_cur_scope->__pyx_v_bb_g = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3216
 *         bb_g = BB_FILE_G & backrank
 * 
 *         for candidate in scan_reversed(self.clean_castling_rights() & backrank & to_mask):             # <<<<<<<<<<<<<<
 *             rook = BB_SQUARES[candidate]
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_9 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_And(__pyx_t_9, __pyx_cur_scope->__pyx_v_backrank); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = PyNumber_And(__pyx_t_3, __pyx_cur_scope->__pyx_v_to_mask); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_9);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3216, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_10 = 0;
    __pyx_t_11 = NULL;
  } else {
    __pyx_t_10 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3216, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_11 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 3216, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_11)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 3216, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3216, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 3216, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3216, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_11(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3216, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_candidate);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_candidate, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":3217
 * 
 *         for candidate in scan_reversed(self.clean_castling_rights() & backrank & to_mask):
 *             rook = BB_SQUARES[candidate]             # <<<<<<<<<<<<<<
 * 
 *             a_side = rook < king
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_cur_scope->__pyx_v_candidate); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_rook);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_rook, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_9 = 0;

    /* "chess/__init__cp.pyx":3219
 *             rook = BB_SQUARES[candidate]
 * 
 *             a_side = rook < king             # <<<<<<<<<<<<<<
 * 
 *             empty_for_rook = 0
 */
    __pyx_t_9 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_rook, __pyx_cur_scope->__pyx_v_king, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3219, __pyx_L1_error)
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_a_side);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_a_side, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_9 = 0;

    /* "chess/__init__cp.pyx":3221
 *             a_side = rook < king
 * 
 *             empty_for_rook = 0             # <<<<<<<<<<<<<<
 *             empty_for_king = 0
 * 
 */
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_empty_for_rook);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_empty_for_rook, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);

    /* "chess/__init__cp.pyx":3222
 * 
 *             empty_for_rook = 0
 *             empty_for_king = 0             # <<<<<<<<<<<<<<
 * 
 *             if a_side:
 */
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_empty_for_king);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_empty_for_king, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);

    /* "chess/__init__cp.pyx":3224
 *             empty_for_king = 0
 * 
 *             if a_side:             # <<<<<<<<<<<<<<
 *                 king_to = msb(bb_c)
 *                 if not rook & bb_d:
 */
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_cur_scope->__pyx_v_a_side); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3224, __pyx_L1_error)
    if (__pyx_t_4) {

      /* "chess/__init__cp.pyx":3225
 * 
 *             if a_side:
 *                 king_to = msb(bb_c)             # <<<<<<<<<<<<<<
 *                 if not rook & bb_d:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d
 */
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_msb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3225, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      __pyx_t_9 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_cur_scope->__pyx_v_bb_c) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_v_bb_c);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3225, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_king_to);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_king_to, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;

      /* "chess/__init__cp.pyx":3226
 *             if a_side:
 *                 king_to = msb(bb_c)
 *                 if not rook & bb_d:             # <<<<<<<<<<<<<<
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d
 *                 if not king & bb_c:
 */
      __pyx_t_9 = PyNumber_And(__pyx_cur_scope->__pyx_v_rook, __pyx_cur_scope->__pyx_v_bb_d); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3226, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3226, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_6 = ((!__pyx_t_4) != 0);
      if (__pyx_t_6) {

        /* "chess/__init__cp.pyx":3227
 *                 king_to = msb(bb_c)
 *                 if not rook & bb_d:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d             # <<<<<<<<<<<<<<
 *                 if not king & bb_c:
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_c
 */
        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_9, __pyx_cur_scope->__pyx_v_candidate); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        __pyx_t_9 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_7, __pyx_cur_scope->__pyx_v_bb_d) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_bb_d);
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = PyNumber_Or(__pyx_t_3, __pyx_cur_scope->__pyx_v_bb_d); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_empty_for_rook);
        __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_empty_for_rook, __pyx_t_9);
        __Pyx_GIVEREF(__pyx_t_9);
        __pyx_t_9 = 0;

        /* "chess/__init__cp.pyx":3226
 *             if a_side:
 *                 king_to = msb(bb_c)
 *                 if not rook & bb_d:             # <<<<<<<<<<<<<<
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d
 *                 if not king & bb_c:
 */
      }

      /* "chess/__init__cp.pyx":3228
 *                 if not rook & bb_d:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d
 *                 if not king & bb_c:             # <<<<<<<<<<<<<<
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_c
 *             else:
 */
      __pyx_t_9 = PyNumber_And(__pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_bb_c); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3228, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3228, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_4 = ((!__pyx_t_6) != 0);
      if (__pyx_t_4) {

        /* "chess/__init__cp.pyx":3229
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d
 *                 if not king & bb_c:
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_c             # <<<<<<<<<<<<<<
 *             else:
 *                 king_to = msb(bb_g)
 */
        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3229, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_msb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3229, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_7 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_7, __pyx_cur_scope->__pyx_v_king) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_cur_scope->__pyx_v_king);
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3229, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3229, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_cur_scope->__pyx_v_king_to); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3229, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyNumber_Or(__pyx_t_3, __pyx_cur_scope->__pyx_v_bb_c); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3229, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_empty_for_king);
        __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_empty_for_king, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;

        /* "chess/__init__cp.pyx":3228
 *                 if not rook & bb_d:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_d)] | bb_d
 *                 if not king & bb_c:             # <<<<<<<<<<<<<<
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_c
 *             else:
 */
      }

      /* "chess/__init__cp.pyx":3224
 *             empty_for_king = 0
 * 
 *             if a_side:             # <<<<<<<<<<<<<<
 *                 king_to = msb(bb_c)
 *                 if not rook & bb_d:
 */
      goto __pyx_L10;
    }

    /* "chess/__init__cp.pyx":3231
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_c
 *             else:
 *                 king_to = msb(bb_g)             # <<<<<<<<<<<<<<
 *                 if not rook & bb_f:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f
 */
    /*else*/ {
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3231, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_9 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, __pyx_cur_scope->__pyx_v_bb_g) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_bb_g);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3231, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_king_to);
      __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_king_to, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __pyx_t_2 = 0;

      /* "chess/__init__cp.pyx":3232
 *             else:
 *                 king_to = msb(bb_g)
 *                 if not rook & bb_f:             # <<<<<<<<<<<<<<
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f
 *                 if not king & bb_g:
 */
      __pyx_t_2 = PyNumber_And(__pyx_cur_scope->__pyx_v_rook, __pyx_cur_scope->__pyx_v_bb_f); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3232, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3232, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_6 = ((!__pyx_t_4) != 0);
      if (__pyx_t_6) {

        /* "chess/__init__cp.pyx":3233
 *                 king_to = msb(bb_g)
 *                 if not rook & bb_f:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f             # <<<<<<<<<<<<<<
 *                 if not king & bb_g:
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g
 */
        __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_cur_scope->__pyx_v_candidate); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_msb); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_7 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_9, function);
          }
        }
        __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_7, __pyx_cur_scope->__pyx_v_bb_f) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_cur_scope->__pyx_v_bb_f);
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyNumber_Or(__pyx_t_9, __pyx_cur_scope->__pyx_v_bb_f); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_empty_for_rook);
        __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_empty_for_rook, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;

        /* "chess/__init__cp.pyx":3232
 *             else:
 *                 king_to = msb(bb_g)
 *                 if not rook & bb_f:             # <<<<<<<<<<<<<<
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f
 *                 if not king & bb_g:
 */
      }

      /* "chess/__init__cp.pyx":3234
 *                 if not rook & bb_f:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f
 *                 if not king & bb_g:             # <<<<<<<<<<<<<<
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g
 * 
 */
      __pyx_t_2 = PyNumber_And(__pyx_cur_scope->__pyx_v_king, __pyx_cur_scope->__pyx_v_bb_g); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3234, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3234, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_4 = ((!__pyx_t_6) != 0);
      if (__pyx_t_4) {

        /* "chess/__init__cp.pyx":3235
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f
 *                 if not king & bb_g:
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g             # <<<<<<<<<<<<<<
 * 
 *             if not ((self.occupied ^ king ^ rook) & (empty_for_king | empty_for_rook) or
 */
        __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_BETWEEN); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3235, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3235, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        __pyx_t_9 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_7, __pyx_cur_scope->__pyx_v_king) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_king);
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3235, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3235, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_cur_scope->__pyx_v_king_to); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3235, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = PyNumber_Or(__pyx_t_9, __pyx_cur_scope->__pyx_v_bb_g); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3235, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_empty_for_king);
        __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_empty_for_king, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_3 = 0;

        /* "chess/__init__cp.pyx":3234
 *                 if not rook & bb_f:
 *                     empty_for_rook = BB_BETWEEN[candidate][msb(bb_f)] | bb_f
 *                 if not king & bb_g:             # <<<<<<<<<<<<<<
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g
 * 
 */
      }
    }
    __pyx_L10:;

    /* "chess/__init__cp.pyx":3237
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g
 * 
 *             if not ((self.occupied ^ king ^ rook) & (empty_for_king | empty_for_rook) or             # <<<<<<<<<<<<<<
 *                     self._attacked_for_king(empty_for_king, self.occupied ^ king) or
 *                     self._castling_uncovers_rank_attack(rook, king_to)):
 */
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3237, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = PyNumber_Xor(__pyx_t_3, __pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3237, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Xor(__pyx_t_9, __pyx_cur_scope->__pyx_v_rook); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3237, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyNumber_Or(__pyx_cur_scope->__pyx_v_empty_for_king, __pyx_cur_scope->__pyx_v_empty_for_rook); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3237, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_2 = PyNumber_And(__pyx_t_3, __pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3237, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3237, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!__pyx_t_6) {
    } else {
      __pyx_t_4 = __pyx_t_6;
      goto __pyx_L16_bool_binop_done;
    }

    /* "chess/__init__cp.pyx":3238
 * 
 *             if not ((self.occupied ^ king ^ rook) & (empty_for_king | empty_for_rook) or
 *                     self._attacked_for_king(empty_for_king, self.occupied ^ king) or             # <<<<<<<<<<<<<<
 *                     self._castling_uncovers_rank_attack(rook, king_to)):
 *                 yield self._from_chess960(self.chess960, msb(king), candidate)
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_attacked_for_king); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3238, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_cur_scope->__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3238, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = PyNumber_Xor(__pyx_t_3, __pyx_cur_scope->__pyx_v_king); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3238, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_9)) {
      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_empty_for_king, __pyx_t_7};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3238, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_empty_for_king, __pyx_t_7};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3238, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    {
      __pyx_t_12 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 3238, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      if (__pyx_t_3) {
        __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_3); __pyx_t_3 = NULL;
      }
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_empty_for_king);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_empty_for_king);
      PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_8, __pyx_cur_scope->__pyx_v_empty_for_king);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_8, __pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_12, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3238, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3238, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!__pyx_t_6) {
    } else {
      __pyx_t_4 = __pyx_t_6;
      goto __pyx_L16_bool_binop_done;
    }

    /* "chess/__init__cp.pyx":3239
 *             if not ((self.occupied ^ king ^ rook) & (empty_for_king | empty_for_rook) or
 *                     self._attacked_for_king(empty_for_king, self.occupied ^ king) or
 *                     self._castling_uncovers_rank_attack(rook, king_to)):             # <<<<<<<<<<<<<<
 *                 yield self._from_chess960(self.chess960, msb(king), candidate)
 * 
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_castling_uncovers_rank_attack); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3239, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_12 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_12)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_12);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_9)) {
      PyObject *__pyx_temp[3] = {__pyx_t_12, __pyx_cur_scope->__pyx_v_rook, __pyx_cur_scope->__pyx_v_king_to};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3239, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
      PyObject *__pyx_temp[3] = {__pyx_t_12, __pyx_cur_scope->__pyx_v_rook, __pyx_cur_scope->__pyx_v_king_to};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3239, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3239, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_12) {
        __Pyx_GIVEREF(__pyx_t_12); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_12); __pyx_t_12 = NULL;
      }
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_rook);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_rook);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_cur_scope->__pyx_v_rook);
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_king_to);
      __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_king_to);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_cur_scope->__pyx_v_king_to);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3239, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3239, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __pyx_t_6;
    __pyx_L16_bool_binop_done:;

    /* "chess/__init__cp.pyx":3237
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g
 * 
 *             if not ((self.occupied ^ king ^ rook) & (empty_for_king | empty_for_rook) or             # <<<<<<<<<<<<<<
 *                     self._attacked_for_king(empty_for_king, self.occupied ^ king) or
 *                     self._castling_uncovers_rank_attack(rook, king_to)):
 */
    __pyx_t_6 = ((!__pyx_t_4) != 0);
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":3240
 *                     self._attacked_for_king(empty_for_king, self.occupied ^ king) or
 *                     self._castling_uncovers_rank_attack(rook, king_to)):
 *                 yield self._from_chess960(self.chess960, msb(king), candidate)             # <<<<<<<<<<<<<<
 * 
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):
 */
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_from_chess960); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3240, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_cur_scope->__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3240, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_msb); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3240, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_13 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      __pyx_t_12 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_13, __pyx_cur_scope->__pyx_v_king) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_cur_scope->__pyx_v_king);
      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
      if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 3240, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      __pyx_t_8 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
          __pyx_t_8 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_7, __pyx_t_12, __pyx_cur_scope->__pyx_v_candidate};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3240, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_7, __pyx_t_12, __pyx_cur_scope->__pyx_v_candidate};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3240, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      } else
      #endif
      {
        __pyx_t_13 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 3240, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_13);
        if (__pyx_t_3) {
          __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_3); __pyx_t_3 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_8, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_8, __pyx_t_12);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_candidate);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_candidate);
        PyTuple_SET_ITEM(__pyx_t_13, 2+__pyx_t_8, __pyx_cur_scope->__pyx_v_candidate);
        __pyx_t_7 = 0;
        __pyx_t_12 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_13, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3240, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      }
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      __Pyx_XGIVEREF(__pyx_t_1);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_10;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_11;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L19_resume_from_yield:;
      __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_1);
      __pyx_t_10 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_11 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3240, __pyx_L1_error)

      /* "chess/__init__cp.pyx":3237
 *                     empty_for_king = BB_BETWEEN[msb(king)][king_to] | bb_g
 * 
 *             if not ((self.occupied ^ king ^ rook) & (empty_for_king | empty_for_rook) or             # <<<<<<<<<<<<<<
 *                     self._attacked_for_king(empty_for_king, self.occupied ^ king) or
 *                     self._castling_uncovers_rank_attack(rook, king_to)):
 */
    }

    /* "chess/__init__cp.pyx":3216
 *         bb_g = BB_FILE_G & backrank
 * 
 *         for candidate in scan_reversed(self.clean_castling_rights() & backrank & to_mask):             # <<<<<<<<<<<<<<
 *             rook = BB_SQUARES[candidate]
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* "chess/__init__cp.pyx":3201
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */

  /* function exit code */
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("generate_castling_moves", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3242
 *                 yield self._from_chess960(self.chess960, msb(king), candidate)
 * 
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):             # <<<<<<<<<<<<<<
 *         if not chess960 and drop is None:
 *             if from_square == E1 and self.kings & BB_E1:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_179_from_chess960(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_179_from_chess960(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_chess960 = 0;
  PyObject *__pyx_v_from_square = 0;
  PyObject *__pyx_v_to_square = 0;
  PyObject *__pyx_v_promotion = 0;
  PyObject *__pyx_v_drop = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_from_chess960 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_chess960,&__pyx_n_s_from_square,&__pyx_n_s_to_square,&__pyx_n_s_promotion,&__pyx_n_s_drop,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[3] = ((PyObject *)Py_None);
    values[4] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_chess960)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_from_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_from_chess960", 0, 3, 5, 1); __PYX_ERR(0, 3242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_from_chess960", 0, 3, 5, 2); __PYX_ERR(0, 3242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_promotion);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_drop);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_from_chess960") < 0)) __PYX_ERR(0, 3242, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_chess960 = values[0];
    __pyx_v_from_square = values[1];
    __pyx_v_to_square = values[2];
    __pyx_v_promotion = values[3];
    __pyx_v_drop = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_from_chess960", 0, 3, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3242, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board._from_chess960", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_178_from_chess960(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_chess960, __pyx_v_from_square, __pyx_v_to_square, __pyx_v_promotion, __pyx_v_drop);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_178_from_chess960(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_chess960, PyObject *__pyx_v_from_square, PyObject *__pyx_v_to_square, PyObject *__pyx_v_promotion, PyObject *__pyx_v_drop) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("_from_chess960", 0);

  /* "chess/__init__cp.pyx":3243
 * 
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):
 *         if not chess960 and drop is None:             # <<<<<<<<<<<<<<
 *             if from_square == E1 and self.kings & BB_E1:
 *                 if to_square == H1:
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_chess960); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3243, __pyx_L1_error)
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__pyx_v_drop == Py_None);
  __pyx_t_2 = (__pyx_t_3 != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":3244
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):
 *         if not chess960 and drop is None:
 *             if from_square == E1 and self.kings & BB_E1:             # <<<<<<<<<<<<<<
 *                 if to_square == H1:
 *                     return Move(E1, G1)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_E1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_from_square, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_2) {
    } else {
      __pyx_t_1 = __pyx_t_2;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_E1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = PyNumber_And(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3244, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_1 = __pyx_t_2;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3245
 *         if not chess960 and drop is None:
 *             if from_square == E1 and self.kings & BB_E1:
 *                 if to_square == H1:             # <<<<<<<<<<<<<<
 *                     return Move(E1, G1)
 *                 elif to_square == A1:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_H1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3245, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_to_square, __pyx_t_6, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3245, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3245, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":3246
 *             if from_square == E1 and self.kings & BB_E1:
 *                 if to_square == H1:
 *                     return Move(E1, G1)             # <<<<<<<<<<<<<<
 *                 elif to_square == A1:
 *                     return Move(E1, C1)
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_E1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3246, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_G1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3246, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3246, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6);
        __pyx_t_4 = 0;
        __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_5, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3246, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_6;
        __pyx_t_6 = 0;
        goto __pyx_L0;

        /* "chess/__init__cp.pyx":3245
 *         if not chess960 and drop is None:
 *             if from_square == E1 and self.kings & BB_E1:
 *                 if to_square == H1:             # <<<<<<<<<<<<<<
 *                     return Move(E1, G1)
 *                 elif to_square == A1:
 */
      }

      /* "chess/__init__cp.pyx":3247
 *                 if to_square == H1:
 *                     return Move(E1, G1)
 *                 elif to_square == A1:             # <<<<<<<<<<<<<<
 *                     return Move(E1, C1)
 *             elif from_square == E8 and self.kings & BB_E8:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_A1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3247, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_to_square, __pyx_t_6, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3247, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3247, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":3248
 *                     return Move(E1, G1)
 *                 elif to_square == A1:
 *                     return Move(E1, C1)             # <<<<<<<<<<<<<<
 *             elif from_square == E8 and self.kings & BB_E8:
 *                 if to_square == H8:
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_E1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3248, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_C1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3248, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3248, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_6);
        __pyx_t_5 = 0;
        __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3248, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_6;
        __pyx_t_6 = 0;
        goto __pyx_L0;

        /* "chess/__init__cp.pyx":3247
 *                 if to_square == H1:
 *                     return Move(E1, G1)
 *                 elif to_square == A1:             # <<<<<<<<<<<<<<
 *                     return Move(E1, C1)
 *             elif from_square == E8 and self.kings & BB_E8:
 */
      }

      /* "chess/__init__cp.pyx":3244
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):
 *         if not chess960 and drop is None:
 *             if from_square == E1 and self.kings & BB_E1:             # <<<<<<<<<<<<<<
 *                 if to_square == H1:
 *                     return Move(E1, G1)
 */
      goto __pyx_L6;
    }

    /* "chess/__init__cp.pyx":3249
 *                 elif to_square == A1:
 *                     return Move(E1, C1)
 *             elif from_square == E8 and self.kings & BB_E8:             # <<<<<<<<<<<<<<
 *                 if to_square == H8:
 *                     return Move(E8, G8)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_E8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = PyObject_RichCompare(__pyx_v_from_square, __pyx_t_6, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_2) {
    } else {
      __pyx_t_1 = __pyx_t_2;
      goto __pyx_L10_bool_binop_done;
    }
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_E8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = PyNumber_And(__pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3249, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_1 = __pyx_t_2;
    __pyx_L10_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3250
 *                     return Move(E1, C1)
 *             elif from_square == E8 and self.kings & BB_E8:
 *                 if to_square == H8:             # <<<<<<<<<<<<<<
 *                     return Move(E8, G8)
 *                 elif to_square == A8:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_H8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3250, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_v_to_square, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3250, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3250, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":3251
 *             elif from_square == E8 and self.kings & BB_E8:
 *                 if to_square == H8:
 *                     return Move(E8, G8)             # <<<<<<<<<<<<<<
 *                 elif to_square == A8:
 *                     return Move(E8, C8)
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_E8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3251, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_G8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3251, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3251, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
        __pyx_t_6 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3251, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_5;
        __pyx_t_5 = 0;
        goto __pyx_L0;

        /* "chess/__init__cp.pyx":3250
 *                     return Move(E1, C1)
 *             elif from_square == E8 and self.kings & BB_E8:
 *                 if to_square == H8:             # <<<<<<<<<<<<<<
 *                     return Move(E8, G8)
 *                 elif to_square == A8:
 */
      }

      /* "chess/__init__cp.pyx":3252
 *                 if to_square == H8:
 *                     return Move(E8, G8)
 *                 elif to_square == A8:             # <<<<<<<<<<<<<<
 *                     return Move(E8, C8)
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_A8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3252, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_to_square, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3252, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 3252, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_1) {

        /* "chess/__init__cp.pyx":3253
 *                     return Move(E8, G8)
 *                 elif to_square == A8:
 *                     return Move(E8, C8)             # <<<<<<<<<<<<<<
 * 
 *         return Move(from_square, to_square, promotion, drop)
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_E8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3253, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_C8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3253, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3253, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_5);
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3253, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_r = __pyx_t_5;
        __pyx_t_5 = 0;
        goto __pyx_L0;

        /* "chess/__init__cp.pyx":3252
 *                 if to_square == H8:
 *                     return Move(E8, G8)
 *                 elif to_square == A8:             # <<<<<<<<<<<<<<
 *                     return Move(E8, C8)
 * 
 */
      }

      /* "chess/__init__cp.pyx":3249
 *                 elif to_square == A1:
 *                     return Move(E1, C1)
 *             elif from_square == E8 and self.kings & BB_E8:             # <<<<<<<<<<<<<<
 *                 if to_square == H8:
 *                     return Move(E8, G8)
 */
    }
    __pyx_L6:;

    /* "chess/__init__cp.pyx":3243
 * 
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):
 *         if not chess960 and drop is None:             # <<<<<<<<<<<<<<
 *             if from_square == E1 and self.kings & BB_E1:
 *                 if to_square == H1:
 */
  }

  /* "chess/__init__cp.pyx":3255
 *                     return Move(E8, C8)
 * 
 *         return Move(from_square, to_square, promotion, drop)             # <<<<<<<<<<<<<<
 * 
 *     def _to_chess960(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_v_from_square);
  __Pyx_GIVEREF(__pyx_v_from_square);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_from_square);
  __Pyx_INCREF(__pyx_v_to_square);
  __Pyx_GIVEREF(__pyx_v_to_square);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_to_square);
  __Pyx_INCREF(__pyx_v_promotion);
  __Pyx_GIVEREF(__pyx_v_promotion);
  PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_promotion);
  __Pyx_INCREF(__pyx_v_drop);
  __Pyx_GIVEREF(__pyx_v_drop);
  PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_v_drop);
  __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_5, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3242
 *                 yield self._from_chess960(self.chess960, msb(king), candidate)
 * 
 *     def _from_chess960(self, chess960, from_square, to_square, promotion=None, drop=None):             # <<<<<<<<<<<<<<
 *         if not chess960 and drop is None:
 *             if from_square == E1 and self.kings & BB_E1:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Board._from_chess960", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3257
 *         return Move(from_square, to_square, promotion, drop)
 * 
 *     def _to_chess960(self, move):             # <<<<<<<<<<<<<<
 *         if move.from_square == E1 and self.kings & BB_E1:
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_181_to_chess960(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_181_to_chess960(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_to_chess960 (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_180_to_chess960(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_180_to_chess960(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_move) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("_to_chess960", 0);

  /* "chess/__init__cp.pyx":3258
 * 
 *     def _to_chess960(self, move):
 *         if move.from_square == E1 and self.kings & BB_E1:             # <<<<<<<<<<<<<<
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 *                 return Move(E1, H1)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_E1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {
  } else {
    __pyx_t_1 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_E1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3258, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_1 = __pyx_t_5;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":3259
 *     def _to_chess960(self, move):
 *         if move.from_square == E1 and self.kings & BB_E1:
 *             if move.to_square == G1 and not self.rooks & BB_G1:             # <<<<<<<<<<<<<<
 *                 return Move(E1, H1)
 *             elif move.to_square == C1 and not self.rooks & BB_C1:
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_G1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_G1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3259, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = ((!__pyx_t_5) != 0);
    __pyx_t_1 = __pyx_t_6;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3260
 *         if move.from_square == E1 and self.kings & BB_E1:
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 *                 return Move(E1, H1)             # <<<<<<<<<<<<<<
 *             elif move.to_square == C1 and not self.rooks & BB_C1:
 *                 return Move(E1, A1)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_E1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_H1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3259
 *     def _to_chess960(self, move):
 *         if move.from_square == E1 and self.kings & BB_E1:
 *             if move.to_square == G1 and not self.rooks & BB_G1:             # <<<<<<<<<<<<<<
 *                 return Move(E1, H1)
 *             elif move.to_square == C1 and not self.rooks & BB_C1:
 */
    }

    /* "chess/__init__cp.pyx":3261
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 *                 return Move(E1, H1)
 *             elif move.to_square == C1 and not self.rooks & BB_C1:             # <<<<<<<<<<<<<<
 *                 return Move(E1, A1)
 *         elif move.from_square == E8 and self.kings & BB_E8:
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_C1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_6) {
    } else {
      __pyx_t_1 = __pyx_t_6;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_BB_C1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3261, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = ((!__pyx_t_6) != 0);
    __pyx_t_1 = __pyx_t_5;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3262
 *                 return Move(E1, H1)
 *             elif move.to_square == C1 and not self.rooks & BB_C1:
 *                 return Move(E1, A1)             # <<<<<<<<<<<<<<
 *         elif move.from_square == E8 and self.kings & BB_E8:
 *             if move.to_square == G8 and not self.rooks & BB_G8:
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_E1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3262, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_A1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3262, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3262, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_4);
      __pyx_t_3 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3262, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_4;
      __pyx_t_4 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3261
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 *                 return Move(E1, H1)
 *             elif move.to_square == C1 and not self.rooks & BB_C1:             # <<<<<<<<<<<<<<
 *                 return Move(E1, A1)
 *         elif move.from_square == E8 and self.kings & BB_E8:
 */
    }

    /* "chess/__init__cp.pyx":3258
 * 
 *     def _to_chess960(self, move):
 *         if move.from_square == E1 and self.kings & BB_E1:             # <<<<<<<<<<<<<<
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 *                 return Move(E1, H1)
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":3263
 *             elif move.to_square == C1 and not self.rooks & BB_C1:
 *                 return Move(E1, A1)
 *         elif move.from_square == E8 and self.kings & BB_E8:             # <<<<<<<<<<<<<<
 *             if move.to_square == G8 and not self.rooks & BB_G8:
 *                 return Move(E8, H8)
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_from_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_E8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {
  } else {
    __pyx_t_1 = __pyx_t_5;
    goto __pyx_L11_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_E8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3263, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = __pyx_t_5;
  __pyx_L11_bool_binop_done:;
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":3264
 *                 return Move(E1, A1)
 *         elif move.from_square == E8 and self.kings & BB_E8:
 *             if move.to_square == G8 and not self.rooks & BB_G8:             # <<<<<<<<<<<<<<
 *                 return Move(E8, H8)
 *             elif move.to_square == C8 and not self.rooks & BB_C8:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_G8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L14_bool_binop_done;
    }
    __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_G8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyNumber_And(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3264, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = ((!__pyx_t_5) != 0);
    __pyx_t_1 = __pyx_t_6;
    __pyx_L14_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3265
 *         elif move.from_square == E8 and self.kings & BB_E8:
 *             if move.to_square == G8 and not self.rooks & BB_G8:
 *                 return Move(E8, H8)             # <<<<<<<<<<<<<<
 *             elif move.to_square == C8 and not self.rooks & BB_C8:
 *                 return Move(E8, A8)
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_E8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3265, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_H8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3265, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3265, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
      __pyx_t_4 = 0;
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3265, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3264
 *                 return Move(E1, A1)
 *         elif move.from_square == E8 and self.kings & BB_E8:
 *             if move.to_square == G8 and not self.rooks & BB_G8:             # <<<<<<<<<<<<<<
 *                 return Move(E8, H8)
 *             elif move.to_square == C8 and not self.rooks & BB_C8:
 */
    }

    /* "chess/__init__cp.pyx":3266
 *             if move.to_square == G8 and not self.rooks & BB_G8:
 *                 return Move(E8, H8)
 *             elif move.to_square == C8 and not self.rooks & BB_C8:             # <<<<<<<<<<<<<<
 *                 return Move(E8, A8)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_move, __pyx_n_s_to_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_C8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_6) {
    } else {
      __pyx_t_1 = __pyx_t_6;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_BB_C8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3266, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = ((!__pyx_t_6) != 0);
    __pyx_t_1 = __pyx_t_5;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_1) {

      /* "chess/__init__cp.pyx":3267
 *                 return Move(E8, H8)
 *             elif move.to_square == C8 and not self.rooks & BB_C8:
 *                 return Move(E8, A8)             # <<<<<<<<<<<<<<
 * 
 *         return move
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_E8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3267, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_A8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3267, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3267, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3267, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L0;

      /* "chess/__init__cp.pyx":3266
 *             if move.to_square == G8 and not self.rooks & BB_G8:
 *                 return Move(E8, H8)
 *             elif move.to_square == C8 and not self.rooks & BB_C8:             # <<<<<<<<<<<<<<
 *                 return Move(E8, A8)
 * 
 */
    }

    /* "chess/__init__cp.pyx":3263
 *             elif move.to_square == C1 and not self.rooks & BB_C1:
 *                 return Move(E1, A1)
 *         elif move.from_square == E8 and self.kings & BB_E8:             # <<<<<<<<<<<<<<
 *             if move.to_square == G8 and not self.rooks & BB_G8:
 *                 return Move(E8, H8)
 */
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":3269
 *                 return Move(E8, A8)
 * 
 *         return move             # <<<<<<<<<<<<<<
 * 
 *     def _transposition_key(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_move);
  __pyx_r = __pyx_v_move;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3257
 *         return Move(from_square, to_square, promotion, drop)
 * 
 *     def _to_chess960(self, move):             # <<<<<<<<<<<<<<
 *         if move.from_square == E1 and self.kings & BB_E1:
 *             if move.to_square == G1 and not self.rooks & BB_G1:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.Board._to_chess960", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3271
 *         return move
 * 
 *     def _transposition_key(self):             # <<<<<<<<<<<<<<
 *         return (self.pawns, self.knights, self.bishops, self.rooks,
 *                 self.queens, self.kings,
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_183_transposition_key(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_183_transposition_key(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_transposition_key (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_182_transposition_key(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_182_transposition_key(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_t_15;
  __Pyx_RefNannySetupContext("_transposition_key", 0);

  /* "chess/__init__cp.pyx":3272
 * 
 *     def _transposition_key(self):
 *         return (self.pawns, self.knights, self.bishops, self.rooks,             # <<<<<<<<<<<<<<
 *                 self.queens, self.kings,
 *                 self.occupied_co[WHITE], self.occupied_co[BLACK],
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.pawns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.knights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.bishops); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "chess/__init__cp.pyx":3273
 *     def _transposition_key(self):
 *         return (self.pawns, self.knights, self.bishops, self.rooks,
 *                 self.queens, self.kings,             # <<<<<<<<<<<<<<
 *                 self.occupied_co[WHITE], self.occupied_co[BLACK],
 *                 self.turn, self.clean_castling_rights(),
 */
  __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.queens); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3273, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3273, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);

  /* "chess/__init__cp.pyx":3274
 *         return (self.pawns, self.knights, self.bishops, self.rooks,
 *                 self.queens, self.kings,
 *                 self.occupied_co[WHITE], self.occupied_co[BLACK],             # <<<<<<<<<<<<<<
 *                 self.turn, self.clean_castling_rights(),
 *                 self.ep_square if self.has_legal_en_passant() else None)
 */
  __pyx_t_7 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[1])); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3274, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_self->__pyx_base.occupied_co[0])); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3274, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);

  /* "chess/__init__cp.pyx":3275
 *                 self.queens, self.kings,
 *                 self.occupied_co[WHITE], self.occupied_co[BLACK],
 *                 self.turn, self.clean_castling_rights(),             # <<<<<<<<<<<<<<
 *                 self.ep_square if self.has_legal_en_passant() else None)
 * 
 */
  __pyx_t_9 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3275, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clean_castling_rights); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 3275, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_12)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_12);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  __pyx_t_10 = (__pyx_t_12) ? __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_12) : __Pyx_PyObject_CallNoArg(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
  if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3275, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

  /* "chess/__init__cp.pyx":3276
 *                 self.occupied_co[WHITE], self.occupied_co[BLACK],
 *                 self.turn, self.clean_castling_rights(),
 *                 self.ep_square if self.has_legal_en_passant() else None)             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_has_legal_en_passant); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 3276, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_13);
  __pyx_t_14 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
    __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
    if (likely(__pyx_t_14)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
      __Pyx_INCREF(__pyx_t_14);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_13, function);
    }
  }
  __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_14) : __Pyx_PyObject_CallNoArg(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
  if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 3276, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_12); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 3276, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  if (__pyx_t_15) {
    __Pyx_INCREF(__pyx_v_self->__pyx_base.ep_square);
    __pyx_t_11 = __pyx_v_self->__pyx_base.ep_square;
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_11 = Py_None;
  }

  /* "chess/__init__cp.pyx":3272
 * 
 *     def _transposition_key(self):
 *         return (self.pawns, self.knights, self.bishops, self.rooks,             # <<<<<<<<<<<<<<
 *                 self.queens, self.kings,
 *                 self.occupied_co[WHITE], self.occupied_co[BLACK],
 */
  __pyx_t_12 = PyTuple_New(11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 3272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_12, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_12, 4, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_12, 5, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_12, 6, __pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_12, 7, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_12, 8, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_12, 9, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_12, 10, __pyx_t_11);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_r = __pyx_t_12;
  __pyx_t_12 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3271
 *         return move
 * 
 *     def _transposition_key(self):             # <<<<<<<<<<<<<<
 *         return (self.pawns, self.knights, self.bishops, self.rooks,
 *                 self.queens, self.kings,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("chess.__init__cp.Board._transposition_key", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3278
 *                 self.ep_square if self.has_legal_en_passant() else None)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         if not self.chess960:
 *             return "{}('{}')".format(type(self).__name__, self.fen())
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_185__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_185__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_184__repr__(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_184__repr__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "chess/__init__cp.pyx":3279
 * 
 *     def __repr__(self):
 *         if not self.chess960:             # <<<<<<<<<<<<<<
 *             return "{}('{}')".format(type(self).__name__, self.fen())
 *         else:
 */
  __pyx_t_1 = ((!(__pyx_v_self->__pyx_base.chess960 != 0)) != 0);
  if (__pyx_t_1) {

    /* "chess/__init__cp.pyx":3280
 *     def __repr__(self):
 *         if not self.chess960:
 *             return "{}('{}')".format(type(self).__name__, self.fen())             # <<<<<<<<<<<<<<
 *         else:
 *             return "{}('{}', chess960=True)".format(type(self).__name__, self.fen())
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__15, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3280, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3280, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_fen); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3280, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3280, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_t_5};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3280, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_t_5};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3280, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3280, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_6) {
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_t_5);
      __pyx_t_4 = 0;
      __pyx_t_5 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3280, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "chess/__init__cp.pyx":3279
 * 
 *     def __repr__(self):
 *         if not self.chess960:             # <<<<<<<<<<<<<<
 *             return "{}('{}')".format(type(self).__name__, self.fen())
 *         else:
 */
  }

  /* "chess/__init__cp.pyx":3282
 *             return "{}('{}')".format(type(self).__name__, self.fen())
 *         else:
 *             return "{}('{}', chess960=True)".format(type(self).__name__, self.fen())             # <<<<<<<<<<<<<<
 * 
 *     def _repr_svg_(self):
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_chess960_True, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3282, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_n_s_name); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3282, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_fen); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3282, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3282, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_7, __pyx_t_5};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3282, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_7, __pyx_t_5};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3282, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    {
      __pyx_t_6 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3282, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_8, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_8, __pyx_t_5);
      __pyx_t_7 = 0;
      __pyx_t_5 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3282, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":3278
 *                 self.ep_square if self.has_legal_en_passant() else None)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         if not self.chess960:
 *             return "{}('{}')".format(type(self).__name__, self.fen())
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.Board.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3284
 *             return "{}('{}', chess960=True)".format(type(self).__name__, self.fen())
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         lastmove = self.peek() if self.move_stack else None
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_187_repr_svg_(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_187_repr_svg_(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_repr_svg_ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_186_repr_svg_(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_186_repr_svg_(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_chess = NULL;
  PyObject *__pyx_v_lastmove = NULL;
  PyObject *__pyx_v_check = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("_repr_svg_", 0);

  /* "chess/__init__cp.pyx":3285
 * 
 *     def _repr_svg_(self):
 *         import chess.svg             # <<<<<<<<<<<<<<
 *         lastmove = self.peek() if self.move_stack else None
 *         check = self.king(self.turn) if self.is_check() else None
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_chess_svg, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3285, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_chess = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3286
 *     def _repr_svg_(self):
 *         import chess.svg
 *         lastmove = self.peek() if self.move_stack else None             # <<<<<<<<<<<<<<
 *         check = self.king(self.turn) if self.is_check() else None
 *         return chess.svg.board(board=self, lastmove=lastmove, check=check, size=400)
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_self->__pyx_base.move_stack); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3286, __pyx_L1_error)
  if (__pyx_t_2) {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_peek); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_1 = Py_None;
  }
  __pyx_v_lastmove = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3287
 *         import chess.svg
 *         lastmove = self.peek() if self.move_stack else None
 *         check = self.king(self.turn) if self.is_check() else None             # <<<<<<<<<<<<<<
 *         return chess.svg.board(board=self, lastmove=lastmove, check=check, size=400)
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_is_check); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3287, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_king); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3287, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3287, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3287, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_1 = Py_None;
  }
  __pyx_v_check = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3288
 *         lastmove = self.peek() if self.move_stack else None
 *         check = self.king(self.turn) if self.is_check() else None
 *         return chess.svg.board(board=self, lastmove=lastmove, check=check, size=400)             # <<<<<<<<<<<<<<
 * 
 *     def __ne__(self, board):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_chess, __pyx_n_s_svg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3288, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_board); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3288, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3288, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_board, ((PyObject *)__pyx_v_self)) < 0) __PYX_ERR(0, 3288, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_lastmove, __pyx_v_lastmove) < 0) __PYX_ERR(0, 3288, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_check, __pyx_v_check) < 0) __PYX_ERR(0, 3288, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_size, __pyx_int_400) < 0) __PYX_ERR(0, 3288, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3288, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3284
 *             return "{}('{}', chess960=True)".format(type(self).__name__, self.fen())
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         lastmove = self.peek() if self.move_stack else None
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.Board._repr_svg_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_chess);
  __Pyx_XDECREF(__pyx_v_lastmove);
  __Pyx_XDECREF(__pyx_v_check);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3290
 *         return chess.svg.board(board=self, lastmove=lastmove, check=check, size=400)
 * 
 *     def __ne__(self, board):             # <<<<<<<<<<<<<<
 *         # Compare positions (including move counters), but excluding history.
 *         try:
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_189__ne__(PyObject *__pyx_v_self, PyObject *__pyx_v_board); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_189__ne__(PyObject *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ne__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_188__ne__(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_board));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_188__ne__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_board) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("__ne__", 0);

  /* "chess/__init__cp.pyx":3292
 *     def __ne__(self, board):
 *         # Compare positions (including move counters), but excluding history.
 *         try:             # <<<<<<<<<<<<<<
 *             if self.halfmove_clock != board.halfmove_clock:
 *                 return True
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":3293
 *         # Compare positions (including move counters), but excluding history.
 *         try:
 *             if self.halfmove_clock != board.halfmove_clock:             # <<<<<<<<<<<<<<
 *                 return True
 *             if self.fullmove_number != board.fullmove_number:
 */
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.halfmove_clock); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3293, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_halfmove_clock); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3293, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3293, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3293, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":3294
 *         try:
 *             if self.halfmove_clock != board.halfmove_clock:
 *                 return True             # <<<<<<<<<<<<<<
 *             if self.fullmove_number != board.fullmove_number:
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":3293
 *         # Compare positions (including move counters), but excluding history.
 *         try:
 *             if self.halfmove_clock != board.halfmove_clock:             # <<<<<<<<<<<<<<
 *                 return True
 *             if self.fullmove_number != board.fullmove_number:
 */
      }

      /* "chess/__init__cp.pyx":3295
 *             if self.halfmove_clock != board.halfmove_clock:
 *                 return True
 *             if self.fullmove_number != board.fullmove_number:             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.fullmove_number); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3295, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_fullmove_number); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3295, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3295, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3295, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":3296
 *                 return True
 *             if self.fullmove_number != board.fullmove_number:
 *                 return True             # <<<<<<<<<<<<<<
 * 
 *             if type(self).uci_variant != type(board).uci_variant:
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":3295
 *             if self.halfmove_clock != board.halfmove_clock:
 *                 return True
 *             if self.fullmove_number != board.fullmove_number:             # <<<<<<<<<<<<<<
 *                 return True
 * 
 */
      }

      /* "chess/__init__cp.pyx":3298
 *                 return True
 * 
 *             if type(self).uci_variant != type(board).uci_variant:             # <<<<<<<<<<<<<<
 *                 return True
 *             if self._transposition_key() != board._transposition_key():
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_n_s_uci_variant); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3298, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_board)), __pyx_n_s_uci_variant); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3298, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3298, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3298, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":3299
 * 
 *             if type(self).uci_variant != type(board).uci_variant:
 *                 return True             # <<<<<<<<<<<<<<
 *             if self._transposition_key() != board._transposition_key():
 *                 return True
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":3298
 *                 return True
 * 
 *             if type(self).uci_variant != type(board).uci_variant:             # <<<<<<<<<<<<<<
 *                 return True
 *             if self._transposition_key() != board._transposition_key():
 */
      }

      /* "chess/__init__cp.pyx":3300
 *             if type(self).uci_variant != type(board).uci_variant:
 *                 return True
 *             if self._transposition_key() != board._transposition_key():             # <<<<<<<<<<<<<<
 *                 return True
 *         except AttributeError:
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3300, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3300, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_transposition_key); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3300, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3300, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3300, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3300, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_7) {

        /* "chess/__init__cp.pyx":3301
 *                 return True
 *             if self._transposition_key() != board._transposition_key():
 *                 return True             # <<<<<<<<<<<<<<
 *         except AttributeError:
 *             return NotImplemented
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_True);
        __pyx_r = Py_True;
        goto __pyx_L7_try_return;

        /* "chess/__init__cp.pyx":3300
 *             if type(self).uci_variant != type(board).uci_variant:
 *                 return True
 *             if self._transposition_key() != board._transposition_key():             # <<<<<<<<<<<<<<
 *                 return True
 *         except AttributeError:
 */
      }

      /* "chess/__init__cp.pyx":3292
 *     def __ne__(self, board):
 *         # Compare positions (including move counters), but excluding history.
 *         try:             # <<<<<<<<<<<<<<
 *             if self.halfmove_clock != board.halfmove_clock:
 *                 return True
 */
    }

    /* "chess/__init__cp.pyx":3305
 *             return NotImplemented
 *         else:
 *             return False             # <<<<<<<<<<<<<<
 * 
 *     def apply_transform(self, f):
 */
    /*else:*/ {
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_False);
      __pyx_r = Py_False;
      goto __pyx_L6_except_return;
    }
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "chess/__init__cp.pyx":3302
 *             if self._transposition_key() != board._transposition_key():
 *                 return True
 *         except AttributeError:             # <<<<<<<<<<<<<<
 *             return NotImplemented
 *         else:
 */
    __pyx_t_9 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AttributeError);
    if (__pyx_t_9) {
      __Pyx_AddTraceback("chess.__init__cp.Board.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6) < 0) __PYX_ERR(0, 3302, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);

      /* "chess/__init__cp.pyx":3303
 *                 return True
 *         except AttributeError:
 *             return NotImplemented             # <<<<<<<<<<<<<<
 *         else:
 *             return False
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_builtin_NotImplemented);
      __pyx_r = __pyx_builtin_NotImplemented;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L6_except_return;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":3292
 *     def __ne__(self, board):
 *         # Compare positions (including move counters), but excluding history.
 *         try:             # <<<<<<<<<<<<<<
 *             if self.halfmove_clock != board.halfmove_clock:
 *                 return True
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L6_except_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":3290
 *         return chess.svg.board(board=self, lastmove=lastmove, check=check, size=400)
 * 
 *     def __ne__(self, board):             # <<<<<<<<<<<<<<
 *         # Compare positions (including move counters), but excluding history.
 *         try:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Board.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3307
 *             return False
 * 
 *     def apply_transform(self, f):             # <<<<<<<<<<<<<<
 *         super().apply_transform(f)
 *         self.clear_stack()
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_191apply_transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_191apply_transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("apply_transform (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_190apply_transform(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_f));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_190apply_transform(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("apply_transform", 0);

  /* "chess/__init__cp.pyx":3308
 * 
 *     def apply_transform(self, f):
 *         super().apply_transform(f)             # <<<<<<<<<<<<<<
 *         self.clear_stack()
 * 
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3308, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3308, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_apply_transform); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3308, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_f) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_f);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3308, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3309
 *     def apply_transform(self, f):
 *         super().apply_transform(f)
 *         self.clear_stack()             # <<<<<<<<<<<<<<
 * 
 *     def transform(self, f):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_clear_stack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3309, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3309, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3307
 *             return False
 * 
 *     def apply_transform(self, f):             # <<<<<<<<<<<<<<
 *         super().apply_transform(f)
 *         self.clear_stack()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.apply_transform", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3311
 *         self.clear_stack()
 * 
 *     def transform(self, f):             # <<<<<<<<<<<<<<
 *         board = self.copy(stack=False)
 *         board.apply_transform(f)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_193transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_193transform(PyObject *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("transform (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_192transform(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v_f));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_192transform(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("transform", 0);

  /* "chess/__init__cp.pyx":3312
 * 
 *     def transform(self, f):
 *         board = self.copy(stack=False)             # <<<<<<<<<<<<<<
 *         board.apply_transform(f)
 *         board.ep_square = None if self.ep_square is None else msb(f(BB_SQUARES[self.ep_square]))
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3312, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3312, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_stack, Py_False) < 0) __PYX_ERR(0, 3312, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3312, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3313
 *     def transform(self, f):
 *         board = self.copy(stack=False)
 *         board.apply_transform(f)             # <<<<<<<<<<<<<<
 *         board.ep_square = None if self.ep_square is None else msb(f(BB_SQUARES[self.ep_square]))
 *         board.castling_rights = f(self.castling_rights)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_apply_transform); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3313, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_v_f) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_f);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3313, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3314
 *         board = self.copy(stack=False)
 *         board.apply_transform(f)
 *         board.ep_square = None if self.ep_square is None else msb(f(BB_SQUARES[self.ep_square]))             # <<<<<<<<<<<<<<
 *         board.castling_rights = f(self.castling_rights)
 *         return board
 */
  __pyx_t_4 = (__pyx_v_self->__pyx_base.ep_square == Py_None);
  if ((__pyx_t_4 != 0)) {
    __Pyx_INCREF(Py_None);
    __pyx_t_3 = Py_None;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_msb); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_self->__pyx_base.ep_square); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_INCREF(__pyx_v_f);
    __pyx_t_6 = __pyx_v_f; __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_8, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_ep_square, __pyx_t_3) < 0) __PYX_ERR(0, 3314, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3315
 *         board.apply_transform(f)
 *         board.ep_square = None if self.ep_square is None else msb(f(BB_SQUARES[self.ep_square]))
 *         board.castling_rights = f(self.castling_rights)             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_f);
  __pyx_t_1 = __pyx_v_f; __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_castling_rights, __pyx_t_3) < 0) __PYX_ERR(0, 3315, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3316
 *         board.ep_square = None if self.ep_square is None else msb(f(BB_SQUARES[self.ep_square]))
 *         board.castling_rights = f(self.castling_rights)
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     def mirror(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3311
 *         self.clear_stack()
 * 
 *     def transform(self, f):             # <<<<<<<<<<<<<<
 *         board = self.copy(stack=False)
 *         board.apply_transform(f)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.Board.transform", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3318
 *         return board
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         board = super().mirror()
 *         board.turn = not self.turn
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_195mirror(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_195mirror(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_194mirror(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_194mirror(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("mirror", 0);

  /* "chess/__init__cp.pyx":3319
 * 
 *     def mirror(self):
 *         board = super().mirror()             # <<<<<<<<<<<<<<
 *         board.turn = not self.turn
 *         return board
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_mirror); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3320
 *     def mirror(self):
 *         board = super().mirror()
 *         board.turn = not self.turn             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong((!(__pyx_v_self->__pyx_base.turn != 0))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_turn, __pyx_t_1) < 0) __PYX_ERR(0, 3320, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3321
 *         board = super().mirror()
 *         board.turn = not self.turn
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     def copy(self, *, stack=True):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3318
 *         return board
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         board = super().mirror()
 *         board.turn = not self.turn
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.mirror", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3323
 *         return board
 * 
 *     def copy(self, *, stack=True):             # <<<<<<<<<<<<<<
 *         board = super().copy()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_197copy(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_197copy(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_stack = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("copy (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_stack,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args == 1) {
        const Py_ssize_t index = 0;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "copy") < 0)) __PYX_ERR(0, 3323, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_stack = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("copy", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3323, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.copy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_196copy(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), __pyx_v_stack);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_196copy(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v_stack) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("copy", 0);

  /* "chess/__init__cp.pyx":3324
 * 
 *     def copy(self, *, stack=True):
 *         board = super().copy()             # <<<<<<<<<<<<<<
 * 
 *         board.chess960 = self.chess960
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_5chess_10__init__cp_Board));
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_super, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_copy_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3326
 *         board = super().copy()
 * 
 *         board.chess960 = self.chess960             # <<<<<<<<<<<<<<
 * 
 *         board.ep_square = self.ep_square
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3326, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_chess960, __pyx_t_1) < 0) __PYX_ERR(0, 3326, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3328
 *         board.chess960 = self.chess960
 * 
 *         board.ep_square = self.ep_square             # <<<<<<<<<<<<<<
 *         board.castling_rights = self.castling_rights
 *         board.turn = self.turn
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base.ep_square;
  __Pyx_INCREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_ep_square, __pyx_t_1) < 0) __PYX_ERR(0, 3328, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3329
 * 
 *         board.ep_square = self.ep_square
 *         board.castling_rights = self.castling_rights             # <<<<<<<<<<<<<<
 *         board.turn = self.turn
 *         board.fullmove_number = self.fullmove_number
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3329, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_castling_rights, __pyx_t_1) < 0) __PYX_ERR(0, 3329, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3330
 *         board.ep_square = self.ep_square
 *         board.castling_rights = self.castling_rights
 *         board.turn = self.turn             # <<<<<<<<<<<<<<
 *         board.fullmove_number = self.fullmove_number
 *         board.halfmove_clock = self.halfmove_clock
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3330, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_turn, __pyx_t_1) < 0) __PYX_ERR(0, 3330, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3331
 *         board.castling_rights = self.castling_rights
 *         board.turn = self.turn
 *         board.fullmove_number = self.fullmove_number             # <<<<<<<<<<<<<<
 *         board.halfmove_clock = self.halfmove_clock
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.fullmove_number); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3331, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_fullmove_number, __pyx_t_1) < 0) __PYX_ERR(0, 3331, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3332
 *         board.turn = self.turn
 *         board.fullmove_number = self.fullmove_number
 *         board.halfmove_clock = self.halfmove_clock             # <<<<<<<<<<<<<<
 * 
 *         if stack:
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.halfmove_clock); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3332, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_halfmove_clock, __pyx_t_1) < 0) __PYX_ERR(0, 3332, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3334
 *         board.halfmove_clock = self.halfmove_clock
 * 
 *         if stack:             # <<<<<<<<<<<<<<
 *             board.move_stack = copy.deepcopy(self.move_stack)
 *             board.stack = copy.copy(self.stack)
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_stack); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3334, __pyx_L1_error)
  if (__pyx_t_4) {

    /* "chess/__init__cp.pyx":3335
 * 
 *         if stack:
 *             board.move_stack = copy.deepcopy(self.move_stack)             # <<<<<<<<<<<<<<
 *             board.stack = copy.copy(self.stack)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_copy_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_self->__pyx_base.move_stack) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_self->__pyx_base.move_stack);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_move_stack, __pyx_t_1) < 0) __PYX_ERR(0, 3335, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3336
 *         if stack:
 *             board.move_stack = copy.deepcopy(self.move_stack)
 *             board.stack = copy.copy(self.stack)             # <<<<<<<<<<<<<<
 * 
 *         return board
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_copy_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3336, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_copy_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3336, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_self->__pyx_base.stack) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_self->__pyx_base.stack);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3336, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__Pyx_PyObject_SetAttrStr(__pyx_v_board, __pyx_n_s_stack, __pyx_t_1) < 0) __PYX_ERR(0, 3336, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3334
 *         board.halfmove_clock = self.halfmove_clock
 * 
 *         if stack:             # <<<<<<<<<<<<<<
 *             board.move_stack = copy.deepcopy(self.move_stack)
 *             board.stack = copy.copy(self.stack)
 */
  }

  /* "chess/__init__cp.pyx":3338
 *             board.stack = copy.copy(self.stack)
 * 
 *         return board             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3323
 *         return board
 * 
 *     def copy(self, *, stack=True):             # <<<<<<<<<<<<<<
 *         board = super().copy()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.copy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3341
 * 
 *     @classmethod
 *     def empty(cls, *, chess960=False):             # <<<<<<<<<<<<<<
 *         """Creates a new empty board. Also see :func:`~chess.Board.clear()`."""
 *         return cls(None, chess960=chess960)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_199empty(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_198empty[] = "Creates a new empty board. Also see :func:`~chess.Board.clear()`.";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_199empty(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_chess960 = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("empty (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_chess960,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      if (kw_args == 1) {
        const Py_ssize_t index = 0;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "empty") < 0)) __PYX_ERR(0, 3341, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 0) {
      goto __pyx_L5_argtuple_error;
    } else {
    }
    __pyx_v_chess960 = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("empty", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3341, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.empty", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_198empty(((PyTypeObject*)__pyx_v_cls), __pyx_v_chess960);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_198empty(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_chess960) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("empty", 0);

  /* "chess/__init__cp.pyx":3343
 *     def empty(cls, *, chess960=False):
 *         """Creates a new empty board. Also see :func:`~chess.Board.clear()`."""
 *         return cls(None, chess960=chess960)             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3343, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_chess960, __pyx_v_chess960) < 0) __PYX_ERR(0, 3343, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_tuple__24, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3343, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3341
 * 
 *     @classmethod
 *     def empty(cls, *, chess960=False):             # <<<<<<<<<<<<<<
 *         """Creates a new empty board. Also see :func:`~chess.Board.clear()`."""
 *         return cls(None, chess960=chess960)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.Board.empty", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3346
 * 
 *     @classmethod
 *     def from_epd(cls, epd, *, chess960=False):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new board from an EPD string. See
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_201from_epd(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_5Board_200from_epd[] = "\n        Creates a new board from an EPD string. See\n        :func:`~chess.Board.set_epd()`.\n\n        Returns the board and the dictionary of parsed operations as a tuple.\n        ";
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_201from_epd(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_epd = 0;
  PyObject *__pyx_v_chess960 = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_epd (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_epd,&__pyx_n_s_chess960,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_epd)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 1;
        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
        if (value) { values[index] = value; kw_args--; }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_epd") < 0)) __PYX_ERR(0, 3346, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_epd = values[0];
    __pyx_v_chess960 = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("from_epd", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3346, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.Board.from_epd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_200from_epd(((PyTypeObject*)__pyx_v_cls), __pyx_v_epd, __pyx_v_chess960);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_200from_epd(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_epd, PyObject *__pyx_v_chess960) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("from_epd", 0);

  /* "chess/__init__cp.pyx":3353
 *         Returns the board and the dictionary of parsed operations as a tuple.
 *         """
 *         board = cls.empty(chess960=chess960)             # <<<<<<<<<<<<<<
 *         return board, board.set_epd(epd)
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_chess960, __pyx_v_chess960) < 0) __PYX_ERR(0, 3353, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3354
 *         """
 *         board = cls.empty(chess960=chess960)
 *         return board, board.set_epd(epd)             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_set_epd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_v_epd) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_epd);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_board);
  __Pyx_GIVEREF(__pyx_v_board);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_board);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3346
 * 
 *     @classmethod
 *     def from_epd(cls, epd, *, chess960=False):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new board from an EPD string. See
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.from_epd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3357
 * 
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):             # <<<<<<<<<<<<<<
 *         board = cls.empty(chess960=True)
 *         board.set_chess960_pos(sharnagl)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_203from_chess960_pos(PyObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_203from_chess960_pos(PyObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_chess960_pos (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_202from_chess960_pos(((PyTypeObject*)__pyx_v_cls), ((PyObject *)__pyx_v_sharnagl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_202from_chess960_pos(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_sharnagl) {
  PyObject *__pyx_v_board = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("from_chess960_pos", 0);

  /* "chess/__init__cp.pyx":3358
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):
 *         board = cls.empty(chess960=True)             # <<<<<<<<<<<<<<
 *         board.set_chess960_pos(sharnagl)
 *         return board
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_chess960, Py_True) < 0) __PYX_ERR(0, 3358, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_board = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3359
 *     def from_chess960_pos(cls, sharnagl):
 *         board = cls.empty(chess960=True)
 *         board.set_chess960_pos(sharnagl)             # <<<<<<<<<<<<<<
 *         return board
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_board, __pyx_n_s_set_chess960_pos_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_v_sharnagl) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sharnagl);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3360
 *         board = cls.empty(chess960=True)
 *         board.set_chess960_pos(sharnagl)
 *         return board             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_board);
  __pyx_r = __pyx_v_board;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3357
 * 
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):             # <<<<<<<<<<<<<<
 *         board = cls.empty(chess960=True)
 *         board.set_chess960_pos(sharnagl)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.Board.from_chess960_pos", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_board);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_205__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_205__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_204__reduce_cython__(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_204__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self) {
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v__dict = 0;
  int __pyx_v_use_setstate;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  __Pyx_RefNannySetupContext("__reduce_cython__", 0);

  /* "(tree fragment)":5
 *     cdef object _dict
 *     cdef bint use_setstate
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)             # <<<<<<<<<<<<<<
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.bishops); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.castling_rights); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.chess960); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.fullmove_number); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->__pyx_base.halfmove_clock); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.kings); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.knights); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.occupied); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_carray_to_py_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.occupied_co, 2); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.pawns); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.promoted); if (unlikely(!__pyx_t_11)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.queens); if (unlikely(!__pyx_t_12)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __pyx_t_13 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_self->__pyx_base.rooks); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_13);
  __pyx_t_14 = __Pyx_PyBool_FromLong(__pyx_v_self->__pyx_base.turn); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_14);
  __pyx_t_15 = PyTuple_New(19); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_15);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_15, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_15, 2, __pyx_t_3);
  __Pyx_INCREF(__pyx_v_self->__pyx_base.ep_square);
  __Pyx_GIVEREF(__pyx_v_self->__pyx_base.ep_square);
  PyTuple_SET_ITEM(__pyx_t_15, 3, __pyx_v_self->__pyx_base.ep_square);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_15, 4, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_15, 5, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_15, 6, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_15, 7, __pyx_t_7);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->__pyx_base.legal_moves));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->__pyx_base.legal_moves));
  PyTuple_SET_ITEM(__pyx_t_15, 8, ((PyObject *)__pyx_v_self->__pyx_base.legal_moves));
  __Pyx_INCREF(__pyx_v_self->__pyx_base.move_stack);
  __Pyx_GIVEREF(__pyx_v_self->__pyx_base.move_stack);
  PyTuple_SET_ITEM(__pyx_t_15, 9, __pyx_v_self->__pyx_base.move_stack);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_15, 10, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_15, 11, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_15, 12, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_15, 13, __pyx_t_11);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->__pyx_base.pseudo_legal_moves));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->__pyx_base.pseudo_legal_moves));
  PyTuple_SET_ITEM(__pyx_t_15, 14, ((PyObject *)__pyx_v_self->__pyx_base.pseudo_legal_moves));
  __Pyx_GIVEREF(__pyx_t_12);
  PyTuple_SET_ITEM(__pyx_t_15, 15, __pyx_t_12);
  __Pyx_GIVEREF(__pyx_t_13);
  PyTuple_SET_ITEM(__pyx_t_15, 16, __pyx_t_13);
  __Pyx_INCREF(__pyx_v_self->__pyx_base.stack);
  __Pyx_GIVEREF(__pyx_v_self->__pyx_base.stack);
  PyTuple_SET_ITEM(__pyx_t_15, 17, __pyx_v_self->__pyx_base.stack);
  __Pyx_GIVEREF(__pyx_t_14);
  PyTuple_SET_ITEM(__pyx_t_15, 18, __pyx_t_14);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_t_12 = 0;
  __pyx_t_13 = 0;
  __pyx_t_14 = 0;
  __pyx_v_state = ((PyObject*)__pyx_t_15);
  __pyx_t_15 = 0;

  /* "(tree fragment)":6
 *     cdef bint use_setstate
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)
 *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
 *     if _dict is not None:
 *         state += (_dict,)
 */
  __pyx_t_15 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_15);
  __pyx_v__dict = __pyx_t_15;
  __pyx_t_15 = 0;

  /* "(tree fragment)":7
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
  __pyx_t_16 = (__pyx_v__dict != Py_None);
  __pyx_t_17 = (__pyx_t_16 != 0);
  if (__pyx_t_17) {

    /* "(tree fragment)":8
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 *         state += (_dict,)             # <<<<<<<<<<<<<<
 *         use_setstate = True
 *     else:
 */
    __pyx_t_15 = PyTuple_New(1); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_INCREF(__pyx_v__dict);
    __Pyx_GIVEREF(__pyx_v__dict);
    PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_v__dict);
    __pyx_t_14 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_14));
    __pyx_t_14 = 0;

    /* "(tree fragment)":9
 *     if _dict is not None:
 *         state += (_dict,)
 *         use_setstate = True             # <<<<<<<<<<<<<<
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 */
    __pyx_v_use_setstate = 1;

    /* "(tree fragment)":7
 *     state = (self.bishops, self.castling_rights, self.chess960, self.ep_square, self.fullmove_number, self.halfmove_clock, self.kings, self.knights, self.legal_moves, self.move_stack, self.occupied, self.occupied_co, self.pawns, self.promoted, self.pseudo_legal_moves, self.queens, self.rooks, self.stack, self.turn)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
    goto __pyx_L3;
  }

  /* "(tree fragment)":11
 *         use_setstate = True
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None             # <<<<<<<<<<<<<<
 *     if use_setstate:
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, None), state
 */
  /*else*/ {
    __pyx_t_16 = (__pyx_v_self->__pyx_base.ep_square != Py_None);
    __pyx_t_18 = (__pyx_t_16 != 0);
    if (!__pyx_t_18) {
    } else {
      __pyx_t_17 = __pyx_t_18;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_18 = (((PyObject *)__pyx_v_self->__pyx_base.legal_moves) != Py_None);
    __pyx_t_16 = (__pyx_t_18 != 0);
    if (!__pyx_t_16) {
    } else {
      __pyx_t_17 = __pyx_t_16;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_16 = (__pyx_v_self->__pyx_base.move_stack != Py_None);
    __pyx_t_18 = (__pyx_t_16 != 0);
    if (!__pyx_t_18) {
    } else {
      __pyx_t_17 = __pyx_t_18;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_18 = (((PyObject *)__pyx_v_self->__pyx_base.pseudo_legal_moves) != Py_None);
    __pyx_t_16 = (__pyx_t_18 != 0);
    if (!__pyx_t_16) {
    } else {
      __pyx_t_17 = __pyx_t_16;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_16 = (__pyx_v_self->__pyx_base.stack != Py_None);
    __pyx_t_18 = (__pyx_t_16 != 0);
    __pyx_t_17 = __pyx_t_18;
    __pyx_L4_bool_binop_done:;
    __pyx_v_use_setstate = __pyx_t_17;
  }
  __pyx_L3:;

  /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, None), state
 *     else:
 */
  __pyx_t_17 = (__pyx_v_use_setstate != 0);
  if (__pyx_t_17) {

    /* "(tree fragment)":13
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 *     if use_setstate:
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, None), state             # <<<<<<<<<<<<<<
 *     else:
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, state)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_pyx_unpickle_Board); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __pyx_t_15 = PyTuple_New(3); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_15, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_56827727);
    __Pyx_GIVEREF(__pyx_int_56827727);
    PyTuple_SET_ITEM(__pyx_t_15, 1, __pyx_int_56827727);
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_15, 2, Py_None);
    __pyx_t_13 = PyTuple_New(3); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_14);
    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_14);
    __Pyx_GIVEREF(__pyx_t_15);
    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_15);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_13, 2, __pyx_v_state);
    __pyx_t_14 = 0;
    __pyx_t_15 = 0;
    __pyx_r = __pyx_t_13;
    __pyx_t_13 = 0;
    goto __pyx_L0;

    /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.ep_square is not None or self.legal_moves is not None or self.move_stack is not None or self.pseudo_legal_moves is not None or self.stack is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, None), state
 *     else:
 */
  }

  /* "(tree fragment)":15
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, None), state
 *     else:
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, state)             # <<<<<<<<<<<<<<
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_Board__set_state(self, __pyx_state)
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_pyx_unpickle_Board); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __pyx_t_15 = PyTuple_New(3); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_15, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_56827727);
    __Pyx_GIVEREF(__pyx_int_56827727);
    PyTuple_SET_ITEM(__pyx_t_15, 1, __pyx_int_56827727);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_15, 2, __pyx_v_state);
    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_GIVEREF(__pyx_t_13);
    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_15);
    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_15);
    __pyx_t_13 = 0;
    __pyx_t_15 = 0;
    __pyx_r = __pyx_t_14;
    __pyx_t_14 = 0;
    goto __pyx_L0;
  }

  /* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("chess.__init__cp.Board.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v__dict);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_Board__set_state(self, __pyx_state)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_207__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_5Board_207__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_5Board_206__setstate_cython__(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_5Board_206__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__setstate_cython__", 0);

  /* "(tree fragment)":17
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, state)
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_Board__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
 */
  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_5chess_10__init__cp___pyx_unpickle_Board__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_Board, (type(self), 0x3631f4f, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_Board__set_state(self, __pyx_state)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.Board.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3365
 * cdef class PseudoLegalMoveGenerator:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.board = board
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_board = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_board,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_board)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3365, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_board = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3365, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator___init__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self), __pyx_v_board);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator___init__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_board) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":3366
 * 
 *     def __init__(self, board):
 *         self.board = board             # <<<<<<<<<<<<<<
 * 
 *     def __bool__(self):
 */
  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board, __pyx_v_board) < 0) __PYX_ERR(0, 3366, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3365
 * cdef class PseudoLegalMoveGenerator:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.board = board
 * 
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3368
 *         self.board = board
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return any(self.board.generate_pseudo_legal_moves())
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_3__bool__(PyObject *__pyx_v_self); /*proto*/
static int __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_3__bool__(PyObject *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__bool__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_2__bool__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_2__bool__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("__bool__", 0);

  /* "chess/__init__cp.pyx":3369
 * 
 *     def __bool__(self):
 *         return any(self.board.generate_pseudo_legal_moves())             # <<<<<<<<<<<<<<
 * 
 *     def count(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 3369, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3368
 *         self.board = board
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return any(self.board.generate_pseudo_legal_moves())
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__bool__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3371
 *         return any(self.board.generate_pseudo_legal_moves())
 * 
 *     def count(self):             # <<<<<<<<<<<<<<
 *         # List conversion is faster than iterating.
 *         return len(list(self))
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_5count(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_5count(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("count (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_4count(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_4count(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  __Pyx_RefNannySetupContext("count", 0);

  /* "chess/__init__cp.pyx":3373
 *     def count(self):
 *         # List conversion is faster than iterating.
 *         return len(list(self))             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PySequence_List(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3373, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyList_GET_SIZE(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3373, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3373, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3371
 *         return any(self.board.generate_pseudo_legal_moves())
 * 
 *     def count(self):             # <<<<<<<<<<<<<<
 *         # List conversion is faster than iterating.
 *         return len(list(self))
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.count", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3375
 *         return len(list(self))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self.board.generate_pseudo_legal_moves()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_7__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_7__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_6__iter__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_6__iter__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__iter__", 0);

  /* "chess/__init__cp.pyx":3376
 * 
 *     def __iter__(self):
 *         return self.board.generate_pseudo_legal_moves()             # <<<<<<<<<<<<<<
 * 
 *     def __contains__(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3376, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_generate_pseudo_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3376, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3376, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3375
 *         return len(list(self))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self.board.generate_pseudo_legal_moves()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3378
 *         return self.board.generate_pseudo_legal_moves()
 * 
 *     def __contains__(self, move):             # <<<<<<<<<<<<<<
 *         return self.board.is_pseudo_legal(move)
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_9__contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static int __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_9__contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__contains__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_8__contains__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_8__contains__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_move) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("__contains__", 0);

  /* "chess/__init__cp.pyx":3379
 * 
 *     def __contains__(self, move):
 *         return self.board.is_pseudo_legal(move)             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3379, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_is_pseudo_legal); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3379, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3379, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 3379, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3378
 *         return self.board.generate_pseudo_legal_moves()
 * 
 *     def __contains__(self, move):             # <<<<<<<<<<<<<<
 *         return self.board.is_pseudo_legal(move)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3381
 *         return self.board.is_pseudo_legal(move)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_11__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_11__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_10__repr__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_10__repr__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_v_builder = NULL;
  PyObject *__pyx_v_move = NULL;
  PyObject *__pyx_v_sans = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "chess/__init__cp.pyx":3382
 * 
 *     def __repr__(self):
 *         builder = []             # <<<<<<<<<<<<<<
 * 
 *         for move in self:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3382, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3384
 *         builder = []
 * 
 *         for move in self:             # <<<<<<<<<<<<<<
 *             if self.board.is_legal(move):
 *                 builder.append(self.board.san(move))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3384, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3384, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3384, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3384, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3384, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3384, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3384, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_move, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":3385
 * 
 *         for move in self:
 *             if self.board.is_legal(move):             # <<<<<<<<<<<<<<
 *                 builder.append(self.board.san(move))
 *             else:
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3385, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_is_legal); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3385, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_move);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3385, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 3385, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_7) {

      /* "chess/__init__cp.pyx":3386
 *         for move in self:
 *             if self.board.is_legal(move):
 *                 builder.append(self.board.san(move))             # <<<<<<<<<<<<<<
 *             else:
 *                 builder.append(self.board.uci(move))
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3386, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_san); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3386, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_move);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3386, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_4); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 3386, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "chess/__init__cp.pyx":3385
 * 
 *         for move in self:
 *             if self.board.is_legal(move):             # <<<<<<<<<<<<<<
 *                 builder.append(self.board.san(move))
 *             else:
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":3388
 *                 builder.append(self.board.san(move))
 *             else:
 *                 builder.append(self.board.uci(move))             # <<<<<<<<<<<<<<
 * 
 *         sans = ", ".join(builder)
 */
    /*else*/ {
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3388, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uci); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3388, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_move);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3388, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_t_4); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 3388, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_L5:;

    /* "chess/__init__cp.pyx":3384
 *         builder = []
 * 
 *         for move in self:             # <<<<<<<<<<<<<<
 *             if self.board.is_legal(move):
 *                 builder.append(self.board.san(move))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3390
 *                 builder.append(self.board.uci(move))
 * 
 *         sans = ", ".join(builder)             # <<<<<<<<<<<<<<
 * 
 *         return "<PseudoLegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 */
  __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__60, __pyx_v_builder); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3390, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_sans = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3392
 *         sans = ", ".join(builder)
 * 
 *         return "<PseudoLegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_PseudoLegalMoveGenerator_at, __pyx_n_s_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3392, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3392, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_hex, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3392, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_5, __pyx_v_sans};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3392, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_5, __pyx_v_sans};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3392, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3392, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    if (__pyx_t_6) {
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_t_5);
    __Pyx_INCREF(__pyx_v_sans);
    __Pyx_GIVEREF(__pyx_v_sans);
    PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_v_sans);
    __pyx_t_5 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3392, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3381
 *         return self.board.is_pseudo_legal(move)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_move);
  __Pyx_XDECREF(__pyx_v_sans);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_13__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_13__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_12__reduce_cython__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_12__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v__dict = 0;
  int __pyx_v_use_setstate;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__reduce_cython__", 0);

  /* "(tree fragment)":5
 *     cdef object _dict
 *     cdef bint use_setstate
 *     state = ()             # <<<<<<<<<<<<<<
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 */
  __Pyx_INCREF(__pyx_empty_tuple);
  __pyx_v_state = __pyx_empty_tuple;

  /* "(tree fragment)":6
 *     cdef bint use_setstate
 *     state = ()
 *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
 *     if _dict is not None:
 *         state += (_dict,)
 */
  __pyx_t_1 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v__dict = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "(tree fragment)":7
 *     state = ()
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
  __pyx_t_2 = (__pyx_v__dict != Py_None);
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "(tree fragment)":8
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 *         state += (_dict,)             # <<<<<<<<<<<<<<
 *         use_setstate = True
 *     else:
 */
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v__dict);
    __Pyx_GIVEREF(__pyx_v__dict);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v__dict);
    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "(tree fragment)":9
 *     if _dict is not None:
 *         state += (_dict,)
 *         use_setstate = True             # <<<<<<<<<<<<<<
 *     else:
 *         use_setstate = False
 */
    __pyx_v_use_setstate = 1;

    /* "(tree fragment)":7
 *     state = ()
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
    goto __pyx_L3;
  }

  /* "(tree fragment)":11
 *         use_setstate = True
 *     else:
 *         use_setstate = False             # <<<<<<<<<<<<<<
 *     if use_setstate:
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 */
  /*else*/ {
    __pyx_v_use_setstate = 0;
  }
  __pyx_L3:;

  /* "(tree fragment)":12
 *     else:
 *         use_setstate = False
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 *     else:
 */
  __pyx_t_3 = (__pyx_v_use_setstate != 0);
  if (__pyx_t_3) {

    /* "(tree fragment)":13
 *         use_setstate = False
 *     if use_setstate:
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, None), state             # <<<<<<<<<<<<<<
 *     else:
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, state)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pyx_unpickle_PseudoLegalMoveGe); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_222419149);
    __Pyx_GIVEREF(__pyx_int_222419149);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_222419149);
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_1, 2, Py_None);
    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_state);
    __pyx_t_4 = 0;
    __pyx_t_1 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;

    /* "(tree fragment)":12
 *     else:
 *         use_setstate = False
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 *     else:
 */
  }

  /* "(tree fragment)":15
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 *     else:
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, state)             # <<<<<<<<<<<<<<
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_PseudoLegalMoveGenerator__set_state(self, __pyx_state)
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_pyx_unpickle_PseudoLegalMoveGe); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_222419149);
    __Pyx_GIVEREF(__pyx_int_222419149);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_222419149);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_state);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
    __pyx_t_5 = 0;
    __pyx_t_1 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }

  /* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v__dict);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_PseudoLegalMoveGenerator__set_state(self, __pyx_state)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_15__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_15__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_14__setstate_cython__(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_24PseudoLegalMoveGenerator_14__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__setstate_cython__", 0);

  /* "(tree fragment)":17
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, state)
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_PseudoLegalMoveGenerator__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
 */
  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_5chess_10__init__cp___pyx_unpickle_PseudoLegalMoveGenerator__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_PseudoLegalMoveGenerator, (type(self), 0xd41d8cd, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_PseudoLegalMoveGenerator__set_state(self, __pyx_state)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.PseudoLegalMoveGenerator.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3397
 * cdef class LegalMoveGenerator:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.board = board
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_board = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_board,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_board)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3397, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_board = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3397, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator___init__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self), __pyx_v_board);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator___init__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_board) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":3398
 * 
 *     def __init__(self, board):
 *         self.board = board             # <<<<<<<<<<<<<<
 * 
 *     def __bool__(self):
 */
  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board, __pyx_v_board) < 0) __PYX_ERR(0, 3398, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3397
 * cdef class LegalMoveGenerator:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.board = board
 * 
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3400
 *         self.board = board
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return any(self.board.generate_legal_moves())
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_3__bool__(PyObject *__pyx_v_self); /*proto*/
static int __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_3__bool__(PyObject *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__bool__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_2__bool__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_2__bool__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("__bool__", 0);

  /* "chess/__init__cp.pyx":3401
 * 
 *     def __bool__(self):
 *         return any(self.board.generate_legal_moves())             # <<<<<<<<<<<<<<
 * 
 *     def count(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3401, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3401, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3401, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_any, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3401, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 3401, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3400
 *         self.board = board
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return any(self.board.generate_legal_moves())
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__bool__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3403
 *         return any(self.board.generate_legal_moves())
 * 
 *     def count(self):             # <<<<<<<<<<<<<<
 *         # List conversion is faster than iterating.
 *         return len(list(self))
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_5count(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_5count(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("count (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_4count(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_4count(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  __Pyx_RefNannySetupContext("count", 0);

  /* "chess/__init__cp.pyx":3405
 *     def count(self):
 *         # List conversion is faster than iterating.
 *         return len(list(self))             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PySequence_List(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3405, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyList_GET_SIZE(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3405, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3405, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3403
 *         return any(self.board.generate_legal_moves())
 * 
 *     def count(self):             # <<<<<<<<<<<<<<
 *         # List conversion is faster than iterating.
 *         return len(list(self))
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.count", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3407
 *         return len(list(self))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self.board.generate_legal_moves()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_7__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_7__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_6__iter__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_6__iter__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__iter__", 0);

  /* "chess/__init__cp.pyx":3408
 * 
 *     def __iter__(self):
 *         return self.board.generate_legal_moves()             # <<<<<<<<<<<<<<
 * 
 *     def __contains__(self, move):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_generate_legal_moves); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3407
 *         return len(list(self))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return self.board.generate_legal_moves()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3410
 *         return self.board.generate_legal_moves()
 * 
 *     def __contains__(self, move):             # <<<<<<<<<<<<<<
 *         return self.board.is_legal(move)
 * 
 */

/* Python wrapper */
static int __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_9__contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_move); /*proto*/
static int __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_9__contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_move) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__contains__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_8__contains__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self), ((PyObject *)__pyx_v_move));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_8__contains__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v_move) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("__contains__", 0);

  /* "chess/__init__cp.pyx":3411
 * 
 *     def __contains__(self, move):
 *         return self.board.is_legal(move)             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3411, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_is_legal); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3411, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_move);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3411, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 3411, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3410
 *         return self.board.generate_legal_moves()
 * 
 *     def __contains__(self, move):             # <<<<<<<<<<<<<<
 *         return self.board.is_legal(move)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3413
 *         return self.board.is_legal(move)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         sans = ", ".join(self.board.san(move) for move in self)
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_11__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_11__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_10__repr__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_5chess_10__init__cp_18LegalMoveGenerator_8__repr___2generator13(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "chess/__init__cp.pyx":3414
 * 
 *     def __repr__(self):
 *         sans = ", ".join(self.board.san(move) for move in self)             # <<<<<<<<<<<<<<
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 * 
 */

static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_8__repr___genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_18_genexpr(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_18_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3414, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *) __pyx_self;
  __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_5chess_10__init__cp_18LegalMoveGenerator_8__repr___2generator13, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_repr___locals_genexpr, __pyx_n_s_chess___init__cp); if (unlikely(!gen)) __PYX_ERR(0, 3414, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__repr__.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_5chess_10__init__cp_18LegalMoveGenerator_8__repr___2generator13(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *__pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3414, __pyx_L1_error)
  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 3414, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_r);
  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 3414, __pyx_L1_error) }
  if (likely(PyList_CheckExact(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3414, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3414, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3414, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3414, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3414, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3414, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_move, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 3414, __pyx_L1_error) }
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_board); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_san); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_cur_scope->__pyx_v_move) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_cur_scope->__pyx_v_move);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 3414, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3413
 *         return self.board.is_legal(move)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         sans = ", ".join(self.board.san(move) for move in self)
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 */

static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_10__repr__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *__pyx_cur_scope;
  PyObject *__pyx_v_sans = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("__repr__", 0);
  __pyx_cur_scope = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *)__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_17___repr__(__pyx_ptype_5chess_10__init__cp___pyx_scope_struct_17___repr__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3413, __pyx_L1_error)
  } else {
    __Pyx_GOTREF(__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);

  /* "chess/__init__cp.pyx":3414
 * 
 *     def __repr__(self):
 *         sans = ", ".join(self.board.san(move) for move in self)             # <<<<<<<<<<<<<<
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 * 
 */
  __pyx_t_1 = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_8__repr___genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3414, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_Generator_Next(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3414, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__60, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3414, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_sans = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3415
 *     def __repr__(self):
 *         sans = ", ".join(self.board.san(move) for move in self)
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_LegalMoveGenerator_at, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3415, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_cur_scope->__pyx_v_self)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3415, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_hex, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3415, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_4, __pyx_v_sans};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3415, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_4, __pyx_v_sans};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3415, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3415, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_t_4);
    __Pyx_INCREF(__pyx_v_sans);
    __Pyx_GIVEREF(__pyx_v_sans);
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_sans);
    __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3415, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3413
 *         return self.board.is_legal(move)
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         sans = ", ".join(self.board.san(move) for move in self)
 *         return "<LegalMoveGenerator at {} ({})>".format(hex(id(self)), sans)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_sans);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_13__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_13__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_12__reduce_cython__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_12__reduce_cython__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self) {
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v__dict = 0;
  int __pyx_v_use_setstate;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__reduce_cython__", 0);

  /* "(tree fragment)":5
 *     cdef object _dict
 *     cdef bint use_setstate
 *     state = ()             # <<<<<<<<<<<<<<
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 */
  __Pyx_INCREF(__pyx_empty_tuple);
  __pyx_v_state = __pyx_empty_tuple;

  /* "(tree fragment)":6
 *     cdef bint use_setstate
 *     state = ()
 *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
 *     if _dict is not None:
 *         state += (_dict,)
 */
  __pyx_t_1 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v__dict = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "(tree fragment)":7
 *     state = ()
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
  __pyx_t_2 = (__pyx_v__dict != Py_None);
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "(tree fragment)":8
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 *         state += (_dict,)             # <<<<<<<<<<<<<<
 *         use_setstate = True
 *     else:
 */
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v__dict);
    __Pyx_GIVEREF(__pyx_v__dict);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v__dict);
    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "(tree fragment)":9
 *     if _dict is not None:
 *         state += (_dict,)
 *         use_setstate = True             # <<<<<<<<<<<<<<
 *     else:
 *         use_setstate = False
 */
    __pyx_v_use_setstate = 1;

    /* "(tree fragment)":7
 *     state = ()
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
    goto __pyx_L3;
  }

  /* "(tree fragment)":11
 *         use_setstate = True
 *     else:
 *         use_setstate = False             # <<<<<<<<<<<<<<
 *     if use_setstate:
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 */
  /*else*/ {
    __pyx_v_use_setstate = 0;
  }
  __pyx_L3:;

  /* "(tree fragment)":12
 *     else:
 *         use_setstate = False
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 *     else:
 */
  __pyx_t_3 = (__pyx_v_use_setstate != 0);
  if (__pyx_t_3) {

    /* "(tree fragment)":13
 *         use_setstate = False
 *     if use_setstate:
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, None), state             # <<<<<<<<<<<<<<
 *     else:
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, state)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pyx_unpickle_LegalMoveGenerato); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_222419149);
    __Pyx_GIVEREF(__pyx_int_222419149);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_222419149);
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_1, 2, Py_None);
    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_state);
    __pyx_t_4 = 0;
    __pyx_t_1 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;

    /* "(tree fragment)":12
 *     else:
 *         use_setstate = False
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 *     else:
 */
  }

  /* "(tree fragment)":15
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, None), state
 *     else:
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, state)             # <<<<<<<<<<<<<<
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_LegalMoveGenerator__set_state(self, __pyx_state)
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_pyx_unpickle_LegalMoveGenerato); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_222419149);
    __Pyx_GIVEREF(__pyx_int_222419149);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_222419149);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_state);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
    __pyx_t_5 = 0;
    __pyx_t_1 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }

  /* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v__dict);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_LegalMoveGenerator__set_state(self, __pyx_state)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_15__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
static PyObject *__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_15__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_14__setstate_cython__(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_18LegalMoveGenerator_14__setstate_cython__(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__setstate_cython__", 0);

  /* "(tree fragment)":17
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, state)
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_LegalMoveGenerator__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
 */
  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_5chess_10__init__cp___pyx_unpickle_LegalMoveGenerator__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_LegalMoveGenerator, (type(self), 0xd41d8cd, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_LegalMoveGenerator__set_state(self, __pyx_state)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.LegalMoveGenerator.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3492
 *     """
 * 
 *     def __init__(self, squares=BB_EMPTY):             # <<<<<<<<<<<<<<
 * 
 *         try:
 */

static PyObject *__pyx_pf_5chess_10__init__cp_79__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__defaults__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_squares);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_squares);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_squares);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None);
  __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_1__init__ = {"__init__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_1__init__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_squares = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_squares,0};
    PyObject* values[2] = {0,0};
    __pyx_defaults *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self);
    values[1] = __pyx_dynamic_args->__pyx_arg_squares;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_squares);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3492, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_self = values[0];
    __pyx_v_squares = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3492, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet___init__(__pyx_self, __pyx_v_self, __pyx_v_squares);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_squares) {
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  PyObject *__pyx_t_10 = NULL;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "chess/__init__cp.pyx":3494
 *     def __init__(self, squares=BB_EMPTY):
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             self.mask = squares.__int__() & BB_ALL
 *             return
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":3495
 * 
 *         try:
 *             self.mask = squares.__int__() & BB_ALL             # <<<<<<<<<<<<<<
 *             return
 *         except AttributeError:
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_squares, __pyx_n_s_int); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3495, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3495, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3495, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyNumber_And(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3495, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_6) < 0) __PYX_ERR(0, 3495, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "chess/__init__cp.pyx":3496
 *         try:
 *             self.mask = squares.__int__() & BB_ALL
 *             return             # <<<<<<<<<<<<<<
 *         except AttributeError:
 *             self.mask = 0
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
      goto __pyx_L7_try_return;

      /* "chess/__init__cp.pyx":3494
 *     def __init__(self, squares=BB_EMPTY):
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             self.mask = squares.__int__() & BB_ALL
 *             return
 */
    }
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "chess/__init__cp.pyx":3497
 *             self.mask = squares.__int__() & BB_ALL
 *             return
 *         except AttributeError:             # <<<<<<<<<<<<<<
 *             self.mask = 0
 * 
 */
    __pyx_t_7 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AttributeError);
    if (__pyx_t_7) {
      __Pyx_AddTraceback("chess.__init__cp.SquareSet.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4) < 0) __PYX_ERR(0, 3497, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_4);

      /* "chess/__init__cp.pyx":3498
 *             return
 *         except AttributeError:
 *             self.mask = 0             # <<<<<<<<<<<<<<
 * 
 *         # Try squares as an iterable. Not under except clause for nicer
 */
      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_int_0) < 0) __PYX_ERR(0, 3498, __pyx_L5_except_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L4_exception_handled;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":3494
 *     def __init__(self, squares=BB_EMPTY):
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             self.mask = squares.__int__() & BB_ALL
 *             return
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
  }

  /* "chess/__init__cp.pyx":3502
 *         # Try squares as an iterable. Not under except clause for nicer
 *         # backtraces.
 *         for square in squares:             # <<<<<<<<<<<<<<
 *             self.add(square)
 * 
 */
  if (likely(PyList_CheckExact(__pyx_v_squares)) || PyTuple_CheckExact(__pyx_v_squares)) {
    __pyx_t_4 = __pyx_v_squares; __Pyx_INCREF(__pyx_t_4); __pyx_t_8 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_8 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_squares); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_9 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3502, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_9)) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_5); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 3502, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3502, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      } else {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_5); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 3502, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3502, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      }
    } else {
      __pyx_t_5 = __pyx_t_9(__pyx_t_4);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3502, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_5);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":3503
 *         # backtraces.
 *         for square in squares:
 *             self.add(square)             # <<<<<<<<<<<<<<
 * 
 *     # Set
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_add); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3503, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_10, __pyx_v_square) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_square);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3503, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":3502
 *         # Try squares as an iterable. Not under except clause for nicer
 *         # backtraces.
 *         for square in squares:             # <<<<<<<<<<<<<<
 *             self.add(square)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":3492
 *     """
 * 
 *     def __init__(self, squares=BB_EMPTY):             # <<<<<<<<<<<<<<
 * 
 *         try:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3507
 *     # Set
 * 
 *     def __contains__(self, square):             # <<<<<<<<<<<<<<
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_3__contains__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_3__contains__ = {"__contains__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_3__contains__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_3__contains__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__contains__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__contains__", 1, 2, 2, 1); __PYX_ERR(0, 3507, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__contains__") < 0)) __PYX_ERR(0, 3507, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__contains__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3507, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_2__contains__(__pyx_self, __pyx_v_self, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_2__contains__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("__contains__", 0);

  /* "chess/__init__cp.pyx":3508
 * 
 *     def __contains__(self, square):
 *         return bool(BB_SQUARES[square] & self.mask)             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3508, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3508, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3508, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3508, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 3508, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyBool_FromLong((!(!__pyx_t_4))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3508, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3507
 *     # Set
 * 
 *     def __contains__(self, square):             # <<<<<<<<<<<<<<
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3510
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return scan_forward(self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_5__iter__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_5__iter__ = {"__iter__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_5__iter__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_5__iter__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_4__iter__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_4__iter__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__iter__", 0);

  /* "chess/__init__cp.pyx":3511
 * 
 *     def __iter__(self):
 *         return scan_forward(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     def __reversed__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_forward); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3511, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3510
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return scan_forward(self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3513
 *         return scan_forward(self.mask)
 * 
 *     def __reversed__(self):             # <<<<<<<<<<<<<<
 *         return scan_reversed(self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_7__reversed__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_7__reversed__ = {"__reversed__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_7__reversed__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_7__reversed__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reversed__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_6__reversed__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_6__reversed__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__reversed__", 0);

  /* "chess/__init__cp.pyx":3514
 * 
 *     def __reversed__(self):
 *         return scan_reversed(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     def __len__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scan_reversed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3513
 *         return scan_forward(self.mask)
 * 
 *     def __reversed__(self):             # <<<<<<<<<<<<<<
 *         return scan_reversed(self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__reversed__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3516
 *         return scan_reversed(self.mask)
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         return popcount(self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_9__len__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_9__len__ = {"__len__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_9__len__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_9__len__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__len__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_8__len__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_8__len__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__len__", 0);

  /* "chess/__init__cp.pyx":3517
 * 
 *     def __len__(self):
 *         return popcount(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     # MutableSet
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_popcount); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3516
 *         return scan_reversed(self.mask)
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         return popcount(self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__len__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3521
 *     # MutableSet
 * 
 *     def add(self, square):             # <<<<<<<<<<<<<<
 *         """Adds a square to the set."""
 *         self.mask |= BB_SQUARES[square]
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_11add(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_10add[] = "Adds a square to the set.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_11add = {"add", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_11add, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_10add};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_11add(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("add (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("add", 1, 2, 2, 1); __PYX_ERR(0, 3521, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add") < 0)) __PYX_ERR(0, 3521, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("add", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3521, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.add", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_10add(__pyx_self, __pyx_v_self, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_10add(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("add", 0);

  /* "chess/__init__cp.pyx":3523
 *     def add(self, square):
 *         """Adds a square to the set."""
 *         self.mask |= BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *     def discard(self, square):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3523, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3521
 *     # MutableSet
 * 
 *     def add(self, square):             # <<<<<<<<<<<<<<
 *         """Adds a square to the set."""
 *         self.mask |= BB_SQUARES[square]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.add", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3525
 *         self.mask |= BB_SQUARES[square]
 * 
 *     def discard(self, square):             # <<<<<<<<<<<<<<
 *         """Discards a square from the set."""
 *         self.mask &= ~BB_SQUARES[square]
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_13discard(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_12discard[] = "Discards a square from the set.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_13discard = {"discard", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_13discard, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_12discard};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_13discard(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("discard (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("discard", 1, 2, 2, 1); __PYX_ERR(0, 3525, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "discard") < 0)) __PYX_ERR(0, 3525, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("discard", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3525, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_12discard(__pyx_self, __pyx_v_self, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_12discard(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("discard", 0);

  /* "chess/__init__cp.pyx":3527
 *     def discard(self, square):
 *         """Discards a square from the set."""
 *         self.mask &= ~BB_SQUARES[square]             # <<<<<<<<<<<<<<
 * 
 *     # frozenset
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Invert(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_3) < 0) __PYX_ERR(0, 3527, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3525
 *         self.mask |= BB_SQUARES[square]
 * 
 *     def discard(self, square):             # <<<<<<<<<<<<<<
 *         """Discards a square from the set."""
 *         self.mask &= ~BB_SQUARES[square]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3531
 *     # frozenset
 * 
 *     def isdisjoint(self, other):             # <<<<<<<<<<<<<<
 *         """Test if the square sets are disjoint."""
 *         return not bool(self & other)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_15isdisjoint(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_14isdisjoint[] = "Test if the square sets are disjoint.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_15isdisjoint = {"isdisjoint", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_15isdisjoint, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_14isdisjoint};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_15isdisjoint(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("isdisjoint (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("isdisjoint", 1, 2, 2, 1); __PYX_ERR(0, 3531, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "isdisjoint") < 0)) __PYX_ERR(0, 3531, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("isdisjoint", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3531, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.isdisjoint", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_14isdisjoint(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_14isdisjoint(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("isdisjoint", 0);

  /* "chess/__init__cp.pyx":3533
 *     def isdisjoint(self, other):
 *         """Test if the square sets are disjoint."""
 *         return not bool(self & other)             # <<<<<<<<<<<<<<
 * 
 *     def issubset(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_And(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3533, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3533, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyBool_FromLong((!((!(!__pyx_t_2)) != 0))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3533, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3531
 *     # frozenset
 * 
 *     def isdisjoint(self, other):             # <<<<<<<<<<<<<<
 *         """Test if the square sets are disjoint."""
 *         return not bool(self & other)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.isdisjoint", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3535
 *         return not bool(self & other)
 * 
 *     def issubset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a subset of another."""
 *         return not bool(~self & other)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_17issubset(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_16issubset[] = "Test if this square set is a subset of another.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_17issubset = {"issubset", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_17issubset, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_16issubset};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_17issubset(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("issubset (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("issubset", 1, 2, 2, 1); __PYX_ERR(0, 3535, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "issubset") < 0)) __PYX_ERR(0, 3535, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("issubset", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3535, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.issubset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_16issubset(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_16issubset(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("issubset", 0);

  /* "chess/__init__cp.pyx":3537
 *     def issubset(self, other):
 *         """Test if this square set is a subset of another."""
 *         return not bool(~self & other)             # <<<<<<<<<<<<<<
 * 
 *     def issuperset(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Invert(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3537, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_v_other); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3537, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3537, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!((!(!__pyx_t_3)) != 0))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3537, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3535
 *         return not bool(self & other)
 * 
 *     def issubset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a subset of another."""
 *         return not bool(~self & other)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.issubset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3539
 *         return not bool(~self & other)
 * 
 *     def issuperset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a superset of another."""
 *         return not bool(self & ~other)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_19issuperset(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_18issuperset[] = "Test if this square set is a superset of another.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_19issuperset = {"issuperset", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_19issuperset, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_18issuperset};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_19issuperset(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("issuperset (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("issuperset", 1, 2, 2, 1); __PYX_ERR(0, 3539, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "issuperset") < 0)) __PYX_ERR(0, 3539, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("issuperset", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3539, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.issuperset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_18issuperset(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_18issuperset(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("issuperset", 0);

  /* "chess/__init__cp.pyx":3541
 *     def issuperset(self, other):
 *         """Test if this square set is a superset of another."""
 *         return not bool(self & ~other)             # <<<<<<<<<<<<<<
 * 
 *     def union(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Invert(__pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_And(__pyx_v_self, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3541, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyBool_FromLong((!((!(!__pyx_t_3)) != 0))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3539
 *         return not bool(~self & other)
 * 
 *     def issuperset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a superset of another."""
 *         return not bool(self & ~other)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.issuperset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3543
 *         return not bool(self & ~other)
 * 
 *     def union(self, other):             # <<<<<<<<<<<<<<
 *         return self | other
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_21union(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_21union = {"union", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_21union, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_21union(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("union (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("union", 1, 2, 2, 1); __PYX_ERR(0, 3543, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "union") < 0)) __PYX_ERR(0, 3543, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("union", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3543, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.union", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_20union(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_20union(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("union", 0);

  /* "chess/__init__cp.pyx":3544
 * 
 *     def union(self, other):
 *         return self | other             # <<<<<<<<<<<<<<
 * 
 *     def __or__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Or(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3544, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3543
 *         return not bool(self & ~other)
 * 
 *     def union(self, other):             # <<<<<<<<<<<<<<
 *         return self | other
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.union", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3546
 *         return self | other
 * 
 *     def __or__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask |= self.mask
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_23__or__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_23__or__ = {"__or__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_23__or__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_23__or__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__or__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__or__", 1, 2, 2, 1); __PYX_ERR(0, 3546, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__or__") < 0)) __PYX_ERR(0, 3546, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__or__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3546, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__or__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_22__or__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_22__or__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_r = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__or__", 0);

  /* "chess/__init__cp.pyx":3547
 * 
 *     def __or__(self, other):
 *         r = SquareSet(other)             # <<<<<<<<<<<<<<
 *         r.mask |= self.mask
 *         return r
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3547, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3547, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_r = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3548
 *     def __or__(self, other):
 *         r = SquareSet(other)
 *         r.mask |= self.mask             # <<<<<<<<<<<<<<
 *         return r
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_r, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3548, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3548, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3548, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_r, __pyx_n_s_mask, __pyx_t_3) < 0) __PYX_ERR(0, 3548, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3549
 *         r = SquareSet(other)
 *         r.mask |= self.mask
 *         return r             # <<<<<<<<<<<<<<
 * 
 *     def intersection(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_r);
  __pyx_r = __pyx_v_r;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3546
 *         return self | other
 * 
 *     def __or__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask |= self.mask
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__or__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_r);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3551
 *         return r
 * 
 *     def intersection(self, other):             # <<<<<<<<<<<<<<
 *         return self & other
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_25intersection(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_25intersection = {"intersection", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_25intersection, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_25intersection(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("intersection (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("intersection", 1, 2, 2, 1); __PYX_ERR(0, 3551, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "intersection") < 0)) __PYX_ERR(0, 3551, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("intersection", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3551, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.intersection", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_24intersection(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_24intersection(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("intersection", 0);

  /* "chess/__init__cp.pyx":3552
 * 
 *     def intersection(self, other):
 *         return self & other             # <<<<<<<<<<<<<<
 * 
 *     def __and__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_And(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3552, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3551
 *         return r
 * 
 *     def intersection(self, other):             # <<<<<<<<<<<<<<
 *         return self & other
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.intersection", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3554
 *         return self & other
 * 
 *     def __and__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask &= self.mask
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_27__and__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_27__and__ = {"__and__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_27__and__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_27__and__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__and__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__and__", 1, 2, 2, 1); __PYX_ERR(0, 3554, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__and__") < 0)) __PYX_ERR(0, 3554, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__and__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3554, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__and__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_26__and__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_26__and__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_r = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__and__", 0);

  /* "chess/__init__cp.pyx":3555
 * 
 *     def __and__(self, other):
 *         r = SquareSet(other)             # <<<<<<<<<<<<<<
 *         r.mask &= self.mask
 *         return r
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3555, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3555, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_r = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3556
 *     def __and__(self, other):
 *         r = SquareSet(other)
 *         r.mask &= self.mask             # <<<<<<<<<<<<<<
 *         return r
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_r, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3556, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3556, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3556, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_r, __pyx_n_s_mask, __pyx_t_3) < 0) __PYX_ERR(0, 3556, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3557
 *         r = SquareSet(other)
 *         r.mask &= self.mask
 *         return r             # <<<<<<<<<<<<<<
 * 
 *     def difference(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_r);
  __pyx_r = __pyx_v_r;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3554
 *         return self & other
 * 
 *     def __and__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask &= self.mask
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__and__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_r);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3559
 *         return r
 * 
 *     def difference(self, other):             # <<<<<<<<<<<<<<
 *         return self - other
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_29difference(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_29difference = {"difference", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_29difference, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_29difference(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("difference (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("difference", 1, 2, 2, 1); __PYX_ERR(0, 3559, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "difference") < 0)) __PYX_ERR(0, 3559, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("difference", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3559, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.difference", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_28difference(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_28difference(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("difference", 0);

  /* "chess/__init__cp.pyx":3560
 * 
 *     def difference(self, other):
 *         return self - other             # <<<<<<<<<<<<<<
 * 
 *     def __sub__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3560, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3559
 *         return r
 * 
 *     def difference(self, other):             # <<<<<<<<<<<<<<
 *         return self - other
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.difference", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3562
 *         return self - other
 * 
 *     def __sub__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask = self.mask & ~r.mask
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_31__sub__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_31__sub__ = {"__sub__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_31__sub__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_31__sub__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__sub__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__sub__", 1, 2, 2, 1); __PYX_ERR(0, 3562, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__sub__") < 0)) __PYX_ERR(0, 3562, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__sub__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3562, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__sub__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_30__sub__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_30__sub__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_r = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__sub__", 0);

  /* "chess/__init__cp.pyx":3563
 * 
 *     def __sub__(self, other):
 *         r = SquareSet(other)             # <<<<<<<<<<<<<<
 *         r.mask = self.mask & ~r.mask
 *         return r
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_r = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3564
 *     def __sub__(self, other):
 *         r = SquareSet(other)
 *         r.mask = self.mask & ~r.mask             # <<<<<<<<<<<<<<
 *         return r
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3564, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_r, __pyx_n_s_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3564, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Invert(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3564, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_And(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3564, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_r, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3564, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3565
 *         r = SquareSet(other)
 *         r.mask = self.mask & ~r.mask
 *         return r             # <<<<<<<<<<<<<<
 * 
 *     def symmetric_difference(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_r);
  __pyx_r = __pyx_v_r;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3562
 *         return self - other
 * 
 *     def __sub__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask = self.mask & ~r.mask
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__sub__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_r);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3567
 *         return r
 * 
 *     def symmetric_difference(self, other):             # <<<<<<<<<<<<<<
 *         return self ^ other
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_33symmetric_difference(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_33symmetric_difference = {"symmetric_difference", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_33symmetric_difference, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_33symmetric_difference(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("symmetric_difference (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("symmetric_difference", 1, 2, 2, 1); __PYX_ERR(0, 3567, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "symmetric_difference") < 0)) __PYX_ERR(0, 3567, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("symmetric_difference", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3567, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.symmetric_difference", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_32symmetric_difference(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_32symmetric_difference(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("symmetric_difference", 0);

  /* "chess/__init__cp.pyx":3568
 * 
 *     def symmetric_difference(self, other):
 *         return self ^ other             # <<<<<<<<<<<<<<
 * 
 *     def __xor__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Xor(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3568, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3567
 *         return r
 * 
 *     def symmetric_difference(self, other):             # <<<<<<<<<<<<<<
 *         return self ^ other
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.symmetric_difference", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3570
 *         return self ^ other
 * 
 *     def __xor__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask ^= self.mask
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_35__xor__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_35__xor__ = {"__xor__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_35__xor__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_35__xor__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__xor__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__xor__", 1, 2, 2, 1); __PYX_ERR(0, 3570, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__xor__") < 0)) __PYX_ERR(0, 3570, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__xor__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3570, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__xor__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_34__xor__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_34__xor__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_r = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__xor__", 0);

  /* "chess/__init__cp.pyx":3571
 * 
 *     def __xor__(self, other):
 *         r = SquareSet(other)             # <<<<<<<<<<<<<<
 *         r.mask ^= self.mask
 *         return r
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3571, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3571, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_r = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3572
 *     def __xor__(self, other):
 *         r = SquareSet(other)
 *         r.mask ^= self.mask             # <<<<<<<<<<<<<<
 *         return r
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_r, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3572, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3572, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3572, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_r, __pyx_n_s_mask, __pyx_t_3) < 0) __PYX_ERR(0, 3572, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3573
 *         r = SquareSet(other)
 *         r.mask ^= self.mask
 *         return r             # <<<<<<<<<<<<<<
 * 
 *     def copy(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_r);
  __pyx_r = __pyx_v_r;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3570
 *         return self ^ other
 * 
 *     def __xor__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask ^= self.mask
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__xor__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_r);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3575
 *         return r
 * 
 *     def copy(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_37copy(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_37copy = {"copy", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_37copy, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_37copy(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("copy (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_36copy(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_36copy(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("copy", 0);

  /* "chess/__init__cp.pyx":3576
 * 
 *     def copy(self):
 *         return SquareSet(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     # set
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3576, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3576, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3576, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3575
 *         return r
 * 
 *     def copy(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.copy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3580
 *     # set
 * 
 *     def update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self |= other
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_39update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_39update = {"update", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_39update, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_39update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_others = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("update (wrapper)", 0);
  if (PyTuple_GET_SIZE(__pyx_args) > 1) {
    __pyx_v_others = PyTuple_GetSlice(__pyx_args, 1, PyTuple_GET_SIZE(__pyx_args));
    if (unlikely(!__pyx_v_others)) {
      __Pyx_RefNannyFinishContext();
      return NULL;
    }
    __Pyx_GOTREF(__pyx_v_others);
  } else {
    __pyx_v_others = __pyx_empty_tuple; __Pyx_INCREF(__pyx_empty_tuple);
  }
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        default:
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t used_pos_args = (pos_args < 1) ? pos_args : 1;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "update") < 0)) __PYX_ERR(0, 3580, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) < 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_self = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3580, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_DECREF(__pyx_v_others); __pyx_v_others = 0;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_38update(__pyx_self, __pyx_v_self, __pyx_v_others);

  /* function exit code */
  __Pyx_XDECREF(__pyx_v_others);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_38update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_others) {
  PyObject *__pyx_v_other = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("update", 0);
  __Pyx_INCREF(__pyx_v_self);

  /* "chess/__init__cp.pyx":3581
 * 
 *     def update(self, *others):
 *         for other in others:             # <<<<<<<<<<<<<<
 *             self |= other
 * 
 */
  __pyx_t_1 = __pyx_v_others; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3581, __pyx_L1_error)
    #else
    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3581, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    #endif
    __Pyx_XDECREF_SET(__pyx_v_other, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3582
 *     def update(self, *others):
 *         for other in others:
 *             self |= other             # <<<<<<<<<<<<<<
 * 
 *     def __ior__(self, other):
 */
    __pyx_t_3 = PyNumber_InPlaceOr(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3582, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_self, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3581
 * 
 *     def update(self, *others):
 *         for other in others:             # <<<<<<<<<<<<<<
 *             self |= other
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3580
 *     # set
 * 
 *     def update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self |= other
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_other);
  __Pyx_XDECREF(__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3584
 *             self |= other
 * 
 *     def __ior__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask |= SquareSet(other).mask
 *         return self
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_41__ior__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_41__ior__ = {"__ior__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_41__ior__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_41__ior__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ior__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__ior__", 1, 2, 2, 1); __PYX_ERR(0, 3584, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__ior__") < 0)) __PYX_ERR(0, 3584, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__ior__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3584, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ior__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_40__ior__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_40__ior__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__ior__", 0);

  /* "chess/__init__cp.pyx":3585
 * 
 *     def __ior__(self, other):
 *         self.mask |= SquareSet(other).mask             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_InPlaceOr(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3585, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3586
 *     def __ior__(self, other):
 *         self.mask |= SquareSet(other).mask
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def intersection_update(self, *others):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3584
 *             self |= other
 * 
 *     def __ior__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask |= SquareSet(other).mask
 *         return self
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ior__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3588
 *         return self
 * 
 *     def intersection_update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self &= other
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_43intersection_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_43intersection_update = {"intersection_update", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_43intersection_update, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_43intersection_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_others = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("intersection_update (wrapper)", 0);
  if (PyTuple_GET_SIZE(__pyx_args) > 1) {
    __pyx_v_others = PyTuple_GetSlice(__pyx_args, 1, PyTuple_GET_SIZE(__pyx_args));
    if (unlikely(!__pyx_v_others)) {
      __Pyx_RefNannyFinishContext();
      return NULL;
    }
    __Pyx_GOTREF(__pyx_v_others);
  } else {
    __pyx_v_others = __pyx_empty_tuple; __Pyx_INCREF(__pyx_empty_tuple);
  }
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        default:
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t used_pos_args = (pos_args < 1) ? pos_args : 1;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "intersection_update") < 0)) __PYX_ERR(0, 3588, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) < 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_self = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("intersection_update", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3588, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_DECREF(__pyx_v_others); __pyx_v_others = 0;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.intersection_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_42intersection_update(__pyx_self, __pyx_v_self, __pyx_v_others);

  /* function exit code */
  __Pyx_XDECREF(__pyx_v_others);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_42intersection_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_others) {
  PyObject *__pyx_v_other = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("intersection_update", 0);
  __Pyx_INCREF(__pyx_v_self);

  /* "chess/__init__cp.pyx":3589
 * 
 *     def intersection_update(self, *others):
 *         for other in others:             # <<<<<<<<<<<<<<
 *             self &= other
 * 
 */
  __pyx_t_1 = __pyx_v_others; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3589, __pyx_L1_error)
    #else
    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3589, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    #endif
    __Pyx_XDECREF_SET(__pyx_v_other, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3590
 *     def intersection_update(self, *others):
 *         for other in others:
 *             self &= other             # <<<<<<<<<<<<<<
 * 
 *     def __iand__(self, other):
 */
    __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3590, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_self, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "chess/__init__cp.pyx":3589
 * 
 *     def intersection_update(self, *others):
 *         for other in others:             # <<<<<<<<<<<<<<
 *             self &= other
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3588
 *         return self
 * 
 *     def intersection_update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self &= other
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.intersection_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_other);
  __Pyx_XDECREF(__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3592
 *             self &= other
 * 
 *     def __iand__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= SquareSet(other).mask
 *         return self
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_45__iand__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_45__iand__ = {"__iand__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_45__iand__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_45__iand__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iand__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__iand__", 1, 2, 2, 1); __PYX_ERR(0, 3592, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__iand__") < 0)) __PYX_ERR(0, 3592, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__iand__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3592, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__iand__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_44__iand__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_44__iand__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__iand__", 0);

  /* "chess/__init__cp.pyx":3593
 * 
 *     def __iand__(self, other):
 *         self.mask &= SquareSet(other).mask             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3593, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3593, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3594
 *     def __iand__(self, other):
 *         self.mask &= SquareSet(other).mask
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def difference_update(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3592
 *             self &= other
 * 
 *     def __iand__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= SquareSet(other).mask
 *         return self
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__iand__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3596
 *         return self
 * 
 *     def difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self -= other
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_47difference_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_47difference_update = {"difference_update", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_47difference_update, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_47difference_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("difference_update (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("difference_update", 1, 2, 2, 1); __PYX_ERR(0, 3596, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "difference_update") < 0)) __PYX_ERR(0, 3596, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("difference_update", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3596, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.difference_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_46difference_update(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_46difference_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("difference_update", 0);
  __Pyx_INCREF(__pyx_v_self);

  /* "chess/__init__cp.pyx":3597
 * 
 *     def difference_update(self, other):
 *         self -= other             # <<<<<<<<<<<<<<
 * 
 *     def __isub__(self, other):
 */
  __pyx_t_1 = PyNumber_InPlaceSubtract(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3597, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF_SET(__pyx_v_self, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3596
 *         return self
 * 
 *     def difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self -= other
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.difference_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3599
 *         self -= other
 * 
 *     def __isub__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= ~SquareSet(other).mask
 *         return self
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_49__isub__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_49__isub__ = {"__isub__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_49__isub__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_49__isub__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__isub__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__isub__", 1, 2, 2, 1); __PYX_ERR(0, 3599, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__isub__") < 0)) __PYX_ERR(0, 3599, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__isub__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3599, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__isub__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_48__isub__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_48__isub__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__isub__", 0);

  /* "chess/__init__cp.pyx":3600
 * 
 *     def __isub__(self, other):
 *         self.mask &= ~SquareSet(other).mask             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Invert(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_3) < 0) __PYX_ERR(0, 3600, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3601
 *     def __isub__(self, other):
 *         self.mask &= ~SquareSet(other).mask
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def symmetric_difference_update(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3599
 *         self -= other
 * 
 *     def __isub__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= ~SquareSet(other).mask
 *         return self
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__isub__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3603
 *         return self
 * 
 *     def symmetric_difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self ^= other
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_51symmetric_difference_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_51symmetric_difference_update = {"symmetric_difference_update", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_51symmetric_difference_update, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_51symmetric_difference_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("symmetric_difference_update (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("symmetric_difference_update", 1, 2, 2, 1); __PYX_ERR(0, 3603, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "symmetric_difference_update") < 0)) __PYX_ERR(0, 3603, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("symmetric_difference_update", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3603, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.symmetric_difference_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_50symmetric_difference_update(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_50symmetric_difference_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("symmetric_difference_update", 0);
  __Pyx_INCREF(__pyx_v_self);

  /* "chess/__init__cp.pyx":3604
 * 
 *     def symmetric_difference_update(self, other):
 *         self ^= other             # <<<<<<<<<<<<<<
 * 
 *     def __ixor__(self, other):
 */
  __pyx_t_1 = PyNumber_InPlaceXor(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3604, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF_SET(__pyx_v_self, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3603
 *         return self
 * 
 *     def symmetric_difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self ^= other
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.symmetric_difference_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3606
 *         self ^= other
 * 
 *     def __ixor__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask ^= SquareSet(other).mask
 *         return self
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_53__ixor__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_53__ixor__ = {"__ixor__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_53__ixor__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_53__ixor__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ixor__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__ixor__", 1, 2, 2, 1); __PYX_ERR(0, 3606, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__ixor__") < 0)) __PYX_ERR(0, 3606, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__ixor__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3606, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ixor__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_52__ixor__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_52__ixor__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__ixor__", 0);

  /* "chess/__init__cp.pyx":3607
 * 
 *     def __ixor__(self, other):
 *         self.mask ^= SquareSet(other).mask             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3607, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3608
 *     def __ixor__(self, other):
 *         self.mask ^= SquareSet(other).mask
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def remove(self, square):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3606
 *         self ^= other
 * 
 *     def __ixor__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask ^= SquareSet(other).mask
 *         return self
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ixor__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3610
 *         return self
 * 
 *     def remove(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_55remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_54remove[] = "\n        Removes a square from the set.\n\n        :raises: :exc:`KeyError` if the given square was not in the set.\n        ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_55remove = {"remove", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_55remove, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_54remove};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_55remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("remove", 1, 2, 2, 1); __PYX_ERR(0, 3610, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "remove") < 0)) __PYX_ERR(0, 3610, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("remove", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3610, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_54remove(__pyx_self, __pyx_v_self, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_54remove(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_square) {
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("remove", 0);

  /* "chess/__init__cp.pyx":3616
 *         :raises: :exc:`KeyError` if the given square was not in the set.
 *         """
 *         mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 *         if self.mask & mask:
 *             self.mask ^= mask
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3616, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3616, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mask = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3617
 *         """
 *         mask = BB_SQUARES[square]
 *         if self.mask & mask:             # <<<<<<<<<<<<<<
 *             self.mask ^= mask
 *         else:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_And(__pyx_t_2, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3617, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(__pyx_t_3)) {

    /* "chess/__init__cp.pyx":3618
 *         mask = BB_SQUARES[square]
 *         if self.mask & mask:
 *             self.mask ^= mask             # <<<<<<<<<<<<<<
 *         else:
 *             raise KeyError(square)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3618, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_InPlaceXor(__pyx_t_1, __pyx_v_mask); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3618, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3618, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "chess/__init__cp.pyx":3617
 *         """
 *         mask = BB_SQUARES[square]
 *         if self.mask & mask:             # <<<<<<<<<<<<<<
 *             self.mask ^= mask
 *         else:
 */
    goto __pyx_L3;
  }

  /* "chess/__init__cp.pyx":3620
 *             self.mask ^= mask
 *         else:
 *             raise KeyError(square)             # <<<<<<<<<<<<<<
 * 
 *     def pop(self):
 */
  /*else*/ {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_v_square); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3620, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 3620, __pyx_L1_error)
  }
  __pyx_L3:;

  /* "chess/__init__cp.pyx":3610
 *         return self
 * 
 *     def remove(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3622
 *             raise KeyError(square)
 * 
 *     def pop(self):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set and returns it.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_57pop(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_56pop[] = "\n        Removes a square from the set and returns it.\n\n        :raises: :exc:`KeyError` on an empty set.\n        ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_57pop = {"pop", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_57pop, METH_O, __pyx_doc_5chess_10__init__cp_9SquareSet_56pop};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_57pop(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("pop (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_56pop(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_56pop(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("pop", 0);

  /* "chess/__init__cp.pyx":3628
 *         :raises: :exc:`KeyError` on an empty set.
 *         """
 *         if not self.mask:             # <<<<<<<<<<<<<<
 *             raise KeyError("pop from empty SquareSet")
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3628, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3628, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (unlikely(__pyx_t_3)) {

    /* "chess/__init__cp.pyx":3629
 *         """
 *         if not self.mask:
 *             raise KeyError("pop from empty SquareSet")             # <<<<<<<<<<<<<<
 * 
 *         square = lsb(self.mask)
 */
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_KeyError, __pyx_tuple__61, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3629, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 3629, __pyx_L1_error)

    /* "chess/__init__cp.pyx":3628
 *         :raises: :exc:`KeyError` on an empty set.
 *         """
 *         if not self.mask:             # <<<<<<<<<<<<<<
 *             raise KeyError("pop from empty SquareSet")
 * 
 */
  }

  /* "chess/__init__cp.pyx":3631
 *             raise KeyError("pop from empty SquareSet")
 * 
 *         square = lsb(self.mask)             # <<<<<<<<<<<<<<
 *         self.mask &= (self.mask - 1)
 *         return square
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_lsb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_square = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3632
 * 
 *         square = lsb(self.mask)
 *         self.mask &= (self.mask - 1)             # <<<<<<<<<<<<<<
 *         return square
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_InPlaceAnd(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_4) < 0) __PYX_ERR(0, 3632, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "chess/__init__cp.pyx":3633
 *         square = lsb(self.mask)
 *         self.mask &= (self.mask - 1)
 *         return square             # <<<<<<<<<<<<<<
 * 
 *     def clear(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_square);
  __pyx_r = __pyx_v_square;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3622
 *             raise KeyError(square)
 * 
 *     def pop(self):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set and returns it.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.pop", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3635
 *         return square
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         """Remove all elements from this set."""
 *         self.mask = BB_EMPTY
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_59clear(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_58clear[] = "Remove all elements from this set.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_59clear = {"clear", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_59clear, METH_O, __pyx_doc_5chess_10__init__cp_9SquareSet_58clear};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_59clear(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clear (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_58clear(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_58clear(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("clear", 0);

  /* "chess/__init__cp.pyx":3637
 *     def clear(self):
 *         """Remove all elements from this set."""
 *         self.mask = BB_EMPTY             # <<<<<<<<<<<<<<
 * 
 *     # SquareSet
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_EMPTY); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3637, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_1) < 0) __PYX_ERR(0, 3637, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3635
 *         return square
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         """Remove all elements from this set."""
 *         self.mask = BB_EMPTY
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.clear", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3641
 *     # SquareSet
 * 
 *     def carry_rippler(self):             # <<<<<<<<<<<<<<
 *         """Iterator over the subsets of this set."""
 *         return _carry_rippler(self.mask)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_61carry_rippler(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_60carry_rippler[] = "Iterator over the subsets of this set.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_61carry_rippler = {"carry_rippler", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_61carry_rippler, METH_O, __pyx_doc_5chess_10__init__cp_9SquareSet_60carry_rippler};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_61carry_rippler(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("carry_rippler (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_60carry_rippler(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_60carry_rippler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("carry_rippler", 0);

  /* "chess/__init__cp.pyx":3643
 *     def carry_rippler(self):
 *         """Iterator over the subsets of this set."""
 *         return _carry_rippler(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     def mirror(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_carry_rippler); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3643, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3643, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3643, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3641
 *     # SquareSet
 * 
 *     def carry_rippler(self):             # <<<<<<<<<<<<<<
 *         """Iterator over the subsets of this set."""
 *         return _carry_rippler(self.mask)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.carry_rippler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3645
 *         return _carry_rippler(self.mask)
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         """Returns a vertically mirrored copy of this square set."""
 *         return SquareSet(flip_vertical(self.mask))
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_63mirror(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_62mirror[] = "Returns a vertically mirrored copy of this square set.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_63mirror = {"mirror", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_63mirror, METH_O, __pyx_doc_5chess_10__init__cp_9SquareSet_62mirror};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_63mirror(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_62mirror(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_62mirror(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("mirror", 0);

  /* "chess/__init__cp.pyx":3647
 *     def mirror(self):
 *         """Returns a vertically mirrored copy of this square set."""
 *         return SquareSet(flip_vertical(self.mask))             # <<<<<<<<<<<<<<
 * 
 *     def tolist(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_flip_vertical); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3645
 *         return _carry_rippler(self.mask)
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         """Returns a vertically mirrored copy of this square set."""
 *         return SquareSet(flip_vertical(self.mask))
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.mirror", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3649
 *         return SquareSet(flip_vertical(self.mask))
 * 
 *     def tolist(self):             # <<<<<<<<<<<<<<
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_65tolist(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_64tolist[] = "Convert the set to a list of 64 bools.";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_65tolist = {"tolist", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_65tolist, METH_O, __pyx_doc_5chess_10__init__cp_9SquareSet_64tolist};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_65tolist(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("tolist (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_64tolist(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_64tolist(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_l = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("tolist", 0);

  /* "chess/__init__cp.pyx":3651
 *     def tolist(self):
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64             # <<<<<<<<<<<<<<
 *         for square in self:
 *             l[square] = True
 */
  __pyx_t_1 = PyList_New(1 * 64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3651, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  { Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < 64; __pyx_temp++) {
      __Pyx_INCREF(Py_False);
      __Pyx_GIVEREF(Py_False);
      PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_False);
    }
  }
  __pyx_v_l = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3652
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64
 *         for square in self:             # <<<<<<<<<<<<<<
 *             l[square] = True
 *         return l
 */
  if (likely(PyList_CheckExact(__pyx_v_self)) || PyTuple_CheckExact(__pyx_v_self)) {
    __pyx_t_1 = __pyx_v_self; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3652, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3652, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3652, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3652, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 3652, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3652, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3652, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "chess/__init__cp.pyx":3653
 *         l = [False] * 64
 *         for square in self:
 *             l[square] = True             # <<<<<<<<<<<<<<
 *         return l
 * 
 */
    if (unlikely(PyObject_SetItem(__pyx_v_l, __pyx_v_square, Py_True) < 0)) __PYX_ERR(0, 3653, __pyx_L1_error)

    /* "chess/__init__cp.pyx":3652
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64
 *         for square in self:             # <<<<<<<<<<<<<<
 *             l[square] = True
 *         return l
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3654
 *         for square in self:
 *             l[square] = True
 *         return l             # <<<<<<<<<<<<<<
 * 
 *     def __bool__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_l);
  __pyx_r = __pyx_v_l;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3649
 *         return SquareSet(flip_vertical(self.mask))
 * 
 *     def tolist(self):             # <<<<<<<<<<<<<<
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.tolist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_l);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3656
 *         return l
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return bool(self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_67__bool__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_67__bool__ = {"__bool__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_67__bool__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_67__bool__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__bool__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_66__bool__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_66__bool__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("__bool__", 0);

  /* "chess/__init__cp.pyx":3657
 * 
 *     def __bool__(self):
 *         return bool(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     def __eq__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 3657, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyBool_FromLong((!(!__pyx_t_2))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3656
 *         return l
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return bool(self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__bool__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3659
 *         return bool(self.mask)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_69__eq__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_69__eq__ = {"__eq__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_69__eq__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_69__eq__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__eq__", 1, 2, 2, 1); __PYX_ERR(0, 3659, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__eq__") < 0)) __PYX_ERR(0, 3659, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__eq__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3659, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_68__eq__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_68__eq__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_ne = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("__eq__", 0);

  /* "chess/__init__cp.pyx":3660
 * 
 *     def __eq__(self, other):
 *         ne = self.__ne__(other)             # <<<<<<<<<<<<<<
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_ne); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3660, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_other);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3660, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3661
 *     def __eq__(self, other):
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne             # <<<<<<<<<<<<<<
 * 
 *     def __ne__(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = (__pyx_v_ne == __pyx_builtin_NotImplemented);
  if ((__pyx_t_4 != 0)) {
    __Pyx_INCREF(__pyx_builtin_NotImplemented);
    __pyx_t_1 = __pyx_builtin_NotImplemented;
  } else {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_ne); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 3661, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3659
 *         return bool(self.mask)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3663
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             return self.mask != SquareSet(other).mask
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_71__ne__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_71__ne__ = {"__ne__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_71__ne__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_71__ne__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ne__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__ne__", 1, 2, 2, 1); __PYX_ERR(0, 3663, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__ne__") < 0)) __PYX_ERR(0, 3663, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__ne__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3663, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_70__ne__(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_70__ne__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__ne__", 0);

  /* "chess/__init__cp.pyx":3664
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             return self.mask != SquareSet(other).mask
 *         except (TypeError, ValueError):
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "chess/__init__cp.pyx":3665
 *     def __ne__(self, other):
 *         try:
 *             return self.mask != SquareSet(other).mask             # <<<<<<<<<<<<<<
 *         except (TypeError, ValueError):
 *             return NotImplemented
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3665, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3665, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_v_other) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_other);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3665, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_mask); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3665, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_t_6, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3665, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L7_try_return;

      /* "chess/__init__cp.pyx":3664
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             return self.mask != SquareSet(other).mask
 *         except (TypeError, ValueError):
 */
    }
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "chess/__init__cp.pyx":3666
 *         try:
 *             return self.mask != SquareSet(other).mask
 *         except (TypeError, ValueError):             # <<<<<<<<<<<<<<
 *             return NotImplemented
 * 
 */
    __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError) || __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
    if (__pyx_t_8) {
      __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_4) < 0) __PYX_ERR(0, 3666, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_4);

      /* "chess/__init__cp.pyx":3667
 *             return self.mask != SquareSet(other).mask
 *         except (TypeError, ValueError):
 *             return NotImplemented             # <<<<<<<<<<<<<<
 * 
 *     def __lshift__(self, shift):
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_builtin_NotImplemented);
      __pyx_r = __pyx_builtin_NotImplemented;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L6_except_return;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "chess/__init__cp.pyx":3664
 * 
 *     def __ne__(self, other):
 *         try:             # <<<<<<<<<<<<<<
 *             return self.mask != SquareSet(other).mask
 *         except (TypeError, ValueError):
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
    __pyx_L6_except_return:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L0;
  }

  /* "chess/__init__cp.pyx":3663
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             return self.mask != SquareSet(other).mask
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ne__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3669
 *             return NotImplemented
 * 
 *     def __lshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_73__lshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_73__lshift__ = {"__lshift__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_73__lshift__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_73__lshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_shift = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__lshift__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_shift,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shift)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__lshift__", 1, 2, 2, 1); __PYX_ERR(0, 3669, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__lshift__") < 0)) __PYX_ERR(0, 3669, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_shift = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__lshift__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3669, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__lshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_72__lshift__(__pyx_self, __pyx_v_self, __pyx_v_shift);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_72__lshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__lshift__", 0);

  /* "chess/__init__cp.pyx":3670
 * 
 *     def __lshift__(self, shift):
 *         return SquareSet((self.mask << shift) & BB_ALL)             # <<<<<<<<<<<<<<
 * 
 *     def __rshift__(self, shift):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_Lshift(__pyx_t_3, __pyx_v_shift); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3669
 *             return NotImplemented
 * 
 *     def __lshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__lshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3672
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 *     def __rshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask >> shift)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_75__rshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_75__rshift__ = {"__rshift__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_75__rshift__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_75__rshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_shift = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__rshift__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_shift,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shift)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__rshift__", 1, 2, 2, 1); __PYX_ERR(0, 3672, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__rshift__") < 0)) __PYX_ERR(0, 3672, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_shift = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__rshift__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3672, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__rshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_74__rshift__(__pyx_self, __pyx_v_self, __pyx_v_shift);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_74__rshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__rshift__", 0);

  /* "chess/__init__cp.pyx":3673
 * 
 *     def __rshift__(self, shift):
 *         return SquareSet(self.mask >> shift)             # <<<<<<<<<<<<<<
 * 
 *     def __ilshift__(self, shift):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3673, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3673, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_Rshift(__pyx_t_3, __pyx_v_shift); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3673, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3673, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3672
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 *     def __rshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask >> shift)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__rshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3675
 *         return SquareSet(self.mask >> shift)
 * 
 *     def __ilshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask = (self.mask << shift) & BB_ALL
 *         return self
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_77__ilshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_77__ilshift__ = {"__ilshift__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_77__ilshift__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_77__ilshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_shift = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__ilshift__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_shift,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shift)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__ilshift__", 1, 2, 2, 1); __PYX_ERR(0, 3675, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__ilshift__") < 0)) __PYX_ERR(0, 3675, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_shift = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__ilshift__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3675, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ilshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_76__ilshift__(__pyx_self, __pyx_v_self, __pyx_v_shift);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_76__ilshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__ilshift__", 0);

  /* "chess/__init__cp.pyx":3676
 * 
 *     def __ilshift__(self, shift):
 *         self.mask = (self.mask << shift) & BB_ALL             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3676, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Lshift(__pyx_t_1, __pyx_v_shift); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3676, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3676, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3676, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_3) < 0) __PYX_ERR(0, 3676, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "chess/__init__cp.pyx":3677
 *     def __ilshift__(self, shift):
 *         self.mask = (self.mask << shift) & BB_ALL
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def __irshift__(self, shift):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3675
 *         return SquareSet(self.mask >> shift)
 * 
 *     def __ilshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask = (self.mask << shift) & BB_ALL
 *         return self
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__ilshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3679
 *         return self
 * 
 *     def __irshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask >>= shift
 *         return self
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_79__irshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_79__irshift__ = {"__irshift__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_79__irshift__, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_79__irshift__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_shift = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__irshift__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_shift,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shift)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__irshift__", 1, 2, 2, 1); __PYX_ERR(0, 3679, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__irshift__") < 0)) __PYX_ERR(0, 3679, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_shift = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__irshift__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3679, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__irshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_78__irshift__(__pyx_self, __pyx_v_self, __pyx_v_shift);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_78__irshift__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_shift) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__irshift__", 0);

  /* "chess/__init__cp.pyx":3680
 * 
 *     def __irshift__(self, shift):
 *         self.mask >>= shift             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_InPlaceRshift(__pyx_t_1, __pyx_v_shift); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_mask, __pyx_t_2) < 0) __PYX_ERR(0, 3680, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3681
 *     def __irshift__(self, shift):
 *         self.mask >>= shift
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def __invert__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3679
 *         return self
 * 
 *     def __irshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask >>= shift
 *         return self
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__irshift__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3683
 *         return self
 * 
 *     def __invert__(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_81__invert__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_81__invert__ = {"__invert__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_81__invert__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_81__invert__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__invert__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_80__invert__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_80__invert__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__invert__", 0);

  /* "chess/__init__cp.pyx":3684
 * 
 *     def __invert__(self):
 *         return SquareSet(~self.mask & BB_ALL)             # <<<<<<<<<<<<<<
 * 
 *     def __int__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SquareSet); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyNumber_Invert(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyNumber_And(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3683
 *         return self
 * 
 *     def __invert__(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__invert__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3686
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 *     def __int__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_83__int__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_83__int__ = {"__int__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_83__int__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_83__int__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__int__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_82__int__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_82__int__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__int__", 0);

  /* "chess/__init__cp.pyx":3687
 * 
 *     def __int__(self):
 *         return self.mask             # <<<<<<<<<<<<<<
 * 
 *     def __index__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3686
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 *     def __int__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__int__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3689
 *         return self.mask
 * 
 *     def __index__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_85__index__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_85__index__ = {"__index__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_85__index__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_85__index__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__index__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_84__index__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_84__index__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__index__", 0);

  /* "chess/__init__cp.pyx":3690
 * 
 *     def __index__(self):
 *         return self.mask             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3690, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3689
 *         return self.mask
 * 
 *     def __index__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__index__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3692
 *         return self.mask
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_87__repr__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_87__repr__ = {"__repr__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_87__repr__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_87__repr__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_86__repr__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_86__repr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "chess/__init__cp.pyx":3693
 * 
 *     def __repr__(self):
 *         return "SquareSet({0:#018x})".format(self.mask)             # <<<<<<<<<<<<<<
 * 
 *     def __str__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_SquareSet_0_018x, __pyx_n_s_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3693, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3693, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3693, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3692
 *         return self.mask
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3695
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_89__str__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_89__str__ = {"__str__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_89__str__, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_89__str__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_88__str__(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_88__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_builder = NULL;
  PyObject *__pyx_v_square = NULL;
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("__str__", 0);

  /* "chess/__init__cp.pyx":3696
 * 
 *     def __str__(self):
 *         builder = []             # <<<<<<<<<<<<<<
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 *         for square in SQUARES_180:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_builder = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3697
 *     def __str__(self):
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )             # <<<<<<<<<<<<<<
 *         for square in SQUARES_180:
 *             mask = BB_SQUARES[square]
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__63, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3697, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3698
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 *         for square in SQUARES_180:             # <<<<<<<<<<<<<<
 *             mask = BB_SQUARES[square]
 *             if self.mask & mask:
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARES_180); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3698, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3698, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3698, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 3698, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3698, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 3698, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3698, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 3698, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_square, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "chess/__init__cp.pyx":3699
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 *         for square in SQUARES_180:
 *             mask = BB_SQUARES[square]             # <<<<<<<<<<<<<<
 *             if self.mask & mask:
 *                 builder.append("1")
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3699, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_square); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3699, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_mask, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "chess/__init__cp.pyx":3700
 *         for square in SQUARES_180:
 *             mask = BB_SQUARES[square]
 *             if self.mask & mask:             # <<<<<<<<<<<<<<
 *                 builder.append("1")
 *             else:
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_mask); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3700, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyNumber_And(__pyx_t_5, __pyx_v_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3700, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3700, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":3701
 *             mask = BB_SQUARES[square]
 *             if self.mask & mask:
 *                 builder.append("1")             # <<<<<<<<<<<<<<
 *             else:
 *                 builder.append(".")
 */
      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 3701, __pyx_L1_error)

      /* "chess/__init__cp.pyx":3700
 *         for square in SQUARES_180:
 *             mask = BB_SQUARES[square]
 *             if self.mask & mask:             # <<<<<<<<<<<<<<
 *                 builder.append("1")
 *             else:
 */
      goto __pyx_L5;
    }

    /* "chess/__init__cp.pyx":3703
 *                 builder.append("1")
 *             else:
 *                 builder.append(".")             # <<<<<<<<<<<<<<
 * 
 *             if mask & BB_FILE_H:
 */
    /*else*/ {
      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__18); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 3703, __pyx_L1_error)
    }
    __pyx_L5:;

    /* "chess/__init__cp.pyx":3705
 *                 builder.append(".")
 * 
 *             if mask & BB_FILE_H:             # <<<<<<<<<<<<<<
 *                 if square != H1:
 *                     builder.append("\n")
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_FILE_H); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3705, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyNumber_And(__pyx_v_mask, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3705, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3705, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {

      /* "chess/__init__cp.pyx":3706
 * 
 *             if mask & BB_FILE_H:
 *                 if square != H1:             # <<<<<<<<<<<<<<
 *                     builder.append("\n")
 *             else:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_H1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3706, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_square, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3706, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 3706, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_6) {

        /* "chess/__init__cp.pyx":3707
 *             if mask & BB_FILE_H:
 *                 if square != H1:
 *                     builder.append("\n")             # <<<<<<<<<<<<<<
 *             else:
 *                 builder.append(" ")
 */
        __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__19); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 3707, __pyx_L1_error)

        /* "chess/__init__cp.pyx":3706
 * 
 *             if mask & BB_FILE_H:
 *                 if square != H1:             # <<<<<<<<<<<<<<
 *                     builder.append("\n")
 *             else:
 */
      }

      /* "chess/__init__cp.pyx":3705
 *                 builder.append(".")
 * 
 *             if mask & BB_FILE_H:             # <<<<<<<<<<<<<<
 *                 if square != H1:
 *                     builder.append("\n")
 */
      goto __pyx_L6;
    }

    /* "chess/__init__cp.pyx":3709
 *                     builder.append("\n")
 *             else:
 *                 builder.append(" ")             # <<<<<<<<<<<<<<
 * 
 *         return "".join(builder)
 */
    /*else*/ {
      __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_builder, __pyx_kp_u__14); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 3709, __pyx_L1_error)
    }
    __pyx_L6:;

    /* "chess/__init__cp.pyx":3698
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 *         for square in SQUARES_180:             # <<<<<<<<<<<<<<
 *             mask = BB_SQUARES[square]
 *             if self.mask & mask:
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "chess/__init__cp.pyx":3711
 *                 builder.append(" ")
 * 
 *         return "".join(builder)             # <<<<<<<<<<<<<<
 * 
 *     def _repr_svg_(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__13, __pyx_v_builder); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3711, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3695
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_builder);
  __Pyx_XDECREF(__pyx_v_square);
  __Pyx_XDECREF(__pyx_v_mask);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3713
 *         return "".join(builder)
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.board(squares=self, size=400)
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_91_repr_svg_(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_91_repr_svg_ = {"_repr_svg_", (PyCFunction)__pyx_pw_5chess_10__init__cp_9SquareSet_91_repr_svg_, METH_O, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_91_repr_svg_(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_repr_svg_ (wrapper)", 0);
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_90_repr_svg_(__pyx_self, ((PyObject *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_90_repr_svg_(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_chess = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("_repr_svg_", 0);

  /* "chess/__init__cp.pyx":3714
 * 
 *     def _repr_svg_(self):
 *         import chess.svg             # <<<<<<<<<<<<<<
 *         return chess.svg.board(squares=self, size=400)
 * 
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_chess_svg, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3714, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_chess = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3715
 *     def _repr_svg_(self):
 *         import chess.svg
 *         return chess.svg.board(squares=self, size=400)             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_chess, __pyx_n_s_svg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3715, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_board); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3715, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3715, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_squares, __pyx_v_self) < 0) __PYX_ERR(0, 3715, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_size, __pyx_int_400) < 0) __PYX_ERR(0, 3715, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3715, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3713
 *         return "".join(builder)
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.board(squares=self, size=400)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet._repr_svg_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_chess);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "chess/__init__cp.pyx":3718
 * 
 *     @classmethod
 *     def from_square(cls, square):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.SquareSet` from a single square.
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_93from_square(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_5chess_10__init__cp_9SquareSet_92from_square[] = "\n        Creates a :class:`~chess.SquareSet` from a single square.\n\n        >>> import chess\n        >>>\n        >>> chess.SquareSet.from_square(chess.A1) == chess.BB_A1\n        True\n        ";
static PyMethodDef __pyx_mdef_5chess_10__init__cp_9SquareSet_93from_square = {"from_square", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9SquareSet_93from_square, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9SquareSet_92from_square};
static PyObject *__pyx_pw_5chess_10__init__cp_9SquareSet_93from_square(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_cls = 0;
  PyObject *__pyx_v_square = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("from_square (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_cls,&__pyx_n_s_square,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cls)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_square)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("from_square", 1, 2, 2, 1); __PYX_ERR(0, 3718, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_square") < 0)) __PYX_ERR(0, 3718, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_cls = values[0];
    __pyx_v_square = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("from_square", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3718, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.from_square", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_9SquareSet_92from_square(__pyx_self, __pyx_v_cls, __pyx_v_square);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_9SquareSet_92from_square(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_square) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("from_square", 0);

  /* "chess/__init__cp.pyx":3727
 *         True
 *         """
 *         return cls(BB_SQUARES[square])             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3727, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_square); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3727, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_INCREF(__pyx_v_cls);
  __pyx_t_2 = __pyx_v_cls; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3727, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "chess/__init__cp.pyx":3718
 * 
 *     @classmethod
 *     def from_square(cls, square):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.SquareSet` from a single square.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("chess.__init__cp.SquareSet.from_square", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __pyx_unpickle_Move(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_70__pyx_unpickle_Move(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_70__pyx_unpickle_Move = {"__pyx_unpickle_Move", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_70__pyx_unpickle_Move, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_70__pyx_unpickle_Move(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v___pyx_type = 0;
  long __pyx_v___pyx_checksum;
  PyObject *__pyx_v___pyx_state = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__pyx_unpickle_Move (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Move", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Move", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_Move") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v___pyx_type = values[0];
    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
    __pyx_v___pyx_state = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Move", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_Move", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_69__pyx_unpickle_Move(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_69__pyx_unpickle_Move(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_v___pyx_PickleError = 0;
  PyObject *__pyx_v___pyx_result = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__pyx_unpickle_Move", 0);

  /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x5ab3dd3:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)
 */
  __pyx_t_1 = ((__pyx_v___pyx_checksum != 0x5ab3dd3) != 0);
  if (__pyx_t_1) {

    /* "(tree fragment)":5
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x5ab3dd3:
 *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)
 *     __pyx_result = Move.__new__(__pyx_type)
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_n_s_PickleError);
    __Pyx_GIVEREF(__pyx_n_s_PickleError);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_PickleError);
    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_v___pyx_PickleError = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":6
 *     if __pyx_checksum != 0x5ab3dd3:
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)             # <<<<<<<<<<<<<<
 *     __pyx_result = Move.__new__(__pyx_type)
 *     if __pyx_state is not None:
 */
    __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_s_vs_0x5a, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v___pyx_PickleError);
    __pyx_t_2 = __pyx_v___pyx_PickleError; __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(1, 6, __pyx_L1_error)

    /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x5ab3dd3:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)
 */
  }

  /* "(tree fragment)":7
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)
 *     __pyx_result = Move.__new__(__pyx_type)             # <<<<<<<<<<<<<<
 *     if __pyx_state is not None:
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_Move), __pyx_n_s_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v___pyx_type);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v___pyx_result = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)
 *     __pyx_result = Move.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  __pyx_t_1 = (__pyx_v___pyx_state != Py_None);
  __pyx_t_6 = (__pyx_t_1 != 0);
  if (__pyx_t_6) {

    /* "(tree fragment)":9
 *     __pyx_result = Move.__new__(__pyx_type)
 *     if __pyx_state is not None:
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
 *     return __pyx_result
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):
 */
    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
    __pyx_t_3 = __pyx_f_5chess_10__init__cp___pyx_unpickle_Move__set_state(((struct __pyx_obj_5chess_10__init__cp_Move *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x5ab3dd3 = (drop, from_square, promotion, to_square))" % __pyx_checksum)
 *     __pyx_result = Move.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  }

  /* "(tree fragment)":10
 *     if __pyx_state is not None:
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 *     return __pyx_result             # <<<<<<<<<<<<<<
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v___pyx_result);
  __pyx_r = __pyx_v___pyx_result;
  goto __pyx_L0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_Move(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_Move", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
  __Pyx_XDECREF(__pyx_v___pyx_result);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":11
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):
 */

static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_Move__set_state(struct __pyx_obj_5chess_10__init__cp_Move *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  Py_ssize_t __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("__pyx_unpickle_Move__set_state", 0);

  /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[4])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->drop);
  __Pyx_DECREF(__pyx_v___pyx_result->drop);
  __pyx_v___pyx_result->drop = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->from_square = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->promotion);
  __Pyx_DECREF(__pyx_v___pyx_result->promotion);
  __pyx_v___pyx_result->promotion = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_2 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->to_square = __pyx_t_2;

  /* "(tree fragment)":13
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[4])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(1, 13, __pyx_L1_error)
  }
  __pyx_t_4 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_5 = ((__pyx_t_4 > 4) != 0);
  if (__pyx_t_5) {
  } else {
    __pyx_t_3 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_5 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_6 = (__pyx_t_5 != 0);
  __pyx_t_3 = __pyx_t_6;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_3) {

    /* "(tree fragment)":14
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[4])             # <<<<<<<<<<<<<<
 */
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_update); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(__pyx_v___pyx_state == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(1, 14, __pyx_L1_error)
    }
    __pyx_t_7 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    __pyx_t_1 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_9, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "(tree fragment)":13
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[4])
 */
  }

  /* "(tree fragment)":11
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_Move__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __pyx_unpickle_BaseBoard(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_72__pyx_unpickle_BaseBoard(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_72__pyx_unpickle_BaseBoard = {"__pyx_unpickle_BaseBoard", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_72__pyx_unpickle_BaseBoard, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_72__pyx_unpickle_BaseBoard(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v___pyx_type = 0;
  long __pyx_v___pyx_checksum;
  PyObject *__pyx_v___pyx_state = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__pyx_unpickle_BaseBoard (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_BaseBoard", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_BaseBoard", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_BaseBoard") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v___pyx_type = values[0];
    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
    __pyx_v___pyx_state = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_BaseBoard", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_BaseBoard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_71__pyx_unpickle_BaseBoard(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_71__pyx_unpickle_BaseBoard(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_v___pyx_PickleError = 0;
  PyObject *__pyx_v___pyx_result = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__pyx_unpickle_BaseBoard", 0);

  /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x3631f4f:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 */
  __pyx_t_1 = ((__pyx_v___pyx_checksum != 0x3631f4f) != 0);
  if (__pyx_t_1) {

    /* "(tree fragment)":5
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x3631f4f:
 *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = BaseBoard.__new__(__pyx_type)
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_n_s_PickleError);
    __Pyx_GIVEREF(__pyx_n_s_PickleError);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_PickleError);
    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_v___pyx_PickleError = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":6
 *     if __pyx_checksum != 0x3631f4f:
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)             # <<<<<<<<<<<<<<
 *     __pyx_result = BaseBoard.__new__(__pyx_type)
 *     if __pyx_state is not None:
 */
    __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_s_vs_0x36, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v___pyx_PickleError);
    __pyx_t_2 = __pyx_v___pyx_PickleError; __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(1, 6, __pyx_L1_error)

    /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x3631f4f:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 */
  }

  /* "(tree fragment)":7
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = BaseBoard.__new__(__pyx_type)             # <<<<<<<<<<<<<<
 *     if __pyx_state is not None:
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_BaseBoard), __pyx_n_s_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v___pyx_type);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v___pyx_result = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = BaseBoard.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  __pyx_t_1 = (__pyx_v___pyx_state != Py_None);
  __pyx_t_6 = (__pyx_t_1 != 0);
  if (__pyx_t_6) {

    /* "(tree fragment)":9
 *     __pyx_result = BaseBoard.__new__(__pyx_type)
 *     if __pyx_state is not None:
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
 *     return __pyx_result
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):
 */
    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
    __pyx_t_3 = __pyx_f_5chess_10__init__cp___pyx_unpickle_BaseBoard__set_state(((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = BaseBoard.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  }

  /* "(tree fragment)":10
 *     if __pyx_state is not None:
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)
 *     return __pyx_result             # <<<<<<<<<<<<<<
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v___pyx_result);
  __pyx_r = __pyx_v___pyx_result;
  goto __pyx_L0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_BaseBoard(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_BaseBoard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
  __Pyx_XDECREF(__pyx_v___pyx_result);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":11
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */

static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_BaseBoard__set_state(struct __pyx_obj_5chess_10__init__cp_BaseBoard *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  unsigned PY_LONG_LONG __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  unsigned PY_LONG_LONG __pyx_t_5[2];
  Py_ssize_t __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  __Pyx_RefNannySetupContext("__pyx_unpickle_BaseBoard__set_state", 0);

  /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->bishops = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->castling_rights = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->chess960 = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->ep_square);
  __Pyx_DECREF(__pyx_v___pyx_result->ep_square);
  __pyx_v___pyx_result->ep_square = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->fullmove_number = __pyx_t_4;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->halfmove_clock = __pyx_t_4;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 6, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->kings = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 7, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->knights = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5chess_10__init__cp_LegalMoveGenerator))))) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->legal_moves);
  __Pyx_DECREF(((PyObject *)__pyx_v___pyx_result->legal_moves));
  __pyx_v___pyx_result->legal_moves = ((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_t_1);
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 9, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->move_stack);
  __Pyx_DECREF(__pyx_v___pyx_result->move_stack);
  __pyx_v___pyx_result->move_stack = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->occupied = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 11, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(__Pyx_carray_from_py_unsigned_PY_LONG_LONG(__pyx_t_1, __pyx_t_5, 2) < 0)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  memcpy(&(__pyx_v___pyx_result->occupied_co[0]), __pyx_t_5, sizeof(__pyx_v___pyx_result->occupied_co[0]) * (2));
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 12, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->pawns = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 13, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->promoted = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 14, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5chess_10__init__cp_PseudoLegalMoveGenerator))))) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->pseudo_legal_moves);
  __Pyx_DECREF(((PyObject *)__pyx_v___pyx_result->pseudo_legal_moves));
  __pyx_v___pyx_result->pseudo_legal_moves = ((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_t_1);
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 15, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->queens = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 16, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->rooks = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 17, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->stack);
  __Pyx_DECREF(__pyx_v___pyx_result->stack);
  __pyx_v___pyx_result->stack = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 18, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->turn = __pyx_t_3;

  /* "(tree fragment)":13
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(1, 13, __pyx_L1_error)
  }
  __pyx_t_6 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_7 = ((__pyx_t_6 > 19) != 0);
  if (__pyx_t_7) {
  } else {
    __pyx_t_3 = __pyx_t_7;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_7 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_8 = (__pyx_t_7 != 0);
  __pyx_t_3 = __pyx_t_8;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_3) {

    /* "(tree fragment)":14
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[19])             # <<<<<<<<<<<<<<
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_update); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(__pyx_v___pyx_state == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(1, 14, __pyx_L1_error)
    }
    __pyx_t_9 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 19, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_11 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
      }
    }
    __pyx_t_1 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_11, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_9);
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "(tree fragment)":13
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  }

  /* "(tree fragment)":11
 *         __pyx_unpickle_BaseBoard__set_state(<BaseBoard> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_BaseBoard__set_state(BaseBoard __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_BaseBoard__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __pyx_unpickle_Board(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_74__pyx_unpickle_Board(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_74__pyx_unpickle_Board = {"__pyx_unpickle_Board", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_74__pyx_unpickle_Board, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_74__pyx_unpickle_Board(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v___pyx_type = 0;
  long __pyx_v___pyx_checksum;
  PyObject *__pyx_v___pyx_state = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__pyx_unpickle_Board (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Board", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Board", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_Board") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v___pyx_type = values[0];
    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
    __pyx_v___pyx_state = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Board", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_Board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_73__pyx_unpickle_Board(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_73__pyx_unpickle_Board(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_v___pyx_PickleError = 0;
  PyObject *__pyx_v___pyx_result = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__pyx_unpickle_Board", 0);

  /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x3631f4f:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 */
  __pyx_t_1 = ((__pyx_v___pyx_checksum != 0x3631f4f) != 0);
  if (__pyx_t_1) {

    /* "(tree fragment)":5
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x3631f4f:
 *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = Board.__new__(__pyx_type)
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_n_s_PickleError);
    __Pyx_GIVEREF(__pyx_n_s_PickleError);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_PickleError);
    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_v___pyx_PickleError = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":6
 *     if __pyx_checksum != 0x3631f4f:
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)             # <<<<<<<<<<<<<<
 *     __pyx_result = Board.__new__(__pyx_type)
 *     if __pyx_state is not None:
 */
    __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_s_vs_0x36, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v___pyx_PickleError);
    __pyx_t_2 = __pyx_v___pyx_PickleError; __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(1, 6, __pyx_L1_error)

    /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0x3631f4f:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 */
  }

  /* "(tree fragment)":7
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = Board.__new__(__pyx_type)             # <<<<<<<<<<<<<<
 *     if __pyx_state is not None:
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_Board), __pyx_n_s_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v___pyx_type);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v___pyx_result = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = Board.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  __pyx_t_1 = (__pyx_v___pyx_state != Py_None);
  __pyx_t_6 = (__pyx_t_1 != 0);
  if (__pyx_t_6) {

    /* "(tree fragment)":9
 *     __pyx_result = Board.__new__(__pyx_type)
 *     if __pyx_state is not None:
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
 *     return __pyx_result
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):
 */
    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
    __pyx_t_3 = __pyx_f_5chess_10__init__cp___pyx_unpickle_Board__set_state(((struct __pyx_obj_5chess_10__init__cp_Board *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0x3631f4f = (bishops, castling_rights, chess960, ep_square, fullmove_number, halfmove_clock, kings, knights, legal_moves, move_stack, occupied, occupied_co, pawns, promoted, pseudo_legal_moves, queens, rooks, stack, turn))" % __pyx_checksum)
 *     __pyx_result = Board.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  }

  /* "(tree fragment)":10
 *     if __pyx_state is not None:
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 *     return __pyx_result             # <<<<<<<<<<<<<<
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v___pyx_result);
  __pyx_r = __pyx_v___pyx_result;
  goto __pyx_L0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_Board(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_Board", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
  __Pyx_XDECREF(__pyx_v___pyx_result);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":11
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */

static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_Board__set_state(struct __pyx_obj_5chess_10__init__cp_Board *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  unsigned PY_LONG_LONG __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  unsigned PY_LONG_LONG __pyx_t_5[2];
  Py_ssize_t __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  __Pyx_RefNannySetupContext("__pyx_unpickle_Board__set_state", 0);

  /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.bishops = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.castling_rights = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.chess960 = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.ep_square);
  __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.ep_square);
  __pyx_v___pyx_result->__pyx_base.ep_square = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.fullmove_number = __pyx_t_4;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.halfmove_clock = __pyx_t_4;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 6, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.kings = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 7, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.knights = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5chess_10__init__cp_LegalMoveGenerator))))) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.legal_moves);
  __Pyx_DECREF(((PyObject *)__pyx_v___pyx_result->__pyx_base.legal_moves));
  __pyx_v___pyx_result->__pyx_base.legal_moves = ((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_t_1);
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 9, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.move_stack);
  __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.move_stack);
  __pyx_v___pyx_result->__pyx_base.move_stack = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.occupied = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 11, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(__Pyx_carray_from_py_unsigned_PY_LONG_LONG(__pyx_t_1, __pyx_t_5, 2) < 0)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  memcpy(&(__pyx_v___pyx_result->__pyx_base.occupied_co[0]), __pyx_t_5, sizeof(__pyx_v___pyx_result->__pyx_base.occupied_co[0]) * (2));
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 12, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.pawns = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 13, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.promoted = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 14, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5chess_10__init__cp_PseudoLegalMoveGenerator))))) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.pseudo_legal_moves);
  __Pyx_DECREF(((PyObject *)__pyx_v___pyx_result->__pyx_base.pseudo_legal_moves));
  __pyx_v___pyx_result->__pyx_base.pseudo_legal_moves = ((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_t_1);
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 15, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.queens = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 16, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_t_1); if (unlikely((__pyx_t_2 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.rooks = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 17, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->__pyx_base.stack);
  __Pyx_DECREF(__pyx_v___pyx_result->__pyx_base.stack);
  __pyx_v___pyx_result->__pyx_base.stack = __pyx_t_1;
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 18, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->__pyx_base.turn = __pyx_t_3;

  /* "(tree fragment)":13
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(1, 13, __pyx_L1_error)
  }
  __pyx_t_6 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_7 = ((__pyx_t_6 > 19) != 0);
  if (__pyx_t_7) {
  } else {
    __pyx_t_3 = __pyx_t_7;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_7 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_8 = (__pyx_t_7 != 0);
  __pyx_t_3 = __pyx_t_8;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_3) {

    /* "(tree fragment)":14
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[19])             # <<<<<<<<<<<<<<
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_update); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(__pyx_v___pyx_state == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(1, 14, __pyx_L1_error)
    }
    __pyx_t_9 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 19, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_11 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
      }
    }
    __pyx_t_1 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_11, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_9);
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "(tree fragment)":13
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  }

  /* "(tree fragment)":11
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_Board__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __pyx_unpickle_PseudoLegalMoveGenerator(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_76__pyx_unpickle_PseudoLegalMoveGenerator(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_76__pyx_unpickle_PseudoLegalMoveGenerator = {"__pyx_unpickle_PseudoLegalMoveGenerator", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_76__pyx_unpickle_PseudoLegalMoveGenerator, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_76__pyx_unpickle_PseudoLegalMoveGenerator(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v___pyx_type = 0;
  long __pyx_v___pyx_checksum;
  PyObject *__pyx_v___pyx_state = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__pyx_unpickle_PseudoLegalMoveGenerator (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_PseudoLegalMoveGenerator", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_PseudoLegalMoveGenerator", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_PseudoLegalMoveGenerator") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v___pyx_type = values[0];
    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
    __pyx_v___pyx_state = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_PseudoLegalMoveGenerator", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_PseudoLegalMoveGenerator", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_75__pyx_unpickle_PseudoLegalMoveGenerator(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_75__pyx_unpickle_PseudoLegalMoveGenerator(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_v___pyx_PickleError = 0;
  PyObject *__pyx_v___pyx_result = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__pyx_unpickle_PseudoLegalMoveGenerator", 0);

  /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xd41d8cd:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 */
  __pyx_t_1 = ((__pyx_v___pyx_checksum != 0xd41d8cd) != 0);
  if (__pyx_t_1) {

    /* "(tree fragment)":5
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xd41d8cd:
 *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = PseudoLegalMoveGenerator.__new__(__pyx_type)
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_n_s_PickleError);
    __Pyx_GIVEREF(__pyx_n_s_PickleError);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_PickleError);
    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_v___pyx_PickleError = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":6
 *     if __pyx_checksum != 0xd41d8cd:
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)             # <<<<<<<<<<<<<<
 *     __pyx_result = PseudoLegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:
 */
    __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_s_vs_0xd4, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v___pyx_PickleError);
    __pyx_t_2 = __pyx_v___pyx_PickleError; __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(1, 6, __pyx_L1_error)

    /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xd41d8cd:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 */
  }

  /* "(tree fragment)":7
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = PseudoLegalMoveGenerator.__new__(__pyx_type)             # <<<<<<<<<<<<<<
 *     if __pyx_state is not None:
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_PseudoLegalMoveGenerator), __pyx_n_s_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v___pyx_type);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v___pyx_result = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = PseudoLegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  __pyx_t_1 = (__pyx_v___pyx_state != Py_None);
  __pyx_t_6 = (__pyx_t_1 != 0);
  if (__pyx_t_6) {

    /* "(tree fragment)":9
 *     __pyx_result = PseudoLegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
 *     return __pyx_result
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):
 */
    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
    __pyx_t_3 = __pyx_f_5chess_10__init__cp___pyx_unpickle_PseudoLegalMoveGenerator__set_state(((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = PseudoLegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  }

  /* "(tree fragment)":10
 *     if __pyx_state is not None:
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result             # <<<<<<<<<<<<<<
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v___pyx_result);
  __pyx_r = __pyx_v___pyx_result;
  goto __pyx_L0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_PseudoLegalMoveGenerator(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_PseudoLegalMoveGenerator", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
  __Pyx_XDECREF(__pyx_v___pyx_result);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":11
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */

static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_PseudoLegalMoveGenerator__set_state(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  Py_ssize_t __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("__pyx_unpickle_PseudoLegalMoveGenerator__set_state", 0);

  /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_2 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(1, 12, __pyx_L1_error)
  __pyx_t_3 = ((__pyx_t_2 > 0) != 0);
  if (__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 12, __pyx_L1_error)
  __pyx_t_4 = (__pyx_t_3 != 0);
  __pyx_t_1 = __pyx_t_4;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "(tree fragment)":13
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[0])             # <<<<<<<<<<<<<<
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_update); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(__pyx_v___pyx_state == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(1, 13, __pyx_L1_error)
    }
    __pyx_t_6 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */
  }

  /* "(tree fragment)":11
 *         __pyx_unpickle_PseudoLegalMoveGenerator__set_state(<PseudoLegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_PseudoLegalMoveGenerator__set_state(PseudoLegalMoveGenerator __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_PseudoLegalMoveGenerator__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __pyx_unpickle_LegalMoveGenerator(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

/* Python wrapper */
static PyObject *__pyx_pw_5chess_10__init__cp_78__pyx_unpickle_LegalMoveGenerator(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_5chess_10__init__cp_78__pyx_unpickle_LegalMoveGenerator = {"__pyx_unpickle_LegalMoveGenerator", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_78__pyx_unpickle_LegalMoveGenerator, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_5chess_10__init__cp_78__pyx_unpickle_LegalMoveGenerator(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v___pyx_type = 0;
  long __pyx_v___pyx_checksum;
  PyObject *__pyx_v___pyx_state = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__pyx_unpickle_LegalMoveGenerator (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_LegalMoveGenerator", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_LegalMoveGenerator", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_LegalMoveGenerator") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v___pyx_type = values[0];
    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
    __pyx_v___pyx_state = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_LegalMoveGenerator", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_LegalMoveGenerator", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_5chess_10__init__cp_77__pyx_unpickle_LegalMoveGenerator(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_5chess_10__init__cp_77__pyx_unpickle_LegalMoveGenerator(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_v___pyx_PickleError = 0;
  PyObject *__pyx_v___pyx_result = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  __Pyx_RefNannySetupContext("__pyx_unpickle_LegalMoveGenerator", 0);

  /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xd41d8cd:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 */
  __pyx_t_1 = ((__pyx_v___pyx_checksum != 0xd41d8cd) != 0);
  if (__pyx_t_1) {

    /* "(tree fragment)":5
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xd41d8cd:
 *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = LegalMoveGenerator.__new__(__pyx_type)
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_n_s_PickleError);
    __Pyx_GIVEREF(__pyx_n_s_PickleError);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_PickleError);
    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_v___pyx_PickleError = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":6
 *     if __pyx_checksum != 0xd41d8cd:
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)             # <<<<<<<<<<<<<<
 *     __pyx_result = LegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:
 */
    __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_s_vs_0xd4, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v___pyx_PickleError);
    __pyx_t_2 = __pyx_v___pyx_PickleError; __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(1, 6, __pyx_L1_error)

    /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xd41d8cd:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 */
  }

  /* "(tree fragment)":7
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = LegalMoveGenerator.__new__(__pyx_type)             # <<<<<<<<<<<<<<
 *     if __pyx_state is not None:
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_5chess_10__init__cp_LegalMoveGenerator), __pyx_n_s_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v___pyx_type);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v___pyx_result = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = LegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  __pyx_t_1 = (__pyx_v___pyx_state != Py_None);
  __pyx_t_6 = (__pyx_t_1 != 0);
  if (__pyx_t_6) {

    /* "(tree fragment)":9
 *     __pyx_result = LegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
 *     return __pyx_result
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):
 */
    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
    __pyx_t_3 = __pyx_f_5chess_10__init__cp___pyx_unpickle_LegalMoveGenerator__set_state(((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xd41d8cd = ())" % __pyx_checksum)
 *     __pyx_result = LegalMoveGenerator.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  }

  /* "(tree fragment)":10
 *     if __pyx_state is not None:
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result             # <<<<<<<<<<<<<<
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v___pyx_result);
  __pyx_r = __pyx_v___pyx_result;
  goto __pyx_L0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_LegalMoveGenerator(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_LegalMoveGenerator", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
  __Pyx_XDECREF(__pyx_v___pyx_result);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":11
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */

static PyObject *__pyx_f_5chess_10__init__cp___pyx_unpickle_LegalMoveGenerator__set_state(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  Py_ssize_t __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("__pyx_unpickle_LegalMoveGenerator__set_state", 0);

  /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_2 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(1, 12, __pyx_L1_error)
  __pyx_t_3 = ((__pyx_t_2 > 0) != 0);
  if (__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 12, __pyx_L1_error)
  __pyx_t_4 = (__pyx_t_3 != 0);
  __pyx_t_1 = __pyx_t_4;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {

    /* "(tree fragment)":13
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[0])             # <<<<<<<<<<<<<<
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_update); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(__pyx_v___pyx_state == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(1, 13, __pyx_L1_error)
    }
    __pyx_t_6 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */
  }

  /* "(tree fragment)":11
 *         __pyx_unpickle_LegalMoveGenerator__set_state(<LegalMoveGenerator> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_LegalMoveGenerator__set_state(LegalMoveGenerator __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[0])
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("chess.__init__cp.__pyx_unpickle_LegalMoveGenerator__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "carray.to_py":112
 * 
 * @cname("__Pyx_carray_to_py_unsigned_PY_LONG_LONG")
 * cdef inline list __Pyx_carray_to_py_unsigned_PY_LONG_LONG(base_type *v, Py_ssize_t length):             # <<<<<<<<<<<<<<
 *     cdef size_t i
 *     cdef object value
 */

static CYTHON_INLINE PyObject *__Pyx_carray_to_py_unsigned_PY_LONG_LONG(unsigned PY_LONG_LONG *__pyx_v_v, Py_ssize_t __pyx_v_length) {
  size_t __pyx_v_i;
  PyObject *__pyx_v_value = 0;
  PyObject *__pyx_v_l = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  size_t __pyx_t_2;
  size_t __pyx_t_3;
  size_t __pyx_t_4;
  __Pyx_RefNannySetupContext("__Pyx_carray_to_py_unsigned_PY_LONG_LONG", 0);

  /* "carray.to_py":115
 *     cdef size_t i
 *     cdef object value
 *     l = PyList_New(length)             # <<<<<<<<<<<<<<
 *     for i in range(<size_t>length):
 *         value = v[i]
 */
  __pyx_t_1 = PyList_New(__pyx_v_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 115, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_l = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "carray.to_py":116
 *     cdef object value
 *     l = PyList_New(length)
 *     for i in range(<size_t>length):             # <<<<<<<<<<<<<<
 *         value = v[i]
 *         Py_INCREF(value)
 */
  __pyx_t_2 = ((size_t)__pyx_v_length);
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;

    /* "carray.to_py":117
 *     l = PyList_New(length)
 *     for i in range(<size_t>length):
 *         value = v[i]             # <<<<<<<<<<<<<<
 *         Py_INCREF(value)
 *         PyList_SET_ITEM(l, i, value)
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_v[__pyx_v_i])); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 117, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_value, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "carray.to_py":118
 *     for i in range(<size_t>length):
 *         value = v[i]
 *         Py_INCREF(value)             # <<<<<<<<<<<<<<
 *         PyList_SET_ITEM(l, i, value)
 *     return l
 */
    Py_INCREF(__pyx_v_value);

    /* "carray.to_py":119
 *         value = v[i]
 *         Py_INCREF(value)
 *         PyList_SET_ITEM(l, i, value)             # <<<<<<<<<<<<<<
 *     return l
 * 
 */
    PyList_SET_ITEM(__pyx_v_l, __pyx_v_i, __pyx_v_value);
  }

  /* "carray.to_py":120
 *         Py_INCREF(value)
 *         PyList_SET_ITEM(l, i, value)
 *     return l             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_l);
  __pyx_r = __pyx_v_l;
  goto __pyx_L0;

  /* "carray.to_py":112
 * 
 * @cname("__Pyx_carray_to_py_unsigned_PY_LONG_LONG")
 * cdef inline list __Pyx_carray_to_py_unsigned_PY_LONG_LONG(base_type *v, Py_ssize_t length):             # <<<<<<<<<<<<<<
 *     cdef size_t i
 *     cdef object value
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("carray.to_py.__Pyx_carray_to_py_unsigned_PY_LONG_LONG", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_value);
  __Pyx_XDECREF(__pyx_v_l);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "carray.to_py":124
 * 
 * @cname("__Pyx_carray_to_tuple_unsigned_PY_LONG_LONG")
 * cdef inline tuple __Pyx_carray_to_tuple_unsigned_PY_LONG_LONG(base_type *v, Py_ssize_t length):             # <<<<<<<<<<<<<<
 *     cdef size_t i
 *     cdef object value
 */

static CYTHON_INLINE PyObject *__Pyx_carray_to_tuple_unsigned_PY_LONG_LONG(unsigned PY_LONG_LONG *__pyx_v_v, Py_ssize_t __pyx_v_length) {
  size_t __pyx_v_i;
  PyObject *__pyx_v_value = 0;
  PyObject *__pyx_v_t = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  size_t __pyx_t_2;
  size_t __pyx_t_3;
  size_t __pyx_t_4;
  __Pyx_RefNannySetupContext("__Pyx_carray_to_tuple_unsigned_PY_LONG_LONG", 0);

  /* "carray.to_py":127
 *     cdef size_t i
 *     cdef object value
 *     t = PyTuple_New(length)             # <<<<<<<<<<<<<<
 *     for i in range(<size_t>length):
 *         value = v[i]
 */
  __pyx_t_1 = PyTuple_New(__pyx_v_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 127, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_t = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "carray.to_py":128
 *     cdef object value
 *     t = PyTuple_New(length)
 *     for i in range(<size_t>length):             # <<<<<<<<<<<<<<
 *         value = v[i]
 *         Py_INCREF(value)
 */
  __pyx_t_2 = ((size_t)__pyx_v_length);
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;

    /* "carray.to_py":129
 *     t = PyTuple_New(length)
 *     for i in range(<size_t>length):
 *         value = v[i]             # <<<<<<<<<<<<<<
 *         Py_INCREF(value)
 *         PyTuple_SET_ITEM(t, i, value)
 */
    __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG((__pyx_v_v[__pyx_v_i])); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 129, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_value, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "carray.to_py":130
 *     for i in range(<size_t>length):
 *         value = v[i]
 *         Py_INCREF(value)             # <<<<<<<<<<<<<<
 *         PyTuple_SET_ITEM(t, i, value)
 *     return t
 */
    Py_INCREF(__pyx_v_value);

    /* "carray.to_py":131
 *         value = v[i]
 *         Py_INCREF(value)
 *         PyTuple_SET_ITEM(t, i, value)             # <<<<<<<<<<<<<<
 *     return t
 */
    PyTuple_SET_ITEM(__pyx_v_t, __pyx_v_i, __pyx_v_value);
  }

  /* "carray.to_py":132
 *         Py_INCREF(value)
 *         PyTuple_SET_ITEM(t, i, value)
 *     return t             # <<<<<<<<<<<<<<
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_t);
  __pyx_r = __pyx_v_t;
  goto __pyx_L0;

  /* "carray.to_py":124
 * 
 * @cname("__Pyx_carray_to_tuple_unsigned_PY_LONG_LONG")
 * cdef inline tuple __Pyx_carray_to_tuple_unsigned_PY_LONG_LONG(base_type *v, Py_ssize_t length):             # <<<<<<<<<<<<<<
 *     cdef size_t i
 *     cdef object value
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("carray.to_py.__Pyx_carray_to_tuple_unsigned_PY_LONG_LONG", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_value);
  __Pyx_XDECREF(__pyx_v_t);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "carray.from_py":77
 * 
 * @cname("__Pyx_carray_from_py_unsigned_PY_LONG_LONG")
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:             # <<<<<<<<<<<<<<
 *     cdef Py_ssize_t i = length
 *     try:
 */

static int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(PyObject *__pyx_v_o, unsigned PY_LONG_LONG *__pyx_v_v, Py_ssize_t __pyx_v_length) {
  Py_ssize_t __pyx_v_i;
  PyObject *__pyx_v_item = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  PyObject *__pyx_t_10 = NULL;
  unsigned PY_LONG_LONG __pyx_t_11;
  char const *__pyx_t_12;
  __Pyx_RefNannySetupContext("__Pyx_carray_from_py_unsigned_PY_LONG_LONG", 0);

  /* "carray.from_py":78
 * @cname("__Pyx_carray_from_py_unsigned_PY_LONG_LONG")
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:
 *     cdef Py_ssize_t i = length             # <<<<<<<<<<<<<<
 *     try:
 *         i = len(o)
 */
  __pyx_v_i = __pyx_v_length;

  /* "carray.from_py":79
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:
 *     cdef Py_ssize_t i = length
 *     try:             # <<<<<<<<<<<<<<
 *         i = len(o)
 *     except (TypeError, OverflowError):
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "carray.from_py":80
 *     cdef Py_ssize_t i = length
 *     try:
 *         i = len(o)             # <<<<<<<<<<<<<<
 *     except (TypeError, OverflowError):
 *         pass
 */
      __pyx_t_4 = PyObject_Length(__pyx_v_o); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(1, 80, __pyx_L3_error)
      __pyx_v_i = __pyx_t_4;

      /* "carray.from_py":79
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:
 *     cdef Py_ssize_t i = length
 *     try:             # <<<<<<<<<<<<<<
 *         i = len(o)
 *     except (TypeError, OverflowError):
 */
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;

    /* "carray.from_py":81
 *     try:
 *         i = len(o)
 *     except (TypeError, OverflowError):             # <<<<<<<<<<<<<<
 *         pass
 *     if i == length:
 */
    __pyx_t_5 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError) || __Pyx_PyErr_ExceptionMatches(__pyx_builtin_OverflowError);
    if (__pyx_t_5) {
      __Pyx_ErrRestore(0,0,0);
      goto __pyx_L4_exception_handled;
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "carray.from_py":79
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:
 *     cdef Py_ssize_t i = length
 *     try:             # <<<<<<<<<<<<<<
 *         i = len(o)
 *     except (TypeError, OverflowError):
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    __pyx_L8_try_end:;
  }

  /* "carray.from_py":83
 *     except (TypeError, OverflowError):
 *         pass
 *     if i == length:             # <<<<<<<<<<<<<<
 *         for i, item in enumerate(o):
 *             if i >= length:
 */
  __pyx_t_6 = ((__pyx_v_i == __pyx_v_length) != 0);
  if (__pyx_t_6) {

    /* "carray.from_py":84
 *         pass
 *     if i == length:
 *         for i, item in enumerate(o):             # <<<<<<<<<<<<<<
 *             if i >= length:
 *                 break
 */
    __pyx_t_4 = 0;
    if (likely(PyList_CheckExact(__pyx_v_o)) || PyTuple_CheckExact(__pyx_v_o)) {
      __pyx_t_7 = __pyx_v_o; __Pyx_INCREF(__pyx_t_7); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_v_o); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 84, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_9 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 84, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_7))) {
          if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_7)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_10 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(1, 84, __pyx_L1_error)
          #else
          __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 84, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          #endif
        } else {
          if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(1, 84, __pyx_L1_error)
          #else
          __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 84, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          #endif
        }
      } else {
        __pyx_t_10 = __pyx_t_9(__pyx_t_7);
        if (unlikely(!__pyx_t_10)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(1, 84, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_10);
      }
      __Pyx_XDECREF_SET(__pyx_v_item, __pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_v_i = __pyx_t_4;
      __pyx_t_4 = (__pyx_t_4 + 1);

      /* "carray.from_py":85
 *     if i == length:
 *         for i, item in enumerate(o):
 *             if i >= length:             # <<<<<<<<<<<<<<
 *                 break
 *             v[i] = item
 */
      __pyx_t_6 = ((__pyx_v_i >= __pyx_v_length) != 0);
      if (__pyx_t_6) {

        /* "carray.from_py":86
 *         for i, item in enumerate(o):
 *             if i >= length:
 *                 break             # <<<<<<<<<<<<<<
 *             v[i] = item
 *         else:
 */
        goto __pyx_L11_break;

        /* "carray.from_py":85
 *     if i == length:
 *         for i, item in enumerate(o):
 *             if i >= length:             # <<<<<<<<<<<<<<
 *                 break
 *             v[i] = item
 */
      }

      /* "carray.from_py":87
 *             if i >= length:
 *                 break
 *             v[i] = item             # <<<<<<<<<<<<<<
 *         else:
 *             i += 1  # convert index to length
 */
      __pyx_t_11 = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(__pyx_v_item); if (unlikely((__pyx_t_11 == (unsigned PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(1, 87, __pyx_L1_error)
      (__pyx_v_v[__pyx_v_i]) = __pyx_t_11;

      /* "carray.from_py":84
 *         pass
 *     if i == length:
 *         for i, item in enumerate(o):             # <<<<<<<<<<<<<<
 *             if i >= length:
 *                 break
 */
    }
    /*else*/ {

      /* "carray.from_py":89
 *             v[i] = item
 *         else:
 *             i += 1  # convert index to length             # <<<<<<<<<<<<<<
 *             if i == length:
 *                 return 0
 */
      __pyx_v_i = (__pyx_v_i + 1);

      /* "carray.from_py":90
 *         else:
 *             i += 1  # convert index to length
 *             if i == length:             # <<<<<<<<<<<<<<
 *                 return 0
 * 
 */
      __pyx_t_6 = ((__pyx_v_i == __pyx_v_length) != 0);
      if (__pyx_t_6) {

        /* "carray.from_py":91
 *             i += 1  # convert index to length
 *             if i == length:
 *                 return 0             # <<<<<<<<<<<<<<
 * 
 *     PyErr_Format(
 */
        __pyx_r = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        goto __pyx_L0;

        /* "carray.from_py":90
 *         else:
 *             i += 1  # convert index to length
 *             if i == length:             # <<<<<<<<<<<<<<
 *                 return 0
 * 
 */
      }
    }

    /* "carray.from_py":84
 *         pass
 *     if i == length:
 *         for i, item in enumerate(o):             # <<<<<<<<<<<<<<
 *             if i >= length:
 *                 break
 */
    __pyx_L11_break:;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "carray.from_py":83
 *     except (TypeError, OverflowError):
 *         pass
 *     if i == length:             # <<<<<<<<<<<<<<
 *         for i, item in enumerate(o):
 *             if i >= length:
 */
  }

  /* "carray.from_py":96
 *         IndexError,
 *         ("too many values found during array assignment, expected %zd"
 *          if i >= length else             # <<<<<<<<<<<<<<
 *          "not enough values found during array assignment, expected %zd, got %zd"),
 *         length, i)
 */
  if (((__pyx_v_i >= __pyx_v_length) != 0)) {
    __pyx_t_12 = ((char const *)"too many values found during array assignment, expected %zd");
  } else {
    __pyx_t_12 = ((char const *)"not enough values found during array assignment, expected %zd, got %zd");
  }

  /* "carray.from_py":93
 *                 return 0
 * 
 *     PyErr_Format(             # <<<<<<<<<<<<<<
 *         IndexError,
 *         ("too many values found during array assignment, expected %zd"
 */
  __pyx_t_7 = PyErr_Format(__pyx_builtin_IndexError, __pyx_t_12, __pyx_v_length, __pyx_v_i); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 93, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "carray.from_py":77
 * 
 * @cname("__Pyx_carray_from_py_unsigned_PY_LONG_LONG")
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:             # <<<<<<<<<<<<<<
 *     cdef Py_ssize_t i = length
 *     try:
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("carray.from_py.__Pyx_carray_from_py_unsigned_PY_LONG_LONG", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_item);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_tp_new_5chess_10__init__cp_Move(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_5chess_10__init__cp_Move *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_5chess_10__init__cp_Move *)o);
  p->promotion = Py_None; Py_INCREF(Py_None);
  p->drop = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp_Move(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp_Move *p = (struct __pyx_obj_5chess_10__init__cp_Move *)o;
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->promotion);
  Py_CLEAR(p->drop);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_5chess_10__init__cp_Move(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp_Move *p = (struct __pyx_obj_5chess_10__init__cp_Move *)o;
  if (p->promotion) {
    e = (*v)(p->promotion, a); if (e) return e;
  }
  if (p->drop) {
    e = (*v)(p->drop, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp_Move(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp_Move *p = (struct __pyx_obj_5chess_10__init__cp_Move *)o;
  tmp = ((PyObject*)p->promotion);
  p->promotion = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->drop);
  p->drop = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_tp_richcompare_5chess_10__init__cp_Move(PyObject *o1, PyObject *o2, int op) {
  switch (op) {
    case Py_EQ: {
      return __pyx_pw_5chess_10__init__cp_4Move_7__eq__(o1, o2);
    }
    case Py_NE: {
      return __pyx_pw_5chess_10__init__cp_4Move_9__ne__(o1, o2);
    }
    default: {
      return __Pyx_NewRef(Py_NotImplemented);
    }
  }
}

static PyMethodDef __pyx_methods_5chess_10__init__cp_Move[] = {
  {"uci", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_3uci, METH_NOARGS, __pyx_doc_5chess_10__init__cp_4Move_2uci},
  {"__copy__", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_17__copy__, METH_NOARGS, 0},
  {"__deepcopy__", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_19__deepcopy__, METH_O, 0},
  {"from_uci", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_21from_uci, METH_O, __pyx_doc_5chess_10__init__cp_4Move_20from_uci},
  {"null", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_23null, METH_NOARGS, __pyx_doc_5chess_10__init__cp_4Move_22null},
  {"__reduce_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_25__reduce_cython__, METH_NOARGS, 0},
  {"__setstate_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_4Move_27__setstate_cython__, METH_O, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_Move = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  __pyx_pw_5chess_10__init__cp_4Move_5__bool__, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  0, /*nb_index*/
  #if PY_VERSION_HEX >= 0x03050000
  0, /*nb_matrix_multiply*/
  #endif
  #if PY_VERSION_HEX >= 0x03050000
  0, /*nb_inplace_matrix_multiply*/
  #endif
};

static PyTypeObject __pyx_type_5chess_10__init__cp_Move = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.Move", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp_Move), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp_Move, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_5chess_10__init__cp_4Move_11__repr__, /*tp_repr*/
  &__pyx_tp_as_number_Move, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  __pyx_pw_5chess_10__init__cp_4Move_15__hash__, /*tp_hash*/
  0, /*tp_call*/
  __pyx_pw_5chess_10__init__cp_4Move_13__str__, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "\n    Represents a move from a square to a square and possibly the promotion\n    piece type.\n\n    Drops and null moves are supported.\n    ", /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp_Move, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp_Move, /*tp_clear*/
  __pyx_tp_richcompare_5chess_10__init__cp_Move, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_5chess_10__init__cp_Move, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_5chess_10__init__cp_4Move_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp_Move, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_5chess_10__init__cp_BaseBoard(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_5chess_10__init__cp_BaseBoard *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_5chess_10__init__cp_BaseBoard *)o);
  p->pseudo_legal_moves = ((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)Py_None); Py_INCREF(Py_None);
  p->legal_moves = ((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)Py_None); Py_INCREF(Py_None);
  p->move_stack = Py_None; Py_INCREF(Py_None);
  p->stack = Py_None; Py_INCREF(Py_None);
  p->ep_square = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp_BaseBoard(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp_BaseBoard *p = (struct __pyx_obj_5chess_10__init__cp_BaseBoard *)o;
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->pseudo_legal_moves);
  Py_CLEAR(p->legal_moves);
  Py_CLEAR(p->move_stack);
  Py_CLEAR(p->stack);
  Py_CLEAR(p->ep_square);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_5chess_10__init__cp_BaseBoard(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp_BaseBoard *p = (struct __pyx_obj_5chess_10__init__cp_BaseBoard *)o;
  if (p->pseudo_legal_moves) {
    e = (*v)(((PyObject *)p->pseudo_legal_moves), a); if (e) return e;
  }
  if (p->legal_moves) {
    e = (*v)(((PyObject *)p->legal_moves), a); if (e) return e;
  }
  if (p->move_stack) {
    e = (*v)(p->move_stack, a); if (e) return e;
  }
  if (p->stack) {
    e = (*v)(p->stack, a); if (e) return e;
  }
  if (p->ep_square) {
    e = (*v)(p->ep_square, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp_BaseBoard(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp_BaseBoard *p = (struct __pyx_obj_5chess_10__init__cp_BaseBoard *)o;
  tmp = ((PyObject*)p->pseudo_legal_moves);
  p->pseudo_legal_moves = ((struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->legal_moves);
  p->legal_moves = ((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->move_stack);
  p->move_stack = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->stack);
  p->stack = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->ep_square);
  p->ep_square = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_tp_richcompare_5chess_10__init__cp_BaseBoard(PyObject *o1, PyObject *o2, int op) {
  switch (op) {
    case Py_EQ: {
      return __pyx_pw_5chess_10__init__cp_9BaseBoard_73__eq__(o1, o2);
    }
    case Py_NE: {
      return __pyx_pw_5chess_10__init__cp_9BaseBoard_75__ne__(o1, o2);
    }
    default: {
      return __Pyx_NewRef(Py_NotImplemented);
    }
  }
}

static PyMethodDef __pyx_methods_5chess_10__init__cp_BaseBoard[] = {
  {"_reset_board", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_3_reset_board, METH_NOARGS, 0},
  {"reset_board", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_5reset_board, METH_NOARGS, 0},
  {"_clear_board", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_7_clear_board, METH_NOARGS, 0},
  {"clear_board", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_9clear_board, METH_NOARGS, __pyx_doc_5chess_10__init__cp_9BaseBoard_8clear_board},
  {"pieces_mask", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_11pieces_mask, METH_VARARGS|METH_KEYWORDS, 0},
  {"pieces", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_13pieces, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_12pieces},
  {"piece_at", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_15piece_at, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_14piece_at},
  {"piece_type_at", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_17piece_type_at, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_16piece_type_at},
  {"king", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_19king, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_18king},
  {"attacks_mask", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_21attacks_mask, METH_O, 0},
  {"attacks", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_23attacks, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_22attacks},
  {"_attackers_mask", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_25_attackers_mask, METH_VARARGS|METH_KEYWORDS, 0},
  {"attackers_mask", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_27attackers_mask, METH_VARARGS|METH_KEYWORDS, 0},
  {"is_attacked_by", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_29is_attacked_by, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_28is_attacked_by},
  {"attackers", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_31attackers, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_30attackers},
  {"pin_mask", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_33pin_mask, METH_VARARGS|METH_KEYWORDS, 0},
  {"pin", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_35pin, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_34pin},
  {"is_pinned", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_37is_pinned, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_36is_pinned},
  {"_remove_piece_at", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_39_remove_piece_at, METH_O, 0},
  {"remove_piece_at", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_41remove_piece_at, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_40remove_piece_at},
  {"_set_piece_at", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_43_set_piece_at, METH_VARARGS|METH_KEYWORDS, 0},
  {"set_piece_at", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_45set_piece_at, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_44set_piece_at},
  {"board_fen", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_47board_fen, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_46board_fen},
  {"_set_board_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_49_set_board_fen, METH_O, 0},
  {"set_board_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_51set_board_fen, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_50set_board_fen},
  {"piece_map", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_53piece_map, METH_NOARGS, __pyx_doc_5chess_10__init__cp_9BaseBoard_52piece_map},
  {"_set_piece_map", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_55_set_piece_map, METH_O, 0},
  {"set_piece_map", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_57set_piece_map, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_56set_piece_map},
  {"_set_chess960_pos", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_59_set_chess960_pos, METH_O, 0},
  {"set_chess960_pos", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_61set_chess960_pos, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_60set_chess960_pos},
  {"chess960_pos", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_63chess960_pos, METH_NOARGS, __pyx_doc_5chess_10__init__cp_9BaseBoard_62chess960_pos},
  {"unicode", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_9BaseBoard_69unicode, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_9BaseBoard_68unicode},
  {"_repr_svg_", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_71_repr_svg_, METH_NOARGS, 0},
  {"apply_transform", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_77apply_transform, METH_O, 0},
  {"transform", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_79transform, METH_O, 0},
  {"mirror", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_81mirror, METH_NOARGS, __pyx_doc_5chess_10__init__cp_9BaseBoard_80mirror},
  {"copy", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_83copy, METH_NOARGS, __pyx_doc_5chess_10__init__cp_9BaseBoard_82copy},
  {"__copy__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_85__copy__, METH_NOARGS, 0},
  {"__deepcopy__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_87__deepcopy__, METH_O, 0},
  {"empty", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_89empty, METH_NOARGS, __pyx_doc_5chess_10__init__cp_9BaseBoard_88empty},
  {"from_chess960_pos", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_91from_chess960_pos, METH_O, __pyx_doc_5chess_10__init__cp_9BaseBoard_90from_chess960_pos},
  {"__reduce_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_93__reduce_cython__, METH_NOARGS, 0},
  {"__setstate_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_9BaseBoard_95__setstate_cython__, METH_O, 0},
  {0, 0, 0, 0}
};

static PyTypeObject __pyx_type_5chess_10__init__cp_BaseBoard = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.BaseBoard", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp_BaseBoard), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp_BaseBoard, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_5chess_10__init__cp_9BaseBoard_65__repr__, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  __pyx_pw_5chess_10__init__cp_9BaseBoard_67__str__, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "\n    A board representing the position of chess pieces. See\n    :class:`~chess.Board` for a full board with move generation.\n\n    The board is initialized with the standard chess starting position, unless\n    otherwise specified in the optional *board_fen* argument. If *board_fen*\n    is ``None``, an empty board is created.\n    ", /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp_BaseBoard, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp_BaseBoard, /*tp_clear*/
  __pyx_tp_richcompare_5chess_10__init__cp_BaseBoard, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_5chess_10__init__cp_BaseBoard, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_5chess_10__init__cp_9BaseBoard_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp_BaseBoard, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_5chess_10__init__cp_Board(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = __pyx_tp_new_5chess_10__init__cp_BaseBoard(t, a, k);
  if (unlikely(!o)) return 0;
  return o;
}

static PyObject *__pyx_tp_richcompare_5chess_10__init__cp_Board(PyObject *o1, PyObject *o2, int op) {
  switch (op) {
    case Py_EQ: {
      return __pyx_pw_5chess_10__init__cp_9BaseBoard_73__eq__(o1, o2);
    }
    case Py_NE: {
      return __pyx_pw_5chess_10__init__cp_5Board_189__ne__(o1, o2);
    }
    default: {
      return __Pyx_NewRef(Py_NotImplemented);
    }
  }
}

static PyMethodDef __pyx_methods_5chess_10__init__cp_Board[] = {
  {"reset", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_3reset, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_2reset},
  {"reset_board", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_5reset_board, METH_NOARGS, 0},
  {"clear", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_7clear, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_6clear},
  {"clear_board", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_9clear_board, METH_NOARGS, 0},
  {"clear_stack", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_11clear_stack, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_10clear_stack},
  {"root", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_13root, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_12root},
  {"remove_piece_at", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_15remove_piece_at, METH_O, 0},
  {"set_piece_at", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_17set_piece_at, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_pseudo_legal_moves", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_19generate_pseudo_legal_moves, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_pseudo_legal_ep", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_22generate_pseudo_legal_ep, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_pseudo_legal_captures", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_25generate_pseudo_legal_captures, METH_VARARGS|METH_KEYWORDS, 0},
  {"is_check", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_27is_check, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_26is_check},
  {"is_into_check", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_29is_into_check, METH_O, __pyx_doc_5chess_10__init__cp_5Board_28is_into_check},
  {"was_into_check", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_31was_into_check, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_30was_into_check},
  {"is_pseudo_legal", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_33is_pseudo_legal, METH_O, 0},
  {"is_legal", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_35is_legal, METH_O, 0},
  {"is_variant_end", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_37is_variant_end, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_36is_variant_end},
  {"is_variant_loss", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_39is_variant_loss, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_38is_variant_loss},
  {"is_variant_win", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_41is_variant_win, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_40is_variant_win},
  {"is_variant_draw", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_43is_variant_draw, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_42is_variant_draw},
  {"is_game_over", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_45is_game_over, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_44is_game_over},
  {"result", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_47result, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_46result},
  {"is_checkmate", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_49is_checkmate, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_48is_checkmate},
  {"is_stalemate", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_51is_stalemate, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_50is_stalemate},
  {"is_insufficient_material", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_53is_insufficient_material, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_52is_insufficient_material},
  {"is_seventyfive_moves", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_55is_seventyfive_moves, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_54is_seventyfive_moves},
  {"is_fivefold_repetition", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_57is_fivefold_repetition, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_56is_fivefold_repetition},
  {"can_claim_draw", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_59can_claim_draw, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_58can_claim_draw},
  {"can_claim_fifty_moves", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_61can_claim_fifty_moves, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_60can_claim_fifty_moves},
  {"can_claim_threefold_repetition", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_63can_claim_threefold_repetition, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_62can_claim_threefold_repetition},
  {"_push_capture", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_65_push_capture, METH_VARARGS|METH_KEYWORDS, 0},
  {"push", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_67push, METH_O, __pyx_doc_5chess_10__init__cp_5Board_66push},
  {"pop", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_69pop, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_68pop},
  {"peek", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_71peek, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_70peek},
  {"castling_shredder_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_73castling_shredder_fen, METH_NOARGS, 0},
  {"castling_xfen", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_75castling_xfen, METH_NOARGS, 0},
  {"has_pseudo_legal_en_passant", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_77has_pseudo_legal_en_passant, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_76has_pseudo_legal_en_passant},
  {"has_legal_en_passant", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_79has_legal_en_passant, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_78has_legal_en_passant},
  {"fen", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_81fen, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_80fen},
  {"shredder_fen", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_83shredder_fen, METH_VARARGS|METH_KEYWORDS, 0},
  {"set_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_85set_fen, METH_O, __pyx_doc_5chess_10__init__cp_5Board_84set_fen},
  {"_set_castling_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_87_set_castling_fen, METH_O, 0},
  {"set_castling_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_89set_castling_fen, METH_O, __pyx_doc_5chess_10__init__cp_5Board_88set_castling_fen},
  {"set_board_fen", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_91set_board_fen, METH_O, 0},
  {"set_piece_map", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_93set_piece_map, METH_O, 0},
  {"set_chess960_pos", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_95set_chess960_pos, METH_O, 0},
  {"chess960_pos", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_97chess960_pos, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_96chess960_pos},
  {"_epd_operations", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_99_epd_operations, METH_O, 0},
  {"epd", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_101epd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_100epd},
  {"_parse_epd_ops", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_103_parse_epd_ops, METH_VARARGS|METH_KEYWORDS, 0},
  {"set_epd", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_105set_epd, METH_O, __pyx_doc_5chess_10__init__cp_5Board_104set_epd},
  {"san", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_107san, METH_O, __pyx_doc_5chess_10__init__cp_5Board_106san},
  {"lan", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_109lan, METH_O, __pyx_doc_5chess_10__init__cp_5Board_108lan},
  {"_algebraic", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_111_algebraic, METH_VARARGS|METH_KEYWORDS, 0},
  {"variation_san", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_113variation_san, METH_O, __pyx_doc_5chess_10__init__cp_5Board_112variation_san},
  {"parse_san", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_115parse_san, METH_O, __pyx_doc_5chess_10__init__cp_5Board_114parse_san},
  {"push_san", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_117push_san, METH_O, __pyx_doc_5chess_10__init__cp_5Board_116push_san},
  {"uci", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_119uci, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_118uci},
  {"parse_uci", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_121parse_uci, METH_O, __pyx_doc_5chess_10__init__cp_5Board_120parse_uci},
  {"push_uci", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_123push_uci, METH_O, __pyx_doc_5chess_10__init__cp_5Board_122push_uci},
  {"is_en_passant", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_125is_en_passant, METH_O, __pyx_doc_5chess_10__init__cp_5Board_124is_en_passant},
  {"is_capture", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_127is_capture, METH_O, __pyx_doc_5chess_10__init__cp_5Board_126is_capture},
  {"is_zeroing", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_129is_zeroing, METH_O, __pyx_doc_5chess_10__init__cp_5Board_128is_zeroing},
  {"is_irreversible", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_131is_irreversible, METH_O, __pyx_doc_5chess_10__init__cp_5Board_130is_irreversible},
  {"is_castling", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_133is_castling, METH_O, __pyx_doc_5chess_10__init__cp_5Board_132is_castling},
  {"is_kingside_castling", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_135is_kingside_castling, METH_O, __pyx_doc_5chess_10__init__cp_5Board_134is_kingside_castling},
  {"is_queenside_castling", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_137is_queenside_castling, METH_O, __pyx_doc_5chess_10__init__cp_5Board_136is_queenside_castling},
  {"clean_castling_rights", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_139clean_castling_rights, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_138clean_castling_rights},
  {"has_castling_rights", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_141has_castling_rights, METH_O, __pyx_doc_5chess_10__init__cp_5Board_140has_castling_rights},
  {"has_kingside_castling_rights", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_143has_kingside_castling_rights, METH_O, __pyx_doc_5chess_10__init__cp_5Board_142has_kingside_castling_rights},
  {"has_queenside_castling_rights", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_145has_queenside_castling_rights, METH_O, __pyx_doc_5chess_10__init__cp_5Board_144has_queenside_castling_rights},
  {"has_chess960_castling_rights", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_147has_chess960_castling_rights, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_146has_chess960_castling_rights},
  {"status", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_149status, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_148status},
  {"_valid_ep_square", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_151_valid_ep_square, METH_NOARGS, 0},
  {"is_valid", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_153is_valid, METH_NOARGS, __pyx_doc_5chess_10__init__cp_5Board_152is_valid},
  {"_ep_skewered", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_155_ep_skewered, METH_VARARGS|METH_KEYWORDS, 0},
  {"_slider_blockers", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_157_slider_blockers, METH_O, 0},
  {"_is_safe", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_159_is_safe, METH_VARARGS|METH_KEYWORDS, 0},
  {"_generate_evasions", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_161_generate_evasions, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_legal_moves", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_164generate_legal_moves, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_legal_ep", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_167generate_legal_ep, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_legal_captures", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_170generate_legal_captures, METH_VARARGS|METH_KEYWORDS, 0},
  {"_attacked_for_king", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_172_attacked_for_king, METH_VARARGS|METH_KEYWORDS, 0},
  {"_castling_uncovers_rank_attack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_174_castling_uncovers_rank_attack, METH_VARARGS|METH_KEYWORDS, 0},
  {"generate_castling_moves", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_176generate_castling_moves, METH_VARARGS|METH_KEYWORDS, 0},
  {"_from_chess960", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_179_from_chess960, METH_VARARGS|METH_KEYWORDS, 0},
  {"_to_chess960", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_181_to_chess960, METH_O, 0},
  {"_transposition_key", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_183_transposition_key, METH_NOARGS, 0},
  {"_repr_svg_", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_187_repr_svg_, METH_NOARGS, 0},
  {"apply_transform", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_191apply_transform, METH_O, 0},
  {"transform", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_193transform, METH_O, 0},
  {"mirror", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_195mirror, METH_NOARGS, 0},
  {"copy", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_197copy, METH_VARARGS|METH_KEYWORDS, 0},
  {"empty", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_199empty, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_198empty},
  {"from_epd", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_5chess_10__init__cp_5Board_201from_epd, METH_VARARGS|METH_KEYWORDS, __pyx_doc_5chess_10__init__cp_5Board_200from_epd},
  {"from_chess960_pos", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_203from_chess960_pos, METH_O, 0},
  {"__reduce_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_205__reduce_cython__, METH_NOARGS, 0},
  {"__setstate_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_5Board_207__setstate_cython__, METH_O, 0},
  {0, 0, 0, 0}
};

static PyTypeObject __pyx_type_5chess_10__init__cp_Board = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.Board", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp_Board), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp_BaseBoard, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_5chess_10__init__cp_5Board_185__repr__, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  #if CYTHON_COMPILING_IN_PYPY
  __pyx_pw_5chess_10__init__cp_9BaseBoard_67__str__, /*tp_str*/
  #else
  0, /*tp_str*/
  #endif
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  "\n    A :class:`~chess.BaseBoard` and additional information representing\n    a chess position.\n\n    Provides move generation, validation, parsing, attack generation,\n    game end detection, move counters and the capability to make and unmake\n    moves.\n\n    The board is initialized to the standard chess starting position,\n    unless otherwise specified in the optional *fen* argument.\n    If *fen* is ``None``, an empty board is created.\n\n    Optionally supports *chess960*. In Chess960 castling moves are encoded\n    by a king move to the corresponding rook square.\n    Use :func:`chess.Board.from_chess960_pos()` to create a board with one\n    of the Chess960 starting positions.\n\n    It's safe to set :data:`~Board.turn`, :data:`~Board.castling_rights`,\n    :data:`~Board.ep_square`, :data:`~Board.halfmove_clock` and\n    :data:`~Board.fullmove_number` directly.\n    ", /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp_BaseBoard, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp_BaseBoard, /*tp_clear*/
  __pyx_tp_richcompare_5chess_10__init__cp_Board, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_5chess_10__init__cp_Board, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_5chess_10__init__cp_5Board_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp_Board, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_5chess_10__init__cp_PseudoLegalMoveGenerator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp_PseudoLegalMoveGenerator(PyObject *o) {
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  (*Py_TYPE(o)->tp_free)(o);
}

static PyMethodDef __pyx_methods_5chess_10__init__cp_PseudoLegalMoveGenerator[] = {
  {"count", (PyCFunction)__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_5count, METH_NOARGS, 0},
  {"__reduce_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_13__reduce_cython__, METH_NOARGS, 0},
  {"__setstate_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_15__setstate_cython__, METH_O, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_PseudoLegalMoveGenerator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_3__bool__, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  0, /*nb_index*/
  #if PY_VERSION_HEX >= 0x03050000
  0, /*nb_matrix_multiply*/
  #endif
  #if PY_VERSION_HEX >= 0x03050000
  0, /*nb_inplace_matrix_multiply*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_PseudoLegalMoveGenerator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_9__contains__, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyTypeObject __pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.PseudoLegalMoveGenerator", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp_PseudoLegalMoveGenerator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp_PseudoLegalMoveGenerator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_11__repr__, /*tp_repr*/
  &__pyx_tp_as_number_PseudoLegalMoveGenerator, /*tp_as_number*/
  &__pyx_tp_as_sequence_PseudoLegalMoveGenerator, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_7__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_5chess_10__init__cp_PseudoLegalMoveGenerator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_5chess_10__init__cp_24PseudoLegalMoveGenerator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp_PseudoLegalMoveGenerator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_5chess_10__init__cp_LegalMoveGenerator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp_LegalMoveGenerator(PyObject *o) {
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  (*Py_TYPE(o)->tp_free)(o);
}

static PyMethodDef __pyx_methods_5chess_10__init__cp_LegalMoveGenerator[] = {
  {"count", (PyCFunction)__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_5count, METH_NOARGS, 0},
  {"__reduce_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_13__reduce_cython__, METH_NOARGS, 0},
  {"__setstate_cython__", (PyCFunction)__pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_15__setstate_cython__, METH_O, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_LegalMoveGenerator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_3__bool__, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  0, /*nb_index*/
  #if PY_VERSION_HEX >= 0x03050000
  0, /*nb_matrix_multiply*/
  #endif
  #if PY_VERSION_HEX >= 0x03050000
  0, /*nb_inplace_matrix_multiply*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_LegalMoveGenerator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_9__contains__, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyTypeObject __pyx_type_5chess_10__init__cp_LegalMoveGenerator = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.LegalMoveGenerator", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp_LegalMoveGenerator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_11__repr__, /*tp_repr*/
  &__pyx_tp_as_number_LegalMoveGenerator, /*tp_as_number*/
  &__pyx_tp_as_sequence_LegalMoveGenerator, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_7__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_5chess_10__init__cp_LegalMoveGenerator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_5chess_10__init__cp_18LegalMoveGenerator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp_LegalMoveGenerator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct__scan_forward[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct__scan_forward = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct__scan_forward(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct__scan_forward > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct__scan_forward[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct__scan_forward];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct__scan_forward(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_bb);
  Py_CLEAR(p->__pyx_v_r);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct__scan_forward < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct__scan_forward[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct__scan_forward++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct__scan_forward(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward *)o;
  if (p->__pyx_v_bb) {
    e = (*v)(p->__pyx_v_bb, a); if (e) return e;
  }
  if (p->__pyx_v_r) {
    e = (*v)(p->__pyx_v_r, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct__scan_forward", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct__scan_forward), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct__scan_forward, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct__scan_forward, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct__scan_forward, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v__BB_SQUARES);
  Py_CLEAR(p->__pyx_v_bb);
  Py_CLEAR(p->__pyx_v_r);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed *)o;
  if (p->__pyx_v__BB_SQUARES) {
    e = (*v)(p->__pyx_v__BB_SQUARES, a); if (e) return e;
  }
  if (p->__pyx_v_bb) {
    e = (*v)(p->__pyx_v_bb, a); if (e) return e;
  }
  if (p->__pyx_v_r) {
    e = (*v)(p->__pyx_v_r, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_1_scan_reversed", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_mask);
  Py_CLEAR(p->__pyx_v_subset);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler *)o;
  if (p->__pyx_v_mask) {
    e = (*v)(p->__pyx_v_mask, a); if (e) return e;
  }
  if (p->__pyx_v_subset) {
    e = (*v)(p->__pyx_v_subset, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_2__carry_rippler", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_capturers);
  Py_CLEAR(p->__pyx_v_double_moves);
  Py_CLEAR(p->__pyx_v_from_mask);
  Py_CLEAR(p->__pyx_v_from_square);
  Py_CLEAR(p->__pyx_v_moves);
  Py_CLEAR(p->__pyx_v_non_pawns);
  Py_CLEAR(p->__pyx_v_pawns);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_v_single_moves);
  Py_CLEAR(p->__pyx_v_targets);
  Py_CLEAR(p->__pyx_v_to_mask);
  Py_CLEAR(p->__pyx_v_to_square);
  Py_CLEAR(p->__pyx_t_0);
  Py_CLEAR(p->__pyx_t_3);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves *)o;
  if (p->__pyx_v_capturers) {
    e = (*v)(p->__pyx_v_capturers, a); if (e) return e;
  }
  if (p->__pyx_v_double_moves) {
    e = (*v)(p->__pyx_v_double_moves, a); if (e) return e;
  }
  if (p->__pyx_v_from_mask) {
    e = (*v)(p->__pyx_v_from_mask, a); if (e) return e;
  }
  if (p->__pyx_v_from_square) {
    e = (*v)(p->__pyx_v_from_square, a); if (e) return e;
  }
  if (p->__pyx_v_moves) {
    e = (*v)(p->__pyx_v_moves, a); if (e) return e;
  }
  if (p->__pyx_v_non_pawns) {
    e = (*v)(p->__pyx_v_non_pawns, a); if (e) return e;
  }
  if (p->__pyx_v_pawns) {
    e = (*v)(p->__pyx_v_pawns, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_v_single_moves) {
    e = (*v)(p->__pyx_v_single_moves, a); if (e) return e;
  }
  if (p->__pyx_v_targets) {
    e = (*v)(p->__pyx_v_targets, a); if (e) return e;
  }
  if (p->__pyx_v_to_mask) {
    e = (*v)(p->__pyx_v_to_mask, a); if (e) return e;
  }
  if (p->__pyx_v_to_square) {
    e = (*v)(p->__pyx_v_to_square, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  if (p->__pyx_t_3) {
    e = (*v)(p->__pyx_t_3, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_3_generate_pseudo_legal_moves", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_capturer);
  Py_CLEAR(p->__pyx_v_capturers);
  Py_CLEAR(p->__pyx_v_from_mask);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_v_to_mask);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep *)o;
  if (p->__pyx_v_capturer) {
    e = (*v)(p->__pyx_v_capturer, a); if (e) return e;
  }
  if (p->__pyx_v_capturers) {
    e = (*v)(p->__pyx_v_capturers, a); if (e) return e;
  }
  if (p->__pyx_v_from_mask) {
    e = (*v)(p->__pyx_v_from_mask, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_v_to_mask) {
    e = (*v)(p->__pyx_v_to_mask, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_4_generate_pseudo_legal_ep", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_a_side);
  Py_CLEAR(p->__pyx_v_other_rooks);
  Py_CLEAR(p->__pyx_v_rook_file);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *)o;
  if (p->__pyx_v_a_side) {
    e = (*v)(p->__pyx_v_a_side, a); if (e) return e;
  }
  if (p->__pyx_v_other_rooks) {
    e = (*v)(p->__pyx_v_other_rooks, a); if (e) return e;
  }
  if (p->__pyx_v_rook_file) {
    e = (*v)(p->__pyx_v_rook_file, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen *)o;
  tmp = ((PyObject*)p->__pyx_v_a_side);
  p->__pyx_v_a_side = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_other_rooks);
  p->__pyx_v_other_rooks = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_rook_file);
  p->__pyx_v_rook_file = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_5_castling_xfen", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_6_genexpr[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_6_genexpr = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_6_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_6_genexpr > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_6_genexpr[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_6_genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_6_genexpr(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_outer_scope);
  Py_CLEAR(p->__pyx_v_other);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_6_genexpr < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_6_genexpr[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_6_genexpr++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_6_genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr *)o;
  if (p->__pyx_outer_scope) {
    e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
  }
  if (p->__pyx_v_other) {
    e = (*v)(p->__pyx_v_other, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_6_genexpr", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_6_genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_6_genexpr, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_6_genexpr, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_6_genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_7_set_epd[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_7_set_epd = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_7_set_epd(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_7_set_epd > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_7_set_epd[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_7_set_epd];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_7_set_epd(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_parts);
  Py_CLEAR(p->__pyx_v_self);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_7_set_epd < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_7_set_epd[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_7_set_epd++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_7_set_epd(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *)o;
  if (p->__pyx_v_parts) {
    e = (*v)(p->__pyx_v_parts, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_7_set_epd(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd *)o;
  tmp = ((PyObject*)p->__pyx_v_parts);
  p->__pyx_v_parts = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_5chess_10__init__cp_Board *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_7_set_epd", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_7_set_epd), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_7_set_epd, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_7_set_epd, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_7_set_epd, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_7_set_epd, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_8_parse_san[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_8_parse_san = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_8_parse_san(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_8_parse_san > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_8_parse_san[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_8_parse_san];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_8_parse_san(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_8_parse_san < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_8_parse_san[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_8_parse_san++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_8_parse_san(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_8_parse_san(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san *)o;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_5chess_10__init__cp_Board *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_8_parse_san", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_8_parse_san), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_8_parse_san, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_8_parse_san, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_8_parse_san, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_8_parse_san, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_9_genexpr[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_9_genexpr = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_9_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_9_genexpr > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_9_genexpr[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_9_genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_9_genexpr(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_outer_scope);
  Py_CLEAR(p->__pyx_v_move);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_9_genexpr < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_9_genexpr[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_9_genexpr++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_9_genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr *)o;
  if (p->__pyx_outer_scope) {
    e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
  }
  if (p->__pyx_v_move) {
    e = (*v)(p->__pyx_v_move, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_9_genexpr", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_9_genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_9_genexpr, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_9_genexpr, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_9_genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_10_genexpr[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_10_genexpr = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_10_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_10_genexpr > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_10_genexpr[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_10_genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_10_genexpr(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_outer_scope);
  Py_CLEAR(p->__pyx_v_move);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_10_genexpr < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_10_genexpr[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_10_genexpr++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_10_genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr *)o;
  if (p->__pyx_outer_scope) {
    e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
  }
  if (p->__pyx_v_move) {
    e = (*v)(p->__pyx_v_move, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_10_genexpr", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_10_genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_10_genexpr, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_10_genexpr, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_10_genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_attacked);
  Py_CLEAR(p->__pyx_v_checker);
  Py_CLEAR(p->__pyx_v_checkers);
  Py_CLEAR(p->__pyx_v_from_mask);
  Py_CLEAR(p->__pyx_v_king);
  Py_CLEAR(p->__pyx_v_last_double);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_v_sliders);
  Py_CLEAR(p->__pyx_v_target);
  Py_CLEAR(p->__pyx_v_to_mask);
  Py_CLEAR(p->__pyx_v_to_square);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions *)o;
  if (p->__pyx_v_attacked) {
    e = (*v)(p->__pyx_v_attacked, a); if (e) return e;
  }
  if (p->__pyx_v_checker) {
    e = (*v)(p->__pyx_v_checker, a); if (e) return e;
  }
  if (p->__pyx_v_checkers) {
    e = (*v)(p->__pyx_v_checkers, a); if (e) return e;
  }
  if (p->__pyx_v_from_mask) {
    e = (*v)(p->__pyx_v_from_mask, a); if (e) return e;
  }
  if (p->__pyx_v_king) {
    e = (*v)(p->__pyx_v_king, a); if (e) return e;
  }
  if (p->__pyx_v_last_double) {
    e = (*v)(p->__pyx_v_last_double, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_v_sliders) {
    e = (*v)(p->__pyx_v_sliders, a); if (e) return e;
  }
  if (p->__pyx_v_target) {
    e = (*v)(p->__pyx_v_target, a); if (e) return e;
  }
  if (p->__pyx_v_to_mask) {
    e = (*v)(p->__pyx_v_to_mask, a); if (e) return e;
  }
  if (p->__pyx_v_to_square) {
    e = (*v)(p->__pyx_v_to_square, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_11__generate_evasions", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_blockers);
  Py_CLEAR(p->__pyx_v_checkers);
  Py_CLEAR(p->__pyx_v_from_mask);
  Py_CLEAR(p->__pyx_v_king);
  Py_CLEAR(p->__pyx_v_move);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_v_to_mask);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves *)o;
  if (p->__pyx_v_blockers) {
    e = (*v)(p->__pyx_v_blockers, a); if (e) return e;
  }
  if (p->__pyx_v_checkers) {
    e = (*v)(p->__pyx_v_checkers, a); if (e) return e;
  }
  if (p->__pyx_v_from_mask) {
    e = (*v)(p->__pyx_v_from_mask, a); if (e) return e;
  }
  if (p->__pyx_v_king) {
    e = (*v)(p->__pyx_v_king, a); if (e) return e;
  }
  if (p->__pyx_v_move) {
    e = (*v)(p->__pyx_v_move, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_v_to_mask) {
    e = (*v)(p->__pyx_v_to_mask, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_12_generate_legal_moves", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_from_mask);
  Py_CLEAR(p->__pyx_v_move);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_v_to_mask);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep *)o;
  if (p->__pyx_v_from_mask) {
    e = (*v)(p->__pyx_v_from_mask, a); if (e) return e;
  }
  if (p->__pyx_v_move) {
    e = (*v)(p->__pyx_v_move, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_v_to_mask) {
    e = (*v)(p->__pyx_v_to_mask, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_13_generate_legal_ep", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_occupied);
  Py_CLEAR(p->__pyx_v_path);
  Py_CLEAR(p->__pyx_v_self);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *)o;
  if (p->__pyx_v_occupied) {
    e = (*v)(p->__pyx_v_occupied, a); if (e) return e;
  }
  if (p->__pyx_v_path) {
    e = (*v)(p->__pyx_v_path, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king *)o;
  tmp = ((PyObject*)p->__pyx_v_occupied);
  p->__pyx_v_occupied = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_path);
  p->__pyx_v_path = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_5chess_10__init__cp_Board *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_14__attacked_for_king", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_15_genexpr[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_15_genexpr = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_15_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_15_genexpr > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_15_genexpr[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_15_genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_15_genexpr(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_outer_scope);
  Py_CLEAR(p->__pyx_v_sq);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_15_genexpr < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_15_genexpr[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_15_genexpr++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_15_genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr *)o;
  if (p->__pyx_outer_scope) {
    e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
  }
  if (p->__pyx_v_sq) {
    e = (*v)(p->__pyx_v_sq, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_15_genexpr", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_15_genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_15_genexpr, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_15_genexpr, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_15_genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_a_side);
  Py_CLEAR(p->__pyx_v_backrank);
  Py_CLEAR(p->__pyx_v_bb_c);
  Py_CLEAR(p->__pyx_v_bb_d);
  Py_CLEAR(p->__pyx_v_bb_f);
  Py_CLEAR(p->__pyx_v_bb_g);
  Py_CLEAR(p->__pyx_v_candidate);
  Py_CLEAR(p->__pyx_v_empty_for_king);
  Py_CLEAR(p->__pyx_v_empty_for_rook);
  Py_CLEAR(p->__pyx_v_from_mask);
  Py_CLEAR(p->__pyx_v_king);
  Py_CLEAR(p->__pyx_v_king_to);
  Py_CLEAR(p->__pyx_v_rook);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_v_to_mask);
  Py_CLEAR(p->__pyx_t_0);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves *)o;
  if (p->__pyx_v_a_side) {
    e = (*v)(p->__pyx_v_a_side, a); if (e) return e;
  }
  if (p->__pyx_v_backrank) {
    e = (*v)(p->__pyx_v_backrank, a); if (e) return e;
  }
  if (p->__pyx_v_bb_c) {
    e = (*v)(p->__pyx_v_bb_c, a); if (e) return e;
  }
  if (p->__pyx_v_bb_d) {
    e = (*v)(p->__pyx_v_bb_d, a); if (e) return e;
  }
  if (p->__pyx_v_bb_f) {
    e = (*v)(p->__pyx_v_bb_f, a); if (e) return e;
  }
  if (p->__pyx_v_bb_g) {
    e = (*v)(p->__pyx_v_bb_g, a); if (e) return e;
  }
  if (p->__pyx_v_candidate) {
    e = (*v)(p->__pyx_v_candidate, a); if (e) return e;
  }
  if (p->__pyx_v_empty_for_king) {
    e = (*v)(p->__pyx_v_empty_for_king, a); if (e) return e;
  }
  if (p->__pyx_v_empty_for_rook) {
    e = (*v)(p->__pyx_v_empty_for_rook, a); if (e) return e;
  }
  if (p->__pyx_v_from_mask) {
    e = (*v)(p->__pyx_v_from_mask, a); if (e) return e;
  }
  if (p->__pyx_v_king) {
    e = (*v)(p->__pyx_v_king, a); if (e) return e;
  }
  if (p->__pyx_v_king_to) {
    e = (*v)(p->__pyx_v_king_to, a); if (e) return e;
  }
  if (p->__pyx_v_rook) {
    e = (*v)(p->__pyx_v_rook, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_v_to_mask) {
    e = (*v)(p->__pyx_v_to_mask, a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_16_generate_castling_moves", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_17___repr__[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_17___repr__ = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_17___repr__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_17___repr__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_17___repr__[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_17___repr__];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_17___repr__(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_17___repr__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_17___repr__[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_17___repr__++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_17___repr__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_17___repr__(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__ *)o;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_5chess_10__init__cp_LegalMoveGenerator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__ = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_17___repr__", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_17___repr__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_17___repr__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_17___repr__, /*tp_traverse*/
  __pyx_tp_clear_5chess_10__init__cp___pyx_scope_struct_17___repr__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_17___repr__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_18_genexpr[8];
static int __pyx_freecount_5chess_10__init__cp___pyx_scope_struct_18_genexpr = 0;

static PyObject *__pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_18_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_18_genexpr > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr)))) {
    o = (PyObject*)__pyx_freelist_5chess_10__init__cp___pyx_scope_struct_18_genexpr[--__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_18_genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  return o;
}

static void __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_18_genexpr(PyObject *o) {
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_outer_scope);
  Py_CLEAR(p->__pyx_v_move);
  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_18_genexpr < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr)))) {
    __pyx_freelist_5chess_10__init__cp___pyx_scope_struct_18_genexpr[__pyx_freecount_5chess_10__init__cp___pyx_scope_struct_18_genexpr++] = ((struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_18_genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *p = (struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr *)o;
  if (p->__pyx_outer_scope) {
    e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
  }
  if (p->__pyx_v_move) {
    e = (*v)(p->__pyx_v_move, a); if (e) return e;
  }
  return 0;
}

static PyTypeObject __pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  "chess.__init__cp.__pyx_scope_struct_18_genexpr", /*tp_name*/
  sizeof(struct __pyx_obj_5chess_10__init__cp___pyx_scope_struct_18_genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_5chess_10__init__cp___pyx_scope_struct_18_genexpr, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_5chess_10__init__cp___pyx_scope_struct_18_genexpr, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_5chess_10__init__cp___pyx_scope_struct_18_genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};

#if PY_MAJOR_VERSION >= 3
#if CYTHON_PEP489_MULTI_PHASE_INIT
static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
static int __pyx_pymod_exec___init__cp(PyObject* module); /*proto*/
static PyModuleDef_Slot __pyx_moduledef_slots[] = {
  {Py_mod_create, (void*)__pyx_pymod_create},
  {Py_mod_exec, (void*)__pyx_pymod_exec___init__cp},
  {0, NULL}
};
#endif

static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    "__init__cp",
    __pyx_k_A_pure_Python_chess_library_wit, /* m_doc */
  #if CYTHON_PEP489_MULTI_PHASE_INIT
    0, /* m_size */
  #else
    -1, /* m_size */
  #endif
    __pyx_methods /* m_methods */,
  #if CYTHON_PEP489_MULTI_PHASE_INIT
    __pyx_moduledef_slots, /* m_slots */
  #else
    NULL, /* m_reload */
  #endif
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif
#ifndef CYTHON_SMALL_CODE
#if defined(__clang__)
    #define CYTHON_SMALL_CODE
#elif defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))
    #define CYTHON_SMALL_CODE __attribute__((cold))
#else
    #define CYTHON_SMALL_CODE
#endif
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_u_0, __pyx_k_0, sizeof(__pyx_k_0), 0, 1, 0, 0},
  {&__pyx_kp_u_0000, __pyx_k_0000, sizeof(__pyx_k_0000), 0, 1, 0, 0},
  {&__pyx_kp_u_0123456789, __pyx_k_0123456789, sizeof(__pyx_k_0123456789), 0, 1, 0, 0},
  {&__pyx_kp_u_0_1, __pyx_k_0_1, sizeof(__pyx_k_0_1), 0, 1, 0, 0},
  {&__pyx_kp_u_0_1_2, __pyx_k_0_1_2, sizeof(__pyx_k_0_1_2), 0, 1, 0, 0},
  {&__pyx_kp_u_0_24_1, __pyx_k_0_24_1, sizeof(__pyx_k_0_24_1), 0, 1, 0, 0},
  {&__pyx_kp_u_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 1, 0, 0},
  {&__pyx_kp_u_1_0, __pyx_k_1_0, sizeof(__pyx_k_1_0), 0, 1, 0, 0},
  {&__pyx_kp_u_1_2_1_2, __pyx_k_1_2_1_2, sizeof(__pyx_k_1_2_1_2), 0, 1, 0, 0},
  {&__pyx_kp_u_2, __pyx_k_2, sizeof(__pyx_k_2), 0, 1, 0, 0},
  {&__pyx_kp_u_3, __pyx_k_3, sizeof(__pyx_k_3), 0, 1, 0, 0},
  {&__pyx_kp_u_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 1, 0, 0},
  {&__pyx_kp_u_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 1, 0, 0},
  {&__pyx_kp_u_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 1, 0, 0},
  {&__pyx_kp_u_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 1, 0, 0},
  {&__pyx_kp_u_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 1, 0, 0},
  {&__pyx_n_s_A1, __pyx_k_A1, sizeof(__pyx_k_A1), 0, 0, 1, 1},
  {&__pyx_n_s_A2, __pyx_k_A2, sizeof(__pyx_k_A2), 0, 0, 1, 1},
  {&__pyx_n_s_A3, __pyx_k_A3, sizeof(__pyx_k_A3), 0, 0, 1, 1},
  {&__pyx_n_s_A4, __pyx_k_A4, sizeof(__pyx_k_A4), 0, 0, 1, 1},
  {&__pyx_n_s_A5, __pyx_k_A5, sizeof(__pyx_k_A5), 0, 0, 1, 1},
  {&__pyx_n_s_A6, __pyx_k_A6, sizeof(__pyx_k_A6), 0, 0, 1, 1},
  {&__pyx_n_s_A7, __pyx_k_A7, sizeof(__pyx_k_A7), 0, 0, 1, 1},
  {&__pyx_n_s_A8, __pyx_k_A8, sizeof(__pyx_k_A8), 0, 0, 1, 1},
  {&__pyx_kp_s_A_piece_with_type_and_color, __pyx_k_A_piece_with_type_and_color, sizeof(__pyx_k_A_piece_with_type_and_color), 0, 0, 1, 0},
  {&__pyx_kp_s_A_set_of_squares_import_chess_s, __pyx_k_A_set_of_squares_import_chess_s, sizeof(__pyx_k_A_set_of_squares_import_chess_s), 0, 0, 1, 0},
  {&__pyx_n_s_AttributeError, __pyx_k_AttributeError, sizeof(__pyx_k_AttributeError), 0, 0, 1, 1},
  {&__pyx_n_u_B, __pyx_k_B, sizeof(__pyx_k_B), 0, 1, 0, 1},
  {&__pyx_n_s_B1, __pyx_k_B1, sizeof(__pyx_k_B1), 0, 0, 1, 1},
  {&__pyx_n_s_B2, __pyx_k_B2, sizeof(__pyx_k_B2), 0, 0, 1, 1},
  {&__pyx_n_s_B3, __pyx_k_B3, sizeof(__pyx_k_B3), 0, 0, 1, 1},
  {&__pyx_n_s_B4, __pyx_k_B4, sizeof(__pyx_k_B4), 0, 0, 1, 1},
  {&__pyx_n_s_B5, __pyx_k_B5, sizeof(__pyx_k_B5), 0, 0, 1, 1},
  {&__pyx_n_s_B6, __pyx_k_B6, sizeof(__pyx_k_B6), 0, 0, 1, 1},
  {&__pyx_n_s_B7, __pyx_k_B7, sizeof(__pyx_k_B7), 0, 0, 1, 1},
  {&__pyx_n_s_B8, __pyx_k_B8, sizeof(__pyx_k_B8), 0, 0, 1, 1},
  {&__pyx_n_s_BAD_CASTLING_RIGHTS, __pyx_k_BAD_CASTLING_RIGHTS, sizeof(__pyx_k_BAD_CASTLING_RIGHTS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A1, __pyx_k_BB_A1, sizeof(__pyx_k_BB_A1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A2, __pyx_k_BB_A2, sizeof(__pyx_k_BB_A2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A3, __pyx_k_BB_A3, sizeof(__pyx_k_BB_A3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A4, __pyx_k_BB_A4, sizeof(__pyx_k_BB_A4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A5, __pyx_k_BB_A5, sizeof(__pyx_k_BB_A5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A6, __pyx_k_BB_A6, sizeof(__pyx_k_BB_A6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A7, __pyx_k_BB_A7, sizeof(__pyx_k_BB_A7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_A8, __pyx_k_BB_A8, sizeof(__pyx_k_BB_A8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B1, __pyx_k_BB_B1, sizeof(__pyx_k_BB_B1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B2, __pyx_k_BB_B2, sizeof(__pyx_k_BB_B2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B3, __pyx_k_BB_B3, sizeof(__pyx_k_BB_B3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B4, __pyx_k_BB_B4, sizeof(__pyx_k_BB_B4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B5, __pyx_k_BB_B5, sizeof(__pyx_k_BB_B5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B6, __pyx_k_BB_B6, sizeof(__pyx_k_BB_B6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B7, __pyx_k_BB_B7, sizeof(__pyx_k_BB_B7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_B8, __pyx_k_BB_B8, sizeof(__pyx_k_BB_B8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_BACKRANKS, __pyx_k_BB_BACKRANKS, sizeof(__pyx_k_BB_BACKRANKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_BETWEEN, __pyx_k_BB_BETWEEN, sizeof(__pyx_k_BB_BETWEEN), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C1, __pyx_k_BB_C1, sizeof(__pyx_k_BB_C1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C2, __pyx_k_BB_C2, sizeof(__pyx_k_BB_C2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C3, __pyx_k_BB_C3, sizeof(__pyx_k_BB_C3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C4, __pyx_k_BB_C4, sizeof(__pyx_k_BB_C4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C5, __pyx_k_BB_C5, sizeof(__pyx_k_BB_C5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C6, __pyx_k_BB_C6, sizeof(__pyx_k_BB_C6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C7, __pyx_k_BB_C7, sizeof(__pyx_k_BB_C7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_C8, __pyx_k_BB_C8, sizeof(__pyx_k_BB_C8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_CENTER, __pyx_k_BB_CENTER, sizeof(__pyx_k_BB_CENTER), 0, 0, 1, 1},
  {&__pyx_n_s_BB_CORNERS, __pyx_k_BB_CORNERS, sizeof(__pyx_k_BB_CORNERS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D1, __pyx_k_BB_D1, sizeof(__pyx_k_BB_D1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D2, __pyx_k_BB_D2, sizeof(__pyx_k_BB_D2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D3, __pyx_k_BB_D3, sizeof(__pyx_k_BB_D3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D4, __pyx_k_BB_D4, sizeof(__pyx_k_BB_D4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D5, __pyx_k_BB_D5, sizeof(__pyx_k_BB_D5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D6, __pyx_k_BB_D6, sizeof(__pyx_k_BB_D6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D7, __pyx_k_BB_D7, sizeof(__pyx_k_BB_D7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_D8, __pyx_k_BB_D8, sizeof(__pyx_k_BB_D8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_DARK_SQUARES, __pyx_k_BB_DARK_SQUARES, sizeof(__pyx_k_BB_DARK_SQUARES), 0, 0, 1, 1},
  {&__pyx_n_s_BB_DIAG_ATTACKS, __pyx_k_BB_DIAG_ATTACKS, sizeof(__pyx_k_BB_DIAG_ATTACKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_DIAG_MASKS, __pyx_k_BB_DIAG_MASKS, sizeof(__pyx_k_BB_DIAG_MASKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E1, __pyx_k_BB_E1, sizeof(__pyx_k_BB_E1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E2, __pyx_k_BB_E2, sizeof(__pyx_k_BB_E2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E3, __pyx_k_BB_E3, sizeof(__pyx_k_BB_E3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E4, __pyx_k_BB_E4, sizeof(__pyx_k_BB_E4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E5, __pyx_k_BB_E5, sizeof(__pyx_k_BB_E5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E6, __pyx_k_BB_E6, sizeof(__pyx_k_BB_E6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E7, __pyx_k_BB_E7, sizeof(__pyx_k_BB_E7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_E8, __pyx_k_BB_E8, sizeof(__pyx_k_BB_E8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F1, __pyx_k_BB_F1, sizeof(__pyx_k_BB_F1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F2, __pyx_k_BB_F2, sizeof(__pyx_k_BB_F2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F3, __pyx_k_BB_F3, sizeof(__pyx_k_BB_F3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F4, __pyx_k_BB_F4, sizeof(__pyx_k_BB_F4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F5, __pyx_k_BB_F5, sizeof(__pyx_k_BB_F5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F6, __pyx_k_BB_F6, sizeof(__pyx_k_BB_F6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F7, __pyx_k_BB_F7, sizeof(__pyx_k_BB_F7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_F8, __pyx_k_BB_F8, sizeof(__pyx_k_BB_F8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILES, __pyx_k_BB_FILES, sizeof(__pyx_k_BB_FILES), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_A, __pyx_k_BB_FILE_A, sizeof(__pyx_k_BB_FILE_A), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_ATTACKS, __pyx_k_BB_FILE_ATTACKS, sizeof(__pyx_k_BB_FILE_ATTACKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_B, __pyx_k_BB_FILE_B, sizeof(__pyx_k_BB_FILE_B), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_C, __pyx_k_BB_FILE_C, sizeof(__pyx_k_BB_FILE_C), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_D, __pyx_k_BB_FILE_D, sizeof(__pyx_k_BB_FILE_D), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_E, __pyx_k_BB_FILE_E, sizeof(__pyx_k_BB_FILE_E), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_F, __pyx_k_BB_FILE_F, sizeof(__pyx_k_BB_FILE_F), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_G, __pyx_k_BB_FILE_G, sizeof(__pyx_k_BB_FILE_G), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_H, __pyx_k_BB_FILE_H, sizeof(__pyx_k_BB_FILE_H), 0, 0, 1, 1},
  {&__pyx_n_s_BB_FILE_MASKS, __pyx_k_BB_FILE_MASKS, sizeof(__pyx_k_BB_FILE_MASKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G1, __pyx_k_BB_G1, sizeof(__pyx_k_BB_G1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G2, __pyx_k_BB_G2, sizeof(__pyx_k_BB_G2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G3, __pyx_k_BB_G3, sizeof(__pyx_k_BB_G3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G4, __pyx_k_BB_G4, sizeof(__pyx_k_BB_G4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G5, __pyx_k_BB_G5, sizeof(__pyx_k_BB_G5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G6, __pyx_k_BB_G6, sizeof(__pyx_k_BB_G6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G7, __pyx_k_BB_G7, sizeof(__pyx_k_BB_G7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_G8, __pyx_k_BB_G8, sizeof(__pyx_k_BB_G8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H1, __pyx_k_BB_H1, sizeof(__pyx_k_BB_H1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H2, __pyx_k_BB_H2, sizeof(__pyx_k_BB_H2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H3, __pyx_k_BB_H3, sizeof(__pyx_k_BB_H3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H4, __pyx_k_BB_H4, sizeof(__pyx_k_BB_H4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H5, __pyx_k_BB_H5, sizeof(__pyx_k_BB_H5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H6, __pyx_k_BB_H6, sizeof(__pyx_k_BB_H6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H7, __pyx_k_BB_H7, sizeof(__pyx_k_BB_H7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_H8, __pyx_k_BB_H8, sizeof(__pyx_k_BB_H8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_KING_ATTACKS, __pyx_k_BB_KING_ATTACKS, sizeof(__pyx_k_BB_KING_ATTACKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_KNIGHT_ATTACKS, __pyx_k_BB_KNIGHT_ATTACKS, sizeof(__pyx_k_BB_KNIGHT_ATTACKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_LIGHT_SQUARES, __pyx_k_BB_LIGHT_SQUARES, sizeof(__pyx_k_BB_LIGHT_SQUARES), 0, 0, 1, 1},
  {&__pyx_n_s_BB_PAWN_ATTACKS, __pyx_k_BB_PAWN_ATTACKS, sizeof(__pyx_k_BB_PAWN_ATTACKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANKS, __pyx_k_BB_RANKS, sizeof(__pyx_k_BB_RANKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_1, __pyx_k_BB_RANK_1, sizeof(__pyx_k_BB_RANK_1), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_2, __pyx_k_BB_RANK_2, sizeof(__pyx_k_BB_RANK_2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_3, __pyx_k_BB_RANK_3, sizeof(__pyx_k_BB_RANK_3), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_4, __pyx_k_BB_RANK_4, sizeof(__pyx_k_BB_RANK_4), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_5, __pyx_k_BB_RANK_5, sizeof(__pyx_k_BB_RANK_5), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_6, __pyx_k_BB_RANK_6, sizeof(__pyx_k_BB_RANK_6), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_7, __pyx_k_BB_RANK_7, sizeof(__pyx_k_BB_RANK_7), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_8, __pyx_k_BB_RANK_8, sizeof(__pyx_k_BB_RANK_8), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_ATTACKS, __pyx_k_BB_RANK_ATTACKS, sizeof(__pyx_k_BB_RANK_ATTACKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RANK_MASKS, __pyx_k_BB_RANK_MASKS, sizeof(__pyx_k_BB_RANK_MASKS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_RAYS, __pyx_k_BB_RAYS, sizeof(__pyx_k_BB_RAYS), 0, 0, 1, 1},
  {&__pyx_n_s_BB_SQUARES, __pyx_k_BB_SQUARES, sizeof(__pyx_k_BB_SQUARES), 0, 0, 1, 1},
  {&__pyx_n_s_BB_SQUARES_2, __pyx_k_BB_SQUARES_2, sizeof(__pyx_k_BB_SQUARES_2), 0, 0, 1, 1},
  {&__pyx_n_s_BB_VOID, __pyx_k_BB_VOID, sizeof(__pyx_k_BB_VOID), 0, 0, 1, 1},
  {&__pyx_n_s_BISHOP, __pyx_k_BISHOP, sizeof(__pyx_k_BISHOP), 0, 0, 1, 1},
  {&__pyx_n_s_BaseBoard, __pyx_k_BaseBoard, sizeof(__pyx_k_BaseBoard), 0, 0, 1, 1},
  {&__pyx_kp_u_BaseBoard_from_chess960_pos_line, __pyx_k_BaseBoard_from_chess960_pos_line, sizeof(__pyx_k_BaseBoard_from_chess960_pos_line), 0, 1, 0, 0},
  {&__pyx_kp_u_BaseBoard_pin_line_799, __pyx_k_BaseBoard_pin_line_799, sizeof(__pyx_k_BaseBoard_pin_line_799), 0, 1, 0, 0},
  {&__pyx_n_s_Board, __pyx_k_Board, sizeof(__pyx_k_Board), 0, 0, 1, 1},
  {&__pyx_n_s_BoardState, __pyx_k_BoardState, sizeof(__pyx_k_BoardState), 0, 0, 1, 1},
  {&__pyx_n_s_BoardState___init, __pyx_k_BoardState___init, sizeof(__pyx_k_BoardState___init), 0, 0, 1, 1},
  {&__pyx_n_s_BoardState_restore, __pyx_k_BoardState_restore, sizeof(__pyx_k_BoardState_restore), 0, 0, 1, 1},
  {&__pyx_n_s_Board__generate_evasions, __pyx_k_Board__generate_evasions, sizeof(__pyx_k_Board__generate_evasions), 0, 0, 1, 1},
  {&__pyx_kp_u_Board_epd_line_2358, __pyx_k_Board_epd_line_2358, sizeof(__pyx_k_Board_epd_line_2358), 0, 1, 0, 0},
  {&__pyx_n_s_Board_generate_castling_moves, __pyx_k_Board_generate_castling_moves, sizeof(__pyx_k_Board_generate_castling_moves), 0, 0, 1, 1},
  {&__pyx_n_s_Board_generate_legal_ep, __pyx_k_Board_generate_legal_ep, sizeof(__pyx_k_Board_generate_legal_ep), 0, 0, 1, 1},
  {&__pyx_n_s_Board_generate_legal_moves, __pyx_k_Board_generate_legal_moves, sizeof(__pyx_k_Board_generate_legal_moves), 0, 0, 1, 1},
  {&__pyx_n_s_Board_generate_pseudo_legal_ep, __pyx_k_Board_generate_pseudo_legal_ep, sizeof(__pyx_k_Board_generate_pseudo_legal_ep), 0, 0, 1, 1},
  {&__pyx_n_s_Board_generate_pseudo_legal_move, __pyx_k_Board_generate_pseudo_legal_move, sizeof(__pyx_k_Board_generate_pseudo_legal_move), 0, 0, 1, 1},
  {&__pyx_kp_u_Board_push_line_1929, __pyx_k_Board_push_line_1929, sizeof(__pyx_k_Board_push_line_1929), 0, 1, 0, 0},
  {&__pyx_n_s_C1, __pyx_k_C1, sizeof(__pyx_k_C1), 0, 0, 1, 1},
  {&__pyx_n_s_C2, __pyx_k_C2, sizeof(__pyx_k_C2), 0, 0, 1, 1},
  {&__pyx_n_s_C3, __pyx_k_C3, sizeof(__pyx_k_C3), 0, 0, 1, 1},
  {&__pyx_n_s_C4, __pyx_k_C4, sizeof(__pyx_k_C4), 0, 0, 1, 1},
  {&__pyx_n_s_C5, __pyx_k_C5, sizeof(__pyx_k_C5), 0, 0, 1, 1},
  {&__pyx_n_s_C6, __pyx_k_C6, sizeof(__pyx_k_C6), 0, 0, 1, 1},
  {&__pyx_n_s_C7, __pyx_k_C7, sizeof(__pyx_k_C7), 0, 0, 1, 1},
  {&__pyx_n_s_C8, __pyx_k_C8, sizeof(__pyx_k_C8), 0, 0, 1, 1},
  {&__pyx_n_u_Chess, __pyx_k_Chess, sizeof(__pyx_k_Chess), 0, 1, 0, 1},
  {&__pyx_n_u_Classical, __pyx_k_Classical, sizeof(__pyx_k_Classical), 0, 1, 0, 1},
  {&__pyx_n_s_Counter, __pyx_k_Counter, sizeof(__pyx_k_Counter), 0, 0, 1, 1},
  {&__pyx_kp_u_Creates_a_class_chess_SquareSet, __pyx_k_Creates_a_class_chess_SquareSet, sizeof(__pyx_k_Creates_a_class_chess_SquareSet), 0, 1, 0, 0},
  {&__pyx_kp_u_Creates_a_new_board_initialized, __pyx_k_Creates_a_new_board_initialized, sizeof(__pyx_k_Creates_a_new_board_initialized), 0, 1, 0, 0},
  {&__pyx_n_s_D1, __pyx_k_D1, sizeof(__pyx_k_D1), 0, 0, 1, 1},
  {&__pyx_n_s_D2, __pyx_k_D2, sizeof(__pyx_k_D2), 0, 0, 1, 1},
  {&__pyx_n_s_D3, __pyx_k_D3, sizeof(__pyx_k_D3), 0, 0, 1, 1},
  {&__pyx_n_s_D4, __pyx_k_D4, sizeof(__pyx_k_D4), 0, 0, 1, 1},
  {&__pyx_n_s_D5, __pyx_k_D5, sizeof(__pyx_k_D5), 0, 0, 1, 1},
  {&__pyx_n_s_D6, __pyx_k_D6, sizeof(__pyx_k_D6), 0, 0, 1, 1},
  {&__pyx_n_s_D7, __pyx_k_D7, sizeof(__pyx_k_D7), 0, 0, 1, 1},
  {&__pyx_n_s_D8, __pyx_k_D8, sizeof(__pyx_k_D8), 0, 0, 1, 1},
  {&__pyx_kp_u_Detects_an_absolute_pin_and_its, __pyx_k_Detects_an_absolute_pin_and_its, sizeof(__pyx_k_Detects_an_absolute_pin_and_its), 0, 1, 0, 0},
  {&__pyx_n_s_E1, __pyx_k_E1, sizeof(__pyx_k_E1), 0, 0, 1, 1},
  {&__pyx_n_s_E2, __pyx_k_E2, sizeof(__pyx_k_E2), 0, 0, 1, 1},
  {&__pyx_n_s_E3, __pyx_k_E3, sizeof(__pyx_k_E3), 0, 0, 1, 1},
  {&__pyx_n_s_E4, __pyx_k_E4, sizeof(__pyx_k_E4), 0, 0, 1, 1},
  {&__pyx_n_s_E5, __pyx_k_E5, sizeof(__pyx_k_E5), 0, 0, 1, 1},
  {&__pyx_n_s_E6, __pyx_k_E6, sizeof(__pyx_k_E6), 0, 0, 1, 1},
  {&__pyx_n_s_E7, __pyx_k_E7, sizeof(__pyx_k_E7), 0, 0, 1, 1},
  {&__pyx_n_s_E8, __pyx_k_E8, sizeof(__pyx_k_E8), 0, 0, 1, 1},
  {&__pyx_n_s_EMPTY, __pyx_k_EMPTY, sizeof(__pyx_k_EMPTY), 0, 0, 1, 1},
  {&__pyx_n_s_F1, __pyx_k_F1, sizeof(__pyx_k_F1), 0, 0, 1, 1},
  {&__pyx_n_s_F2, __pyx_k_F2, sizeof(__pyx_k_F2), 0, 0, 1, 1},
  {&__pyx_n_s_F3, __pyx_k_F3, sizeof(__pyx_k_F3), 0, 0, 1, 1},
  {&__pyx_n_s_F4, __pyx_k_F4, sizeof(__pyx_k_F4), 0, 0, 1, 1},
  {&__pyx_n_s_F5, __pyx_k_F5, sizeof(__pyx_k_F5), 0, 0, 1, 1},
  {&__pyx_n_s_F6, __pyx_k_F6, sizeof(__pyx_k_F6), 0, 0, 1, 1},
  {&__pyx_n_s_F7, __pyx_k_F7, sizeof(__pyx_k_F7), 0, 0, 1, 1},
  {&__pyx_n_s_F8, __pyx_k_F8, sizeof(__pyx_k_F8), 0, 0, 1, 1},
  {&__pyx_n_s_FEN_CASTLING_REGEX, __pyx_k_FEN_CASTLING_REGEX, sizeof(__pyx_k_FEN_CASTLING_REGEX), 0, 0, 1, 1},
  {&__pyx_n_s_FILE_NAMES, __pyx_k_FILE_NAMES, sizeof(__pyx_k_FILE_NAMES), 0, 0, 1, 1},
  {&__pyx_n_s_G1, __pyx_k_G1, sizeof(__pyx_k_G1), 0, 0, 1, 1},
  {&__pyx_n_s_G2, __pyx_k_G2, sizeof(__pyx_k_G2), 0, 0, 1, 1},
  {&__pyx_n_s_G3, __pyx_k_G3, sizeof(__pyx_k_G3), 0, 0, 1, 1},
  {&__pyx_n_s_G4, __pyx_k_G4, sizeof(__pyx_k_G4), 0, 0, 1, 1},
  {&__pyx_n_s_G5, __pyx_k_G5, sizeof(__pyx_k_G5), 0, 0, 1, 1},
  {&__pyx_n_s_G6, __pyx_k_G6, sizeof(__pyx_k_G6), 0, 0, 1, 1},
  {&__pyx_n_s_G7, __pyx_k_G7, sizeof(__pyx_k_G7), 0, 0, 1, 1},
  {&__pyx_n_s_G8, __pyx_k_G8, sizeof(__pyx_k_G8), 0, 0, 1, 1},
  {&__pyx_kp_u_Gets_a_null_move_A_null_move_ju, __pyx_k_Gets_a_null_move_A_null_move_ju, sizeof(__pyx_k_Gets_a_null_move_A_null_move_ju), 0, 1, 0, 0},
  {&__pyx_kp_u_Gets_an_EPD_representation_of_t, __pyx_k_Gets_an_EPD_representation_of_t, sizeof(__pyx_k_Gets_an_EPD_representation_of_t), 0, 1, 0, 0},
  {&__pyx_n_s_H1, __pyx_k_H1, sizeof(__pyx_k_H1), 0, 0, 1, 1},
  {&__pyx_n_s_H2, __pyx_k_H2, sizeof(__pyx_k_H2), 0, 0, 1, 1},
  {&__pyx_n_s_H3, __pyx_k_H3, sizeof(__pyx_k_H3), 0, 0, 1, 1},
  {&__pyx_n_s_H4, __pyx_k_H4, sizeof(__pyx_k_H4), 0, 0, 1, 1},
  {&__pyx_n_s_H5, __pyx_k_H5, sizeof(__pyx_k_H5), 0, 0, 1, 1},
  {&__pyx_n_s_H6, __pyx_k_H6, sizeof(__pyx_k_H6), 0, 0, 1, 1},
  {&__pyx_n_s_H7, __pyx_k_H7, sizeof(__pyx_k_H7), 0, 0, 1, 1},
  {&__pyx_n_s_H8, __pyx_k_H8, sizeof(__pyx_k_H8), 0, 0, 1, 1},
  {&__pyx_n_s_INVALID_EP_SQUARE, __pyx_k_INVALID_EP_SQUARE, sizeof(__pyx_k_INVALID_EP_SQUARE), 0, 0, 1, 1},
  {&__pyx_kp_s_Incompatible_checksums_s_vs_0x36, __pyx_k_Incompatible_checksums_s_vs_0x36, sizeof(__pyx_k_Incompatible_checksums_s_vs_0x36), 0, 0, 1, 0},
  {&__pyx_kp_s_Incompatible_checksums_s_vs_0x5a, __pyx_k_Incompatible_checksums_s_vs_0x5a, sizeof(__pyx_k_Incompatible_checksums_s_vs_0x5a), 0, 0, 1, 0},
  {&__pyx_kp_s_Incompatible_checksums_s_vs_0xd4, __pyx_k_Incompatible_checksums_s_vs_0xd4, sizeof(__pyx_k_Incompatible_checksums_s_vs_0xd4), 0, 0, 1, 0},
  {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
  {&__pyx_n_s_IntEnum, __pyx_k_IntEnum, sizeof(__pyx_k_IntEnum), 0, 0, 1, 1},
  {&__pyx_n_s_IntFlag, __pyx_k_IntFlag, sizeof(__pyx_k_IntFlag), 0, 0, 1, 1},
  {&__pyx_n_s_IntFlag_2, __pyx_k_IntFlag_2, sizeof(__pyx_k_IntFlag_2), 0, 0, 1, 1},
  {&__pyx_n_u_K, __pyx_k_K, sizeof(__pyx_k_K), 0, 1, 0, 1},
  {&__pyx_n_s_KING, __pyx_k_KING, sizeof(__pyx_k_KING), 0, 0, 1, 1},
  {&__pyx_n_s_KNIGHT, __pyx_k_KNIGHT, sizeof(__pyx_k_KNIGHT), 0, 0, 1, 1},
  {&__pyx_kp_u_KQABCDEFGH_0_2_kqabcdefgh_0_2_Z, __pyx_k_KQABCDEFGH_0_2_kqabcdefgh_0_2_Z, sizeof(__pyx_k_KQABCDEFGH_0_2_kqabcdefgh_0_2_Z), 0, 1, 0, 0},
  {&__pyx_n_s_KeyError, __pyx_k_KeyError, sizeof(__pyx_k_KeyError), 0, 0, 1, 1},
  {&__pyx_n_s_LegalMoveGenerator, __pyx_k_LegalMoveGenerator, sizeof(__pyx_k_LegalMoveGenerator), 0, 0, 1, 1},
  {&__pyx_kp_u_LegalMoveGenerator_at, __pyx_k_LegalMoveGenerator_at, sizeof(__pyx_k_LegalMoveGenerator_at), 0, 1, 0, 0},
  {&__pyx_n_s_Move, __pyx_k_Move, sizeof(__pyx_k_Move), 0, 0, 1, 1},
  {&__pyx_kp_u_Move_from_uci, __pyx_k_Move_from_uci, sizeof(__pyx_k_Move_from_uci), 0, 1, 0, 0},
  {&__pyx_kp_u_Move_null_line_549, __pyx_k_Move_null_line_549, sizeof(__pyx_k_Move_null_line_549), 0, 1, 0, 0},
  {&__pyx_n_s_MutableSet, __pyx_k_MutableSet, sizeof(__pyx_k_MutableSet), 0, 0, 1, 1},
  {&__pyx_n_u_N, __pyx_k_N, sizeof(__pyx_k_N), 0, 1, 0, 1},
  {&__pyx_kp_u_NBKRQ_a_h_1_8_x_a_h_1_8_nbrqkNB, __pyx_k_NBKRQ_a_h_1_8_x_a_h_1_8_nbrqkNB, sizeof(__pyx_k_NBKRQ_a_h_1_8_x_a_h_1_8_nbrqkNB), 0, 1, 0, 0},
  {&__pyx_n_s_NO_BLACK_KING, __pyx_k_NO_BLACK_KING, sizeof(__pyx_k_NO_BLACK_KING), 0, 0, 1, 1},
  {&__pyx_n_s_NO_WHITE_KING, __pyx_k_NO_WHITE_KING, sizeof(__pyx_k_NO_WHITE_KING), 0, 0, 1, 1},
  {&__pyx_n_u_Normal, __pyx_k_Normal, sizeof(__pyx_k_Normal), 0, 1, 0, 1},
  {&__pyx_n_s_NotImplemented, __pyx_k_NotImplemented, sizeof(__pyx_k_NotImplemented), 0, 0, 1, 1},
  {&__pyx_n_s_OPPOSITE_CHECK, __pyx_k_OPPOSITE_CHECK, sizeof(__pyx_k_OPPOSITE_CHECK), 0, 0, 1, 1},
  {&__pyx_kp_u_O_O, __pyx_k_O_O, sizeof(__pyx_k_O_O), 0, 1, 0, 0},
  {&__pyx_kp_u_O_O_2, __pyx_k_O_O_2, sizeof(__pyx_k_O_O_2), 0, 1, 0, 0},
  {&__pyx_kp_u_O_O_3, __pyx_k_O_O_3, sizeof(__pyx_k_O_O_3), 0, 1, 0, 0},
  {&__pyx_kp_u_O_O_O, __pyx_k_O_O_O, sizeof(__pyx_k_O_O_O), 0, 1, 0, 0},
  {&__pyx_kp_u_O_O_O_2, __pyx_k_O_O_O_2, sizeof(__pyx_k_O_O_O_2), 0, 1, 0, 0},
  {&__pyx_kp_u_O_O_O_3, __pyx_k_O_O_O_3, sizeof(__pyx_k_O_O_O_3), 0, 1, 0, 0},
  {&__pyx_n_s_OverflowError, __pyx_k_OverflowError, sizeof(__pyx_k_OverflowError), 0, 0, 1, 1},
  {&__pyx_n_u_P, __pyx_k_P, sizeof(__pyx_k_P), 0, 1, 0, 1},
  {&__pyx_n_s_PAWN, __pyx_k_PAWN, sizeof(__pyx_k_PAWN), 0, 0, 1, 1},
  {&__pyx_n_s_PAWNS_ON_BACKRANK, __pyx_k_PAWNS_ON_BACKRANK, sizeof(__pyx_k_PAWNS_ON_BACKRANK), 0, 0, 1, 1},
  {&__pyx_n_s_PIECE_NAMES, __pyx_k_PIECE_NAMES, sizeof(__pyx_k_PIECE_NAMES), 0, 0, 1, 1},
  {&__pyx_n_s_PIECE_SYMBOLS, __pyx_k_PIECE_SYMBOLS, sizeof(__pyx_k_PIECE_SYMBOLS), 0, 0, 1, 1},
  {&__pyx_n_s_PIECE_TYPES, __pyx_k_PIECE_TYPES, sizeof(__pyx_k_PIECE_TYPES), 0, 0, 1, 1},
  {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
  {&__pyx_n_s_Piece, __pyx_k_Piece, sizeof(__pyx_k_Piece), 0, 0, 1, 1},
  {&__pyx_n_s_PieceType, __pyx_k_PieceType, sizeof(__pyx_k_PieceType), 0, 0, 1, 1},
  {&__pyx_n_s_Piece___eq, __pyx_k_Piece___eq, sizeof(__pyx_k_Piece___eq), 0, 0, 1, 1},
  {&__pyx_n_s_Piece___hash, __pyx_k_Piece___hash, sizeof(__pyx_k_Piece___hash), 0, 0, 1, 1},
  {&__pyx_n_s_Piece___init, __pyx_k_Piece___init, sizeof(__pyx_k_Piece___init), 0, 0, 1, 1},
  {&__pyx_n_s_Piece___ne, __pyx_k_Piece___ne, sizeof(__pyx_k_Piece___ne), 0, 0, 1, 1},
  {&__pyx_n_s_Piece___repr, __pyx_k_Piece___repr, sizeof(__pyx_k_Piece___repr), 0, 0, 1, 1},
  {&__pyx_n_s_Piece___str, __pyx_k_Piece___str, sizeof(__pyx_k_Piece___str), 0, 0, 1, 1},
  {&__pyx_n_s_Piece__repr_svg, __pyx_k_Piece__repr_svg, sizeof(__pyx_k_Piece__repr_svg), 0, 0, 1, 1},
  {&__pyx_kp_u_Piece_from_symbol, __pyx_k_Piece_from_symbol, sizeof(__pyx_k_Piece_from_symbol), 0, 1, 0, 0},
  {&__pyx_n_s_Piece_from_symbol_2, __pyx_k_Piece_from_symbol_2, sizeof(__pyx_k_Piece_from_symbol_2), 0, 0, 1, 1},
  {&__pyx_n_s_Piece_symbol, __pyx_k_Piece_symbol, sizeof(__pyx_k_Piece_symbol), 0, 0, 1, 1},
  {&__pyx_n_s_Piece_unicode_symbol, __pyx_k_Piece_unicode_symbol, sizeof(__pyx_k_Piece_unicode_symbol), 0, 0, 1, 1},
  {&__pyx_n_s_PseudoLegalMoveGenerator, __pyx_k_PseudoLegalMoveGenerator, sizeof(__pyx_k_PseudoLegalMoveGenerator), 0, 0, 1, 1},
  {&__pyx_kp_u_PseudoLegalMoveGenerator_at, __pyx_k_PseudoLegalMoveGenerator_at, sizeof(__pyx_k_PseudoLegalMoveGenerator_at), 0, 1, 0, 0},
  {&__pyx_n_u_Q, __pyx_k_Q, sizeof(__pyx_k_Q), 0, 1, 0, 1},
  {&__pyx_n_s_QUEEN, __pyx_k_QUEEN, sizeof(__pyx_k_QUEEN), 0, 0, 1, 1},
  {&__pyx_n_u_R, __pyx_k_R, sizeof(__pyx_k_R), 0, 1, 0, 1},
  {&__pyx_n_s_RACE_CHECK, __pyx_k_RACE_CHECK, sizeof(__pyx_k_RACE_CHECK), 0, 0, 1, 1},
  {&__pyx_n_s_RACE_MATERIAL, __pyx_k_RACE_MATERIAL, sizeof(__pyx_k_RACE_MATERIAL), 0, 0, 1, 1},
  {&__pyx_n_s_RACE_OVER, __pyx_k_RACE_OVER, sizeof(__pyx_k_RACE_OVER), 0, 0, 1, 1},
  {&__pyx_n_s_RANK_NAMES, __pyx_k_RANK_NAMES, sizeof(__pyx_k_RANK_NAMES), 0, 0, 1, 1},
  {&__pyx_n_s_ROOK, __pyx_k_ROOK, sizeof(__pyx_k_ROOK), 0, 0, 1, 1},
  {&__pyx_n_s_SAN_REGEX, __pyx_k_SAN_REGEX, sizeof(__pyx_k_SAN_REGEX), 0, 0, 1, 1},
  {&__pyx_n_s_SQUARES, __pyx_k_SQUARES, sizeof(__pyx_k_SQUARES), 0, 0, 1, 1},
  {&__pyx_n_s_SQUARES_180, __pyx_k_SQUARES_180, sizeof(__pyx_k_SQUARES_180), 0, 0, 1, 1},
  {&__pyx_n_s_SQUARE_NAMES, __pyx_k_SQUARE_NAMES, sizeof(__pyx_k_SQUARE_NAMES), 0, 0, 1, 1},
  {&__pyx_n_s_STARTING_BOARD_FEN, __pyx_k_STARTING_BOARD_FEN, sizeof(__pyx_k_STARTING_BOARD_FEN), 0, 0, 1, 1},
  {&__pyx_n_s_STARTING_FEN, __pyx_k_STARTING_FEN, sizeof(__pyx_k_STARTING_FEN), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_BAD_CASTLING_RIGHTS, __pyx_k_STATUS_BAD_CASTLING_RIGHTS, sizeof(__pyx_k_STATUS_BAD_CASTLING_RIGHTS), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_EMPTY, __pyx_k_STATUS_EMPTY, sizeof(__pyx_k_STATUS_EMPTY), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_INVALID_EP_SQUARE, __pyx_k_STATUS_INVALID_EP_SQUARE, sizeof(__pyx_k_STATUS_INVALID_EP_SQUARE), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_NO_BLACK_KING, __pyx_k_STATUS_NO_BLACK_KING, sizeof(__pyx_k_STATUS_NO_BLACK_KING), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_NO_WHITE_KING, __pyx_k_STATUS_NO_WHITE_KING, sizeof(__pyx_k_STATUS_NO_WHITE_KING), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_OPPOSITE_CHECK, __pyx_k_STATUS_OPPOSITE_CHECK, sizeof(__pyx_k_STATUS_OPPOSITE_CHECK), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_PAWNS_ON_BACKRANK, __pyx_k_STATUS_PAWNS_ON_BACKRANK, sizeof(__pyx_k_STATUS_PAWNS_ON_BACKRANK), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_RACE_CHECK, __pyx_k_STATUS_RACE_CHECK, sizeof(__pyx_k_STATUS_RACE_CHECK), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_RACE_MATERIAL, __pyx_k_STATUS_RACE_MATERIAL, sizeof(__pyx_k_STATUS_RACE_MATERIAL), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_RACE_OVER, __pyx_k_STATUS_RACE_OVER, sizeof(__pyx_k_STATUS_RACE_OVER), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_TOO_MANY_BLACK_PAWNS, __pyx_k_STATUS_TOO_MANY_BLACK_PAWNS, sizeof(__pyx_k_STATUS_TOO_MANY_BLACK_PAWNS), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_TOO_MANY_BLACK_PIECES, __pyx_k_STATUS_TOO_MANY_BLACK_PIECES, sizeof(__pyx_k_STATUS_TOO_MANY_BLACK_PIECES), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_TOO_MANY_KINGS, __pyx_k_STATUS_TOO_MANY_KINGS, sizeof(__pyx_k_STATUS_TOO_MANY_KINGS), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_TOO_MANY_WHITE_PAWNS, __pyx_k_STATUS_TOO_MANY_WHITE_PAWNS, sizeof(__pyx_k_STATUS_TOO_MANY_WHITE_PAWNS), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_TOO_MANY_WHITE_PIECES, __pyx_k_STATUS_TOO_MANY_WHITE_PIECES, sizeof(__pyx_k_STATUS_TOO_MANY_WHITE_PIECES), 0, 0, 1, 1},
  {&__pyx_n_s_STATUS_VALID, __pyx_k_STATUS_VALID, sizeof(__pyx_k_STATUS_VALID), 0, 0, 1, 1},
  {&__pyx_n_s_Square, __pyx_k_Square, sizeof(__pyx_k_Square), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet, __pyx_k_SquareSet, sizeof(__pyx_k_SquareSet), 0, 0, 1, 1},
  {&__pyx_kp_u_SquareSet_0_018x, __pyx_k_SquareSet_0_018x, sizeof(__pyx_k_SquareSet_0_018x), 0, 1, 0, 0},
  {&__pyx_n_s_SquareSet___and, __pyx_k_SquareSet___and, sizeof(__pyx_k_SquareSet___and), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___bool, __pyx_k_SquareSet___bool, sizeof(__pyx_k_SquareSet___bool), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___contains, __pyx_k_SquareSet___contains, sizeof(__pyx_k_SquareSet___contains), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___eq, __pyx_k_SquareSet___eq, sizeof(__pyx_k_SquareSet___eq), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___iand, __pyx_k_SquareSet___iand, sizeof(__pyx_k_SquareSet___iand), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___ilshift, __pyx_k_SquareSet___ilshift, sizeof(__pyx_k_SquareSet___ilshift), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___index, __pyx_k_SquareSet___index, sizeof(__pyx_k_SquareSet___index), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___init, __pyx_k_SquareSet___init, sizeof(__pyx_k_SquareSet___init), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___int, __pyx_k_SquareSet___int, sizeof(__pyx_k_SquareSet___int), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___invert, __pyx_k_SquareSet___invert, sizeof(__pyx_k_SquareSet___invert), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___ior, __pyx_k_SquareSet___ior, sizeof(__pyx_k_SquareSet___ior), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___irshift, __pyx_k_SquareSet___irshift, sizeof(__pyx_k_SquareSet___irshift), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___isub, __pyx_k_SquareSet___isub, sizeof(__pyx_k_SquareSet___isub), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___iter, __pyx_k_SquareSet___iter, sizeof(__pyx_k_SquareSet___iter), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___ixor, __pyx_k_SquareSet___ixor, sizeof(__pyx_k_SquareSet___ixor), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___len, __pyx_k_SquareSet___len, sizeof(__pyx_k_SquareSet___len), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___lshift, __pyx_k_SquareSet___lshift, sizeof(__pyx_k_SquareSet___lshift), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___ne, __pyx_k_SquareSet___ne, sizeof(__pyx_k_SquareSet___ne), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___or, __pyx_k_SquareSet___or, sizeof(__pyx_k_SquareSet___or), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___repr, __pyx_k_SquareSet___repr, sizeof(__pyx_k_SquareSet___repr), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___reversed, __pyx_k_SquareSet___reversed, sizeof(__pyx_k_SquareSet___reversed), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___rshift, __pyx_k_SquareSet___rshift, sizeof(__pyx_k_SquareSet___rshift), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___str, __pyx_k_SquareSet___str, sizeof(__pyx_k_SquareSet___str), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___sub, __pyx_k_SquareSet___sub, sizeof(__pyx_k_SquareSet___sub), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet___xor, __pyx_k_SquareSet___xor, sizeof(__pyx_k_SquareSet___xor), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet__repr_svg, __pyx_k_SquareSet__repr_svg, sizeof(__pyx_k_SquareSet__repr_svg), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_add, __pyx_k_SquareSet_add, sizeof(__pyx_k_SquareSet_add), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_carry_rippler, __pyx_k_SquareSet_carry_rippler, sizeof(__pyx_k_SquareSet_carry_rippler), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_clear, __pyx_k_SquareSet_clear, sizeof(__pyx_k_SquareSet_clear), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_copy, __pyx_k_SquareSet_copy, sizeof(__pyx_k_SquareSet_copy), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_difference, __pyx_k_SquareSet_difference, sizeof(__pyx_k_SquareSet_difference), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_difference_update, __pyx_k_SquareSet_difference_update, sizeof(__pyx_k_SquareSet_difference_update), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_discard, __pyx_k_SquareSet_discard, sizeof(__pyx_k_SquareSet_discard), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_from_square, __pyx_k_SquareSet_from_square, sizeof(__pyx_k_SquareSet_from_square), 0, 0, 1, 1},
  {&__pyx_kp_u_SquareSet_from_square_line_3718, __pyx_k_SquareSet_from_square_line_3718, sizeof(__pyx_k_SquareSet_from_square_line_3718), 0, 1, 0, 0},
  {&__pyx_n_s_SquareSet_intersection, __pyx_k_SquareSet_intersection, sizeof(__pyx_k_SquareSet_intersection), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_intersection_update, __pyx_k_SquareSet_intersection_update, sizeof(__pyx_k_SquareSet_intersection_update), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_isdisjoint, __pyx_k_SquareSet_isdisjoint, sizeof(__pyx_k_SquareSet_isdisjoint), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_issubset, __pyx_k_SquareSet_issubset, sizeof(__pyx_k_SquareSet_issubset), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_issuperset, __pyx_k_SquareSet_issuperset, sizeof(__pyx_k_SquareSet_issuperset), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_mirror, __pyx_k_SquareSet_mirror, sizeof(__pyx_k_SquareSet_mirror), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_pop, __pyx_k_SquareSet_pop, sizeof(__pyx_k_SquareSet_pop), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_remove, __pyx_k_SquareSet_remove, sizeof(__pyx_k_SquareSet_remove), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_symmetric_difference, __pyx_k_SquareSet_symmetric_difference, sizeof(__pyx_k_SquareSet_symmetric_difference), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_symmetric_difference_u, __pyx_k_SquareSet_symmetric_difference_u, sizeof(__pyx_k_SquareSet_symmetric_difference_u), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_tolist, __pyx_k_SquareSet_tolist, sizeof(__pyx_k_SquareSet_tolist), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_union, __pyx_k_SquareSet_union, sizeof(__pyx_k_SquareSet_union), 0, 0, 1, 1},
  {&__pyx_n_s_SquareSet_update, __pyx_k_SquareSet_update, sizeof(__pyx_k_SquareSet_update), 0, 0, 1, 1},
  {&__pyx_n_u_Standard, __pyx_k_Standard, sizeof(__pyx_k_Standard), 0, 1, 0, 1},
  {&__pyx_n_s_Status, __pyx_k_Status, sizeof(__pyx_k_Status), 0, 0, 1, 1},
  {&__pyx_n_s_StopIteration, __pyx_k_StopIteration, sizeof(__pyx_k_StopIteration), 0, 0, 1, 1},
  {&__pyx_n_s_TOO_MANY_BLACK_PAWNS, __pyx_k_TOO_MANY_BLACK_PAWNS, sizeof(__pyx_k_TOO_MANY_BLACK_PAWNS), 0, 0, 1, 1},
  {&__pyx_n_s_TOO_MANY_BLACK_PIECES, __pyx_k_TOO_MANY_BLACK_PIECES, sizeof(__pyx_k_TOO_MANY_BLACK_PIECES), 0, 0, 1, 1},
  {&__pyx_n_s_TOO_MANY_KINGS, __pyx_k_TOO_MANY_KINGS, sizeof(__pyx_k_TOO_MANY_KINGS), 0, 0, 1, 1},
  {&__pyx_n_s_TOO_MANY_WHITE_PAWNS, __pyx_k_TOO_MANY_WHITE_PAWNS, sizeof(__pyx_k_TOO_MANY_WHITE_PAWNS), 0, 0, 1, 1},
  {&__pyx_n_s_TOO_MANY_WHITE_PIECES, __pyx_k_TOO_MANY_WHITE_PIECES, sizeof(__pyx_k_TOO_MANY_WHITE_PIECES), 0, 0, 1, 1},
  {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
  {&__pyx_n_s_UNICODE_PIECE_SYMBOLS, __pyx_k_UNICODE_PIECE_SYMBOLS, sizeof(__pyx_k_UNICODE_PIECE_SYMBOLS), 0, 0, 1, 1},
  {&__pyx_kp_u_Updates_the_position_with_the_g, __pyx_k_Updates_the_position_with_the_g, sizeof(__pyx_k_Updates_the_position_with_the_g), 0, 1, 0, 0},
  {&__pyx_n_s_VALID, __pyx_k_VALID, sizeof(__pyx_k_VALID), 0, 0, 1, 1},
  {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
  {&__pyx_n_u_Z0, __pyx_k_Z0, sizeof(__pyx_k_Z0), 0, 1, 0, 1},
  {&__pyx_kp_u__11, __pyx_k__11, sizeof(__pyx_k__11), 0, 1, 0, 0},
  {&__pyx_kp_u__12, __pyx_k__12, sizeof(__pyx_k__12), 0, 1, 0, 0},
  {&__pyx_kp_u__13, __pyx_k__13, sizeof(__pyx_k__13), 0, 1, 0, 0},
  {&__pyx_kp_u__14, __pyx_k__14, sizeof(__pyx_k__14), 0, 1, 0, 0},
  {&__pyx_kp_u__15, __pyx_k__15, sizeof(__pyx_k__15), 0, 1, 0, 0},
  {&__pyx_kp_u__16, __pyx_k__16, sizeof(__pyx_k__16), 0, 1, 0, 0},
  {&__pyx_kp_u__18, __pyx_k__18, sizeof(__pyx_k__18), 0, 1, 0, 0},
  {&__pyx_kp_u__19, __pyx_k__19, sizeof(__pyx_k__19), 0, 1, 0, 0},
  {&__pyx_kp_u__20, __pyx_k__20, sizeof(__pyx_k__20), 0, 1, 0, 0},
  {&__pyx_kp_u__21, __pyx_k__21, sizeof(__pyx_k__21), 0, 1, 0, 0},
  {&__pyx_kp_u__22, __pyx_k__22, sizeof(__pyx_k__22), 0, 1, 0, 0},
  {&__pyx_kp_u__23, __pyx_k__23, sizeof(__pyx_k__23), 0, 1, 0, 0},
  {&__pyx_kp_u__33, __pyx_k__33, sizeof(__pyx_k__33), 0, 1, 0, 0},
  {&__pyx_kp_u__34, __pyx_k__34, sizeof(__pyx_k__34), 0, 1, 0, 0},
  {&__pyx_kp_u__35, __pyx_k__35, sizeof(__pyx_k__35), 0, 1, 0, 0},
  {&__pyx_kp_u__36, __pyx_k__36, sizeof(__pyx_k__36), 0, 1, 0, 0},
  {&__pyx_kp_u__37, __pyx_k__37, sizeof(__pyx_k__37), 0, 1, 0, 0},
  {&__pyx_kp_u__38, __pyx_k__38, sizeof(__pyx_k__38), 0, 1, 0, 0},
  {&__pyx_kp_u__39, __pyx_k__39, sizeof(__pyx_k__39), 0, 1, 0, 0},
  {&__pyx_kp_u__40, __pyx_k__40, sizeof(__pyx_k__40), 0, 1, 0, 0},
  {&__pyx_kp_u__41, __pyx_k__41, sizeof(__pyx_k__41), 0, 1, 0, 0},
  {&__pyx_kp_u__42, __pyx_k__42, sizeof(__pyx_k__42), 0, 1, 0, 0},
  {&__pyx_kp_u__44, __pyx_k__44, sizeof(__pyx_k__44), 0, 1, 0, 0},
  {&__pyx_kp_u__45, __pyx_k__45, sizeof(__pyx_k__45), 0, 1, 0, 0},
  {&__pyx_kp_u__46, __pyx_k__46, sizeof(__pyx_k__46), 0, 1, 0, 0},
  {&__pyx_kp_u__47, __pyx_k__47, sizeof(__pyx_k__47), 0, 1, 0, 0},
  {&__pyx_kp_u__48, __pyx_k__48, sizeof(__pyx_k__48), 0, 1, 0, 0},
  {&__pyx_kp_u__49, __pyx_k__49, sizeof(__pyx_k__49), 0, 1, 0, 0},
  {&__pyx_kp_u__5, __pyx_k__5, sizeof(__pyx_k__5), 0, 1, 0, 0},
  {&__pyx_kp_u__60, __pyx_k__60, sizeof(__pyx_k__60), 0, 1, 0, 0},
  {&__pyx_kp_u__62, __pyx_k__62, sizeof(__pyx_k__62), 0, 1, 0, 0},
  {&__pyx_kp_u__65, __pyx_k__65, sizeof(__pyx_k__65), 0, 1, 0, 0},
  {&__pyx_kp_u__66, __pyx_k__66, sizeof(__pyx_k__66), 0, 1, 0, 0},
  {&__pyx_kp_u__67, __pyx_k__67, sizeof(__pyx_k__67), 0, 1, 0, 0},
  {&__pyx_kp_u__68, __pyx_k__68, sizeof(__pyx_k__68), 0, 1, 0, 0},
  {&__pyx_kp_u__69, __pyx_k__69, sizeof(__pyx_k__69), 0, 1, 0, 0},
  {&__pyx_kp_u__70, __pyx_k__70, sizeof(__pyx_k__70), 0, 1, 0, 0},
  {&__pyx_kp_u__71, __pyx_k__71, sizeof(__pyx_k__71), 0, 1, 0, 0},
  {&__pyx_kp_u__72, __pyx_k__72, sizeof(__pyx_k__72), 0, 1, 0, 0},
  {&__pyx_kp_u__73, __pyx_k__73, sizeof(__pyx_k__73), 0, 1, 0, 0},
  {&__pyx_kp_u__74, __pyx_k__74, sizeof(__pyx_k__74), 0, 1, 0, 0},
  {&__pyx_kp_u__75, __pyx_k__75, sizeof(__pyx_k__75), 0, 1, 0, 0},
  {&__pyx_kp_u__76, __pyx_k__76, sizeof(__pyx_k__76), 0, 1, 0, 0},
  {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
  {&__pyx_n_u_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 1, 0, 1},
  {&__pyx_kp_u_a_b_c_d_e_f_g_h, __pyx_k_a_b_c_d_e_f_g_h, sizeof(__pyx_k_a_b_c_d_e_f_g_h), 0, 1, 0, 0},
  {&__pyx_n_s_abc, __pyx_k_abc, sizeof(__pyx_k_abc), 0, 0, 1, 1},
  {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
  {&__pyx_n_u_after_opcode, __pyx_k_after_opcode, sizeof(__pyx_k_after_opcode), 0, 1, 0, 1},
  {&__pyx_n_s_algebraic, __pyx_k_algebraic, sizeof(__pyx_k_algebraic), 0, 0, 1, 1},
  {&__pyx_n_s_aliases, __pyx_k_aliases, sizeof(__pyx_k_aliases), 0, 0, 1, 1},
  {&__pyx_n_u_am, __pyx_k_am, sizeof(__pyx_k_am), 0, 1, 0, 1},
  {&__pyx_kp_u_ambiguous_san_in, __pyx_k_ambiguous_san_in, sizeof(__pyx_k_ambiguous_san_in), 0, 1, 0, 0},
  {&__pyx_n_s_and, __pyx_k_and, sizeof(__pyx_k_and), 0, 0, 1, 1},
  {&__pyx_n_s_any, __pyx_k_any, sizeof(__pyx_k_any), 0, 0, 1, 1},
  {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
  {&__pyx_n_s_apply_transform, __pyx_k_apply_transform, sizeof(__pyx_k_apply_transform), 0, 0, 1, 1},
  {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
  {&__pyx_n_s_attack_table, __pyx_k_attack_table, sizeof(__pyx_k_attack_table), 0, 0, 1, 1},
  {&__pyx_n_s_attack_table_2, __pyx_k_attack_table_2, sizeof(__pyx_k_attack_table_2), 0, 0, 1, 1},
  {&__pyx_n_s_attacked_for_king, __pyx_k_attacked_for_king, sizeof(__pyx_k_attacked_for_king), 0, 0, 1, 1},
  {&__pyx_n_s_attacked_for_king_locals_genexp, __pyx_k_attacked_for_king_locals_genexp, sizeof(__pyx_k_attacked_for_king_locals_genexp), 0, 0, 1, 1},
  {&__pyx_n_s_attackers_mask, __pyx_k_attackers_mask, sizeof(__pyx_k_attackers_mask), 0, 0, 1, 1},
  {&__pyx_n_s_attackers_mask_2, __pyx_k_attackers_mask_2, sizeof(__pyx_k_attackers_mask_2), 0, 0, 1, 1},
  {&__pyx_n_s_attacks, __pyx_k_attacks, sizeof(__pyx_k_attacks), 0, 0, 1, 1},
  {&__pyx_n_s_attacks_mask, __pyx_k_attacks_mask, sizeof(__pyx_k_attacks_mask), 0, 0, 1, 1},
  {&__pyx_n_s_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 0, 1, 1},
  {&__pyx_n_u_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 1, 0, 1},
  {&__pyx_n_s_bb, __pyx_k_bb, sizeof(__pyx_k_bb), 0, 0, 1, 1},
  {&__pyx_n_s_bb_a, __pyx_k_bb_a, sizeof(__pyx_k_bb_a), 0, 0, 1, 1},
  {&__pyx_n_s_bb_b, __pyx_k_bb_b, sizeof(__pyx_k_bb_b), 0, 0, 1, 1},
  {&__pyx_n_s_between, __pyx_k_between, sizeof(__pyx_k_between), 0, 0, 1, 1},
  {&__pyx_n_s_between_row, __pyx_k_between_row, sizeof(__pyx_k_between_row), 0, 0, 1, 1},
  {&__pyx_n_s_bin, __pyx_k_bin, sizeof(__pyx_k_bin), 0, 0, 1, 1},
  {&__pyx_n_s_bin_2, __pyx_k_bin_2, sizeof(__pyx_k_bin_2), 0, 0, 1, 1},
  {&__pyx_n_u_bishop, __pyx_k_bishop, sizeof(__pyx_k_bishop), 0, 1, 0, 1},
  {&__pyx_n_s_bishops, __pyx_k_bishops, sizeof(__pyx_k_bishops), 0, 0, 1, 1},
  {&__pyx_n_s_bit_length, __pyx_k_bit_length, sizeof(__pyx_k_bit_length), 0, 0, 1, 1},
  {&__pyx_n_s_blockers, __pyx_k_blockers, sizeof(__pyx_k_blockers), 0, 0, 1, 1},
  {&__pyx_n_u_bm, __pyx_k_bm, sizeof(__pyx_k_bm), 0, 1, 0, 1},
  {&__pyx_n_s_board, __pyx_k_board, sizeof(__pyx_k_board), 0, 0, 1, 1},
  {&__pyx_n_s_board_fen, __pyx_k_board_fen, sizeof(__pyx_k_board_fen), 0, 0, 1, 1},
  {&__pyx_n_s_bool, __pyx_k_bool, sizeof(__pyx_k_bool), 0, 0, 1, 1},
  {&__pyx_n_s_borders, __pyx_k_borders, sizeof(__pyx_k_borders), 0, 0, 1, 1},
  {&__pyx_n_s_bswap, __pyx_k_bswap, sizeof(__pyx_k_bswap), 0, 0, 1, 1},
  {&__pyx_n_s_builder, __pyx_k_builder, sizeof(__pyx_k_builder), 0, 0, 1, 1},
  {&__pyx_n_u_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 1, 0, 1},
  {&__pyx_n_s_can_claim_draw, __pyx_k_can_claim_draw, sizeof(__pyx_k_can_claim_draw), 0, 0, 1, 1},
  {&__pyx_n_s_can_claim_fifty_moves, __pyx_k_can_claim_fifty_moves, sizeof(__pyx_k_can_claim_fifty_moves), 0, 0, 1, 1},
  {&__pyx_n_s_can_claim_threefold_repetition, __pyx_k_can_claim_threefold_repetition, sizeof(__pyx_k_can_claim_threefold_repetition), 0, 0, 1, 1},
  {&__pyx_n_s_capture_square, __pyx_k_capture_square, sizeof(__pyx_k_capture_square), 0, 0, 1, 1},
  {&__pyx_n_s_capturer, __pyx_k_capturer, sizeof(__pyx_k_capturer), 0, 0, 1, 1},
  {&__pyx_n_s_captures_compulsory, __pyx_k_captures_compulsory, sizeof(__pyx_k_captures_compulsory), 0, 0, 1, 1},
  {&__pyx_n_s_carry_rippler, __pyx_k_carry_rippler, sizeof(__pyx_k_carry_rippler), 0, 0, 1, 1},
  {&__pyx_n_s_carry_rippler_2, __pyx_k_carry_rippler_2, sizeof(__pyx_k_carry_rippler_2), 0, 0, 1, 1},
  {&__pyx_n_s_castling_rights, __pyx_k_castling_rights, sizeof(__pyx_k_castling_rights), 0, 0, 1, 1},
  {&__pyx_n_s_castling_shredder_fen, __pyx_k_castling_shredder_fen, sizeof(__pyx_k_castling_shredder_fen), 0, 0, 1, 1},
  {&__pyx_n_s_castling_uncovers_rank_attack, __pyx_k_castling_uncovers_rank_attack, sizeof(__pyx_k_castling_uncovers_rank_attack), 0, 0, 1, 1},
  {&__pyx_n_s_castling_xfen, __pyx_k_castling_xfen, sizeof(__pyx_k_castling_xfen), 0, 0, 1, 1},
  {&__pyx_n_s_castling_xfen_locals_genexpr, __pyx_k_castling_xfen_locals_genexpr, sizeof(__pyx_k_castling_xfen_locals_genexpr), 0, 0, 1, 1},
  {&__pyx_n_s_chain, __pyx_k_chain, sizeof(__pyx_k_chain), 0, 0, 1, 1},
  {&__pyx_n_s_check, __pyx_k_check, sizeof(__pyx_k_check), 0, 0, 1, 1},
  {&__pyx_n_s_checkers, __pyx_k_checkers, sizeof(__pyx_k_checkers), 0, 0, 1, 1},
  {&__pyx_n_s_chess, __pyx_k_chess, sizeof(__pyx_k_chess), 0, 0, 1, 1},
  {&__pyx_n_u_chess, __pyx_k_chess, sizeof(__pyx_k_chess), 0, 1, 0, 1},
  {&__pyx_n_s_chess960, __pyx_k_chess960, sizeof(__pyx_k_chess960), 0, 0, 1, 1},
  {&__pyx_kp_u_chess960_True, __pyx_k_chess960_True, sizeof(__pyx_k_chess960_True), 0, 1, 0, 0},
  {&__pyx_n_s_chess960_pos, __pyx_k_chess960_pos, sizeof(__pyx_k_chess960_pos), 0, 0, 1, 1},
  {&__pyx_kp_u_chess960_position_index_not_0_95, __pyx_k_chess960_position_index_not_0_95, sizeof(__pyx_k_chess960_position_index_not_0_95), 0, 1, 0, 0},
  {&__pyx_n_s_chess___init__cp, __pyx_k_chess___init__cp, sizeof(__pyx_k_chess___init__cp), 0, 0, 1, 1},
  {&__pyx_kp_s_chess___init__cp_pyx, __pyx_k_chess___init__cp_pyx, sizeof(__pyx_k_chess___init__cp_pyx), 0, 0, 1, 0},
  {&__pyx_n_s_chess_svg, __pyx_k_chess_svg, sizeof(__pyx_k_chess_svg), 0, 0, 1, 1},
  {&__pyx_n_s_claim_draw, __pyx_k_claim_draw, sizeof(__pyx_k_claim_draw), 0, 0, 1, 1},
  {&__pyx_n_s_clean_castling_rights, __pyx_k_clean_castling_rights, sizeof(__pyx_k_clean_castling_rights), 0, 0, 1, 1},
  {&__pyx_n_s_clear, __pyx_k_clear, sizeof(__pyx_k_clear), 0, 0, 1, 1},
  {&__pyx_n_s_clear_board, __pyx_k_clear_board, sizeof(__pyx_k_clear_board), 0, 0, 1, 1},
  {&__pyx_n_s_clear_board_2, __pyx_k_clear_board_2, sizeof(__pyx_k_clear_board_2), 0, 0, 1, 1},
  {&__pyx_n_s_clear_stack, __pyx_k_clear_stack, sizeof(__pyx_k_clear_stack), 0, 0, 1, 1},
  {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
  {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
  {&__pyx_n_s_cls, __pyx_k_cls, sizeof(__pyx_k_cls), 0, 0, 1, 1},
  {&__pyx_n_s_collections, __pyx_k_collections, sizeof(__pyx_k_collections), 0, 0, 1, 1},
  {&__pyx_n_s_collections_abc, __pyx_k_collections_abc, sizeof(__pyx_k_collections_abc), 0, 0, 1, 1},
  {&__pyx_n_s_color, __pyx_k_color, sizeof(__pyx_k_color), 0, 0, 1, 1},
  {&__pyx_n_s_compile, __pyx_k_compile, sizeof(__pyx_k_compile), 0, 0, 1, 1},
  {&__pyx_n_s_connected_kings, __pyx_k_connected_kings, sizeof(__pyx_k_connected_kings), 0, 0, 1, 1},
  {&__pyx_n_s_contains, __pyx_k_contains, sizeof(__pyx_k_contains), 0, 0, 1, 1},
  {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
  {&__pyx_n_s_copy_2, __pyx_k_copy_2, sizeof(__pyx_k_copy_2), 0, 0, 1, 1},
  {&__pyx_n_s_count, __pyx_k_count, sizeof(__pyx_k_count), 0, 0, 1, 1},
  {&__pyx_n_u_d, __pyx_k_d, sizeof(__pyx_k_d), 0, 1, 0, 1},
  {&__pyx_n_s_deepcopy, __pyx_k_deepcopy, sizeof(__pyx_k_deepcopy), 0, 0, 1, 1},
  {&__pyx_n_s_delta, __pyx_k_delta, sizeof(__pyx_k_delta), 0, 0, 1, 1},
  {&__pyx_n_s_deltas, __pyx_k_deltas, sizeof(__pyx_k_deltas), 0, 0, 1, 1},
  {&__pyx_n_s_dict, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
  {&__pyx_n_s_difference, __pyx_k_difference, sizeof(__pyx_k_difference), 0, 0, 1, 1},
  {&__pyx_n_s_difference_update, __pyx_k_difference_update, sizeof(__pyx_k_difference_update), 0, 0, 1, 1},
  {&__pyx_n_s_discard, __pyx_k_discard, sizeof(__pyx_k_discard), 0, 0, 1, 1},
  {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
  {&__pyx_n_s_drop, __pyx_k_drop, sizeof(__pyx_k_drop), 0, 0, 1, 1},
  {&__pyx_n_u_e, __pyx_k_e, sizeof(__pyx_k_e), 0, 1, 0, 1},
  {&__pyx_n_s_edges, __pyx_k_edges, sizeof(__pyx_k_edges), 0, 0, 1, 1},
  {&__pyx_n_s_empty, __pyx_k_empty, sizeof(__pyx_k_empty), 0, 0, 1, 1},
  {&__pyx_n_s_en_passant, __pyx_k_en_passant, sizeof(__pyx_k_en_passant), 0, 0, 1, 1},
  {&__pyx_n_s_enum, __pyx_k_enum, sizeof(__pyx_k_enum), 0, 0, 1, 1},
  {&__pyx_n_s_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 0, 0, 1, 1},
  {&__pyx_n_s_ep_skewered, __pyx_k_ep_skewered, sizeof(__pyx_k_ep_skewered), 0, 0, 1, 1},
  {&__pyx_n_s_ep_square, __pyx_k_ep_square, sizeof(__pyx_k_ep_square), 0, 0, 1, 1},
  {&__pyx_n_s_epd, __pyx_k_epd, sizeof(__pyx_k_epd), 0, 0, 1, 1},
  {&__pyx_n_s_epd_operations, __pyx_k_epd_operations, sizeof(__pyx_k_epd_operations), 0, 0, 1, 1},
  {&__pyx_kp_u_epd_should_consist_of_at_least_4, __pyx_k_epd_should_consist_of_at_least_4, sizeof(__pyx_k_epd_should_consist_of_at_least_4), 0, 1, 0, 0},
  {&__pyx_n_s_eq, __pyx_k_eq, sizeof(__pyx_k_eq), 0, 0, 1, 1},
  {&__pyx_kp_u_expected_8_columns_per_row_in_po, __pyx_k_expected_8_columns_per_row_in_po, sizeof(__pyx_k_expected_8_columns_per_row_in_po), 0, 1, 0, 0},
  {&__pyx_kp_u_expected_8_rows_in_position_part, __pyx_k_expected_8_rows_in_position_part, sizeof(__pyx_k_expected_8_rows_in_position_part), 0, 1, 0, 0},
  {&__pyx_kp_u_expected_position_part_of_fen_go, __pyx_k_expected_position_part_of_fen_go, sizeof(__pyx_k_expected_position_part_of_fen_go), 0, 1, 0, 0},
  {&__pyx_kp_u_expected_uci_string_to_be_of_len, __pyx_k_expected_uci_string_to_be_of_len, sizeof(__pyx_k_expected_uci_string_to_be_of_len), 0, 1, 0, 0},
  {&__pyx_kp_u_expected_w_or_b_for_turn_part_of, __pyx_k_expected_w_or_b_for_turn_part_of, sizeof(__pyx_k_expected_w_or_b_for_turn_part_of), 0, 1, 0, 0},
  {&__pyx_n_u_f, __pyx_k_f, sizeof(__pyx_k_f), 0, 1, 0, 1},
  {&__pyx_kp_b_f_2, __pyx_k_f_2, sizeof(__pyx_k_f_2), 0, 0, 0, 0},
  {&__pyx_n_s_fen, __pyx_k_fen, sizeof(__pyx_k_fen), 0, 0, 1, 1},
  {&__pyx_n_u_fen, __pyx_k_fen, sizeof(__pyx_k_fen), 0, 1, 0, 1},
  {&__pyx_kp_u_fen_string_should_consist_of_6_p, __pyx_k_fen_string_should_consist_of_6_p, sizeof(__pyx_k_fen_string_should_consist_of_6_p), 0, 1, 0, 0},
  {&__pyx_n_s_file_index, __pyx_k_file_index, sizeof(__pyx_k_file_index), 0, 0, 1, 1},
  {&__pyx_n_s_flip_anti_diagonal, __pyx_k_flip_anti_diagonal, sizeof(__pyx_k_flip_anti_diagonal), 0, 0, 1, 1},
  {&__pyx_n_s_flip_diagonal, __pyx_k_flip_diagonal, sizeof(__pyx_k_flip_diagonal), 0, 0, 1, 1},
  {&__pyx_n_s_flip_horizontal, __pyx_k_flip_horizontal, sizeof(__pyx_k_flip_horizontal), 0, 0, 1, 1},
  {&__pyx_n_s_flip_vertical, __pyx_k_flip_vertical, sizeof(__pyx_k_flip_vertical), 0, 0, 1, 1},
  {&__pyx_n_u_fmvn, __pyx_k_fmvn, sizeof(__pyx_k_fmvn), 0, 1, 0, 1},
  {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
  {&__pyx_n_s_from_chess960, __pyx_k_from_chess960, sizeof(__pyx_k_from_chess960), 0, 0, 1, 1},
  {&__pyx_n_s_from_chess960_pos, __pyx_k_from_chess960_pos, sizeof(__pyx_k_from_chess960_pos), 0, 0, 1, 1},
  {&__pyx_n_s_from_epd, __pyx_k_from_epd, sizeof(__pyx_k_from_epd), 0, 0, 1, 1},
  {&__pyx_n_s_from_mask, __pyx_k_from_mask, sizeof(__pyx_k_from_mask), 0, 0, 1, 1},
  {&__pyx_n_s_from_square, __pyx_k_from_square, sizeof(__pyx_k_from_square), 0, 0, 1, 1},
  {&__pyx_n_u_from_square, __pyx_k_from_square, sizeof(__pyx_k_from_square), 0, 1, 0, 1},
  {&__pyx_n_s_from_symbol, __pyx_k_from_symbol, sizeof(__pyx_k_from_symbol), 0, 0, 1, 1},
  {&__pyx_n_s_from_uci, __pyx_k_from_uci, sizeof(__pyx_k_from_uci), 0, 0, 1, 1},
  {&__pyx_kp_u_full_move_number_must_be_positiv, __pyx_k_full_move_number_must_be_positiv, sizeof(__pyx_k_full_move_number_must_be_positiv), 0, 1, 0, 0},
  {&__pyx_n_s_fullmove_number, __pyx_k_fullmove_number, sizeof(__pyx_k_fullmove_number), 0, 0, 1, 1},
  {&__pyx_n_u_g, __pyx_k_g, sizeof(__pyx_k_g), 0, 1, 0, 1},
  {&__pyx_n_s_generate_castling_moves, __pyx_k_generate_castling_moves, sizeof(__pyx_k_generate_castling_moves), 0, 0, 1, 1},
  {&__pyx_n_s_generate_evasions, __pyx_k_generate_evasions, sizeof(__pyx_k_generate_evasions), 0, 0, 1, 1},
  {&__pyx_n_s_generate_legal_ep, __pyx_k_generate_legal_ep, sizeof(__pyx_k_generate_legal_ep), 0, 0, 1, 1},
  {&__pyx_n_s_generate_legal_moves, __pyx_k_generate_legal_moves, sizeof(__pyx_k_generate_legal_moves), 0, 0, 1, 1},
  {&__pyx_n_s_generate_pseudo_legal_ep, __pyx_k_generate_pseudo_legal_ep, sizeof(__pyx_k_generate_pseudo_legal_ep), 0, 0, 1, 1},
  {&__pyx_n_s_generate_pseudo_legal_moves, __pyx_k_generate_pseudo_legal_moves, sizeof(__pyx_k_generate_pseudo_legal_moves), 0, 0, 1, 1},
  {&__pyx_n_s_genexpr, __pyx_k_genexpr, sizeof(__pyx_k_genexpr), 0, 0, 1, 1},
  {&__pyx_n_s_getstate, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
  {&__pyx_n_s_group, __pyx_k_group, sizeof(__pyx_k_group), 0, 0, 1, 1},
  {&__pyx_n_u_h, __pyx_k_h, sizeof(__pyx_k_h), 0, 1, 0, 1},
  {&__pyx_kp_u_half_move_clock_can_not_be_negat, __pyx_k_half_move_clock_can_not_be_negat, sizeof(__pyx_k_half_move_clock_can_not_be_negat), 0, 1, 0, 0},
  {&__pyx_n_s_halfmove_clock, __pyx_k_halfmove_clock, sizeof(__pyx_k_halfmove_clock), 0, 0, 1, 1},
  {&__pyx_n_s_has_legal_en_passant, __pyx_k_has_legal_en_passant, sizeof(__pyx_k_has_legal_en_passant), 0, 0, 1, 1},
  {&__pyx_n_s_has_pseudo_legal_en_passant, __pyx_k_has_pseudo_legal_en_passant, sizeof(__pyx_k_has_pseudo_legal_en_passant), 0, 0, 1, 1},
  {&__pyx_n_s_hash, __pyx_k_hash, sizeof(__pyx_k_hash), 0, 0, 1, 1},
  {&__pyx_n_s_hex, __pyx_k_hex, sizeof(__pyx_k_hex), 0, 0, 1, 1},
  {&__pyx_n_u_hmvc, __pyx_k_hmvc, sizeof(__pyx_k_hmvc), 0, 1, 0, 1},
  {&__pyx_n_s_iand, __pyx_k_iand, sizeof(__pyx_k_iand), 0, 0, 1, 1},
  {&__pyx_n_s_id, __pyx_k_id, sizeof(__pyx_k_id), 0, 0, 1, 1},
  {&__pyx_n_s_ignore_castling, __pyx_k_ignore_castling, sizeof(__pyx_k_ignore_castling), 0, 0, 1, 1},
  {&__pyx_n_s_ignore_counters, __pyx_k_ignore_counters, sizeof(__pyx_k_ignore_counters), 0, 0, 1, 1},
  {&__pyx_n_s_ignore_turn, __pyx_k_ignore_turn, sizeof(__pyx_k_ignore_turn), 0, 0, 1, 1},
  {&__pyx_kp_u_illegal_move_in_position, __pyx_k_illegal_move_in_position, sizeof(__pyx_k_illegal_move_in_position), 0, 1, 0, 0},
  {&__pyx_kp_u_illegal_san_in, __pyx_k_illegal_san_in, sizeof(__pyx_k_illegal_san_in), 0, 1, 0, 0},
  {&__pyx_kp_u_illegal_uci_in, __pyx_k_illegal_uci_in, sizeof(__pyx_k_illegal_uci_in), 0, 1, 0, 0},
  {&__pyx_n_s_ilshift, __pyx_k_ilshift, sizeof(__pyx_k_ilshift), 0, 0, 1, 1},
  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
  {&__pyx_n_s_index, __pyx_k_index, sizeof(__pyx_k_index), 0, 0, 1, 1},
  {&__pyx_n_s_index_2, __pyx_k_index_2, sizeof(__pyx_k_index_2), 0, 0, 1, 1},
  {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
  {&__pyx_n_s_int, __pyx_k_int, sizeof(__pyx_k_int), 0, 0, 1, 1},
  {&__pyx_n_s_intersection, __pyx_k_intersection, sizeof(__pyx_k_intersection), 0, 0, 1, 1},
  {&__pyx_n_s_intersection_update, __pyx_k_intersection_update, sizeof(__pyx_k_intersection_update), 0, 0, 1, 1},
  {&__pyx_kp_u_invalid_castling_fen, __pyx_k_invalid_castling_fen, sizeof(__pyx_k_invalid_castling_fen), 0, 1, 0, 0},
  {&__pyx_kp_u_invalid_castling_part_in_fen, __pyx_k_invalid_castling_part_in_fen, sizeof(__pyx_k_invalid_castling_part_in_fen), 0, 1, 0, 0},
  {&__pyx_kp_u_invalid_character_in_position_pa, __pyx_k_invalid_character_in_position_pa, sizeof(__pyx_k_invalid_character_in_position_pa), 0, 1, 0, 0},
  {&__pyx_kp_u_invalid_en_passant_part_in_fen, __pyx_k_invalid_en_passant_part_in_fen, sizeof(__pyx_k_invalid_en_passant_part_in_fen), 0, 1, 0, 0},
  {&__pyx_kp_u_invalid_san, __pyx_k_invalid_san, sizeof(__pyx_k_invalid_san), 0, 1, 0, 0},
  {&__pyx_n_s_invert, __pyx_k_invert, sizeof(__pyx_k_invert), 0, 0, 1, 1},
  {&__pyx_n_s_invert_color, __pyx_k_invert_color, sizeof(__pyx_k_invert_color), 0, 0, 1, 1},
  {&__pyx_n_s_ior, __pyx_k_ior, sizeof(__pyx_k_ior), 0, 0, 1, 1},
  {&__pyx_n_s_irshift, __pyx_k_irshift, sizeof(__pyx_k_irshift), 0, 0, 1, 1},
  {&__pyx_n_s_is_attacked_by, __pyx_k_is_attacked_by, sizeof(__pyx_k_is_attacked_by), 0, 0, 1, 1},
  {&__pyx_n_s_is_capture, __pyx_k_is_capture, sizeof(__pyx_k_is_capture), 0, 0, 1, 1},
  {&__pyx_n_s_is_castling, __pyx_k_is_castling, sizeof(__pyx_k_is_castling), 0, 0, 1, 1},
  {&__pyx_n_s_is_check, __pyx_k_is_check, sizeof(__pyx_k_is_check), 0, 0, 1, 1},
  {&__pyx_n_s_is_checkmate, __pyx_k_is_checkmate, sizeof(__pyx_k_is_checkmate), 0, 0, 1, 1},
  {&__pyx_n_s_is_en_passant, __pyx_k_is_en_passant, sizeof(__pyx_k_is_en_passant), 0, 0, 1, 1},
  {&__pyx_n_s_is_fivefold_repetition, __pyx_k_is_fivefold_repetition, sizeof(__pyx_k_is_fivefold_repetition), 0, 0, 1, 1},
  {&__pyx_n_s_is_insufficient_material, __pyx_k_is_insufficient_material, sizeof(__pyx_k_is_insufficient_material), 0, 0, 1, 1},
  {&__pyx_n_s_is_into_check, __pyx_k_is_into_check, sizeof(__pyx_k_is_into_check), 0, 0, 1, 1},
  {&__pyx_n_s_is_irreversible, __pyx_k_is_irreversible, sizeof(__pyx_k_is_irreversible), 0, 0, 1, 1},
  {&__pyx_n_s_is_kingside_castling, __pyx_k_is_kingside_castling, sizeof(__pyx_k_is_kingside_castling), 0, 0, 1, 1},
  {&__pyx_n_s_is_legal, __pyx_k_is_legal, sizeof(__pyx_k_is_legal), 0, 0, 1, 1},
  {&__pyx_n_s_is_pseudo_legal, __pyx_k_is_pseudo_legal, sizeof(__pyx_k_is_pseudo_legal), 0, 0, 1, 1},
  {&__pyx_n_s_is_queenside_castling, __pyx_k_is_queenside_castling, sizeof(__pyx_k_is_queenside_castling), 0, 0, 1, 1},
  {&__pyx_n_s_is_safe, __pyx_k_is_safe, sizeof(__pyx_k_is_safe), 0, 0, 1, 1},
  {&__pyx_n_s_is_seventyfive_moves, __pyx_k_is_seventyfive_moves, sizeof(__pyx_k_is_seventyfive_moves), 0, 0, 1, 1},
  {&__pyx_n_s_is_variant_draw, __pyx_k_is_variant_draw, sizeof(__pyx_k_is_variant_draw), 0, 0, 1, 1},
  {&__pyx_n_s_is_variant_end, __pyx_k_is_variant_end, sizeof(__pyx_k_is_variant_end), 0, 0, 1, 1},
  {&__pyx_n_s_is_variant_loss, __pyx_k_is_variant_loss, sizeof(__pyx_k_is_variant_loss), 0, 0, 1, 1},
  {&__pyx_n_s_is_variant_win, __pyx_k_is_variant_win, sizeof(__pyx_k_is_variant_win), 0, 0, 1, 1},
  {&__pyx_n_s_is_zeroing, __pyx_k_is_zeroing, sizeof(__pyx_k_is_zeroing), 0, 0, 1, 1},
  {&__pyx_n_s_isdisjoint, __pyx_k_isdisjoint, sizeof(__pyx_k_isdisjoint), 0, 0, 1, 1},
  {&__pyx_n_s_islower, __pyx_k_islower, sizeof(__pyx_k_islower), 0, 0, 1, 1},
  {&__pyx_n_s_issubset, __pyx_k_issubset, sizeof(__pyx_k_issubset), 0, 0, 1, 1},
  {&__pyx_n_s_issuperset, __pyx_k_issuperset, sizeof(__pyx_k_issuperset), 0, 0, 1, 1},
  {&__pyx_n_s_isub, __pyx_k_isub, sizeof(__pyx_k_isub), 0, 0, 1, 1},
  {&__pyx_n_s_isupper, __pyx_k_isupper, sizeof(__pyx_k_isupper), 0, 0, 1, 1},
  {&__pyx_n_s_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
  {&__pyx_n_s_iter, __pyx_k_iter, sizeof(__pyx_k_iter), 0, 0, 1, 1},
  {&__pyx_n_u_iter, __pyx_k_iter, sizeof(__pyx_k_iter), 0, 1, 0, 1},
  {&__pyx_n_s_itertools, __pyx_k_itertools, sizeof(__pyx_k_itertools), 0, 0, 1, 1},
  {&__pyx_n_s_ixor, __pyx_k_ixor, sizeof(__pyx_k_ixor), 0, 0, 1, 1},
  {&__pyx_n_u_k, __pyx_k_k, sizeof(__pyx_k_k), 0, 1, 0, 1},
  {&__pyx_n_s_king, __pyx_k_king, sizeof(__pyx_k_king), 0, 0, 1, 1},
  {&__pyx_n_u_king, __pyx_k_king, sizeof(__pyx_k_king), 0, 1, 0, 1},
  {&__pyx_n_s_king_to, __pyx_k_king_to, sizeof(__pyx_k_king_to), 0, 0, 1, 1},
  {&__pyx_n_s_kings, __pyx_k_kings, sizeof(__pyx_k_kings), 0, 0, 1, 1},
  {&__pyx_n_u_knight, __pyx_k_knight, sizeof(__pyx_k_knight), 0, 1, 0, 1},
  {&__pyx_n_s_knights, __pyx_k_knights, sizeof(__pyx_k_knights), 0, 0, 1, 1},
  {&__pyx_n_s_l, __pyx_k_l, sizeof(__pyx_k_l), 0, 0, 1, 1},
  {&__pyx_n_s_lastmove, __pyx_k_lastmove, sizeof(__pyx_k_lastmove), 0, 0, 1, 1},
  {&__pyx_n_u_legal, __pyx_k_legal, sizeof(__pyx_k_legal), 0, 1, 0, 1},
  {&__pyx_n_s_len, __pyx_k_len, sizeof(__pyx_k_len), 0, 0, 1, 1},
  {&__pyx_n_s_long_notation, __pyx_k_long_notation, sizeof(__pyx_k_long_notation), 0, 0, 1, 1},
  {&__pyx_n_s_lower, __pyx_k_lower, sizeof(__pyx_k_lower), 0, 0, 1, 1},
  {&__pyx_n_s_lsb, __pyx_k_lsb, sizeof(__pyx_k_lsb), 0, 0, 1, 1},
  {&__pyx_n_s_lshift, __pyx_k_lshift, sizeof(__pyx_k_lshift), 0, 0, 1, 1},
  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
  {&__pyx_n_s_make_board, __pyx_k_make_board, sizeof(__pyx_k_make_board), 0, 0, 1, 1},
  {&__pyx_n_s_mask, __pyx_k_mask, sizeof(__pyx_k_mask), 0, 0, 1, 1},
  {&__pyx_n_s_mask_table, __pyx_k_mask_table, sizeof(__pyx_k_mask_table), 0, 0, 1, 1},
  {&__pyx_n_s_match, __pyx_k_match, sizeof(__pyx_k_match), 0, 0, 1, 1},
  {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
  {&__pyx_n_s_mirror, __pyx_k_mirror, sizeof(__pyx_k_mirror), 0, 0, 1, 1},
  {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
  {&__pyx_n_s_move, __pyx_k_move, sizeof(__pyx_k_move), 0, 0, 1, 1},
  {&__pyx_n_s_move_stack, __pyx_k_move_stack, sizeof(__pyx_k_move_stack), 0, 0, 1, 1},
  {&__pyx_n_s_msb, __pyx_k_msb, sizeof(__pyx_k_msb), 0, 0, 1, 1},
  {&__pyx_n_u_n, __pyx_k_n, sizeof(__pyx_k_n), 0, 1, 0, 1},
  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
  {&__pyx_n_s_ne, __pyx_k_ne, sizeof(__pyx_k_ne), 0, 0, 1, 1},
  {&__pyx_n_s_ne_2, __pyx_k_ne_2, sizeof(__pyx_k_ne_2), 0, 0, 1, 1},
  {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
  {&__pyx_kp_u_not_after_piece_in_position_par, __pyx_k_not_after_piece_in_position_par, sizeof(__pyx_k_not_after_piece_in_position_par), 0, 1, 0, 0},
  {&__pyx_n_s_null, __pyx_k_null, sizeof(__pyx_k_null), 0, 0, 1, 1},
  {&__pyx_n_u_numeric, __pyx_k_numeric, sizeof(__pyx_k_numeric), 0, 1, 0, 1},
  {&__pyx_n_s_occupied, __pyx_k_occupied, sizeof(__pyx_k_occupied), 0, 0, 1, 1},
  {&__pyx_n_s_occupied_b, __pyx_k_occupied_b, sizeof(__pyx_k_occupied_b), 0, 0, 1, 1},
  {&__pyx_n_s_occupied_co, __pyx_k_occupied_co, sizeof(__pyx_k_occupied_co), 0, 0, 1, 1},
  {&__pyx_n_s_occupied_w, __pyx_k_occupied_w, sizeof(__pyx_k_occupied_w), 0, 0, 1, 1},
  {&__pyx_n_s_one_king, __pyx_k_one_king, sizeof(__pyx_k_one_king), 0, 0, 1, 1},
  {&__pyx_n_u_opcode, __pyx_k_opcode, sizeof(__pyx_k_opcode), 0, 1, 0, 1},
  {&__pyx_n_s_operation_part, __pyx_k_operation_part, sizeof(__pyx_k_operation_part), 0, 0, 1, 1},
  {&__pyx_n_s_or, __pyx_k_or, sizeof(__pyx_k_or), 0, 0, 1, 1},
  {&__pyx_n_s_other, __pyx_k_other, sizeof(__pyx_k_other), 0, 0, 1, 1},
  {&__pyx_n_s_others, __pyx_k_others, sizeof(__pyx_k_others), 0, 0, 1, 1},
  {&__pyx_n_u_p, __pyx_k_p, sizeof(__pyx_k_p), 0, 1, 0, 1},
  {&__pyx_n_s_parse_epd_ops, __pyx_k_parse_epd_ops, sizeof(__pyx_k_parse_epd_ops), 0, 0, 1, 1},
  {&__pyx_n_s_parse_san, __pyx_k_parse_san, sizeof(__pyx_k_parse_san), 0, 0, 1, 1},
  {&__pyx_n_s_parse_san_locals_genexpr, __pyx_k_parse_san_locals_genexpr, sizeof(__pyx_k_parse_san_locals_genexpr), 0, 0, 1, 1},
  {&__pyx_n_s_parse_uci, __pyx_k_parse_uci, sizeof(__pyx_k_parse_uci), 0, 0, 1, 1},
  {&__pyx_n_s_path, __pyx_k_path, sizeof(__pyx_k_path), 0, 0, 1, 1},
  {&__pyx_n_u_pawn, __pyx_k_pawn, sizeof(__pyx_k_pawn), 0, 1, 0, 1},
  {&__pyx_n_s_pawnless_tbw_magic, __pyx_k_pawnless_tbw_magic, sizeof(__pyx_k_pawnless_tbw_magic), 0, 0, 1, 1},
  {&__pyx_n_s_pawnless_tbw_suffix, __pyx_k_pawnless_tbw_suffix, sizeof(__pyx_k_pawnless_tbw_suffix), 0, 0, 1, 1},
  {&__pyx_n_s_pawnless_tbz_magic, __pyx_k_pawnless_tbz_magic, sizeof(__pyx_k_pawnless_tbz_magic), 0, 0, 1, 1},
  {&__pyx_n_s_pawnless_tbz_suffix, __pyx_k_pawnless_tbz_suffix, sizeof(__pyx_k_pawnless_tbz_suffix), 0, 0, 1, 1},
  {&__pyx_n_s_pawns, __pyx_k_pawns, sizeof(__pyx_k_pawns), 0, 0, 1, 1},
  {&__pyx_n_s_peek, __pyx_k_peek, sizeof(__pyx_k_peek), 0, 0, 1, 1},
  {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
  {&__pyx_n_s_piece, __pyx_k_piece, sizeof(__pyx_k_piece), 0, 0, 1, 1},
  {&__pyx_n_s_piece_at, __pyx_k_piece_at, sizeof(__pyx_k_piece_at), 0, 0, 1, 1},
  {&__pyx_n_s_piece_type, __pyx_k_piece_type, sizeof(__pyx_k_piece_type), 0, 0, 1, 1},
  {&__pyx_n_s_piece_type_at, __pyx_k_piece_type_at, sizeof(__pyx_k_piece_type_at), 0, 0, 1, 1},
  {&__pyx_n_s_pieces_mask, __pyx_k_pieces_mask, sizeof(__pyx_k_pieces_mask), 0, 0, 1, 1},
  {&__pyx_n_s_pin_mask, __pyx_k_pin_mask, sizeof(__pyx_k_pin_mask), 0, 0, 1, 1},
  {&__pyx_n_s_pop, __pyx_k_pop, sizeof(__pyx_k_pop), 0, 0, 1, 1},
  {&__pyx_kp_u_pop_from_empty_SquareSet, __pyx_k_pop_from_empty_SquareSet, sizeof(__pyx_k_pop_from_empty_SquareSet), 0, 1, 0, 0},
  {&__pyx_n_s_popcount, __pyx_k_popcount, sizeof(__pyx_k_popcount), 0, 0, 1, 1},
  {&__pyx_n_s_prepare, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
  {&__pyx_n_s_print, __pyx_k_print, sizeof(__pyx_k_print), 0, 0, 1, 1},
  {&__pyx_n_s_promoted, __pyx_k_promoted, sizeof(__pyx_k_promoted), 0, 0, 1, 1},
  {&__pyx_n_s_promotion, __pyx_k_promotion, sizeof(__pyx_k_promotion), 0, 0, 1, 1},
  {&__pyx_n_u_promotion, __pyx_k_promotion, sizeof(__pyx_k_promotion), 0, 1, 0, 1},
  {&__pyx_n_s_push, __pyx_k_push, sizeof(__pyx_k_push), 0, 0, 1, 1},
  {&__pyx_n_s_push_capture, __pyx_k_push_capture, sizeof(__pyx_k_push_capture), 0, 0, 1, 1},
  {&__pyx_n_u_pv, __pyx_k_pv, sizeof(__pyx_k_pv), 0, 1, 0, 1},
  {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_checksum, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_state, __pyx_k_pyx_state, sizeof(__pyx_k_pyx_state), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_type, __pyx_k_pyx_type, sizeof(__pyx_k_pyx_type), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_unpickle_BaseBoard, __pyx_k_pyx_unpickle_BaseBoard, sizeof(__pyx_k_pyx_unpickle_BaseBoard), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_unpickle_Board, __pyx_k_pyx_unpickle_Board, sizeof(__pyx_k_pyx_unpickle_Board), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_unpickle_LegalMoveGenerato, __pyx_k_pyx_unpickle_LegalMoveGenerato, sizeof(__pyx_k_pyx_unpickle_LegalMoveGenerato), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_unpickle_Move, __pyx_k_pyx_unpickle_Move, sizeof(__pyx_k_pyx_unpickle_Move), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_unpickle_PseudoLegalMoveGe, __pyx_k_pyx_unpickle_PseudoLegalMoveGe, sizeof(__pyx_k_pyx_unpickle_PseudoLegalMoveGe), 0, 0, 1, 1},
  {&__pyx_n_u_q, __pyx_k_q, sizeof(__pyx_k_q), 0, 1, 0, 1},
  {&__pyx_kp_b_q_2, __pyx_k_q_2, sizeof(__pyx_k_q_2), 0, 0, 0, 0},
  {&__pyx_n_s_qualname, __pyx_k_qualname, sizeof(__pyx_k_qualname), 0, 0, 1, 1},
  {&__pyx_n_u_queen, __pyx_k_queen, sizeof(__pyx_k_queen), 0, 1, 0, 1},
  {&__pyx_n_s_queens, __pyx_k_queens, sizeof(__pyx_k_queens), 0, 0, 1, 1},
  {&__pyx_n_s_r, __pyx_k_r, sizeof(__pyx_k_r), 0, 0, 1, 1},
  {&__pyx_n_u_r, __pyx_k_r, sizeof(__pyx_k_r), 0, 1, 0, 1},
  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
  {&__pyx_n_s_rank_index, __pyx_k_rank_index, sizeof(__pyx_k_rank_index), 0, 0, 1, 1},
  {&__pyx_n_s_rays, __pyx_k_rays, sizeof(__pyx_k_rays), 0, 0, 1, 1},
  {&__pyx_n_s_rays_2, __pyx_k_rays_2, sizeof(__pyx_k_rays_2), 0, 0, 1, 1},
  {&__pyx_n_s_rays_row, __pyx_k_rays_row, sizeof(__pyx_k_rays_row), 0, 0, 1, 1},
  {&__pyx_n_s_re, __pyx_k_re, sizeof(__pyx_k_re), 0, 0, 1, 1},
  {&__pyx_n_s_reduce, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
  {&__pyx_n_s_reduce_cython, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
  {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
  {&__pyx_n_s_remove, __pyx_k_remove, sizeof(__pyx_k_remove), 0, 0, 1, 1},
  {&__pyx_n_s_remove_piece_at, __pyx_k_remove_piece_at, sizeof(__pyx_k_remove_piece_at), 0, 0, 1, 1},
  {&__pyx_n_s_remove_piece_at_2, __pyx_k_remove_piece_at_2, sizeof(__pyx_k_remove_piece_at_2), 0, 0, 1, 1},
  {&__pyx_n_s_repr, __pyx_k_repr, sizeof(__pyx_k_repr), 0, 0, 1, 1},
  {&__pyx_n_s_repr___locals_genexpr, __pyx_k_repr___locals_genexpr, sizeof(__pyx_k_repr___locals_genexpr), 0, 0, 1, 1},
  {&__pyx_n_s_repr_svg, __pyx_k_repr_svg, sizeof(__pyx_k_repr_svg), 0, 0, 1, 1},
  {&__pyx_n_s_reset, __pyx_k_reset, sizeof(__pyx_k_reset), 0, 0, 1, 1},
  {&__pyx_n_s_reset_board, __pyx_k_reset_board, sizeof(__pyx_k_reset_board), 0, 0, 1, 1},
  {&__pyx_n_s_reset_board_2, __pyx_k_reset_board_2, sizeof(__pyx_k_reset_board_2), 0, 0, 1, 1},
  {&__pyx_n_s_restore, __pyx_k_restore, sizeof(__pyx_k_restore), 0, 0, 1, 1},
  {&__pyx_n_s_reversed, __pyx_k_reversed, sizeof(__pyx_k_reversed), 0, 0, 1, 1},
  {&__pyx_kp_u_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP, __pyx_k_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP, sizeof(__pyx_k_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP), 0, 1, 0, 0},
  {&__pyx_kp_u_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP_2, __pyx_k_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP_2, sizeof(__pyx_k_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP_2), 0, 1, 0, 0},
  {&__pyx_n_u_rook, __pyx_k_rook, sizeof(__pyx_k_rook), 0, 1, 0, 1},
  {&__pyx_n_s_rook_bb, __pyx_k_rook_bb, sizeof(__pyx_k_rook_bb), 0, 0, 1, 1},
  {&__pyx_n_s_rooks, __pyx_k_rooks, sizeof(__pyx_k_rooks), 0, 0, 1, 1},
  {&__pyx_n_s_rshift, __pyx_k_rshift, sizeof(__pyx_k_rshift), 0, 0, 1, 1},
  {&__pyx_n_s_rstrip, __pyx_k_rstrip, sizeof(__pyx_k_rstrip), 0, 0, 1, 1},
  {&__pyx_kp_u_rtbw, __pyx_k_rtbw, sizeof(__pyx_k_rtbw), 0, 1, 0, 0},
  {&__pyx_kp_u_rtbz, __pyx_k_rtbz, sizeof(__pyx_k_rtbz), 0, 1, 0, 0},
  {&__pyx_n_s_san, __pyx_k_san, sizeof(__pyx_k_san), 0, 0, 1, 1},
  {&__pyx_n_u_san, __pyx_k_san, sizeof(__pyx_k_san), 0, 1, 0, 1},
  {&__pyx_n_s_scan_forward, __pyx_k_scan_forward, sizeof(__pyx_k_scan_forward), 0, 0, 1, 1},
  {&__pyx_n_s_scan_reversed, __pyx_k_scan_reversed, sizeof(__pyx_k_scan_reversed), 0, 0, 1, 1},
  {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
  {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
  {&__pyx_n_s_set_board_fen, __pyx_k_set_board_fen, sizeof(__pyx_k_set_board_fen), 0, 0, 1, 1},
  {&__pyx_n_s_set_board_fen_2, __pyx_k_set_board_fen_2, sizeof(__pyx_k_set_board_fen_2), 0, 0, 1, 1},
  {&__pyx_n_s_set_castling_fen, __pyx_k_set_castling_fen, sizeof(__pyx_k_set_castling_fen), 0, 0, 1, 1},
  {&__pyx_n_s_set_chess960_pos, __pyx_k_set_chess960_pos, sizeof(__pyx_k_set_chess960_pos), 0, 0, 1, 1},
  {&__pyx_n_s_set_chess960_pos_2, __pyx_k_set_chess960_pos_2, sizeof(__pyx_k_set_chess960_pos_2), 0, 0, 1, 1},
  {&__pyx_n_s_set_epd, __pyx_k_set_epd, sizeof(__pyx_k_set_epd), 0, 0, 1, 1},
  {&__pyx_n_s_set_epd_locals_lambda, __pyx_k_set_epd_locals_lambda, sizeof(__pyx_k_set_epd_locals_lambda), 0, 0, 1, 1},
  {&__pyx_n_s_set_fen, __pyx_k_set_fen, sizeof(__pyx_k_set_fen), 0, 0, 1, 1},
  {&__pyx_n_s_set_piece_at, __pyx_k_set_piece_at, sizeof(__pyx_k_set_piece_at), 0, 0, 1, 1},
  {&__pyx_n_s_set_piece_at_2, __pyx_k_set_piece_at_2, sizeof(__pyx_k_set_piece_at_2), 0, 0, 1, 1},
  {&__pyx_n_s_set_piece_map, __pyx_k_set_piece_map, sizeof(__pyx_k_set_piece_map), 0, 0, 1, 1},
  {&__pyx_n_s_set_piece_map_2, __pyx_k_set_piece_map_2, sizeof(__pyx_k_set_piece_map_2), 0, 0, 1, 1},
  {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
  {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
  {&__pyx_n_s_shift, __pyx_k_shift, sizeof(__pyx_k_shift), 0, 0, 1, 1},
  {&__pyx_n_s_shift_2_down, __pyx_k_shift_2_down, sizeof(__pyx_k_shift_2_down), 0, 0, 1, 1},
  {&__pyx_n_s_shift_2_left, __pyx_k_shift_2_left, sizeof(__pyx_k_shift_2_left), 0, 0, 1, 1},
  {&__pyx_n_s_shift_2_right, __pyx_k_shift_2_right, sizeof(__pyx_k_shift_2_right), 0, 0, 1, 1},
  {&__pyx_n_s_shift_2_up, __pyx_k_shift_2_up, sizeof(__pyx_k_shift_2_up), 0, 0, 1, 1},
  {&__pyx_n_s_shift_down, __pyx_k_shift_down, sizeof(__pyx_k_shift_down), 0, 0, 1, 1},
  {&__pyx_n_s_shift_down_left, __pyx_k_shift_down_left, sizeof(__pyx_k_shift_down_left), 0, 0, 1, 1},
  {&__pyx_n_s_shift_down_right, __pyx_k_shift_down_right, sizeof(__pyx_k_shift_down_right), 0, 0, 1, 1},
  {&__pyx_n_s_shift_left, __pyx_k_shift_left, sizeof(__pyx_k_shift_left), 0, 0, 1, 1},
  {&__pyx_n_s_shift_right, __pyx_k_shift_right, sizeof(__pyx_k_shift_right), 0, 0, 1, 1},
  {&__pyx_n_s_shift_up, __pyx_k_shift_up, sizeof(__pyx_k_shift_up), 0, 0, 1, 1},
  {&__pyx_n_s_shift_up_left, __pyx_k_shift_up_left, sizeof(__pyx_k_shift_up_left), 0, 0, 1, 1},
  {&__pyx_n_s_shift_up_right, __pyx_k_shift_up_right, sizeof(__pyx_k_shift_up_right), 0, 0, 1, 1},
  {&__pyx_n_s_shredder, __pyx_k_shredder, sizeof(__pyx_k_shredder), 0, 0, 1, 1},
  {&__pyx_n_s_shredder_fen, __pyx_k_shredder_fen, sizeof(__pyx_k_shredder_fen), 0, 0, 1, 1},
  {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
  {&__pyx_n_s_slider_blockers, __pyx_k_slider_blockers, sizeof(__pyx_k_slider_blockers), 0, 0, 1, 1},
  {&__pyx_n_s_sliding_attacks, __pyx_k_sliding_attacks, sizeof(__pyx_k_sliding_attacks), 0, 0, 1, 1},
  {&__pyx_n_s_split, __pyx_k_split, sizeof(__pyx_k_split), 0, 0, 1, 1},
  {&__pyx_n_s_sq, __pyx_k_sq, sizeof(__pyx_k_sq), 0, 0, 1, 1},
  {&__pyx_n_s_square, __pyx_k_square, sizeof(__pyx_k_square), 0, 0, 1, 1},
  {&__pyx_n_s_square_distance, __pyx_k_square_distance, sizeof(__pyx_k_square_distance), 0, 0, 1, 1},
  {&__pyx_n_s_square_file, __pyx_k_square_file, sizeof(__pyx_k_square_file), 0, 0, 1, 1},
  {&__pyx_n_s_square_mirror, __pyx_k_square_mirror, sizeof(__pyx_k_square_mirror), 0, 0, 1, 1},
  {&__pyx_n_s_square_name, __pyx_k_square_name, sizeof(__pyx_k_square_name), 0, 0, 1, 1},
  {&__pyx_n_s_square_rank, __pyx_k_square_rank, sizeof(__pyx_k_square_rank), 0, 0, 1, 1},
  {&__pyx_n_s_squares, __pyx_k_squares, sizeof(__pyx_k_squares), 0, 0, 1, 1},
  {&__pyx_n_s_stack, __pyx_k_stack, sizeof(__pyx_k_stack), 0, 0, 1, 1},
  {&__pyx_n_s_starting_fen, __pyx_k_starting_fen, sizeof(__pyx_k_starting_fen), 0, 0, 1, 1},
  {&__pyx_n_s_status, __pyx_k_status, sizeof(__pyx_k_status), 0, 0, 1, 1},
  {&__pyx_n_s_step_attacks, __pyx_k_step_attacks, sizeof(__pyx_k_step_attacks), 0, 0, 1, 1},
  {&__pyx_n_s_str, __pyx_k_str, sizeof(__pyx_k_str), 0, 0, 1, 1},
  {&__pyx_n_u_string, __pyx_k_string, sizeof(__pyx_k_string), 0, 1, 0, 1},
  {&__pyx_n_u_string_escape, __pyx_k_string_escape, sizeof(__pyx_k_string_escape), 0, 1, 0, 1},
  {&__pyx_kp_s_stringsource, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
  {&__pyx_n_s_strip, __pyx_k_strip, sizeof(__pyx_k_strip), 0, 0, 1, 1},
  {&__pyx_n_s_sub, __pyx_k_sub, sizeof(__pyx_k_sub), 0, 0, 1, 1},
  {&__pyx_n_s_subset, __pyx_k_subset, sizeof(__pyx_k_subset), 0, 0, 1, 1},
  {&__pyx_n_s_super, __pyx_k_super, sizeof(__pyx_k_super), 0, 0, 1, 1},
  {&__pyx_n_s_svg, __pyx_k_svg, sizeof(__pyx_k_svg), 0, 0, 1, 1},
  {&__pyx_n_s_swapcase, __pyx_k_swapcase, sizeof(__pyx_k_swapcase), 0, 0, 1, 1},
  {&__pyx_n_s_symbol, __pyx_k_symbol, sizeof(__pyx_k_symbol), 0, 0, 1, 1},
  {&__pyx_n_s_symmetric_difference, __pyx_k_symmetric_difference, sizeof(__pyx_k_symmetric_difference), 0, 0, 1, 1},
  {&__pyx_n_s_symmetric_difference_update, __pyx_k_symmetric_difference_update, sizeof(__pyx_k_symmetric_difference_update), 0, 0, 1, 1},
  {&__pyx_n_s_t, __pyx_k_t, sizeof(__pyx_k_t), 0, 0, 1, 1},
  {&__pyx_n_s_tbw_magic, __pyx_k_tbw_magic, sizeof(__pyx_k_tbw_magic), 0, 0, 1, 1},
  {&__pyx_n_s_tbw_suffix, __pyx_k_tbw_suffix, sizeof(__pyx_k_tbw_suffix), 0, 0, 1, 1},
  {&__pyx_n_s_tbz_magic, __pyx_k_tbz_magic, sizeof(__pyx_k_tbz_magic), 0, 0, 1, 1},
  {&__pyx_n_s_tbz_suffix, __pyx_k_tbz_suffix, sizeof(__pyx_k_tbz_suffix), 0, 0, 1, 1},
  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
  {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
  {&__pyx_n_s_to_chess960, __pyx_k_to_chess960, sizeof(__pyx_k_to_chess960), 0, 0, 1, 1},
  {&__pyx_n_s_to_mask, __pyx_k_to_mask, sizeof(__pyx_k_to_mask), 0, 0, 1, 1},
  {&__pyx_n_s_to_square, __pyx_k_to_square, sizeof(__pyx_k_to_square), 0, 0, 1, 1},
  {&__pyx_n_u_to_square, __pyx_k_to_square, sizeof(__pyx_k_to_square), 0, 1, 0, 1},
  {&__pyx_n_s_tolist, __pyx_k_tolist, sizeof(__pyx_k_tolist), 0, 0, 1, 1},
  {&__pyx_n_s_transform, __pyx_k_transform, sizeof(__pyx_k_transform), 0, 0, 1, 1},
  {&__pyx_n_s_transposition_key, __pyx_k_transposition_key, sizeof(__pyx_k_transposition_key), 0, 0, 1, 1},
  {&__pyx_n_s_turn, __pyx_k_turn, sizeof(__pyx_k_turn), 0, 0, 1, 1},
  {&__pyx_kp_u_two_subsequent_digits_in_positio, __pyx_k_two_subsequent_digits_in_positio, sizeof(__pyx_k_two_subsequent_digits_in_positio), 0, 1, 0, 0},
  {&__pyx_n_s_uci, __pyx_k_uci, sizeof(__pyx_k_uci), 0, 0, 1, 1},
  {&__pyx_n_s_uci_variant, __pyx_k_uci_variant, sizeof(__pyx_k_uci_variant), 0, 0, 1, 1},
  {&__pyx_n_s_unicode_symbol, __pyx_k_unicode_symbol, sizeof(__pyx_k_unicode_symbol), 0, 0, 1, 1},
  {&__pyx_n_s_union, __pyx_k_union, sizeof(__pyx_k_union), 0, 0, 1, 1},
  {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
  {&__pyx_n_s_upper, __pyx_k_upper, sizeof(__pyx_k_upper), 0, 0, 1, 1},
  {&__pyx_n_s_valid_ep_square, __pyx_k_valid_ep_square, sizeof(__pyx_k_valid_ep_square), 0, 0, 1, 1},
  {&__pyx_n_s_version, __pyx_k_version, sizeof(__pyx_k_version), 0, 0, 1, 1},
  {&__pyx_n_u_w, __pyx_k_w, sizeof(__pyx_k_w), 0, 1, 0, 1},
  {&__pyx_n_s_was_into_check, __pyx_k_was_into_check, sizeof(__pyx_k_was_into_check), 0, 0, 1, 1},
  {&__pyx_n_s_was_promoted, __pyx_k_was_promoted, sizeof(__pyx_k_was_promoted), 0, 0, 1, 1},
  {&__pyx_n_u_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 1, 0, 1},
  {&__pyx_n_u_xfen, __pyx_k_xfen, sizeof(__pyx_k_xfen), 0, 1, 0, 1},
  {&__pyx_n_s_xor, __pyx_k_xor, sizeof(__pyx_k_xor), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 47, __pyx_L1_error)
  __pyx_builtin_AttributeError = __Pyx_GetBuiltinName(__pyx_n_s_AttributeError); if (!__pyx_builtin_AttributeError) __PYX_ERR(0, 74, __pyx_L1_error)
  __pyx_builtin_bin = __Pyx_GetBuiltinName(__pyx_n_s_bin); if (!__pyx_builtin_bin) __PYX_ERR(0, 217, __pyx_L1_error)
  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 355, __pyx_L1_error)
  __pyx_builtin_NotImplemented = __Pyx_GetBuiltinName(__pyx_n_s_NotImplemented); if (!__pyx_builtin_NotImplemented) __PYX_ERR(0, 424, __pyx_L1_error)
  __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(0, 524, __pyx_L1_error)
  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 546, __pyx_L1_error)
  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 1184, __pyx_L1_error)
  __pyx_builtin_super = __Pyx_GetBuiltinName(__pyx_n_s_super); if (!__pyx_builtin_super) __PYX_ERR(0, 1469, __pyx_L1_error)
  __pyx_builtin_any = __Pyx_GetBuiltinName(__pyx_n_s_any); if (!__pyx_builtin_any) __PYX_ERR(0, 1736, __pyx_L1_error)
  __pyx_builtin_StopIteration = __Pyx_GetBuiltinName(__pyx_n_s_StopIteration); if (!__pyx_builtin_StopIteration) __PYX_ERR(0, 2674, __pyx_L1_error)
  __pyx_builtin_hex = __Pyx_GetBuiltinName(__pyx_n_s_hex); if (!__pyx_builtin_hex) __PYX_ERR(0, 3392, __pyx_L1_error)
  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) __PYX_ERR(0, 3620, __pyx_L1_error)
  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 3666, __pyx_L1_error)
  __pyx_builtin_OverflowError = __Pyx_GetBuiltinName(__pyx_n_s_OverflowError); if (!__pyx_builtin_OverflowError) __PYX_ERR(1, 81, __pyx_L1_error)
  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(1, 94, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}

static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "chess/__init__cp.pyx":538
 *         elif len(uci) == 4 and "@" == uci[1]:
 *             drop = PIECE_SYMBOLS.index(uci[0].lower())
 *             square = SQUARE_NAMES.index(uci[2:])             # <<<<<<<<<<<<<<
 *             return cls(square, square, drop=drop)
 *         elif len(uci) == 4:
 */
  __pyx_slice__6 = PySlice_New(__pyx_int_2, Py_None, Py_None); if (unlikely(!__pyx_slice__6)) __PYX_ERR(0, 538, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__6);
  __Pyx_GIVEREF(__pyx_slice__6);

  /* "chess/__init__cp.pyx":541
 *             return cls(square, square, drop=drop)
 *         elif len(uci) == 4:
 *             return cls(SQUARE_NAMES.index(uci[0:2]), SQUARE_NAMES.index(uci[2:4]))             # <<<<<<<<<<<<<<
 *         elif len(uci) == 5:
 *             promotion = PIECE_SYMBOLS.index(uci[4])
 */
  __pyx_slice__7 = PySlice_New(__pyx_int_0, __pyx_int_2, Py_None); if (unlikely(!__pyx_slice__7)) __PYX_ERR(0, 541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__7);
  __Pyx_GIVEREF(__pyx_slice__7);
  __pyx_slice__8 = PySlice_New(__pyx_int_2, __pyx_int_4, Py_None); if (unlikely(!__pyx_slice__8)) __PYX_ERR(0, 541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__8);
  __Pyx_GIVEREF(__pyx_slice__8);

  /* "chess/__init__cp.pyx":562
 *         False
 *         """
 *         return cls(0, 0)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_tuple__9 = PyTuple_Pack(2, __pyx_int_0, __pyx_int_0); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__9);
  __Pyx_GIVEREF(__pyx_tuple__9);

  /* "chess/__init__cp.pyx":1184
 *     def __str__(self):
 *         builder = []
 *         print("_+_+_+_+_+_+_+_+_+_+_")             # <<<<<<<<<<<<<<
 *         print(SQUARES_180)
 *         for square in SQUARES_180:
 */
  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u__16); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 1184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__17);
  __Pyx_GIVEREF(__pyx_tuple__17);

  /* "chess/__init__cp.pyx":1342
 *         :func:`~chess.BaseBoard.clear_board()`.
 *         """
 *         return cls(None)             # <<<<<<<<<<<<<<
 * 
 *     @classmethod
 */
  __pyx_tuple__24 = PyTuple_Pack(1, Py_None); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 1342, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__24);
  __Pyx_GIVEREF(__pyx_tuple__24);

  /* "chess/__init__cp.pyx":1496
 *     def clear_stack(self):
 *         """Clears the move stack."""
 *         del self.move_stack[:]             # <<<<<<<<<<<<<<
 *         del self.stack[:]
 * 
 */
  __pyx_slice__26 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__26)) __PYX_ERR(0, 1496, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__26);
  __Pyx_GIVEREF(__pyx_slice__26);

  /* "chess/__init__cp.pyx":2506
 *         """
 *         # Split into 4 or 5 parts.
 *         parts = epd.strip().rstrip(";").split(None, 4)             # <<<<<<<<<<<<<<
 *         if len(parts) < 4:
 *             raise ValueError("epd should consist of at least 4 parts: {}".format(repr(epd)))
 */
  __pyx_tuple__43 = PyTuple_Pack(2, Py_None, __pyx_int_4); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 2506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__43);
  __Pyx_GIVEREF(__pyx_tuple__43);

  /* "chess/__init__cp.pyx":3629
 *         """
 *         if not self.mask:
 *             raise KeyError("pop from empty SquareSet")             # <<<<<<<<<<<<<<
 * 
 *         square = lsb(self.mask)
 */
  __pyx_tuple__61 = PyTuple_Pack(1, __pyx_kp_u_pop_from_empty_SquareSet); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 3629, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__61);
  __Pyx_GIVEREF(__pyx_tuple__61);

  /* "chess/__init__cp.pyx":3697
 *     def __str__(self):
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )             # <<<<<<<<<<<<<<
 *         for square in SQUARES_180:
 *             mask = BB_SQUARES[square]
 */
  __pyx_tuple__63 = PyTuple_Pack(1, __pyx_kp_u__62); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(0, 3697, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__63);
  __Pyx_GIVEREF(__pyx_tuple__63);

  /* "chess/__init__cp.pyx":47
 * Color = bool
 * 
 * PIECE_TYPES = [PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING] = range(1, 7)             # <<<<<<<<<<<<<<
 * PIECE_SYMBOLS = [None, "p", "n", "b", "r", "q", "k"]
 * PIECE_NAMES = [None, "pawn", "knight", "bishop", "rook", "queen", "king"]
 */
  __pyx_tuple__64 = PyTuple_Pack(2, __pyx_int_1, __pyx_int_7); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__64);
  __Pyx_GIVEREF(__pyx_tuple__64);

  /* "chess/__init__cp.pyx":121
 *     A6, B6, C6, D6, E6, F6, G6, H6,
 *     A7, B7, C7, D7, E7, F7, G7, H7,
 *     A8, B8, C8, D8, E8, F8, G8, H8] = range(64)             # <<<<<<<<<<<<<<
 * Square = int
 * 
 */
  __pyx_tuple__77 = PyTuple_Pack(1, __pyx_int_64); if (unlikely(!__pyx_tuple__77)) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__77);
  __Pyx_GIVEREF(__pyx_tuple__77);

  /* "chess/__init__cp.pyx":126
 * SQUARE_NAMES = [f + r for r in RANK_NAMES for f in FILE_NAMES]
 * 
 * def square(file_index, rank_index):             # <<<<<<<<<<<<<<
 *     """Gets a square number by file and rank index."""
 *     return rank_index * 8 + file_index
 */
  __pyx_tuple__78 = PyTuple_Pack(2, __pyx_n_s_file_index, __pyx_n_s_rank_index); if (unlikely(!__pyx_tuple__78)) __PYX_ERR(0, 126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__78);
  __Pyx_GIVEREF(__pyx_tuple__78);
  __pyx_codeobj__79 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__78, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_square, 126, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__79)) __PYX_ERR(0, 126, __pyx_L1_error)

  /* "chess/__init__cp.pyx":130
 *     return rank_index * 8 + file_index
 * 
 * def square_file(square):             # <<<<<<<<<<<<<<
 *     """Gets the file index of the square where ``0`` is the a-file."""
 *     return square & 7
 */
  __pyx_tuple__80 = PyTuple_Pack(1, __pyx_n_s_square); if (unlikely(!__pyx_tuple__80)) __PYX_ERR(0, 130, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__80);
  __Pyx_GIVEREF(__pyx_tuple__80);
  __pyx_codeobj__81 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__80, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_square_file, 130, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__81)) __PYX_ERR(0, 130, __pyx_L1_error)

  /* "chess/__init__cp.pyx":134
 *     return square & 7
 * 
 * def square_rank(square):             # <<<<<<<<<<<<<<
 *     """Gets the rank index of the square where ``0`` is the first rank."""
 *     return square >> 3
 */
  __pyx_tuple__82 = PyTuple_Pack(1, __pyx_n_s_square); if (unlikely(!__pyx_tuple__82)) __PYX_ERR(0, 134, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__82);
  __Pyx_GIVEREF(__pyx_tuple__82);
  __pyx_codeobj__83 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__82, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_square_rank, 134, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__83)) __PYX_ERR(0, 134, __pyx_L1_error)

  /* "chess/__init__cp.pyx":138
 *     return square >> 3
 * 
 * def square_name(square):             # <<<<<<<<<<<<<<
 *     """Gets the name of the square, like ``a3``."""
 *     return SQUARE_NAMES[square]
 */
  __pyx_tuple__84 = PyTuple_Pack(1, __pyx_n_s_square); if (unlikely(!__pyx_tuple__84)) __PYX_ERR(0, 138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__84);
  __Pyx_GIVEREF(__pyx_tuple__84);
  __pyx_codeobj__85 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__84, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_square_name, 138, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__85)) __PYX_ERR(0, 138, __pyx_L1_error)

  /* "chess/__init__cp.pyx":142
 *     return SQUARE_NAMES[square]
 * 
 * def square_distance(a, b):             # <<<<<<<<<<<<<<
 *     """
 *     Gets the distance (i.e., the number of king steps) from square *a* to *b*.
 */
  __pyx_tuple__86 = PyTuple_Pack(2, __pyx_n_s_a, __pyx_n_s_b); if (unlikely(!__pyx_tuple__86)) __PYX_ERR(0, 142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__86);
  __Pyx_GIVEREF(__pyx_tuple__86);
  __pyx_codeobj__87 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__86, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_square_distance, 142, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__87)) __PYX_ERR(0, 142, __pyx_L1_error)

  /* "chess/__init__cp.pyx":148
 *     return max(abs(square_file(a) - square_file(b)), abs(square_rank(a) - square_rank(b)))
 * 
 * def square_mirror(square):             # <<<<<<<<<<<<<<
 *     """Mirrors the square vertically."""
 *     return square ^ 0x38
 */
  __pyx_tuple__88 = PyTuple_Pack(1, __pyx_n_s_square); if (unlikely(!__pyx_tuple__88)) __PYX_ERR(0, 148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__88);
  __Pyx_GIVEREF(__pyx_tuple__88);
  __pyx_codeobj__89 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__88, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_square_mirror, 148, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__89)) __PYX_ERR(0, 148, __pyx_L1_error)

  /* "chess/__init__cp.pyx":199
 * 
 * 
 * def lsb(bb):             # <<<<<<<<<<<<<<
 *     return (bb & -bb).bit_length() - 1
 * 
 */
  __pyx_tuple__90 = PyTuple_Pack(1, __pyx_n_s_bb); if (unlikely(!__pyx_tuple__90)) __PYX_ERR(0, 199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__90);
  __Pyx_GIVEREF(__pyx_tuple__90);
  __pyx_codeobj__91 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__90, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_lsb, 199, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__91)) __PYX_ERR(0, 199, __pyx_L1_error)

  /* "chess/__init__cp.pyx":202
 *     return (bb & -bb).bit_length() - 1
 * 
 * def scan_forward(bb):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb & -bb
 */
  __pyx_tuple__92 = PyTuple_Pack(2, __pyx_n_s_bb, __pyx_n_s_r); if (unlikely(!__pyx_tuple__92)) __PYX_ERR(0, 202, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__92);
  __Pyx_GIVEREF(__pyx_tuple__92);
  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__92, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_scan_forward, 202, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 202, __pyx_L1_error)

  /* "chess/__init__cp.pyx":208
 *         bb ^= r
 * 
 * def msb(bb):             # <<<<<<<<<<<<<<
 *     return bb.bit_length() - 1
 * 
 */
  __pyx_tuple__93 = PyTuple_Pack(1, __pyx_n_s_bb); if (unlikely(!__pyx_tuple__93)) __PYX_ERR(0, 208, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__93);
  __Pyx_GIVEREF(__pyx_tuple__93);
  __pyx_codeobj__94 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__93, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_msb, 208, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__94)) __PYX_ERR(0, 208, __pyx_L1_error)

  /* "chess/__init__cp.pyx":211
 *     return bb.bit_length() - 1
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb.bit_length() - 1
 */
  __pyx_tuple__95 = PyTuple_Pack(3, __pyx_n_s_bb, __pyx_n_s_BB_SQUARES, __pyx_n_s_r); if (unlikely(!__pyx_tuple__95)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__95);
  __Pyx_GIVEREF(__pyx_tuple__95);
  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(1, 1, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__95, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_scan_reversed, 211, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 211, __pyx_L1_error)

  /* "chess/__init__cp.pyx":217
 *         bb ^= _BB_SQUARES[r]
 * 
 * def popcount(bb, *, _bin=bin):             # <<<<<<<<<<<<<<
 *     return _bin(bb).count("1")
 * 
 */
  __pyx_tuple__96 = PyTuple_Pack(2, __pyx_n_s_bb, __pyx_n_s_bin_2); if (unlikely(!__pyx_tuple__96)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__96);
  __Pyx_GIVEREF(__pyx_tuple__96);
  __pyx_codeobj__97 = (PyObject*)__Pyx_PyCode_New(1, 1, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__96, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_popcount, 217, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__97)) __PYX_ERR(0, 217, __pyx_L1_error)

  /* "chess/__init__cp.pyx":220
 *     return _bin(bb).count("1")
 * 
 * def flip_vertical(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipVertically
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)
 */
  __pyx_tuple__98 = PyTuple_Pack(1, __pyx_n_s_bb); if (unlikely(!__pyx_tuple__98)) __PYX_ERR(0, 220, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__98);
  __Pyx_GIVEREF(__pyx_tuple__98);
  __pyx_codeobj__99 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__98, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_flip_vertical, 220, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__99)) __PYX_ERR(0, 220, __pyx_L1_error)

  /* "chess/__init__cp.pyx":227
 *     return bb
 * 
 * def flip_horizontal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#MirrorHorizontally
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)
 */
  __pyx_tuple__100 = PyTuple_Pack(1, __pyx_n_s_bb); if (unlikely(!__pyx_tuple__100)) __PYX_ERR(0, 227, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__100);
  __Pyx_GIVEREF(__pyx_tuple__100);
  __pyx_codeobj__101 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__100, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_flip_horizontal, 227, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__101)) __PYX_ERR(0, 227, __pyx_L1_error)

  /* "chess/__init__cp.pyx":234
 *     return bb
 * 
 * def flip_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheDiagonal
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000
 */
  __pyx_tuple__102 = PyTuple_Pack(2, __pyx_n_s_bb, __pyx_n_s_t); if (unlikely(!__pyx_tuple__102)) __PYX_ERR(0, 234, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__102);
  __Pyx_GIVEREF(__pyx_tuple__102);
  __pyx_codeobj__103 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__102, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_flip_diagonal, 234, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__103)) __PYX_ERR(0, 234, __pyx_L1_error)

  /* "chess/__init__cp.pyx":244
 *     return bb
 * 
 * def flip_anti_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheAntidiagonal
 *     t = bb ^ (bb << 36)
 */
  __pyx_tuple__104 = PyTuple_Pack(2, __pyx_n_s_bb, __pyx_n_s_t); if (unlikely(!__pyx_tuple__104)) __PYX_ERR(0, 244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__104);
  __Pyx_GIVEREF(__pyx_tuple__104);
  __pyx_codeobj__105 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__104, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_flip_anti_diagonal, 244, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__105)) __PYX_ERR(0, 244, __pyx_L1_error)

  /* "chess/__init__cp.pyx":255
 * 
 * 
 * def shift_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 8
 * 
 */
  __pyx_tuple__106 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__106)) __PYX_ERR(0, 255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__106);
  __Pyx_GIVEREF(__pyx_tuple__106);
  __pyx_codeobj__107 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__106, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_down, 255, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__107)) __PYX_ERR(0, 255, __pyx_L1_error)

  /* "chess/__init__cp.pyx":258
 *     return b >> 8
 * 
 * def shift_2_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 16
 * 
 */
  __pyx_tuple__108 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__108)) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__108);
  __Pyx_GIVEREF(__pyx_tuple__108);
  __pyx_codeobj__109 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__108, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_2_down, 258, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__109)) __PYX_ERR(0, 258, __pyx_L1_error)

  /* "chess/__init__cp.pyx":261
 *     return b >> 16
 * 
 * def shift_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 8) & BB_ALL
 * 
 */
  __pyx_tuple__110 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__110)) __PYX_ERR(0, 261, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__110);
  __Pyx_GIVEREF(__pyx_tuple__110);
  __pyx_codeobj__111 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__110, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_up, 261, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__111)) __PYX_ERR(0, 261, __pyx_L1_error)

  /* "chess/__init__cp.pyx":264
 *     return (b << 8) & BB_ALL
 * 
 * def shift_2_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 16) & BB_ALL
 * 
 */
  __pyx_tuple__112 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__112)) __PYX_ERR(0, 264, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__112);
  __Pyx_GIVEREF(__pyx_tuple__112);
  __pyx_codeobj__113 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__112, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_2_up, 264, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__113)) __PYX_ERR(0, 264, __pyx_L1_error)

  /* "chess/__init__cp.pyx":267
 *     return (b << 16) & BB_ALL
 * 
 * def shift_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 */
  __pyx_tuple__114 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__114)) __PYX_ERR(0, 267, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__114);
  __Pyx_GIVEREF(__pyx_tuple__114);
  __pyx_codeobj__115 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__114, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_right, 267, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__115)) __PYX_ERR(0, 267, __pyx_L1_error)

  /* "chess/__init__cp.pyx":270
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_2_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 */
  __pyx_tuple__116 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__116)) __PYX_ERR(0, 270, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__116);
  __Pyx_GIVEREF(__pyx_tuple__116);
  __pyx_codeobj__117 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__116, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_2_right, 270, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__117)) __PYX_ERR(0, 270, __pyx_L1_error)

  /* "chess/__init__cp.pyx":273
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 * def shift_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 1) & ~BB_FILE_H
 * 
 */
  __pyx_tuple__118 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__118)) __PYX_ERR(0, 273, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__118);
  __Pyx_GIVEREF(__pyx_tuple__118);
  __pyx_codeobj__119 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__118, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_left, 273, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__119)) __PYX_ERR(0, 273, __pyx_L1_error)

  /* "chess/__init__cp.pyx":276
 *     return (b >> 1) & ~BB_FILE_H
 * 
 * def shift_2_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 */
  __pyx_tuple__120 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__120)) __PYX_ERR(0, 276, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__120);
  __Pyx_GIVEREF(__pyx_tuple__120);
  __pyx_codeobj__121 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__120, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_2_left, 276, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__121)) __PYX_ERR(0, 276, __pyx_L1_error)

  /* "chess/__init__cp.pyx":279
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 * def shift_up_left(b):             # <<<<<<<<<<<<<<
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 */
  __pyx_tuple__122 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__122)) __PYX_ERR(0, 279, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__122);
  __Pyx_GIVEREF(__pyx_tuple__122);
  __pyx_codeobj__123 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__122, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_up_left, 279, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__123)) __PYX_ERR(0, 279, __pyx_L1_error)

  /* "chess/__init__cp.pyx":282
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 * def shift_up_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 */
  __pyx_tuple__124 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__124)) __PYX_ERR(0, 282, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__124);
  __Pyx_GIVEREF(__pyx_tuple__124);
  __pyx_codeobj__125 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__124, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_up_right, 282, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__125)) __PYX_ERR(0, 282, __pyx_L1_error)

  /* "chess/__init__cp.pyx":285
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_down_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 9) & ~BB_FILE_H
 * 
 */
  __pyx_tuple__126 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__126)) __PYX_ERR(0, 285, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__126);
  __Pyx_GIVEREF(__pyx_tuple__126);
  __pyx_codeobj__127 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__126, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_down_left, 285, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__127)) __PYX_ERR(0, 285, __pyx_L1_error)

  /* "chess/__init__cp.pyx":288
 *     return (b >> 9) & ~BB_FILE_H
 * 
 * def shift_down_right(b):             # <<<<<<<<<<<<<<
 *     return (b >> 7) & ~BB_FILE_A
 * 
 */
  __pyx_tuple__128 = PyTuple_Pack(1, __pyx_n_s_b); if (unlikely(!__pyx_tuple__128)) __PYX_ERR(0, 288, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__128);
  __Pyx_GIVEREF(__pyx_tuple__128);
  __pyx_codeobj__129 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__128, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_shift_down_right, 288, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__129)) __PYX_ERR(0, 288, __pyx_L1_error)

  /* "chess/__init__cp.pyx":292
 * 
 * 
 * def _sliding_attacks(square, occupied, deltas):             # <<<<<<<<<<<<<<
 *     attacks = 0
 * 
 */
  __pyx_tuple__130 = PyTuple_Pack(6, __pyx_n_s_square, __pyx_n_s_occupied, __pyx_n_s_deltas, __pyx_n_s_attacks, __pyx_n_s_delta, __pyx_n_s_sq); if (unlikely(!__pyx_tuple__130)) __PYX_ERR(0, 292, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__130);
  __Pyx_GIVEREF(__pyx_tuple__130);
  __pyx_codeobj__131 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__130, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_sliding_attacks, 292, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__131)) __PYX_ERR(0, 292, __pyx_L1_error)

  /* "chess/__init__cp.pyx":310
 *     return attacks
 * 
 * def _step_attacks(square, deltas):             # <<<<<<<<<<<<<<
 *     return _sliding_attacks(square, BB_ALL, deltas)
 * 
 */
  __pyx_tuple__132 = PyTuple_Pack(2, __pyx_n_s_square, __pyx_n_s_deltas); if (unlikely(!__pyx_tuple__132)) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__132);
  __Pyx_GIVEREF(__pyx_tuple__132);
  __pyx_codeobj__133 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__132, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_step_attacks, 310, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__133)) __PYX_ERR(0, 310, __pyx_L1_error)

  /* "chess/__init__cp.pyx":318
 * 
 * 
 * def _edges(square):             # <<<<<<<<<<<<<<
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 */
  __pyx_tuple__134 = PyTuple_Pack(1, __pyx_n_s_square); if (unlikely(!__pyx_tuple__134)) __PYX_ERR(0, 318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__134);
  __Pyx_GIVEREF(__pyx_tuple__134);
  __pyx_codeobj__135 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__134, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_edges, 318, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__135)) __PYX_ERR(0, 318, __pyx_L1_error)

  /* "chess/__init__cp.pyx":322
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 * def _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0
 */
  __pyx_tuple__136 = PyTuple_Pack(2, __pyx_n_s_mask, __pyx_n_s_subset); if (unlikely(!__pyx_tuple__136)) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__136);
  __Pyx_GIVEREF(__pyx_tuple__136);
  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__136, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_carry_rippler, 322, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 322, __pyx_L1_error)

  /* "chess/__init__cp.pyx":331
 *             break
 * 
 * def _attack_table(deltas):             # <<<<<<<<<<<<<<
 *     mask_table = []
 *     attack_table = []
 */
  __pyx_tuple__137 = PyTuple_Pack(7, __pyx_n_s_deltas, __pyx_n_s_mask_table, __pyx_n_s_attack_table, __pyx_n_s_square, __pyx_n_s_attacks, __pyx_n_s_mask, __pyx_n_s_subset); if (unlikely(!__pyx_tuple__137)) __PYX_ERR(0, 331, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__137);
  __Pyx_GIVEREF(__pyx_tuple__137);
  __pyx_codeobj__138 = (PyObject*)__Pyx_PyCode_New(1, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__137, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_attack_table_2, 331, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__138)) __PYX_ERR(0, 331, __pyx_L1_error)

  /* "chess/__init__cp.pyx":352
 * 
 * 
 * def _rays():             # <<<<<<<<<<<<<<
 *     rays = []
 *     between = []
 */
  __pyx_tuple__139 = PyTuple_Pack(8, __pyx_n_s_rays, __pyx_n_s_between, __pyx_n_s_a, __pyx_n_s_bb_a, __pyx_n_s_rays_row, __pyx_n_s_between_row, __pyx_n_s_b, __pyx_n_s_bb_b); if (unlikely(!__pyx_tuple__139)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__139);
  __Pyx_GIVEREF(__pyx_tuple__139);
  __pyx_codeobj__140 = (PyObject*)__Pyx_PyCode_New(0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__139, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_rays_2, 352, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__140)) __PYX_ERR(0, 352, __pyx_L1_error)

  /* "chess/__init__cp.pyx":378
 * 
 * 
 * SAN_REGEX = re.compile(r"^([NBKRQ])?([a-h])?([1-8])?[\-x]?([a-h][1-8])(=?[nbrqkNBRQK])?(\+|#)?\Z")             # <<<<<<<<<<<<<<
 * 
 * FEN_CASTLING_REGEX = re.compile(r"^(?:-|[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2})\Z")
 */
  __pyx_tuple__141 = PyTuple_Pack(1, __pyx_kp_u_NBKRQ_a_h_1_8_x_a_h_1_8_nbrqkNB); if (unlikely(!__pyx_tuple__141)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__141);
  __Pyx_GIVEREF(__pyx_tuple__141);

  /* "chess/__init__cp.pyx":380
 * SAN_REGEX = re.compile(r"^([NBKRQ])?([a-h])?([1-8])?[\-x]?([a-h][1-8])(=?[nbrqkNBRQK])?(\+|#)?\Z")
 * 
 * FEN_CASTLING_REGEX = re.compile(r"^(?:-|[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2})\Z")             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_tuple__142 = PyTuple_Pack(1, __pyx_kp_u_KQABCDEFGH_0_2_kqabcdefgh_0_2_Z); if (unlikely(!__pyx_tuple__142)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__142);
  __Pyx_GIVEREF(__pyx_tuple__142);

  /* "chess/__init__cp.pyx":386
 *     """A piece with type and color."""
 * 
 *     def __init__(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         self.piece_type = piece_type
 *         self.color = color
 */
  __pyx_tuple__143 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_piece_type, __pyx_n_s_color); if (unlikely(!__pyx_tuple__143)) __PYX_ERR(0, 386, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__143);
  __Pyx_GIVEREF(__pyx_tuple__143);
  __pyx_codeobj__144 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__143, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_init, 386, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__144)) __PYX_ERR(0, 386, __pyx_L1_error)

  /* "chess/__init__cp.pyx":390
 *         self.color = color
 * 
 *     def symbol(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the symbol ``P``, ``N``, ``B``, ``R``, ``Q`` or ``K`` for white
 */
  __pyx_tuple__145 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__145)) __PYX_ERR(0, 390, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__145);
  __Pyx_GIVEREF(__pyx_tuple__145);
  __pyx_codeobj__146 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__145, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_symbol, 390, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__146)) __PYX_ERR(0, 390, __pyx_L1_error)

  /* "chess/__init__cp.pyx":400
 *             return PIECE_SYMBOLS[self.piece_type]
 * 
 *     def unicode_symbol(self, *, invert_color=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Unicode character for the piece.
 */
  __pyx_tuple__147 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_invert_color); if (unlikely(!__pyx_tuple__147)) __PYX_ERR(0, 400, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__147);
  __Pyx_GIVEREF(__pyx_tuple__147);
  __pyx_codeobj__148 = (PyObject*)__Pyx_PyCode_New(1, 1, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__147, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_unicode_symbol, 400, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__148)) __PYX_ERR(0, 400, __pyx_L1_error)

  /* "chess/__init__cp.pyx":409
 *             return UNICODE_PIECE_SYMBOLS[self.symbol().swapcase()]
 * 
 *     def __hash__(self):             # <<<<<<<<<<<<<<
 *         return hash(self.piece_type * (self.color + 1))
 * 
 */
  __pyx_tuple__149 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__149)) __PYX_ERR(0, 409, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__149);
  __Pyx_GIVEREF(__pyx_tuple__149);
  __pyx_codeobj__150 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__149, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_hash, 409, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__150)) __PYX_ERR(0, 409, __pyx_L1_error)

  /* "chess/__init__cp.pyx":412
 *         return hash(self.piece_type * (self.color + 1))
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 */
  __pyx_tuple__151 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__151)) __PYX_ERR(0, 412, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__151);
  __Pyx_GIVEREF(__pyx_tuple__151);
  __pyx_codeobj__152 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__151, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_repr, 412, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__152)) __PYX_ERR(0, 412, __pyx_L1_error)

  /* "chess/__init__cp.pyx":415
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         return self.symbol()
 * 
 */
  __pyx_tuple__153 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__153)) __PYX_ERR(0, 415, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__153);
  __Pyx_GIVEREF(__pyx_tuple__153);
  __pyx_codeobj__154 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__153, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_str, 415, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__154)) __PYX_ERR(0, 415, __pyx_L1_error)

  /* "chess/__init__cp.pyx":418
 *         return self.symbol()
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.piece(self, size=45)
 */
  __pyx_tuple__155 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_chess); if (unlikely(!__pyx_tuple__155)) __PYX_ERR(0, 418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__155);
  __Pyx_GIVEREF(__pyx_tuple__155);
  __pyx_codeobj__156 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__155, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_repr_svg, 418, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__156)) __PYX_ERR(0, 418, __pyx_L1_error)

  /* "chess/__init__cp.pyx":422
 *         return chess.svg.piece(self, size=45)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */
  __pyx_tuple__157 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_ne_2); if (unlikely(!__pyx_tuple__157)) __PYX_ERR(0, 422, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__157);
  __Pyx_GIVEREF(__pyx_tuple__157);
  __pyx_codeobj__158 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__157, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_eq, 422, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__158)) __PYX_ERR(0, 422, __pyx_L1_error)

  /* "chess/__init__cp.pyx":426
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.piece_type != other.piece_type:
 */
  __pyx_tuple__159 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__159)) __PYX_ERR(0, 426, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__159);
  __Pyx_GIVEREF(__pyx_tuple__159);
  __pyx_codeobj__160 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__159, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_ne, 426, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__160)) __PYX_ERR(0, 426, __pyx_L1_error)

  /* "chess/__init__cp.pyx":438
 * 
 *     @classmethod
 *     def from_symbol(cls, symbol):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.Piece` instance from a piece symbol.
 */
  __pyx_tuple__161 = PyTuple_Pack(2, __pyx_n_s_cls, __pyx_n_s_symbol); if (unlikely(!__pyx_tuple__161)) __PYX_ERR(0, 438, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__161);
  __Pyx_GIVEREF(__pyx_tuple__161);
  __pyx_codeobj__162 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__161, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_from_symbol, 438, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__162)) __PYX_ERR(0, 438, __pyx_L1_error)

  /* "chess/__init__cp.pyx":1361
 * class _BoardState:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.pawns = board.pawns
 *         self.knights = board.knights
 */
  __pyx_tuple__163 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_board); if (unlikely(!__pyx_tuple__163)) __PYX_ERR(0, 1361, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__163);
  __Pyx_GIVEREF(__pyx_tuple__163);
  __pyx_codeobj__164 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__163, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_init, 1361, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__164)) __PYX_ERR(0, 1361, __pyx_L1_error)

  /* "chess/__init__cp.pyx":1381
 *         self.fullmove_number = board.fullmove_number
 * 
 *     def restore(self, board):             # <<<<<<<<<<<<<<
 *         board.pawns = self.pawns
 *         board.knights = self.knights
 */
  __pyx_tuple__165 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_board); if (unlikely(!__pyx_tuple__165)) __PYX_ERR(0, 1381, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__165);
  __Pyx_GIVEREF(__pyx_tuple__165);
  __pyx_codeobj__166 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__165, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_restore, 1381, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__166)) __PYX_ERR(0, 1381, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3492
 *     """
 * 
 *     def __init__(self, squares=BB_EMPTY):             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  __pyx_tuple__167 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_squares, __pyx_n_s_square); if (unlikely(!__pyx_tuple__167)) __PYX_ERR(0, 3492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__167);
  __Pyx_GIVEREF(__pyx_tuple__167);
  __pyx_codeobj__168 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__167, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_init, 3492, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__168)) __PYX_ERR(0, 3492, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3507
 *     # Set
 * 
 *     def __contains__(self, square):             # <<<<<<<<<<<<<<
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 */
  __pyx_tuple__169 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_square); if (unlikely(!__pyx_tuple__169)) __PYX_ERR(0, 3507, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__169);
  __Pyx_GIVEREF(__pyx_tuple__169);
  __pyx_codeobj__170 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__169, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_contains, 3507, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__170)) __PYX_ERR(0, 3507, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3510
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return scan_forward(self.mask)
 * 
 */
  __pyx_tuple__171 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__171)) __PYX_ERR(0, 3510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__171);
  __Pyx_GIVEREF(__pyx_tuple__171);
  __pyx_codeobj__172 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__171, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_iter, 3510, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__172)) __PYX_ERR(0, 3510, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3513
 *         return scan_forward(self.mask)
 * 
 *     def __reversed__(self):             # <<<<<<<<<<<<<<
 *         return scan_reversed(self.mask)
 * 
 */
  __pyx_tuple__173 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__173)) __PYX_ERR(0, 3513, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__173);
  __Pyx_GIVEREF(__pyx_tuple__173);
  __pyx_codeobj__174 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__173, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_reversed, 3513, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__174)) __PYX_ERR(0, 3513, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3516
 *         return scan_reversed(self.mask)
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         return popcount(self.mask)
 * 
 */
  __pyx_tuple__175 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__175)) __PYX_ERR(0, 3516, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__175);
  __Pyx_GIVEREF(__pyx_tuple__175);
  __pyx_codeobj__176 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__175, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_len, 3516, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__176)) __PYX_ERR(0, 3516, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3521
 *     # MutableSet
 * 
 *     def add(self, square):             # <<<<<<<<<<<<<<
 *         """Adds a square to the set."""
 *         self.mask |= BB_SQUARES[square]
 */
  __pyx_tuple__177 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_square); if (unlikely(!__pyx_tuple__177)) __PYX_ERR(0, 3521, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__177);
  __Pyx_GIVEREF(__pyx_tuple__177);
  __pyx_codeobj__178 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__177, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_add, 3521, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__178)) __PYX_ERR(0, 3521, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3525
 *         self.mask |= BB_SQUARES[square]
 * 
 *     def discard(self, square):             # <<<<<<<<<<<<<<
 *         """Discards a square from the set."""
 *         self.mask &= ~BB_SQUARES[square]
 */
  __pyx_tuple__179 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_square); if (unlikely(!__pyx_tuple__179)) __PYX_ERR(0, 3525, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__179);
  __Pyx_GIVEREF(__pyx_tuple__179);
  __pyx_codeobj__180 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__179, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_discard, 3525, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__180)) __PYX_ERR(0, 3525, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3531
 *     # frozenset
 * 
 *     def isdisjoint(self, other):             # <<<<<<<<<<<<<<
 *         """Test if the square sets are disjoint."""
 *         return not bool(self & other)
 */
  __pyx_tuple__181 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__181)) __PYX_ERR(0, 3531, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__181);
  __Pyx_GIVEREF(__pyx_tuple__181);
  __pyx_codeobj__182 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__181, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_isdisjoint, 3531, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__182)) __PYX_ERR(0, 3531, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3535
 *         return not bool(self & other)
 * 
 *     def issubset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a subset of another."""
 *         return not bool(~self & other)
 */
  __pyx_tuple__183 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__183)) __PYX_ERR(0, 3535, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__183);
  __Pyx_GIVEREF(__pyx_tuple__183);
  __pyx_codeobj__184 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__183, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_issubset, 3535, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__184)) __PYX_ERR(0, 3535, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3539
 *         return not bool(~self & other)
 * 
 *     def issuperset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a superset of another."""
 *         return not bool(self & ~other)
 */
  __pyx_tuple__185 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__185)) __PYX_ERR(0, 3539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__185);
  __Pyx_GIVEREF(__pyx_tuple__185);
  __pyx_codeobj__186 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__185, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_issuperset, 3539, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__186)) __PYX_ERR(0, 3539, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3543
 *         return not bool(self & ~other)
 * 
 *     def union(self, other):             # <<<<<<<<<<<<<<
 *         return self | other
 * 
 */
  __pyx_tuple__187 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__187)) __PYX_ERR(0, 3543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__187);
  __Pyx_GIVEREF(__pyx_tuple__187);
  __pyx_codeobj__188 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__187, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_union, 3543, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__188)) __PYX_ERR(0, 3543, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3546
 *         return self | other
 * 
 *     def __or__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask |= self.mask
 */
  __pyx_tuple__189 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_r); if (unlikely(!__pyx_tuple__189)) __PYX_ERR(0, 3546, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__189);
  __Pyx_GIVEREF(__pyx_tuple__189);
  __pyx_codeobj__190 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__189, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_or, 3546, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__190)) __PYX_ERR(0, 3546, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3551
 *         return r
 * 
 *     def intersection(self, other):             # <<<<<<<<<<<<<<
 *         return self & other
 * 
 */
  __pyx_tuple__191 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__191)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__191);
  __Pyx_GIVEREF(__pyx_tuple__191);
  __pyx_codeobj__192 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__191, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_intersection, 3551, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__192)) __PYX_ERR(0, 3551, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3554
 *         return self & other
 * 
 *     def __and__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask &= self.mask
 */
  __pyx_tuple__193 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_r); if (unlikely(!__pyx_tuple__193)) __PYX_ERR(0, 3554, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__193);
  __Pyx_GIVEREF(__pyx_tuple__193);
  __pyx_codeobj__194 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__193, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_and, 3554, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__194)) __PYX_ERR(0, 3554, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3559
 *         return r
 * 
 *     def difference(self, other):             # <<<<<<<<<<<<<<
 *         return self - other
 * 
 */
  __pyx_tuple__195 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__195)) __PYX_ERR(0, 3559, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__195);
  __Pyx_GIVEREF(__pyx_tuple__195);
  __pyx_codeobj__196 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__195, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_difference, 3559, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__196)) __PYX_ERR(0, 3559, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3562
 *         return self - other
 * 
 *     def __sub__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask = self.mask & ~r.mask
 */
  __pyx_tuple__197 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_r); if (unlikely(!__pyx_tuple__197)) __PYX_ERR(0, 3562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__197);
  __Pyx_GIVEREF(__pyx_tuple__197);
  __pyx_codeobj__198 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_sub, 3562, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__198)) __PYX_ERR(0, 3562, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3567
 *         return r
 * 
 *     def symmetric_difference(self, other):             # <<<<<<<<<<<<<<
 *         return self ^ other
 * 
 */
  __pyx_tuple__199 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__199)) __PYX_ERR(0, 3567, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__199);
  __Pyx_GIVEREF(__pyx_tuple__199);
  __pyx_codeobj__200 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__199, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_symmetric_difference, 3567, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__200)) __PYX_ERR(0, 3567, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3570
 *         return self ^ other
 * 
 *     def __xor__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask ^= self.mask
 */
  __pyx_tuple__201 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_r); if (unlikely(!__pyx_tuple__201)) __PYX_ERR(0, 3570, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__201);
  __Pyx_GIVEREF(__pyx_tuple__201);
  __pyx_codeobj__202 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__201, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_xor, 3570, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__202)) __PYX_ERR(0, 3570, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3575
 *         return r
 * 
 *     def copy(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask)
 * 
 */
  __pyx_tuple__203 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__203)) __PYX_ERR(0, 3575, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__203);
  __Pyx_GIVEREF(__pyx_tuple__203);
  __pyx_codeobj__204 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__203, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_copy_2, 3575, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__204)) __PYX_ERR(0, 3575, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3580
 *     # set
 * 
 *     def update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self |= other
 */
  __pyx_tuple__205 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_others, __pyx_n_s_other); if (unlikely(!__pyx_tuple__205)) __PYX_ERR(0, 3580, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__205);
  __Pyx_GIVEREF(__pyx_tuple__205);
  __pyx_codeobj__206 = (PyObject*)__Pyx_PyCode_New(1, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__205, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_update, 3580, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__206)) __PYX_ERR(0, 3580, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3584
 *             self |= other
 * 
 *     def __ior__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask |= SquareSet(other).mask
 *         return self
 */
  __pyx_tuple__207 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__207)) __PYX_ERR(0, 3584, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__207);
  __Pyx_GIVEREF(__pyx_tuple__207);
  __pyx_codeobj__208 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__207, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_ior, 3584, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__208)) __PYX_ERR(0, 3584, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3588
 *         return self
 * 
 *     def intersection_update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self &= other
 */
  __pyx_tuple__209 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_others, __pyx_n_s_other); if (unlikely(!__pyx_tuple__209)) __PYX_ERR(0, 3588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__209);
  __Pyx_GIVEREF(__pyx_tuple__209);
  __pyx_codeobj__210 = (PyObject*)__Pyx_PyCode_New(1, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__209, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_intersection_update, 3588, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__210)) __PYX_ERR(0, 3588, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3592
 *             self &= other
 * 
 *     def __iand__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= SquareSet(other).mask
 *         return self
 */
  __pyx_tuple__211 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__211)) __PYX_ERR(0, 3592, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__211);
  __Pyx_GIVEREF(__pyx_tuple__211);
  __pyx_codeobj__212 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__211, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_iand, 3592, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__212)) __PYX_ERR(0, 3592, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3596
 *         return self
 * 
 *     def difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self -= other
 * 
 */
  __pyx_tuple__213 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__213)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__213);
  __Pyx_GIVEREF(__pyx_tuple__213);
  __pyx_codeobj__214 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__213, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_difference_update, 3596, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__214)) __PYX_ERR(0, 3596, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3599
 *         self -= other
 * 
 *     def __isub__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= ~SquareSet(other).mask
 *         return self
 */
  __pyx_tuple__215 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__215)) __PYX_ERR(0, 3599, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__215);
  __Pyx_GIVEREF(__pyx_tuple__215);
  __pyx_codeobj__216 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__215, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_isub, 3599, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__216)) __PYX_ERR(0, 3599, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3603
 *         return self
 * 
 *     def symmetric_difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self ^= other
 * 
 */
  __pyx_tuple__217 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__217)) __PYX_ERR(0, 3603, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__217);
  __Pyx_GIVEREF(__pyx_tuple__217);
  __pyx_codeobj__218 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__217, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_symmetric_difference_update, 3603, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__218)) __PYX_ERR(0, 3603, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3606
 *         self ^= other
 * 
 *     def __ixor__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask ^= SquareSet(other).mask
 *         return self
 */
  __pyx_tuple__219 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__219)) __PYX_ERR(0, 3606, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__219);
  __Pyx_GIVEREF(__pyx_tuple__219);
  __pyx_codeobj__220 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__219, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_ixor, 3606, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__220)) __PYX_ERR(0, 3606, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3610
 *         return self
 * 
 *     def remove(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set.
 */
  __pyx_tuple__221 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_square, __pyx_n_s_mask); if (unlikely(!__pyx_tuple__221)) __PYX_ERR(0, 3610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__221);
  __Pyx_GIVEREF(__pyx_tuple__221);
  __pyx_codeobj__222 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__221, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_remove, 3610, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__222)) __PYX_ERR(0, 3610, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3622
 *             raise KeyError(square)
 * 
 *     def pop(self):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set and returns it.
 */
  __pyx_tuple__223 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_square); if (unlikely(!__pyx_tuple__223)) __PYX_ERR(0, 3622, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__223);
  __Pyx_GIVEREF(__pyx_tuple__223);
  __pyx_codeobj__224 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__223, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_pop, 3622, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__224)) __PYX_ERR(0, 3622, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3635
 *         return square
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         """Remove all elements from this set."""
 *         self.mask = BB_EMPTY
 */
  __pyx_tuple__225 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__225)) __PYX_ERR(0, 3635, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__225);
  __Pyx_GIVEREF(__pyx_tuple__225);
  __pyx_codeobj__226 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__225, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_clear, 3635, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__226)) __PYX_ERR(0, 3635, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3641
 *     # SquareSet
 * 
 *     def carry_rippler(self):             # <<<<<<<<<<<<<<
 *         """Iterator over the subsets of this set."""
 *         return _carry_rippler(self.mask)
 */
  __pyx_tuple__227 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__227)) __PYX_ERR(0, 3641, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__227);
  __Pyx_GIVEREF(__pyx_tuple__227);
  __pyx_codeobj__228 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__227, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_carry_rippler_2, 3641, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__228)) __PYX_ERR(0, 3641, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3645
 *         return _carry_rippler(self.mask)
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         """Returns a vertically mirrored copy of this square set."""
 *         return SquareSet(flip_vertical(self.mask))
 */
  __pyx_tuple__229 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__229)) __PYX_ERR(0, 3645, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__229);
  __Pyx_GIVEREF(__pyx_tuple__229);
  __pyx_codeobj__230 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__229, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_mirror, 3645, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__230)) __PYX_ERR(0, 3645, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3649
 *         return SquareSet(flip_vertical(self.mask))
 * 
 *     def tolist(self):             # <<<<<<<<<<<<<<
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64
 */
  __pyx_tuple__231 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_l, __pyx_n_s_square); if (unlikely(!__pyx_tuple__231)) __PYX_ERR(0, 3649, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__231);
  __Pyx_GIVEREF(__pyx_tuple__231);
  __pyx_codeobj__232 = (PyObject*)__Pyx_PyCode_New(1, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__231, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_tolist, 3649, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__232)) __PYX_ERR(0, 3649, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3656
 *         return l
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return bool(self.mask)
 * 
 */
  __pyx_tuple__233 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__233)) __PYX_ERR(0, 3656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__233);
  __Pyx_GIVEREF(__pyx_tuple__233);
  __pyx_codeobj__234 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__233, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_bool, 3656, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__234)) __PYX_ERR(0, 3656, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3659
 *         return bool(self.mask)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */
  __pyx_tuple__235 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_ne_2); if (unlikely(!__pyx_tuple__235)) __PYX_ERR(0, 3659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__235);
  __Pyx_GIVEREF(__pyx_tuple__235);
  __pyx_codeobj__236 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__235, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_eq, 3659, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__236)) __PYX_ERR(0, 3659, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3663
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             return self.mask != SquareSet(other).mask
 */
  __pyx_tuple__237 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_other); if (unlikely(!__pyx_tuple__237)) __PYX_ERR(0, 3663, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__237);
  __Pyx_GIVEREF(__pyx_tuple__237);
  __pyx_codeobj__238 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__237, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_ne, 3663, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__238)) __PYX_ERR(0, 3663, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3669
 *             return NotImplemented
 * 
 *     def __lshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 */
  __pyx_tuple__239 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_shift); if (unlikely(!__pyx_tuple__239)) __PYX_ERR(0, 3669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__239);
  __Pyx_GIVEREF(__pyx_tuple__239);
  __pyx_codeobj__240 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__239, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_lshift, 3669, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__240)) __PYX_ERR(0, 3669, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3672
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 *     def __rshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask >> shift)
 * 
 */
  __pyx_tuple__241 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_shift); if (unlikely(!__pyx_tuple__241)) __PYX_ERR(0, 3672, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__241);
  __Pyx_GIVEREF(__pyx_tuple__241);
  __pyx_codeobj__242 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__241, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_rshift, 3672, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__242)) __PYX_ERR(0, 3672, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3675
 *         return SquareSet(self.mask >> shift)
 * 
 *     def __ilshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask = (self.mask << shift) & BB_ALL
 *         return self
 */
  __pyx_tuple__243 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_shift); if (unlikely(!__pyx_tuple__243)) __PYX_ERR(0, 3675, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__243);
  __Pyx_GIVEREF(__pyx_tuple__243);
  __pyx_codeobj__244 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__243, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_ilshift, 3675, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__244)) __PYX_ERR(0, 3675, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3679
 *         return self
 * 
 *     def __irshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask >>= shift
 *         return self
 */
  __pyx_tuple__245 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_shift); if (unlikely(!__pyx_tuple__245)) __PYX_ERR(0, 3679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__245);
  __Pyx_GIVEREF(__pyx_tuple__245);
  __pyx_codeobj__246 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__245, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_irshift, 3679, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__246)) __PYX_ERR(0, 3679, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3683
 *         return self
 * 
 *     def __invert__(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 */
  __pyx_tuple__247 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__247)) __PYX_ERR(0, 3683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__247);
  __Pyx_GIVEREF(__pyx_tuple__247);
  __pyx_codeobj__248 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__247, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_invert, 3683, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__248)) __PYX_ERR(0, 3683, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3686
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 *     def __int__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */
  __pyx_tuple__249 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__249)) __PYX_ERR(0, 3686, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__249);
  __Pyx_GIVEREF(__pyx_tuple__249);
  __pyx_codeobj__250 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__249, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_int, 3686, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__250)) __PYX_ERR(0, 3686, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3689
 *         return self.mask
 * 
 *     def __index__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */
  __pyx_tuple__251 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__251)) __PYX_ERR(0, 3689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__251);
  __Pyx_GIVEREF(__pyx_tuple__251);
  __pyx_codeobj__252 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__251, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_index_2, 3689, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__252)) __PYX_ERR(0, 3689, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3692
 *         return self.mask
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 */
  __pyx_tuple__253 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__253)) __PYX_ERR(0, 3692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__253);
  __Pyx_GIVEREF(__pyx_tuple__253);
  __pyx_codeobj__254 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__253, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_repr, 3692, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__254)) __PYX_ERR(0, 3692, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3695
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 */
  __pyx_tuple__255 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_square, __pyx_n_s_mask); if (unlikely(!__pyx_tuple__255)) __PYX_ERR(0, 3695, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__255);
  __Pyx_GIVEREF(__pyx_tuple__255);
  __pyx_codeobj__256 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__255, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_str, 3695, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__256)) __PYX_ERR(0, 3695, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3713
 *         return "".join(builder)
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.board(squares=self, size=400)
 */
  __pyx_tuple__257 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_chess); if (unlikely(!__pyx_tuple__257)) __PYX_ERR(0, 3713, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__257);
  __Pyx_GIVEREF(__pyx_tuple__257);
  __pyx_codeobj__258 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__257, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_repr_svg, 3713, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__258)) __PYX_ERR(0, 3713, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3718
 * 
 *     @classmethod
 *     def from_square(cls, square):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.SquareSet` from a single square.
 */
  __pyx_tuple__259 = PyTuple_Pack(2, __pyx_n_s_cls, __pyx_n_s_square); if (unlikely(!__pyx_tuple__259)) __PYX_ERR(0, 3718, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__259);
  __Pyx_GIVEREF(__pyx_tuple__259);
  __pyx_codeobj__260 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__259, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_chess___init__cp_pyx, __pyx_n_s_from_square, 3718, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__260)) __PYX_ERR(0, 3718, __pyx_L1_error)

  /* "(tree fragment)":1
 * def __pyx_unpickle_Move(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */
  __pyx_tuple__261 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__261)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__261);
  __Pyx_GIVEREF(__pyx_tuple__261);
  __pyx_codeobj__262 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__261, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Move, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__262)) __PYX_ERR(1, 1, __pyx_L1_error)
  __pyx_tuple__263 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__263)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__263);
  __Pyx_GIVEREF(__pyx_tuple__263);
  __pyx_codeobj__264 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__263, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_BaseBoard, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__264)) __PYX_ERR(1, 1, __pyx_L1_error)
  __pyx_tuple__265 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__265)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__265);
  __Pyx_GIVEREF(__pyx_tuple__265);
  __pyx_codeobj__266 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__265, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Board, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__266)) __PYX_ERR(1, 1, __pyx_L1_error)
  __pyx_tuple__267 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__267)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__267);
  __Pyx_GIVEREF(__pyx_tuple__267);
  __pyx_codeobj__268 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__267, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_PseudoLegalMoveGe, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__268)) __PYX_ERR(1, 1, __pyx_L1_error)
  __pyx_tuple__269 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__269)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__269);
  __Pyx_GIVEREF(__pyx_tuple__269);
  __pyx_codeobj__270 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__269, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_LegalMoveGenerato, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__270)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
  __pyx_umethod_PyList_Type_pop.type = (PyObject*)&PyList_Type;
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_6 = PyInt_FromLong(6); if (unlikely(!__pyx_int_6)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_7 = PyInt_FromLong(7); if (unlikely(!__pyx_int_7)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_8 = PyInt_FromLong(8); if (unlikely(!__pyx_int_8)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_9 = PyInt_FromLong(9); if (unlikely(!__pyx_int_9)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_10 = PyInt_FromLong(10); if (unlikely(!__pyx_int_10)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_14 = PyInt_FromLong(14); if (unlikely(!__pyx_int_14)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_15 = PyInt_FromLong(15); if (unlikely(!__pyx_int_15)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_16 = PyInt_FromLong(16); if (unlikely(!__pyx_int_16)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_17 = PyInt_FromLong(17); if (unlikely(!__pyx_int_17)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_18 = PyInt_FromLong(18); if (unlikely(!__pyx_int_18)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_28 = PyInt_FromLong(28); if (unlikely(!__pyx_int_28)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_32 = PyInt_FromLong(32); if (unlikely(!__pyx_int_32)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_36 = PyInt_FromLong(36); if (unlikely(!__pyx_int_36)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_45 = PyInt_FromLong(45); if (unlikely(!__pyx_int_45)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_56 = PyInt_FromLong(56); if (unlikely(!__pyx_int_56)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_64 = PyInt_FromLong(64); if (unlikely(!__pyx_int_64)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_96 = PyInt_FromLong(96); if (unlikely(!__pyx_int_96)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_128 = PyInt_FromLong(128); if (unlikely(!__pyx_int_128)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_255 = PyInt_FromLong(255); if (unlikely(!__pyx_int_255)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_256 = PyInt_FromLong(256); if (unlikely(!__pyx_int_256)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_400 = PyInt_FromLong(400); if (unlikely(!__pyx_int_400)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_512 = PyInt_FromLong(512); if (unlikely(!__pyx_int_512)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_959 = PyInt_FromLong(959); if (unlikely(!__pyx_int_959)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1024 = PyInt_FromLong(1024); if (unlikely(!__pyx_int_1024)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_2048 = PyInt_FromLong(2048); if (unlikely(!__pyx_int_2048)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_4096 = PyInt_FromLong(4096); if (unlikely(!__pyx_int_4096)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_8192 = PyInt_FromLong(8192); if (unlikely(!__pyx_int_8192)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_16384 = PyInt_FromLong(16384L); if (unlikely(!__pyx_int_16384)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_56827727 = PyInt_FromLong(56827727L); if (unlikely(!__pyx_int_56827727)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_95108563 = PyInt_FromLong(95108563L); if (unlikely(!__pyx_int_95108563)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_222419149 = PyInt_FromLong(222419149L); if (unlikely(!__pyx_int_222419149)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_4294967295 = PyInt_FromString((char *)"4294967295", 0, 0); if (unlikely(!__pyx_int_4294967295)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_281470681808895 = PyInt_FromString((char *)"281470681808895", 0, 0); if (unlikely(!__pyx_int_281470681808895)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_71777214294589695 = PyInt_FromString((char *)"71777214294589695", 0, 0); if (unlikely(!__pyx_int_71777214294589695)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_72340172838076673 = PyInt_FromString((char *)"72340172838076673", 0, 0); if (unlikely(!__pyx_int_72340172838076673)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1085102592318504960 = PyInt_FromString((char *)"1085102592318504960", 0, 0); if (unlikely(!__pyx_int_1085102592318504960)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1085102592571150095 = PyInt_FromString((char *)"1085102592571150095", 0, 0); if (unlikely(!__pyx_int_1085102592571150095)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_3689292520605548544 = PyInt_FromString((char *)"3689292520605548544", 0, 0); if (unlikely(!__pyx_int_3689292520605548544)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_3689348814741910323 = PyInt_FromString((char *)"3689348814741910323", 0, 0); if (unlikely(!__pyx_int_3689348814741910323)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_6124988953138320640 = PyInt_FromString((char *)"6124988953138320640", 0, 0); if (unlikely(!__pyx_int_6124988953138320640)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_6148914691236517205 = PyInt_FromString((char *)"6148914691236517205", 0, 0); if (unlikely(!__pyx_int_6148914691236517205)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_6172840429334713770 = PyInt_FromString((char *)"6172840429334713770", 0, 0); if (unlikely(!__pyx_int_6172840429334713770)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_12249977906276641280 = PyInt_FromString((char *)"12249977906276641280", 0, 0); if (unlikely(!__pyx_int_12249977906276641280)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_12273903644374837845 = PyInt_FromString((char *)"12273903644374837845", 0, 0); if (unlikely(!__pyx_int_12273903644374837845)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_14757170082422194176 = PyInt_FromString((char *)"14757170082422194176", 0, 0); if (unlikely(!__pyx_int_14757170082422194176)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_17361641477348724495 = PyInt_FromString((char *)"17361641477348724495", 0, 0); if (unlikely(!__pyx_int_17361641477348724495)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_6 = PyInt_FromLong(-6); if (unlikely(!__pyx_int_neg_6)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_7 = PyInt_FromLong(-7); if (unlikely(!__pyx_int_neg_7)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_8 = PyInt_FromLong(-8); if (unlikely(!__pyx_int_neg_8)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_9 = PyInt_FromLong(-9); if (unlikely(!__pyx_int_neg_9)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_10 = PyInt_FromLong(-10); if (unlikely(!__pyx_int_neg_10)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_15 = PyInt_FromLong(-15); if (unlikely(!__pyx_int_neg_15)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_16 = PyInt_FromLong(-16); if (unlikely(!__pyx_int_neg_16)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_17 = PyInt_FromLong(-17); if (unlikely(!__pyx_int_neg_17)) __PYX_ERR(0, 1, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}

static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_variable_export_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_function_export_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_type_init_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_type_import_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_function_import_code(void); /*proto*/

static int __Pyx_modinit_global_init_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_global_init_code", 0);
  /*--- Global init code ---*/
  __pyx_7genexpr__pyx_v_5chess_10__init__cp_r = Py_None; Py_INCREF(Py_None);
  __pyx_7genexpr__pyx_v_5chess_10__init__cp_f = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr3__pyx_v_5chess_10__init__cp_i = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr4__pyx_v_5chess_10__init__cp_i = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas = Py_None; Py_INCREF(Py_None);
  __pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq = Py_None; Py_INCREF(Py_None);
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_variable_export_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_variable_export_code", 0);
  /*--- Variable export code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_function_export_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_function_export_code", 0);
  /*--- Function export code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_type_init_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
  /*--- Type init code ---*/
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp_Move) < 0) __PYX_ERR(0, 450, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp_Move.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp_Move.tp_dictoffset && __pyx_type_5chess_10__init__cp_Move.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp_Move.tp_getattro = __Pyx_PyObject_GenericGetAttr;
  }
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Move, (PyObject *)&__pyx_type_5chess_10__init__cp_Move) < 0) __PYX_ERR(0, 450, __pyx_L1_error)
  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_5chess_10__init__cp_Move) < 0) __PYX_ERR(0, 450, __pyx_L1_error)
  __pyx_ptype_5chess_10__init__cp_Move = &__pyx_type_5chess_10__init__cp_Move;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp_BaseBoard) < 0) __PYX_ERR(0, 565, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp_BaseBoard.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp_BaseBoard.tp_dictoffset && __pyx_type_5chess_10__init__cp_BaseBoard.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp_BaseBoard.tp_getattro = __Pyx_PyObject_GenericGetAttr;
  }
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_BaseBoard, (PyObject *)&__pyx_type_5chess_10__init__cp_BaseBoard) < 0) __PYX_ERR(0, 565, __pyx_L1_error)
  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_5chess_10__init__cp_BaseBoard) < 0) __PYX_ERR(0, 565, __pyx_L1_error)
  __pyx_ptype_5chess_10__init__cp_BaseBoard = &__pyx_type_5chess_10__init__cp_BaseBoard;
  __pyx_type_5chess_10__init__cp_Board.tp_base = __pyx_ptype_5chess_10__init__cp_BaseBoard;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp_Board) < 0) __PYX_ERR(0, 1402, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp_Board.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp_Board.tp_dictoffset && __pyx_type_5chess_10__init__cp_Board.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp_Board.tp_getattro = __Pyx_PyObject_GenericGetAttr;
  }
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Board, (PyObject *)&__pyx_type_5chess_10__init__cp_Board) < 0) __PYX_ERR(0, 1402, __pyx_L1_error)
  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_5chess_10__init__cp_Board) < 0) __PYX_ERR(0, 1402, __pyx_L1_error)
  __pyx_ptype_5chess_10__init__cp_Board = &__pyx_type_5chess_10__init__cp_Board;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator) < 0) __PYX_ERR(0, 3363, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator.tp_dictoffset && __pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator.tp_getattro = __Pyx_PyObject_GenericGetAttr;
  }
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_PseudoLegalMoveGenerator, (PyObject *)&__pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator) < 0) __PYX_ERR(0, 3363, __pyx_L1_error)
  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator) < 0) __PYX_ERR(0, 3363, __pyx_L1_error)
  __pyx_ptype_5chess_10__init__cp_PseudoLegalMoveGenerator = &__pyx_type_5chess_10__init__cp_PseudoLegalMoveGenerator;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp_LegalMoveGenerator) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp_LegalMoveGenerator.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp_LegalMoveGenerator.tp_dictoffset && __pyx_type_5chess_10__init__cp_LegalMoveGenerator.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp_LegalMoveGenerator.tp_getattro = __Pyx_PyObject_GenericGetAttr;
  }
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_LegalMoveGenerator, (PyObject *)&__pyx_type_5chess_10__init__cp_LegalMoveGenerator) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_5chess_10__init__cp_LegalMoveGenerator) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  __pyx_ptype_5chess_10__init__cp_LegalMoveGenerator = &__pyx_type_5chess_10__init__cp_LegalMoveGenerator;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward) < 0) __PYX_ERR(0, 202, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct__scan_forward = &__pyx_type_5chess_10__init__cp___pyx_scope_struct__scan_forward;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed) < 0) __PYX_ERR(0, 211, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_1_scan_reversed;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler) < 0) __PYX_ERR(0, 322, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_2__carry_rippler;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves) < 0) __PYX_ERR(0, 1517, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_3_generate_pseudo_legal_moves;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep) < 0) __PYX_ERR(0, 1584, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_4_generate_pseudo_legal_ep;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen) < 0) __PYX_ERR(0, 2077, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_5_castling_xfen;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr) < 0) __PYX_ERR(0, 2094, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_6_genexpr = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_6_genexpr;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd) < 0) __PYX_ERR(0, 2493, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_7_set_epd = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_7_set_epd;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san) < 0) __PYX_ERR(0, 2659, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_8_parse_san = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_8_parse_san;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr) < 0) __PYX_ERR(0, 2671, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_9_genexpr = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_9_genexpr;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr) < 0) __PYX_ERR(0, 2673, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_10_genexpr = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_10_genexpr;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions) < 0) __PYX_ERR(0, 3133, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_11__generate_evasions;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves) < 0) __PYX_ERR(0, 3158, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_12_generate_legal_moves;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep) < 0) __PYX_ERR(0, 3178, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_13_generate_legal_ep;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king) < 0) __PYX_ERR(0, 3191, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_14__attacked_for_king;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr) < 0) __PYX_ERR(0, 3192, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_15_genexpr = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_15_genexpr;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves) < 0) __PYX_ERR(0, 3201, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_16_generate_castling_moves;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__) < 0) __PYX_ERR(0, 3413, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_17___repr__ = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_17___repr__;
  if (PyType_Ready(&__pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr) < 0) __PYX_ERR(0, 3414, __pyx_L1_error)
  __pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr.tp_print = 0;
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr.tp_dictoffset && __pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  __pyx_ptype_5chess_10__init__cp___pyx_scope_struct_18_genexpr = &__pyx_type_5chess_10__init__cp___pyx_scope_struct_18_genexpr;
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_modinit_type_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
  /*--- Type import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_variable_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_variable_import_code", 0);
  /*--- Variable import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_function_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
  /*--- Function import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}


#if PY_MAJOR_VERSION < 3
#ifdef CYTHON_NO_PYINIT_EXPORT
#define __Pyx_PyMODINIT_FUNC void
#else
#define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
#endif
#else
#ifdef CYTHON_NO_PYINIT_EXPORT
#define __Pyx_PyMODINIT_FUNC PyObject *
#else
#define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
#endif
#endif


#if PY_MAJOR_VERSION < 3
__Pyx_PyMODINIT_FUNC init__init__cp(void) CYTHON_SMALL_CODE; /*proto*/
__Pyx_PyMODINIT_FUNC init__init__cp(void)
#else
__Pyx_PyMODINIT_FUNC PyInit___init__cp(void) CYTHON_SMALL_CODE; /*proto*/
__Pyx_PyMODINIT_FUNC PyInit___init__cp(void)
#if CYTHON_PEP489_MULTI_PHASE_INIT
{
  return PyModuleDef_Init(&__pyx_moduledef);
}
static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
    #if PY_VERSION_HEX >= 0x030700A1
    static PY_INT64_T main_interpreter_id = -1;
    PY_INT64_T current_id = PyInterpreterState_GetID(PyThreadState_Get()->interp);
    if (main_interpreter_id == -1) {
        main_interpreter_id = current_id;
        return (unlikely(current_id == -1)) ? -1 : 0;
    } else if (unlikely(main_interpreter_id != current_id))
    #else
    static PyInterpreterState *main_interpreter = NULL;
    PyInterpreterState *current_interpreter = PyThreadState_Get()->interp;
    if (!main_interpreter) {
        main_interpreter = current_interpreter;
    } else if (unlikely(main_interpreter != current_interpreter))
    #endif
    {
        PyErr_SetString(
            PyExc_ImportError,
            "Interpreter change detected - this module can only be loaded into one interpreter per process.");
        return -1;
    }
    return 0;
}
static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none) {
    PyObject *value = PyObject_GetAttrString(spec, from_name);
    int result = 0;
    if (likely(value)) {
        if (allow_none || value != Py_None) {
            result = PyDict_SetItemString(moddict, to_name, value);
        }
        Py_DECREF(value);
    } else if (PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Clear();
    } else {
        result = -1;
    }
    return result;
}
static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, CYTHON_UNUSED PyModuleDef *def) {
    PyObject *module = NULL, *moddict, *modname;
    if (__Pyx_check_single_interpreter())
        return NULL;
    if (__pyx_m)
        return __Pyx_NewRef(__pyx_m);
    modname = PyObject_GetAttrString(spec, "name");
    if (unlikely(!modname)) goto bad;
    module = PyModule_NewObject(modname);
    Py_DECREF(modname);
    if (unlikely(!module)) goto bad;
    moddict = PyModule_GetDict(module);
    if (unlikely(!moddict)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "loader", "__loader__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "origin", "__file__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "parent", "__package__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "submodule_search_locations", "__path__", 0) < 0)) goto bad;
    return module;
bad:
    Py_XDECREF(module);
    return NULL;
}


static CYTHON_SMALL_CODE int __pyx_pymod_exec___init__cp(PyObject *__pyx_pyinit_module)
#endif
#endif
{
  PyObject *__pyx_t_1 = NULL;
  static int __pyx_t_2[2];
  static char *__pyx_t_3[2];
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *(*__pyx_t_12)(PyObject *);
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_t_16;
  PyObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  PyObject *__pyx_t_20 = NULL;
  PyObject *__pyx_t_21 = NULL;
  PyObject *__pyx_t_22 = NULL;
  PyObject *__pyx_t_23 = NULL;
  PyObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  PyObject *__pyx_t_26 = NULL;
  PyObject *__pyx_t_27 = NULL;
  PyObject *__pyx_t_28 = NULL;
  PyObject *__pyx_t_29 = NULL;
  PyObject *__pyx_t_30 = NULL;
  PyObject *__pyx_t_31 = NULL;
  PyObject *__pyx_t_32 = NULL;
  PyObject *__pyx_t_33 = NULL;
  PyObject *__pyx_t_34 = NULL;
  PyObject *__pyx_t_35 = NULL;
  PyObject *__pyx_t_36 = NULL;
  PyObject *__pyx_t_37 = NULL;
  PyObject *__pyx_t_38 = NULL;
  PyObject *__pyx_t_39 = NULL;
  PyObject *__pyx_t_40 = NULL;
  PyObject *__pyx_t_41 = NULL;
  PyObject *__pyx_t_42 = NULL;
  PyObject *__pyx_t_43 = NULL;
  PyObject *__pyx_t_44 = NULL;
  PyObject *__pyx_t_45 = NULL;
  PyObject *__pyx_t_46 = NULL;
  PyObject *__pyx_t_47 = NULL;
  PyObject *__pyx_t_48 = NULL;
  PyObject *__pyx_t_49 = NULL;
  PyObject *__pyx_t_50 = NULL;
  PyObject *__pyx_t_51 = NULL;
  PyObject *__pyx_t_52 = NULL;
  PyObject *__pyx_t_53 = NULL;
  PyObject *__pyx_t_54 = NULL;
  PyObject *__pyx_t_55 = NULL;
  PyObject *__pyx_t_56 = NULL;
  PyObject *__pyx_t_57 = NULL;
  PyObject *__pyx_t_58 = NULL;
  PyObject *__pyx_t_59 = NULL;
  PyObject *__pyx_t_60 = NULL;
  PyObject *__pyx_t_61 = NULL;
  PyObject *__pyx_t_62 = NULL;
  PyObject *__pyx_t_63 = NULL;
  PyObject *__pyx_t_64 = NULL;
  PyObject *__pyx_t_65 = NULL;
  PyObject *__pyx_t_66 = NULL;
  PyObject *__pyx_t_67 = NULL;
  PyObject *__pyx_t_68 = NULL;
  PyObject *__pyx_t_69 = NULL;
  PyObject *__pyx_t_70 = NULL;
  PyObject *__pyx_t_71 = NULL;
  PyObject *__pyx_t_72 = NULL;
  PyObject *__pyx_t_73 = NULL;
  PyObject *__pyx_t_74 = NULL;
  Py_ssize_t __pyx_t_75;
  PyObject *(*__pyx_t_76)(PyObject *);
  Py_ssize_t __pyx_t_77;
  PyObject *(*__pyx_t_78)(PyObject *);
  long __pyx_t_79;
  __Pyx_RefNannyDeclarations
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  if (__pyx_m) {
    if (__pyx_m == __pyx_pyinit_module) return 0;
    PyErr_SetString(PyExc_RuntimeError, "Module '__init__cp' has already been imported. Re-initialisation is not supported.");
    return -1;
  }
  #elif PY_MAJOR_VERSION >= 3
  if (__pyx_m) return __Pyx_NewRef(__pyx_m);
  #endif
  #if CYTHON_REFNANNY
__Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
if (!__Pyx_RefNanny) {
  PyErr_Clear();
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
  if (!__Pyx_RefNanny)
      Py_FatalError("failed to import 'refnanny' module");
}
#endif
  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit___init__cp(void)", 0);
  if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pxy_PyFrame_Initialize_Offsets
  __Pxy_PyFrame_Initialize_Offsets();
  #endif
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pyx_CyFunction_USED
  if (__pyx_CyFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Coroutine_USED
  if (__pyx_Coroutine_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_AsyncGen_USED
  if (__pyx_AsyncGen_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_StopAsyncIteration_USED
  if (__pyx_StopAsyncIteration_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  __pyx_m = __pyx_pyinit_module;
  Py_INCREF(__pyx_m);
  #else
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("__init__cp", __pyx_methods, __pyx_k_A_pure_Python_chess_library_wit, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
  Py_INCREF(__pyx_d);
  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
  #if CYTHON_COMPILING_IN_PYPY
  Py_INCREF(__pyx_b);
  #endif
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  /*--- Initialize various global constants etc. ---*/
  if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  if (__pyx_module_is_main_chess____init__cp) {
    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  }
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
    if (!PyDict_GetItemString(modules, "chess.__init__cp")) {
      if (unlikely(PyDict_SetItemString(modules, "chess.__init__cp", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
    }
  }
  #endif
  /*--- Builtin init code ---*/
  if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Constants init code ---*/
  if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Global type/function init code ---*/
  (void)__Pyx_modinit_global_init_code();
  (void)__Pyx_modinit_variable_export_code();
  (void)__Pyx_modinit_function_export_code();
  if (unlikely(__Pyx_modinit_type_init_code() != 0)) goto __pyx_L1_error;
  (void)__Pyx_modinit_type_import_code();
  (void)__Pyx_modinit_variable_import_code();
  (void)__Pyx_modinit_function_import_code();
  /*--- Execution code ---*/
  #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
  if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif

  /* "chess/__init__cp.pyx":27
 * """
 * 
 * __version__ = "0.24.1"             # <<<<<<<<<<<<<<
 * 
 * import collections
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_version, __pyx_kp_u_0_24_1) < 0) __PYX_ERR(0, 27, __pyx_L1_error)

  /* "chess/__init__cp.pyx":29
 * __version__ = "0.24.1"
 * 
 * import collections             # <<<<<<<<<<<<<<
 * import collections.abc
 * import copy
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_collections, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_collections, __pyx_t_1) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":30
 * 
 * import collections
 * import collections.abc             # <<<<<<<<<<<<<<
 * import copy
 * import enum
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_collections_abc, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_collections, __pyx_t_1) < 0) __PYX_ERR(0, 30, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":31
 * import collections
 * import collections.abc
 * import copy             # <<<<<<<<<<<<<<
 * import enum
 * import re
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_copy_2, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 31, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_copy_2, __pyx_t_1) < 0) __PYX_ERR(0, 31, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":32
 * import collections.abc
 * import copy
 * import enum             # <<<<<<<<<<<<<<
 * import re
 * import itertools
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_enum, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_enum, __pyx_t_1) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":33
 * import copy
 * import enum
 * import re             # <<<<<<<<<<<<<<
 * import itertools
 * 
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_re, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_re, __pyx_t_1) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":34
 * import enum
 * import re
 * import itertools             # <<<<<<<<<<<<<<
 * 
 * cdef bint COLORS[2]
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_itertools, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_itertools, __pyx_t_1) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":43
 * DEF BLACK = False
 * 
 * COLORS = [WHITE, BLACK]             # <<<<<<<<<<<<<<
 * COLOR_NAMES = ["black", "white"]
 * Color = bool
 */
  __pyx_t_2[0] = 1;
  __pyx_t_2[1] = 0;
  memcpy(&(__pyx_v_5chess_10__init__cp_COLORS[0]), __pyx_t_2, sizeof(__pyx_v_5chess_10__init__cp_COLORS[0]) * (2));

  /* "chess/__init__cp.pyx":44
 * 
 * COLORS = [WHITE, BLACK]
 * COLOR_NAMES = ["black", "white"]             # <<<<<<<<<<<<<<
 * Color = bool
 * 
 */
  __pyx_t_3[0] = ((char *)"black");
  __pyx_t_3[1] = ((char *)"white");
  __pyx_v_5chess_10__init__cp_COLOR_NAMES = __pyx_t_3;

  /* "chess/__init__cp.pyx":45
 * COLORS = [WHITE, BLACK]
 * COLOR_NAMES = ["black", "white"]
 * Color = bool             # <<<<<<<<<<<<<<
 * 
 * PIECE_TYPES = [PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING] = range(1, 7)
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(((PyObject*)&PyBool_Type)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 45, __pyx_L1_error)
  __pyx_v_5chess_10__init__cp_Color = __pyx_t_4;

  /* "chess/__init__cp.pyx":47
 * Color = bool
 * 
 * PIECE_TYPES = [PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING] = range(1, 7)             # <<<<<<<<<<<<<<
 * PIECE_SYMBOLS = [None, "p", "n", "b", "r", "q", "k"]
 * PIECE_NAMES = [None, "pawn", "knight", "bishop", "rook", "queen", "king"]
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_tuple__64, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PIECE_TYPES, __pyx_t_1) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 6)) {
      if (size > 6) __Pyx_RaiseTooManyValuesError(6);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 47, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
      __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
      __pyx_t_8 = PyTuple_GET_ITEM(sequence, 3); 
      __pyx_t_9 = PyTuple_GET_ITEM(sequence, 4); 
      __pyx_t_10 = PyTuple_GET_ITEM(sequence, 5); 
    } else {
      __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
      __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
      __pyx_t_8 = PyList_GET_ITEM(sequence, 3); 
      __pyx_t_9 = PyList_GET_ITEM(sequence, 4); 
      __pyx_t_10 = PyList_GET_ITEM(sequence, 5); 
    }
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_t_10);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[6] = {&__pyx_t_5,&__pyx_t_6,&__pyx_t_7,&__pyx_t_8,&__pyx_t_9,&__pyx_t_10};
      for (i=0; i < 6; i++) {
        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 47, __pyx_L1_error)
        __Pyx_GOTREF(item);
        *(temps[i]) = item;
      }
    }
    #endif
  } else {
    Py_ssize_t index = -1;
    PyObject** temps[6] = {&__pyx_t_5,&__pyx_t_6,&__pyx_t_7,&__pyx_t_8,&__pyx_t_9,&__pyx_t_10};
    __pyx_t_11 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 47, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_12 = Py_TYPE(__pyx_t_11)->tp_iternext;
    for (index=0; index < 6; index++) {
      PyObject* item = __pyx_t_12(__pyx_t_11); if (unlikely(!item)) goto __pyx_L2_unpacking_failed;
      __Pyx_GOTREF(item);
      *(temps[index]) = item;
    }
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_11), 6) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
    __pyx_t_12 = NULL;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    goto __pyx_L3_unpacking_done;
    __pyx_L2_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_12 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 47, __pyx_L1_error)
    __pyx_L3_unpacking_done:;
  }
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PAWN, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_KNIGHT, __pyx_t_6) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BISHOP, __pyx_t_7) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ROOK, __pyx_t_8) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_QUEEN, __pyx_t_9) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_KING, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":48
 * 
 * PIECE_TYPES = [PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING] = range(1, 7)
 * PIECE_SYMBOLS = [None, "p", "n", "b", "r", "q", "k"]             # <<<<<<<<<<<<<<
 * PIECE_NAMES = [None, "pawn", "knight", "bishop", "rook", "queen", "king"]
 * PieceType = int
 */
  __pyx_t_1 = PyList_New(7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
  __Pyx_INCREF(__pyx_n_u_p);
  __Pyx_GIVEREF(__pyx_n_u_p);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_p);
  __Pyx_INCREF(__pyx_n_u_n);
  __Pyx_GIVEREF(__pyx_n_u_n);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_n);
  __Pyx_INCREF(__pyx_n_u_b);
  __Pyx_GIVEREF(__pyx_n_u_b);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_n_u_b);
  __Pyx_INCREF(__pyx_n_u_r);
  __Pyx_GIVEREF(__pyx_n_u_r);
  PyList_SET_ITEM(__pyx_t_1, 4, __pyx_n_u_r);
  __Pyx_INCREF(__pyx_n_u_q);
  __Pyx_GIVEREF(__pyx_n_u_q);
  PyList_SET_ITEM(__pyx_t_1, 5, __pyx_n_u_q);
  __Pyx_INCREF(__pyx_n_u_k);
  __Pyx_GIVEREF(__pyx_n_u_k);
  PyList_SET_ITEM(__pyx_t_1, 6, __pyx_n_u_k);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PIECE_SYMBOLS, __pyx_t_1) < 0) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":49
 * PIECE_TYPES = [PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING] = range(1, 7)
 * PIECE_SYMBOLS = [None, "p", "n", "b", "r", "q", "k"]
 * PIECE_NAMES = [None, "pawn", "knight", "bishop", "rook", "queen", "king"]             # <<<<<<<<<<<<<<
 * PieceType = int
 * 
 */
  __pyx_t_1 = PyList_New(7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
  __Pyx_INCREF(__pyx_n_u_pawn);
  __Pyx_GIVEREF(__pyx_n_u_pawn);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_pawn);
  __Pyx_INCREF(__pyx_n_u_knight);
  __Pyx_GIVEREF(__pyx_n_u_knight);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_knight);
  __Pyx_INCREF(__pyx_n_u_bishop);
  __Pyx_GIVEREF(__pyx_n_u_bishop);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_n_u_bishop);
  __Pyx_INCREF(__pyx_n_u_rook);
  __Pyx_GIVEREF(__pyx_n_u_rook);
  PyList_SET_ITEM(__pyx_t_1, 4, __pyx_n_u_rook);
  __Pyx_INCREF(__pyx_n_u_queen);
  __Pyx_GIVEREF(__pyx_n_u_queen);
  PyList_SET_ITEM(__pyx_t_1, 5, __pyx_n_u_queen);
  __Pyx_INCREF(__pyx_n_u_king);
  __Pyx_GIVEREF(__pyx_n_u_king);
  PyList_SET_ITEM(__pyx_t_1, 6, __pyx_n_u_king);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PIECE_NAMES, __pyx_t_1) < 0) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":50
 * PIECE_SYMBOLS = [None, "p", "n", "b", "r", "q", "k"]
 * PIECE_NAMES = [None, "pawn", "knight", "bishop", "rook", "queen", "king"]
 * PieceType = int             # <<<<<<<<<<<<<<
 * 
 * UNICODE_PIECE_SYMBOLS = {
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PieceType, ((PyObject *)(&PyInt_Type))) < 0) __PYX_ERR(0, 50, __pyx_L1_error)

  /* "chess/__init__cp.pyx":53
 * 
 * UNICODE_PIECE_SYMBOLS = {
 *     "R": u"", "r": u"",             # <<<<<<<<<<<<<<
 *     "N": u"", "n": u"",
 *     "B": u"", "b": u"",
 */
  __pyx_t_1 = __Pyx_PyDict_NewPresized(12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_R, __pyx_kp_u__65) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_r, __pyx_kp_u__66) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_N, __pyx_kp_u__67) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_n, __pyx_kp_u__68) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_B, __pyx_kp_u__69) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_b, __pyx_kp_u__70) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_Q, __pyx_kp_u__71) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_q, __pyx_kp_u__72) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_K, __pyx_kp_u__73) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_k, __pyx_kp_u__74) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_P, __pyx_kp_u__75) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_p, __pyx_kp_u__76) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_UNICODE_PIECE_SYMBOLS, __pyx_t_1) < 0) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":61
 * }
 * 
 * FILE_NAMES = ["a", "b", "c", "d", "e", "f", "g", "h"]             # <<<<<<<<<<<<<<
 * 
 * RANK_NAMES = ["1", "2", "3", "4", "5", "6", "7", "8"]
 */
  __pyx_t_1 = PyList_New(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 61, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_u_a);
  __Pyx_GIVEREF(__pyx_n_u_a);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_a);
  __Pyx_INCREF(__pyx_n_u_b);
  __Pyx_GIVEREF(__pyx_n_u_b);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_b);
  __Pyx_INCREF(__pyx_n_u_c);
  __Pyx_GIVEREF(__pyx_n_u_c);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_c);
  __Pyx_INCREF(__pyx_n_u_d);
  __Pyx_GIVEREF(__pyx_n_u_d);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_n_u_d);
  __Pyx_INCREF(__pyx_n_u_e);
  __Pyx_GIVEREF(__pyx_n_u_e);
  PyList_SET_ITEM(__pyx_t_1, 4, __pyx_n_u_e);
  __Pyx_INCREF(__pyx_n_u_f);
  __Pyx_GIVEREF(__pyx_n_u_f);
  PyList_SET_ITEM(__pyx_t_1, 5, __pyx_n_u_f);
  __Pyx_INCREF(__pyx_n_u_g);
  __Pyx_GIVEREF(__pyx_n_u_g);
  PyList_SET_ITEM(__pyx_t_1, 6, __pyx_n_u_g);
  __Pyx_INCREF(__pyx_n_u_h);
  __Pyx_GIVEREF(__pyx_n_u_h);
  PyList_SET_ITEM(__pyx_t_1, 7, __pyx_n_u_h);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FILE_NAMES, __pyx_t_1) < 0) __PYX_ERR(0, 61, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":63
 * FILE_NAMES = ["a", "b", "c", "d", "e", "f", "g", "h"]
 * 
 * RANK_NAMES = ["1", "2", "3", "4", "5", "6", "7", "8"]             # <<<<<<<<<<<<<<
 * 
 * STARTING_FEN = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
 */
  __pyx_t_1 = PyList_New(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 63, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_1);
  __Pyx_GIVEREF(__pyx_kp_u_1);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_1);
  __Pyx_INCREF(__pyx_kp_u_2);
  __Pyx_GIVEREF(__pyx_kp_u_2);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_u_2);
  __Pyx_INCREF(__pyx_kp_u_3);
  __Pyx_GIVEREF(__pyx_kp_u_3);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_3);
  __Pyx_INCREF(__pyx_kp_u_4);
  __Pyx_GIVEREF(__pyx_kp_u_4);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_kp_u_4);
  __Pyx_INCREF(__pyx_kp_u_5);
  __Pyx_GIVEREF(__pyx_kp_u_5);
  PyList_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u_5);
  __Pyx_INCREF(__pyx_kp_u_6);
  __Pyx_GIVEREF(__pyx_kp_u_6);
  PyList_SET_ITEM(__pyx_t_1, 5, __pyx_kp_u_6);
  __Pyx_INCREF(__pyx_kp_u_7);
  __Pyx_GIVEREF(__pyx_kp_u_7);
  PyList_SET_ITEM(__pyx_t_1, 6, __pyx_kp_u_7);
  __Pyx_INCREF(__pyx_kp_u_8);
  __Pyx_GIVEREF(__pyx_kp_u_8);
  PyList_SET_ITEM(__pyx_t_1, 7, __pyx_kp_u_8);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_RANK_NAMES, __pyx_t_1) < 0) __PYX_ERR(0, 63, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":65
 * RANK_NAMES = ["1", "2", "3", "4", "5", "6", "7", "8"]
 * 
 * STARTING_FEN = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"             # <<<<<<<<<<<<<<
 * """The FEN for the standard chess starting position."""
 * 
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STARTING_FEN, __pyx_kp_u_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP) < 0) __PYX_ERR(0, 65, __pyx_L1_error)

  /* "chess/__init__cp.pyx":68
 * """The FEN for the standard chess starting position."""
 * 
 * STARTING_BOARD_FEN = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"             # <<<<<<<<<<<<<<
 * """The board part of the FEN for the standard chess starting position."""
 * 
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STARTING_BOARD_FEN, __pyx_kp_u_rnbqkbnr_pppppppp_8_8_8_8_PPPPPP_2) < 0) __PYX_ERR(0, 68, __pyx_L1_error)

  /* "chess/__init__cp.pyx":72
 * 
 * 
 * try:             # <<<<<<<<<<<<<<
 *     _IntFlag = enum.IntFlag  # Since Python 3.6
 * except AttributeError:
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
    __Pyx_XGOTREF(__pyx_t_13);
    __Pyx_XGOTREF(__pyx_t_14);
    __Pyx_XGOTREF(__pyx_t_15);
    /*try:*/ {

      /* "chess/__init__cp.pyx":73
 * 
 * try:
 *     _IntFlag = enum.IntFlag  # Since Python 3.6             # <<<<<<<<<<<<<<
 * except AttributeError:
 *     _IntFlag = enum.IntEnum
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_enum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L4_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_IntFlag); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L4_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (PyDict_SetItem(__pyx_d, __pyx_n_s_IntFlag_2, __pyx_t_10) < 0) __PYX_ERR(0, 73, __pyx_L4_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "chess/__init__cp.pyx":72
 * 
 * 
 * try:             # <<<<<<<<<<<<<<
 *     _IntFlag = enum.IntFlag  # Since Python 3.6
 * except AttributeError:
 */
    }
    __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
    goto __pyx_L9_try_end;
    __pyx_L4_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "chess/__init__cp.pyx":74
 * try:
 *     _IntFlag = enum.IntFlag  # Since Python 3.6
 * except AttributeError:             # <<<<<<<<<<<<<<
 *     _IntFlag = enum.IntEnum
 * 
 */
    __pyx_t_16 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AttributeError);
    if (__pyx_t_16) {
      __Pyx_AddTraceback("chess.__init__cp", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_10, &__pyx_t_1, &__pyx_t_9) < 0) __PYX_ERR(0, 74, __pyx_L6_except_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_9);

      /* "chess/__init__cp.pyx":75
 *     _IntFlag = enum.IntFlag  # Since Python 3.6
 * except AttributeError:
 *     _IntFlag = enum.IntEnum             # <<<<<<<<<<<<<<
 * 
 * class Status(_IntFlag):
 */
      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_enum); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 75, __pyx_L6_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_IntEnum); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 75, __pyx_L6_except_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (PyDict_SetItem(__pyx_d, __pyx_n_s_IntFlag_2, __pyx_t_7) < 0) __PYX_ERR(0, 75, __pyx_L6_except_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      goto __pyx_L5_exception_handled;
    }
    goto __pyx_L6_except_error;
    __pyx_L6_except_error:;

    /* "chess/__init__cp.pyx":72
 * 
 * 
 * try:             # <<<<<<<<<<<<<<
 *     _IntFlag = enum.IntFlag  # Since Python 3.6
 * except AttributeError:
 */
    __Pyx_XGIVEREF(__pyx_t_13);
    __Pyx_XGIVEREF(__pyx_t_14);
    __Pyx_XGIVEREF(__pyx_t_15);
    __Pyx_ExceptionReset(__pyx_t_13, __pyx_t_14, __pyx_t_15);
    goto __pyx_L1_error;
    __pyx_L5_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_13);
    __Pyx_XGIVEREF(__pyx_t_14);
    __Pyx_XGIVEREF(__pyx_t_15);
    __Pyx_ExceptionReset(__pyx_t_13, __pyx_t_14, __pyx_t_15);
    __pyx_L9_try_end:;
  }

  /* "chess/__init__cp.pyx":77
 *     _IntFlag = enum.IntEnum
 * 
 * class Status(_IntFlag):             # <<<<<<<<<<<<<<
 *     VALID = 0
 *     NO_WHITE_KING = 1
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_IntFlag_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 77, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_9);
  __pyx_t_9 = 0;
  __pyx_t_9 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 77, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = __Pyx_Py3MetaclassPrepare(__pyx_t_9, __pyx_t_1, __pyx_n_s_Status, __pyx_n_s_Status, (PyObject *) NULL, __pyx_n_s_chess___init__cp, (PyObject *) NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);

  /* "chess/__init__cp.pyx":78
 * 
 * class Status(_IntFlag):
 *     VALID = 0             # <<<<<<<<<<<<<<
 *     NO_WHITE_KING = 1
 *     NO_BLACK_KING = 2
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_VALID, __pyx_int_0) < 0) __PYX_ERR(0, 78, __pyx_L1_error)

  /* "chess/__init__cp.pyx":79
 * class Status(_IntFlag):
 *     VALID = 0
 *     NO_WHITE_KING = 1             # <<<<<<<<<<<<<<
 *     NO_BLACK_KING = 2
 *     TOO_MANY_KINGS = 4
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_NO_WHITE_KING, __pyx_int_1) < 0) __PYX_ERR(0, 79, __pyx_L1_error)

  /* "chess/__init__cp.pyx":80
 *     VALID = 0
 *     NO_WHITE_KING = 1
 *     NO_BLACK_KING = 2             # <<<<<<<<<<<<<<
 *     TOO_MANY_KINGS = 4
 *     TOO_MANY_WHITE_PAWNS = 8
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_NO_BLACK_KING, __pyx_int_2) < 0) __PYX_ERR(0, 80, __pyx_L1_error)

  /* "chess/__init__cp.pyx":81
 *     NO_WHITE_KING = 1
 *     NO_BLACK_KING = 2
 *     TOO_MANY_KINGS = 4             # <<<<<<<<<<<<<<
 *     TOO_MANY_WHITE_PAWNS = 8
 *     TOO_MANY_BLACK_PAWNS = 16
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_TOO_MANY_KINGS, __pyx_int_4) < 0) __PYX_ERR(0, 81, __pyx_L1_error)

  /* "chess/__init__cp.pyx":82
 *     NO_BLACK_KING = 2
 *     TOO_MANY_KINGS = 4
 *     TOO_MANY_WHITE_PAWNS = 8             # <<<<<<<<<<<<<<
 *     TOO_MANY_BLACK_PAWNS = 16
 *     PAWNS_ON_BACKRANK = 32
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_TOO_MANY_WHITE_PAWNS, __pyx_int_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)

  /* "chess/__init__cp.pyx":83
 *     TOO_MANY_KINGS = 4
 *     TOO_MANY_WHITE_PAWNS = 8
 *     TOO_MANY_BLACK_PAWNS = 16             # <<<<<<<<<<<<<<
 *     PAWNS_ON_BACKRANK = 32
 *     TOO_MANY_WHITE_PIECES = 64
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_TOO_MANY_BLACK_PAWNS, __pyx_int_16) < 0) __PYX_ERR(0, 83, __pyx_L1_error)

  /* "chess/__init__cp.pyx":84
 *     TOO_MANY_WHITE_PAWNS = 8
 *     TOO_MANY_BLACK_PAWNS = 16
 *     PAWNS_ON_BACKRANK = 32             # <<<<<<<<<<<<<<
 *     TOO_MANY_WHITE_PIECES = 64
 *     TOO_MANY_BLACK_PIECES = 128
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_PAWNS_ON_BACKRANK, __pyx_int_32) < 0) __PYX_ERR(0, 84, __pyx_L1_error)

  /* "chess/__init__cp.pyx":85
 *     TOO_MANY_BLACK_PAWNS = 16
 *     PAWNS_ON_BACKRANK = 32
 *     TOO_MANY_WHITE_PIECES = 64             # <<<<<<<<<<<<<<
 *     TOO_MANY_BLACK_PIECES = 128
 *     BAD_CASTLING_RIGHTS = 256
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_TOO_MANY_WHITE_PIECES, __pyx_int_64) < 0) __PYX_ERR(0, 85, __pyx_L1_error)

  /* "chess/__init__cp.pyx":86
 *     PAWNS_ON_BACKRANK = 32
 *     TOO_MANY_WHITE_PIECES = 64
 *     TOO_MANY_BLACK_PIECES = 128             # <<<<<<<<<<<<<<
 *     BAD_CASTLING_RIGHTS = 256
 *     INVALID_EP_SQUARE = 512
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_TOO_MANY_BLACK_PIECES, __pyx_int_128) < 0) __PYX_ERR(0, 86, __pyx_L1_error)

  /* "chess/__init__cp.pyx":87
 *     TOO_MANY_WHITE_PIECES = 64
 *     TOO_MANY_BLACK_PIECES = 128
 *     BAD_CASTLING_RIGHTS = 256             # <<<<<<<<<<<<<<
 *     INVALID_EP_SQUARE = 512
 *     OPPOSITE_CHECK = 1024
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_BAD_CASTLING_RIGHTS, __pyx_int_256) < 0) __PYX_ERR(0, 87, __pyx_L1_error)

  /* "chess/__init__cp.pyx":88
 *     TOO_MANY_BLACK_PIECES = 128
 *     BAD_CASTLING_RIGHTS = 256
 *     INVALID_EP_SQUARE = 512             # <<<<<<<<<<<<<<
 *     OPPOSITE_CHECK = 1024
 *     EMPTY = 2048
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_INVALID_EP_SQUARE, __pyx_int_512) < 0) __PYX_ERR(0, 88, __pyx_L1_error)

  /* "chess/__init__cp.pyx":89
 *     BAD_CASTLING_RIGHTS = 256
 *     INVALID_EP_SQUARE = 512
 *     OPPOSITE_CHECK = 1024             # <<<<<<<<<<<<<<
 *     EMPTY = 2048
 *     RACE_CHECK = 4096
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_OPPOSITE_CHECK, __pyx_int_1024) < 0) __PYX_ERR(0, 89, __pyx_L1_error)

  /* "chess/__init__cp.pyx":90
 *     INVALID_EP_SQUARE = 512
 *     OPPOSITE_CHECK = 1024
 *     EMPTY = 2048             # <<<<<<<<<<<<<<
 *     RACE_CHECK = 4096
 *     RACE_OVER = 8192
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_EMPTY, __pyx_int_2048) < 0) __PYX_ERR(0, 90, __pyx_L1_error)

  /* "chess/__init__cp.pyx":91
 *     OPPOSITE_CHECK = 1024
 *     EMPTY = 2048
 *     RACE_CHECK = 4096             # <<<<<<<<<<<<<<
 *     RACE_OVER = 8192
 *     RACE_MATERIAL = 16384
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_RACE_CHECK, __pyx_int_4096) < 0) __PYX_ERR(0, 91, __pyx_L1_error)

  /* "chess/__init__cp.pyx":92
 *     EMPTY = 2048
 *     RACE_CHECK = 4096
 *     RACE_OVER = 8192             # <<<<<<<<<<<<<<
 *     RACE_MATERIAL = 16384
 * 
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_RACE_OVER, __pyx_int_8192) < 0) __PYX_ERR(0, 92, __pyx_L1_error)

  /* "chess/__init__cp.pyx":93
 *     RACE_CHECK = 4096
 *     RACE_OVER = 8192
 *     RACE_MATERIAL = 16384             # <<<<<<<<<<<<<<
 * 
 * STATUS_VALID = Status.VALID
 */
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_RACE_MATERIAL, __pyx_int_16384) < 0) __PYX_ERR(0, 93, __pyx_L1_error)

  /* "chess/__init__cp.pyx":77
 *     _IntFlag = enum.IntEnum
 * 
 * class Status(_IntFlag):             # <<<<<<<<<<<<<<
 *     VALID = 0
 *     NO_WHITE_KING = 1
 */
  __pyx_t_7 = __Pyx_Py3ClassCreate(__pyx_t_9, __pyx_n_s_Status, __pyx_t_1, __pyx_t_10, NULL, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 77, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Status, __pyx_t_7) < 0) __PYX_ERR(0, 77, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":95
 *     RACE_MATERIAL = 16384
 * 
 * STATUS_VALID = Status.VALID             # <<<<<<<<<<<<<<
 * STATUS_NO_WHITE_KING = Status.NO_WHITE_KING
 * STATUS_NO_BLACK_KING = Status.NO_BLACK_KING
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 95, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_VALID); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 95, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_VALID, __pyx_t_9) < 0) __PYX_ERR(0, 95, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":96
 * 
 * STATUS_VALID = Status.VALID
 * STATUS_NO_WHITE_KING = Status.NO_WHITE_KING             # <<<<<<<<<<<<<<
 * STATUS_NO_BLACK_KING = Status.NO_BLACK_KING
 * STATUS_TOO_MANY_KINGS = Status.TOO_MANY_KINGS
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 96, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_NO_WHITE_KING); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 96, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_NO_WHITE_KING, __pyx_t_1) < 0) __PYX_ERR(0, 96, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":97
 * STATUS_VALID = Status.VALID
 * STATUS_NO_WHITE_KING = Status.NO_WHITE_KING
 * STATUS_NO_BLACK_KING = Status.NO_BLACK_KING             # <<<<<<<<<<<<<<
 * STATUS_TOO_MANY_KINGS = Status.TOO_MANY_KINGS
 * STATUS_TOO_MANY_WHITE_PAWNS = Status.TOO_MANY_WHITE_PAWNS
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_NO_BLACK_KING); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_NO_BLACK_KING, __pyx_t_9) < 0) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":98
 * STATUS_NO_WHITE_KING = Status.NO_WHITE_KING
 * STATUS_NO_BLACK_KING = Status.NO_BLACK_KING
 * STATUS_TOO_MANY_KINGS = Status.TOO_MANY_KINGS             # <<<<<<<<<<<<<<
 * STATUS_TOO_MANY_WHITE_PAWNS = Status.TOO_MANY_WHITE_PAWNS
 * STATUS_TOO_MANY_BLACK_PAWNS = Status.TOO_MANY_BLACK_PAWNS
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 98, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_TOO_MANY_KINGS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 98, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_TOO_MANY_KINGS, __pyx_t_1) < 0) __PYX_ERR(0, 98, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":99
 * STATUS_NO_BLACK_KING = Status.NO_BLACK_KING
 * STATUS_TOO_MANY_KINGS = Status.TOO_MANY_KINGS
 * STATUS_TOO_MANY_WHITE_PAWNS = Status.TOO_MANY_WHITE_PAWNS             # <<<<<<<<<<<<<<
 * STATUS_TOO_MANY_BLACK_PAWNS = Status.TOO_MANY_BLACK_PAWNS
 * STATUS_PAWNS_ON_BACKRANK = Status.PAWNS_ON_BACKRANK
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_TOO_MANY_WHITE_PAWNS); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 99, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_TOO_MANY_WHITE_PAWNS, __pyx_t_9) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":100
 * STATUS_TOO_MANY_KINGS = Status.TOO_MANY_KINGS
 * STATUS_TOO_MANY_WHITE_PAWNS = Status.TOO_MANY_WHITE_PAWNS
 * STATUS_TOO_MANY_BLACK_PAWNS = Status.TOO_MANY_BLACK_PAWNS             # <<<<<<<<<<<<<<
 * STATUS_PAWNS_ON_BACKRANK = Status.PAWNS_ON_BACKRANK
 * STATUS_TOO_MANY_WHITE_PIECES = Status.TOO_MANY_WHITE_PIECES
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_TOO_MANY_BLACK_PAWNS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_TOO_MANY_BLACK_PAWNS, __pyx_t_1) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":101
 * STATUS_TOO_MANY_WHITE_PAWNS = Status.TOO_MANY_WHITE_PAWNS
 * STATUS_TOO_MANY_BLACK_PAWNS = Status.TOO_MANY_BLACK_PAWNS
 * STATUS_PAWNS_ON_BACKRANK = Status.PAWNS_ON_BACKRANK             # <<<<<<<<<<<<<<
 * STATUS_TOO_MANY_WHITE_PIECES = Status.TOO_MANY_WHITE_PIECES
 * STATUS_TOO_MANY_BLACK_PIECES = Status.TOO_MANY_BLACK_PIECES
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_PAWNS_ON_BACKRANK); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_PAWNS_ON_BACKRANK, __pyx_t_9) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":102
 * STATUS_TOO_MANY_BLACK_PAWNS = Status.TOO_MANY_BLACK_PAWNS
 * STATUS_PAWNS_ON_BACKRANK = Status.PAWNS_ON_BACKRANK
 * STATUS_TOO_MANY_WHITE_PIECES = Status.TOO_MANY_WHITE_PIECES             # <<<<<<<<<<<<<<
 * STATUS_TOO_MANY_BLACK_PIECES = Status.TOO_MANY_BLACK_PIECES
 * STATUS_BAD_CASTLING_RIGHTS = Status.BAD_CASTLING_RIGHTS
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_TOO_MANY_WHITE_PIECES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_TOO_MANY_WHITE_PIECES, __pyx_t_1) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":103
 * STATUS_PAWNS_ON_BACKRANK = Status.PAWNS_ON_BACKRANK
 * STATUS_TOO_MANY_WHITE_PIECES = Status.TOO_MANY_WHITE_PIECES
 * STATUS_TOO_MANY_BLACK_PIECES = Status.TOO_MANY_BLACK_PIECES             # <<<<<<<<<<<<<<
 * STATUS_BAD_CASTLING_RIGHTS = Status.BAD_CASTLING_RIGHTS
 * STATUS_INVALID_EP_SQUARE = Status.INVALID_EP_SQUARE
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_TOO_MANY_BLACK_PIECES); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_TOO_MANY_BLACK_PIECES, __pyx_t_9) < 0) __PYX_ERR(0, 103, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":104
 * STATUS_TOO_MANY_WHITE_PIECES = Status.TOO_MANY_WHITE_PIECES
 * STATUS_TOO_MANY_BLACK_PIECES = Status.TOO_MANY_BLACK_PIECES
 * STATUS_BAD_CASTLING_RIGHTS = Status.BAD_CASTLING_RIGHTS             # <<<<<<<<<<<<<<
 * STATUS_INVALID_EP_SQUARE = Status.INVALID_EP_SQUARE
 * STATUS_OPPOSITE_CHECK = Status.OPPOSITE_CHECK
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_BAD_CASTLING_RIGHTS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_BAD_CASTLING_RIGHTS, __pyx_t_1) < 0) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":105
 * STATUS_TOO_MANY_BLACK_PIECES = Status.TOO_MANY_BLACK_PIECES
 * STATUS_BAD_CASTLING_RIGHTS = Status.BAD_CASTLING_RIGHTS
 * STATUS_INVALID_EP_SQUARE = Status.INVALID_EP_SQUARE             # <<<<<<<<<<<<<<
 * STATUS_OPPOSITE_CHECK = Status.OPPOSITE_CHECK
 * STATUS_EMPTY = Status.EMPTY
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_INVALID_EP_SQUARE); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 105, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_INVALID_EP_SQUARE, __pyx_t_9) < 0) __PYX_ERR(0, 105, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":106
 * STATUS_BAD_CASTLING_RIGHTS = Status.BAD_CASTLING_RIGHTS
 * STATUS_INVALID_EP_SQUARE = Status.INVALID_EP_SQUARE
 * STATUS_OPPOSITE_CHECK = Status.OPPOSITE_CHECK             # <<<<<<<<<<<<<<
 * STATUS_EMPTY = Status.EMPTY
 * STATUS_RACE_CHECK = Status.RACE_CHECK
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_OPPOSITE_CHECK); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_OPPOSITE_CHECK, __pyx_t_1) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":107
 * STATUS_INVALID_EP_SQUARE = Status.INVALID_EP_SQUARE
 * STATUS_OPPOSITE_CHECK = Status.OPPOSITE_CHECK
 * STATUS_EMPTY = Status.EMPTY             # <<<<<<<<<<<<<<
 * STATUS_RACE_CHECK = Status.RACE_CHECK
 * STATUS_RACE_OVER = Status.RACE_OVER
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_EMPTY); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 107, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_EMPTY, __pyx_t_9) < 0) __PYX_ERR(0, 107, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":108
 * STATUS_OPPOSITE_CHECK = Status.OPPOSITE_CHECK
 * STATUS_EMPTY = Status.EMPTY
 * STATUS_RACE_CHECK = Status.RACE_CHECK             # <<<<<<<<<<<<<<
 * STATUS_RACE_OVER = Status.RACE_OVER
 * STATUS_RACE_MATERIAL = Status.RACE_MATERIAL
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_RACE_CHECK); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_RACE_CHECK, __pyx_t_1) < 0) __PYX_ERR(0, 108, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":109
 * STATUS_EMPTY = Status.EMPTY
 * STATUS_RACE_CHECK = Status.RACE_CHECK
 * STATUS_RACE_OVER = Status.RACE_OVER             # <<<<<<<<<<<<<<
 * STATUS_RACE_MATERIAL = Status.RACE_MATERIAL
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_Status); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_RACE_OVER); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 109, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_RACE_OVER, __pyx_t_9) < 0) __PYX_ERR(0, 109, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":110
 * STATUS_RACE_CHECK = Status.RACE_CHECK
 * STATUS_RACE_OVER = Status.RACE_OVER
 * STATUS_RACE_MATERIAL = Status.RACE_MATERIAL             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_Status); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_RACE_MATERIAL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_STATUS_RACE_MATERIAL, __pyx_t_1) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":121
 *     A6, B6, C6, D6, E6, F6, G6, H6,
 *     A7, B7, C7, D7, E7, F7, G7, H7,
 *     A8, B8, C8, D8, E8, F8, G8, H8] = range(64)             # <<<<<<<<<<<<<<
 * Square = int
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_tuple__77, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SQUARES, __pyx_t_1) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 64)) {
      if (size > 64) __Pyx_RaiseTooManyValuesError(64);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 113, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_9 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_10 = PyTuple_GET_ITEM(sequence, 1); 
      __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
      __pyx_t_8 = PyTuple_GET_ITEM(sequence, 3); 
      __pyx_t_6 = PyTuple_GET_ITEM(sequence, 4); 
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 5); 
      __pyx_t_11 = PyTuple_GET_ITEM(sequence, 6); 
      __pyx_t_17 = PyTuple_GET_ITEM(sequence, 7); 
      __pyx_t_18 = PyTuple_GET_ITEM(sequence, 8); 
      __pyx_t_19 = PyTuple_GET_ITEM(sequence, 9); 
      __pyx_t_20 = PyTuple_GET_ITEM(sequence, 10); 
      __pyx_t_21 = PyTuple_GET_ITEM(sequence, 11); 
      __pyx_t_22 = PyTuple_GET_ITEM(sequence, 12); 
      __pyx_t_23 = PyTuple_GET_ITEM(sequence, 13); 
      __pyx_t_24 = PyTuple_GET_ITEM(sequence, 14); 
      __pyx_t_25 = PyTuple_GET_ITEM(sequence, 15); 
      __pyx_t_26 = PyTuple_GET_ITEM(sequence, 16); 
      __pyx_t_27 = PyTuple_GET_ITEM(sequence, 17); 
      __pyx_t_28 = PyTuple_GET_ITEM(sequence, 18); 
      __pyx_t_29 = PyTuple_GET_ITEM(sequence, 19); 
      __pyx_t_30 = PyTuple_GET_ITEM(sequence, 20); 
      __pyx_t_31 = PyTuple_GET_ITEM(sequence, 21); 
      __pyx_t_32 = PyTuple_GET_ITEM(sequence, 22); 
      __pyx_t_33 = PyTuple_GET_ITEM(sequence, 23); 
      __pyx_t_34 = PyTuple_GET_ITEM(sequence, 24); 
      __pyx_t_35 = PyTuple_GET_ITEM(sequence, 25); 
      __pyx_t_36 = PyTuple_GET_ITEM(sequence, 26); 
      __pyx_t_37 = PyTuple_GET_ITEM(sequence, 27); 
      __pyx_t_38 = PyTuple_GET_ITEM(sequence, 28); 
      __pyx_t_39 = PyTuple_GET_ITEM(sequence, 29); 
      __pyx_t_40 = PyTuple_GET_ITEM(sequence, 30); 
      __pyx_t_41 = PyTuple_GET_ITEM(sequence, 31); 
      __pyx_t_42 = PyTuple_GET_ITEM(sequence, 32); 
      __pyx_t_43 = PyTuple_GET_ITEM(sequence, 33); 
      __pyx_t_44 = PyTuple_GET_ITEM(sequence, 34); 
      __pyx_t_45 = PyTuple_GET_ITEM(sequence, 35); 
      __pyx_t_46 = PyTuple_GET_ITEM(sequence, 36); 
      __pyx_t_47 = PyTuple_GET_ITEM(sequence, 37); 
      __pyx_t_48 = PyTuple_GET_ITEM(sequence, 38); 
      __pyx_t_49 = PyTuple_GET_ITEM(sequence, 39); 
      __pyx_t_50 = PyTuple_GET_ITEM(sequence, 40); 
      __pyx_t_51 = PyTuple_GET_ITEM(sequence, 41); 
      __pyx_t_52 = PyTuple_GET_ITEM(sequence, 42); 
      __pyx_t_53 = PyTuple_GET_ITEM(sequence, 43); 
      __pyx_t_54 = PyTuple_GET_ITEM(sequence, 44); 
      __pyx_t_55 = PyTuple_GET_ITEM(sequence, 45); 
      __pyx_t_56 = PyTuple_GET_ITEM(sequence, 46); 
      __pyx_t_57 = PyTuple_GET_ITEM(sequence, 47); 
      __pyx_t_58 = PyTuple_GET_ITEM(sequence, 48); 
      __pyx_t_59 = PyTuple_GET_ITEM(sequence, 49); 
      __pyx_t_60 = PyTuple_GET_ITEM(sequence, 50); 
      __pyx_t_61 = PyTuple_GET_ITEM(sequence, 51); 
      __pyx_t_62 = PyTuple_GET_ITEM(sequence, 52); 
      __pyx_t_63 = PyTuple_GET_ITEM(sequence, 53); 
      __pyx_t_64 = PyTuple_GET_ITEM(sequence, 54); 
      __pyx_t_65 = PyTuple_GET_ITEM(sequence, 55); 
      __pyx_t_66 = PyTuple_GET_ITEM(sequence, 56); 
      __pyx_t_67 = PyTuple_GET_ITEM(sequence, 57); 
      __pyx_t_68 = PyTuple_GET_ITEM(sequence, 58); 
      __pyx_t_69 = PyTuple_GET_ITEM(sequence, 59); 
      __pyx_t_70 = PyTuple_GET_ITEM(sequence, 60); 
      __pyx_t_71 = PyTuple_GET_ITEM(sequence, 61); 
      __pyx_t_72 = PyTuple_GET_ITEM(sequence, 62); 
      __pyx_t_73 = PyTuple_GET_ITEM(sequence, 63); 
    } else {
      __pyx_t_9 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_10 = PyList_GET_ITEM(sequence, 1); 
      __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
      __pyx_t_8 = PyList_GET_ITEM(sequence, 3); 
      __pyx_t_6 = PyList_GET_ITEM(sequence, 4); 
      __pyx_t_5 = PyList_GET_ITEM(sequence, 5); 
      __pyx_t_11 = PyList_GET_ITEM(sequence, 6); 
      __pyx_t_17 = PyList_GET_ITEM(sequence, 7); 
      __pyx_t_18 = PyList_GET_ITEM(sequence, 8); 
      __pyx_t_19 = PyList_GET_ITEM(sequence, 9); 
      __pyx_t_20 = PyList_GET_ITEM(sequence, 10); 
      __pyx_t_21 = PyList_GET_ITEM(sequence, 11); 
      __pyx_t_22 = PyList_GET_ITEM(sequence, 12); 
      __pyx_t_23 = PyList_GET_ITEM(sequence, 13); 
      __pyx_t_24 = PyList_GET_ITEM(sequence, 14); 
      __pyx_t_25 = PyList_GET_ITEM(sequence, 15); 
      __pyx_t_26 = PyList_GET_ITEM(sequence, 16); 
      __pyx_t_27 = PyList_GET_ITEM(sequence, 17); 
      __pyx_t_28 = PyList_GET_ITEM(sequence, 18); 
      __pyx_t_29 = PyList_GET_ITEM(sequence, 19); 
      __pyx_t_30 = PyList_GET_ITEM(sequence, 20); 
      __pyx_t_31 = PyList_GET_ITEM(sequence, 21); 
      __pyx_t_32 = PyList_GET_ITEM(sequence, 22); 
      __pyx_t_33 = PyList_GET_ITEM(sequence, 23); 
      __pyx_t_34 = PyList_GET_ITEM(sequence, 24); 
      __pyx_t_35 = PyList_GET_ITEM(sequence, 25); 
      __pyx_t_36 = PyList_GET_ITEM(sequence, 26); 
      __pyx_t_37 = PyList_GET_ITEM(sequence, 27); 
      __pyx_t_38 = PyList_GET_ITEM(sequence, 28); 
      __pyx_t_39 = PyList_GET_ITEM(sequence, 29); 
      __pyx_t_40 = PyList_GET_ITEM(sequence, 30); 
      __pyx_t_41 = PyList_GET_ITEM(sequence, 31); 
      __pyx_t_42 = PyList_GET_ITEM(sequence, 32); 
      __pyx_t_43 = PyList_GET_ITEM(sequence, 33); 
      __pyx_t_44 = PyList_GET_ITEM(sequence, 34); 
      __pyx_t_45 = PyList_GET_ITEM(sequence, 35); 
      __pyx_t_46 = PyList_GET_ITEM(sequence, 36); 
      __pyx_t_47 = PyList_GET_ITEM(sequence, 37); 
      __pyx_t_48 = PyList_GET_ITEM(sequence, 38); 
      __pyx_t_49 = PyList_GET_ITEM(sequence, 39); 
      __pyx_t_50 = PyList_GET_ITEM(sequence, 40); 
      __pyx_t_51 = PyList_GET_ITEM(sequence, 41); 
      __pyx_t_52 = PyList_GET_ITEM(sequence, 42); 
      __pyx_t_53 = PyList_GET_ITEM(sequence, 43); 
      __pyx_t_54 = PyList_GET_ITEM(sequence, 44); 
      __pyx_t_55 = PyList_GET_ITEM(sequence, 45); 
      __pyx_t_56 = PyList_GET_ITEM(sequence, 46); 
      __pyx_t_57 = PyList_GET_ITEM(sequence, 47); 
      __pyx_t_58 = PyList_GET_ITEM(sequence, 48); 
      __pyx_t_59 = PyList_GET_ITEM(sequence, 49); 
      __pyx_t_60 = PyList_GET_ITEM(sequence, 50); 
      __pyx_t_61 = PyList_GET_ITEM(sequence, 51); 
      __pyx_t_62 = PyList_GET_ITEM(sequence, 52); 
      __pyx_t_63 = PyList_GET_ITEM(sequence, 53); 
      __pyx_t_64 = PyList_GET_ITEM(sequence, 54); 
      __pyx_t_65 = PyList_GET_ITEM(sequence, 55); 
      __pyx_t_66 = PyList_GET_ITEM(sequence, 56); 
      __pyx_t_67 = PyList_GET_ITEM(sequence, 57); 
      __pyx_t_68 = PyList_GET_ITEM(sequence, 58); 
      __pyx_t_69 = PyList_GET_ITEM(sequence, 59); 
      __pyx_t_70 = PyList_GET_ITEM(sequence, 60); 
      __pyx_t_71 = PyList_GET_ITEM(sequence, 61); 
      __pyx_t_72 = PyList_GET_ITEM(sequence, 62); 
      __pyx_t_73 = PyList_GET_ITEM(sequence, 63); 
    }
    __Pyx_INCREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_t_11);
    __Pyx_INCREF(__pyx_t_17);
    __Pyx_INCREF(__pyx_t_18);
    __Pyx_INCREF(__pyx_t_19);
    __Pyx_INCREF(__pyx_t_20);
    __Pyx_INCREF(__pyx_t_21);
    __Pyx_INCREF(__pyx_t_22);
    __Pyx_INCREF(__pyx_t_23);
    __Pyx_INCREF(__pyx_t_24);
    __Pyx_INCREF(__pyx_t_25);
    __Pyx_INCREF(__pyx_t_26);
    __Pyx_INCREF(__pyx_t_27);
    __Pyx_INCREF(__pyx_t_28);
    __Pyx_INCREF(__pyx_t_29);
    __Pyx_INCREF(__pyx_t_30);
    __Pyx_INCREF(__pyx_t_31);
    __Pyx_INCREF(__pyx_t_32);
    __Pyx_INCREF(__pyx_t_33);
    __Pyx_INCREF(__pyx_t_34);
    __Pyx_INCREF(__pyx_t_35);
    __Pyx_INCREF(__pyx_t_36);
    __Pyx_INCREF(__pyx_t_37);
    __Pyx_INCREF(__pyx_t_38);
    __Pyx_INCREF(__pyx_t_39);
    __Pyx_INCREF(__pyx_t_40);
    __Pyx_INCREF(__pyx_t_41);
    __Pyx_INCREF(__pyx_t_42);
    __Pyx_INCREF(__pyx_t_43);
    __Pyx_INCREF(__pyx_t_44);
    __Pyx_INCREF(__pyx_t_45);
    __Pyx_INCREF(__pyx_t_46);
    __Pyx_INCREF(__pyx_t_47);
    __Pyx_INCREF(__pyx_t_48);
    __Pyx_INCREF(__pyx_t_49);
    __Pyx_INCREF(__pyx_t_50);
    __Pyx_INCREF(__pyx_t_51);
    __Pyx_INCREF(__pyx_t_52);
    __Pyx_INCREF(__pyx_t_53);
    __Pyx_INCREF(__pyx_t_54);
    __Pyx_INCREF(__pyx_t_55);
    __Pyx_INCREF(__pyx_t_56);
    __Pyx_INCREF(__pyx_t_57);
    __Pyx_INCREF(__pyx_t_58);
    __Pyx_INCREF(__pyx_t_59);
    __Pyx_INCREF(__pyx_t_60);
    __Pyx_INCREF(__pyx_t_61);
    __Pyx_INCREF(__pyx_t_62);
    __Pyx_INCREF(__pyx_t_63);
    __Pyx_INCREF(__pyx_t_64);
    __Pyx_INCREF(__pyx_t_65);
    __Pyx_INCREF(__pyx_t_66);
    __Pyx_INCREF(__pyx_t_67);
    __Pyx_INCREF(__pyx_t_68);
    __Pyx_INCREF(__pyx_t_69);
    __Pyx_INCREF(__pyx_t_70);
    __Pyx_INCREF(__pyx_t_71);
    __Pyx_INCREF(__pyx_t_72);
    __Pyx_INCREF(__pyx_t_73);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[64] = {&__pyx_t_9,&__pyx_t_10,&__pyx_t_7,&__pyx_t_8,&__pyx_t_6,&__pyx_t_5,&__pyx_t_11,&__pyx_t_17,&__pyx_t_18,&__pyx_t_19,&__pyx_t_20,&__pyx_t_21,&__pyx_t_22,&__pyx_t_23,&__pyx_t_24,&__pyx_t_25,&__pyx_t_26,&__pyx_t_27,&__pyx_t_28,&__pyx_t_29,&__pyx_t_30,&__pyx_t_31,&__pyx_t_32,&__pyx_t_33,&__pyx_t_34,&__pyx_t_35,&__pyx_t_36,&__pyx_t_37,&__pyx_t_38,&__pyx_t_39,&__pyx_t_40,&__pyx_t_41,&__pyx_t_42,&__pyx_t_43,&__pyx_t_44,&__pyx_t_45,&__pyx_t_46,&__pyx_t_47,&__pyx_t_48,&__pyx_t_49,&__pyx_t_50,&__pyx_t_51,&__pyx_t_52,&__pyx_t_53,&__pyx_t_54,&__pyx_t_55,&__pyx_t_56,&__pyx_t_57,&__pyx_t_58,&__pyx_t_59,&__pyx_t_60,&__pyx_t_61,&__pyx_t_62,&__pyx_t_63,&__pyx_t_64,&__pyx_t_65,&__pyx_t_66,&__pyx_t_67,&__pyx_t_68,&__pyx_t_69,&__pyx_t_70,&__pyx_t_71,&__pyx_t_72,&__pyx_t_73};
      for (i=0; i < 64; i++) {
        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 113, __pyx_L1_error)
        __Pyx_GOTREF(item);
        *(temps[i]) = item;
      }
    }
    #endif
  } else {
    Py_ssize_t index = -1;
    PyObject** temps[64] = {&__pyx_t_9,&__pyx_t_10,&__pyx_t_7,&__pyx_t_8,&__pyx_t_6,&__pyx_t_5,&__pyx_t_11,&__pyx_t_17,&__pyx_t_18,&__pyx_t_19,&__pyx_t_20,&__pyx_t_21,&__pyx_t_22,&__pyx_t_23,&__pyx_t_24,&__pyx_t_25,&__pyx_t_26,&__pyx_t_27,&__pyx_t_28,&__pyx_t_29,&__pyx_t_30,&__pyx_t_31,&__pyx_t_32,&__pyx_t_33,&__pyx_t_34,&__pyx_t_35,&__pyx_t_36,&__pyx_t_37,&__pyx_t_38,&__pyx_t_39,&__pyx_t_40,&__pyx_t_41,&__pyx_t_42,&__pyx_t_43,&__pyx_t_44,&__pyx_t_45,&__pyx_t_46,&__pyx_t_47,&__pyx_t_48,&__pyx_t_49,&__pyx_t_50,&__pyx_t_51,&__pyx_t_52,&__pyx_t_53,&__pyx_t_54,&__pyx_t_55,&__pyx_t_56,&__pyx_t_57,&__pyx_t_58,&__pyx_t_59,&__pyx_t_60,&__pyx_t_61,&__pyx_t_62,&__pyx_t_63,&__pyx_t_64,&__pyx_t_65,&__pyx_t_66,&__pyx_t_67,&__pyx_t_68,&__pyx_t_69,&__pyx_t_70,&__pyx_t_71,&__pyx_t_72,&__pyx_t_73};
    __pyx_t_74 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_74)) __PYX_ERR(0, 113, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_74);
    __pyx_t_12 = Py_TYPE(__pyx_t_74)->tp_iternext;
    for (index=0; index < 64; index++) {
      PyObject* item = __pyx_t_12(__pyx_t_74); if (unlikely(!item)) goto __pyx_L12_unpacking_failed;
      __Pyx_GOTREF(item);
      *(temps[index]) = item;
    }
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_74), 64) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
    __pyx_t_12 = NULL;
    __Pyx_DECREF(__pyx_t_74); __pyx_t_74 = 0;
    goto __pyx_L13_unpacking_done;
    __pyx_L12_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_74); __pyx_t_74 = 0;
    __pyx_t_12 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 113, __pyx_L1_error)
    __pyx_L13_unpacking_done:;
  }

  /* "chess/__init__cp.pyx":113
 * 
 * 
 * SQUARES = [             # <<<<<<<<<<<<<<
 *     A1, B1, C1, D1, E1, F1, G1, H1,
 *     A2, B2, C2, D2, E2, F2, G2, H2,
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A1, __pyx_t_9) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B1, __pyx_t_10) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C1, __pyx_t_7) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D1, __pyx_t_8) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E1, __pyx_t_6) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F1, __pyx_t_5) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G1, __pyx_t_11) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H1, __pyx_t_17) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A2, __pyx_t_18) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B2, __pyx_t_19) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C2, __pyx_t_20) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D2, __pyx_t_21) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E2, __pyx_t_22) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F2, __pyx_t_23) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G2, __pyx_t_24) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H2, __pyx_t_25) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A3, __pyx_t_26) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B3, __pyx_t_27) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_27); __pyx_t_27 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C3, __pyx_t_28) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_28); __pyx_t_28 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D3, __pyx_t_29) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E3, __pyx_t_30) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_30); __pyx_t_30 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F3, __pyx_t_31) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_31); __pyx_t_31 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G3, __pyx_t_32) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_32); __pyx_t_32 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H3, __pyx_t_33) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_33); __pyx_t_33 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A4, __pyx_t_34) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_34); __pyx_t_34 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B4, __pyx_t_35) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_35); __pyx_t_35 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C4, __pyx_t_36) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_36); __pyx_t_36 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D4, __pyx_t_37) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_37); __pyx_t_37 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E4, __pyx_t_38) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_38); __pyx_t_38 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F4, __pyx_t_39) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_39); __pyx_t_39 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G4, __pyx_t_40) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_40); __pyx_t_40 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H4, __pyx_t_41) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_41); __pyx_t_41 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A5, __pyx_t_42) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_42); __pyx_t_42 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B5, __pyx_t_43) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_43); __pyx_t_43 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C5, __pyx_t_44) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_44); __pyx_t_44 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D5, __pyx_t_45) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_45); __pyx_t_45 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E5, __pyx_t_46) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_46); __pyx_t_46 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F5, __pyx_t_47) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_47); __pyx_t_47 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G5, __pyx_t_48) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_48); __pyx_t_48 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H5, __pyx_t_49) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_49); __pyx_t_49 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A6, __pyx_t_50) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_50); __pyx_t_50 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B6, __pyx_t_51) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_51); __pyx_t_51 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C6, __pyx_t_52) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_52); __pyx_t_52 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D6, __pyx_t_53) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_53); __pyx_t_53 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E6, __pyx_t_54) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_54); __pyx_t_54 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F6, __pyx_t_55) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_55); __pyx_t_55 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G6, __pyx_t_56) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_56); __pyx_t_56 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H6, __pyx_t_57) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_57); __pyx_t_57 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A7, __pyx_t_58) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_58); __pyx_t_58 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B7, __pyx_t_59) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_59); __pyx_t_59 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C7, __pyx_t_60) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_60); __pyx_t_60 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D7, __pyx_t_61) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_61); __pyx_t_61 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E7, __pyx_t_62) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_62); __pyx_t_62 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F7, __pyx_t_63) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_63); __pyx_t_63 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G7, __pyx_t_64) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_64); __pyx_t_64 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H7, __pyx_t_65) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_65); __pyx_t_65 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_A8, __pyx_t_66) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_66); __pyx_t_66 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_B8, __pyx_t_67) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_67); __pyx_t_67 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_C8, __pyx_t_68) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_68); __pyx_t_68 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_D8, __pyx_t_69) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_69); __pyx_t_69 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_E8, __pyx_t_70) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_70); __pyx_t_70 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F8, __pyx_t_71) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_71); __pyx_t_71 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_G8, __pyx_t_72) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_72); __pyx_t_72 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_H8, __pyx_t_73) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_73); __pyx_t_73 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":122
 *     A7, B7, C7, D7, E7, F7, G7, H7,
 *     A8, B8, C8, D8, E8, F8, G8, H8] = range(64)
 * Square = int             # <<<<<<<<<<<<<<
 * 
 * SQUARE_NAMES = [f + r for r in RANK_NAMES for f in FILE_NAMES]
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Square, ((PyObject *)(&PyInt_Type))) < 0) __PYX_ERR(0, 122, __pyx_L1_error)

  /* "chess/__init__cp.pyx":124
 * Square = int
 * 
 * SQUARE_NAMES = [f + r for r in RANK_NAMES for f in FILE_NAMES]             # <<<<<<<<<<<<<<
 * 
 * def square(file_index, rank_index):
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L16_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_73, __pyx_n_s_RANK_NAMES); if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
    __Pyx_GOTREF(__pyx_t_73);
    if (likely(PyList_CheckExact(__pyx_t_73)) || PyTuple_CheckExact(__pyx_t_73)) {
      __pyx_t_72 = __pyx_t_73; __Pyx_INCREF(__pyx_t_72); __pyx_t_75 = 0;
      __pyx_t_76 = NULL;
    } else {
      __pyx_t_75 = -1; __pyx_t_72 = PyObject_GetIter(__pyx_t_73); if (unlikely(!__pyx_t_72)) __PYX_ERR(0, 124, __pyx_L16_error)
      __Pyx_GOTREF(__pyx_t_72);
      __pyx_t_76 = Py_TYPE(__pyx_t_72)->tp_iternext; if (unlikely(!__pyx_t_76)) __PYX_ERR(0, 124, __pyx_L16_error)
    }
    __Pyx_DECREF(__pyx_t_73); __pyx_t_73 = 0;
    for (;;) {
      if (likely(!__pyx_t_76)) {
        if (likely(PyList_CheckExact(__pyx_t_72))) {
          if (__pyx_t_75 >= PyList_GET_SIZE(__pyx_t_72)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_73 = PyList_GET_ITEM(__pyx_t_72, __pyx_t_75); __Pyx_INCREF(__pyx_t_73); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 124, __pyx_L16_error)
          #else
          __pyx_t_73 = PySequence_ITEM(__pyx_t_72, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
          __Pyx_GOTREF(__pyx_t_73);
          #endif
        } else {
          if (__pyx_t_75 >= PyTuple_GET_SIZE(__pyx_t_72)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_73 = PyTuple_GET_ITEM(__pyx_t_72, __pyx_t_75); __Pyx_INCREF(__pyx_t_73); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 124, __pyx_L16_error)
          #else
          __pyx_t_73 = PySequence_ITEM(__pyx_t_72, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
          __Pyx_GOTREF(__pyx_t_73);
          #endif
        }
      } else {
        __pyx_t_73 = __pyx_t_76(__pyx_t_72);
        if (unlikely(!__pyx_t_73)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 124, __pyx_L16_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_73);
      }
      __Pyx_XGOTREF(__pyx_7genexpr__pyx_v_5chess_10__init__cp_r);
      __Pyx_DECREF_SET(__pyx_7genexpr__pyx_v_5chess_10__init__cp_r, __pyx_t_73);
      __Pyx_GIVEREF(__pyx_t_73);
      __pyx_t_73 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_73, __pyx_n_s_FILE_NAMES); if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
      __Pyx_GOTREF(__pyx_t_73);
      if (likely(PyList_CheckExact(__pyx_t_73)) || PyTuple_CheckExact(__pyx_t_73)) {
        __pyx_t_71 = __pyx_t_73; __Pyx_INCREF(__pyx_t_71); __pyx_t_77 = 0;
        __pyx_t_78 = NULL;
      } else {
        __pyx_t_77 = -1; __pyx_t_71 = PyObject_GetIter(__pyx_t_73); if (unlikely(!__pyx_t_71)) __PYX_ERR(0, 124, __pyx_L16_error)
        __Pyx_GOTREF(__pyx_t_71);
        __pyx_t_78 = Py_TYPE(__pyx_t_71)->tp_iternext; if (unlikely(!__pyx_t_78)) __PYX_ERR(0, 124, __pyx_L16_error)
      }
      __Pyx_DECREF(__pyx_t_73); __pyx_t_73 = 0;
      for (;;) {
        if (likely(!__pyx_t_78)) {
          if (likely(PyList_CheckExact(__pyx_t_71))) {
            if (__pyx_t_77 >= PyList_GET_SIZE(__pyx_t_71)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_73 = PyList_GET_ITEM(__pyx_t_71, __pyx_t_77); __Pyx_INCREF(__pyx_t_73); __pyx_t_77++; if (unlikely(0 < 0)) __PYX_ERR(0, 124, __pyx_L16_error)
            #else
            __pyx_t_73 = PySequence_ITEM(__pyx_t_71, __pyx_t_77); __pyx_t_77++; if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
            __Pyx_GOTREF(__pyx_t_73);
            #endif
          } else {
            if (__pyx_t_77 >= PyTuple_GET_SIZE(__pyx_t_71)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_73 = PyTuple_GET_ITEM(__pyx_t_71, __pyx_t_77); __Pyx_INCREF(__pyx_t_73); __pyx_t_77++; if (unlikely(0 < 0)) __PYX_ERR(0, 124, __pyx_L16_error)
            #else
            __pyx_t_73 = PySequence_ITEM(__pyx_t_71, __pyx_t_77); __pyx_t_77++; if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
            __Pyx_GOTREF(__pyx_t_73);
            #endif
          }
        } else {
          __pyx_t_73 = __pyx_t_78(__pyx_t_71);
          if (unlikely(!__pyx_t_73)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 124, __pyx_L16_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_73);
        }
        __Pyx_XGOTREF(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f);
        __Pyx_DECREF_SET(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f, __pyx_t_73);
        __Pyx_GIVEREF(__pyx_t_73);
        __pyx_t_73 = 0;
        __pyx_t_73 = PyNumber_Add(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f, __pyx_7genexpr__pyx_v_5chess_10__init__cp_r); if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 124, __pyx_L16_error)
        __Pyx_GOTREF(__pyx_t_73);
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_73))) __PYX_ERR(0, 124, __pyx_L16_error)
        __Pyx_DECREF(__pyx_t_73); __pyx_t_73 = 0;
      }
      __Pyx_DECREF(__pyx_t_71); __pyx_t_71 = 0;
    }
    __Pyx_DECREF(__pyx_t_72); __pyx_t_72 = 0;
    __Pyx_GOTREF(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f);
    __Pyx_DECREF_SET(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f, Py_None);
    __Pyx_GOTREF(__pyx_7genexpr__pyx_v_5chess_10__init__cp_r);
    __Pyx_DECREF_SET(__pyx_7genexpr__pyx_v_5chess_10__init__cp_r, Py_None);
    goto __pyx_L21_exit_scope;
    __pyx_L16_error:;
    __Pyx_GOTREF(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f);
    __Pyx_DECREF_SET(__pyx_7genexpr__pyx_v_5chess_10__init__cp_f, Py_None);
    __Pyx_GOTREF(__pyx_7genexpr__pyx_v_5chess_10__init__cp_r);
    __Pyx_DECREF_SET(__pyx_7genexpr__pyx_v_5chess_10__init__cp_r, Py_None);
    goto __pyx_L1_error;
    __pyx_L21_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SQUARE_NAMES, __pyx_t_1) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":126
 * SQUARE_NAMES = [f + r for r in RANK_NAMES for f in FILE_NAMES]
 * 
 * def square(file_index, rank_index):             # <<<<<<<<<<<<<<
 *     """Gets a square number by file and rank index."""
 *     return rank_index * 8 + file_index
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_1square, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square, __pyx_t_1) < 0) __PYX_ERR(0, 126, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":130
 *     return rank_index * 8 + file_index
 * 
 * def square_file(square):             # <<<<<<<<<<<<<<
 *     """Gets the file index of the square where ``0`` is the a-file."""
 *     return square & 7
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_3square_file, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 130, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square_file, __pyx_t_1) < 0) __PYX_ERR(0, 130, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":134
 *     return square & 7
 * 
 * def square_rank(square):             # <<<<<<<<<<<<<<
 *     """Gets the rank index of the square where ``0`` is the first rank."""
 *     return square >> 3
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5square_rank, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square_rank, __pyx_t_1) < 0) __PYX_ERR(0, 134, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":138
 *     return square >> 3
 * 
 * def square_name(square):             # <<<<<<<<<<<<<<
 *     """Gets the name of the square, like ``a3``."""
 *     return SQUARE_NAMES[square]
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_7square_name, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square_name, __pyx_t_1) < 0) __PYX_ERR(0, 138, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":142
 *     return SQUARE_NAMES[square]
 * 
 * def square_distance(a, b):             # <<<<<<<<<<<<<<
 *     """
 *     Gets the distance (i.e., the number of king steps) from square *a* to *b*.
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9square_distance, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square_distance, __pyx_t_1) < 0) __PYX_ERR(0, 142, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":148
 *     return max(abs(square_file(a) - square_file(b)), abs(square_rank(a) - square_rank(b)))
 * 
 * def square_mirror(square):             # <<<<<<<<<<<<<<
 *     """Mirrors the square vertically."""
 *     return square ^ 0x38
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_11square_mirror, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square_mirror, __pyx_t_1) < 0) __PYX_ERR(0, 148, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":152
 *     return square ^ 0x38
 * 
 * SQUARES_180 = [square_mirror(sq) for sq in SQUARES]             # <<<<<<<<<<<<<<
 * 
 * cdef unsigned long long BB_EMPTY = 0
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L24_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_72, __pyx_n_s_SQUARES); if (unlikely(!__pyx_t_72)) __PYX_ERR(0, 152, __pyx_L24_error)
    __Pyx_GOTREF(__pyx_t_72);
    if (likely(PyList_CheckExact(__pyx_t_72)) || PyTuple_CheckExact(__pyx_t_72)) {
      __pyx_t_71 = __pyx_t_72; __Pyx_INCREF(__pyx_t_71); __pyx_t_75 = 0;
      __pyx_t_76 = NULL;
    } else {
      __pyx_t_75 = -1; __pyx_t_71 = PyObject_GetIter(__pyx_t_72); if (unlikely(!__pyx_t_71)) __PYX_ERR(0, 152, __pyx_L24_error)
      __Pyx_GOTREF(__pyx_t_71);
      __pyx_t_76 = Py_TYPE(__pyx_t_71)->tp_iternext; if (unlikely(!__pyx_t_76)) __PYX_ERR(0, 152, __pyx_L24_error)
    }
    __Pyx_DECREF(__pyx_t_72); __pyx_t_72 = 0;
    for (;;) {
      if (likely(!__pyx_t_76)) {
        if (likely(PyList_CheckExact(__pyx_t_71))) {
          if (__pyx_t_75 >= PyList_GET_SIZE(__pyx_t_71)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_72 = PyList_GET_ITEM(__pyx_t_71, __pyx_t_75); __Pyx_INCREF(__pyx_t_72); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 152, __pyx_L24_error)
          #else
          __pyx_t_72 = PySequence_ITEM(__pyx_t_71, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_72)) __PYX_ERR(0, 152, __pyx_L24_error)
          __Pyx_GOTREF(__pyx_t_72);
          #endif
        } else {
          if (__pyx_t_75 >= PyTuple_GET_SIZE(__pyx_t_71)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_72 = PyTuple_GET_ITEM(__pyx_t_71, __pyx_t_75); __Pyx_INCREF(__pyx_t_72); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 152, __pyx_L24_error)
          #else
          __pyx_t_72 = PySequence_ITEM(__pyx_t_71, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_72)) __PYX_ERR(0, 152, __pyx_L24_error)
          __Pyx_GOTREF(__pyx_t_72);
          #endif
        }
      } else {
        __pyx_t_72 = __pyx_t_76(__pyx_t_71);
        if (unlikely(!__pyx_t_72)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 152, __pyx_L24_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_72);
      }
      __Pyx_XGOTREF(__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq);
      __Pyx_DECREF_SET(__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq, __pyx_t_72);
      __Pyx_GIVEREF(__pyx_t_72);
      __pyx_t_72 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_73, __pyx_n_s_square_mirror); if (unlikely(!__pyx_t_73)) __PYX_ERR(0, 152, __pyx_L24_error)
      __Pyx_GOTREF(__pyx_t_73);
      __pyx_t_70 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_73))) {
        __pyx_t_70 = PyMethod_GET_SELF(__pyx_t_73);
        if (likely(__pyx_t_70)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_73);
          __Pyx_INCREF(__pyx_t_70);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_73, function);
        }
      }
      __pyx_t_72 = (__pyx_t_70) ? __Pyx_PyObject_Call2Args(__pyx_t_73, __pyx_t_70, __pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq) : __Pyx_PyObject_CallOneArg(__pyx_t_73, __pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq);
      __Pyx_XDECREF(__pyx_t_70); __pyx_t_70 = 0;
      if (unlikely(!__pyx_t_72)) __PYX_ERR(0, 152, __pyx_L24_error)
      __Pyx_GOTREF(__pyx_t_72);
      __Pyx_DECREF(__pyx_t_73); __pyx_t_73 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_72))) __PYX_ERR(0, 152, __pyx_L24_error)
      __Pyx_DECREF(__pyx_t_72); __pyx_t_72 = 0;
    }
    __Pyx_DECREF(__pyx_t_71); __pyx_t_71 = 0;
    __Pyx_GOTREF(__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L27_exit_scope;
    __pyx_L24_error:;
    __Pyx_GOTREF(__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr1__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L1_error;
    __pyx_L27_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SQUARES_180, __pyx_t_1) < 0) __PYX_ERR(0, 152, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":154
 * SQUARES_180 = [square_mirror(sq) for sq in SQUARES]
 * 
 * cdef unsigned long long BB_EMPTY = 0             # <<<<<<<<<<<<<<
 * cdef unsigned long long BB_ALL = 0xffffffffffffffff
 * 
 */
  __pyx_v_5chess_10__init__cp_BB_EMPTY = 0;

  /* "chess/__init__cp.pyx":155
 * 
 * cdef unsigned long long BB_EMPTY = 0
 * cdef unsigned long long BB_ALL = 0xffffffffffffffff             # <<<<<<<<<<<<<<
 * 
 * BB_SQUARES = [
 */
  __pyx_v_5chess_10__init__cp_BB_ALL = 0xffffffffffffffff;

  /* "chess/__init__cp.pyx":166
 *     BB_A7, BB_B7, BB_C7, BB_D7, BB_E7, BB_F7, BB_G7, BB_H7,
 *     BB_A8, BB_B8, BB_C8, BB_D8, BB_E8, BB_F8, BB_G8, BB_H8
 * ] = [1 << sq for sq in SQUARES]             # <<<<<<<<<<<<<<
 * 
 * BB_CORNERS = BB_A1 | BB_H1 | BB_A8 | BB_H8
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L30_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_71, __pyx_n_s_SQUARES); if (unlikely(!__pyx_t_71)) __PYX_ERR(0, 166, __pyx_L30_error)
    __Pyx_GOTREF(__pyx_t_71);
    if (likely(PyList_CheckExact(__pyx_t_71)) || PyTuple_CheckExact(__pyx_t_71)) {
      __pyx_t_72 = __pyx_t_71; __Pyx_INCREF(__pyx_t_72); __pyx_t_75 = 0;
      __pyx_t_76 = NULL;
    } else {
      __pyx_t_75 = -1; __pyx_t_72 = PyObject_GetIter(__pyx_t_71); if (unlikely(!__pyx_t_72)) __PYX_ERR(0, 166, __pyx_L30_error)
      __Pyx_GOTREF(__pyx_t_72);
      __pyx_t_76 = Py_TYPE(__pyx_t_72)->tp_iternext; if (unlikely(!__pyx_t_76)) __PYX_ERR(0, 166, __pyx_L30_error)
    }
    __Pyx_DECREF(__pyx_t_71); __pyx_t_71 = 0;
    for (;;) {
      if (likely(!__pyx_t_76)) {
        if (likely(PyList_CheckExact(__pyx_t_72))) {
          if (__pyx_t_75 >= PyList_GET_SIZE(__pyx_t_72)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_71 = PyList_GET_ITEM(__pyx_t_72, __pyx_t_75); __Pyx_INCREF(__pyx_t_71); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 166, __pyx_L30_error)
          #else
          __pyx_t_71 = PySequence_ITEM(__pyx_t_72, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_71)) __PYX_ERR(0, 166, __pyx_L30_error)
          __Pyx_GOTREF(__pyx_t_71);
          #endif
        } else {
          if (__pyx_t_75 >= PyTuple_GET_SIZE(__pyx_t_72)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_71 = PyTuple_GET_ITEM(__pyx_t_72, __pyx_t_75); __Pyx_INCREF(__pyx_t_71); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 166, __pyx_L30_error)
          #else
          __pyx_t_71 = PySequence_ITEM(__pyx_t_72, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_71)) __PYX_ERR(0, 166, __pyx_L30_error)
          __Pyx_GOTREF(__pyx_t_71);
          #endif
        }
      } else {
        __pyx_t_71 = __pyx_t_76(__pyx_t_72);
        if (unlikely(!__pyx_t_71)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 166, __pyx_L30_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_71);
      }
      __Pyx_XGOTREF(__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq);
      __Pyx_DECREF_SET(__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq, __pyx_t_71);
      __Pyx_GIVEREF(__pyx_t_71);
      __pyx_t_71 = 0;
      __pyx_t_71 = PyNumber_Lshift(__pyx_int_1, __pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq); if (unlikely(!__pyx_t_71)) __PYX_ERR(0, 166, __pyx_L30_error)
      __Pyx_GOTREF(__pyx_t_71);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_71))) __PYX_ERR(0, 166, __pyx_L30_error)
      __Pyx_DECREF(__pyx_t_71); __pyx_t_71 = 0;
    }
    __Pyx_DECREF(__pyx_t_72); __pyx_t_72 = 0;
    __Pyx_GOTREF(__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L33_exit_scope;
    __pyx_L30_error:;
    __Pyx_GOTREF(__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr2__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L1_error;
    __pyx_L33_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_SQUARES_2, __pyx_t_1) < 0) __PYX_ERR(0, 157, __pyx_L1_error)
  if (1) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 64)) {
      if (size > 64) __Pyx_RaiseTooManyValuesError(64);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 157, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_72 = PyList_GET_ITEM(sequence, 0); 
    __pyx_t_71 = PyList_GET_ITEM(sequence, 1); 
    __pyx_t_73 = PyList_GET_ITEM(sequence, 2); 
    __pyx_t_70 = PyList_GET_ITEM(sequence, 3); 
    __pyx_t_69 = PyList_GET_ITEM(sequence, 4); 
    __pyx_t_68 = PyList_GET_ITEM(sequence, 5); 
    __pyx_t_67 = PyList_GET_ITEM(sequence, 6); 
    __pyx_t_66 = PyList_GET_ITEM(sequence, 7); 
    __pyx_t_65 = PyList_GET_ITEM(sequence, 8); 
    __pyx_t_64 = PyList_GET_ITEM(sequence, 9); 
    __pyx_t_63 = PyList_GET_ITEM(sequence, 10); 
    __pyx_t_62 = PyList_GET_ITEM(sequence, 11); 
    __pyx_t_61 = PyList_GET_ITEM(sequence, 12); 
    __pyx_t_60 = PyList_GET_ITEM(sequence, 13); 
    __pyx_t_59 = PyList_GET_ITEM(sequence, 14); 
    __pyx_t_58 = PyList_GET_ITEM(sequence, 15); 
    __pyx_t_57 = PyList_GET_ITEM(sequence, 16); 
    __pyx_t_56 = PyList_GET_ITEM(sequence, 17); 
    __pyx_t_55 = PyList_GET_ITEM(sequence, 18); 
    __pyx_t_54 = PyList_GET_ITEM(sequence, 19); 
    __pyx_t_53 = PyList_GET_ITEM(sequence, 20); 
    __pyx_t_52 = PyList_GET_ITEM(sequence, 21); 
    __pyx_t_51 = PyList_GET_ITEM(sequence, 22); 
    __pyx_t_50 = PyList_GET_ITEM(sequence, 23); 
    __pyx_t_49 = PyList_GET_ITEM(sequence, 24); 
    __pyx_t_48 = PyList_GET_ITEM(sequence, 25); 
    __pyx_t_47 = PyList_GET_ITEM(sequence, 26); 
    __pyx_t_46 = PyList_GET_ITEM(sequence, 27); 
    __pyx_t_45 = PyList_GET_ITEM(sequence, 28); 
    __pyx_t_44 = PyList_GET_ITEM(sequence, 29); 
    __pyx_t_43 = PyList_GET_ITEM(sequence, 30); 
    __pyx_t_42 = PyList_GET_ITEM(sequence, 31); 
    __pyx_t_41 = PyList_GET_ITEM(sequence, 32); 
    __pyx_t_40 = PyList_GET_ITEM(sequence, 33); 
    __pyx_t_39 = PyList_GET_ITEM(sequence, 34); 
    __pyx_t_38 = PyList_GET_ITEM(sequence, 35); 
    __pyx_t_37 = PyList_GET_ITEM(sequence, 36); 
    __pyx_t_36 = PyList_GET_ITEM(sequence, 37); 
    __pyx_t_35 = PyList_GET_ITEM(sequence, 38); 
    __pyx_t_34 = PyList_GET_ITEM(sequence, 39); 
    __pyx_t_33 = PyList_GET_ITEM(sequence, 40); 
    __pyx_t_32 = PyList_GET_ITEM(sequence, 41); 
    __pyx_t_31 = PyList_GET_ITEM(sequence, 42); 
    __pyx_t_30 = PyList_GET_ITEM(sequence, 43); 
    __pyx_t_29 = PyList_GET_ITEM(sequence, 44); 
    __pyx_t_28 = PyList_GET_ITEM(sequence, 45); 
    __pyx_t_27 = PyList_GET_ITEM(sequence, 46); 
    __pyx_t_26 = PyList_GET_ITEM(sequence, 47); 
    __pyx_t_25 = PyList_GET_ITEM(sequence, 48); 
    __pyx_t_24 = PyList_GET_ITEM(sequence, 49); 
    __pyx_t_23 = PyList_GET_ITEM(sequence, 50); 
    __pyx_t_22 = PyList_GET_ITEM(sequence, 51); 
    __pyx_t_21 = PyList_GET_ITEM(sequence, 52); 
    __pyx_t_20 = PyList_GET_ITEM(sequence, 53); 
    __pyx_t_19 = PyList_GET_ITEM(sequence, 54); 
    __pyx_t_18 = PyList_GET_ITEM(sequence, 55); 
    __pyx_t_17 = PyList_GET_ITEM(sequence, 56); 
    __pyx_t_11 = PyList_GET_ITEM(sequence, 57); 
    __pyx_t_5 = PyList_GET_ITEM(sequence, 58); 
    __pyx_t_6 = PyList_GET_ITEM(sequence, 59); 
    __pyx_t_8 = PyList_GET_ITEM(sequence, 60); 
    __pyx_t_7 = PyList_GET_ITEM(sequence, 61); 
    __pyx_t_10 = PyList_GET_ITEM(sequence, 62); 
    __pyx_t_9 = PyList_GET_ITEM(sequence, 63); 
    __Pyx_INCREF(__pyx_t_72);
    __Pyx_INCREF(__pyx_t_71);
    __Pyx_INCREF(__pyx_t_73);
    __Pyx_INCREF(__pyx_t_70);
    __Pyx_INCREF(__pyx_t_69);
    __Pyx_INCREF(__pyx_t_68);
    __Pyx_INCREF(__pyx_t_67);
    __Pyx_INCREF(__pyx_t_66);
    __Pyx_INCREF(__pyx_t_65);
    __Pyx_INCREF(__pyx_t_64);
    __Pyx_INCREF(__pyx_t_63);
    __Pyx_INCREF(__pyx_t_62);
    __Pyx_INCREF(__pyx_t_61);
    __Pyx_INCREF(__pyx_t_60);
    __Pyx_INCREF(__pyx_t_59);
    __Pyx_INCREF(__pyx_t_58);
    __Pyx_INCREF(__pyx_t_57);
    __Pyx_INCREF(__pyx_t_56);
    __Pyx_INCREF(__pyx_t_55);
    __Pyx_INCREF(__pyx_t_54);
    __Pyx_INCREF(__pyx_t_53);
    __Pyx_INCREF(__pyx_t_52);
    __Pyx_INCREF(__pyx_t_51);
    __Pyx_INCREF(__pyx_t_50);
    __Pyx_INCREF(__pyx_t_49);
    __Pyx_INCREF(__pyx_t_48);
    __Pyx_INCREF(__pyx_t_47);
    __Pyx_INCREF(__pyx_t_46);
    __Pyx_INCREF(__pyx_t_45);
    __Pyx_INCREF(__pyx_t_44);
    __Pyx_INCREF(__pyx_t_43);
    __Pyx_INCREF(__pyx_t_42);
    __Pyx_INCREF(__pyx_t_41);
    __Pyx_INCREF(__pyx_t_40);
    __Pyx_INCREF(__pyx_t_39);
    __Pyx_INCREF(__pyx_t_38);
    __Pyx_INCREF(__pyx_t_37);
    __Pyx_INCREF(__pyx_t_36);
    __Pyx_INCREF(__pyx_t_35);
    __Pyx_INCREF(__pyx_t_34);
    __Pyx_INCREF(__pyx_t_33);
    __Pyx_INCREF(__pyx_t_32);
    __Pyx_INCREF(__pyx_t_31);
    __Pyx_INCREF(__pyx_t_30);
    __Pyx_INCREF(__pyx_t_29);
    __Pyx_INCREF(__pyx_t_28);
    __Pyx_INCREF(__pyx_t_27);
    __Pyx_INCREF(__pyx_t_26);
    __Pyx_INCREF(__pyx_t_25);
    __Pyx_INCREF(__pyx_t_24);
    __Pyx_INCREF(__pyx_t_23);
    __Pyx_INCREF(__pyx_t_22);
    __Pyx_INCREF(__pyx_t_21);
    __Pyx_INCREF(__pyx_t_20);
    __Pyx_INCREF(__pyx_t_19);
    __Pyx_INCREF(__pyx_t_18);
    __Pyx_INCREF(__pyx_t_17);
    __Pyx_INCREF(__pyx_t_11);
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_t_9);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[64] = {&__pyx_t_72,&__pyx_t_71,&__pyx_t_73,&__pyx_t_70,&__pyx_t_69,&__pyx_t_68,&__pyx_t_67,&__pyx_t_66,&__pyx_t_65,&__pyx_t_64,&__pyx_t_63,&__pyx_t_62,&__pyx_t_61,&__pyx_t_60,&__pyx_t_59,&__pyx_t_58,&__pyx_t_57,&__pyx_t_56,&__pyx_t_55,&__pyx_t_54,&__pyx_t_53,&__pyx_t_52,&__pyx_t_51,&__pyx_t_50,&__pyx_t_49,&__pyx_t_48,&__pyx_t_47,&__pyx_t_46,&__pyx_t_45,&__pyx_t_44,&__pyx_t_43,&__pyx_t_42,&__pyx_t_41,&__pyx_t_40,&__pyx_t_39,&__pyx_t_38,&__pyx_t_37,&__pyx_t_36,&__pyx_t_35,&__pyx_t_34,&__pyx_t_33,&__pyx_t_32,&__pyx_t_31,&__pyx_t_30,&__pyx_t_29,&__pyx_t_28,&__pyx_t_27,&__pyx_t_26,&__pyx_t_25,&__pyx_t_24,&__pyx_t_23,&__pyx_t_22,&__pyx_t_21,&__pyx_t_20,&__pyx_t_19,&__pyx_t_18,&__pyx_t_17,&__pyx_t_11,&__pyx_t_5,&__pyx_t_6,&__pyx_t_8,&__pyx_t_7,&__pyx_t_10,&__pyx_t_9};
      for (i=0; i < 64; i++) {
        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 157, __pyx_L1_error)
        __Pyx_GOTREF(item);
        *(temps[i]) = item;
      }
    }
    #endif
  }

  /* "chess/__init__cp.pyx":157
 * cdef unsigned long long BB_ALL = 0xffffffffffffffff
 * 
 * BB_SQUARES = [             # <<<<<<<<<<<<<<
 *     BB_A1, BB_B1, BB_C1, BB_D1, BB_E1, BB_F1, BB_G1, BB_H1,
 *     BB_A2, BB_B2, BB_C2, BB_D2, BB_E2, BB_F2, BB_G2, BB_H2,
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A1, __pyx_t_72) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_72); __pyx_t_72 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B1, __pyx_t_71) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_71); __pyx_t_71 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C1, __pyx_t_73) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_73); __pyx_t_73 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D1, __pyx_t_70) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_70); __pyx_t_70 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E1, __pyx_t_69) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_69); __pyx_t_69 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F1, __pyx_t_68) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_68); __pyx_t_68 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G1, __pyx_t_67) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_67); __pyx_t_67 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H1, __pyx_t_66) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_66); __pyx_t_66 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A2, __pyx_t_65) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_65); __pyx_t_65 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B2, __pyx_t_64) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_64); __pyx_t_64 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C2, __pyx_t_63) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_63); __pyx_t_63 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D2, __pyx_t_62) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_62); __pyx_t_62 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E2, __pyx_t_61) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_61); __pyx_t_61 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F2, __pyx_t_60) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_60); __pyx_t_60 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G2, __pyx_t_59) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_59); __pyx_t_59 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H2, __pyx_t_58) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_58); __pyx_t_58 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A3, __pyx_t_57) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_57); __pyx_t_57 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B3, __pyx_t_56) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_56); __pyx_t_56 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C3, __pyx_t_55) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_55); __pyx_t_55 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D3, __pyx_t_54) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_54); __pyx_t_54 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E3, __pyx_t_53) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_53); __pyx_t_53 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F3, __pyx_t_52) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_52); __pyx_t_52 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G3, __pyx_t_51) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_51); __pyx_t_51 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H3, __pyx_t_50) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_50); __pyx_t_50 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A4, __pyx_t_49) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_49); __pyx_t_49 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B4, __pyx_t_48) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_48); __pyx_t_48 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C4, __pyx_t_47) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_47); __pyx_t_47 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D4, __pyx_t_46) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_46); __pyx_t_46 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E4, __pyx_t_45) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_45); __pyx_t_45 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F4, __pyx_t_44) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_44); __pyx_t_44 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G4, __pyx_t_43) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_43); __pyx_t_43 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H4, __pyx_t_42) < 0) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_42); __pyx_t_42 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A5, __pyx_t_41) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_41); __pyx_t_41 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B5, __pyx_t_40) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_40); __pyx_t_40 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C5, __pyx_t_39) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_39); __pyx_t_39 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D5, __pyx_t_38) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_38); __pyx_t_38 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E5, __pyx_t_37) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_37); __pyx_t_37 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F5, __pyx_t_36) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_36); __pyx_t_36 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G5, __pyx_t_35) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_35); __pyx_t_35 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H5, __pyx_t_34) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_34); __pyx_t_34 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A6, __pyx_t_33) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_33); __pyx_t_33 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B6, __pyx_t_32) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_32); __pyx_t_32 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C6, __pyx_t_31) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_31); __pyx_t_31 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D6, __pyx_t_30) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_30); __pyx_t_30 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E6, __pyx_t_29) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F6, __pyx_t_28) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_28); __pyx_t_28 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G6, __pyx_t_27) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_27); __pyx_t_27 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H6, __pyx_t_26) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A7, __pyx_t_25) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B7, __pyx_t_24) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C7, __pyx_t_23) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D7, __pyx_t_22) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E7, __pyx_t_21) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F7, __pyx_t_20) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G7, __pyx_t_19) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H7, __pyx_t_18) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_A8, __pyx_t_17) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_B8, __pyx_t_11) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_C8, __pyx_t_5) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_D8, __pyx_t_6) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_E8, __pyx_t_8) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_F8, __pyx_t_7) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_G8, __pyx_t_10) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_H8, __pyx_t_9) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":168
 * ] = [1 << sq for sq in SQUARES]
 * 
 * BB_CORNERS = BB_A1 | BB_H1 | BB_A8 | BB_H8             # <<<<<<<<<<<<<<
 * BB_CENTER = BB_D4 | BB_E4 | BB_D5 | BB_E5
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_A1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_H1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyNumber_Or(__pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_A8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = PyNumber_Or(__pyx_t_10, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_H8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyNumber_Or(__pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_CORNERS, __pyx_t_10) < 0) __PYX_ERR(0, 168, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":169
 * 
 * BB_CORNERS = BB_A1 | BB_H1 | BB_A8 | BB_H8
 * BB_CENTER = BB_D4 | BB_E4 | BB_D5 | BB_E5             # <<<<<<<<<<<<<<
 * 
 * BB_LIGHT_SQUARES = 0x55aa55aa55aa55aa
 */
  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_BB_D4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_E4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = PyNumber_Or(__pyx_t_10, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_D5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyNumber_Or(__pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_E5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = PyNumber_Or(__pyx_t_10, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_CENTER, __pyx_t_1) < 0) __PYX_ERR(0, 169, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":171
 * BB_CENTER = BB_D4 | BB_E4 | BB_D5 | BB_E5
 * 
 * BB_LIGHT_SQUARES = 0x55aa55aa55aa55aa             # <<<<<<<<<<<<<<
 * BB_DARK_SQUARES = 0xaa55aa55aa55aa55
 * 
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_LIGHT_SQUARES, __pyx_int_6172840429334713770) < 0) __PYX_ERR(0, 171, __pyx_L1_error)

  /* "chess/__init__cp.pyx":172
 * 
 * BB_LIGHT_SQUARES = 0x55aa55aa55aa55aa
 * BB_DARK_SQUARES = 0xaa55aa55aa55aa55             # <<<<<<<<<<<<<<
 * 
 * BB_FILES = [
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_DARK_SQUARES, __pyx_int_12273903644374837845) < 0) __PYX_ERR(0, 172, __pyx_L1_error)

  /* "chess/__init__cp.pyx":183
 *     BB_FILE_G,
 *     BB_FILE_H
 * ] = [0x0101010101010101 << i for i in range(8)]             # <<<<<<<<<<<<<<
 * 
 * BB_RANKS = [
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L36_error)
    __Pyx_GOTREF(__pyx_t_1);
    for (__pyx_t_79 = 0; __pyx_t_79 < 8; __pyx_t_79+=1) {
      __pyx_t_9 = __Pyx_PyInt_From_long(__pyx_t_79); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 183, __pyx_L36_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_XGOTREF(__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i);
      __Pyx_DECREF_SET(__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_9 = PyNumber_Lshift(__pyx_int_72340172838076673, __pyx_8genexpr3__pyx_v_5chess_10__init__cp_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 183, __pyx_L36_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_9))) __PYX_ERR(0, 183, __pyx_L36_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_GOTREF(__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i);
    __Pyx_DECREF_SET(__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i, Py_None);
    goto __pyx_L39_exit_scope;
    __pyx_L36_error:;
    __Pyx_GOTREF(__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i);
    __Pyx_DECREF_SET(__pyx_8genexpr3__pyx_v_5chess_10__init__cp_i, Py_None);
    goto __pyx_L1_error;
    __pyx_L39_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILES, __pyx_t_1) < 0) __PYX_ERR(0, 174, __pyx_L1_error)
  if (1) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 8)) {
      if (size > 8) __Pyx_RaiseTooManyValuesError(8);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 174, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_9 = PyList_GET_ITEM(sequence, 0); 
    __pyx_t_10 = PyList_GET_ITEM(sequence, 1); 
    __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
    __pyx_t_8 = PyList_GET_ITEM(sequence, 3); 
    __pyx_t_6 = PyList_GET_ITEM(sequence, 4); 
    __pyx_t_5 = PyList_GET_ITEM(sequence, 5); 
    __pyx_t_11 = PyList_GET_ITEM(sequence, 6); 
    __pyx_t_17 = PyList_GET_ITEM(sequence, 7); 
    __Pyx_INCREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_t_11);
    __Pyx_INCREF(__pyx_t_17);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[8] = {&__pyx_t_9,&__pyx_t_10,&__pyx_t_7,&__pyx_t_8,&__pyx_t_6,&__pyx_t_5,&__pyx_t_11,&__pyx_t_17};
      for (i=0; i < 8; i++) {
        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 174, __pyx_L1_error)
        __Pyx_GOTREF(item);
        *(temps[i]) = item;
      }
    }
    #endif
  }

  /* "chess/__init__cp.pyx":174
 * BB_DARK_SQUARES = 0xaa55aa55aa55aa55
 * 
 * BB_FILES = [             # <<<<<<<<<<<<<<
 *     BB_FILE_A,
 *     BB_FILE_B,
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_A, __pyx_t_9) < 0) __PYX_ERR(0, 175, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_B, __pyx_t_10) < 0) __PYX_ERR(0, 176, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_C, __pyx_t_7) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_D, __pyx_t_8) < 0) __PYX_ERR(0, 178, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_E, __pyx_t_6) < 0) __PYX_ERR(0, 179, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_F, __pyx_t_5) < 0) __PYX_ERR(0, 180, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_G, __pyx_t_11) < 0) __PYX_ERR(0, 181, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_H, __pyx_t_17) < 0) __PYX_ERR(0, 182, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":194
 *     BB_RANK_7,
 *     BB_RANK_8
 * ] = [0xff << (8 * i) for i in range(8)]             # <<<<<<<<<<<<<<
 * 
 * BB_BACKRANKS = BB_RANK_1 | BB_RANK_8
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 194, __pyx_L42_error)
    __Pyx_GOTREF(__pyx_t_1);
    for (__pyx_t_79 = 0; __pyx_t_79 < 8; __pyx_t_79+=1) {
      __pyx_t_17 = __Pyx_PyInt_From_long(__pyx_t_79); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 194, __pyx_L42_error)
      __Pyx_GOTREF(__pyx_t_17);
      __Pyx_XGOTREF(__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i);
      __Pyx_DECREF_SET(__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i, __pyx_t_17);
      __Pyx_GIVEREF(__pyx_t_17);
      __pyx_t_17 = 0;
      __pyx_t_17 = PyNumber_Multiply(__pyx_int_8, __pyx_8genexpr4__pyx_v_5chess_10__init__cp_i); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 194, __pyx_L42_error)
      __Pyx_GOTREF(__pyx_t_17);
      __pyx_t_11 = PyNumber_Lshift(__pyx_int_255, __pyx_t_17); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 194, __pyx_L42_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_11))) __PYX_ERR(0, 194, __pyx_L42_error)
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_GOTREF(__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i);
    __Pyx_DECREF_SET(__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i, Py_None);
    goto __pyx_L45_exit_scope;
    __pyx_L42_error:;
    __Pyx_GOTREF(__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i);
    __Pyx_DECREF_SET(__pyx_8genexpr4__pyx_v_5chess_10__init__cp_i, Py_None);
    goto __pyx_L1_error;
    __pyx_L45_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANKS, __pyx_t_1) < 0) __PYX_ERR(0, 185, __pyx_L1_error)
  if (1) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 8)) {
      if (size > 8) __Pyx_RaiseTooManyValuesError(8);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 185, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_11 = PyList_GET_ITEM(sequence, 0); 
    __pyx_t_17 = PyList_GET_ITEM(sequence, 1); 
    __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
    __pyx_t_6 = PyList_GET_ITEM(sequence, 3); 
    __pyx_t_8 = PyList_GET_ITEM(sequence, 4); 
    __pyx_t_7 = PyList_GET_ITEM(sequence, 5); 
    __pyx_t_10 = PyList_GET_ITEM(sequence, 6); 
    __pyx_t_9 = PyList_GET_ITEM(sequence, 7); 
    __Pyx_INCREF(__pyx_t_11);
    __Pyx_INCREF(__pyx_t_17);
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_t_9);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[8] = {&__pyx_t_11,&__pyx_t_17,&__pyx_t_5,&__pyx_t_6,&__pyx_t_8,&__pyx_t_7,&__pyx_t_10,&__pyx_t_9};
      for (i=0; i < 8; i++) {
        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 185, __pyx_L1_error)
        __Pyx_GOTREF(item);
        *(temps[i]) = item;
      }
    }
    #endif
  }

  /* "chess/__init__cp.pyx":185
 * ] = [0x0101010101010101 << i for i in range(8)]
 * 
 * BB_RANKS = [             # <<<<<<<<<<<<<<
 *     BB_RANK_1,
 *     BB_RANK_2,
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_1, __pyx_t_11) < 0) __PYX_ERR(0, 186, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_2, __pyx_t_17) < 0) __PYX_ERR(0, 187, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_3, __pyx_t_5) < 0) __PYX_ERR(0, 188, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_4, __pyx_t_6) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_5, __pyx_t_8) < 0) __PYX_ERR(0, 190, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_6, __pyx_t_7) < 0) __PYX_ERR(0, 191, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_7, __pyx_t_10) < 0) __PYX_ERR(0, 192, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_8, __pyx_t_9) < 0) __PYX_ERR(0, 193, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":196
 * ] = [0xff << (8 * i) for i in range(8)]
 * 
 * BB_BACKRANKS = BB_RANK_1 | BB_RANK_8             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_BB_RANK_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_BB_RANK_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyNumber_Or(__pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_BACKRANKS, __pyx_t_10) < 0) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":199
 * 
 * 
 * def lsb(bb):             # <<<<<<<<<<<<<<
 *     return (bb & -bb).bit_length() - 1
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_13lsb, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 199, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lsb, __pyx_t_10) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":202
 *     return (bb & -bb).bit_length() - 1
 * 
 * def scan_forward(bb):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb & -bb
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_15scan_forward, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 202, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_scan_forward, __pyx_t_10) < 0) __PYX_ERR(0, 202, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":208
 *         bb ^= r
 * 
 * def msb(bb):             # <<<<<<<<<<<<<<
 *     return bb.bit_length() - 1
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_18msb, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 208, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_msb, __pyx_t_10) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":211
 *     return bb.bit_length() - 1
 * 
 * def scan_reversed(bb, *, _BB_SQUARES=BB_SQUARES):             # <<<<<<<<<<<<<<
 *     while bb:
 *         r = bb.bit_length() - 1
 */
  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_BB_SQUARES_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_k__2 = __pyx_t_10;
  __Pyx_GIVEREF(__pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_20scan_reversed, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_scan_reversed, __pyx_t_10) < 0) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":217
 *         bb ^= _BB_SQUARES[r]
 * 
 * def popcount(bb, *, _bin=bin):             # <<<<<<<<<<<<<<
 *     return _bin(bb).count("1")
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_23popcount, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_popcount, __pyx_t_10) < 0) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":220
 *     return _bin(bb).count("1")
 * 
 * def flip_vertical(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipVertically
 *     bb = ((bb >> 8) & 0x00ff00ff00ff00ff) | ((bb & 0x00ff00ff00ff00ff) << 8)
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_25flip_vertical, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 220, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_flip_vertical, __pyx_t_10) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":227
 *     return bb
 * 
 * def flip_horizontal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#MirrorHorizontally
 *     bb = ((bb >> 1) & 0x5555555555555555) | ((bb & 0x5555555555555555) << 1)
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_27flip_horizontal, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 227, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_flip_horizontal, __pyx_t_10) < 0) __PYX_ERR(0, 227, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":234
 *     return bb
 * 
 * def flip_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheDiagonal
 *     t = (bb ^ (bb << 28)) & 0x0f0f0f0f00000000
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_29flip_diagonal, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 234, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_flip_diagonal, __pyx_t_10) < 0) __PYX_ERR(0, 234, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":244
 *     return bb
 * 
 * def flip_anti_diagonal(bb):             # <<<<<<<<<<<<<<
 *     # https://www.chessprogramming.org/Flipping_Mirroring_and_Rotating#FlipabouttheAntidiagonal
 *     t = bb ^ (bb << 36)
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_31flip_anti_diagonal, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_flip_anti_diagonal, __pyx_t_10) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":255
 * 
 * 
 * def shift_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 8
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_33shift_down, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_down, __pyx_t_10) < 0) __PYX_ERR(0, 255, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":258
 *     return b >> 8
 * 
 * def shift_2_down(b):             # <<<<<<<<<<<<<<
 *     return b >> 16
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_35shift_2_down, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_2_down, __pyx_t_10) < 0) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":261
 *     return b >> 16
 * 
 * def shift_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 8) & BB_ALL
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_37shift_up, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 261, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_up, __pyx_t_10) < 0) __PYX_ERR(0, 261, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":264
 *     return (b << 8) & BB_ALL
 * 
 * def shift_2_up(b):             # <<<<<<<<<<<<<<
 *     return (b << 16) & BB_ALL
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_39shift_2_up, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 264, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_2_up, __pyx_t_10) < 0) __PYX_ERR(0, 264, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":267
 *     return (b << 16) & BB_ALL
 * 
 * def shift_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_41shift_right, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 267, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_right, __pyx_t_10) < 0) __PYX_ERR(0, 267, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":270
 *     return (b << 1) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_2_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_43shift_2_right, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 270, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_2_right, __pyx_t_10) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":273
 *     return (b << 2) & ~BB_FILE_A & ~BB_FILE_B & BB_ALL
 * 
 * def shift_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 1) & ~BB_FILE_H
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_45shift_left, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 273, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_left, __pyx_t_10) < 0) __PYX_ERR(0, 273, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":276
 *     return (b >> 1) & ~BB_FILE_H
 * 
 * def shift_2_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_47shift_2_left, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 276, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_2_left, __pyx_t_10) < 0) __PYX_ERR(0, 276, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":279
 *     return (b >> 2) & ~BB_FILE_G & ~BB_FILE_H
 * 
 * def shift_up_left(b):             # <<<<<<<<<<<<<<
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_49shift_up_left, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 279, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_up_left, __pyx_t_10) < 0) __PYX_ERR(0, 279, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":282
 *     return (b << 7) & ~BB_FILE_H & BB_ALL
 * 
 * def shift_up_right(b):             # <<<<<<<<<<<<<<
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_51shift_up_right, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 282, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_up_right, __pyx_t_10) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":285
 *     return (b << 9) & ~BB_FILE_A & BB_ALL
 * 
 * def shift_down_left(b):             # <<<<<<<<<<<<<<
 *     return (b >> 9) & ~BB_FILE_H
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_53shift_down_left, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 285, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_down_left, __pyx_t_10) < 0) __PYX_ERR(0, 285, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":288
 *     return (b >> 9) & ~BB_FILE_H
 * 
 * def shift_down_right(b):             # <<<<<<<<<<<<<<
 *     return (b >> 7) & ~BB_FILE_A
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_55shift_down_right, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 288, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shift_down_right, __pyx_t_10) < 0) __PYX_ERR(0, 288, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":292
 * 
 * 
 * def _sliding_attacks(square, occupied, deltas):             # <<<<<<<<<<<<<<
 *     attacks = 0
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_57_sliding_attacks, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 292, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sliding_attacks, __pyx_t_10) < 0) __PYX_ERR(0, 292, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":310
 *     return attacks
 * 
 * def _step_attacks(square, deltas):             # <<<<<<<<<<<<<<
 *     return _sliding_attacks(square, BB_ALL, deltas)
 * 
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_59_step_attacks, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_step_attacks, __pyx_t_10) < 0) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":313
 *     return _sliding_attacks(square, BB_ALL, deltas)
 * 
 * BB_KNIGHT_ATTACKS = [_step_attacks(sq, [17, 15, 10, 6, -17, -15, -10, -6]) for sq in SQUARES]             # <<<<<<<<<<<<<<
 * BB_KING_ATTACKS = [_step_attacks(sq, [9, 8, 7, 1, -9, -8, -7, -1]) for sq in SQUARES]
 * BB_PAWN_ATTACKS = [[_step_attacks(sq, deltas) for sq in SQUARES] for deltas in [[-7, -9], [7, 9]]]
 */
  { /* enter inner scope */
    __pyx_t_10 = PyList_New(0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 313, __pyx_L48_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_SQUARES); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 313, __pyx_L48_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (likely(PyList_CheckExact(__pyx_t_9)) || PyTuple_CheckExact(__pyx_t_9)) {
      __pyx_t_1 = __pyx_t_9; __Pyx_INCREF(__pyx_t_1); __pyx_t_75 = 0;
      __pyx_t_76 = NULL;
    } else {
      __pyx_t_75 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 313, __pyx_L48_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_76 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_76)) __PYX_ERR(0, 313, __pyx_L48_error)
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    for (;;) {
      if (likely(!__pyx_t_76)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_75 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_75); __Pyx_INCREF(__pyx_t_9); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 313, __pyx_L48_error)
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_1, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 313, __pyx_L48_error)
          __Pyx_GOTREF(__pyx_t_9);
          #endif
        } else {
          if (__pyx_t_75 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_75); __Pyx_INCREF(__pyx_t_9); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 313, __pyx_L48_error)
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_1, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 313, __pyx_L48_error)
          __Pyx_GOTREF(__pyx_t_9);
          #endif
        }
      } else {
        __pyx_t_9 = __pyx_t_76(__pyx_t_1);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 313, __pyx_L48_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_9);
      }
      __Pyx_XGOTREF(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq);
      __Pyx_DECREF_SET(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_step_attacks); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 313, __pyx_L48_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = PyList_New(8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 313, __pyx_L48_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_INCREF(__pyx_int_17);
      __Pyx_GIVEREF(__pyx_int_17);
      PyList_SET_ITEM(__pyx_t_8, 0, __pyx_int_17);
      __Pyx_INCREF(__pyx_int_15);
      __Pyx_GIVEREF(__pyx_int_15);
      PyList_SET_ITEM(__pyx_t_8, 1, __pyx_int_15);
      __Pyx_INCREF(__pyx_int_10);
      __Pyx_GIVEREF(__pyx_int_10);
      PyList_SET_ITEM(__pyx_t_8, 2, __pyx_int_10);
      __Pyx_INCREF(__pyx_int_6);
      __Pyx_GIVEREF(__pyx_int_6);
      PyList_SET_ITEM(__pyx_t_8, 3, __pyx_int_6);
      __Pyx_INCREF(__pyx_int_neg_17);
      __Pyx_GIVEREF(__pyx_int_neg_17);
      PyList_SET_ITEM(__pyx_t_8, 4, __pyx_int_neg_17);
      __Pyx_INCREF(__pyx_int_neg_15);
      __Pyx_GIVEREF(__pyx_int_neg_15);
      PyList_SET_ITEM(__pyx_t_8, 5, __pyx_int_neg_15);
      __Pyx_INCREF(__pyx_int_neg_10);
      __Pyx_GIVEREF(__pyx_int_neg_10);
      PyList_SET_ITEM(__pyx_t_8, 6, __pyx_int_neg_10);
      __Pyx_INCREF(__pyx_int_neg_6);
      __Pyx_GIVEREF(__pyx_int_neg_6);
      PyList_SET_ITEM(__pyx_t_8, 7, __pyx_int_neg_6);
      __pyx_t_6 = NULL;
      __pyx_t_16 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
          __pyx_t_16 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq, __pyx_t_8};
        __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 313, __pyx_L48_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq, __pyx_t_8};
        __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 313, __pyx_L48_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      } else
      #endif
      {
        __pyx_t_5 = PyTuple_New(2+__pyx_t_16); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 313, __pyx_L48_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_INCREF(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq);
        __Pyx_GIVEREF(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq);
        PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_16, __pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_16, __pyx_t_8);
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 313, __pyx_L48_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_10, (PyObject*)__pyx_t_9))) __PYX_ERR(0, 313, __pyx_L48_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L51_exit_scope;
    __pyx_L48_error:;
    __Pyx_GOTREF(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr5__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L1_error;
    __pyx_L51_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_KNIGHT_ATTACKS, __pyx_t_10) < 0) __PYX_ERR(0, 313, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":314
 * 
 * BB_KNIGHT_ATTACKS = [_step_attacks(sq, [17, 15, 10, 6, -17, -15, -10, -6]) for sq in SQUARES]
 * BB_KING_ATTACKS = [_step_attacks(sq, [9, 8, 7, 1, -9, -8, -7, -1]) for sq in SQUARES]             # <<<<<<<<<<<<<<
 * BB_PAWN_ATTACKS = [[_step_attacks(sq, deltas) for sq in SQUARES] for deltas in [[-7, -9], [7, 9]]]
 * 
 */
  { /* enter inner scope */
    __pyx_t_10 = PyList_New(0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 314, __pyx_L54_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SQUARES); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L54_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_9 = __pyx_t_1; __Pyx_INCREF(__pyx_t_9); __pyx_t_75 = 0;
      __pyx_t_76 = NULL;
    } else {
      __pyx_t_75 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 314, __pyx_L54_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_76 = Py_TYPE(__pyx_t_9)->tp_iternext; if (unlikely(!__pyx_t_76)) __PYX_ERR(0, 314, __pyx_L54_error)
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_76)) {
        if (likely(PyList_CheckExact(__pyx_t_9))) {
          if (__pyx_t_75 >= PyList_GET_SIZE(__pyx_t_9)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_75); __Pyx_INCREF(__pyx_t_1); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 314, __pyx_L54_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_9, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L54_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          if (__pyx_t_75 >= PyTuple_GET_SIZE(__pyx_t_9)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_75); __Pyx_INCREF(__pyx_t_1); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 314, __pyx_L54_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_9, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L54_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_76(__pyx_t_9);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 314, __pyx_L54_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XGOTREF(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq);
      __Pyx_DECREF_SET(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_step_attacks); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 314, __pyx_L54_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = PyList_New(8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 314, __pyx_L54_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_INCREF(__pyx_int_9);
      __Pyx_GIVEREF(__pyx_int_9);
      PyList_SET_ITEM(__pyx_t_5, 0, __pyx_int_9);
      __Pyx_INCREF(__pyx_int_8);
      __Pyx_GIVEREF(__pyx_int_8);
      PyList_SET_ITEM(__pyx_t_5, 1, __pyx_int_8);
      __Pyx_INCREF(__pyx_int_7);
      __Pyx_GIVEREF(__pyx_int_7);
      PyList_SET_ITEM(__pyx_t_5, 2, __pyx_int_7);
      __Pyx_INCREF(__pyx_int_1);
      __Pyx_GIVEREF(__pyx_int_1);
      PyList_SET_ITEM(__pyx_t_5, 3, __pyx_int_1);
      __Pyx_INCREF(__pyx_int_neg_9);
      __Pyx_GIVEREF(__pyx_int_neg_9);
      PyList_SET_ITEM(__pyx_t_5, 4, __pyx_int_neg_9);
      __Pyx_INCREF(__pyx_int_neg_8);
      __Pyx_GIVEREF(__pyx_int_neg_8);
      PyList_SET_ITEM(__pyx_t_5, 5, __pyx_int_neg_8);
      __Pyx_INCREF(__pyx_int_neg_7);
      __Pyx_GIVEREF(__pyx_int_neg_7);
      PyList_SET_ITEM(__pyx_t_5, 6, __pyx_int_neg_7);
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_int_neg_1);
      PyList_SET_ITEM(__pyx_t_5, 7, __pyx_int_neg_1);
      __pyx_t_8 = NULL;
      __pyx_t_16 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
          __pyx_t_16 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq, __pyx_t_5};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L54_error)
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq, __pyx_t_5};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L54_error)
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_6 = PyTuple_New(2+__pyx_t_16); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 314, __pyx_L54_error)
        __Pyx_GOTREF(__pyx_t_6);
        if (__pyx_t_8) {
          __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_8); __pyx_t_8 = NULL;
        }
        __Pyx_INCREF(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq);
        __Pyx_GIVEREF(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq);
        PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_16, __pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_16, __pyx_t_5);
        __pyx_t_5 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L54_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_10, (PyObject*)__pyx_t_1))) __PYX_ERR(0, 314, __pyx_L54_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L57_exit_scope;
    __pyx_L54_error:;
    __Pyx_GOTREF(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq);
    __Pyx_DECREF_SET(__pyx_8genexpr6__pyx_v_5chess_10__init__cp_sq, Py_None);
    goto __pyx_L1_error;
    __pyx_L57_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_KING_ATTACKS, __pyx_t_10) < 0) __PYX_ERR(0, 314, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":315
 * BB_KNIGHT_ATTACKS = [_step_attacks(sq, [17, 15, 10, 6, -17, -15, -10, -6]) for sq in SQUARES]
 * BB_KING_ATTACKS = [_step_attacks(sq, [9, 8, 7, 1, -9, -8, -7, -1]) for sq in SQUARES]
 * BB_PAWN_ATTACKS = [[_step_attacks(sq, deltas) for sq in SQUARES] for deltas in [[-7, -9], [7, 9]]]             # <<<<<<<<<<<<<<
 * 
 * 
 */
  { /* enter inner scope */
    __pyx_t_10 = PyList_New(0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 315, __pyx_L60_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L60_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_int_neg_7);
    __Pyx_GIVEREF(__pyx_int_neg_7);
    PyList_SET_ITEM(__pyx_t_9, 0, __pyx_int_neg_7);
    __Pyx_INCREF(__pyx_int_neg_9);
    __Pyx_GIVEREF(__pyx_int_neg_9);
    PyList_SET_ITEM(__pyx_t_9, 1, __pyx_int_neg_9);
    __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 315, __pyx_L60_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_int_7);
    __Pyx_GIVEREF(__pyx_int_7);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_7);
    __Pyx_INCREF(__pyx_int_9);
    __Pyx_GIVEREF(__pyx_int_9);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_9);
    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 315, __pyx_L60_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
    __pyx_t_9 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __pyx_t_7; __Pyx_INCREF(__pyx_t_1); __pyx_t_75 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    for (;;) {
      if (__pyx_t_75 >= 2) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_75); __Pyx_INCREF(__pyx_t_7); __pyx_t_75++; if (unlikely(0 < 0)) __PYX_ERR(0, 315, __pyx_L60_error)
      #else
      __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_75); __pyx_t_75++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 315, __pyx_L60_error)
      __Pyx_GOTREF(__pyx_t_7);
      #endif
      __Pyx_XGOTREF(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas);
      __Pyx_DECREF_SET(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      __pyx_t_7 = 0;
      { /* enter inner scope */
        __pyx_t_7 = PyList_New(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 315, __pyx_L65_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_SQUARES); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L65_error)
        __Pyx_GOTREF(__pyx_t_9);
        if (likely(PyList_CheckExact(__pyx_t_9)) || PyTuple_CheckExact(__pyx_t_9)) {
          __pyx_t_6 = __pyx_t_9; __Pyx_INCREF(__pyx_t_6); __pyx_t_77 = 0;
          __pyx_t_76 = NULL;
        } else {
          __pyx_t_77 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 315, __pyx_L65_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_76 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_76)) __PYX_ERR(0, 315, __pyx_L65_error)
        }
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        for (;;) {
          if (likely(!__pyx_t_76)) {
            if (likely(PyList_CheckExact(__pyx_t_6))) {
              if (__pyx_t_77 >= PyList_GET_SIZE(__pyx_t_6)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_9 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_77); __Pyx_INCREF(__pyx_t_9); __pyx_t_77++; if (unlikely(0 < 0)) __PYX_ERR(0, 315, __pyx_L65_error)
              #else
              __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_77); __pyx_t_77++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L65_error)
              __Pyx_GOTREF(__pyx_t_9);
              #endif
            } else {
              if (__pyx_t_77 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_77); __Pyx_INCREF(__pyx_t_9); __pyx_t_77++; if (unlikely(0 < 0)) __PYX_ERR(0, 315, __pyx_L65_error)
              #else
              __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_77); __pyx_t_77++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L65_error)
              __Pyx_GOTREF(__pyx_t_9);
              #endif
            }
          } else {
            __pyx_t_9 = __pyx_t_76(__pyx_t_6);
            if (unlikely(!__pyx_t_9)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 315, __pyx_L65_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_9);
          }
          __Pyx_XGOTREF(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq);
          __Pyx_DECREF_SET(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq, __pyx_t_9);
          __Pyx_GIVEREF(__pyx_t_9);
          __pyx_t_9 = 0;
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_step_attacks); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 315, __pyx_L65_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_8 = NULL;
          __pyx_t_16 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_8)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_8);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
              __pyx_t_16 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_5)) {
            PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq, __pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas};
            __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L65_error)
            __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
            __Pyx_GOTREF(__pyx_t_9);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
            PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq, __pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas};
            __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L65_error)
            __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
            __Pyx_GOTREF(__pyx_t_9);
          } else
          #endif
          {
            __pyx_t_17 = PyTuple_New(2+__pyx_t_16); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 315, __pyx_L65_error)
            __Pyx_GOTREF(__pyx_t_17);
            if (__pyx_t_8) {
              __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_8); __pyx_t_8 = NULL;
            }
            __Pyx_INCREF(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq);
            __Pyx_GIVEREF(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq);
            PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_16, __pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq);
            __Pyx_INCREF(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas);
            __Pyx_GIVEREF(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas);
            PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_16, __pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas);
            __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_17, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 315, __pyx_L65_error)
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
          }
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_7, (PyObject*)__pyx_t_9))) __PYX_ERR(0, 315, __pyx_L65_error)
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq);
        __Pyx_DECREF_SET(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq, Py_None);
        goto __pyx_L68_exit_scope;
        __pyx_L65_error:;
        __Pyx_GOTREF(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq);
        __Pyx_DECREF_SET(__pyx_8genexpr8__pyx_v_5chess_10__init__cp_sq, Py_None);
        goto __pyx_L60_error;
        __pyx_L68_exit_scope:;
      } /* exit inner scope */
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_10, (PyObject*)__pyx_t_7))) __PYX_ERR(0, 315, __pyx_L60_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas);
    __Pyx_DECREF_SET(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas, Py_None);
    goto __pyx_L69_exit_scope;
    __pyx_L60_error:;
    __Pyx_GOTREF(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas);
    __Pyx_DECREF_SET(__pyx_8genexpr7__pyx_v_5chess_10__init__cp_deltas, Py_None);
    goto __pyx_L1_error;
    __pyx_L69_exit_scope:;
  } /* exit inner scope */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_PAWN_ATTACKS, __pyx_t_10) < 0) __PYX_ERR(0, 315, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":318
 * 
 * 
 * def _edges(square):             # <<<<<<<<<<<<<<
 *     return (((BB_RANK_1 | BB_RANK_8) & ~BB_RANKS[square_rank(square)]) |
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_61_edges, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_edges, __pyx_t_10) < 0) __PYX_ERR(0, 318, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":322
 *             ((BB_FILE_A | BB_FILE_H) & ~BB_FILES[square_file(square)]))
 * 
 * def _carry_rippler(mask):             # <<<<<<<<<<<<<<
 *     # Carry-Rippler trick to iterate subsets of mask.
 *     subset = 0
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_63_carry_rippler, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_carry_rippler, __pyx_t_10) < 0) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":331
 *             break
 * 
 * def _attack_table(deltas):             # <<<<<<<<<<<<<<
 *     mask_table = []
 *     attack_table = []
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_66_attack_table, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 331, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_attack_table_2, __pyx_t_10) < 0) __PYX_ERR(0, 331, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":347
 *     return mask_table, attack_table
 * 
 * BB_DIAG_MASKS, BB_DIAG_ATTACKS = _attack_table([-9, -7, 7, 9])             # <<<<<<<<<<<<<<
 * BB_FILE_MASKS, BB_FILE_ATTACKS = _attack_table([-8, 8])
 * BB_RANK_MASKS, BB_RANK_ATTACKS = _attack_table([-1, 1])
 */
  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_attack_table_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 347, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 347, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_int_neg_9);
  __Pyx_GIVEREF(__pyx_int_neg_9);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_9);
  __Pyx_INCREF(__pyx_int_neg_7);
  __Pyx_GIVEREF(__pyx_int_neg_7);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_7);
  __Pyx_INCREF(__pyx_int_7);
  __Pyx_GIVEREF(__pyx_int_7);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_7);
  __Pyx_INCREF(__pyx_int_9);
  __Pyx_GIVEREF(__pyx_int_9);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_int_9);
  __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 347, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
    PyObject* sequence = __pyx_t_7;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 347, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_10 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_10 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_10);
    #else
    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    #endif
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_12 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_1 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_1)) goto __pyx_L70_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    index = 1; __pyx_t_10 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_10)) goto __pyx_L70_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_10);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_6), 2) < 0) __PYX_ERR(0, 347, __pyx_L1_error)
    __pyx_t_12 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L71_unpacking_done;
    __pyx_L70_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_12 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 347, __pyx_L1_error)
    __pyx_L71_unpacking_done:;
  }
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_DIAG_MASKS, __pyx_t_1) < 0) __PYX_ERR(0, 347, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_DIAG_ATTACKS, __pyx_t_10) < 0) __PYX_ERR(0, 347, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":348
 * 
 * BB_DIAG_MASKS, BB_DIAG_ATTACKS = _attack_table([-9, -7, 7, 9])
 * BB_FILE_MASKS, BB_FILE_ATTACKS = _attack_table([-8, 8])             # <<<<<<<<<<<<<<
 * BB_RANK_MASKS, BB_RANK_ATTACKS = _attack_table([-1, 1])
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_attack_table_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_10 = PyList_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_INCREF(__pyx_int_neg_8);
  __Pyx_GIVEREF(__pyx_int_neg_8);
  PyList_SET_ITEM(__pyx_t_10, 0, __pyx_int_neg_8);
  __Pyx_INCREF(__pyx_int_8);
  __Pyx_GIVEREF(__pyx_int_8);
  PyList_SET_ITEM(__pyx_t_10, 1, __pyx_int_8);
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 348, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_10 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_10 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_t_7);
    #else
    __pyx_t_10 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_12 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_10 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_10)) goto __pyx_L72_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_10);
    index = 1; __pyx_t_7 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_7)) goto __pyx_L72_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_7);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_6), 2) < 0) __PYX_ERR(0, 348, __pyx_L1_error)
    __pyx_t_12 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L73_unpacking_done;
    __pyx_L72_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_12 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 348, __pyx_L1_error)
    __pyx_L73_unpacking_done:;
  }
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_MASKS, __pyx_t_10) < 0) __PYX_ERR(0, 348, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_FILE_ATTACKS, __pyx_t_7) < 0) __PYX_ERR(0, 348, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":349
 * BB_DIAG_MASKS, BB_DIAG_ATTACKS = _attack_table([-9, -7, 7, 9])
 * BB_FILE_MASKS, BB_FILE_ATTACKS = _attack_table([-8, 8])
 * BB_RANK_MASKS, BB_RANK_ATTACKS = _attack_table([-1, 1])             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_attack_table_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = PyList_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_INCREF(__pyx_int_neg_1);
  __Pyx_GIVEREF(__pyx_int_neg_1);
  PyList_SET_ITEM(__pyx_t_7, 0, __pyx_int_neg_1);
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  PyList_SET_ITEM(__pyx_t_7, 1, __pyx_int_1);
  __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
    PyObject* sequence = __pyx_t_10;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 349, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_7 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_7 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_t_1);
    #else
    __pyx_t_7 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_7 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_7)) goto __pyx_L74_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_7);
    index = 1; __pyx_t_1 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_1)) goto __pyx_L74_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_6), 2) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
    __pyx_t_12 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L75_unpacking_done;
    __pyx_L74_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_12 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 349, __pyx_L1_error)
    __pyx_L75_unpacking_done:;
  }
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_MASKS, __pyx_t_7) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RANK_ATTACKS, __pyx_t_1) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":352
 * 
 * 
 * def _rays():             # <<<<<<<<<<<<<<
 *     rays = []
 *     between = []
 */
  __pyx_t_10 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_68_rays, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_rays_2, __pyx_t_10) < 0) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":375
 *     return rays, between
 * 
 * BB_RAYS, BB_BETWEEN = _rays()             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_rays_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 375, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_10 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_10 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_t_7);
    #else
    __pyx_t_10 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 375, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 375, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 375, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_12 = Py_TYPE(__pyx_t_6)->tp_iternext;
    index = 0; __pyx_t_10 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_10)) goto __pyx_L76_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_10);
    index = 1; __pyx_t_7 = __pyx_t_12(__pyx_t_6); if (unlikely(!__pyx_t_7)) goto __pyx_L76_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_7);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_6), 2) < 0) __PYX_ERR(0, 375, __pyx_L1_error)
    __pyx_t_12 = NULL;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L77_unpacking_done;
    __pyx_L76_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_12 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 375, __pyx_L1_error)
    __pyx_L77_unpacking_done:;
  }
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_RAYS, __pyx_t_10) < 0) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_BETWEEN, __pyx_t_7) < 0) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":378
 * 
 * 
 * SAN_REGEX = re.compile(r"^([NBKRQ])?([a-h])?([1-8])?[\-x]?([a-h][1-8])(=?[nbrqkNBRQK])?(\+|#)?\Z")             # <<<<<<<<<<<<<<
 * 
 * FEN_CASTLING_REGEX = re.compile(r"^(?:-|[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2})\Z")
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_compile); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__141, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SAN_REGEX, __pyx_t_1) < 0) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":380
 * SAN_REGEX = re.compile(r"^([NBKRQ])?([a-h])?([1-8])?[\-x]?([a-h][1-8])(=?[nbrqkNBRQK])?(\+|#)?\Z")
 * 
 * FEN_CASTLING_REGEX = re.compile(r"^(?:-|[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2})\Z")             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_compile); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__142, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FEN_CASTLING_REGEX, __pyx_t_1) < 0) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":383
 * 
 * 
 * class Piece:             # <<<<<<<<<<<<<<
 *     """A piece with type and color."""
 * 
 */
  __pyx_t_1 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_Piece, __pyx_n_s_Piece, (PyObject *) NULL, __pyx_n_s_chess___init__cp, __pyx_kp_s_A_piece_with_type_and_color); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "chess/__init__cp.pyx":386
 *     """A piece with type and color."""
 * 
 *     def __init__(self, piece_type, color):             # <<<<<<<<<<<<<<
 *         self.piece_type = piece_type
 *         self.color = color
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_1__init__, 0, __pyx_n_s_Piece___init, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__144)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 386, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_7) < 0) __PYX_ERR(0, 386, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":390
 *         self.color = color
 * 
 *     def symbol(self):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the symbol ``P``, ``N``, ``B``, ``R``, ``Q`` or ``K`` for white
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_3symbol, 0, __pyx_n_s_Piece_symbol, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__146)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 390, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_symbol, __pyx_t_7) < 0) __PYX_ERR(0, 390, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":400
 *             return PIECE_SYMBOLS[self.piece_type]
 * 
 *     def unicode_symbol(self, *, invert_color=False):             # <<<<<<<<<<<<<<
 *         """
 *         Gets the Unicode character for the piece.
 */
  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 400, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_invert_color, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 400, __pyx_L1_error)
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_5unicode_symbol, 0, __pyx_n_s_Piece_unicode_symbol, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__148)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 400, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_10, __pyx_t_7);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_unicode_symbol, __pyx_t_10) < 0) __PYX_ERR(0, 400, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":409
 *             return UNICODE_PIECE_SYMBOLS[self.symbol().swapcase()]
 * 
 *     def __hash__(self):             # <<<<<<<<<<<<<<
 *         return hash(self.piece_type * (self.color + 1))
 * 
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_7__hash__, 0, __pyx_n_s_Piece___hash, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__150)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 409, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_hash, __pyx_t_10) < 0) __PYX_ERR(0, 409, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":412
 *         return hash(self.piece_type * (self.color + 1))
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_9__repr__, 0, __pyx_n_s_Piece___repr, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__152)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 412, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_repr, __pyx_t_10) < 0) __PYX_ERR(0, 412, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":415
 *         return "Piece.from_symbol('{}')".format(self.symbol())
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         return self.symbol()
 * 
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_11__str__, 0, __pyx_n_s_Piece___str, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__154)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 415, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_str, __pyx_t_10) < 0) __PYX_ERR(0, 415, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":418
 *         return self.symbol()
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.piece(self, size=45)
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_13_repr_svg_, 0, __pyx_n_s_Piece__repr_svg, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__156)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_repr_svg, __pyx_t_10) < 0) __PYX_ERR(0, 418, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":422
 *         return chess.svg.piece(self, size=45)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_15__eq__, 0, __pyx_n_s_Piece___eq, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__158)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 422, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_eq, __pyx_t_10) < 0) __PYX_ERR(0, 422, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":426
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             if self.piece_type != other.piece_type:
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_17__ne__, 0, __pyx_n_s_Piece___ne, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__160)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 426, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_ne, __pyx_t_10) < 0) __PYX_ERR(0, 426, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "chess/__init__cp.pyx":438
 * 
 *     @classmethod
 *     def from_symbol(cls, symbol):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.Piece` instance from a piece symbol.
 */
  __pyx_t_10 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_5Piece_19from_symbol, __Pyx_CYFUNCTION_CLASSMETHOD, __pyx_n_s_Piece_from_symbol_2, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__162)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 438, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);

  /* "chess/__init__cp.pyx":437
 *             return NotImplemented
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_symbol(cls, symbol):
 *         """
 */
  __pyx_t_7 = __Pyx_Method_ClassMethod(__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 437, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_from_symbol, __pyx_t_7) < 0) __PYX_ERR(0, 438, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":383
 * 
 * 
 * class Piece:             # <<<<<<<<<<<<<<
 *     """A piece with type and color."""
 * 
 */
  __pyx_t_7 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_Piece, __pyx_empty_tuple, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 383, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Piece, __pyx_t_7) < 0) __PYX_ERR(0, 383, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":528
 * 
 *     @classmethod
 *     def from_uci(cls, uci):             # <<<<<<<<<<<<<<
 *         """
 *         Parses an UCI string.
 */
  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_5chess_10__init__cp_Move, __pyx_n_s_from_uci); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "chess/__init__cp.pyx":527
 *         return move
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_uci(cls, uci):
 *         """
 */
  __pyx_t_7 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Move->tp_dict, __pyx_n_s_from_uci, __pyx_t_7) < 0) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Move);

  /* "chess/__init__cp.pyx":549
 * 
 *     @classmethod
 *     def null(cls):             # <<<<<<<<<<<<<<
 *         """
 *         Gets a null move.
 */
  __Pyx_GetNameInClass(__pyx_t_7, (PyObject *)__pyx_ptype_5chess_10__init__cp_Move, __pyx_n_s_null); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 549, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);

  /* "chess/__init__cp.pyx":548
 *             raise ValueError("expected uci string to be of length 4 or 5: {}".format(repr(uci)))
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def null(cls):
 *         """
 */
  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 548, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Move->tp_dict, __pyx_n_s_null, __pyx_t_1) < 0) __PYX_ERR(0, 549, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Move);

  /* "chess/__init__cp.pyx":596
 * 
 * 
 *     def __init__(self, str board_fen=STARTING_BOARD_FEN):             # <<<<<<<<<<<<<<
 *         self.occupied_co[0] = BB_EMPTY
 *         self.occupied_co[1] = BB_EMPTY
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STARTING_BOARD_FEN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 596, __pyx_L1_error)
  __pyx_k__10 = ((PyObject*)__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1337
 * 
 *     @classmethod
 *     def empty(cls):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new empty board. Also see
 */
  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_5chess_10__init__cp_BaseBoard, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "chess/__init__cp.pyx":1336
 *         return board
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def empty(cls):
 *         """
 */
  __pyx_t_7 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1336, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_BaseBoard->tp_dict, __pyx_n_s_empty, __pyx_t_7) < 0) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_BaseBoard);

  /* "chess/__init__cp.pyx":1345
 * 
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new board, initialized with a Chess960 starting position.
 */
  __Pyx_GetNameInClass(__pyx_t_7, (PyObject *)__pyx_ptype_5chess_10__init__cp_BaseBoard, __pyx_n_s_from_chess960_pos); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1345, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);

  /* "chess/__init__cp.pyx":1344
 *         return cls(None)
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_chess960_pos(cls, sharnagl):
 *         """
 */
  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_BaseBoard->tp_dict, __pyx_n_s_from_chess960_pos, __pyx_t_1) < 0) __PYX_ERR(0, 1345, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_BaseBoard);

  /* "chess/__init__cp.pyx":1359
 * 
 * 
 * class _BoardState:             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self, board):
 */
  __pyx_t_1 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_BoardState, __pyx_n_s_BoardState, (PyObject *) NULL, __pyx_n_s_chess___init__cp, (PyObject *) NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "chess/__init__cp.pyx":1361
 * class _BoardState:
 * 
 *     def __init__(self, board):             # <<<<<<<<<<<<<<
 *         self.pawns = board.pawns
 *         self.knights = board.knights
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_11_BoardState_1__init__, 0, __pyx_n_s_BoardState___init, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__164)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1361, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_7) < 0) __PYX_ERR(0, 1361, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":1381
 *         self.fullmove_number = board.fullmove_number
 * 
 *     def restore(self, board):             # <<<<<<<<<<<<<<
 *         board.pawns = self.pawns
 *         board.knights = self.knights
 */
  __pyx_t_7 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_11_BoardState_3restore, 0, __pyx_n_s_BoardState_restore, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__166)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1381, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_restore, __pyx_t_7) < 0) __PYX_ERR(0, 1381, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "chess/__init__cp.pyx":1359
 * 
 * 
 * class _BoardState:             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self, board):
 */
  __pyx_t_7 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_BoardState, __pyx_empty_tuple, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BoardState, __pyx_t_7) < 0) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1425
 *     """
 * 
 *     aliases = ["Standard", "Chess", "Classical", "Normal"]             # <<<<<<<<<<<<<<
 *     uci_variant = "chess"
 *     starting_fen = STARTING_FEN
 */
  __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1425, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_u_Standard);
  __Pyx_GIVEREF(__pyx_n_u_Standard);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_Standard);
  __Pyx_INCREF(__pyx_n_u_Chess);
  __Pyx_GIVEREF(__pyx_n_u_Chess);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_Chess);
  __Pyx_INCREF(__pyx_n_u_Classical);
  __Pyx_GIVEREF(__pyx_n_u_Classical);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_Classical);
  __Pyx_INCREF(__pyx_n_u_Normal);
  __Pyx_GIVEREF(__pyx_n_u_Normal);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_n_u_Normal);
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_aliases, __pyx_t_1) < 0) __PYX_ERR(0, 1425, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1426
 * 
 *     aliases = ["Standard", "Chess", "Classical", "Normal"]
 *     uci_variant = "chess"             # <<<<<<<<<<<<<<
 *     starting_fen = STARTING_FEN
 * 
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_uci_variant, __pyx_n_u_chess) < 0) __PYX_ERR(0, 1426, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1427
 *     aliases = ["Standard", "Chess", "Classical", "Normal"]
 *     uci_variant = "chess"
 *     starting_fen = STARTING_FEN             # <<<<<<<<<<<<<<
 * 
 *     tbw_suffix = ".rtbw"
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STARTING_FEN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1427, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_starting_fen, __pyx_t_1) < 0) __PYX_ERR(0, 1427, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1429
 *     starting_fen = STARTING_FEN
 * 
 *     tbw_suffix = ".rtbw"             # <<<<<<<<<<<<<<
 *     tbz_suffix = ".rtbz"
 *     tbw_magic = b"\x71\xe8\x23\x5d"
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_tbw_suffix, __pyx_kp_u_rtbw) < 0) __PYX_ERR(0, 1429, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1430
 * 
 *     tbw_suffix = ".rtbw"
 *     tbz_suffix = ".rtbz"             # <<<<<<<<<<<<<<
 *     tbw_magic = b"\x71\xe8\x23\x5d"
 *     tbz_magic = b"\xd7\x66\x0c\xa5"
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_tbz_suffix, __pyx_kp_u_rtbz) < 0) __PYX_ERR(0, 1430, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1431
 *     tbw_suffix = ".rtbw"
 *     tbz_suffix = ".rtbz"
 *     tbw_magic = b"\x71\xe8\x23\x5d"             # <<<<<<<<<<<<<<
 *     tbz_magic = b"\xd7\x66\x0c\xa5"
 *     pawnless_tbw_suffix = pawnless_tbz_suffix = None
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_tbw_magic, __pyx_kp_b_q_2) < 0) __PYX_ERR(0, 1431, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1432
 *     tbz_suffix = ".rtbz"
 *     tbw_magic = b"\x71\xe8\x23\x5d"
 *     tbz_magic = b"\xd7\x66\x0c\xa5"             # <<<<<<<<<<<<<<
 *     pawnless_tbw_suffix = pawnless_tbz_suffix = None
 *     pawnless_tbw_magic = pawnless_tbz_magic = None
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_tbz_magic, __pyx_kp_b_f_2) < 0) __PYX_ERR(0, 1432, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1433
 *     tbw_magic = b"\x71\xe8\x23\x5d"
 *     tbz_magic = b"\xd7\x66\x0c\xa5"
 *     pawnless_tbw_suffix = pawnless_tbz_suffix = None             # <<<<<<<<<<<<<<
 *     pawnless_tbw_magic = pawnless_tbz_magic = None
 *     connected_kings = False
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_pawnless_tbw_suffix, Py_None) < 0) __PYX_ERR(0, 1433, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_pawnless_tbz_suffix, Py_None) < 0) __PYX_ERR(0, 1433, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1434
 *     tbz_magic = b"\xd7\x66\x0c\xa5"
 *     pawnless_tbw_suffix = pawnless_tbz_suffix = None
 *     pawnless_tbw_magic = pawnless_tbz_magic = None             # <<<<<<<<<<<<<<
 *     connected_kings = False
 *     one_king = True
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_pawnless_tbw_magic, Py_None) < 0) __PYX_ERR(0, 1434, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_pawnless_tbz_magic, Py_None) < 0) __PYX_ERR(0, 1434, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1435
 *     pawnless_tbw_suffix = pawnless_tbz_suffix = None
 *     pawnless_tbw_magic = pawnless_tbz_magic = None
 *     connected_kings = False             # <<<<<<<<<<<<<<
 *     one_king = True
 *     captures_compulsory = False
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_connected_kings, Py_False) < 0) __PYX_ERR(0, 1435, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1436
 *     pawnless_tbw_magic = pawnless_tbz_magic = None
 *     connected_kings = False
 *     one_king = True             # <<<<<<<<<<<<<<
 *     captures_compulsory = False
 * 
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_one_king, Py_True) < 0) __PYX_ERR(0, 1436, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1437
 *     connected_kings = False
 *     one_king = True
 *     captures_compulsory = False             # <<<<<<<<<<<<<<
 * 
 * 
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_captures_compulsory, Py_False) < 0) __PYX_ERR(0, 1437, __pyx_L1_error)
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":1440
 * 
 * 
 *     def __init__(self, fen=STARTING_FEN, *, chess960=False):             # <<<<<<<<<<<<<<
 *         BaseBoard.__init__(self, None)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_STARTING_FEN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1440, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__25 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1517
 *         self.clear_stack()
 * 
 *     def generate_pseudo_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         our_pieces = self.occupied_co[self.turn]
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__27 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1517, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__28 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1584
 *             yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_pseudo_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if not self.ep_square or not BB_SQUARES[self.ep_square] & to_mask:
 *             return
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1584, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__29 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1584, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__30 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1599
 *             yield Move(capturer, self.ep_square)
 * 
 *     def generate_pseudo_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         return itertools.chain(
 *             self.generate_pseudo_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1599, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__31 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1599, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__32 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3133
 *                     BB_RAYS[move.from_square][move.to_square] & BB_SQUARES[king])
 * 
 *     def _generate_evasions(self, king, checkers, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         sliders = checkers & (self.bishops | self.rooks | self.queens)
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__50 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__51 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3158
 *                     yield from self.generate_pseudo_legal_ep(from_mask, to_mask)
 * 
 *     def generate_legal_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3158, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__52 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3158, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__53 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3178
 *             yield from self.generate_pseudo_legal_moves(from_mask, to_mask)
 * 
 *     def generate_legal_ep(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__54 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__55 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3186
 *                 yield move
 * 
 *     def generate_legal_captures(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         return itertools.chain(
 *             self.generate_legal_moves(from_mask, to_mask & self.occupied_co[not self.turn]),
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__56 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__57 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3201
 *         return BB_RANK_ATTACKS[king_to][rank_pieces] & sliders
 * 
 *     def generate_castling_moves(self, from_mask=BB_ALL, to_mask=BB_ALL):             # <<<<<<<<<<<<<<
 *         if self.is_variant_end():
 *             return
 */
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3201, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__58 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_ALL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3201, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__59 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3341
 * 
 *     @classmethod
 *     def empty(cls, *, chess960=False):             # <<<<<<<<<<<<<<
 *         """Creates a new empty board. Also see :func:`~chess.Board.clear()`."""
 *         return cls(None, chess960=chess960)
 */
  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_5chess_10__init__cp_Board, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3341, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "chess/__init__cp.pyx":3340
 *         return board
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def empty(cls, *, chess960=False):
 *         """Creates a new empty board. Also see :func:`~chess.Board.clear()`."""
 */
  __pyx_t_7 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3340, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_empty, __pyx_t_7) < 0) __PYX_ERR(0, 3341, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":3346
 * 
 *     @classmethod
 *     def from_epd(cls, epd, *, chess960=False):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a new board from an EPD string. See
 */
  __Pyx_GetNameInClass(__pyx_t_7, (PyObject *)__pyx_ptype_5chess_10__init__cp_Board, __pyx_n_s_from_epd); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3346, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);

  /* "chess/__init__cp.pyx":3345
 *         return cls(None, chess960=chess960)
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_epd(cls, epd, *, chess960=False):
 *         """
 */
  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3345, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_from_epd, __pyx_t_1) < 0) __PYX_ERR(0, 3346, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":3357
 * 
 *     @classmethod
 *     def from_chess960_pos(cls, sharnagl):             # <<<<<<<<<<<<<<
 *         board = cls.empty(chess960=True)
 *         board.set_chess960_pos(sharnagl)
 */
  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_5chess_10__init__cp_Board, __pyx_n_s_from_chess960_pos); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "chess/__init__cp.pyx":3356
 *         return board, board.set_epd(epd)
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_chess960_pos(cls, sharnagl):
 *         board = cls.empty(chess960=True)
 */
  __pyx_t_7 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem((PyObject *)__pyx_ptype_5chess_10__init__cp_Board->tp_dict, __pyx_n_s_from_chess960_pos, __pyx_t_7) < 0) __PYX_ERR(0, 3357, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  PyType_Modified(__pyx_ptype_5chess_10__init__cp_Board);

  /* "chess/__init__cp.pyx":3418
 * 
 * 
 * class SquareSet(collections.abc.MutableSet):             # <<<<<<<<<<<<<<
 *     """
 *     A set of squares.
 */
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_collections); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_abc); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_MutableSet); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_10 = __Pyx_Py3MetaclassPrepare(__pyx_t_7, __pyx_t_1, __pyx_n_s_SquareSet, __pyx_n_s_SquareSet, (PyObject *) NULL, __pyx_n_s_chess___init__cp, __pyx_kp_s_A_set_of_squares_import_chess_s); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);

  /* "chess/__init__cp.pyx":3492
 *     """
 * 
 *     def __init__(self, squares=BB_EMPTY):             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_1__init__, 0, __pyx_n_s_SquareSet___init, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__168)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_6, sizeof(__pyx_defaults), 1)) __PYX_ERR(0, 3492, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyInt_From_unsigned_PY_LONG_LONG(__pyx_v_5chess_10__init__cp_BB_EMPTY); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_6)->__pyx_arg_squares = __pyx_t_9;
  __Pyx_GIVEREF(__pyx_t_9);
  __pyx_t_9 = 0;
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_6, __pyx_pf_5chess_10__init__cp_79__defaults__);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_init, __pyx_t_6) < 0) __PYX_ERR(0, 3492, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3507
 *     # Set
 * 
 *     def __contains__(self, square):             # <<<<<<<<<<<<<<
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_3__contains__, 0, __pyx_n_s_SquareSet___contains, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__170)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3507, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_contains, __pyx_t_6) < 0) __PYX_ERR(0, 3507, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3510
 *         return bool(BB_SQUARES[square] & self.mask)
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         return scan_forward(self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_5__iter__, 0, __pyx_n_s_SquareSet___iter, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__172)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_iter, __pyx_t_6) < 0) __PYX_ERR(0, 3510, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3513
 *         return scan_forward(self.mask)
 * 
 *     def __reversed__(self):             # <<<<<<<<<<<<<<
 *         return scan_reversed(self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_7__reversed__, 0, __pyx_n_s_SquareSet___reversed, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__174)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3513, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_reversed, __pyx_t_6) < 0) __PYX_ERR(0, 3513, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3516
 *         return scan_reversed(self.mask)
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         return popcount(self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_9__len__, 0, __pyx_n_s_SquareSet___len, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__176)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3516, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_len, __pyx_t_6) < 0) __PYX_ERR(0, 3516, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3521
 *     # MutableSet
 * 
 *     def add(self, square):             # <<<<<<<<<<<<<<
 *         """Adds a square to the set."""
 *         self.mask |= BB_SQUARES[square]
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_11add, 0, __pyx_n_s_SquareSet_add, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__178)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3521, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_add, __pyx_t_6) < 0) __PYX_ERR(0, 3521, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3525
 *         self.mask |= BB_SQUARES[square]
 * 
 *     def discard(self, square):             # <<<<<<<<<<<<<<
 *         """Discards a square from the set."""
 *         self.mask &= ~BB_SQUARES[square]
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_13discard, 0, __pyx_n_s_SquareSet_discard, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__180)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3525, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_discard, __pyx_t_6) < 0) __PYX_ERR(0, 3525, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3531
 *     # frozenset
 * 
 *     def isdisjoint(self, other):             # <<<<<<<<<<<<<<
 *         """Test if the square sets are disjoint."""
 *         return not bool(self & other)
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_15isdisjoint, 0, __pyx_n_s_SquareSet_isdisjoint, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__182)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3531, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_isdisjoint, __pyx_t_6) < 0) __PYX_ERR(0, 3531, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3535
 *         return not bool(self & other)
 * 
 *     def issubset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a subset of another."""
 *         return not bool(~self & other)
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_17issubset, 0, __pyx_n_s_SquareSet_issubset, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__184)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3535, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_issubset, __pyx_t_6) < 0) __PYX_ERR(0, 3535, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3539
 *         return not bool(~self & other)
 * 
 *     def issuperset(self, other):             # <<<<<<<<<<<<<<
 *         """Test if this square set is a superset of another."""
 *         return not bool(self & ~other)
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_19issuperset, 0, __pyx_n_s_SquareSet_issuperset, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__186)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_issuperset, __pyx_t_6) < 0) __PYX_ERR(0, 3539, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3543
 *         return not bool(self & ~other)
 * 
 *     def union(self, other):             # <<<<<<<<<<<<<<
 *         return self | other
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_21union, 0, __pyx_n_s_SquareSet_union, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__188)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_union, __pyx_t_6) < 0) __PYX_ERR(0, 3543, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3546
 *         return self | other
 * 
 *     def __or__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask |= self.mask
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_23__or__, 0, __pyx_n_s_SquareSet___or, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__190)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3546, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_or, __pyx_t_6) < 0) __PYX_ERR(0, 3546, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3551
 *         return r
 * 
 *     def intersection(self, other):             # <<<<<<<<<<<<<<
 *         return self & other
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_25intersection, 0, __pyx_n_s_SquareSet_intersection, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__192)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_intersection, __pyx_t_6) < 0) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3554
 *         return self & other
 * 
 *     def __and__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask &= self.mask
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_27__and__, 0, __pyx_n_s_SquareSet___and, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__194)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3554, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_and, __pyx_t_6) < 0) __PYX_ERR(0, 3554, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3559
 *         return r
 * 
 *     def difference(self, other):             # <<<<<<<<<<<<<<
 *         return self - other
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_29difference, 0, __pyx_n_s_SquareSet_difference, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__196)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3559, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_difference, __pyx_t_6) < 0) __PYX_ERR(0, 3559, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3562
 *         return self - other
 * 
 *     def __sub__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask = self.mask & ~r.mask
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_31__sub__, 0, __pyx_n_s_SquareSet___sub, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__198)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_sub, __pyx_t_6) < 0) __PYX_ERR(0, 3562, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3567
 *         return r
 * 
 *     def symmetric_difference(self, other):             # <<<<<<<<<<<<<<
 *         return self ^ other
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_33symmetric_difference, 0, __pyx_n_s_SquareSet_symmetric_difference, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__200)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3567, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_symmetric_difference, __pyx_t_6) < 0) __PYX_ERR(0, 3567, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3570
 *         return self ^ other
 * 
 *     def __xor__(self, other):             # <<<<<<<<<<<<<<
 *         r = SquareSet(other)
 *         r.mask ^= self.mask
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_35__xor__, 0, __pyx_n_s_SquareSet___xor, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__202)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3570, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_xor, __pyx_t_6) < 0) __PYX_ERR(0, 3570, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3575
 *         return r
 * 
 *     def copy(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_37copy, 0, __pyx_n_s_SquareSet_copy, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__204)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3575, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_copy_2, __pyx_t_6) < 0) __PYX_ERR(0, 3575, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3580
 *     # set
 * 
 *     def update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self |= other
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_39update, 0, __pyx_n_s_SquareSet_update, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__206)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3580, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_update, __pyx_t_6) < 0) __PYX_ERR(0, 3580, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3584
 *             self |= other
 * 
 *     def __ior__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask |= SquareSet(other).mask
 *         return self
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_41__ior__, 0, __pyx_n_s_SquareSet___ior, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__208)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3584, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_ior, __pyx_t_6) < 0) __PYX_ERR(0, 3584, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3588
 *         return self
 * 
 *     def intersection_update(self, *others):             # <<<<<<<<<<<<<<
 *         for other in others:
 *             self &= other
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_43intersection_update, 0, __pyx_n_s_SquareSet_intersection_update, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__210)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_intersection_update, __pyx_t_6) < 0) __PYX_ERR(0, 3588, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3592
 *             self &= other
 * 
 *     def __iand__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= SquareSet(other).mask
 *         return self
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_45__iand__, 0, __pyx_n_s_SquareSet___iand, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__212)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3592, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_iand, __pyx_t_6) < 0) __PYX_ERR(0, 3592, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3596
 *         return self
 * 
 *     def difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self -= other
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_47difference_update, 0, __pyx_n_s_SquareSet_difference_update, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__214)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_difference_update, __pyx_t_6) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3599
 *         self -= other
 * 
 *     def __isub__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask &= ~SquareSet(other).mask
 *         return self
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_49__isub__, 0, __pyx_n_s_SquareSet___isub, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__216)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3599, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_isub, __pyx_t_6) < 0) __PYX_ERR(0, 3599, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3603
 *         return self
 * 
 *     def symmetric_difference_update(self, other):             # <<<<<<<<<<<<<<
 *         self ^= other
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_51symmetric_difference_update, 0, __pyx_n_s_SquareSet_symmetric_difference_u, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__218)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3603, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_symmetric_difference_update, __pyx_t_6) < 0) __PYX_ERR(0, 3603, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3606
 *         self ^= other
 * 
 *     def __ixor__(self, other):             # <<<<<<<<<<<<<<
 *         self.mask ^= SquareSet(other).mask
 *         return self
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_53__ixor__, 0, __pyx_n_s_SquareSet___ixor, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__220)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3606, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_ixor, __pyx_t_6) < 0) __PYX_ERR(0, 3606, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3610
 *         return self
 * 
 *     def remove(self, square):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set.
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_55remove, 0, __pyx_n_s_SquareSet_remove, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__222)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_remove, __pyx_t_6) < 0) __PYX_ERR(0, 3610, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3622
 *             raise KeyError(square)
 * 
 *     def pop(self):             # <<<<<<<<<<<<<<
 *         """
 *         Removes a square from the set and returns it.
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_57pop, 0, __pyx_n_s_SquareSet_pop, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__224)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3622, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_pop, __pyx_t_6) < 0) __PYX_ERR(0, 3622, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3635
 *         return square
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         """Remove all elements from this set."""
 *         self.mask = BB_EMPTY
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_59clear, 0, __pyx_n_s_SquareSet_clear, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__226)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3635, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_clear, __pyx_t_6) < 0) __PYX_ERR(0, 3635, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3641
 *     # SquareSet
 * 
 *     def carry_rippler(self):             # <<<<<<<<<<<<<<
 *         """Iterator over the subsets of this set."""
 *         return _carry_rippler(self.mask)
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_61carry_rippler, 0, __pyx_n_s_SquareSet_carry_rippler, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__228)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3641, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_carry_rippler_2, __pyx_t_6) < 0) __PYX_ERR(0, 3641, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3645
 *         return _carry_rippler(self.mask)
 * 
 *     def mirror(self):             # <<<<<<<<<<<<<<
 *         """Returns a vertically mirrored copy of this square set."""
 *         return SquareSet(flip_vertical(self.mask))
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_63mirror, 0, __pyx_n_s_SquareSet_mirror, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__230)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3645, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_mirror, __pyx_t_6) < 0) __PYX_ERR(0, 3645, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3649
 *         return SquareSet(flip_vertical(self.mask))
 * 
 *     def tolist(self):             # <<<<<<<<<<<<<<
 *         """Convert the set to a list of 64 bools."""
 *         l = [False] * 64
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_65tolist, 0, __pyx_n_s_SquareSet_tolist, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__232)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3649, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_tolist, __pyx_t_6) < 0) __PYX_ERR(0, 3649, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3656
 *         return l
 * 
 *     def __bool__(self):             # <<<<<<<<<<<<<<
 *         return bool(self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_67__bool__, 0, __pyx_n_s_SquareSet___bool, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__234)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_bool, __pyx_t_6) < 0) __PYX_ERR(0, 3656, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3659
 *         return bool(self.mask)
 * 
 *     def __eq__(self, other):             # <<<<<<<<<<<<<<
 *         ne = self.__ne__(other)
 *         return NotImplemented if ne is NotImplemented else not ne
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_69__eq__, 0, __pyx_n_s_SquareSet___eq, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__236)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_eq, __pyx_t_6) < 0) __PYX_ERR(0, 3659, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3663
 *         return NotImplemented if ne is NotImplemented else not ne
 * 
 *     def __ne__(self, other):             # <<<<<<<<<<<<<<
 *         try:
 *             return self.mask != SquareSet(other).mask
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_71__ne__, 0, __pyx_n_s_SquareSet___ne, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__238)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3663, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_ne, __pyx_t_6) < 0) __PYX_ERR(0, 3663, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3669
 *             return NotImplemented
 * 
 *     def __lshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_73__lshift__, 0, __pyx_n_s_SquareSet___lshift, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__240)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_lshift, __pyx_t_6) < 0) __PYX_ERR(0, 3669, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3672
 *         return SquareSet((self.mask << shift) & BB_ALL)
 * 
 *     def __rshift__(self, shift):             # <<<<<<<<<<<<<<
 *         return SquareSet(self.mask >> shift)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_75__rshift__, 0, __pyx_n_s_SquareSet___rshift, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__242)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3672, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_rshift, __pyx_t_6) < 0) __PYX_ERR(0, 3672, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3675
 *         return SquareSet(self.mask >> shift)
 * 
 *     def __ilshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask = (self.mask << shift) & BB_ALL
 *         return self
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_77__ilshift__, 0, __pyx_n_s_SquareSet___ilshift, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__244)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3675, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_ilshift, __pyx_t_6) < 0) __PYX_ERR(0, 3675, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3679
 *         return self
 * 
 *     def __irshift__(self, shift):             # <<<<<<<<<<<<<<
 *         self.mask >>= shift
 *         return self
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_79__irshift__, 0, __pyx_n_s_SquareSet___irshift, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__246)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_irshift, __pyx_t_6) < 0) __PYX_ERR(0, 3679, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3683
 *         return self
 * 
 *     def __invert__(self):             # <<<<<<<<<<<<<<
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_81__invert__, 0, __pyx_n_s_SquareSet___invert, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__248)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_invert, __pyx_t_6) < 0) __PYX_ERR(0, 3683, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3686
 *         return SquareSet(~self.mask & BB_ALL)
 * 
 *     def __int__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_83__int__, 0, __pyx_n_s_SquareSet___int, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__250)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3686, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_int, __pyx_t_6) < 0) __PYX_ERR(0, 3686, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3689
 *         return self.mask
 * 
 *     def __index__(self):             # <<<<<<<<<<<<<<
 *         return self.mask
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_85__index__, 0, __pyx_n_s_SquareSet___index, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__252)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_index_2, __pyx_t_6) < 0) __PYX_ERR(0, 3689, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3692
 *         return self.mask
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_87__repr__, 0, __pyx_n_s_SquareSet___repr, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__254)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3692, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_repr, __pyx_t_6) < 0) __PYX_ERR(0, 3692, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3695
 *         return "SquareSet({0:#018x})".format(self.mask)
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         builder = []
 *         print("+_+_+_+_+_+_+_+_+_+_+_+", )
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_89__str__, 0, __pyx_n_s_SquareSet___str, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__256)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3695, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_str, __pyx_t_6) < 0) __PYX_ERR(0, 3695, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3713
 *         return "".join(builder)
 * 
 *     def _repr_svg_(self):             # <<<<<<<<<<<<<<
 *         import chess.svg
 *         return chess.svg.board(squares=self, size=400)
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_91_repr_svg_, 0, __pyx_n_s_SquareSet__repr_svg, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__258)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3713, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_repr_svg, __pyx_t_6) < 0) __PYX_ERR(0, 3713, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "chess/__init__cp.pyx":3718
 * 
 *     @classmethod
 *     def from_square(cls, square):             # <<<<<<<<<<<<<<
 *         """
 *         Creates a :class:`~chess.SquareSet` from a single square.
 */
  __pyx_t_6 = __Pyx_CyFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_9SquareSet_93from_square, __Pyx_CYFUNCTION_CLASSMETHOD, __pyx_n_s_SquareSet_from_square, NULL, __pyx_n_s_chess___init__cp, __pyx_d, ((PyObject *)__pyx_codeobj__260)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3718, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);

  /* "chess/__init__cp.pyx":3717
 *         return chess.svg.board(squares=self, size=400)
 * 
 *     @classmethod             # <<<<<<<<<<<<<<
 *     def from_square(cls, square):
 *         """
 */
  __pyx_t_9 = __Pyx_Method_ClassMethod(__pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3717, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__Pyx_SetNameInClass(__pyx_t_10, __pyx_n_s_from_square, __pyx_t_9) < 0) __PYX_ERR(0, 3718, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "chess/__init__cp.pyx":3418
 * 
 * 
 * class SquareSet(collections.abc.MutableSet):             # <<<<<<<<<<<<<<
 *     """
 *     A set of squares.
 */
  __pyx_t_9 = __Pyx_Py3ClassCreate(__pyx_t_7, __pyx_n_s_SquareSet, __pyx_t_1, __pyx_t_10, NULL, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SquareSet, __pyx_t_9) < 0) __PYX_ERR(0, 3418, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":3731
 * 
 * # TODO: Deprecated
 * BB_VOID = 0             # <<<<<<<<<<<<<<
 * bswap = flip_vertical
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BB_VOID, __pyx_int_0) < 0) __PYX_ERR(0, 3731, __pyx_L1_error)

  /* "chess/__init__cp.pyx":3732
 * # TODO: Deprecated
 * BB_VOID = 0
 * bswap = flip_vertical             # <<<<<<<<<<<<<<
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_flip_vertical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_bswap, __pyx_t_1) < 0) __PYX_ERR(0, 3732, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_Move(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_70__pyx_unpickle_Move, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Move, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":11
 *         __pyx_unpickle_Move__set_state(<Move> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_Move__set_state(Move __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.drop = __pyx_state[0]; __pyx_result.from_square = __pyx_state[1]; __pyx_result.promotion = __pyx_state[2]; __pyx_result.to_square = __pyx_state[3]
 *     if len(__pyx_state) > 4 and hasattr(__pyx_result, '__dict__'):
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_72__pyx_unpickle_BaseBoard, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_BaseBoard, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_Board(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_74__pyx_unpickle_Board, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Board, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":11
 *         __pyx_unpickle_Board__set_state(<Board> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_Board__set_state(Board __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.bishops = __pyx_state[0]; __pyx_result.castling_rights = __pyx_state[1]; __pyx_result.chess960 = __pyx_state[2]; __pyx_result.ep_square = __pyx_state[3]; __pyx_result.fullmove_number = __pyx_state[4]; __pyx_result.halfmove_clock = __pyx_state[5]; __pyx_result.kings = __pyx_state[6]; __pyx_result.knights = __pyx_state[7]; __pyx_result.legal_moves = __pyx_state[8]; __pyx_result.move_stack = __pyx_state[9]; __pyx_result.occupied = __pyx_state[10]; __pyx_result.occupied_co = __pyx_state[11]; __pyx_result.pawns = __pyx_state[12]; __pyx_result.promoted = __pyx_state[13]; __pyx_result.pseudo_legal_moves = __pyx_state[14]; __pyx_result.queens = __pyx_state[15]; __pyx_result.rooks = __pyx_state[16]; __pyx_result.stack = __pyx_state[17]; __pyx_result.turn = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_76__pyx_unpickle_PseudoLegalMoveGenerator, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_PseudoLegalMoveGe, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_LegalMoveGenerator(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_5chess_10__init__cp_78__pyx_unpickle_LegalMoveGenerator, NULL, __pyx_n_s_chess___init__cp); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_LegalMoveGenerato, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "chess/__init__cp.pyx":1
 * # -*- coding: utf-8 -*-             # <<<<<<<<<<<<<<
 * # cython: language_level=3
 * 
 */
  __pyx_t_1 = __Pyx_PyDict_NewPresized(6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_u_Move_null_line_549, __pyx_kp_u_Gets_a_null_move_A_null_move_ju) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_u_BaseBoard_pin_line_799, __pyx_kp_u_Detects_an_absolute_pin_and_its) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_u_BaseBoard_from_chess960_pos_line, __pyx_kp_u_Creates_a_new_board_initialized) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_u_Board_push_line_1929, __pyx_kp_u_Updates_the_position_with_the_g) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_u_Board_epd_line_2358, __pyx_kp_u_Gets_an_EPD_representation_of_t) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_u_SquareSet_from_square_line_3718, __pyx_kp_u_Creates_a_class_chess_SquareSet) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "carray.from_py":77
 * 
 * @cname("__Pyx_carray_from_py_unsigned_PY_LONG_LONG")
 * cdef int __Pyx_carray_from_py_unsigned_PY_LONG_LONG(object o, base_type *v, Py_ssize_t length) except -1:             # <<<<<<<<<<<<<<
 *     cdef Py_ssize_t i = length
 *     try:
 */

  /*--- Wrapped vars code ---*/

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_17);
  __Pyx_XDECREF(__pyx_t_18);
  __Pyx_XDECREF(__pyx_t_19);
  __Pyx_XDECREF(__pyx_t_20);
  __Pyx_XDECREF(__pyx_t_21);
  __Pyx_XDECREF(__pyx_t_22);
  __Pyx_XDECREF(__pyx_t_23);
  __Pyx_XDECREF(__pyx_t_24);
  __Pyx_XDECREF(__pyx_t_25);
  __Pyx_XDECREF(__pyx_t_26);
  __Pyx_XDECREF(__pyx_t_27);
  __Pyx_XDECREF(__pyx_t_28);
  __Pyx_XDECREF(__pyx_t_29);
  __Pyx_XDECREF(__pyx_t_30);
  __Pyx_XDECREF(__pyx_t_31);
  __Pyx_XDECREF(__pyx_t_32);
  __Pyx_XDECREF(__pyx_t_33);
  __Pyx_XDECREF(__pyx_t_34);
  __Pyx_XDECREF(__pyx_t_35);
  __Pyx_XDECREF(__pyx_t_36);
  __Pyx_XDECREF(__pyx_t_37);
  __Pyx_XDECREF(__pyx_t_38);
  __Pyx_XDECREF(__pyx_t_39);
  __Pyx_XDECREF(__pyx_t_40);
  __Pyx_XDECREF(__pyx_t_41);
  __Pyx_XDECREF(__pyx_t_42);
  __Pyx_XDECREF(__pyx_t_43);
  __Pyx_XDECREF(__pyx_t_44);
  __Pyx_XDECREF(__pyx_t_45);
  __Pyx_XDECREF(__pyx_t_46);
  __Pyx_XDECREF(__pyx_t_47);
  __Pyx_XDECREF(__pyx_t_48);
  __Pyx_XDECREF(__pyx_t_49);
  __Pyx_XDECREF(__pyx_t_50);
  __Pyx_XDECREF(__pyx_t_51);
  __Pyx_XDECREF(__pyx_t_52);
  __Pyx_XDECREF(__pyx_t_53);
  __Pyx_XDECREF(__pyx_t_54);
  __Pyx_XDECREF(__pyx_t_55);
  __Pyx_XDECREF(__pyx_t_56);
  __Pyx_XDECREF(__pyx_t_57);
  __Pyx_XDECREF(__pyx_t_58);
  __Pyx_XDECREF(__pyx_t_59);
  __Pyx_XDECREF(__pyx_t_60);
  __Pyx_XDECREF(__pyx_t_61);
  __Pyx_XDECREF(__pyx_t_62);
  __Pyx_XDECREF(__pyx_t_63);
  __Pyx_XDECREF(__pyx_t_64);
  __Pyx_XDECREF(__pyx_t_65);
  __Pyx_XDECREF(__pyx_t_66);
  __Pyx_XDECREF(__pyx_t_67);
  __Pyx_XDECREF(__pyx_t_68);
  __Pyx_XDECREF(__pyx_t_69);
  __Pyx_XDECREF(__pyx_t_70);
  __Pyx_XDECREF(__pyx_t_71);
  __Pyx_XDECREF(__pyx_t_72);
  __Pyx_XDECREF(__pyx_t_73);
  __Pyx_XDECREF(__pyx_t_74);
  if (__pyx_m) {
    if (__pyx_d) {
      __Pyx_AddTraceback("init chess.__init__cp", __pyx_clineno, __pyx_lineno, __pyx_filename);
    }
    Py_CLEAR(__pyx_m);
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init chess.__init__cp");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  return (__pyx_m != NULL) ? 0 : -1;
  #elif PY_MAJOR_VERSION >= 3
  return __pyx_m;
  #else
  return;
  #endif
}

/* --- Runtime support code --- */
/* Refnanny */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule(modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, "RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif

/* PyObjectGetAttrStr */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#endif

/* GetBuiltinName */
static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
    if (unlikely(!result)) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%.200s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

/* RaiseArgTupleInvalid */
static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

/* RaiseDoubleKeywords */
static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

/* ParseKeywords */
static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
            continue;
        }
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_CheckExact(key)) || likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (**name == key) ? 0 :
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (PyUnicode_GET_SIZE(**name) != PyUnicode_GET_SIZE(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key);
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (PyUnicode_GET_SIZE(**argname) != PyUnicode_GET_SIZE(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AndObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
            return PyInt_FromLong(a & b);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_and(op1, op2);
            }
        }
                x = a & b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla & llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceAnd : PyNumber_And)(op1, op2);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_RshiftObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
            return PyInt_FromLong(a >> b);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_rshift(op1, op2);
            }
        }
                x = a >> b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla >> llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceRshift : PyNumber_Rshift)(op1, op2);
}
#endif

/* PyDictVersioning */
#if CYTHON_USE_DICT_VERSIONS
static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
    PyObject *dict = Py_TYPE(obj)->tp_dict;
    return dict ? __PYX_GET_DICT_VERSION(dict) : 0;
}
static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
    PyObject **dictptr = NULL;
    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
    if (offset) {
        dictptr = (offset > 0) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
    }
    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
}
static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
    PyObject *dict = Py_TYPE(obj)->tp_dict;
    if (!dict || tp_dict_version != __PYX_GET_DICT_VERSION(dict))
        return 0;
    return obj_dict_version == __Pyx_get_object_dict_version(obj);
}
#endif

/* GetModuleGlobalName */
#if CYTHON_USE_DICT_VERSIONS
static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
#else
static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
#endif
{
    PyObject *result;
#if !CYTHON_AVOID_BORROWED_REFS
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    } else if (unlikely(PyErr_Occurred())) {
        return NULL;
    }
#else
    result = PyDict_GetItem(__pyx_d, name);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    }
#endif
#else
    result = PyObject_GetItem(__pyx_d, name);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    }
    PyErr_Clear();
#endif
    return __Pyx_GetBuiltinName(name);
}

/* GetItemInt */
static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    Py_ssize_t wrapped_i = i;
    if (wraparound & unlikely(i < 0)) {
        wrapped_i += PyList_GET_SIZE(o);
    }
    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    Py_ssize_t wrapped_i = i;
    if (wraparound & unlikely(i < 0)) {
        wrapped_i += PyTuple_GET_SIZE(o);
    }
    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
                                                     CYTHON_NCP_UNUSED int wraparound,
                                                     CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
            PyObject *r = PyList_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    }
    else if (PyTuple_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return NULL;
                    PyErr_Clear();
                }
            }
            return m->sq_item(o, i);
        }
    }
#else
    if (is_list || PySequence_Check(o)) {
        return PySequence_GetItem(o, i);
    }
#endif
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
}

/* ObjectGetItem */
#if CYTHON_USE_TYPE_SLOTS
static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject* index) {
    PyObject *runerr;
    Py_ssize_t key_value;
    PySequenceMethods *m = Py_TYPE(obj)->tp_as_sequence;
    if (unlikely(!(m && m->sq_item))) {
        PyErr_Format(PyExc_TypeError, "'%.200s' object is not subscriptable", Py_TYPE(obj)->tp_name);
        return NULL;
    }
    key_value = __Pyx_PyIndex_AsSsize_t(index);
    if (likely(key_value != -1 || !(runerr = PyErr_Occurred()))) {
        return __Pyx_GetItemInt_Fast(obj, key_value, 0, 1, 1);
    }
    if (PyErr_GivenExceptionMatches(runerr, PyExc_OverflowError)) {
        PyErr_Clear();
        PyErr_Format(PyExc_IndexError, "cannot fit '%.200s' into an index-sized integer", Py_TYPE(index)->tp_name);
    }
    return NULL;
}
static PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key) {
    PyMappingMethods *m = Py_TYPE(obj)->tp_as_mapping;
    if (likely(m && m->mp_subscript)) {
        return m->mp_subscript(obj, key);
    }
    return __Pyx_PyObject_GetIndex(obj, key);
}
#endif

/* py_abs */
#if CYTHON_USE_PYLONG_INTERNALS
static PyObject *__Pyx_PyLong_AbsNeg(PyObject *n) {
    if (likely(Py_SIZE(n) == -1)) {
        return PyLong_FromLong(((PyLongObject*)n)->ob_digit[0]);
    }
#if CYTHON_COMPILING_IN_CPYTHON
    {
        PyObject *copy = _PyLong_Copy((PyLongObject*)n);
        if (likely(copy)) {
            Py_SIZE(copy) = -(Py_SIZE(copy));
        }
        return copy;
    }
#else
    return PyNumber_Negative(n);
#endif
}
#endif

/* PyCFunctionFastCall */
#if CYTHON_FAST_PYCCALL
static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
    PyObject *self = PyCFunction_GET_SELF(func);
    int flags = PyCFunction_GET_FLAGS(func);
    assert(PyCFunction_Check(func));
    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
    assert(nargs >= 0);
    assert(nargs == 0 || args != NULL);
    /* _PyCFunction_FastCallDict() must not be called with an exception set,
       because it may clear it (directly or indirectly) and so the
       caller loses its exception */
    assert(!PyErr_Occurred());
    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
    } else {
        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
    }
}
#endif

/* PyFunctionFastCall */
#if CYTHON_FAST_PYCALL
static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                               PyObject *globals) {
    PyFrameObject *f;
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    PyObject **fastlocals;
    Py_ssize_t i;
    PyObject *result;
    assert(globals != NULL);
    /* XXX Perhaps we should create a specialized
       PyFrame_New() that doesn't take locals, but does
       take builtins without sanity checking them.
       */
    assert(tstate != NULL);
    f = PyFrame_New(tstate, co, globals, NULL);
    if (f == NULL) {
        return NULL;
    }
    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
    for (i = 0; i < na; i++) {
        Py_INCREF(*args);
        fastlocals[i] = *args++;
    }
    result = PyEval_EvalFrameEx(f,0);
    ++tstate->recursion_depth;
    Py_DECREF(f);
    --tstate->recursion_depth;
    return result;
}
#if 1 || PY_VERSION_HEX < 0x030600B1
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, int nargs, PyObject *kwargs) {
    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
    PyObject *globals = PyFunction_GET_GLOBALS(func);
    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
    PyObject *closure;
#if PY_MAJOR_VERSION >= 3
    PyObject *kwdefs;
#endif
    PyObject *kwtuple, **k;
    PyObject **d;
    Py_ssize_t nd;
    Py_ssize_t nk;
    PyObject *result;
    assert(kwargs == NULL || PyDict_Check(kwargs));
    nk = kwargs ? PyDict_Size(kwargs) : 0;
    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
        return NULL;
    }
    if (
#if PY_MAJOR_VERSION >= 3
            co->co_kwonlyargcount == 0 &&
#endif
            likely(kwargs == NULL || nk == 0) &&
            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
        if (argdefs == NULL && co->co_argcount == nargs) {
            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
            goto done;
        }
        else if (nargs == 0 && argdefs != NULL
                 && co->co_argcount == Py_SIZE(argdefs)) {
            /* function called with no arguments, but all parameters have
               a default value: use default values as arguments .*/
            args = &PyTuple_GET_ITEM(argdefs, 0);
            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
            goto done;
        }
    }
    if (kwargs != NULL) {
        Py_ssize_t pos, i;
        kwtuple = PyTuple_New(2 * nk);
        if (kwtuple == NULL) {
            result = NULL;
            goto done;
        }
        k = &PyTuple_GET_ITEM(kwtuple, 0);
        pos = i = 0;
        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
            Py_INCREF(k[i]);
            Py_INCREF(k[i+1]);
            i += 2;
        }
        nk = i / 2;
    }
    else {
        kwtuple = NULL;
        k = NULL;
    }
    closure = PyFunction_GET_CLOSURE(func);
#if PY_MAJOR_VERSION >= 3
    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
#endif
    if (argdefs != NULL) {
        d = &PyTuple_GET_ITEM(argdefs, 0);
        nd = Py_SIZE(argdefs);
    }
    else {
        d = NULL;
        nd = 0;
    }
#if PY_MAJOR_VERSION >= 3
    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
                               args, nargs,
                               k, (int)nk,
                               d, (int)nd, kwdefs, closure);
#else
    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
                               args, nargs,
                               k, (int)nk,
                               d, (int)nd, closure);
#endif
    Py_XDECREF(kwtuple);
done:
    Py_LeaveRecursiveCall();
    return result;
}
#endif
#endif

/* PyObjectCall */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyObject *result;
    ternaryfunc call = func->ob_type->tp_call;
    if (unlikely(!call))
        return PyObject_Call(func, arg, kw);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = (*call)(func, arg, kw);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCall2Args */
static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
    PyObject *args, *result = NULL;
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(function)) {
        PyObject *args[2] = {arg1, arg2};
        return __Pyx_PyFunction_FastCall(function, args, 2);
    }
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(function)) {
        PyObject *args[2] = {arg1, arg2};
        return __Pyx_PyCFunction_FastCall(function, args, 2);
    }
    #endif
    args = PyTuple_New(2);
    if (unlikely(!args)) goto done;
    Py_INCREF(arg1);
    PyTuple_SET_ITEM(args, 0, arg1);
    Py_INCREF(arg2);
    PyTuple_SET_ITEM(args, 1, arg2);
    Py_INCREF(function);
    result = __Pyx_PyObject_Call(function, args, NULL);
    Py_DECREF(args);
    Py_DECREF(function);
done:
    return result;
}

/* PyObjectCallMethO */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
    PyObject *self, *result;
    PyCFunction cfunc;
    cfunc = PyCFunction_GET_FUNCTION(func);
    self = PyCFunction_GET_SELF(func);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = cfunc(self, arg);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCallOneArg */
#if CYTHON_COMPILING_IN_CPYTHON
static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_New(1);
    if (unlikely(!args)) return NULL;
    Py_INCREF(arg);
    PyTuple_SET_ITEM(args, 0, arg);
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
#if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCall(func, &arg, 1);
    }
#endif
    if (likely(PyCFunction_Check(func))) {
        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
            return __Pyx_PyObject_CallMethO(func, arg);
#if CYTHON_FAST_PYCCALL
        } else if (PyCFunction_GET_FLAGS(func) & METH_FASTCALL) {
            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
#endif
        }
    }
    return __Pyx__PyObject_CallOneArg(func, arg);
}
#else
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_Pack(1, arg);
    if (unlikely(!args)) return NULL;
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_XorObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
            return PyInt_FromLong(a ^ b);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_xor(op1, op2);
            }
        }
                x = a ^ b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla ^ llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceXor : PyNumber_Xor)(op1, op2);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
            x = (long)((unsigned long)a - b);
            if (likely((x^a) >= 0 || (x^~b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
            }
        }
                x = a - b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla - llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            double result;
            PyFPE_START_PROTECT("subtract", return NULL)
            result = ((double)a) - (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceSubtract : PyNumber_Subtract)(op1, op2);
}
#endif

/* PyObjectCallNoArg */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
#if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCall(func, NULL, 0);
    }
#endif
#ifdef __Pyx_CyFunction_USED
    if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
#else
    if (likely(PyCFunction_Check(func)))
#endif
    {
        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
            return __Pyx_PyObject_CallMethO(func, NULL);
        }
    }
    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_LshiftObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
            if (likely(b < (long) (sizeof(long)*8) && a == (a << b) >> b) || !a) {
                return PyInt_FromLong(a << b);
            }
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_lshift(op1, op2);
            }
        }
                x = a << b;
#ifdef HAVE_LONG_LONG
                if (unlikely(!(b < (long) (sizeof(long)*8) && a == x >> b)) && a) {
                    lla = a;
                    goto long_long;
                }
#else
                if (likely(b < (long) (sizeof(long)*8) && a == x >> b) || !a)
#endif
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla << llb;
                if (likely(lla == llx >> llb))
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceLshift : PyNumber_Lshift)(op1, op2);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
            x = (long)((unsigned long)a + b);
            if (likely((x^a) >= 0 || (x^b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_add(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_add(op1, op2);
            }
        }
                x = a + b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla + llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            double result;
            PyFPE_START_PROTECT("add", return NULL)
            result = ((double)a) + (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceAdd : PyNumber_Add)(op1, op2);
}
#endif

/* PyObjectSetAttrStr */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_setattro))
        return tp->tp_setattro(obj, attr_name, value);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_setattr))
        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
#endif
    return PyObject_SetAttr(obj, attr_name, value);
}
#endif

/* Import */
static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    #if PY_MAJOR_VERSION < 3
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
    if (!py_import)
        goto bad;
    #endif
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if (strchr(__Pyx_MODULE_NAME, '.')) {
                module = PyImport_ImportModuleLevelObject(
                    name, global_dict, empty_dict, list, 1);
                if (!module) {
                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0;
        }
        #endif
        if (!module) {
            #if PY_MAJOR_VERSION < 3
            PyObject *py_level = PyInt_FromLong(level);
            if (!py_level)
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, global_dict, empty_dict, list, py_level, (PyObject *)NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, global_dict, empty_dict, list, level);
            #endif
        }
    }
bad:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(py_import);
    #endif
    Py_XDECREF(empty_list);
    Py_XDECREF(empty_dict);
    return module;
}

/* GetTopmostException */
#if CYTHON_USE_EXC_INFO_STACK
static _PyErr_StackItem *
__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
{
    _PyErr_StackItem *exc_info = tstate->exc_info;
    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
           exc_info->previous_item != NULL)
    {
        exc_info = exc_info->previous_item;
    }
    return exc_info;
}
#endif

/* SaveResetException */
#if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    #if CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
    *type = exc_info->exc_type;
    *value = exc_info->exc_value;
    *tb = exc_info->exc_traceback;
    #else
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    #endif
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    #if CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = tstate->exc_info;
    tmp_type = exc_info->exc_type;
    tmp_value = exc_info->exc_value;
    tmp_tb = exc_info->exc_traceback;
    exc_info->exc_type = type;
    exc_info->exc_value = value;
    exc_info->exc_traceback = tb;
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    #endif
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}
#endif

/* PyErrExceptionMatches */
#if CYTHON_FAST_THREAD_STATE
static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
    Py_ssize_t i, n;
    n = PyTuple_GET_SIZE(tuple);
#if PY_MAJOR_VERSION >= 3
    for (i=0; i<n; i++) {
        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
    }
#endif
    for (i=0; i<n; i++) {
        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
    }
    return 0;
}
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
    PyObject *exc_type = tstate->curexc_type;
    if (exc_type == err) return 1;
    if (unlikely(!exc_type)) return 0;
    if (unlikely(PyTuple_Check(err)))
        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
}
#endif

/* GetException */
#if CYTHON_FAST_THREAD_STATE
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
#endif
{
    PyObject *local_type, *local_value, *local_tb;
#if CYTHON_FAST_THREAD_STATE
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_FAST_THREAD_STATE
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (local_tb) {
        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
            goto bad;
    }
    #endif
    Py_XINCREF(local_tb);
    Py_XINCREF(local_type);
    Py_XINCREF(local_value);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_FAST_THREAD_STATE
    #if CYTHON_USE_EXC_INFO_STACK
    {
        _PyErr_StackItem *exc_info = tstate->exc_info;
        tmp_type = exc_info->exc_type;
        tmp_value = exc_info->exc_value;
        tmp_tb = exc_info->exc_traceback;
        exc_info->exc_type = local_type;
        exc_info->exc_value = local_value;
        exc_info->exc_traceback = local_tb;
    }
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    #endif
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

/* BytesEquals */
static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
    if (s1 == s2) {
        return (equals == Py_EQ);
    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
        const char *ps1, *ps2;
        Py_ssize_t length = PyBytes_GET_SIZE(s1);
        if (length != PyBytes_GET_SIZE(s2))
            return (equals == Py_NE);
        ps1 = PyBytes_AS_STRING(s1);
        ps2 = PyBytes_AS_STRING(s2);
        if (ps1[0] != ps2[0]) {
            return (equals == Py_NE);
        } else if (length == 1) {
            return (equals == Py_EQ);
        } else {
            int result;
#if CYTHON_USE_UNICODE_INTERNALS
            Py_hash_t hash1, hash2;
            hash1 = ((PyBytesObject*)s1)->ob_shash;
            hash2 = ((PyBytesObject*)s2)->ob_shash;
            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
                return (equals == Py_NE);
            }
#endif
            result = memcmp(ps1, ps2, (size_t)length);
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
        return (equals == Py_NE);
    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
        return (equals == Py_NE);
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
#endif
}

/* UnicodeEquals */
static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
#if PY_MAJOR_VERSION < 3
    PyObject* owned_ref = NULL;
#endif
    int s1_is_unicode, s2_is_unicode;
    if (s1 == s2) {
        goto return_eq;
    }
    s1_is_unicode = PyUnicode_CheckExact(s1);
    s2_is_unicode = PyUnicode_CheckExact(s2);
#if PY_MAJOR_VERSION < 3
    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
        owned_ref = PyUnicode_FromObject(s2);
        if (unlikely(!owned_ref))
            return -1;
        s2 = owned_ref;
        s2_is_unicode = 1;
    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
        owned_ref = PyUnicode_FromObject(s1);
        if (unlikely(!owned_ref))
            return -1;
        s1 = owned_ref;
        s1_is_unicode = 1;
    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
        return __Pyx_PyBytes_Equals(s1, s2, equals);
    }
#endif
    if (s1_is_unicode & s2_is_unicode) {
        Py_ssize_t length;
        int kind;
        void *data1, *data2;
        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
            return -1;
        length = __Pyx_PyUnicode_GET_LENGTH(s1);
        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
            goto return_ne;
        }
#if CYTHON_USE_UNICODE_INTERNALS
        {
            Py_hash_t hash1, hash2;
        #if CYTHON_PEP393_ENABLED
            hash1 = ((PyASCIIObject*)s1)->hash;
            hash2 = ((PyASCIIObject*)s2)->hash;
        #else
            hash1 = ((PyUnicodeObject*)s1)->hash;
            hash2 = ((PyUnicodeObject*)s2)->hash;
        #endif
            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
                goto return_ne;
            }
        }
#endif
        kind = __Pyx_PyUnicode_KIND(s1);
        if (kind != __Pyx_PyUnicode_KIND(s2)) {
            goto return_ne;
        }
        data1 = __Pyx_PyUnicode_DATA(s1);
        data2 = __Pyx_PyUnicode_DATA(s2);
        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
            goto return_ne;
        } else if (length == 1) {
            goto return_eq;
        } else {
            int result = memcmp(data1, data2, (size_t)(length * kind));
            #if PY_MAJOR_VERSION < 3
            Py_XDECREF(owned_ref);
            #endif
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & s2_is_unicode) {
        goto return_ne;
    } else if ((s2 == Py_None) & s1_is_unicode) {
        goto return_ne;
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        #if PY_MAJOR_VERSION < 3
        Py_XDECREF(owned_ref);
        #endif
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
return_eq:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_EQ);
return_ne:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_NE);
#endif
}

/* SliceObject */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
        Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
        int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
#if CYTHON_USE_TYPE_SLOTS
    PyMappingMethods* mp;
#if PY_MAJOR_VERSION < 3
    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
    if (likely(ms && ms->sq_slice)) {
        if (!has_cstart) {
            if (_py_start && (*_py_start != Py_None)) {
                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstart = 0;
        }
        if (!has_cstop) {
            if (_py_stop && (*_py_stop != Py_None)) {
                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstop = PY_SSIZE_T_MAX;
        }
        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
            Py_ssize_t l = ms->sq_length(obj);
            if (likely(l >= 0)) {
                if (cstop < 0) {
                    cstop += l;
                    if (cstop < 0) cstop = 0;
                }
                if (cstart < 0) {
                    cstart += l;
                    if (cstart < 0) cstart = 0;
                }
            } else {
                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                    goto bad;
                PyErr_Clear();
            }
        }
        return ms->sq_slice(obj, cstart, cstop);
    }
#endif
    mp = Py_TYPE(obj)->tp_as_mapping;
    if (likely(mp && mp->mp_subscript))
#endif
    {
        PyObject* result;
        PyObject *py_slice, *py_start, *py_stop;
        if (_py_slice) {
            py_slice = *_py_slice;
        } else {
            PyObject* owned_start = NULL;
            PyObject* owned_stop = NULL;
            if (_py_start) {
                py_start = *_py_start;
            } else {
                if (has_cstart) {
                    owned_start = py_start = PyInt_FromSsize_t(cstart);
                    if (unlikely(!py_start)) goto bad;
                } else
                    py_start = Py_None;
            }
            if (_py_stop) {
                py_stop = *_py_stop;
            } else {
                if (has_cstop) {
                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
                    if (unlikely(!py_stop)) {
                        Py_XDECREF(owned_start);
                        goto bad;
                    }
                } else
                    py_stop = Py_None;
            }
            py_slice = PySlice_New(py_start, py_stop, Py_None);
            Py_XDECREF(owned_start);
            Py_XDECREF(owned_stop);
            if (unlikely(!py_slice)) goto bad;
        }
#if CYTHON_USE_TYPE_SLOTS
        result = mp->mp_subscript(obj, py_slice);
#else
        result = PyObject_GetItem(obj, py_slice);
#endif
        if (!_py_slice) {
            Py_DECREF(py_slice);
        }
        return result;
    }
    PyErr_Format(PyExc_TypeError,
        "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
bad:
    return NULL;
}

/* PyErrFetchRestore */
#if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
}
#endif

/* RaiseException */
#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                        CYTHON_UNUSED PyObject *cause) {
    __Pyx_PyThreadState_declare
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    if (PyType_Check(type)) {
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
    }
    __Pyx_PyThreadState_assign
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *instance_class = NULL;
        if (value && PyExceptionInstance_Check(value)) {
            instance_class = (PyObject*) Py_TYPE(value);
            if (instance_class != type) {
                int is_subclass = PyObject_IsSubclass(instance_class, type);
                if (!is_subclass) {
                    instance_class = NULL;
                } else if (unlikely(is_subclass == -1)) {
                    goto bad;
                } else {
                    type = instance_class;
                }
            }
        }
        if (!instance_class) {
            PyObject *args;
            if (!value)
                args = PyTuple_New(0);
            else if (PyTuple_Check(value)) {
                Py_INCREF(value);
                args = value;
            } else
                args = PyTuple_Pack(1, value);
            if (!args)
                goto bad;
            owned_instance = PyObject_Call(type, args, NULL);
            Py_DECREF(args);
            if (!owned_instance)
                goto bad;
            value = owned_instance;
            if (!PyExceptionInstance_Check(value)) {
                PyErr_Format(PyExc_TypeError,
                             "calling %R should have returned an instance of "
                             "BaseException, not %R",
                             type, Py_TYPE(value));
                goto bad;
            }
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
    if (cause) {
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
#if CYTHON_COMPILING_IN_PYPY
        PyObject *tmp_type, *tmp_value, *tmp_tb;
        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
        Py_INCREF(tb);
        PyErr_Restore(tmp_type, tmp_value, tb);
        Py_XDECREF(tmp_tb);
#else
        PyThreadState *tstate = __Pyx_PyThreadState_Current;
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
#endif
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

/* GetAttr */
static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
#if CYTHON_USE_TYPE_SLOTS
#if PY_MAJOR_VERSION >= 3
    if (likely(PyUnicode_Check(n)))
#else
    if (likely(PyString_Check(n)))
#endif
        return __Pyx_PyObject_GetAttrStr(o, n);
#endif
    return PyObject_GetAttr(o, n);
}

/* GetAttr3 */
static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
        return NULL;
    __Pyx_PyErr_Clear();
    Py_INCREF(d);
    return d;
}
static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *o, PyObject *n, PyObject *d) {
    PyObject *r = __Pyx_GetAttr(o, n);
    return (likely(r)) ? r : __Pyx_GetAttr3Default(d);
}

/* ArgTypeTest */
static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
{
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    else if (exact) {
        #if PY_MAJOR_VERSION == 2
        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
        #endif
    }
    else {
        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

/* RaiseTooManyValuesToUnpack */
static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
    PyErr_Format(PyExc_ValueError,
                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
}

/* RaiseNeedMoreValuesToUnpack */
static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                 index, (index == 1) ? "" : "s");
}

/* RaiseNoneIterError */
static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
}

/* PyIntCompare */
static CYTHON_INLINE PyObject* __Pyx_PyInt_NeObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED long inplace) {
    if (op1 == op2) {
        Py_RETURN_FALSE;
    }
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        if (a != b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        int unequal;
        unsigned long uintval;
        Py_ssize_t size = Py_SIZE(op1);
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        if (intval == 0) {
            if (size != 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
        } else if (intval < 0) {
            if (size >= 0)
                Py_RETURN_TRUE;
            intval = -intval;
            size = -size;
        } else {
            if (size <= 0)
                Py_RETURN_TRUE;
        }
        uintval = (unsigned long) intval;
#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 4)) {
            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 3)) {
            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 2)) {
            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 1)) {
            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
        if (unequal != 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
        if ((double)a != (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    return (
        PyObject_RichCompare(op1, op2, Py_NE));
}

/* IterFinish */
static CYTHON_INLINE int __Pyx_IterFinish(void) {
#if CYTHON_FAST_THREAD_STATE
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    PyObject* exc_type = tstate->curexc_type;
    if (unlikely(exc_type)) {
        if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
            PyObject *exc_value, *exc_tb;
            exc_value = tstate->curexc_value;
            exc_tb = tstate->curexc_traceback;
            tstate->curexc_type = 0;
            tstate->curexc_value = 0;
            tstate->curexc_traceback = 0;
            Py_DECREF(exc_type);
            Py_XDECREF(exc_value);
            Py_XDECREF(exc_tb);
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#else
    if (unlikely(PyErr_Occurred())) {
        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
            PyErr_Clear();
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#endif
}

/* PyObjectGetMethod */
static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
    PyObject *attr;
#if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
    PyTypeObject *tp = Py_TYPE(obj);
    PyObject *descr;
    descrgetfunc f = NULL;
    PyObject **dictptr, *dict;
    int meth_found = 0;
    assert (*method == NULL);
    if (unlikely(tp->tp_getattro != PyObject_GenericGetAttr)) {
        attr = __Pyx_PyObject_GetAttrStr(obj, name);
        goto try_unpack;
    }
    if (unlikely(tp->tp_dict == NULL) && unlikely(PyType_Ready(tp) < 0)) {
        return 0;
    }
    descr = _PyType_Lookup(tp, name);
    if (likely(descr != NULL)) {
        Py_INCREF(descr);
#if PY_MAJOR_VERSION >= 3
        #ifdef __Pyx_CyFunction_USED
        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type) || __Pyx_CyFunction_Check(descr)))
        #else
        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type)))
        #endif
#else
        #ifdef __Pyx_CyFunction_USED
        if (likely(PyFunction_Check(descr) || __Pyx_CyFunction_Check(descr)))
        #else
        if (likely(PyFunction_Check(descr)))
        #endif
#endif
        {
            meth_found = 1;
        } else {
            f = Py_TYPE(descr)->tp_descr_get;
            if (f != NULL && PyDescr_IsData(descr)) {
                attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
                Py_DECREF(descr);
                goto try_unpack;
            }
        }
    }
    dictptr = _PyObject_GetDictPtr(obj);
    if (dictptr != NULL && (dict = *dictptr) != NULL) {
        Py_INCREF(dict);
        attr = __Pyx_PyDict_GetItemStr(dict, name);
        if (attr != NULL) {
            Py_INCREF(attr);
            Py_DECREF(dict);
            Py_XDECREF(descr);
            goto try_unpack;
        }
        Py_DECREF(dict);
    }
    if (meth_found) {
        *method = descr;
        return 1;
    }
    if (f != NULL) {
        attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
        Py_DECREF(descr);
        goto try_unpack;
    }
    if (descr != NULL) {
        *method = descr;
        return 0;
    }
    PyErr_Format(PyExc_AttributeError,
#if PY_MAJOR_VERSION >= 3
                 "'%.50s' object has no attribute '%U'",
                 tp->tp_name, name);
#else
                 "'%.50s' object has no attribute '%.400s'",
                 tp->tp_name, PyString_AS_STRING(name));
#endif
    return 0;
#else
    attr = __Pyx_PyObject_GetAttrStr(obj, name);
    goto try_unpack;
#endif
try_unpack:
#if CYTHON_UNPACK_METHODS
    if (likely(attr) && PyMethod_Check(attr) && likely(PyMethod_GET_SELF(attr) == obj)) {
        PyObject *function = PyMethod_GET_FUNCTION(attr);
        Py_INCREF(function);
        Py_DECREF(attr);
        *method = function;
        return 1;
    }
#endif
    *method = attr;
    return 0;
}

/* PyObjectCallMethod0 */
static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
    PyObject *method = NULL, *result = NULL;
    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
    if (likely(is_method)) {
        result = __Pyx_PyObject_CallOneArg(method, obj);
        Py_DECREF(method);
        return result;
    }
    if (unlikely(!method)) goto bad;
    result = __Pyx_PyObject_CallNoArg(method);
    Py_DECREF(method);
bad:
    return result;
}

/* UnpackItemEndCheck */
static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
    if (unlikely(retval)) {
        Py_DECREF(retval);
        __Pyx_RaiseTooManyValuesError(expected);
        return -1;
    } else {
        return __Pyx_IterFinish();
    }
    return 0;
}

/* UnpackTupleError */
static void __Pyx_UnpackTupleError(PyObject *t, Py_ssize_t index) {
    if (t == Py_None) {
      __Pyx_RaiseNoneNotIterableError();
    } else if (PyTuple_GET_SIZE(t) < index) {
      __Pyx_RaiseNeedMoreValuesError(PyTuple_GET_SIZE(t));
    } else {
      __Pyx_RaiseTooManyValuesError(index);
    }
}

/* UnpackTuple2 */
static CYTHON_INLINE int __Pyx_unpack_tuple2_exact(
        PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2, int decref_tuple) {
    PyObject *value1 = NULL, *value2 = NULL;
#if CYTHON_COMPILING_IN_PYPY
    value1 = PySequence_ITEM(tuple, 0);  if (unlikely(!value1)) goto bad;
    value2 = PySequence_ITEM(tuple, 1);  if (unlikely(!value2)) goto bad;
#else
    value1 = PyTuple_GET_ITEM(tuple, 0);  Py_INCREF(value1);
    value2 = PyTuple_GET_ITEM(tuple, 1);  Py_INCREF(value2);
#endif
    if (decref_tuple) {
        Py_DECREF(tuple);
    }
    *pvalue1 = value1;
    *pvalue2 = value2;
    return 0;
#if CYTHON_COMPILING_IN_PYPY
bad:
    Py_XDECREF(value1);
    Py_XDECREF(value2);
    if (decref_tuple) { Py_XDECREF(tuple); }
    return -1;
#endif
}
static int __Pyx_unpack_tuple2_generic(PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2,
                                       int has_known_size, int decref_tuple) {
    Py_ssize_t index;
    PyObject *value1 = NULL, *value2 = NULL, *iter = NULL;
    iternextfunc iternext;
    iter = PyObject_GetIter(tuple);
    if (unlikely(!iter)) goto bad;
    if (decref_tuple) { Py_DECREF(tuple); tuple = NULL; }
    iternext = Py_TYPE(iter)->tp_iternext;
    value1 = iternext(iter); if (unlikely(!value1)) { index = 0; goto unpacking_failed; }
    value2 = iternext(iter); if (unlikely(!value2)) { index = 1; goto unpacking_failed; }
    if (!has_known_size && unlikely(__Pyx_IternextUnpackEndCheck(iternext(iter), 2))) goto bad;
    Py_DECREF(iter);
    *pvalue1 = value1;
    *pvalue2 = value2;
    return 0;
unpacking_failed:
    if (!has_known_size && __Pyx_IterFinish() == 0)
        __Pyx_RaiseNeedMoreValuesError(index);
bad:
    Py_XDECREF(iter);
    Py_XDECREF(value1);
    Py_XDECREF(value2);
    if (decref_tuple) { Py_XDECREF(tuple); }
    return -1;
}

/* dict_iter */
static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* iterable, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_source_is_dict) {
    is_dict = is_dict || likely(PyDict_CheckExact(iterable));
    *p_source_is_dict = is_dict;
    if (is_dict) {
#if !CYTHON_COMPILING_IN_PYPY
        *p_orig_length = PyDict_Size(iterable);
        Py_INCREF(iterable);
        return iterable;
#elif PY_MAJOR_VERSION >= 3
        static PyObject *py_items = NULL, *py_keys = NULL, *py_values = NULL;
        PyObject **pp = NULL;
        if (method_name) {
            const char *name = PyUnicode_AsUTF8(method_name);
            if (strcmp(name, "iteritems") == 0) pp = &py_items;
            else if (strcmp(name, "iterkeys") == 0) pp = &py_keys;
            else if (strcmp(name, "itervalues") == 0) pp = &py_values;
            if (pp) {
                if (!*pp) {
                    *pp = PyUnicode_FromString(name + 4);
                    if (!*pp)
                        return NULL;
                }
                method_name = *pp;
            }
        }
#endif
    }
    *p_orig_length = 0;
    if (method_name) {
        PyObject* iter;
        iterable = __Pyx_PyObject_CallMethod0(iterable, method_name);
        if (!iterable)
            return NULL;
#if !CYTHON_COMPILING_IN_PYPY
        if (PyTuple_CheckExact(iterable) || PyList_CheckExact(iterable))
            return iterable;
#endif
        iter = PyObject_GetIter(iterable);
        Py_DECREF(iterable);
        return iter;
    }
    return PyObject_GetIter(iterable);
}
static CYTHON_INLINE int __Pyx_dict_iter_next(
        PyObject* iter_obj, CYTHON_NCP_UNUSED Py_ssize_t orig_length, CYTHON_NCP_UNUSED Py_ssize_t* ppos,
        PyObject** pkey, PyObject** pvalue, PyObject** pitem, int source_is_dict) {
    PyObject* next_item;
#if !CYTHON_COMPILING_IN_PYPY
    if (source_is_dict) {
        PyObject *key, *value;
        if (unlikely(orig_length != PyDict_Size(iter_obj))) {
            PyErr_SetString(PyExc_RuntimeError, "dictionary changed size during iteration");
            return -1;
        }
        if (unlikely(!PyDict_Next(iter_obj, ppos, &key, &value))) {
            return 0;
        }
        if (pitem) {
            PyObject* tuple = PyTuple_New(2);
            if (unlikely(!tuple)) {
                return -1;
            }
            Py_INCREF(key);
            Py_INCREF(value);
            PyTuple_SET_ITEM(tuple, 0, key);
            PyTuple_SET_ITEM(tuple, 1, value);
            *pitem = tuple;
        } else {
            if (pkey) {
                Py_INCREF(key);
                *pkey = key;
            }
            if (pvalue) {
                Py_INCREF(value);
                *pvalue = value;
            }
        }
        return 1;
    } else if (PyTuple_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyTuple_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyTuple_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else if (PyList_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyList_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyList_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else
#endif
    {
        next_item = PyIter_Next(iter_obj);
        if (unlikely(!next_item)) {
            return __Pyx_IterFinish();
        }
    }
    if (pitem) {
        *pitem = next_item;
    } else if (pkey && pvalue) {
        if (__Pyx_unpack_tuple2(next_item, pkey, pvalue, source_is_dict, source_is_dict, 1))
            return -1;
    } else if (pkey) {
        *pkey = next_item;
    } else {
        *pvalue = next_item;
    }
    return 1;
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
#if PY_MAJOR_VERSION < 3 || CYTHON_USE_PYLONG_INTERNALS
#define __Pyx_PyInt_FloorDivideObjC_ZeroDivisionError(operand)\
    if (unlikely(zerodivision_check && ((operand) == 0))) {\
        PyErr_SetString(PyExc_ZeroDivisionError, "integer division by zero");\
        return NULL;\
    }
#endif
static PyObject* __Pyx_PyInt_FloorDivideObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
            __Pyx_PyInt_FloorDivideObjC_ZeroDivisionError(b)
            if (unlikely(b == -1 && ((unsigned long)a) == 0-(unsigned long)a))
                return PyInt_Type.tp_as_number->nb_floor_divide(op1, op2);
            else {
                long q, r;
                q = a / b;
                r = a - q*b;
                q -= ((r != 0) & ((r ^ b) < 0));
                x = q;
            }
            return PyInt_FromLong(x);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_floor_divide(op1, op2);
            }
        }
                __Pyx_PyInt_FloorDivideObjC_ZeroDivisionError(b)
                {
                    long q, r;
                    q = a / b;
                    r = a - q*b;
                    q -= ((r != 0) & ((r ^ b) < 0));
                    x = q;
                }
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                {
                    PY_LONG_LONG q, r;
                    q = lla / llb;
                    r = lla - q*llb;
                    q -= ((r != 0) & ((r ^ llb) < 0));
                    llx = q;
                }
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceFloorDivide : PyNumber_FloorDivide)(op1, op2);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractCObj(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op2))) {
        const long a = intval;
        long x;
        long b = PyInt_AS_LONG(op2);
            x = (long)((unsigned long)a - b);
            if (likely((x^a) >= 0 || (x^~b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op2))) {
        const long a = intval;
        long b, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG lla = intval;
        PY_LONG_LONG llb, llx;
#endif
        const digit* digits = ((PyLongObject*)op2)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op2);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            b = likely(size) ? digits[0] : 0;
            if (size == -1) b = -b;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        b = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        b = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        b = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        b = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        b = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        b = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
            }
        }
                x = a - b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla - llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op2)) {
        const long a = intval;
        double b = PyFloat_AS_DOUBLE(op2);
            double result;
            PyFPE_START_PROTECT("subtract", return NULL)
            result = ((double)a) - (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceSubtract : PyNumber_Subtract)(op1, op2);
}
#endif

/* PyIntCompare */
static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED long inplace) {
    if (op1 == op2) {
        Py_RETURN_TRUE;
    }
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        if (a == b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        int unequal;
        unsigned long uintval;
        Py_ssize_t size = Py_SIZE(op1);
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        if (intval == 0) {
            if (size == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
        } else if (intval < 0) {
            if (size >= 0)
                Py_RETURN_FALSE;
            intval = -intval;
            size = -size;
        } else {
            if (size <= 0)
                Py_RETURN_FALSE;
        }
        uintval = (unsigned long) intval;
#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 4)) {
            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 3)) {
            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 2)) {
            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 1)) {
            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
        if (unequal == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
        if ((double)a == (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    return (
        PyObject_RichCompare(op1, op2, Py_EQ));
}

/* None */
static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname) {
    PyErr_Format(PyExc_UnboundLocalError, "local variable '%s' referenced before assignment", varname);
}

/* SetItemInt */
static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int is_list,
                                               CYTHON_NCP_UNUSED int wraparound, CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = (!wraparound) ? i : ((likely(i >= 0)) ? i : i + PyList_GET_SIZE(o));
        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o)))) {
            PyObject* old = PyList_GET_ITEM(o, n);
            Py_INCREF(v);
            PyList_SET_ITEM(o, n, v);
            Py_DECREF(old);
            return 1;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_ass_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return -1;
                    PyErr_Clear();
                }
            }
            return m->sq_ass_item(o, i, v);
        }
    }
#else
#if CYTHON_COMPILING_IN_PYPY
    if (is_list || (PySequence_Check(o) && !PyDict_Check(o)))
#else
    if (is_list || PySequence_Check(o))
#endif
    {
        return PySequence_SetItem(o, i, v);
    }
#endif
    return __Pyx_SetItemInt_Generic(o, PyInt_FromSsize_t(i), v);
}

/* SliceObject */
static CYTHON_INLINE int __Pyx_PyObject_SetSlice(PyObject* obj, PyObject* value,
        Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
        int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
#if CYTHON_USE_TYPE_SLOTS
    PyMappingMethods* mp;
#if PY_MAJOR_VERSION < 3
    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
    if (likely(ms && ms->sq_ass_slice)) {
        if (!has_cstart) {
            if (_py_start && (*_py_start != Py_None)) {
                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstart = 0;
        }
        if (!has_cstop) {
            if (_py_stop && (*_py_stop != Py_None)) {
                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstop = PY_SSIZE_T_MAX;
        }
        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
            Py_ssize_t l = ms->sq_length(obj);
            if (likely(l >= 0)) {
                if (cstop < 0) {
                    cstop += l;
                    if (cstop < 0) cstop = 0;
                }
                if (cstart < 0) {
                    cstart += l;
                    if (cstart < 0) cstart = 0;
                }
            } else {
                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                    goto bad;
                PyErr_Clear();
            }
        }
        return ms->sq_ass_slice(obj, cstart, cstop, value);
    }
#endif
    mp = Py_TYPE(obj)->tp_as_mapping;
    if (likely(mp && mp->mp_ass_subscript))
#endif
    {
        int result;
        PyObject *py_slice, *py_start, *py_stop;
        if (_py_slice) {
            py_slice = *_py_slice;
        } else {
            PyObject* owned_start = NULL;
            PyObject* owned_stop = NULL;
            if (_py_start) {
                py_start = *_py_start;
            } else {
                if (has_cstart) {
                    owned_start = py_start = PyInt_FromSsize_t(cstart);
                    if (unlikely(!py_start)) goto bad;
                } else
                    py_start = Py_None;
            }
            if (_py_stop) {
                py_stop = *_py_stop;
            } else {
                if (has_cstop) {
                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
                    if (unlikely(!py_stop)) {
                        Py_XDECREF(owned_start);
                        goto bad;
                    }
                } else
                    py_stop = Py_None;
            }
            py_slice = PySlice_New(py_start, py_stop, Py_None);
            Py_XDECREF(owned_start);
            Py_XDECREF(owned_stop);
            if (unlikely(!py_slice)) goto bad;
        }
#if CYTHON_USE_TYPE_SLOTS
        result = mp->mp_ass_subscript(obj, py_slice, value);
#else
        result = value ? PyObject_SetItem(obj, py_slice, value) : PyObject_DelItem(obj, py_slice);
#endif
        if (!_py_slice) {
            Py_DECREF(py_slice);
        }
        return result;
    }
    PyErr_Format(PyExc_TypeError,
        "'%.200s' object does not support slice %.10s",
        Py_TYPE(obj)->tp_name, value ? "assignment" : "deletion");
bad:
    return -1;
}

/* FetchCommonType */
static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
    PyObject* fake_module;
    PyTypeObject* cached_type = NULL;
    fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
    if (!fake_module) return NULL;
    Py_INCREF(fake_module);
    cached_type = (PyTypeObject*) PyObject_GetAttrString(fake_module, type->tp_name);
    if (cached_type) {
        if (!PyType_Check((PyObject*)cached_type)) {
            PyErr_Format(PyExc_TypeError,
                "Shared Cython type %.200s is not a type object",
                type->tp_name);
            goto bad;
        }
        if (cached_type->tp_basicsize != type->tp_basicsize) {
            PyErr_Format(PyExc_TypeError,
                "Shared Cython type %.200s has the wrong size, try recompiling",
                type->tp_name);
            goto bad;
        }
    } else {
        if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
        PyErr_Clear();
        if (PyType_Ready(type) < 0) goto bad;
        if (PyObject_SetAttrString(fake_module, type->tp_name, (PyObject*) type) < 0)
            goto bad;
        Py_INCREF(type);
        cached_type = type;
    }
done:
    Py_DECREF(fake_module);
    return cached_type;
bad:
    Py_XDECREF(cached_type);
    cached_type = NULL;
    goto done;
}

/* SwapException */
#if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    #if CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = tstate->exc_info;
    tmp_type = exc_info->exc_type;
    tmp_value = exc_info->exc_value;
    tmp_tb = exc_info->exc_traceback;
    exc_info->exc_type = *type;
    exc_info->exc_value = *value;
    exc_info->exc_traceback = *tb;
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
    #endif
    *type = tmp_type;
    *value = tmp_value;
    *tb = tmp_tb;
}
#else
static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
    PyErr_SetExcInfo(*type, *value, *tb);
    *type = tmp_type;
    *value = tmp_value;
    *tb = tmp_tb;
}
#endif

/* PyObjectCallMethod1 */
static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
    PyObject *result = __Pyx_PyObject_CallOneArg(method, arg);
    Py_DECREF(method);
    return result;
}
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
    PyObject *method = NULL, *result;
    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
    if (likely(is_method)) {
        result = __Pyx_PyObject_Call2Args(method, obj, arg);
        Py_DECREF(method);
        return result;
    }
    if (unlikely(!method)) return NULL;
    return __Pyx__PyObject_CallMethod1(method, arg);
}

/* CoroutineBase */
#include <structmember.h>
#include <frameobject.h>
#define __Pyx_Coroutine_Undelegate(gen) Py_CLEAR((gen)->yieldfrom)
static int __Pyx_PyGen__FetchStopIterationValue(CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject **pvalue) {
    PyObject *et, *ev, *tb;
    PyObject *value = NULL;
    __Pyx_ErrFetch(&et, &ev, &tb);
    if (!et) {
        Py_XDECREF(tb);
        Py_XDECREF(ev);
        Py_INCREF(Py_None);
        *pvalue = Py_None;
        return 0;
    }
    if (likely(et == PyExc_StopIteration)) {
        if (!ev) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#if PY_VERSION_HEX >= 0x030300A0
        else if (Py_TYPE(ev) == (PyTypeObject*)PyExc_StopIteration) {
            value = ((PyStopIterationObject *)ev)->value;
            Py_INCREF(value);
            Py_DECREF(ev);
        }
#endif
        else if (unlikely(PyTuple_Check(ev))) {
            if (PyTuple_GET_SIZE(ev) >= 1) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                value = PyTuple_GET_ITEM(ev, 0);
                Py_INCREF(value);
#else
                value = PySequence_ITEM(ev, 0);
#endif
            } else {
                Py_INCREF(Py_None);
                value = Py_None;
            }
            Py_DECREF(ev);
        }
        else if (!__Pyx_TypeCheck(ev, (PyTypeObject*)PyExc_StopIteration)) {
            value = ev;
        }
        if (likely(value)) {
            Py_XDECREF(tb);
            Py_DECREF(et);
            *pvalue = value;
            return 0;
        }
    } else if (!__Pyx_PyErr_GivenExceptionMatches(et, PyExc_StopIteration)) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    PyErr_NormalizeException(&et, &ev, &tb);
    if (unlikely(!PyObject_TypeCheck(ev, (PyTypeObject*)PyExc_StopIteration))) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    Py_XDECREF(tb);
    Py_DECREF(et);
#if PY_VERSION_HEX >= 0x030300A0
    value = ((PyStopIterationObject *)ev)->value;
    Py_INCREF(value);
    Py_DECREF(ev);
#else
    {
        PyObject* args = __Pyx_PyObject_GetAttrStr(ev, __pyx_n_s_args);
        Py_DECREF(ev);
        if (likely(args)) {
            value = PySequence_GetItem(args, 0);
            Py_DECREF(args);
        }
        if (unlikely(!value)) {
            __Pyx_ErrRestore(NULL, NULL, NULL);
            Py_INCREF(Py_None);
            value = Py_None;
        }
    }
#endif
    *pvalue = value;
    return 0;
}
static CYTHON_INLINE
void __Pyx_Coroutine_ExceptionClear(__Pyx_ExcInfoStruct *exc_state) {
    PyObject *t, *v, *tb;
    t = exc_state->exc_type;
    v = exc_state->exc_value;
    tb = exc_state->exc_traceback;
    exc_state->exc_type = NULL;
    exc_state->exc_value = NULL;
    exc_state->exc_traceback = NULL;
    Py_XDECREF(t);
    Py_XDECREF(v);
    Py_XDECREF(tb);
}
#define __Pyx_Coroutine_AlreadyRunningError(gen)  (__Pyx__Coroutine_AlreadyRunningError(gen), (PyObject*)NULL)
static void __Pyx__Coroutine_AlreadyRunningError(CYTHON_UNUSED __pyx_CoroutineObject *gen) {
    const char *msg;
    if ((0)) {
    #ifdef __Pyx_Coroutine_USED
    } else if (__Pyx_Coroutine_Check((PyObject*)gen)) {
        msg = "coroutine already executing";
    #endif
    #ifdef __Pyx_AsyncGen_USED
    } else if (__Pyx_AsyncGen_CheckExact((PyObject*)gen)) {
        msg = "async generator already executing";
    #endif
    } else {
        msg = "generator already executing";
    }
    PyErr_SetString(PyExc_ValueError, msg);
}
#define __Pyx_Coroutine_NotStartedError(gen)  (__Pyx__Coroutine_NotStartedError(gen), (PyObject*)NULL)
static void __Pyx__Coroutine_NotStartedError(CYTHON_UNUSED PyObject *gen) {
    const char *msg;
    if ((0)) {
    #ifdef __Pyx_Coroutine_USED
    } else if (__Pyx_Coroutine_Check(gen)) {
        msg = "can't send non-None value to a just-started coroutine";
    #endif
    #ifdef __Pyx_AsyncGen_USED
    } else if (__Pyx_AsyncGen_CheckExact(gen)) {
        msg = "can't send non-None value to a just-started async generator";
    #endif
    } else {
        msg = "can't send non-None value to a just-started generator";
    }
    PyErr_SetString(PyExc_TypeError, msg);
}
#define __Pyx_Coroutine_AlreadyTerminatedError(gen, value, closing)  (__Pyx__Coroutine_AlreadyTerminatedError(gen, value, closing), (PyObject*)NULL)
static void __Pyx__Coroutine_AlreadyTerminatedError(CYTHON_UNUSED PyObject *gen, PyObject *value, CYTHON_UNUSED int closing) {
    #ifdef __Pyx_Coroutine_USED
    if (!closing && __Pyx_Coroutine_Check(gen)) {
        PyErr_SetString(PyExc_RuntimeError, "cannot reuse already awaited coroutine");
    } else
    #endif
    if (value) {
        #ifdef __Pyx_AsyncGen_USED
        if (__Pyx_AsyncGen_CheckExact(gen))
            PyErr_SetNone(__Pyx_PyExc_StopAsyncIteration);
        else
        #endif
        PyErr_SetNone(PyExc_StopIteration);
    }
}
static
PyObject *__Pyx_Coroutine_SendEx(__pyx_CoroutineObject *self, PyObject *value, int closing) {
    __Pyx_PyThreadState_declare
    PyThreadState *tstate;
    __Pyx_ExcInfoStruct *exc_state;
    PyObject *retval;
    assert(!self->is_running);
    if (unlikely(self->resume_label == 0)) {
        if (unlikely(value && value != Py_None)) {
            return __Pyx_Coroutine_NotStartedError((PyObject*)self);
        }
    }
    if (unlikely(self->resume_label == -1)) {
        return __Pyx_Coroutine_AlreadyTerminatedError((PyObject*)self, value, closing);
    }
#if CYTHON_FAST_THREAD_STATE
    __Pyx_PyThreadState_assign
    tstate = __pyx_tstate;
#else
    tstate = __Pyx_PyThreadState_Current;
#endif
    exc_state = &self->gi_exc_state;
    if (exc_state->exc_type) {
        #if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_PYSTON
        #else
        if (exc_state->exc_traceback) {
            PyTracebackObject *tb = (PyTracebackObject *) exc_state->exc_traceback;
            PyFrameObject *f = tb->tb_frame;
            Py_XINCREF(tstate->frame);
            assert(f->f_back == NULL);
            f->f_back = tstate->frame;
        }
        #endif
    }
#if CYTHON_USE_EXC_INFO_STACK
    exc_state->previous_item = tstate->exc_info;
    tstate->exc_info = exc_state;
#else
    if (exc_state->exc_type) {
        __Pyx_ExceptionSwap(&exc_state->exc_type, &exc_state->exc_value, &exc_state->exc_traceback);
    } else {
        __Pyx_Coroutine_ExceptionClear(exc_state);
        __Pyx_ExceptionSave(&exc_state->exc_type, &exc_state->exc_value, &exc_state->exc_traceback);
    }
#endif
    self->is_running = 1;
    retval = self->body((PyObject *) self, tstate, value);
    self->is_running = 0;
#if CYTHON_USE_EXC_INFO_STACK
    exc_state = &self->gi_exc_state;
    tstate->exc_info = exc_state->previous_item;
    exc_state->previous_item = NULL;
    __Pyx_Coroutine_ResetFrameBackpointer(exc_state);
#endif
    return retval;
}
static CYTHON_INLINE void __Pyx_Coroutine_ResetFrameBackpointer(__Pyx_ExcInfoStruct *exc_state) {
    PyObject *exc_tb = exc_state->exc_traceback;
    if (likely(exc_tb)) {
#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_PYSTON
#else
        PyTracebackObject *tb = (PyTracebackObject *) exc_tb;
        PyFrameObject *f = tb->tb_frame;
        Py_CLEAR(f->f_back);
#endif
    }
}
static CYTHON_INLINE
PyObject *__Pyx_Coroutine_MethodReturn(CYTHON_UNUSED PyObject* gen, PyObject *retval) {
    if (unlikely(!retval)) {
        __Pyx_PyThreadState_declare
        __Pyx_PyThreadState_assign
        if (!__Pyx_PyErr_Occurred()) {
            PyObject *exc = PyExc_StopIteration;
            #ifdef __Pyx_AsyncGen_USED
            if (__Pyx_AsyncGen_CheckExact(gen))
                exc = __Pyx_PyExc_StopAsyncIteration;
            #endif
            __Pyx_PyErr_SetNone(exc);
        }
    }
    return retval;
}
static CYTHON_INLINE
PyObject *__Pyx_Coroutine_FinishDelegation(__pyx_CoroutineObject *gen) {
    PyObject *ret;
    PyObject *val = NULL;
    __Pyx_Coroutine_Undelegate(gen);
    __Pyx_PyGen__FetchStopIterationValue(__Pyx_PyThreadState_Current, &val);
    ret = __Pyx_Coroutine_SendEx(gen, val, 0);
    Py_XDECREF(val);
    return ret;
}
static PyObject *__Pyx_Coroutine_Send(PyObject *self, PyObject *value) {
    PyObject *retval;
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        #ifdef __Pyx_Generator_USED
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Coroutine_Send(yf, value);
        } else
        #endif
        #ifdef __Pyx_Coroutine_USED
        if (__Pyx_Coroutine_Check(yf)) {
            ret = __Pyx_Coroutine_Send(yf, value);
        } else
        #endif
        #ifdef __Pyx_AsyncGen_USED
        if (__pyx_PyAsyncGenASend_CheckExact(yf)) {
            ret = __Pyx_async_gen_asend_send(yf, value);
        } else
        #endif
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03030000 && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
        if (PyGen_CheckExact(yf)) {
            ret = _PyGen_Send((PyGenObject*)yf, value == Py_None ? NULL : value);
        } else
        #endif
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03050000 && defined(PyCoro_CheckExact) && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
        if (PyCoro_CheckExact(yf)) {
            ret = _PyGen_Send((PyGenObject*)yf, value == Py_None ? NULL : value);
        } else
        #endif
        {
            if (value == Py_None)
                ret = Py_TYPE(yf)->tp_iternext(yf);
            else
                ret = __Pyx_PyObject_CallMethod1(yf, __pyx_n_s_send, value);
        }
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        retval = __Pyx_Coroutine_FinishDelegation(gen);
    } else {
        retval = __Pyx_Coroutine_SendEx(gen, value, 0);
    }
    return __Pyx_Coroutine_MethodReturn(self, retval);
}
static int __Pyx_Coroutine_CloseIter(__pyx_CoroutineObject *gen, PyObject *yf) {
    PyObject *retval = NULL;
    int err = 0;
    #ifdef __Pyx_Generator_USED
    if (__Pyx_Generator_CheckExact(yf)) {
        retval = __Pyx_Coroutine_Close(yf);
        if (!retval)
            return -1;
    } else
    #endif
    #ifdef __Pyx_Coroutine_USED
    if (__Pyx_Coroutine_Check(yf)) {
        retval = __Pyx_Coroutine_Close(yf);
        if (!retval)
            return -1;
    } else
    if (__Pyx_CoroutineAwait_CheckExact(yf)) {
        retval = __Pyx_CoroutineAwait_Close((__pyx_CoroutineAwaitObject*)yf, NULL);
        if (!retval)
            return -1;
    } else
    #endif
    #ifdef __Pyx_AsyncGen_USED
    if (__pyx_PyAsyncGenASend_CheckExact(yf)) {
        retval = __Pyx_async_gen_asend_close(yf, NULL);
    } else
    if (__pyx_PyAsyncGenAThrow_CheckExact(yf)) {
        retval = __Pyx_async_gen_athrow_close(yf, NULL);
    } else
    #endif
    {
        PyObject *meth;
        gen->is_running = 1;
        meth = __Pyx_PyObject_GetAttrStr(yf, __pyx_n_s_close);
        if (unlikely(!meth)) {
            if (!PyErr_ExceptionMatches(PyExc_AttributeError)) {
                PyErr_WriteUnraisable(yf);
            }
            PyErr_Clear();
        } else {
            retval = PyObject_CallFunction(meth, NULL);
            Py_DECREF(meth);
            if (!retval)
                err = -1;
        }
        gen->is_running = 0;
    }
    Py_XDECREF(retval);
    return err;
}
static PyObject *__Pyx_Generator_Next(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        #ifdef __Pyx_Generator_USED
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Generator_Next(yf);
        } else
        #endif
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03030000 && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
        if (PyGen_CheckExact(yf)) {
            ret = _PyGen_Send((PyGenObject*)yf, NULL);
        } else
        #endif
        #ifdef __Pyx_Coroutine_USED
        if (__Pyx_Coroutine_Check(yf)) {
            ret = __Pyx_Coroutine_Send(yf, Py_None);
        } else
        #endif
            ret = Py_TYPE(yf)->tp_iternext(yf);
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        return __Pyx_Coroutine_FinishDelegation(gen);
    }
    return __Pyx_Coroutine_SendEx(gen, Py_None, 0);
}
static PyObject *__Pyx_Coroutine_Close_Method(PyObject *self, CYTHON_UNUSED PyObject *arg) {
    return __Pyx_Coroutine_Close(self);
}
static PyObject *__Pyx_Coroutine_Close(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    PyObject *retval, *raised_exception;
    PyObject *yf = gen->yieldfrom;
    int err = 0;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        Py_INCREF(yf);
        err = __Pyx_Coroutine_CloseIter(gen, yf);
        __Pyx_Coroutine_Undelegate(gen);
        Py_DECREF(yf);
    }
    if (err == 0)
        PyErr_SetNone(PyExc_GeneratorExit);
    retval = __Pyx_Coroutine_SendEx(gen, NULL, 1);
    if (unlikely(retval)) {
        const char *msg;
        Py_DECREF(retval);
        if ((0)) {
        #ifdef __Pyx_Coroutine_USED
        } else if (__Pyx_Coroutine_Check(self)) {
            msg = "coroutine ignored GeneratorExit";
        #endif
        #ifdef __Pyx_AsyncGen_USED
        } else if (__Pyx_AsyncGen_CheckExact(self)) {
#if PY_VERSION_HEX < 0x03060000
            msg = "async generator ignored GeneratorExit - might require Python 3.6+ finalisation (PEP 525)";
#else
            msg = "async generator ignored GeneratorExit";
#endif
        #endif
        } else {
            msg = "generator ignored GeneratorExit";
        }
        PyErr_SetString(PyExc_RuntimeError, msg);
        return NULL;
    }
    raised_exception = PyErr_Occurred();
    if (likely(!raised_exception || __Pyx_PyErr_GivenExceptionMatches2(raised_exception, PyExc_GeneratorExit, PyExc_StopIteration))) {
        if (raised_exception) PyErr_Clear();
        Py_INCREF(Py_None);
        return Py_None;
    }
    return NULL;
}
static PyObject *__Pyx__Coroutine_Throw(PyObject *self, PyObject *typ, PyObject *val, PyObject *tb,
                                        PyObject *args, int close_on_genexit) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        PyObject *ret;
        Py_INCREF(yf);
        if (__Pyx_PyErr_GivenExceptionMatches(typ, PyExc_GeneratorExit) && close_on_genexit) {
            int err = __Pyx_Coroutine_CloseIter(gen, yf);
            Py_DECREF(yf);
            __Pyx_Coroutine_Undelegate(gen);
            if (err < 0)
                return __Pyx_Coroutine_MethodReturn(self, __Pyx_Coroutine_SendEx(gen, NULL, 0));
            goto throw_here;
        }
        gen->is_running = 1;
        if (0
        #ifdef __Pyx_Generator_USED
            || __Pyx_Generator_CheckExact(yf)
        #endif
        #ifdef __Pyx_Coroutine_USED
            || __Pyx_Coroutine_Check(yf)
        #endif
            ) {
            ret = __Pyx__Coroutine_Throw(yf, typ, val, tb, args, close_on_genexit);
        #ifdef __Pyx_Coroutine_USED
        } else if (__Pyx_CoroutineAwait_CheckExact(yf)) {
            ret = __Pyx__Coroutine_Throw(((__pyx_CoroutineAwaitObject*)yf)->coroutine, typ, val, tb, args, close_on_genexit);
        #endif
        } else {
            PyObject *meth = __Pyx_PyObject_GetAttrStr(yf, __pyx_n_s_throw);
            if (unlikely(!meth)) {
                Py_DECREF(yf);
                if (!PyErr_ExceptionMatches(PyExc_AttributeError)) {
                    gen->is_running = 0;
                    return NULL;
                }
                PyErr_Clear();
                __Pyx_Coroutine_Undelegate(gen);
                gen->is_running = 0;
                goto throw_here;
            }
            if (likely(args)) {
                ret = PyObject_CallObject(meth, args);
            } else {
                ret = PyObject_CallFunctionObjArgs(meth, typ, val, tb, NULL);
            }
            Py_DECREF(meth);
        }
        gen->is_running = 0;
        Py_DECREF(yf);
        if (!ret) {
            ret = __Pyx_Coroutine_FinishDelegation(gen);
        }
        return __Pyx_Coroutine_MethodReturn(self, ret);
    }
throw_here:
    __Pyx_Raise(typ, val, tb, NULL);
    return __Pyx_Coroutine_MethodReturn(self, __Pyx_Coroutine_SendEx(gen, NULL, 0));
}
static PyObject *__Pyx_Coroutine_Throw(PyObject *self, PyObject *args) {
    PyObject *typ;
    PyObject *val = NULL;
    PyObject *tb = NULL;
    if (!PyArg_UnpackTuple(args, (char *)"throw", 1, 3, &typ, &val, &tb))
        return NULL;
    return __Pyx__Coroutine_Throw(self, typ, val, tb, args, 1);
}
static CYTHON_INLINE int __Pyx_Coroutine_traverse_excstate(__Pyx_ExcInfoStruct *exc_state, visitproc visit, void *arg) {
    Py_VISIT(exc_state->exc_type);
    Py_VISIT(exc_state->exc_value);
    Py_VISIT(exc_state->exc_traceback);
    return 0;
}
static int __Pyx_Coroutine_traverse(__pyx_CoroutineObject *gen, visitproc visit, void *arg) {
    Py_VISIT(gen->closure);
    Py_VISIT(gen->classobj);
    Py_VISIT(gen->yieldfrom);
    return __Pyx_Coroutine_traverse_excstate(&gen->gi_exc_state, visit, arg);
}
static int __Pyx_Coroutine_clear(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    Py_CLEAR(gen->closure);
    Py_CLEAR(gen->classobj);
    Py_CLEAR(gen->yieldfrom);
    __Pyx_Coroutine_ExceptionClear(&gen->gi_exc_state);
#ifdef __Pyx_AsyncGen_USED
    if (__Pyx_AsyncGen_CheckExact(self)) {
        Py_CLEAR(((__pyx_PyAsyncGenObject*)gen)->ag_finalizer);
    }
#endif
    Py_CLEAR(gen->gi_code);
    Py_CLEAR(gen->gi_name);
    Py_CLEAR(gen->gi_qualname);
    Py_CLEAR(gen->gi_modulename);
    return 0;
}
static void __Pyx_Coroutine_dealloc(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    PyObject_GC_UnTrack(gen);
    if (gen->gi_weakreflist != NULL)
        PyObject_ClearWeakRefs(self);
    if (gen->resume_label >= 0) {
        PyObject_GC_Track(self);
#if PY_VERSION_HEX >= 0x030400a1 && CYTHON_USE_TP_FINALIZE
        if (PyObject_CallFinalizerFromDealloc(self))
#else
        Py_TYPE(gen)->tp_del(self);
        if (self->ob_refcnt > 0)
#endif
        {
            return;
        }
        PyObject_GC_UnTrack(self);
    }
#ifdef __Pyx_AsyncGen_USED
    if (__Pyx_AsyncGen_CheckExact(self)) {
        /* We have to handle this case for asynchronous generators
           right here, because this code has to be between UNTRACK
           and GC_Del. */
        Py_CLEAR(((__pyx_PyAsyncGenObject*)self)->ag_finalizer);
    }
#endif
    __Pyx_Coroutine_clear(self);
    PyObject_GC_Del(gen);
}
static void __Pyx_Coroutine_del(PyObject *self) {
    PyObject *error_type, *error_value, *error_traceback;
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    __Pyx_PyThreadState_declare
    if (gen->resume_label < 0) {
        return;
    }
#if !CYTHON_USE_TP_FINALIZE
    assert(self->ob_refcnt == 0);
    self->ob_refcnt = 1;
#endif
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&error_type, &error_value, &error_traceback);
#ifdef __Pyx_AsyncGen_USED
    if (__Pyx_AsyncGen_CheckExact(self)) {
        __pyx_PyAsyncGenObject *agen = (__pyx_PyAsyncGenObject*)self;
        PyObject *finalizer = agen->ag_finalizer;
        if (finalizer && !agen->ag_closed) {
            PyObject *res = __Pyx_PyObject_CallOneArg(finalizer, self);
            if (unlikely(!res)) {
                PyErr_WriteUnraisable(self);
            } else {
                Py_DECREF(res);
            }
            __Pyx_ErrRestore(error_type, error_value, error_traceback);
            return;
        }
    }
#endif
    if (unlikely(gen->resume_label == 0 && !error_value)) {
#ifdef __Pyx_Coroutine_USED
#ifdef __Pyx_Generator_USED
    if (!__Pyx_Generator_CheckExact(self))
#endif
        {
        PyObject_GC_UnTrack(self);
#if PY_MAJOR_VERSION >= 3  || defined(PyErr_WarnFormat)
        if (unlikely(PyErr_WarnFormat(PyExc_RuntimeWarning, 1, "coroutine '%.50S' was never awaited", gen->gi_qualname) < 0))
            PyErr_WriteUnraisable(self);
#else
        {PyObject *msg;
        char *cmsg;
        #if CYTHON_COMPILING_IN_PYPY
        msg = NULL;
        cmsg = (char*) "coroutine was never awaited";
        #else
        char *cname;
        PyObject *qualname;
        qualname = gen->gi_qualname;
        cname = PyString_AS_STRING(qualname);
        msg = PyString_FromFormat("coroutine '%.50s' was never awaited", cname);
        if (unlikely(!msg)) {
            PyErr_Clear();
            cmsg = (char*) "coroutine was never awaited";
        } else {
            cmsg = PyString_AS_STRING(msg);
        }
        #endif
        if (unlikely(PyErr_WarnEx(PyExc_RuntimeWarning, cmsg, 1) < 0))
            PyErr_WriteUnraisable(self);
        Py_XDECREF(msg);}
#endif
        PyObject_GC_Track(self);
        }
#endif
    } else {
        PyObject *res = __Pyx_Coroutine_Close(self);
        if (unlikely(!res)) {
            if (PyErr_Occurred())
                PyErr_WriteUnraisable(self);
        } else {
            Py_DECREF(res);
        }
    }
    __Pyx_ErrRestore(error_type, error_value, error_traceback);
#if !CYTHON_USE_TP_FINALIZE
    assert(self->ob_refcnt > 0);
    if (--self->ob_refcnt == 0) {
        return;
    }
    {
        Py_ssize_t refcnt = self->ob_refcnt;
        _Py_NewReference(self);
        self->ob_refcnt = refcnt;
    }
#if CYTHON_COMPILING_IN_CPYTHON
    assert(PyType_IS_GC(self->ob_type) &&
           _Py_AS_GC(self)->gc.gc_refs != _PyGC_REFS_UNTRACKED);
    _Py_DEC_REFTOTAL;
#endif
#ifdef COUNT_ALLOCS
    --Py_TYPE(self)->tp_frees;
    --Py_TYPE(self)->tp_allocs;
#endif
#endif
}
static PyObject *
__Pyx_Coroutine_get_name(__pyx_CoroutineObject *self, CYTHON_UNUSED void *context)
{
    PyObject *name = self->gi_name;
    if (unlikely(!name)) name = Py_None;
    Py_INCREF(name);
    return name;
}
static int
__Pyx_Coroutine_set_name(__pyx_CoroutineObject *self, PyObject *value, CYTHON_UNUSED void *context)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__name__ must be set to a string object");
        return -1;
    }
    tmp = self->gi_name;
    Py_INCREF(value);
    self->gi_name = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_Coroutine_get_qualname(__pyx_CoroutineObject *self, CYTHON_UNUSED void *context)
{
    PyObject *name = self->gi_qualname;
    if (unlikely(!name)) name = Py_None;
    Py_INCREF(name);
    return name;
}
static int
__Pyx_Coroutine_set_qualname(__pyx_CoroutineObject *self, PyObject *value, CYTHON_UNUSED void *context)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__qualname__ must be set to a string object");
        return -1;
    }
    tmp = self->gi_qualname;
    Py_INCREF(value);
    self->gi_qualname = value;
    Py_XDECREF(tmp);
    return 0;
}
static __pyx_CoroutineObject *__Pyx__Coroutine_New(
            PyTypeObject* type, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
            PyObject *name, PyObject *qualname, PyObject *module_name) {
    __pyx_CoroutineObject *gen = PyObject_GC_New(__pyx_CoroutineObject, type);
    if (unlikely(!gen))
        return NULL;
    return __Pyx__Coroutine_NewInit(gen, body, code, closure, name, qualname, module_name);
}
static __pyx_CoroutineObject *__Pyx__Coroutine_NewInit(
            __pyx_CoroutineObject *gen, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
            PyObject *name, PyObject *qualname, PyObject *module_name) {
    gen->body = body;
    gen->closure = closure;
    Py_XINCREF(closure);
    gen->is_running = 0;
    gen->resume_label = 0;
    gen->classobj = NULL;
    gen->yieldfrom = NULL;
    gen->gi_exc_state.exc_type = NULL;
    gen->gi_exc_state.exc_value = NULL;
    gen->gi_exc_state.exc_traceback = NULL;
#if CYTHON_USE_EXC_INFO_STACK
    gen->gi_exc_state.previous_item = NULL;
#endif
    gen->gi_weakreflist = NULL;
    Py_XINCREF(qualname);
    gen->gi_qualname = qualname;
    Py_XINCREF(name);
    gen->gi_name = name;
    Py_XINCREF(module_name);
    gen->gi_modulename = module_name;
    Py_XINCREF(code);
    gen->gi_code = code;
    PyObject_GC_Track(gen);
    return gen;
}

/* PyObject_GenericGetAttrNoDict */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject *__Pyx_RaiseGenericGetAttributeError(PyTypeObject *tp, PyObject *attr_name) {
    PyErr_Format(PyExc_AttributeError,
#if PY_MAJOR_VERSION >= 3
                 "'%.50s' object has no attribute '%U'",
                 tp->tp_name, attr_name);
#else
                 "'%.50s' object has no attribute '%.400s'",
                 tp->tp_name, PyString_AS_STRING(attr_name));
#endif
    return NULL;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name) {
    PyObject *descr;
    PyTypeObject *tp = Py_TYPE(obj);
    if (unlikely(!PyString_Check(attr_name))) {
        return PyObject_GenericGetAttr(obj, attr_name);
    }
    assert(!tp->tp_dictoffset);
    descr = _PyType_Lookup(tp, attr_name);
    if (unlikely(!descr)) {
        return __Pyx_RaiseGenericGetAttributeError(tp, attr_name);
    }
    Py_INCREF(descr);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyType_HasFeature(Py_TYPE(descr), Py_TPFLAGS_HAVE_CLASS)))
    #endif
    {
        descrgetfunc f = Py_TYPE(descr)->tp_descr_get;
        if (unlikely(f)) {
            PyObject *res = f(descr, obj, (PyObject *)tp);
            Py_DECREF(descr);
            return res;
        }
    }
    return descr;
}
#endif

/* PatchModuleWithCoroutine */
static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code) {
#if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
    int result;
    PyObject *globals, *result_obj;
    globals = PyDict_New();  if (unlikely(!globals)) goto ignore;
    result = PyDict_SetItemString(globals, "_cython_coroutine_type",
    #ifdef __Pyx_Coroutine_USED
        (PyObject*)__pyx_CoroutineType);
    #else
        Py_None);
    #endif
    if (unlikely(result < 0)) goto ignore;
    result = PyDict_SetItemString(globals, "_cython_generator_type",
    #ifdef __Pyx_Generator_USED
        (PyObject*)__pyx_GeneratorType);
    #else
        Py_None);
    #endif
    if (unlikely(result < 0)) goto ignore;
    if (unlikely(PyDict_SetItemString(globals, "_module", module) < 0)) goto ignore;
    if (unlikely(PyDict_SetItemString(globals, "__builtins__", __pyx_b) < 0)) goto ignore;
    result_obj = PyRun_String(py_code, Py_file_input, globals, globals);
    if (unlikely(!result_obj)) goto ignore;
    Py_DECREF(result_obj);
    Py_DECREF(globals);
    return module;
ignore:
    Py_XDECREF(globals);
    PyErr_WriteUnraisable(module);
    if (unlikely(PyErr_WarnEx(PyExc_RuntimeWarning, "Cython module failed to patch module with custom type", 1) < 0)) {
        Py_DECREF(module);
        module = NULL;
    }
#else
    py_code++;
#endif
    return module;
}

/* PatchGeneratorABC */
#ifndef CYTHON_REGISTER_ABCS
#define CYTHON_REGISTER_ABCS 1
#endif
#if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
static PyObject* __Pyx_patch_abc_module(PyObject *module);
static PyObject* __Pyx_patch_abc_module(PyObject *module) {
    module = __Pyx_Coroutine_patch_module(
        module, ""
"if _cython_generator_type is not None:\n"
"    try: Generator = _module.Generator\n"
"    except AttributeError: pass\n"
"    else: Generator.register(_cython_generator_type)\n"
"if _cython_coroutine_type is not None:\n"
"    try: Coroutine = _module.Coroutine\n"
"    except AttributeError: pass\n"
"    else: Coroutine.register(_cython_coroutine_type)\n"
    );
    return module;
}
#endif
static int __Pyx_patch_abc(void) {
#if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
    static int abc_patched = 0;
    if (CYTHON_REGISTER_ABCS && !abc_patched) {
        PyObject *module;
        module = PyImport_ImportModule((PY_MAJOR_VERSION >= 3) ? "collections.abc" : "collections");
        if (!module) {
            PyErr_WriteUnraisable(NULL);
            if (unlikely(PyErr_WarnEx(PyExc_RuntimeWarning,
                    ((PY_MAJOR_VERSION >= 3) ?
                        "Cython module failed to register with collections.abc module" :
                        "Cython module failed to register with collections module"), 1) < 0)) {
                return -1;
            }
        } else {
            module = __Pyx_patch_abc_module(module);
            abc_patched = 1;
            if (unlikely(!module))
                return -1;
            Py_DECREF(module);
        }
        module = PyImport_ImportModule("backports_abc");
        if (module) {
            module = __Pyx_patch_abc_module(module);
            Py_XDECREF(module);
        }
        if (!module) {
            PyErr_Clear();
        }
    }
#else
    if ((0)) __Pyx_Coroutine_patch_module(NULL, NULL);
#endif
    return 0;
}

/* Generator */
static PyMethodDef __pyx_Generator_methods[] = {
    {"send", (PyCFunction) __Pyx_Coroutine_Send, METH_O,
     (char*) PyDoc_STR("send(arg) -> send 'arg' into generator,\nreturn next yielded value or raise StopIteration.")},
    {"throw", (PyCFunction) __Pyx_Coroutine_Throw, METH_VARARGS,
     (char*) PyDoc_STR("throw(typ[,val[,tb]]) -> raise exception in generator,\nreturn next yielded value or raise StopIteration.")},
    {"close", (PyCFunction) __Pyx_Coroutine_Close_Method, METH_NOARGS,
     (char*) PyDoc_STR("close() -> raise GeneratorExit inside generator.")},
    {0, 0, 0, 0}
};
static PyMemberDef __pyx_Generator_memberlist[] = {
    {(char *) "gi_running", T_BOOL, offsetof(__pyx_CoroutineObject, is_running), READONLY, NULL},
    {(char*) "gi_yieldfrom", T_OBJECT, offsetof(__pyx_CoroutineObject, yieldfrom), READONLY,
     (char*) PyDoc_STR("object being iterated by 'yield from', or None")},
    {(char*) "gi_code", T_OBJECT, offsetof(__pyx_CoroutineObject, gi_code), READONLY, NULL},
    {0, 0, 0, 0, 0}
};
static PyGetSetDef __pyx_Generator_getsets[] = {
    {(char *) "__name__", (getter)__Pyx_Coroutine_get_name, (setter)__Pyx_Coroutine_set_name,
     (char*) PyDoc_STR("name of the generator"), 0},
    {(char *) "__qualname__", (getter)__Pyx_Coroutine_get_qualname, (setter)__Pyx_Coroutine_set_qualname,
     (char*) PyDoc_STR("qualified name of the generator"), 0},
    {0, 0, 0, 0, 0}
};
static PyTypeObject __pyx_GeneratorType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    "generator",
    sizeof(__pyx_CoroutineObject),
    0,
    (destructor) __Pyx_Coroutine_dealloc,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_HAVE_FINALIZE,
    0,
    (traverseproc) __Pyx_Coroutine_traverse,
    0,
    0,
    offsetof(__pyx_CoroutineObject, gi_weakreflist),
    0,
    (iternextfunc) __Pyx_Generator_Next,
    __pyx_Generator_methods,
    __pyx_Generator_memberlist,
    __pyx_Generator_getsets,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
#if CYTHON_USE_TP_FINALIZE
    0,
#else
    __Pyx_Coroutine_del,
#endif
    0,
#if CYTHON_USE_TP_FINALIZE
    __Pyx_Coroutine_del,
#elif PY_VERSION_HEX >= 0x030400a1
    0,
#endif
};
static int __pyx_Generator_init(void) {
    __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
    __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
    __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
    if (unlikely(!__pyx_GeneratorType)) {
        return -1;
    }
    return 0;
}

/* GeneratorYieldFrom */
static void __PyxPyIter_CheckErrorAndDecref(PyObject *source) {
    PyErr_Format(PyExc_TypeError,
                 "iter() returned non-iterator of type '%.100s'",
                 Py_TYPE(source)->tp_name);
    Py_DECREF(source);
}
static CYTHON_INLINE PyObject* __Pyx_Generator_Yield_From(__pyx_CoroutineObject *gen, PyObject *source) {
    PyObject *source_gen, *retval;
#ifdef __Pyx_Coroutine_USED
    if (__Pyx_Coroutine_Check(source)) {
        Py_INCREF(source);
        source_gen = source;
        retval = __Pyx_Generator_Next(source);
    } else
#endif
    {
#if CYTHON_USE_TYPE_SLOTS
        if (likely(Py_TYPE(source)->tp_iter)) {
            source_gen = Py_TYPE(source)->tp_iter(source);
            if (unlikely(!source_gen))
                return NULL;
            if (unlikely(!PyIter_Check(source_gen))) {
                __PyxPyIter_CheckErrorAndDecref(source_gen);
                return NULL;
            }
        } else
#endif
        {
            source_gen = PyObject_GetIter(source);
            if (unlikely(!source_gen))
                return NULL;
        }
#if CYTHON_USE_TYPE_SLOTS
        retval = Py_TYPE(source_gen)->tp_iternext(source_gen);
#else
        retval = PyIter_Next(source_gen);
#endif
    }
    if (likely(retval)) {
        gen->yieldfrom = source_gen;
        return retval;
    }
    Py_DECREF(source_gen);
    return NULL;
}

/* UnpackUnboundCMethod */
static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
    PyObject *method;
    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
    if (unlikely(!method))
        return -1;
    target->method = method;
#if CYTHON_COMPILING_IN_CPYTHON
    #if PY_MAJOR_VERSION >= 3
    if (likely(__Pyx_TypeCheck(method, &PyMethodDescr_Type)))
    #endif
    {
        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
        target->func = descr->d_method->ml_meth;
        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
    }
#endif
    return 0;
}

/* CallUnboundCMethod0 */
static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self) {
    PyObject *args, *result = NULL;
    if (unlikely(!cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
#if CYTHON_ASSUME_SAFE_MACROS
    args = PyTuple_New(1);
    if (unlikely(!args)) goto bad;
    Py_INCREF(self);
    PyTuple_SET_ITEM(args, 0, self);
#else
    args = PyTuple_Pack(1, self);
    if (unlikely(!args)) goto bad;
#endif
    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
    Py_DECREF(args);
bad:
    return result;
}

/* pop */
static CYTHON_INLINE PyObject* __Pyx__PyObject_Pop(PyObject* L) {
    if (Py_TYPE(L) == &PySet_Type) {
        return PySet_Pop(L);
    }
    return __Pyx_PyObject_CallMethod0(L, __pyx_n_s_pop);
}
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE PyObject* __Pyx_PyList_Pop(PyObject* L) {
    if (likely(PyList_GET_SIZE(L) > (((PyListObject*)L)->allocated >> 1))) {
        Py_SIZE(L) -= 1;
        return PyList_GET_ITEM(L, PyList_GET_SIZE(L));
    }
    return __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyList_Type_pop, L);
}
#endif

/* append */
static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (unlikely(__Pyx_PyList_Append(L, x) < 0)) return -1;
    } else {
        PyObject* retval = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_append, x);
        if (unlikely(!retval))
            return -1;
        Py_DECREF(retval);
    }
    return 0;
}

/* None */
static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname) {
    PyErr_Format(PyExc_NameError, "free variable '%s' referenced before assignment in enclosing scope", varname);
}

/* HasAttr */
static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
    PyObject *r;
    if (unlikely(!__Pyx_PyBaseString_Check(n))) {
        PyErr_SetString(PyExc_TypeError,
                        "hasattr(): attribute name must be string");
        return -1;
    }
    r = __Pyx_GetAttr(o, n);
    if (unlikely(!r)) {
        PyErr_Clear();
        return 0;
    } else {
        Py_DECREF(r);
        return 1;
    }
}

/* IterNext */
static PyObject *__Pyx_PyIter_Next2Default(PyObject* defval) {
    PyObject* exc_type;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    exc_type = __Pyx_PyErr_Occurred();
    if (unlikely(exc_type)) {
        if (!defval || unlikely(!__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))
            return NULL;
        __Pyx_PyErr_Clear();
        Py_INCREF(defval);
        return defval;
    }
    if (defval) {
        Py_INCREF(defval);
        return defval;
    }
    __Pyx_PyErr_SetNone(PyExc_StopIteration);
    return NULL;
}
static void __Pyx_PyIter_Next_ErrorNoIterator(PyObject *iterator) {
    PyErr_Format(PyExc_TypeError,
        "%.200s object is not an iterator", Py_TYPE(iterator)->tp_name);
}
static CYTHON_INLINE PyObject *__Pyx_PyIter_Next2(PyObject* iterator, PyObject* defval) {
    PyObject* next;
    iternextfunc iternext = Py_TYPE(iterator)->tp_iternext;
    if (likely(iternext)) {
#if CYTHON_USE_TYPE_SLOTS
        next = iternext(iterator);
        if (likely(next))
            return next;
        #if PY_VERSION_HEX >= 0x02070000
        if (unlikely(iternext == &_PyObject_NextNotImplemented))
            return NULL;
        #endif
#else
        next = PyIter_Next(iterator);
        if (likely(next))
            return next;
#endif
    } else if (CYTHON_USE_TYPE_SLOTS || unlikely(!PyIter_Check(iterator))) {
        __Pyx_PyIter_Next_ErrorNoIterator(iterator);
        return NULL;
    }
#if !CYTHON_USE_TYPE_SLOTS
    else {
        next = PyIter_Next(iterator);
        if (likely(next))
            return next;
    }
#endif
    return __Pyx_PyIter_Next2Default(defval);
}

/* DictGetItem */
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
    PyObject *value;
    value = PyDict_GetItemWithError(d, key);
    if (unlikely(!value)) {
        if (!PyErr_Occurred()) {
            if (unlikely(PyTuple_Check(key))) {
                PyObject* args = PyTuple_Pack(1, key);
                if (likely(args)) {
                    PyErr_SetObject(PyExc_KeyError, args);
                    Py_DECREF(args);
                }
            } else {
                PyErr_SetObject(PyExc_KeyError, key);
            }
        }
        return NULL;
    }
    Py_INCREF(value);
    return value;
}
#endif

/* CythonFunction */
#include <structmember.h>
static PyObject *
__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *closure)
{
    if (unlikely(op->func_doc == NULL)) {
        if (op->func.m_ml->ml_doc) {
#if PY_MAJOR_VERSION >= 3
            op->func_doc = PyUnicode_FromString(op->func.m_ml->ml_doc);
#else
            op->func_doc = PyString_FromString(op->func.m_ml->ml_doc);
#endif
            if (unlikely(op->func_doc == NULL))
                return NULL;
        } else {
            Py_INCREF(Py_None);
            return Py_None;
        }
    }
    Py_INCREF(op->func_doc);
    return op->func_doc;
}
static int
__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
{
    PyObject *tmp = op->func_doc;
    if (value == NULL) {
        value = Py_None;
    }
    Py_INCREF(value);
    op->func_doc = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
{
    if (unlikely(op->func_name == NULL)) {
#if PY_MAJOR_VERSION >= 3
        op->func_name = PyUnicode_InternFromString(op->func.m_ml->ml_name);
#else
        op->func_name = PyString_InternFromString(op->func.m_ml->ml_name);
#endif
        if (unlikely(op->func_name == NULL))
            return NULL;
    }
    Py_INCREF(op->func_name);
    return op->func_name;
}
static int
__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__name__ must be set to a string object");
        return -1;
    }
    tmp = op->func_name;
    Py_INCREF(value);
    op->func_name = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
{
    Py_INCREF(op->func_qualname);
    return op->func_qualname;
}
static int
__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__qualname__ must be set to a string object");
        return -1;
    }
    tmp = op->func_qualname;
    Py_INCREF(value);
    op->func_qualname = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_self(__pyx_CyFunctionObject *m, CYTHON_UNUSED void *closure)
{
    PyObject *self;
    self = m->func_closure;
    if (self == NULL)
        self = Py_None;
    Py_INCREF(self);
    return self;
}
static PyObject *
__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
{
    if (unlikely(op->func_dict == NULL)) {
        op->func_dict = PyDict_New();
        if (unlikely(op->func_dict == NULL))
            return NULL;
    }
    Py_INCREF(op->func_dict);
    return op->func_dict;
}
static int
__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
{
    PyObject *tmp;
    if (unlikely(value == NULL)) {
        PyErr_SetString(PyExc_TypeError,
               "function's dictionary may not be deleted");
        return -1;
    }
    if (unlikely(!PyDict_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
               "setting function's dictionary to a non-dict");
        return -1;
    }
    tmp = op->func_dict;
    Py_INCREF(value);
    op->func_dict = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
{
    Py_INCREF(op->func_globals);
    return op->func_globals;
}
static PyObject *
__Pyx_CyFunction_get_closure(CYTHON_UNUSED __pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
{
    Py_INCREF(Py_None);
    return Py_None;
}
static PyObject *
__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
{
    PyObject* result = (op->func_code) ? op->func_code : Py_None;
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
    int result = 0;
    PyObject *res = op->defaults_getter((PyObject *) op);
    if (unlikely(!res))
        return -1;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    op->defaults_tuple = PyTuple_GET_ITEM(res, 0);
    Py_INCREF(op->defaults_tuple);
    op->defaults_kwdict = PyTuple_GET_ITEM(res, 1);
    Py_INCREF(op->defaults_kwdict);
    #else
    op->defaults_tuple = PySequence_ITEM(res, 0);
    if (unlikely(!op->defaults_tuple)) result = -1;
    else {
        op->defaults_kwdict = PySequence_ITEM(res, 1);
        if (unlikely(!op->defaults_kwdict)) result = -1;
    }
    #endif
    Py_DECREF(res);
    return result;
}
static int
__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value, CYTHON_UNUSED void *context) {
    PyObject* tmp;
    if (!value) {
        value = Py_None;
    } else if (value != Py_None && !PyTuple_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__defaults__ must be set to a tuple object");
        return -1;
    }
    Py_INCREF(value);
    tmp = op->defaults_tuple;
    op->defaults_tuple = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context) {
    PyObject* result = op->defaults_tuple;
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
            result = op->defaults_tuple;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value, CYTHON_UNUSED void *context) {
    PyObject* tmp;
    if (!value) {
        value = Py_None;
    } else if (value != Py_None && !PyDict_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__kwdefaults__ must be set to a dict object");
        return -1;
    }
    Py_INCREF(value);
    tmp = op->defaults_kwdict;
    op->defaults_kwdict = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context) {
    PyObject* result = op->defaults_kwdict;
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
            result = op->defaults_kwdict;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value, CYTHON_UNUSED void *context) {
    PyObject* tmp;
    if (!value || value == Py_None) {
        value = NULL;
    } else if (!PyDict_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__annotations__ must be set to a dict object");
        return -1;
    }
    Py_XINCREF(value);
    tmp = op->func_annotations;
    op->func_annotations = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context) {
    PyObject* result = op->func_annotations;
    if (unlikely(!result)) {
        result = PyDict_New();
        if (unlikely(!result)) return NULL;
        op->func_annotations = result;
    }
    Py_INCREF(result);
    return result;
}
static PyGetSetDef __pyx_CyFunction_getsets[] = {
    {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
    {(char *) "__self__", (getter)__Pyx_CyFunction_get_self, 0, 0, 0},
    {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
    {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
    {0, 0, 0, 0, 0}
};
static PyMemberDef __pyx_CyFunction_members[] = {
    {(char *) "__module__", T_OBJECT, offsetof(PyCFunctionObject, m_module), PY_WRITE_RESTRICTED, 0},
    {0, 0, 0,  0, 0}
};
static PyObject *
__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, CYTHON_UNUSED PyObject *args)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromString(m->func.m_ml->ml_name);
#else
    return PyString_FromString(m->func.m_ml->ml_name);
#endif
}
static PyMethodDef __pyx_CyFunction_methods[] = {
    {"__reduce__", (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
    {0, 0, 0, 0}
};
#if PY_VERSION_HEX < 0x030500A0
#define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func_weakreflist)
#else
#define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func.m_weakreflist)
#endif
static PyObject *__Pyx_CyFunction_New(PyTypeObject *type, PyMethodDef *ml, int flags, PyObject* qualname,
                                      PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
    __pyx_CyFunctionObject *op = PyObject_GC_New(__pyx_CyFunctionObject, type);
    if (op == NULL)
        return NULL;
    op->flags = flags;
    __Pyx_CyFunction_weakreflist(op) = NULL;
    op->func.m_ml = ml;
    op->func.m_self = (PyObject *) op;
    Py_XINCREF(closure);
    op->func_closure = closure;
    Py_XINCREF(module);
    op->func.m_module = module;
    op->func_dict = NULL;
    op->func_name = NULL;
    Py_INCREF(qualname);
    op->func_qualname = qualname;
    op->func_doc = NULL;
    op->func_classobj = NULL;
    op->func_globals = globals;
    Py_INCREF(op->func_globals);
    Py_XINCREF(code);
    op->func_code = code;
    op->defaults_pyobjects = 0;
    op->defaults = NULL;
    op->defaults_tuple = NULL;
    op->defaults_kwdict = NULL;
    op->defaults_getter = NULL;
    op->func_annotations = NULL;
    PyObject_GC_Track(op);
    return (PyObject *) op;
}
static int
__Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
{
    Py_CLEAR(m->func_closure);
    Py_CLEAR(m->func.m_module);
    Py_CLEAR(m->func_dict);
    Py_CLEAR(m->func_name);
    Py_CLEAR(m->func_qualname);
    Py_CLEAR(m->func_doc);
    Py_CLEAR(m->func_globals);
    Py_CLEAR(m->func_code);
    Py_CLEAR(m->func_classobj);
    Py_CLEAR(m->defaults_tuple);
    Py_CLEAR(m->defaults_kwdict);
    Py_CLEAR(m->func_annotations);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_XDECREF(pydefaults[i]);
        PyObject_Free(m->defaults);
        m->defaults = NULL;
    }
    return 0;
}
static void __Pyx__CyFunction_dealloc(__pyx_CyFunctionObject *m)
{
    if (__Pyx_CyFunction_weakreflist(m) != NULL)
        PyObject_ClearWeakRefs((PyObject *) m);
    __Pyx_CyFunction_clear(m);
    PyObject_GC_Del(m);
}
static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
{
    PyObject_GC_UnTrack(m);
    __Pyx__CyFunction_dealloc(m);
}
static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
{
    Py_VISIT(m->func_closure);
    Py_VISIT(m->func.m_module);
    Py_VISIT(m->func_dict);
    Py_VISIT(m->func_name);
    Py_VISIT(m->func_qualname);
    Py_VISIT(m->func_doc);
    Py_VISIT(m->func_globals);
    Py_VISIT(m->func_code);
    Py_VISIT(m->func_classobj);
    Py_VISIT(m->defaults_tuple);
    Py_VISIT(m->defaults_kwdict);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_VISIT(pydefaults[i]);
    }
    return 0;
}
static PyObject *__Pyx_CyFunction_descr_get(PyObject *func, PyObject *obj, PyObject *type)
{
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    if (m->flags & __Pyx_CYFUNCTION_STATICMETHOD) {
        Py_INCREF(func);
        return func;
    }
    if (m->flags & __Pyx_CYFUNCTION_CLASSMETHOD) {
        if (type == NULL)
            type = (PyObject *)(Py_TYPE(obj));
        return __Pyx_PyMethod_New(func, type, (PyObject *)(Py_TYPE(type)));
    }
    if (obj == Py_None)
        obj = NULL;
    return __Pyx_PyMethod_New(func, obj, type);
}
static PyObject*
__Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromFormat("<cyfunction %U at %p>",
                                op->func_qualname, (void *)op);
#else
    return PyString_FromFormat("<cyfunction %s at %p>",
                               PyString_AsString(op->func_qualname), (void *)op);
#endif
}
static PyObject * __Pyx_CyFunction_CallMethod(PyObject *func, PyObject *self, PyObject *arg, PyObject *kw) {
    PyCFunctionObject* f = (PyCFunctionObject*)func;
    PyCFunction meth = f->m_ml->ml_meth;
    Py_ssize_t size;
    switch (f->m_ml->ml_flags & (METH_VARARGS | METH_KEYWORDS | METH_NOARGS | METH_O)) {
    case METH_VARARGS:
        if (likely(kw == NULL || PyDict_Size(kw) == 0))
            return (*meth)(self, arg);
        break;
    case METH_VARARGS | METH_KEYWORDS:
        return (*(PyCFunctionWithKeywords)(void*)meth)(self, arg, kw);
    case METH_NOARGS:
        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
            size = PyTuple_GET_SIZE(arg);
            if (likely(size == 0))
                return (*meth)(self, NULL);
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
                f->m_ml->ml_name, size);
            return NULL;
        }
        break;
    case METH_O:
        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
            size = PyTuple_GET_SIZE(arg);
            if (likely(size == 1)) {
                PyObject *result, *arg0;
                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                arg0 = PyTuple_GET_ITEM(arg, 0);
                #else
                arg0 = PySequence_ITEM(arg, 0); if (unlikely(!arg0)) return NULL;
                #endif
                result = (*meth)(self, arg0);
                #if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
                Py_DECREF(arg0);
                #endif
                return result;
            }
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
                f->m_ml->ml_name, size);
            return NULL;
        }
        break;
    default:
        PyErr_SetString(PyExc_SystemError, "Bad call flags in "
                        "__Pyx_CyFunction_Call. METH_OLDARGS is no "
                        "longer supported!");
        return NULL;
    }
    PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
                 f->m_ml->ml_name);
    return NULL;
}
static CYTHON_INLINE PyObject *__Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    return __Pyx_CyFunction_CallMethod(func, ((PyCFunctionObject*)func)->m_self, arg, kw);
}
static PyObject *__Pyx_CyFunction_CallAsMethod(PyObject *func, PyObject *args, PyObject *kw) {
    PyObject *result;
    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *) func;
    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
        Py_ssize_t argc;
        PyObject *new_args;
        PyObject *self;
        argc = PyTuple_GET_SIZE(args);
        new_args = PyTuple_GetSlice(args, 1, argc);
        if (unlikely(!new_args))
            return NULL;
        self = PyTuple_GetItem(args, 0);
        if (unlikely(!self)) {
            Py_DECREF(new_args);
            return NULL;
        }
        result = __Pyx_CyFunction_CallMethod(func, self, new_args, kw);
        Py_DECREF(new_args);
    } else {
        result = __Pyx_CyFunction_Call(func, args, kw);
    }
    return result;
}
static PyTypeObject __pyx_CyFunctionType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    "cython_function_or_method",
    sizeof(__pyx_CyFunctionObject),
    0,
    (destructor) __Pyx_CyFunction_dealloc,
    0,
    0,
    0,
#if PY_MAJOR_VERSION < 3
    0,
#else
    0,
#endif
    (reprfunc) __Pyx_CyFunction_repr,
    0,
    0,
    0,
    0,
    __Pyx_CyFunction_CallAsMethod,
    0,
    0,
    0,
    0,
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC,
    0,
    (traverseproc) __Pyx_CyFunction_traverse,
    (inquiry) __Pyx_CyFunction_clear,
    0,
#if PY_VERSION_HEX < 0x030500A0
    offsetof(__pyx_CyFunctionObject, func_weakreflist),
#else
    offsetof(PyCFunctionObject, m_weakreflist),
#endif
    0,
    0,
    __pyx_CyFunction_methods,
    __pyx_CyFunction_members,
    __pyx_CyFunction_getsets,
    0,
    0,
    __Pyx_CyFunction_descr_get,
    0,
    offsetof(__pyx_CyFunctionObject, func_dict),
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
#if PY_VERSION_HEX >= 0x030400a1
    0,
#endif
};
static int __pyx_CyFunction_init(void) {
    __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
    if (unlikely(__pyx_CyFunctionType == NULL)) {
        return -1;
    }
    return 0;
}
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults = PyObject_Malloc(size);
    if (unlikely(!m->defaults))
        return PyErr_NoMemory();
    memset(m->defaults, 0, size);
    m->defaults_pyobjects = pyobjects;
    return m->defaults;
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *func, PyObject *tuple) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_tuple = tuple;
    Py_INCREF(tuple);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_kwdict = dict;
    Py_INCREF(dict);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->func_annotations = dict;
    Py_INCREF(dict);
}

/* ImportFrom */
static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Format(PyExc_ImportError,
        #if PY_MAJOR_VERSION < 3
            "cannot import name %.230s", PyString_AS_STRING(name));
        #else
            "cannot import name %S", name);
        #endif
    }
    return value;
}

/* ExtTypeTest */
static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(__Pyx_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

/* PyObject_GenericGetAttr */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name) {
    if (unlikely(Py_TYPE(obj)->tp_dictoffset)) {
        return PyObject_GenericGetAttr(obj, attr_name);
    }
    return __Pyx_PyObject_GenericGetAttrNoDict(obj, attr_name);
}
#endif

/* SetupReduce */
static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
  int ret;
  PyObject *name_attr;
  name_attr = __Pyx_PyObject_GetAttrStr(meth, __pyx_n_s_name);
  if (likely(name_attr)) {
      ret = PyObject_RichCompareBool(name_attr, name, Py_EQ);
  } else {
      ret = -1;
  }
  if (unlikely(ret < 0)) {
      PyErr_Clear();
      ret = 0;
  }
  Py_XDECREF(name_attr);
  return ret;
}
static int __Pyx_setup_reduce(PyObject* type_obj) {
    int ret = 0;
    PyObject *object_reduce = NULL;
    PyObject *object_reduce_ex = NULL;
    PyObject *reduce = NULL;
    PyObject *reduce_ex = NULL;
    PyObject *reduce_cython = NULL;
    PyObject *setstate = NULL;
    PyObject *setstate_cython = NULL;
#if CYTHON_USE_PYTYPE_LOOKUP
    if (_PyType_Lookup((PyTypeObject*)type_obj, __pyx_n_s_getstate)) goto GOOD;
#else
    if (PyObject_HasAttr(type_obj, __pyx_n_s_getstate)) goto GOOD;
#endif
#if CYTHON_USE_PYTYPE_LOOKUP
    object_reduce_ex = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_reduce_ex); if (!object_reduce_ex) goto BAD;
#else
    object_reduce_ex = __Pyx_PyObject_GetAttrStr((PyObject*)&PyBaseObject_Type, __pyx_n_s_reduce_ex); if (!object_reduce_ex) goto BAD;
#endif
    reduce_ex = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce_ex); if (unlikely(!reduce_ex)) goto BAD;
    if (reduce_ex == object_reduce_ex) {
#if CYTHON_USE_PYTYPE_LOOKUP
        object_reduce = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_reduce); if (!object_reduce) goto BAD;
#else
        object_reduce = __Pyx_PyObject_GetAttrStr((PyObject*)&PyBaseObject_Type, __pyx_n_s_reduce); if (!object_reduce) goto BAD;
#endif
        reduce = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce); if (unlikely(!reduce)) goto BAD;
        if (reduce == object_reduce || __Pyx_setup_reduce_is_named(reduce, __pyx_n_s_reduce_cython)) {
            reduce_cython = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce_cython); if (unlikely(!reduce_cython)) goto BAD;
            ret = PyDict_SetItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_reduce, reduce_cython); if (unlikely(ret < 0)) goto BAD;
            ret = PyDict_DelItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_reduce_cython); if (unlikely(ret < 0)) goto BAD;
            setstate = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_setstate);
            if (!setstate) PyErr_Clear();
            if (!setstate || __Pyx_setup_reduce_is_named(setstate, __pyx_n_s_setstate_cython)) {
                setstate_cython = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_setstate_cython); if (unlikely(!setstate_cython)) goto BAD;
                ret = PyDict_SetItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_setstate, setstate_cython); if (unlikely(ret < 0)) goto BAD;
                ret = PyDict_DelItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_setstate_cython); if (unlikely(ret < 0)) goto BAD;
            }
            PyType_Modified((PyTypeObject*)type_obj);
        }
    }
    goto GOOD;
BAD:
    if (!PyErr_Occurred())
        PyErr_Format(PyExc_RuntimeError, "Unable to initialize pickling for %s", ((PyTypeObject*)type_obj)->tp_name);
    ret = -1;
GOOD:
#if !CYTHON_USE_PYTYPE_LOOKUP
    Py_XDECREF(object_reduce);
    Py_XDECREF(object_reduce_ex);
#endif
    Py_XDECREF(reduce);
    Py_XDECREF(reduce_ex);
    Py_XDECREF(reduce_cython);
    Py_XDECREF(setstate);
    Py_XDECREF(setstate_cython);
    return ret;
}

/* CalculateMetaclass */
static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases) {
    Py_ssize_t i, nbases = PyTuple_GET_SIZE(bases);
    for (i=0; i < nbases; i++) {
        PyTypeObject *tmptype;
        PyObject *tmp = PyTuple_GET_ITEM(bases, i);
        tmptype = Py_TYPE(tmp);
#if PY_MAJOR_VERSION < 3
        if (tmptype == &PyClass_Type)
            continue;
#endif
        if (!metaclass) {
            metaclass = tmptype;
            continue;
        }
        if (PyType_IsSubtype(metaclass, tmptype))
            continue;
        if (PyType_IsSubtype(tmptype, metaclass)) {
            metaclass = tmptype;
            continue;
        }
        PyErr_SetString(PyExc_TypeError,
                        "metaclass conflict: "
                        "the metaclass of a derived class "
                        "must be a (non-strict) subclass "
                        "of the metaclasses of all its bases");
        return NULL;
    }
    if (!metaclass) {
#if PY_MAJOR_VERSION < 3
        metaclass = &PyClass_Type;
#else
        metaclass = &PyType_Type;
#endif
    }
    Py_INCREF((PyObject*) metaclass);
    return (PyObject*) metaclass;
}

/* Py3ClassCreate */
static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name,
                                           PyObject *qualname, PyObject *mkw, PyObject *modname, PyObject *doc) {
    PyObject *ns;
    if (metaclass) {
        PyObject *prep = __Pyx_PyObject_GetAttrStr(metaclass, __pyx_n_s_prepare);
        if (prep) {
            PyObject *pargs = PyTuple_Pack(2, name, bases);
            if (unlikely(!pargs)) {
                Py_DECREF(prep);
                return NULL;
            }
            ns = PyObject_Call(prep, pargs, mkw);
            Py_DECREF(prep);
            Py_DECREF(pargs);
        } else {
            if (unlikely(!PyErr_ExceptionMatches(PyExc_AttributeError)))
                return NULL;
            PyErr_Clear();
            ns = PyDict_New();
        }
    } else {
        ns = PyDict_New();
    }
    if (unlikely(!ns))
        return NULL;
    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_module, modname) < 0)) goto bad;
    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_qualname, qualname) < 0)) goto bad;
    if (unlikely(doc && PyObject_SetItem(ns, __pyx_n_s_doc, doc) < 0)) goto bad;
    return ns;
bad:
    Py_DECREF(ns);
    return NULL;
}
static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases,
                                      PyObject *dict, PyObject *mkw,
                                      int calculate_metaclass, int allow_py2_metaclass) {
    PyObject *result, *margs;
    PyObject *owned_metaclass = NULL;
    if (allow_py2_metaclass) {
        owned_metaclass = PyObject_GetItem(dict, __pyx_n_s_metaclass);
        if (owned_metaclass) {
            metaclass = owned_metaclass;
        } else if (likely(PyErr_ExceptionMatches(PyExc_KeyError))) {
            PyErr_Clear();
        } else {
            return NULL;
        }
    }
    if (calculate_metaclass && (!metaclass || PyType_Check(metaclass))) {
        metaclass = __Pyx_CalculateMetaclass((PyTypeObject*) metaclass, bases);
        Py_XDECREF(owned_metaclass);
        if (unlikely(!metaclass))
            return NULL;
        owned_metaclass = metaclass;
    }
    margs = PyTuple_Pack(3, name, bases, dict);
    if (unlikely(!margs)) {
        result = NULL;
    } else {
        result = PyObject_Call(metaclass, margs, mkw);
        Py_DECREF(margs);
    }
    Py_XDECREF(owned_metaclass);
    return result;
}

/* ClassMethod */
static PyObject* __Pyx_Method_ClassMethod(PyObject *method) {
#if CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM <= 0x05080000
    if (PyObject_TypeCheck(method, &PyWrapperDescr_Type)) {
        return PyClassMethod_New(method);
    }
#else
#if CYTHON_COMPILING_IN_PYSTON || CYTHON_COMPILING_IN_PYPY
    if (PyMethodDescr_Check(method))
#else
    static PyTypeObject *methoddescr_type = NULL;
    if (methoddescr_type == NULL) {
       PyObject *meth = PyObject_GetAttrString((PyObject*)&PyList_Type, "append");
       if (!meth) return NULL;
       methoddescr_type = Py_TYPE(meth);
       Py_DECREF(meth);
    }
    if (__Pyx_TypeCheck(method, methoddescr_type))
#endif
    {
        PyMethodDescrObject *descr = (PyMethodDescrObject *)method;
        #if PY_VERSION_HEX < 0x03020000
        PyTypeObject *d_type = descr->d_type;
        #else
        PyTypeObject *d_type = descr->d_common.d_type;
        #endif
        return PyDescr_NewClassMethod(d_type, descr->d_method);
    }
#endif
    else if (PyMethod_Check(method)) {
        return PyClassMethod_New(PyMethod_GET_FUNCTION(method));
    }
    else if (PyCFunction_Check(method)) {
        return PyClassMethod_New(method);
    }
#ifdef __Pyx_CyFunction_USED
    else if (__Pyx_CyFunction_Check(method)) {
        return PyClassMethod_New(method);
    }
#endif
    PyErr_SetString(PyExc_TypeError,
                   "Class-level classmethod() can only be called on "
                   "a method_descriptor or instance method.");
    return NULL;
}

/* GetNameInClass */
static PyObject *__Pyx_GetGlobalNameAfterAttributeLookup(PyObject *name) {
    PyObject *result;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
        return NULL;
    __Pyx_PyErr_Clear();
    __Pyx_GetModuleGlobalNameUncached(result, name);
    return result;
}
static PyObject *__Pyx__GetNameInClass(PyObject *nmspace, PyObject *name) {
    PyObject *result;
    result = __Pyx_PyObject_GetAttrStr(nmspace, name);
    if (!result) {
        result = __Pyx_GetGlobalNameAfterAttributeLookup(name);
    }
    return result;
}

/* CLineInTraceback */
#ifndef CYTHON_CLINE_IN_TRACEBACK
static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line) {
    PyObject *use_cline;
    PyObject *ptype, *pvalue, *ptraceback;
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject **cython_runtime_dict;
#endif
    if (unlikely(!__pyx_cython_runtime)) {
        return c_line;
    }
    __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
#if CYTHON_COMPILING_IN_CPYTHON
    cython_runtime_dict = _PyObject_GetDictPtr(__pyx_cython_runtime);
    if (likely(cython_runtime_dict)) {
        __PYX_PY_DICT_LOOKUP_IF_MODIFIED(
            use_cline, *cython_runtime_dict,
            __Pyx_PyDict_GetItemStr(*cython_runtime_dict, __pyx_n_s_cline_in_traceback))
    } else
#endif
    {
      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
      if (use_cline_obj) {
        use_cline = PyObject_Not(use_cline_obj) ? Py_False : Py_True;
        Py_DECREF(use_cline_obj);
      } else {
        PyErr_Clear();
        use_cline = NULL;
      }
    }
    if (!use_cline) {
        c_line = 0;
        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
    }
    else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
        c_line = 0;
    }
    __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
    return c_line;
}
#endif

/* CodeObjectCache */
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = start + (end - start) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, (size_t)new_max*sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}

/* AddTraceback */
#include "compile.h"
#include "frameobject.h"
#include "traceback.h"
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(filename);
    #else
    py_srcfile = PyUnicode_FromString(filename);
    #endif
    if (!py_srcfile) goto bad;
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_code = __Pyx_PyCode_New(
        0,
        0,
        0,
        0,
        0,
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    Py_DECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    if (c_line) {
        c_line = __Pyx_CLineForTraceback(tstate, c_line);
    }
    py_code = __pyx_find_code_object(c_line ? -c_line : py_line);
    if (!py_code) {
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) goto bad;
        __pyx_insert_code_object(c_line ? -c_line : py_line, py_code);
    }
    py_frame = PyFrame_New(
        tstate,            /*PyThreadState *tstate,*/
        py_code,           /*PyCodeObject *code,*/
        __pyx_d,    /*PyObject *globals,*/
        0                  /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

/* CIntToPy */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
    const int neg_one = (int) ((int) 0 - (int) 1), const_zero = (int) 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(int) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(int) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(int),
                                     little, !is_unsigned);
    }
}

/* CIntFromPyVerify */
#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
    {\
        func_type value = func_value;\
        if (sizeof(target_type) < sizeof(func_type)) {\
            if (unlikely(value != (func_type) (target_type) value)) {\
                func_type zero = 0;\
                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
                    return (target_type) -1;\
                if (is_unsigned && unlikely(value < zero))\
                    goto raise_neg_overflow;\
                else\
                    goto raise_overflow;\
            }\
        }\
        return (target_type) value;\
    }

/* CIntToPy */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_PY_LONG_LONG(unsigned PY_LONG_LONG value) {
    const unsigned PY_LONG_LONG neg_one = (unsigned PY_LONG_LONG) ((unsigned PY_LONG_LONG) 0 - (unsigned PY_LONG_LONG) 1), const_zero = (unsigned PY_LONG_LONG) 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(unsigned PY_LONG_LONG) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(unsigned PY_LONG_LONG) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(unsigned PY_LONG_LONG) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(unsigned PY_LONG_LONG) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(unsigned PY_LONG_LONG) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(unsigned PY_LONG_LONG),
                                     little, !is_unsigned);
    }
}

/* CIntToPy */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
    const long neg_one = (long) ((long) 0 - (long) 1), const_zero = (long) 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(long),
                                     little, !is_unsigned);
    }
}

/* CIntFromPy */
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
    const int neg_one = (int) ((int) 0 - (int) 1), const_zero = (int) 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(int) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (int) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (int) 0;
                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
                case 2:
                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 2 * PyLong_SHIFT) {
                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 3 * PyLong_SHIFT) {
                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (int) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(int) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (int) 0;
                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(int) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(int) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            int val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (int) -1;
        }
    } else {
        int val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (int) -1;
        val = __Pyx_PyInt_As_int(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to int");
    return (int) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to int");
    return (int) -1;
}

/* CIntFromPy */
static CYTHON_INLINE unsigned PY_LONG_LONG __Pyx_PyInt_As_unsigned_PY_LONG_LONG(PyObject *x) {
    const unsigned PY_LONG_LONG neg_one = (unsigned PY_LONG_LONG) ((unsigned PY_LONG_LONG) 0 - (unsigned PY_LONG_LONG) 1), const_zero = (unsigned PY_LONG_LONG) 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(unsigned PY_LONG_LONG) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (unsigned PY_LONG_LONG) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (unsigned PY_LONG_LONG) 0;
                case  1: __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, digit, digits[0])
                case 2:
                    if (8 * sizeof(unsigned PY_LONG_LONG) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) >= 2 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(unsigned PY_LONG_LONG) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) >= 3 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(unsigned PY_LONG_LONG) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) >= 4 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (unsigned PY_LONG_LONG) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(unsigned PY_LONG_LONG) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(unsigned PY_LONG_LONG, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(unsigned PY_LONG_LONG) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(unsigned PY_LONG_LONG, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (unsigned PY_LONG_LONG) 0;
                case -1: __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) (((unsigned PY_LONG_LONG)-1)*(((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(unsigned PY_LONG_LONG) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) ((((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) (((unsigned PY_LONG_LONG)-1)*(((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(unsigned PY_LONG_LONG) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) ((((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) (((unsigned PY_LONG_LONG)-1)*(((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(unsigned PY_LONG_LONG) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(unsigned PY_LONG_LONG, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(unsigned PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                            return (unsigned PY_LONG_LONG) ((((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(unsigned PY_LONG_LONG) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(unsigned PY_LONG_LONG, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(unsigned PY_LONG_LONG) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(unsigned PY_LONG_LONG, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            unsigned PY_LONG_LONG val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (unsigned PY_LONG_LONG) -1;
        }
    } else {
        unsigned PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (unsigned PY_LONG_LONG) -1;
        val = __Pyx_PyInt_As_unsigned_PY_LONG_LONG(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to unsigned PY_LONG_LONG");
    return (unsigned PY_LONG_LONG) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to unsigned PY_LONG_LONG");
    return (unsigned PY_LONG_LONG) -1;
}

/* CIntFromPy */
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
    const long neg_one = (long) ((long) 0 - (long) 1), const_zero = (long) 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(long) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (long) 0;
                case  1: __PYX_VERIFY_RETURN_INT(long, digit, digits[0])
                case 2:
                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 2 * PyLong_SHIFT) {
                            return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 3 * PyLong_SHIFT) {
                            return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                            return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (long) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(long) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (long) 0;
                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(long) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                            return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                            return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                            return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(long) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            long val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (long) -1;
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (long) -1;
        val = __Pyx_PyInt_As_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to long");
    return (long) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to long");
    return (long) -1;
}

/* CIntFromPy */
static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
    const size_t neg_one = (size_t) ((size_t) 0 - (size_t) 1), const_zero = (size_t) 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(size_t) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(size_t, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (size_t) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (size_t) 0;
                case  1: __PYX_VERIFY_RETURN_INT(size_t, digit, digits[0])
                case 2:
                    if (8 * sizeof(size_t) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) >= 2 * PyLong_SHIFT) {
                            return (size_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(size_t) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) >= 3 * PyLong_SHIFT) {
                            return (size_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(size_t) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
                            return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (size_t) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(size_t) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(size_t) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (size_t) 0;
                case -1: __PYX_VERIFY_RETURN_INT(size_t, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(size_t,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(size_t) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
                            return (size_t) (((size_t)-1)*(((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(size_t) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
                            return (size_t) ((((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
                            return (size_t) (((size_t)-1)*(((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(size_t) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
                            return (size_t) ((((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT) {
                            return (size_t) (((size_t)-1)*(((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(size_t) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT) {
                            return (size_t) ((((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(size_t) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(size_t, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(size_t) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(size_t, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            size_t val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (size_t) -1;
        }
    } else {
        size_t val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (size_t) -1;
        val = __Pyx_PyInt_As_size_t(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to size_t");
    return (size_t) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to size_t");
    return (size_t) -1;
}

/* FastTypeChecks */
#if CYTHON_COMPILING_IN_CPYTHON
static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
    while (a) {
        a = a->tp_base;
        if (a == b)
            return 1;
    }
    return b == &PyBaseObject_Type;
}
static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b) {
    PyObject *mro;
    if (a == b) return 1;
    mro = a->tp_mro;
    if (likely(mro)) {
        Py_ssize_t i, n;
        n = PyTuple_GET_SIZE(mro);
        for (i = 0; i < n; i++) {
            if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                return 1;
        }
        return 0;
    }
    return __Pyx_InBases(a, b);
}
#if PY_MAJOR_VERSION == 2
static int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject* exc_type2) {
    PyObject *exception, *value, *tb;
    int res;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&exception, &value, &tb);
    res = exc_type1 ? PyObject_IsSubclass(err, exc_type1) : 0;
    if (unlikely(res == -1)) {
        PyErr_WriteUnraisable(err);
        res = 0;
    }
    if (!res) {
        res = PyObject_IsSubclass(err, exc_type2);
        if (unlikely(res == -1)) {
            PyErr_WriteUnraisable(err);
            res = 0;
        }
    }
    __Pyx_ErrRestore(exception, value, tb);
    return res;
}
#else
static CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {
    int res = exc_type1 ? __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type1) : 0;
    if (!res) {
        res = __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
    }
    return res;
}
#endif
static int __Pyx_PyErr_GivenExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
    Py_ssize_t i, n;
    assert(PyExceptionClass_Check(exc_type));
    n = PyTuple_GET_SIZE(tuple);
#if PY_MAJOR_VERSION >= 3
    for (i=0; i<n; i++) {
        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
    }
#endif
    for (i=0; i<n; i++) {
        PyObject *t = PyTuple_GET_ITEM(tuple, i);
        #if PY_MAJOR_VERSION < 3
        if (likely(exc_type == t)) return 1;
        #endif
        if (likely(PyExceptionClass_Check(t))) {
            if (__Pyx_inner_PyErr_GivenExceptionMatches2(exc_type, NULL, t)) return 1;
        } else {
        }
    }
    return 0;
}
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject* exc_type) {
    if (likely(err == exc_type)) return 1;
    if (likely(PyExceptionClass_Check(err))) {
        if (likely(PyExceptionClass_Check(exc_type))) {
            return __Pyx_inner_PyErr_GivenExceptionMatches2(err, NULL, exc_type);
        } else if (likely(PyTuple_Check(exc_type))) {
            return __Pyx_PyErr_GivenExceptionMatchesTuple(err, exc_type);
        } else {
        }
    }
    return PyErr_GivenExceptionMatches(err, exc_type);
}
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *exc_type1, PyObject *exc_type2) {
    assert(PyExceptionClass_Check(exc_type1));
    assert(PyExceptionClass_Check(exc_type2));
    if (likely(err == exc_type1 || err == exc_type2)) return 1;
    if (likely(PyExceptionClass_Check(err))) {
        return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
    }
    return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
}
#endif

/* CheckBinaryVersion */
static int __Pyx_check_binary_version(void) {
    char ctversion[4], rtversion[4];
    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compiletime version %s of module '%.100s' "
                      "does not match runtime version %s",
                      ctversion, __Pyx_MODULE_NAME, rtversion);
        return PyErr_WarnEx(NULL, message, 1);
    }
    return 0;
}

/* InitStrings */
static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        if (PyObject_Hash(*t->p) == -1)
            return -1;
        ++t;
    }
    return 0;
}

static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
    return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
}
static CYTHON_INLINE const char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
#if !CYTHON_PEP393_ENABLED
static const char* __Pyx_PyUnicode_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
    char* defenc_c;
    PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
    if (!defenc) return NULL;
    defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
    {
        char* end = defenc_c + PyBytes_GET_SIZE(defenc);
        char* c;
        for (c = defenc_c; c < end; c++) {
            if ((unsigned char) (*c) >= 128) {
                PyUnicode_AsASCIIString(o);
                return NULL;
            }
        }
    }
#endif
    *length = PyBytes_GET_SIZE(defenc);
    return defenc_c;
}
#else
static CYTHON_INLINE const char* __Pyx_PyUnicode_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
    if (unlikely(__Pyx_PyUnicode_READY(o) == -1)) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
    if (likely(PyUnicode_IS_ASCII(o))) {
        *length = PyUnicode_GET_LENGTH(o);
        return PyUnicode_AsUTF8(o);
    } else {
        PyUnicode_AsASCIIString(o);
        return NULL;
    }
#else
    return PyUnicode_AsUTF8AndSize(o, length);
#endif
}
#endif
#endif
static CYTHON_INLINE const char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
        return __Pyx_PyUnicode_AsStringAndSize(o, length);
    } else
#endif
#if (!CYTHON_COMPILING_IN_PYPY) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
    if (PyByteArray_Check(o)) {
        *length = PyByteArray_GET_SIZE(o);
        return PyByteArray_AS_STRING(o);
    } else
#endif
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (unlikely(r < 0)) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject* x) {
    int retval;
    if (unlikely(!x)) return -1;
    retval = __Pyx_PyObject_IsTrue(x);
    Py_DECREF(x);
    return retval;
}
static PyObject* __Pyx_PyNumber_IntOrLongWrongResultType(PyObject* result, const char* type_name) {
#if PY_MAJOR_VERSION >= 3
    if (PyLong_Check(result)) {
        if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,
                "__int__ returned non-int (type %.200s).  "
                "The ability to return an instance of a strict subclass of int "
                "is deprecated, and may be removed in a future version of Python.",
                Py_TYPE(result)->tp_name)) {
            Py_DECREF(result);
            return NULL;
        }
        return result;
    }
#endif
    PyErr_Format(PyExc_TypeError,
                 "__%.4s__ returned non-%.4s (type %.200s)",
                 type_name, type_name, Py_TYPE(result)->tp_name);
    Py_DECREF(result);
    return NULL;
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
#if CYTHON_USE_TYPE_SLOTS
  PyNumberMethods *m;
#endif
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_Check(x) || PyLong_Check(x)))
#else
  if (likely(PyLong_Check(x)))
#endif
    return __Pyx_NewRef(x);
#if CYTHON_USE_TYPE_SLOTS
  m = Py_TYPE(x)->tp_as_number;
  #if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = m->nb_int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = m->nb_long(x);
  }
  #else
  if (likely(m && m->nb_int)) {
    name = "int";
    res = m->nb_int(x);
  }
  #endif
#else
  if (!PyBytes_CheckExact(x) && !PyUnicode_CheckExact(x)) {
    res = PyNumber_Int(x);
  }
#endif
  if (likely(res)) {
#if PY_MAJOR_VERSION < 3
    if (unlikely(!PyInt_Check(res) && !PyLong_Check(res))) {
#else
    if (unlikely(!PyLong_CheckExact(res))) {
#endif
        return __Pyx_PyNumber_IntOrLongWrongResultType(res, name);
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject *x;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_CheckExact(b))) {
    if (sizeof(Py_ssize_t) >= sizeof(long))
        return PyInt_AS_LONG(b);
    else
        return PyInt_AsSsize_t(b);
  }
#endif
  if (likely(PyLong_CheckExact(b))) {
    #if CYTHON_USE_PYLONG_INTERNALS
    const digit* digits = ((PyLongObject*)b)->ob_digit;
    const Py_ssize_t size = Py_SIZE(b);
    if (likely(__Pyx_sst_abs(size) <= 1)) {
        ival = likely(size) ? digits[0] : 0;
        if (size == -1) ival = -ival;
        return ival;
    } else {
      switch (size) {
         case 2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
      }
    }
    #endif
    return PyLong_AsSsize_t(b);
  }
  x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
  return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
    return PyInt_FromSize_t(ival);
}


#endif /* Py_PYTHON_H */
